import{d as E,r as N,H as M,b as s,c as b,w as l,f as t,et as w,eB as C,e as Q,aJ as g,eC as j,u as e,bg as A,bZ as F,b_ as q,J as U,K as H,ez as J,c4 as x,eN as z,bF as G}from"./outputWidgets.17392370.js";import{R as O}from"./SmartConsole.995c5bb7.js";import{c as Z,A as m}from"./Title.bc3ff086.js";import{F as L}from"./Form.e398e550.js";import{W as X}from"./workspaces.9a283772.js";import{R as Y,F as ee}from"./broker.a0a05ab5.js";import{a as ae}from"./asyncComputed.76849272.js";import{r as te}from"./index.7c30bb7a.js";import{_ as re}from"./StageRunSelector.vue_vue_type_script_setup_true_lang.6c9809c0.js";import{k as le}from"./icons.baa5f07a.js";import"./index.8aa7fba2.js";import{C as oe,a as ne,A as se}from"./CollapsePanel.853dbd0d.js";import{A as D}from"./index.1fd97730.js";import{A as ue}from"./index.ba0ff767.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h=new Error().stack;h&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[h]="2e007f71-b2b2-408b-a521-a06f534176ec",i._sentryDebugIdIdentifier="sentry-dbid-2e007f71-b2b2-408b-a521-a06f534176ec")}catch{}})();const ie="forms_workspace_id_path_key",de="This path is already being used by another form or dash on your workspace",Ae=E({__name:"FormSettings",props:{form:{}},setup(i){const r=N(i.form),n=[{label:"General",props:[{label:"Form name",valueKey:"title"}]},{label:"Welcome Screen",props:[{label:"Title",valueKey:"welcomeTitle"},{label:"Subtitle",valueKey:"startMessage"},{label:"Start button text",valueKey:"startButtonText"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"endMessage"},{label:"Restart button text",valueKey:"restartButtonText"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"errorMessage"}]}],S=M({pathError:null,sectionsShown:[!0,!1,!1]}),P=_=>{_.detail.includes(ie)&&(S.pathError=de)};return addEventListener("hasura-error",P),(_,p)=>(s(),b(e(L),{layout:"vertical"},{default:l(()=>[t(O,{runtime:r.value},null,8,["runtime"]),(s(),w(A,null,C(n,u=>Q("div",{key:u.label},[t(e(Z),{level:3},{default:l(()=>[g(j(u.label),1)]),_:2},1024),(s(!0),w(A,null,C(u.props,v=>(s(),b(e(m),{key:v.label,label:v.label},{default:l(()=>[t(e(F),{type:"text",value:r.value[v.valueKey],onChange:c=>r.value[v.valueKey]=c.target.value},null,8,["value","onChange"])]),_:2},1032,["label"]))),128))])),64)),t(e(m),{label:"Start smart form automatically"},{default:l(()=>[t(e(q),{checked:r.value.autoStart,"onUpdate:checked":p[0]||(p[0]=u=>r.value.autoStart=u)},null,8,["checked"])]),_:1}),t(e(m),{label:"Allow the user to restart the smart form after it is over"},{default:l(()=>[t(e(q),{checked:r.value.allowRestart,"onUpdate:checked":p[1]||(p[1]=u=>r.value.allowRestart=u)},null,8,["checked"])]),_:1})]),_:1}))}}),me={style:{display:"flex","justify-content":"flex-end"}},ce={key:1,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},k="abstra-run-id",Fe=E({__name:"FormTester",props:{form:{},logService:{}},setup(i,{expose:h}){var B,I,K,$;const r=i,n=M({queryParams:[],url:`${r.form.path}`,stageRunId:null}),S=U(()=>`/_editor/${r.form.routeName}/${encodeURIComponent(r.form.path)}/preview?${n.queryParams.map(({name:a,value:f})=>`${a}=${f}`).join("&")}`),P=a=>{n.stageRunId=a},{result:_,loading:p}=ae(()=>X.get()),u=()=>{n.queryParams.push({name:"",value:""})},v=a=>{n.queryParams=n.queryParams.filter((f,o)=>o!==a)};H([()=>n.stageRunId,()=>n.queryParams],([a,f])=>{const o=f.find(d=>d.name===k);if(console.log(a,o),a&&!o){n.queryParams.push({name:k,value:a});return}if(!a&&o){n.queryParams=n.queryParams.filter(d=>d.name!==k);return}a&&o&&a!==o.value&&(o.value=a)});const c=U(()=>Y.create({formPath:r.form.path}));(B=c.value)==null||B.on("stdout",a=>{r.logService.log({type:"stdout",log:a.log})}),(I=c.value)==null||I.on("stderr",a=>{r.logService.log({type:"stderr",log:a.log})}),(K=c.value)==null||K.onClose(()=>{r.logService.log({type:"stderr",log:"Program closed"})}),($=c.value)==null||$.on("files:changed",()=>{r.logService.log({type:"files-changed",log:"Files changed"})});const V=J(),W=({path:a})=>{te("editor",V,a)},R=N(null);async function T(){var a;return r.logService.log({type:"restart"}),(a=R.value)==null?void 0:a.run()}return h({restart:T}),(a,f)=>(s(),b(e(L),{layout:"vertical"},{default:l(()=>[t(e(D),{orientation:"left"},{default:l(()=>[g("Params")]),_:1}),t(e(m),null,{default:l(()=>[t(re,{disabled:r.form.isInitial,path:r.form.path,optional:!0,onSelect:f[0]||(f[0]=o=>P(o))},null,8,["disabled","path"])]),_:1}),t(e(m),null,{default:l(()=>[t(e(oe),null,{default:l(()=>[t(e(ne),{header:`Query Params (${n.queryParams.length})`},{default:l(()=>[(s(!0),w(A,null,C(n.queryParams,(o,d)=>(s(),b(e(m),{key:d},{default:l(()=>[t(e(ue),null,{default:l(()=>[t(e(F),{value:o.name,"onUpdate:value":y=>o.name=y,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(F),{value:o.value,"onUpdate:value":y=>o.value=y,type:"text",placeholder:"value",disabled:o.name===k},null,8,["value","onUpdate:value","disabled"]),t(e(x),{danger:"",onClick:y=>v(d)},{default:l(()=>[g("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(m),null,{default:l(()=>[t(e(x),{type:"dashed",style:{width:"100%"},onClick:u},{default:l(()=>[g("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1})]),_:1}),t(e(m),null,{default:l(()=>[Q("div",me,[t(e(x),{href:S.value,style:{display:"flex",align:"center"},target:"_blank"},{default:l(()=>[t(z,{path:e(le),fill:"currentColor"},null,8,["path"]),g(" Open in new tab ")]),_:1},8,["href"])])]),_:1}),t(e(D),{orientation:"left"},{default:l(()=>[g("Quick Preview")]),_:1}),e(p)||!e(_)?(s(),b(e(G),{key:0})):n.stageRunId||r.form.isInitial?(s(),w("div",ce,[t(ee,{ref_key:"runner",ref:R,form:a.form.makeRunnerData(e(_)),params:{...n.queryParams.reduce((o,{name:d,value:y})=>({...o,[d]:y}),{})},"is-preview":"","enable-auto-focus":"",broker:c.value,onNavigate:W,onLogout:T},null,8,["form","params","broker"])])):(s(),b(e(se),{key:2,message:"Please select a task instance to run the form.",type:"warning","show-icon":""}))]),_:1}))}});export{Fe as _,Ae as a};
//# sourceMappingURL=FormTester.vue_vue_type_script_setup_true_lang.7f0204a9.js.map

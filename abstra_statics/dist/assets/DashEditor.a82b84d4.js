var Ds=Object.defineProperty;var Ts=(e,t,s)=>t in e?Ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var ce=(e,t,s)=>(Ts(e,typeof t!="symbol"?t+"":t,s),s);import{r as ks}from"./index.ae3415a0.js";import{T as $s,B as Ns,a as $t}from"./BackButton.ff64d06f.js";import{d as Q,b as E,c as A,x as _,V as Ne,W as Zt,e as k,O as pt,Q as ht,q,p as J,r as G,K as F,R as he,aa as ft,N as H,z as g,F as De,L as Te,A as ke,D as j,v as vt,U as gt,a as He,a2 as Cs,G as ve,t as fe,X as mt,o as Jt,ag as xs,E as Ms,ah as Ws,ai as Bs,w as ye,S as Gs,aj as Fs,H as Hs,J as Us}from"./registerWidgets.88d12ae1.js";import{i as zs,w as Ee,l as rt,v as Ks,r as Qt,a as qt,s as be,p as Vs,b as re,c as b,d as Le,e as js,f as O,D as Zs,g as Nt,C as Js,h as Ct,j as Qs,k as xt,m as Ye,n as Mt}from"./DashPlayer.012c8c7f.js";import{R as qs,S as Xs,_ as Ys}from"./UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.d0b0855b.js";import{L as eo}from"./CircularLoading.0c459b72.js";import{i as U,g as B,a as We,b as de,f as we,w as ne,c as yt,e as to,h as so,s as oo,j as ao,k as ro}from"./runnerData.833eed88.js";import{u as Ue}from"./log.d8fc5146.js";import{p as no,i as io,z as et,A as tt,B as lo,v as co,C as uo}from"./icons.778999cd.js";import{a as Wt}from"./asyncComputed.0bf661db.js";import{D as po}from"./dashes.645b907c.js";import{W as ho}from"./workspaces.741b6616.js";import{S as fo}from"./SaveButton.c080879d.js";import{P as vo}from"./PreviewButton.31dce115.js";import"./passwordlessManager.a5c71e7e.js";import"./WidgetsFrame.0c34a010.js";import"./colors.4ea7d5a7.js";import"./Modal.f14dcc44.js";import"./Passwordless.a5311b67.js";import"./forms.cc593bbd.js";import"./activeRecord.57c6bf02.js";import"./hooks.d59fb935.js";import"./jobs.098bcb10.js";import"./login.29b4c1f1.js";import"./sentry.2692e5c6.js";const go=e=>(pt("data-v-fb3c93ab"),e=e(),ht(),e),mo={class:"dash-settings"},yo={class:"dash-property"},wo=go(()=>_("label",{class:"property-label"},"Name",-1)),_o=Q({__name:"DashSettings",props:{dash:null},setup(e){return(t,s)=>(E(),A("div",mo,[_("div",yo,[wo,Ne(_("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.dash.title=o),class:"property-input",placeholder:"Enter a name"},null,512),[[Zt,e.dash.title]])]),k(qs,{runtime:e.dash},null,8,["runtime"])]))}});const So=q(_o,[["__scopeId","data-v-fb3c93ab"]]);class wt{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const Eo=e=>wt.isMac&&e.ctrlKey,Re=e=>wt.isMac?e.metaKey:e.ctrlKey,nt=e=>e.altKey,ue=e=>e.shiftKey,st={alt:nt,"arrow-up":e=>e.code==="ArrowUp","arrow-down":e=>e.code==="ArrowDown","arrow-left":e=>e.code==="ArrowLeft","arrow-right":e=>e.code==="ArrowRight",ctrl:Re,delete:e=>wt.isMac?e.code==="Backspace":e.code==="Delete",enter:e=>e.code==="Enter",escape:e=>e.code==="Escape",shift:ue,space:e=>e.code==="Space",a:e=>e.code==="KeyA",b:e=>e.code==="KeyB",c:e=>e.code==="KeyC",d:e=>e.code==="KeyD",f:e=>e.code==="KeyF",g:e=>e.code==="KeyG",h:e=>e.code==="KeyH",k:e=>e.code==="KeyK",p:e=>e.code==="KeyP",v:e=>e.code==="KeyV",x:e=>e.code==="KeyX",z:e=>e.code==="KeyZ",0:e=>e.code==="Digit0","[":e=>e.code==="BracketLeft","]":e=>e.code==="BracketRight"};class bo{constructor(t){ce(this,"pressedKeys");ce(this,"evt");this.evt=t,this.pressedKeys={};const s=o=>a=>{Object.keys(st).forEach(i=>{st[i](a)&&this.setPressed(i,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(t,s){this.pressedKeys[t]=s}isPressed(t){var s;return this.evt?st[t](this.evt):(s=this.pressedKeys[t])!=null?s:!1}}const Po=new bo;/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Io=globalThis&&globalThis.__extends||function(){var e=function(t,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var i in a)a.hasOwnProperty(i)&&(o[i]=a[i])},e(t,s)};return function(t,s){e(t,s);function o(){this.constructor=t}t.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}(),Oo=Object.prototype.hasOwnProperty;function it(e,t){return Oo.call(e,t)}function lt(e){if(Array.isArray(e)){for(var t=new Array(e.length),s=0;s<t.length;s++)t[s]=""+s;return t}if(Object.keys)return Object.keys(e);var o=[];for(var a in e)it(e,a)&&o.push(a);return o}function z(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ct(e){for(var t=0,s=e.length,o;t<s;){if(o=e.charCodeAt(t),o>=48&&o<=57){t++;continue}return!1}return!0}function pe(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Xt(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ut(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,s=e.length;t<s;t++)if(ut(e[t]))return!0}else if(typeof e=="object"){for(var o=lt(e),a=o.length,i=0;i<a;i++)if(ut(e[o[i]]))return!0}}return!1}function Bt(e,t){var s=[e];for(var o in t){var a=typeof t[o]=="object"?JSON.stringify(t[o],null,2):t[o];typeof a<"u"&&s.push(o+": "+a)}return s.join(`
`)}var Yt=function(e){Io(t,e);function t(s,o,a,i,n){var c=this.constructor,h=e.call(this,Bt(s,{name:o,index:a,operation:i,tree:n}))||this;return h.name=o,h.index=a,h.operation=i,h.tree=n,Object.setPrototypeOf(h,c.prototype),h.message=Bt(s,{name:o,index:a,operation:i,tree:n}),h}return t}(Error),C=Yt,Ao=z,_e={add:function(e,t,s){return e[t]=this.value,{newDocument:s}},remove:function(e,t,s){var o=e[t];return delete e[t],{newDocument:s,removed:o}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:function(e,t,s){var o=Be(s,this.path);o&&(o=z(o));var a=ge(s,{op:"remove",path:this.from}).removed;return ge(s,{op:"add",path:this.path,value:a}),{newDocument:s,removed:o}},copy:function(e,t,s){var o=Be(s,this.from);return ge(s,{op:"add",path:this.path,value:z(o)}),{newDocument:s}},test:function(e,t,s){return{newDocument:s,test:$e(e[t],this.value)}},_get:function(e,t,s){return this.value=e[t],{newDocument:s}}},Lo={add:function(e,t,s){return ct(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:s,index:t}},remove:function(e,t,s){var o=e.splice(t,1);return{newDocument:s,removed:o[0]}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:_e.move,copy:_e.copy,test:_e.test,_get:_e._get};function Be(e,t){if(t=="")return e;var s={op:"_get",path:t};return ge(e,s),s.value}function ge(e,t,s,o,a,i){if(s===void 0&&(s=!1),o===void 0&&(o=!0),a===void 0&&(a=!0),i===void 0&&(i=0),s&&(typeof s=="function"?s(t,0,e,t.path):Ge(t,0)),t.path===""){var n={newDocument:e};if(t.op==="add")return n.newDocument=t.value,n;if(t.op==="replace")return n.newDocument=t.value,n.removed=e,n;if(t.op==="move"||t.op==="copy")return n.newDocument=Be(e,t.from),t.op==="move"&&(n.removed=e),n;if(t.op==="test"){if(n.test=$e(e,t.value),n.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return n.newDocument=e,n}else{if(t.op==="remove")return n.removed=e,n.newDocument=null,n;if(t.op==="_get")return t.value=e,n;if(s)throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return n}}else{o||(e=z(e));var c=t.path||"",h=c.split("/"),l=e,f=1,v=h.length,p=void 0,u=void 0,P=void 0;for(typeof s=="function"?P=s:P=Ge;;){if(u=h[f],u&&u.indexOf("~")!=-1&&(u=Xt(u)),a&&(u=="__proto__"||u=="prototype"&&f>0&&h[f-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(s&&p===void 0&&(l[u]===void 0?p=h.slice(0,f).join("/"):f==v-1&&(p=t.path),p!==void 0&&P(t,0,e,p)),f++,Array.isArray(l)){if(u==="-")u=l.length;else{if(s&&!ct(u))throw new C("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);ct(u)&&(u=~~u)}if(f>=v){if(s&&t.op==="add"&&u>l.length)throw new C("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);var n=Lo[t.op].call(t,l,u,e);if(n.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return n}}else if(f>=v){var n=_e[t.op].call(t,l,u,e);if(n.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return n}if(l=l[u],s&&f<v&&(!l||typeof l!="object"))throw new C("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function x(e,t,s,o,a){if(o===void 0&&(o=!0),a===void 0&&(a=!0),s&&!Array.isArray(t))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=z(e));for(var i=new Array(t.length),n=0,c=t.length;n<c;n++)i[n]=ge(e,t[n],s,!0,a,n),e=i[n].newDocument;return i.newDocument=e,i}function Ro(e,t,s){var o=ge(e,t);if(o.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument}function Ge(e,t,s,o){if(typeof e!="object"||e===null||Array.isArray(e))throw new C("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,s);if(_e[e.op]){if(typeof e.path!="string")throw new C("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,s);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new C('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,s);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new C("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ut(e.value))throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,s);if(s){if(e.op=="add"){var a=e.path.split("/").length,i=o.split("/").length;if(a!==i+1&&a!==i)throw new C("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,s)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==o)throw new C("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,s)}else if(e.op==="move"||e.op==="copy"){var n={op:"_get",path:e.from,value:void 0},c=es([n],s);if(c&&c.name==="OPERATION_PATH_UNRESOLVABLE")throw new C("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,s)}}}else throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,s)}function es(e,t,s){try{if(!Array.isArray(e))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)x(z(t),z(e),s||!0);else{s=s||Ge;for(var o=0;o<e.length;o++)s(e[o],o,t,void 0)}}catch(a){if(a instanceof C)return a;throw a}}function $e(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var s=Array.isArray(e),o=Array.isArray(t),a,i,n;if(s&&o){if(i=e.length,i!=t.length)return!1;for(a=i;a--!==0;)if(!$e(e[a],t[a]))return!1;return!0}if(s!=o)return!1;var c=Object.keys(e);if(i=c.length,i!==Object.keys(t).length)return!1;for(a=i;a--!==0;)if(!t.hasOwnProperty(c[a]))return!1;for(a=i;a--!==0;)if(n=c[a],!$e(e[n],t[n]))return!1;return!0}return e!==e&&t!==t}const Do=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:C,deepClone:Ao,getValueByPointer:Be,applyOperation:ge,applyPatch:x,applyReducer:Ro,validator:Ge,validate:es,_areEquals:$e},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var _t=new WeakMap,To=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),ko=function(){function e(t,s){this.callback=t,this.observer=s}return e}();function $o(e){return _t.get(e)}function No(e,t){return e.observers.get(t)}function Co(e,t){e.observers.delete(t.callback)}function xo(e,t){t.unobserve()}function Mo(e,t){var s=[],o,a=$o(e);if(!a)a=new To(e),_t.set(e,a);else{var i=No(a,t);o=i&&i.observer}if(o)return o;if(o={},a.value=z(e),t){o.callback=t,o.next=null;var n=function(){dt(o)},c=function(){clearTimeout(o.next),o.next=setTimeout(n)};typeof window<"u"&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return o.patches=s,o.object=e,o.unobserve=function(){dt(o),clearTimeout(o.next),Co(a,o),typeof window<"u"&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new ko(t,o)),o}function dt(e,t){t===void 0&&(t=!1);var s=_t.get(e.object);St(s.value,e.object,e.patches,"",t),e.patches.length&&x(s.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function St(e,t,s,o,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var i=lt(t),n=lt(e),c=!1,h=n.length-1;h>=0;h--){var l=n[h],f=e[l];if(it(t,l)&&!(t[l]===void 0&&f!==void 0&&Array.isArray(t)===!1)){var v=t[l];typeof f=="object"&&f!=null&&typeof v=="object"&&v!=null&&Array.isArray(f)===Array.isArray(v)?St(f,v,s,o+"/"+pe(l),a):f!==v&&(a&&s.push({op:"test",path:o+"/"+pe(l),value:z(f)}),s.push({op:"replace",path:o+"/"+pe(l),value:z(v)}))}else Array.isArray(e)===Array.isArray(t)?(a&&s.push({op:"test",path:o+"/"+pe(l),value:z(f)}),s.push({op:"remove",path:o+"/"+pe(l)}),c=!0):(a&&s.push({op:"test",path:o,value:e}),s.push({op:"replace",path:o,value:t}))}if(!(!c&&i.length==n.length))for(var h=0;h<i.length;h++){var l=i[h];!it(e,l)&&t[l]!==void 0&&s.push({op:"add",path:o+"/"+pe(l),value:z(t[l])})}}}function Wo(e,t,s){s===void 0&&(s=!1);var o=[];return St(e,t,o,"",s),o}const Bo=Object.freeze(Object.defineProperty({__proto__:null,unobserve:xo,observe:Mo,generate:dt,compare:Wo},Symbol.toStringTag,{value:"Module"}));Object.assign({},Do,Bo,{JsonPatchError:Yt,deepClone:z,escapePathComponent:pe,unescapePathComponent:Xt});function Et(e,t,s){const{selectedWidgets:o,grid:a}=e,i=[...o,...s||[]],n=Math.min(...i.map(v=>{var p,u;return(u=(p=de(v,t))==null?void 0:p.colStart)!=null?u:null}).filter(v=>v!==null)),c=Math.max(...i.map(v=>{var p,u;return(u=(p=de(v,t))==null?void 0:p.colEnd)!=null?u:null}).filter(v=>v!==null)),h=Math.min(...i.map(v=>{var p,u;return(u=(p=de(v,t))==null?void 0:p.rowStart)!=null?u:null}).filter(v=>v!==null)),l=c>a.columns-1?a.columns-1-c:n<0?-n:0,f=h<0?-h:0;return i.flatMap(v=>{const p=de(v,t);if(l===0&&f===0)return[];if(!p||!U(p))return[];const u=te(ee(v,B(t)),t);return[{op:"replace",path:`${u}/${v}/colStart`,backup:p,value:p.colStart+l},{op:"replace",path:`${u}/${v}/colEnd`,backup:p,value:p.colEnd+l},{op:"replace",path:`${u}/${v}/rowStart`,backup:p,value:p.rowStart+f},{op:"replace",path:`${u}/${v}/rowEnd`,backup:p,value:p.rowEnd+f}]})}const ee=(e,t,s=null)=>{for(const o in t){const a=t[o];if(U(a)){if(o==e)return s}else{const i=ee(e,a.slot,o);if(i)return i}}return null},Go=(e,t)=>e.rowStart>=t.row&&e.rowStart<t.row+t.height,ts=(e,t)=>{var s;return(s=Object.keys(t.slottables).find(o=>Go(e,t.slottables[o].position)))!=null?s:null},Gt=(e,t)=>{const s=B(t),o=(i,n,c)=>{for(const h in n){if(h==i)return c;const l=n[h];if(U(l))continue;const f=o(i,l.slot,`${c}/${h}/slot`);if(f)return f}return null},a=o(e,s,We(t));if(!a)throw new Error("Widget not found in layout");return a},te=(e,t)=>e?`${We(t)}/${e}/slot`:We(t),Fe=(e,t,s)=>{if(s){const a=t.slottables[s];return{...e,rowStart:e.rowStart-a.position.row,rowEnd:e.rowEnd-a.position.row}}const o=Object.values(t.slottables).reduce((a,i)=>a+(i.position.row<e.rowStart?i.position.height:0),0);return{...e,rowStart:e.rowStart-o,rowEnd:e.rowEnd-o}};function Fo(e){const{grid:t,mouseState:s,workingLayout:o,calculatedPositions:a}=e;if(s.state!=="MOVING_SLOTTABLE")return[];const i=t.cellAt(s.mousePos.x,s.mousePos.y),n=[],c=s.slottableId,h=o.getSlottable(c);if(!h)throw new Error("Slottable not found");const l=as(os(i,h.height),a,c);return n.push({op:"replace",path:`/slot/${c}/row`,backup:h.row,value:l.row}),n.push({op:"replace",path:`/slot/${c}/order`,backup:h.order,value:l.order}),n}function Ho(e,t){const{grid:s,mouseState:o,selectedWidgets:a,calculatedPositions:i,workingLayout:n}=e;if(o.state!=="MOVING")return[];const c=s.cellAt(o.initialMousePos.x,o.initialMousePos.y),h=s.cellAt(o.mousePos.x,o.mousePos.y),l={deltaI:h.i-c.i,deltaJ:h.j-c.j},f=[];for(const v of a){const p=i.widgets[v],u={colStart:p.position.colStart+l.deltaI,colEnd:p.position.colEnd+l.deltaI,rowStart:p.position.rowStart+l.deltaJ,rowEnd:p.position.rowEnd+l.deltaJ},P=te(ee(v,B(n.layout)),n.layout),I=ts(u,i),$=te(I,n.layout),L=we(v,B(t));!L||!U(L)||(P===$?f.push({op:"replace",path:`${P}/${v}`,backup:L,value:{...L,...Fe(u,i,I)}}):(f.push({op:"remove",path:`${P}/${v}`,backup:L}),f.push({op:"add",path:`${$}/${v}`,value:{...L,...Fe(u,i,I)}})))}return f}function Uo(e,t,s,o){const a=[];for(const i of e.selectedWidgets){const n=te(ee(i,B(o)),o),c=de(i,o);!U(c)||(a.push({op:"replace",path:`${n}/${i}/colStart`,backup:c,value:c.colStart+t}),a.push({op:"replace",path:`${n}/${i}/colEnd`,backup:c,value:c.colEnd+t}),a.push({op:"replace",path:`${n}/${i}/rowStart`,backup:c,value:c.rowStart+s}),a.push({op:"replace",path:`${n}/${i}/rowEnd`,backup:c,value:c.rowEnd+s}))}return a}function ss(e,t,s,o){const{camera:a,mouseState:i,grid:n}=e;if(!a)throw new Error("No camera value yet");if(i.state!=="RESIZING"&&i.state!=="SLOTTABLE_RESIZING")return null;const c=i.side,h=a.screenPoint2world(i.mousePos),l=c==="bottom"||c==="right"?"bottom-right":"top-left",f=n.snap(h,l),v=c.includes("left")?f.x:t.x,p=c.includes("top")?f.y:t.y,u=c.includes("right")?f.x:t.x+t.width,P=c.includes("bottom")?f.y:t.y+t.height,I=Math.abs(u-v),$=Math.abs(P-p);let L={x:Math.min(v,u),y:Math.min(p,P),width:I,height:$,referential:f.referential};return I<s&&(L={...L,width:s}),$<o&&(L={...L,height:o}),L}const zo=({selectedWidgets:e,grid:t,calculatedPositions:s})=>Qt(Object.entries(s.widgets).filter(([o])=>e.has(o)).map(([o,a])=>Ee(s.widgets[o].position,t)).filter(o=>o!==null));function Ko(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="SLOTTABLE_RESIZING")return[];const a=o.slottables[t.slottableId],i={colStart:0,rowStart:a.position.row,colEnd:s.columns,rowEnd:a.position.row+a.position.height},n=s.rectFromArea(i);if(!n)return[];const c=ss(e,n,s.width,s.cellHeight);if(!c)return[];const h=s.areaFromRect(c);return[{op:"replace",path:`/slot/${t.slottableId}/height`,backup:a.position.height,value:h.rowEnd-h.rowStart+1}]}function Vo(e){const{mouseState:t,selectedWidgets:s,grid:o,workingLayout:a,calculatedPositions:i}=e;if(t.state!=="RESIZING")return[];const n=t.side,c=zo(e);if(!c)return[];const h=Array.from(s).filter(v=>{const p=i.widgets[v];return zs(Ee(p.position,o),c,n)}),{minWidth:l,minHeight:f}=ne[t.type].dashProperties;return h.flatMap(v=>{const p=i.widgets[v],u=Ee(p.position,o),P=ss(e,u,l,f);if(!P)return[];const I=ee(v,B(a.layout)),$=te(I,a.layout),L=o.areaFromRect(u),ie=Fe(o.areaFromRect(P),i,I);return[{op:"replace",path:`${$}/${v}/colStart`,backup:L.colStart,value:Math.max(ie.colStart,0)},{op:"replace",path:`${$}/${v}/colEnd`,backup:L.colEnd,value:Math.min(ie.colEnd,rt.columns-1)},{op:"replace",path:`${$}/${v}/rowStart`,backup:L.rowStart,value:Math.max(ie.rowStart,0)},{op:"replace",path:`${$}/${v}/rowEnd`,backup:L.rowEnd,value:ie.rowEnd}]})}function jo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING")return{operations:[]};const a=Object.values(ne[t.type].pythonAPI.params).reduce((u,P)=>(P.isKwarg||!P.dashesInitialValue||(u[P.argName]=P.dashesInitialValue),u),{}),{initialWidth:i,initialHeight:n}=ne[t.type].dashProperties,c=s.areaFromRect({x:t.x,y:t.y,width:i,height:n,referential:"world"}),h=ts(c,o),l=te(h,e.workingLayout.layout),f=Ue(),v={id:f,type:t.type,props:{...a},...Fe(c,o,h),events:{}};return{operations:[{op:"add",path:`${l}/${f}`,value:v}],widgetId:f}}const os=({j:e},t)=>({row:e,height:t,order:0}),Zo=(e,t)=>Object.keys(e).reduce((s,o)=>(o===t||(s[o]=e[o]),s),{}),as=(e,t,s)=>{const o=s?{...t,slottables:Zo(t.slottables,s)}:t,a=Math.max(Object.values(o.slottables).reduce((n,c)=>c.position.row>=e.row?n:c.position.row+c.position.height<=e.row?n-c.position.height:n-(e.row-c.position.row),e.row),0),i=Jo(e,o);return{...e,row:a,order:i}},Ft=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).find(o=>e.row>=o.position.row+o.position.height/2&&e.row<=o.position.row+o.position.height),Ht=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).filter(o=>o.position.row+o.position.height/2>e.row&&o.position.row<=e.row+e.height).reduce((o,a)=>!o||a.position.order<o.position.order?a:o,null),Jo=(e,t)=>{var f,v;const s=Ft(e,t),o=Ht(e,t),a=s?Ht(s.position,t,s.id):null,i=o?Ft(o.position,t,o.id):null,n=[s,i].reduce((p,u)=>p?u&&p.position.order>u.position.order?u:p:u,null),c=[o,a].reduce((p,u)=>p?u&&p.position.order<u.position.order?u:p:u,null);if(!n&&!c)return 0;const h=(f=n==null?void 0:n.position.order)!=null?f:c.position.order-2,l=(v=c==null?void 0:c.position.order)!=null?v:n.position.order+2;return(h+l)/2};function Qo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING_SLOTTABLE")return{operations:[]};const a=s.cellAt(t.x,t.y),i=Ue(),n={id:i,type:t.type,props:{condition:"True"},slot:{},...as(os(a,1),o)};return{operations:[{op:"add",path:`/slot/${i}`,value:n}],widgetId:i}}function qo(e,t){const{mouseState:s,selectedWidgets:o}=e;if(s.state!=="MOVING"||!s.duplicating)return[];const a=[];for(const i of o){const n=te(ee(i,B(t)),t),c=de(i,t);if(!c)continue;const h=Ue();a.push({op:"add",path:`${n}/${h}`,value:{...J.exports.cloneDeep(c),id:h}})}return a}function rs(e,t,s){const o=e.selectedWidgets,a=o.keys().next().value,i=ee(a,B(t)),n=i?yt(i,t).slot:B(t),h=Object.keys(n).filter(v=>!o.has(v)&&!(s!=null&&s.some(p=>v==p))&&U(n[v])).sort((v,p)=>Ks(we(v,B(t)),we(p,B(t)))),l=[...o,...s||[]].map(v=>we(v,B(t))).filter(v=>v!=null),f=[];return h.forEach(v=>{const p=we(v,B(t));if(!p||!U(p))return;let u=0,P={...p};const I=()=>l.some($=>qt(P,$));for(;I();)u++,P={...p,rowStart:p.rowStart+u,rowEnd:p.rowEnd+u};if(u){const $=te(i,t);f.push({op:"replace",path:`${$}/${v}/rowStart`,backup:p.rowStart,value:p.rowStart+u}),f.push({op:"replace",path:`${$}/${v}/rowEnd`,backup:p.rowEnd,value:p.rowEnd+u})}l.push(P)}),f}function Xo(e,t,s,o){const a=e.selectedWidgets;if(!a.size)return[];const i=[...a],n=[];return i.some(h=>{const l=ee(h,B(o)),f=l?yt(l,o).slot:B(o),v=Object.keys(f).filter(u=>!a.has(u)&&U(f[u])),p=de(h,o);return v.some(u=>qt(p,f[u]))})&&a.forEach(h=>{const l=we(h,B(o)),f=te(ee(h,B(o)),o);!l||!U(l)||(n.push({op:"replace",path:`${f}/${h}/rowStart`,backup:l.rowStart,value:l.rowStart-s}),n.push({op:"replace",path:`${f}/${h}/rowEnd`,backup:l.rowEnd,value:l.rowEnd-s}),n.push({op:"replace",path:`${f}/${h}/colStart`,backup:l.colStart,value:l.colStart-t}),n.push({op:"replace",path:`${f}/${h}/colEnd`,backup:l.colEnd,value:l.colEnd-t}))}),n}function Yo(e,t){const s=[],o=[];for(const a of t){const i=Ue();s.push({op:"add",path:`/slot/${i}`,value:{...J.exports.cloneDeep(a),id:i}}),o.push(i)}return{operations:s,widgetsId:o}}function ea(e){const t=z(e.workingLayout.layout),s=qo(e,t);x(t,s);const o=Fo(e);x(t,o);const a=Ho(e,t);x(t,a);const i=Vo(e);x(t,i);const n=Ko(e);x(t,n);const c=jo(e);x(t,c.operations);const h=Qo(e);x(t,h.operations);const l=Et(e,t,c.widgetId?[c.widgetId]:[]);x(t,l);const f=rs(e,t,c.widgetId?[c.widgetId]:[]);return x(t,f),{layout:t,operations:[...s,...a,...o,...i,...n,...c.operations,...l,...f,...h.operations]}}function ta(e,t,s){const o=e.workingLayout.layout,a=Uo(e,t,s,o);x(o,a);const i=Xo(e,t,s,o);x(o,i);const n=Et(e,o);return x(o,n),[...a,...i,...n]}function sa(e,t){const s=e.workingLayout.layout,o=Yo(e,t);x(s,o.operations);const a=Et(e,s,o.widgetsId);x(s,a);const i=rs(e,s,o.widgetsId);return x(s,i),[...o.operations,...a,...i]}const oa={class:"zoom-bar"},aa={class:"zoom-value"},ra=Q({__name:"ZoomBar",props:{camera:null},emits:["hover","leave"],setup(e,{emit:t}){const s=e,o=G(!1),a=G(null),i=()=>{var l;(l=s.camera)==null||l.zoomIn(1.1,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},n=()=>{var l;(l=s.camera)==null||l.zoomIn(.9,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},c=F(()=>{var h,l;return`${Math.floor(((l=(h=s.camera)==null?void 0:h.zoom)!=null?l:1)*100)}%`});return he(()=>{var h;return(h=s.camera)==null?void 0:h.zoom},()=>{clearTimeout(a.value),o.value=!0,a.value=setTimeout(()=>o.value=!1,3e3)}),(h,l)=>Ne((E(),A("div",{class:"zoom-bar-wrapper",onMouseover:l[0]||(l[0]=f=>t("hover")),onMouseleave:l[1]||(l[1]=f=>t("leave"))},[_("div",oa,[_("span",{class:"zoom-control",onClick:n},"-"),_("span",aa,H(g(c)),1),_("span",{class:"zoom-control",onClick:i},"+")])],544)),[[ft,e.camera&&o.value]])}});const na=q(ra,[["__scopeId","data-v-f937a967"]]),ia=()=>window.location.href.startsWith("vscode-webview://"),la=(e,t)=>{!ia()||window.vscode.postMessage({type:"usage-event",event:{type:e,payload:t}})},ca=async({operations:e,name:t})=>{la("widgets_updated",{checkpoint:t,operations:z(e)})};class bt{constructor(t,s){ce(this,"checkpointHistory",{undos:[],redos:[]});ce(this,"_save",null);this.workingLayout=t,this.appState=s}static create(t,s){return new bt(t,s)}setWorkingLayout(t){this.workingLayout=t}undo(){if(this.appState.isPreview||!this.checkpointHistory.undos.length)return;const t=this.checkpointHistory.undos.pop();if(t)return x(this.workingLayout,t.operations),this.checkpointHistory.redos.push(ot(t)),t}redo(){if(this.appState.isPreview)return;const t=this.checkpointHistory.redos.pop();if(t)return x(this.workingLayout,t.operations),this.checkpointHistory.undos.push(ot(t)),t}execute(t){this.appState.isPreview||(x(this.workingLayout,t.operations),this.checkpointHistory.undos.push(ot(t)),this.checkpointHistory.redos=[],this.save(),ca(t))}onSave(t){this._save=t}save(){var t;this.appState.isPreview||(t=this._save)==null||t.call(this)}}const ot=e=>({selection:e.selection,name:`RE: ${e.name}`,operations:e.operations.slice().reverse().map(t=>ua(t))}),ua=e=>{switch(e.op){case"add":return{op:"remove",backup:e.value,path:e.path};case"remove":return{op:"add",path:e.path,value:e.backup};case"replace":return{op:"replace",backup:e.value,path:e.path,value:e.backup}}};class Pt{constructor(t,s){ce(this,"operationQueue");this.layout=t,this.operationQueue=bt.create(t,s)}getRootSlot(){return B(this.layout)}getRootSlotPath(){return We(this.layout)}setLayout(t){this.operationQueue.setWorkingLayout(t)}static create(t,s){return new Pt(t,s)}getWidget(t){return de(t,this.layout)}getWidgetOrSlottable(t){const s=to(t,this.layout);if(!s)throw new Error(`Could not find widget or slottable with id ${t}`);return s}get widgets(){return this.getRootSlot()}get allWidgets(){const t=s=>Object.entries(s).reduce((o,[a,i])=>U(i)?{...o,[a]:i}:{...o,...t(i.slot)},{});return t(this.widgets)}getSlottable(t){return yt(t,this.layout)}redo(){let t=this.operationQueue.redo();for(;t&&t.operations.length===0;)t=this.operationQueue.redo();return this.operationQueue.save(),t}undo(){let t=this.operationQueue.undo();for(;t&&t.operations.length===0;)t=this.operationQueue.undo();return this.operationQueue.save(),t}updateVariable(t,s){const o=this.getWidget(s);if(!U(o))return;const a=te(ee(s,this.getRootSlot()),this.layout);this.operationQueue.execute({name:"update variable",selection:new Set([s]),operations:[{op:"replace",backup:o.variable,value:t,path:`${a}/${s}/variable`}]})}updateProp({param:t,value:s},o){const a=n=>this.getWidgetOrSlottable(n).props,i=(n,c,h)=>{const l=Gt(n,this.layout);return[{op:"replace",backup:a(n)[c],value:h,path:`${l}/${n}/props/${c}`}]};this.operationQueue.execute({name:"update props",operations:o.flatMap(n=>i(n,t.argName,s)),selection:new Set(o)})}updateEvent({event:t,value:s},o){const a=n=>this.getWidget(n).events,i=(n,c,h)=>{const l=te(ee(n,this.getRootSlot()),this.layout);return[{op:"replace",backup:a(n)[c],value:h,path:`${l}/${n}/events/${c}`}]};this.operationQueue.execute({name:"update events",operations:o.flatMap(n=>i(n,t.key,s)),selection:new Set(o)})}delete(t){this.operationQueue.execute({name:"widgets deleted",operations:t.map(s=>{const o=Gt(s,this.layout);return{op:"remove",backup:this.getWidgetOrSlottable(s),path:`${o}/${s}`}}),selection:new Set(t)})}onSave(t){this.operationQueue.onSave(t)}updateVersion(){this.layout.version!=="0.2"&&this.operationQueue.execute({name:"Version updated",operations:[{op:"replace",backup:this.layout.version,value:"0.2",path:"/version"},{op:"add",value:this.layout.widgets,path:"/slot"},{op:"remove",path:"/widgets",backup:this.layout.widgets}],selection:new Set})}}const Ut={PandasDataFrame:"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html",PlotlyFigure:"https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html","datetime.time":"https://docs.python.org/3/library/datetime.html#datetime.time","datetime.date":"https://docs.python.org/3/library/datetime.html#datetime.date","io.IOBase":"https://docs.python.org/3/library/io.html#io.IOBase","time.struct_time":"https://docs.python.org/3/library/time.html#time.struct_time"},da="#E286A3",pa="#EF9542",ha="#B462DB",fa="#40B6D3",va="#6FB96E",ga=[da,pa,ha,fa,va];function zt(e){let t=e;return Object.keys(Ut).forEach(s=>{if(e.includes(s)){const o=Ut[s];t=t.replace(s,`<a href="${o}" target="_blank">${s}</a>`)}}),t}const Se={},ma=e=>t=>{if(Se[t])return Se[t];const s=Object.keys(Se).length%e.length;return Se[t]=e[s],e[s]},Kt=ma([...ga]),ya=()=>{Object.keys(Se).forEach(e=>delete Se[e])};class wa{constructor(){ce(this,"globalEventListeners",[])}addGlobalEventListener(t,s){addEventListener(t,s),this.globalEventListeners.find(o=>o.evt===t)||this.globalEventListeners.push({evt:t,handler:s})}removeGlobalEventListeners(){this.globalEventListeners.forEach(({evt:t,handler:s})=>{removeEventListener(t,s)}),this.globalEventListeners=[]}}const _a={class:"param-types"},Sa=["innerHTML"],Ea={key:1,class:"prop-type"},ba=["innerHTML"],Pa=Q({__name:"ParamTypes",props:{param:null},setup(e){return(t,s)=>(E(),A("div",_a,[e.param&&e.param.typeDescription?(E(!0),A(De,{key:0},Te(e.param.typeDescription,o=>(E(),A("div",{key:o,class:"prop-type"},[_("p",{class:"type",style:ke({color:g(Kt)(o)}),innerHTML:g(zt)(o)},null,12,Sa)]))),128)):e.param&&e.param.typeName?(E(),A("div",Ea,[_("p",{class:"type",style:ke({color:g(Kt)(e.param.typeName)}),innerHTML:g(zt)(e.param.typeName)},null,12,ba)])):j("",!0)]))}});const Vt=q(Pa,[["__scopeId","data-v-d6aed39d"]]),Ia=["value","placeholder"],Oa=["value","placeholder"],Aa=Q({__name:"PythonPropInputRaw",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input","change","clearSuggestions"],setup(e,{emit:t}){const s=e,o=vt({isActive:!1,hasChanges:!1}),a=h=>{t("input",h),o.hasChanges=!0},i=()=>{o.isActive=!1,t("clearSuggestions")},n=h=>{h.preventDefault();const l=h.target,f=l.selectionStart,v=l.selectionEnd,p=l.value;l.value=p.substring(0,f)+"	"+p.substring(v),l.selectionStart=l.selectionEnd=f+1,l.dispatchEvent(new Event("input"))},c=h=>{s.commit(h),o.hasChanges=!1};return gt(()=>{o.hasChanges&&s.commit(s.value)}),(h,l)=>{var v,p;const f=He("icon");return E(),A("div",{class:ve(["input-container",{error:e.hasError}])},[k(f,{path:g(no),class:"icon",fill:e.hasError?"#D35249":o.isActive?"#3482E5":void 0},null,8,["path","fill"]),e.isCode?(E(),A("textarea",{key:0,value:e.value,class:"prop-input",placeholder:(v=e.placeholder)!=null?v:void 0,onInput:l[0]||(l[0]=u=>a(u.target.value)),onClick:l[1]||(l[1]=u=>o.isActive=!0),onBlur:i,onKeydown:l[2]||(l[2]=Cs(u=>n(u),["tab"])),onChange:l[3]||(l[3]=u=>c(u.target.value))},null,40,Ia)):(E(),A("input",{key:1,value:e.value,class:"prop-input",placeholder:(p=e.placeholder)!=null?p:void 0,onInput:l[4]||(l[4]=u=>a(u.target.value)),onClick:l[5]||(l[5]=u=>o.isActive=!0),onBlur:i,onChange:l[6]||(l[6]=u=>c(u.target.value))},null,40,Oa))],2)}}});const La=q(Aa,[["__scopeId","data-v-1159e0c0"]]),Ra={class:"suggestions"},Da=["onMousedown"],Ta=Q({__name:"PythonAutoCompleteSuggestions",props:{suggestions:null},emits:["select"],setup(e,{emit:t}){return(s,o)=>Ne((E(),A("div",Ra,[(E(!0),A(De,null,Te(e.suggestions,a=>(E(),A("div",{key:a,class:"suggestion",onMousedown:i=>t("select",a)},H(a),41,Da))),128))],512)),[[ft,e.suggestions.length]])}});const ka=q(Ta,[["__scopeId","data-v-afec000d"]]),$a={class:"python-wrapper"},Na=Q({__name:"PythonPropInput",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,dashPlayerState:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input"],setup(e,{emit:t}){const s=e,o=F(()=>s.dashPlayerState.suggestionsFor),a=F(()=>s.dashPlayerState.suggestions),i=l=>{c(s.paramName,l),t("input",l)},n=l=>{h(),t("input",l),s.commit(l)},c=async(l,f)=>{!f||s.dashPlayerState.getAutocompleteSuggestions(l,f)},h=async()=>{await mt(),s.dashPlayerState.clearSuggestions()};return(l,f)=>(E(),A("div",$a,[k(La,{value:e.value,commit:e.commit,"is-code":e.isCode,"param-name":e.paramName,"dash-player-state":e.dashPlayerState,onInput:i,onClearSuggestions:h},null,8,["value","commit","is-code","param-name","dash-player-state"]),g(o)===e.paramName?(E(),fe(ka,{key:0,suggestions:g(a),onSelect:n},null,8,["suggestions"])):j("",!0)]))}});const at=q(Na,[["__scopeId","data-v-5e99cdec"]]),se=e=>(pt("data-v-3ec8c3d5"),e=e(),ht(),e),Ca={class:"wrapper"},xa={class:"title"},Ma={key:0,class:"widget-prop"},Wa=se(()=>_("h2",null,"Error",-1)),Ba=se(()=>_("p",{class:"section-description"}," Some errors were found while computing the widget. ",-1)),Ga=["textContent"],Fa={key:1,class:"section"},Ha=se(()=>_("h2",null,"VARIABLE",-1)),Ua={key:0,class:"section-content"},za={class:"widget-prop"},Ka=se(()=>_("p",{class:"prop-label"},"Bind a variable",-1)),Va=se(()=>_("p",{class:"prop-description"}," Create a variable to be controlled by this widget. ",-1)),ja={class:"input-container"},Za={key:0,class:"variable-error prop-error"},Ja=se(()=>_("pre",null,"Variable not defined",-1)),Qa={key:1,class:"prop-error",textContent:"SyntaxError: This field must be a variable name"},qa=["textContent"],Xa={key:2,class:"section"},Ya=se(()=>_("h2",null,"EVENTS",-1)),er={key:0,class:"section-content"},tr=se(()=>_("p",{class:"section-description"}," Each event is a Python code that runs on specified situations ",-1)),sr={class:"prop-label"},or={class:"prop-description"},ar={class:"section"},rr=se(()=>_("h2",null,"PROPERTIES",-1)),nr={key:0,class:"section-content"},ir=se(()=>_("p",{class:"section-description"}," Each property is a Python expression, make sure to use the correct syntax. ",-1)),lr={class:"prop-label"},cr={class:"prop-description"},ur=["textContent"],dr=se(()=>_("div",{class:"feedback"},null,-1)),pr=[dr],hr=Q({__name:"WidgetEditor",props:{selectedWidgetErrors:null,layoutModel:null,selectedWidgets:null,dashPlayerState:null},emits:["close","create-variable"],setup(e,{emit:t}){const s=e,o=G(null);he(()=>s.selectedWidgetErrors,()=>{o.value=null});const a=w=>{I.openedSections.includes(w)?I.openedSections=I.openedSections.filter(S=>S!==w):I.openedSections.push(w)},i=w=>I.openedSections.includes(w),n=w=>U(w)?ne[w.type].name:be[w.type].name,c=F(()=>o.value===null?s.selectedWidgetErrors:o.value==="variable"?J.exports.omit(s.selectedWidgetErrors,"variable"):{...s.selectedWidgetErrors,props:J.exports.omit(s.selectedWidgetErrors.props,o.value)}),h=F(()=>l.value.type.includes("-input")&&l.value.type!=="click-input"),l=F(()=>s.selectedWidgets[0]),f=F(()=>{var R;if(!U(l.value))return;const S=((R=ne[l.value.type].pythonAPI.params)!=null?R:[]).find(N=>N.argName==="initial_value");return S||null});function v(w){this.style.height="0",this.style.height=this.scrollHeight-24+"px"}const p=new wa,u=G(null),P=402,I=vt({isActive:!1,resizing:!1,width:P,openedSections:["properties","variable"]});Jt(()=>{u.value&&(p.addGlobalEventListener("mouseup",()=>I.resizing=!1),p.addGlobalEventListener("mousemove",R=>$(R))),document.querySelectorAll(".widget-props-editor textarea").forEach(R=>{!R||(R.setAttribute("style","height:"+(R.scrollHeight-24)+"px;overflow-y:hidden;"),R.addEventListener("input",v,!1))})}),xs(()=>{ya(),p.removeGlobalEventListeners()});const $=w=>{I.resizing&&(I.width=Math.max(I.width-w.movementX,P))},L=F(()=>({width:`${I.width}px`})),ie=w=>be[w.type].params,ze=F(()=>{const w=(N,K)=>N.argName===K.argName&&N.typeName===K.typeName,S=(N,K,D)=>D.findIndex(Z=>w(N,Z))===K,R=N=>!N.formOnly;return s.selectedWidgets.flatMap(N=>{var K;return U(N)?(K=ne[N.type])==null?void 0:K.pythonAPI.params:ie(N)}).filter(Boolean).filter(R).filter(S)}),me=F(()=>{const w=(R,N)=>R.key===N.key,S=(R,N,K)=>K.findIndex(D=>w(R,D))===N;return s.selectedWidgets.flatMap(R=>{var N;return U(R)?(N=ne[R.type])==null?void 0:N.events:[]}).filter(Boolean).filter(S).filter(R=>R.key!=="change")}),Ke=w=>{s.layoutModel.updateVariable(w,l.value.id),o.value="variable"},Ce=w=>S=>{s.layoutModel.updateProp({param:w,value:S},s.selectedWidgets.map(R=>R.id)),o.value=w.argName},Ve=w=>S=>{s.layoutModel.updateEvent({event:w,value:S},s.selectedWidgets.map(R=>R.id))},je=()=>{var w,S;return(S=(w=c.value.variable)==null?void 0:w.repr)==null?void 0:S.includes("SyntaxError")},Ze=()=>{var w,S;return(S=(w=c.value.variable)==null?void 0:w.repr)==null?void 0:S.includes("NameError")},m=w=>{var S;!w||((S=s.dashPlayerState.broker)==null||S.send({name:w,value:null,type:"variable-created",state:s.dashPlayerState.apiPageState}),t("create-variable",w))},M=()=>{var w,S;return((w=c.value.widget)==null?void 0:w.repr)&&!Object.values((S=c.value.props)!=null?S:{}).some(R=>R.repr)},Y=()=>{var w;return(w=c.value.widget)==null?void 0:w.repr},X=w=>{var S,R;return(R=(S=c.value.props)==null?void 0:S[w])==null?void 0:R.repr},Pe=w=>J.exports.upperFirst(w.replace(/_/g," "));return(w,S)=>{var N,K;const R=He("icon");return E(),A("div",{class:"widget-props-editor",style:ke(g(L))},[_("div",Ca,[_("div",xa,[_("h1",null,H(n(g(l))),1),k(R,{path:g(io),fill:"#414A58",class:"close-icon",width:"16",height:"16",onClick:S[0]||(S[0]=D=>t("close"))},null,8,["path"])]),M()?(E(),A("div",Ma,[Wa,Ba,_("pre",{class:"prop-error",textContent:H(Y())},null,8,Ga)])):j("",!0),g(h)?(E(),A("div",Fa,[_("div",{class:"section-header",onClick:S[1]||(S[1]=D=>a("variable"))},[k(R,{path:i("variable")?g(et):g(tt),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Ha]),i("variable")?(E(),A("div",Ua,[_("div",za,[Ka,Va,_("div",ja,[k(at,{placeholder:"variable_name","param-name":"variable","dash-player-state":e.dashPlayerState,value:(N=g(l).variable)!=null?N:"",commit:Ke,"is-code":!1,onInput:S[2]||(S[2]=D=>g(l).variable=D)},null,8,["dash-player-state","value"])]),Ze()&&g(l).variable?(E(),A("div",Za,[Ja,_("button",{onClick:S[3]||(S[3]=D=>m(g(l).variable))}," Create ")])):je()?(E(),A("pre",Qa)):(K=g(c).variable)!=null&&K.repr?(E(),A("pre",{key:2,class:"prop-error",textContent:H(g(c).variable.repr)},null,8,qa)):j("",!0),k(Vt,{param:g(f)},null,8,["param"])])])):j("",!0)])):j("",!0),g(me).length?(E(),A("div",Xa,[_("div",{class:"section-header",onClick:S[4]||(S[4]=D=>a("events"))},[k(R,{path:i("events")?g(et):g(tt),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Ya]),i("events")?(E(),A("div",er,[tr,(E(!0),A(De,null,Te(g(me),D=>(E(),A("div",{key:D.key,class:"widget-prop"},[_("label",sr,"On "+H(D.key),1),_("p",or,"Executed after "+H(D.key),1),k(at,{"param-name":D.key,"dash-player-state":e.dashPlayerState,value:g(l).events[D.key],commit:Ve(D),"is-code":!0,onInput:Z=>g(l).events[D.key]=Z},null,8,["param-name","dash-player-state","value","commit","onInput"])]))),128))])):j("",!0)])):j("",!0),_("div",ar,[_("div",{class:"section-header",onClick:S[5]||(S[5]=D=>a("properties"))},[k(R,{path:i("properties")?g(et):g(tt),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),rr]),i("properties")?(E(),A("div",nr,[ir,(E(!0),A(De,null,Te(g(ze),D=>{var Z;return E(),A("div",{key:D.argName,class:"widget-prop"},[_("p",lr,H(Pe(D.argName)),1),_("p",cr,H(D.description),1),k(at,{"has-error":!!X(D.argName),placeholder:(Z=D.default)!=null?Z:void 0,"param-name":D.argName,"dash-player-state":e.dashPlayerState,value:g(l).props[D.argName],commit:Ce(D),"is-code":!0,onInput:Je=>g(l).props[D.argName]=Je},null,8,["has-error","placeholder","param-name","dash-player-state","value","commit","onInput"]),X(D.argName)?(E(),A("pre",{key:0,class:"prop-error",textContent:H(X(D.argName))},null,8,ur)):j("",!0),k(Vt,{param:D},null,8,["param"])])}),128))])):j("",!0)])]),_("div",{ref_key:"handlerRef",ref:u,class:"handler",onMousedown:S[6]||(S[6]=Ms(D=>I.resizing=!0,["stop"]))},pr,544)],4)}}});const fr=q(hr,[["__scopeId","data-v-3ec8c3d5"]]),ns=e=>(pt("data-v-0d595f79"),e=e(),ht(),e),vr={class:"interact-menu"},gr={class:"icon-container"},mr=ns(()=>_("span",{class:"edit"},"Edit [Shift + P]",-1)),yr={class:"icon-container"},wr=ns(()=>_("span",null,"Interact [Shift + P]",-1)),_r=Q({__name:"InteractMenu",props:{isPreview:{type:Boolean}},emits:["changePreview"],setup(e,{emit:t}){return(s,o)=>{const a=He("icon");return E(),A("div",vr,[_("div",gr,[k(a,{class:ve(["icon",{active:!e.isPreview}]),path:g(lo),fill:"#5A677A",onClick:o[0]||(o[0]=i=>t("changePreview",!1))},null,8,["class","path"]),mr]),_("div",yr,[k(a,{class:ve(["icon",{active:e.isPreview}]),path:g(co),fill:"#5A677A",onClick:o[1]||(o[1]=i=>t("changePreview",!0))},null,8,["class","path"]),wr])])}}});const Sr=q(_r,[["__scopeId","data-v-0d595f79"]]),Er={class:"header"},br={key:0},Pr={key:1},Ir=Q({__name:"RuntimeHeader",props:{title:{type:String},path:{type:String,required:!0}},setup(e){return(t,s)=>(E(),A("div",Er,[e.title?(E(),A("p",br,H(e.title),1)):(E(),A("p",Pr,H(e.path),1))]))}});const Or=q(Ir,[["__scopeId","data-v-615748d7"]]);function Ar(e){var s;const t=(s=document.getSelection())==null?void 0:s.toString();return(e==null?void 0:e.selectionStart)!==void 0||!!t}const Lr={key:0,class:"widget-metadata-card"},Rr=["src"],Dr={class:"metadata-title"},Tr={class:"metadata-description"},kr={key:1,class:"collapsed-widget-metadata-card"},$r=["src"],Nr=Q({__name:"WidgetMetadataCard",props:{metadata:null,collapsed:{type:Boolean}},setup(e){const t=window.__baseURL?`${window.__baseURL}/media`:"",s=a=>a in be?`${t}/${be[a].thumbname}`:`${t}/widget-thumbs/${so(a)}.svg`,o=window.__vscodeTheme===2?"dark":"light";return(a,i)=>e.collapsed?(E(),A("div",kr,[_("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:ke(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,$r)])):(E(),A("div",Lr,[_("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:ke(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,Rr),_("div",Dr,H(e.metadata.name),1),_("div",Tr,H(e.metadata.description),1)]))}});const Cr=q(Nr,[["__scopeId","data-v-2b654c57"]]),Me={"click-input":-1,"text-output":0,"number-input":1,"text-input":2,"link-output":3,"multiple-choice-input":4,"file-input":5,"email-input":6,"markdown-output":7,"dropdown-input":8,"date-input":9,"cards-input":10,"textarea-input":11,"list-input":12,"file-output":13,"html-output":14,"pandas-output":15,"checkbox-input":16,"cnpj-input":17,"code-input":18,"progress-output":19,"pandas-row-selection-input":20,"image-input":21,"password-input":22,"currency-input":23,"iframe-output":24,"checklist-input":25,"image-output":26,"nps-input":27,"phone-input":28},xr=Q({__name:"WidgetsMetadataList",emits:["dragstart","hover","leave"],setup(e,{emit:t}){const s=G(""),o=G(),a=G(!0),i=()=>{a.value=!1},n=()=>{a.value=!0,h()},c=async()=>{await mt(),o.value&&o.value.focus()},h=()=>{s.value=""},l=Object.values(ne).concat(Object.entries(be).map(([p,u])=>({type:p,...u}))).reduce((p,u)=>u.formOnly?p:{...p,[u.type]:u},{}),f=F(()=>s.value?Object.values(l).map(p=>({widget:p,score:oo(p,s.value.split(" "))})).filter(({score:p})=>p>0).sort(({score:p},{score:u})=>u-p).map(({widget:p})=>p):Object.values(l).sort((p,u)=>{const P=p.type,I=u.type;if(P in Me){if(!(I in Me))return-1}else return 1;return Me[P]-Me[I]}));function v(p,u){t("dragstart",p,u)}return(p,u)=>{const P=He("icon");return E(),A("div",{class:"widgets-metadata",onMouseover:i,onMouseleave:n},[_("div",Ws({class:["search",{collapsed:a.value}]},Bs(a.value?{click:c}:{},!0)),[k(P,{path:g(uo),class:"search-icon"},null,8,["path"]),a.value?j("",!0):Ne((E(),A("input",{key:0,ref_key:"searchInput",ref:o,"onUpdate:modelValue":u[0]||(u[0]=I=>s.value=I),type:"search",class:"widgets-metadata-filter",placeholder:"Find widgets"},null,512)),[[Zt,s.value]])],16),_("div",{class:ve(["widgets-metadata-list",{collapsed:a.value}])},[(E(!0),A(De,null,Te(g(f),I=>(E(),fe(Cr,{key:I.type,metadata:I,draggable:!0,collapsed:a.value,onDragstart:$=>v($,I.type)},{default:ye(()=>[Gs(H(I.type),1)]),_:2},1032,["metadata","collapsed","onDragstart"]))),128))],2)],32)}}});const Mr=q(xr,[["__scopeId","data-v-cb0151ea"]]),Wr=e=>t=>J.exports.uniq(e.map(Vs(t))).length===1,Br=e=>e.some(t=>ne[t.type].autoHeight);function Gr(e,t){const s=Wr(e),o=Br(e),a=[],i=16,n=6;return s("colStart")&&a.push({rect:{x:t.x-n/2,y:t.y+t.height/2-i/2,width:n,height:i,referential:"screen"},side:"left"}),s("colEnd")&&a.push({rect:{x:t.x+t.width-n/2,y:t.y+t.height/2-i/2,width:n,height:i,referential:"screen"},side:"right"}),s("colStart")&&s("rowStart")&&!o&&a.push({rect:{x:t.x-n/2,y:t.y-n/2,width:n,height:n,referential:"screen"},side:"top-left"}),s("colEnd")&&s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width-n/2,y:t.y-n/2,width:n,height:n,referential:"screen"},side:"top-right"}),s("colStart")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x-n/2,y:t.y+t.height-n/2,width:n,height:n,referential:"screen"},side:"bottom-left"}),s("colEnd")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width-n/2,y:t.y+t.height-n/2,width:n,height:n,referential:"screen"},side:"bottom-right"}),s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width/2-i/2,y:t.y-n/2,width:i,height:n,referential:"screen"},side:"top"}),s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width/2-i/2,y:t.y+t.height-n/2,width:i,height:n,referential:"screen"},side:"bottom"}),a}const Fr=e=>({type:"copyAndPaste",selectedWidgets:e});function Hr(e,t){return e.setData("text/plain",JSON.stringify(Fr(t))),!0}function Ur(e,t,s){const o=e.getData("text/plain");try{const a=o&&JSON.parse(o);if(!(a&&"type"in a&&a.type==="copyAndPaste"&&"selectedWidgets"in a&&Array.isArray(a.selectedWidgets)))return!1;const n=sa(t,a.selectedWidgets);return s.operationQueue.execute({name:"paste",operations:n,selection:t.selectedWidgets}),!0}catch{return!1}}class zr{constructor(t){ce(this,"event");this.event=t}setData(t,s){var o;(o=this.event.clipboardData)==null||o.setData(t,s)}getData(t){var s,o;return(o=(s=this.event.clipboardData)==null?void 0:s.getData(t))!=null?o:null}getTransferItems(){var t,s;return Object.values((s=(t=this.event.clipboardData)==null?void 0:t.items)!=null?s:[]).map(Vr)}}class Kr{constructor(t){ce(this,"item");this.item=t}get type(){return this.item.type}getAsString(){return new Promise(t=>this.item.getAsString(s=>t(s)))}getJSONValue(){return this.getAsString().then(t=>{try{return t?JSON.parse(t):null}catch{return null}})}getAsFile(){return this.item.getAsFile()}}function Vr(e){return new Kr(e)}function jt(e){return new zr(e)}const jr={class:"dash-layout-editor"},Zr=Q({__name:"DashLayoutEditor",props:{dash:null,params:null,dashPlayerState:null,workspace:null},emits:["navigate","change-preview","create-variable"],setup(e,{emit:t}){const s=e,o=()=>L.updateVersion(),a=G(null),i=G(null),n=r=>t("navigate",r),c=r=>t("create-variable",r),h=r=>t("change-preview",r),l=()=>{var r;return(r=O)==null?void 0:r.correct()},f=r=>{if(!O)return;const d={x:r.pageX,y:r.pageY,referential:"screen"},y=O.screenPoint2world(d);if(m.value.state==="PANNING"){const T={dx:-r.movementX,dy:-r.movementY},W=O.screenDelta2world({dx:T.dx,dy:T.dy,referential:"screen"});O.translate(W),r.preventDefault(),r.stopPropagation();return}m.value.state==="MOVING"&&(m.value.mousePos=y,m.value.duplicating=nt(r)),m.value.state==="MOVING_SLOTTABLE"&&(m.value.mousePos=y),m.value.state==="JUST_CLICKED"&&Nt(m.value.pos,y)*O.zoom>5&&(b.has(m.value.widgetId)||(ue(r)?b.addToSelectedWidgets(m.value.widgetId):(b.resetSelection(),b.addToSelectedWidgets(m.value.widgetId))),m.value={state:"MOVING",initialMousePos:m.value.pos,mousePos:y,duplicating:nt(r)}),m.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&Nt(m.value.mousePos,y)*O.zoom>5&&(m.value={state:"MOVING_SLOTTABLE",initialMousePos:O.screenPoint2world(m.value.mousePos),mousePos:y,slottableId:m.value.slottableId}),m.value.state==="SELECTING"&&(m.value.mousePos=d),m.value.state==="RESIZING"&&(m.value.mousePos=d),m.value.state==="SLOTTABLE_RESIZING"&&(m.value.mousePos=d),Rt(d)},v=r=>{Ar(r==null?void 0:r.target)||Hr(jt(r),b.selectedWidgets)&&r.preventDefault()},p=r=>{Ur(jt(r),Z(),L)&&r.preventDefault()},u=vt({active:!1,hoverZoomBar:!1}),P=()=>{u.hoverZoomBar=!0},I=()=>{u.hoverZoomBar=!1},$=G(null),L=Pt.create(J.exports.cloneDeep(s.dash.layout),re);he(s.dash.layout,()=>{L.setLayout(s.dash.layout)});const ie=F(()=>re.isPreview),ze=F(()=>Object.keys(s.dash.rootSlot).reduce((r,d)=>{const y=s.dash.rootSlot[d];return y.position&&(r[d]=y),r},{}));let me=null;const Ke=J.exports.throttle(()=>{J.exports.isEqual(s.dash.rootSlot,me)||(me=J.exports.cloneDeep(s.dash.rootSlot),is())},500),Ce=()=>{L.onSave(async()=>{!s.workspace||(s.dash.layout=L.layout,s.dashPlayerState.updateDashData(s.dash.makeRunnerData(s.workspace)),Ke())})};Ce(),he(L,Ce);const Ve=F(()=>Object.keys(L.widgets).reduce((r,d)=>{var V,oe,ae;const y=(V=s.dashPlayerState.computedErrors.props)==null?void 0:V[d],T=(oe=s.dashPlayerState.computedErrors.variables)==null?void 0:oe[d],W=(ae=s.dashPlayerState.computedErrors.widgets)==null?void 0:ae[d];return!y&&!T&&!W||!Object.keys({...y,...T,...W}).length?r:r?[...r,d]:[d]},[])),je=F(()=>{var r,d,y,T,W,V;return{props:(d=s.dashPlayerState.computedErrors.props)==null?void 0:d[(r=b.selectedSlottableId)!=null?r:b.selectedWidgetId],widget:(T=s.dashPlayerState.computedErrors.widgets)==null?void 0:T[(y=b.selectedSlottableId)!=null?y:b.selectedWidgetId],variable:(V=s.dashPlayerState.computedErrors.variables)==null?void 0:V[(W=b.selectedSlottableId)!=null?W:b.selectedWidgetId]}});function Ze(r,d){if(!O)return;const y=O.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});b.resetSelection(),d in be?m.value={state:"DRAGGING_SLOTTABLE",...y,type:d}:m.value={state:"DRAGGING",...y,type:d}}const m=G({state:"IDLE"});let M={state:"NONE"};const Y=F(()=>(rt.setDashRunnerData(s.dashPlayerState.navbarVisible,s.dashPlayerState.hasSidebar),rt));he(Y,()=>{var r;return(r=O)==null?void 0:r.updateGrid(Y.value)});const X=G(null),Pe=G(null),w=G(null),S=G(null);function R(){var T,W;const r=Pe.value,d=S.value;if(!r)throw new Error(`canvas = ${r}`);if(!d)throw new Error(`editor = ${d}`);O.setProjectedCanvas(r),O.correct(),d.addEventListener("wheel",N),r.addEventListener("mousedown",D),r.addEventListener("drop",Lt),r.addEventListener("dragover",ls),(T=r.parentElement)==null||T.addEventListener("keydown",ws),(W=r.parentElement)==null||W.addEventListener("keyup",_s);const y=r.getContext("2d");if(!y)throw new Error(`I can't get no context 2d ${r}`);$.value=Js.create(r),Qe(y)}function N(r){if(!O)return;const d={x:r.pageX,y:r.pageY,referential:"screen"};if(Re(r)||Eo(r))O.zoomIn(Math.exp(-Math.sign(r.deltaY)*.05),d),r.preventDefault();else{const y=ue(r)?{dx:r.deltaY,dy:0}:{dx:r.deltaX,dy:r.deltaY},T=O.screenDelta2world({dx:y.dx,dy:y.dy,referential:"screen"});O.translate(T)}r.stopPropagation()}function K(r){var d;Le.overrideProps(r,{condition:!((d=Le.props)!=null&&d[r].condition)})}function D(r){var T;if(!O)return;const d={x:r.pageX,y:r.pageY,referential:"screen"};if(r.button==1||r.button==0&&Po.isPressed("space")){m.value={state:"PANNING",initialMousePos:d,mousePos:d};return}const y=O.screenPoint2world(d);M.state==="HOVERING_WIDGET"?m.value={state:"JUST_CLICKED",pos:y,widgetId:M.widgetId}:M.state==="HOVERING_RESIZE_HANDLER"?m.value={state:"RESIZING",side:M.side,initialMousePos:d,mousePos:d,type:(T=b.selectedWidget)==null?void 0:T.type}:M.state==="HOVERING_TOGGLE"?m.value={state:"JUST_CLICKED_TOGGLE",mousePos:d,slottable:M.slottable}:M.state==="HOVERING_SLOTTABLE_RESIZE_HANDLER"?m.value={state:"SLOTTABLE_RESIZING",initialMousePos:d,mousePos:d,slottableId:M.slottableId,side:"bottom"}:M.state==="HOVERING_SLOTTABLE_SELECTOR"?m.value={state:"JUST_CLICKED_SLOTTABLE_SELECTOR",slottableId:M.slottableId,mousePos:d}:(ue(r)||b.resetSelection(),m.value={state:"SELECTING",initialMousePos:d,mousePos:d})}const Z=()=>{var r;return{mouseState:m.value,grid:Y.value,camera:O,workingLayout:L,hoverState:M,resizeHandlerRects:Ot(),widgetsInRectangularSelection:qe(),selectedWidgets:new Set(b.selectedWidgetsIds),dash:s.dash,calculatedPositions:Ct(s.dashPlayerState.runnerData.layout.slot,(r=Le.props)!=null?r:{},Y.value),selectedSlottable:b.selectedSlottableId}},Je=()=>{var W,V,oe,ae,Ie,Oe,Ae,Dt,Tt,kt;const r=O.screenRect2world(O.canvasRect),d=O.screenDelta2world({dx:8,dy:8,referential:"screen"}),y=O.screenRect2world({x:(W=i.value)==null?void 0:W.$el.getBoundingClientRect().x,y:(V=i.value)==null?void 0:V.$el.getBoundingClientRect().y,width:(oe=i.value)==null?void 0:oe.$el.getBoundingClientRect().width,height:(ae=i.value)==null?void 0:ae.$el.getBoundingClientRect().height,referential:"screen"});Xe({origin:{x:Math.min(Y.value.width+d.dx,r.x+r.width-y.width-d.dx),y:Math.max(r.y+d.dy,0),referential:"world"},element:(Ie=i==null?void 0:i.value)==null?void 0:Ie.$el,ignoreZoom:!0});const T=O.screenRect2world({x:(Oe=X.value)==null?void 0:Oe.$el.getBoundingClientRect().x,y:(Ae=X.value)==null?void 0:Ae.$el.getBoundingClientRect().y,width:(Dt=X.value)==null?void 0:Dt.$el.getBoundingClientRect().width,height:(Tt=X.value)==null?void 0:Tt.$el.getBoundingClientRect().height,referential:"screen"});Xe({origin:{x:0,y:-T.height-d.dy,referential:"world"},element:(kt=X==null?void 0:X.value)==null?void 0:kt.$el,ignoreZoom:!0})},is=()=>{var r;(r=s.dashPlayerState.broker)==null||r.send({type:"widgets-changed",state:s.dashPlayerState.apiPageState,dashDefinition:{slot:s.dash.rootSlot}})},le=G(null);function Qe(r){var V,oe,ae,Ie,Oe,Ae;if(!O||!s.workspace)return;Xe({origin:{x:0,y:0,referential:"world"},element:(V=a==null?void 0:a.value)==null?void 0:V.$el}),Je();const d=r.canvas.getBoundingClientRect();if(r.canvas.width=r.canvas.offsetWidth,r.canvas.height=r.canvas.offsetHeight,r.clearRect(0,0,r.canvas.width,r.canvas.height),r.translate(-d.x,-d.y),r.canvas.style.cursor=(ae=(oe=$.value)==null?void 0:oe.cursor(m.value,M))!=null?ae:"default",!$.value){requestAnimationFrame(()=>Qe(r));return}const y=Z(),T=ea(y);(!J.exports.isEqual(T.operations,(Ie=le.value)==null?void 0:Ie.operations)||!J.exports.isEqual(T.layout,(Oe=le.value)==null?void 0:Oe.layout))&&(le.value=T,s.dashPlayerState.updateRunnerData(s.dash.makeRunnerData(s.workspace,le.value.layout))),le.value&&$.value.render({...y,computedState:le.value,isPreview:re.isPreview,calculatedPositions:Ct(s.dash.makeRunnerData(s.workspace,le.value.layout).layout.slot,(Ae=Le.props)!=null?Ae:{},Y.value)}),requestAnimationFrame(()=>Qe(r))}s.dashPlayerState.onWidgetsComputedMessage(r=>{var T;const d=Object.keys(s.dashPlayerState.runnerData.layout.slot),y=Object.keys((T=r.props)!=null?T:{});ao(d,y)}),Jt(()=>{o(),me=J.exports.cloneDeep(ro(ze.value,ne)),Le.setInitialEditProps(s.dash.rootSlot),b.setLayoutModel(L),addEventListener("resize",l),addEventListener("copy",v),addEventListener("paste",p),addEventListener("mousemove",f),mt(()=>{R()})}),gt(()=>{removeEventListener("resize",l),removeEventListener("copy",v),removeEventListener("paste",p),removeEventListener("mousemove",f),js()});function ls(r){if(!O)return;r.preventDefault();const d=O.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});m.value={...m.value,...d}}const cs=()=>{m.value.state==="IDLE"&&b.resetSelection(),At({referential:"screen",x:0,y:0})},It=()=>{b.selectedSlottableId?L.delete([b.selectedSlottableId]):L.delete(b.selectedWidgetsIds),b.resetSelection()},us=r=>{if(Re(r)&&ue(r)){r.preventDefault(),r.stopPropagation();const d=L.redo();if(d){if(d.operations.some(y=>y.op==="remove")){b.resetSelection();return}b.selectedWidgetsIds=[...new Set(d.selection)]}return}else if(Re(r)){r.preventDefault(),r.stopPropagation();const d=L.undo();if(d){if(d.operations.some(y=>y.op==="remove")){b.resetSelection();return}b.selectedWidgetsIds=[...new Set(d.selection)]}return}},xe=(r,d)=>{const[y,T]={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}[d],W=ta(r,y,T);L.operationQueue.execute({name:`move ${d}`,operations:W,selection:r.selectedWidgets})},ds=()=>{xe(Z(),"up")},ps=()=>{xe(Z(),"down")},hs=()=>{xe(Z(),"left")},fs=()=>{xe(Z(),"right")},vs=r=>{Re(r)&&(r.preventDefault(),r.stopPropagation(),b.selectAll())};he(()=>s.dashPlayerState.authenticating,r=>{r&&(re.isPreview=!0)});const gs=r=>{ue(r)&&h(!re.isPreview)},ms=()=>{m.value.state!=="PANNING"&&(m.value.state="START_PANNING")},ys=r=>({escape:()=>cs(),backspace:()=>It(),delete:()=>It(),z:()=>us(r),arrowup:()=>ds(),arrowdown:()=>ps(),arrowleft:()=>hs(),arrowright:()=>fs(),a:()=>vs(r),p:()=>gs(r),space:()=>ms()}),ws=r=>{var d,y;return(y=(d=ys(r))[r.key.toLowerCase().trim()?r.key.toLowerCase():r.code.toLowerCase()])==null?void 0:y.call(d)},_s=()=>{m.value.state="IDLE"};function Ss(){if(m.value.state!=="SELECTING")return null;const{x:r,y:d}=m.value.initialMousePos,{x:y,y:T}=m.value.mousePos;return{x:Math.min(r,y),y:Math.min(d,T),width:Math.abs(r-y),height:Math.abs(d-T),referential:"screen"}}function qe(){if(!O)throw new Error("No camera value yet");const r=Ss();return r?new Set(Object.keys(s.dashPlayerState.widgets).filter(d=>Qs(O.worldRect2screen(Ee(s.dashPlayerState.getWidgetPosition(d),Y.value)),r))):new Set}function Es(){return b.selectedWidgetsIds.every(r=>Object.keys(s.dashPlayerState.widgets).includes(r))}const bs=()=>Qt(Object.entries(s.dashPlayerState.widgets).filter(([r])=>b.has(r)).map(([r,d])=>Ee(d.position,Y.value)));function Ot(){if(!O)throw new Error("No camera value yet");const r=bs();return!r||!Es()?[]:Gr(b.selectedWidgets,O.worldRect2screen(r))}function At(r){m.value={state:"IDLE"},Rt(r)}const Ps=r=>{m.value=m.value,ue(r)?qe().forEach(d=>{b.toggleWidgetSelection(d)}):(b.resetSelection(),qe().forEach(d=>{b.addToSelectedWidgets(d)}))};function Lt(r){var y;(y=le.value)!=null&&y.operations.length&&L.operationQueue.execute({name:"mouse up",operations:le.value.operations,selection:new Set(b.selectedWidgetsIds)}),m.value.state==="SELECTING"&&Ps(r),m.value.state==="JUST_CLICKED"&&(ue(r)?b.toggleWidgetSelection(m.value.widgetId):(b.clearWidgetSelection(),b.selectedSlottableId=null,b.addToSelectedWidgets(m.value.widgetId))),m.value.state==="JUST_CLICKED_TOGGLE"&&K(m.value.slottable),m.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&(b.selectedSlottableId=m.value.slottableId);const d={x:r.pageX,y:r.pageY,referential:"screen"};At(d)}addEventListener("mouseup",Lt);const Is=r=>{for(const d of Ot())if(xt(r,d.rect)){M={state:"HOVERING_RESIZE_HANDLER",side:d.side};return}},Os=r=>{var y;const d=(y=Object.keys(s.dashPlayerState.widgets).find(T=>xt(O.screenPoint2world(r),Ee(s.dashPlayerState.getWidgetPosition(T),Y.value))))!=null?y:null;d?M={state:"HOVERING_WIDGET",widgetId:d}:M={state:"NONE"}},As=r=>{const d=Ye.getToggleUnderCursor(r);d&&(M={state:"HOVERING_TOGGLE",slottable:d.id})},Ls=r=>{const d=Ye.getSelectorUnderCursor(r);d&&(M={state:"HOVERING_SLOTTABLE_SELECTOR",slottableId:d.id})},Rs=r=>{const d=Ye.getResizerUnderCursor(r);d&&(M={state:"HOVERING_SLOTTABLE_RESIZE_HANDLER",slottableId:d.id})};function Rt(r){!O||(Os(r),Is(r),As(r),Ls(r),Rs(r))}const Xe=r=>{const{origin:d,element:y,ignoreZoom:T}=r;if(!O||!y||!y.style)return;const W=O.worldPoint2screen(d),V=Pe.value.getBoundingClientRect(),oe=[`translate(${W.x-V.x}px, ${W.y-V.y}px)`,T?null:`scale(${O.zoom})`].filter(ae=>ae).join(" ");Object.assign(y.style,{transform:oe,transformOrigin:"top left"})};return(r,d)=>(E(),A("div",jr,[Ne(k(Mr,{onDragstart:Ze},null,512),[[ft,!g(ie)]]),_("div",{ref_key:"editor",ref:w,class:ve(["editor"])},[_("div",{ref_key:"listeners",ref:S,class:"listeners",tabindex:"0"},[k(Zs,{ref_key:"player",ref:a,class:ve(["player",{preview:g(re).isPreview}]),style:{top:0,left:0,height:"unset"},"is-preview":!0,params:e.params,camera:g(O),"editing-mode":!g(re).isPreview,"force-responsivity":"desktop","widgets-with-errors":g(Ve),"dash-player-state":e.dashPlayerState,onNavigate:n},null,8,["class","params","camera","editing-mode","widgets-with-errors","dash-player-state"]),_("canvas",{ref_key:"canvas",ref:Pe,class:ve(["layout-canvas",{hide:g(ie)}])},null,2)],512),k(Or,{ref_key:"runtimeHeader",ref:X,title:e.dashPlayerState.runnerData.title,path:e.dashPlayerState.runnerData.path},null,8,["title","path"]),k(Sr,{ref_key:"interactMenu",ref:i,class:"interact-menu","is-preview":g(re).isPreview,onChangePreview:h},null,8,["is-preview"])],512),(g(b).selectedWidgetsIds.length>0||g(b).selectedSlottableId)&&!g(re).isPreview&&m.value.state==="IDLE"?(E(),fe(fr,{key:0,"selected-widget-errors":g(je),"layout-model":g(L),"selected-widgets":g(b).selectedSlottable?[g(b).selectedSlottable]:g(b).selectedWidgets,"dash-player-state":e.dashPlayerState,onClose:d[0]||(d[0]=y=>g(b).clearWidgetSelection()),onCreateVariable:c},null,8,["selected-widget-errors","layout-model","selected-widgets","dash-player-state"])):j("",!0),k(na,{camera:g(O),class:"zoom-bar",onHover:P,onLeave:I},null,8,["camera"])]))}});const Jr=q(Zr,[["__scopeId","data-v-fa95dc62"]]),Qr={class:"dash-editor"},qr=Q({__name:"DashEditor",setup(e){const t=Hs(),s=Us(),{result:o}=Wt(()=>ho.get()),a=({id:u,type:P})=>{P==="dash"?(t.push({name:"dashEditor",params:{dashId:u},query:s.query}),c()):t.push({name:"editor",params:{formId:u},query:s.query})},{loading:i,result:n,refetch:c}=Wt(()=>po.get(s.params.dashPath)),h=u=>{re.isPreview=u},l=u=>{var P;return(P=n.value)==null?void 0:P.addVariableToCode(u)};let f=Fs(null);const v=()=>{var u;if(!(!n.value||!o.value)){if(n.value.path===((u=f.value)==null?void 0:u.runnerData.path)){f.value.updateDashData(n.value.makeRunnerData(o.value));return}f.value=Mt.create(n.value.makeRunnerData(o.value),!0),f.value.onRedirect(({url:P,queryParams:I})=>ks(t,P,I))}},p=()=>{var u;!f.value||(u=f.value)==null||u.resetState()};return he([n,o],v),gt(()=>{var u;!n.value||!o.value||Mt.delete((u=n.value)==null?void 0:u.makeRunnerData(o.value).idOrPath)}),(u,P)=>{var I;return E(),A("div",Qr,[g(i)||!g(n)||!g(o)?(E(),fe(eo,{key:0,class:"loading",justify:"center"})):(E(),fe($s,{key:1},{left:ye(()=>[k(Ns,{link:"/_editor/dashes"})]),right:ye(()=>[k(vo,{model:g(n)},null,8,["model"]),k(fo,{model:g(n)},null,8,["model"])]),default:ye(()=>[k($t,{title:"Layout editor"},{default:ye(()=>[g(f)?(E(),fe(Jr,{key:0,workspace:g(o),dash:g(n),"dash-player-state":g(f),params:g(s).query,onNavigate:a,onChangePreview:h,onCreateVariable:l},null,8,["workspace","dash","dash-player-state","params"])):j("",!0)]),_:1}),k($t,{title:"Settings"},{default:ye(()=>[k(So,{dash:g(n)},null,8,["dash"])]),_:1})]),_:1})),g(n)?(E(),fe(Xs,{key:2,"dash-player-state":g(f)||void 0,runtime:"dashes",onRestart:p},null,8,["dash-player-state"])):j("",!0),k(Ys,{"has-changes":(I=g(n))==null?void 0:I.hasChanges()},null,8,["has-changes"])])}}});const In=q(qr,[["__scopeId","data-v-25844b62"]]);export{In as default};
//# sourceMappingURL=DashEditor.a82b84d4.js.map

import{d as C,r as D,eB as I,eA as j,u as e,b as i,c as d,w as a,f as u,aA as r,b$ as s,cF as x,ew as P,cp as E,t as R}from"./outputWidgets.427e9347.js";import{W as S}from"./workspaces.4100d442.js";import{l as p}from"./DocsButton.vue_vue_type_script_setup_true_lang.09beac58.js";import{p as U}from"./popupNotifcation.ad1f6d90.js";import{a as M}from"./asyncComputed.32abd7c2.js";import{S as N}from"./index.8dcb7ead.js";import"./index.72b0f783.js";import{M as h}from"./transButton.470f2fe6.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new Error().stack;l&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[l]="cddf8c41-2d8c-49ae-a393-c07da43a3f7b",n._sentryDebugIdIdentifier="sentry-dbid-cddf8c41-2d8c-49ae-a393-c07da43a3f7b")}catch{}})();const V=C({__name:"LoginBlock",setup(n){var m;const l="https://cloud.abstra.io/api-key?"+new URLSearchParams({redirect:location.href}),c=D(!1),f=(m=N.instance)==null?void 0:m.deployEnabled,{loading:y,result:t,refetch:g}=M(()=>p.get()),k=I(),w=j();function v(){const o=new URL(location.href);o.searchParams.delete("api-key"),w.replace(o.pathname+o.search)}function L(){var o;(o=t.value)!=null&&o.logged?h.success({title:"You're logged in!",content:"You can now deploy your project to Abstra Cloud."}):h.error({title:"Login failed",content:"Please try again. If the problem persists, contact help@abstra.io."})}const _=k.query["api-key"];typeof _=="string"&&p.create(_).then(g).then(v).then(L);async function A(){!t.value||(await p.delete(),g())}async function B(){if(!!t.value){c.value=!0;try{await S.deploy(),window.open(`https://cloud.abstra.io/projects/${t.value.logged&&t.value.project_id}/builds`,"_blank")}catch(o){U("Deploy failed",String(o))}c.value=!1}}return(o,$)=>{var b;return(b=e(t))!=null&&b.logged?(i(),d(e(E),{key:0},{default:a(()=>[u(e(s),{href:`https://cloud.abstra.io/projects/${e(t).project_id}`,target:"_blank"},{default:a(()=>[r(" Go to console ")]),_:1},8,["href"]),!c.value&&e(f)?(i(),d(e(x),{key:0,title:"Are you sure you want to deploy this project to Abstra Cloud?",onConfirm:B},{default:a(()=>[u(e(s),null,{default:a(()=>[r("Deploy")]),_:1})]),_:1})):e(f)?(i(),d(e(s),{key:1,loading:""},{default:a(()=>[r("Deploying")]),_:1})):P("",!0),u(e(s),{onClick:A},{default:a(()=>[r("Logout")]),_:1})]),_:1})):(i(),d(e(s),{key:1,href:l,loading:e(y),disabled:e(y)},{default:a(()=>[r(" Login to deploy ")]),_:1},8,["loading","disabled"]))}}});const H=R(V,[["__scopeId","data-v-7b8037ee"]]);export{H as L};
//# sourceMappingURL=LoginBlock.3d3b004b.js.map

var nt=Object.defineProperty;var lt=(o,e,n)=>e in o?nt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var Ae=(o,e,n)=>(lt(o,typeof e!="symbol"?e+"":e,n),n);import{g as it,W as rt,w as ut}from"./controller.2db4c609.js";import{o as ie,u as dt}from"./omniChatStore.8c7a1b50.js";import{a as Me}from"./asyncComputed.f72493ac.js";import{d as L,af as G,g as x,o as a,K as w,O as N,F as M,e5 as he,a as A,e as ct,f as z,b as d,w as u,u as t,aL as R,ea as ce,c as b,da as J,d5 as K,az as T,eb as U,d3 as Oe,eh as W,cH as pt,bM as De,Q as oe,h as ke,bu as Se,aP as Re,ec as ze,N as Q,J as we,a8 as Ve,bE as ge,cs as me,cr as Xe,cE as gt,ex as ft,B as re,ei as Ye,bs as vt,bq as je,bK as mt,au as Ie,e3 as yt,d2 as ht,bH as kt,eL as wt,eM as _t,el as bt,aj as $t,em as Ct,en as At}from"./index.ae34ab5b.js";import{u as q,P as St,_ as It,a as Mt,b as xt,g as We,c as pe,N as Et,d as Dt,M as zt,e as Vt}from"./vue-flow-core.7086529e.js";import"./linters.bc192205.js";import{W as ve}from"./workspaces.cfcd0fb5.js";import{U as Ft,G as Ht}from"./UnsavedChangesHandler.b1bbff22.js";import{w as ye,s as Bt}from"./metadata.e352a10a.js";import{A as Tt}from"./index.b81f7e41.js";import{A as xe}from"./index.1b797dab.js";import{_ as Pt,a as Lt}from"./vue-flow-minimap.72bf90cb.js";import{G as Nt}from"./PhArrowCounterClockwise.vue.0a80f0e2.js";import{T as jt}from"./TasksManager.4f9dedb7.js";import{a as Ut,b as Zt,n as Ot}from"./validations.7a8826ec.js";import{u as Rt}from"./editor.f1083b84.js";import{n as Xt}from"./string.b59bd4bb.js";import"./index.5db09f04.js";import{A as Yt}from"./index.104ede33.js";import{t as Ge}from"./index.2a33e79d.js";import{B as Wt}from"./Badge.8aa321b5.js";import{G as Ue}from"./PhArrowDown.vue.2e1b37f9.js";import"./uuid.fe0e9a97.js";import"./record.3c2a179d.js";import"./runnerData.8903f846.js";import"./url.74f38507.js";import"./colorHelpers.9f4f61d8.js";import"./ExclamationCircleOutlined.72d27415.js";import"./PhWebhooksLogo.vue.f7c6d22a.js";import"./tasksController.0f5089df.js";import"./gateway.763dcf0e.js";import"./popupNotifcation.b45a43b0.js";import"./scripts.3799ba93.js";import"./polling.f555f21e.js";import"./ant-design.e59497d6.js";import"./PhArrowSquareOut.vue.a872d7f1.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.02e4ec55.js";import"./Card.3802054f.js";import"./TabPane.ea046ec2.js";import"./CollapsePanel.a474dd82.js";import"./userStore.e3945bab.js";import"./workspaceStore.c5a46e02.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="826bac0f-77ff-4af6-95fa-b194b2509a0b",o._sentryDebugIdIdentifier="sentry-dbid-826bac0f-77ff-4af6-95fa-b194b2509a0b")}catch{}})();const Gt=["width","height","fill","transform"],qt={key:0},Kt=A("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Jt=[Kt],Qt={key:1},ea=A("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),ta=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),aa=[ea,ta],oa={key:2},sa=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),na=[sa],la={key:3},ia=A("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),ra=[ia],ua={key:4},da=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ca=[da],pa={key:5},ga=A("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),fa=[ga],va={name:"PhArrowClockwise"},ma=L({...va,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(o){const e=o,n=G("weight","regular"),s=G("size","1em"),r=G("color","currentColor"),y=G("mirrored",!1),c=x(()=>{var i;return(i=e.weight)!=null?i:n}),h=x(()=>{var i;return(i=e.size)!=null?i:s}),_=x(()=>{var i;return(i=e.color)!=null?i:r}),v=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(i,p)=>(a(),w("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:_.value,transform:v.value},i.$attrs),[N(i.$slots,"default"),c.value==="bold"?(a(),w("g",qt,Jt)):c.value==="duotone"?(a(),w("g",Qt,aa)):c.value==="fill"?(a(),w("g",oa,na)):c.value==="light"?(a(),w("g",la,ra)):c.value==="regular"?(a(),w("g",ua,ca)):c.value==="thin"?(a(),w("g",pa,fa)):M("",!0)],16,Gt))}}),ya=["width","height","fill","transform"],ha={key:0},ka=A("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),wa=[ka],_a={key:1},ba=A("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),$a=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ca=[ba,$a],Aa={key:2},Sa=A("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),Ia=[Sa],Ma={key:3},xa=A("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Ea=[xa],Da={key:4},za=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Va=[za],Fa={key:5},Ha=A("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Ba=[Ha],Ta={name:"PhFunnel"},Pa=L({...Ta,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(o){const e=o,n=G("weight","regular"),s=G("size","1em"),r=G("color","currentColor"),y=G("mirrored",!1),c=x(()=>{var i;return(i=e.weight)!=null?i:n}),h=x(()=>{var i;return(i=e.size)!=null?i:s}),_=x(()=>{var i;return(i=e.color)!=null?i:r}),v=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(i,p)=>(a(),w("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:_.value,transform:v.value},i.$attrs),[N(i.$slots,"default"),c.value==="bold"?(a(),w("g",ha,wa)):c.value==="duotone"?(a(),w("g",_a,Ca)):c.value==="fill"?(a(),w("g",Aa,Ia)):c.value==="light"?(a(),w("g",Ma,Ea)):c.value==="regular"?(a(),w("g",Da,Va)):c.value==="thin"?(a(),w("g",Fa,Ba)):M("",!0)],16,ya))}});class qe{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const Y=o=>qe.isMac?o.metaKey:o.ctrlKey,La=o=>o.shiftKey;class Na{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const Ze=new Na;class _e{constructor(e){this.dto=e}static async listConnections(){return(await Ze.listConnections()).map(n=>new _e(n))}static async getIsUsageMode(){return await Ze.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const Ke=ct("agents-usage-mode",()=>{const o=z(!1);return(async()=>{o.value=await _e.getIsUsageMode()})(),{agentUsageMode:o}}),ja=["onDragstart"],Ua={style:{display:"flex","flex-direction":"column","max-width":"250px"}},Za=L({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(o,{emit:e}){const n=Ke(),s=x(()=>n.agentUsageMode?ye.stages:ye.stages.filter(r=>!["agents","clients"].includes(r.typeName)));return(r,y)=>(a(),w(R,null,[d(t(J),{class:"toolbar",align:"center"},{default:u(()=>[(a(!0),w(R,null,ce(s.value,c=>(a(),b(t(pt),{key:c.key,placement:"top"},{title:u(()=>[d(t(J),{gap:"small"},{default:u(()=>[d(t(K),null,{default:u(()=>[T(U(c.title),1)]),_:2},1024),d(t(K),{keyboard:""},{default:u(()=>[T(U(c.key),1)]),_:2},1024)]),_:2},1024)]),content:u(()=>[A("div",Ua,[d(t(K),null,{default:u(()=>[T(U(c.description),1)]),_:2},1024),c.beta?(a(),b(t(xe),{key:0,type:"warning",class:"beta-alert"},{description:u(()=>[d(t(K),null,{default:u(()=>[T(" This is a beta feature, "),d(t(Oe),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:u(()=>[T(" click here ")]),_:1}),T(" to learn more about it ")]),_:1})]),_:1})):M("",!0)])]),default:u(()=>[A("div",{draggable:!0,class:"toolbar__item",onDragstart:h=>e("drag-start",h.dataTransfer,c.typeName)},[(a(),b(W(c.icon),{size:18}))],40,ja)]),_:2},1024))),128)),d(t(Tt),{type:"vertical"}),d(t(De),{disabled:!r.controller.hasChanges(),onClick:y[0]||(y[0]=c=>r.controller.save())},{default:u(()=>[d(t(J),{align:"center",gap:"small"},{default:u(()=>[d(t(Ht),{size:16}),T(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),d(Ft,{"has-changes":r.controller.hasChanges()},null,8,["has-changes"])],64))}});const Oa=oe(Za,[["__scopeId","data-v-d855dff0"]]);function Je(){let o;const e={draggedType:z(null),isDragOver:z(!1),isAdding:z(!1),isDragging:z(!1),mousePosition:z(null)},{draggedType:n,isDragOver:s,isDragging:r,isAdding:y}=e,c=C=>{o=C,document.addEventListener("mousemove",E)},{screenToFlowCoordinate:h}=q();ke(y,C=>{document.body.style.userSelect=C?"none":""});function _(C,H){y.value=!0,C?(C.setData("application/vueflow",H),C.effectAllowed="move",n.value=H,r.value=!0,document.addEventListener("drop",p)):(n.value=H,document.addEventListener("click",k))}function v(C){C.preventDefault(),n.value&&(s.value=!0,C.dataTransfer&&(C.dataTransfer.dropEffect="move"))}function i(){s.value=!1}function p(){y.value=!1,r.value=!1,s.value=!1,n.value=null,document.removeEventListener("drop",p)}function E(C){const H={x:C.pageX-200,y:C.pageY-80};e.mousePosition.value=H}function g(C){if(!n.value)throw new Error("No dragged type");return h({x:C.clientX-70,y:C.clientY-25})}function k(C){if(!o)return;if(!n.value)throw new Error("No dragged type");const H=g(C);o.addStages([{type:n.value,position:H}]),p()}function I(){document.removeEventListener("mousemove",E)}return{init:c,tearDown:I,draggedType:n,isDragOver:s,isAdding:y,isDragging:r,mousePosition:e.mousePosition,onDragStart:_,onDragLeave:i,onDragOver:v,onDrop:k}}const Ra={name:"ControlButton",compatConfig:{MODE:3}},Xa=(o,e)=>{const n=o.__vccOpts||o;for(const[s,r]of e)n[s]=r;return n},Ya={class:"vue-flow__controls-button"};function Wa(o,e,n,s,r,y){return a(),w("button",Ya,[N(o.$slots,"default")])}const de=Xa(Ra,[["render",Wa]]),Ga={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},qa=A("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),Ka=[qa];function Ja(o,e){return a(),w("svg",Ga,Ka)}const Qa={render:Ja},eo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},to=A("path",{d:"M0 0h32v4.2H0z"},null,-1),ao=[to];function oo(o,e){return a(),w("svg",eo,ao)}const so={render:oo},no={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},lo=A("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),io=[lo];function ro(o,e){return a(),w("svg",no,io)}const uo={render:ro},co={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},po=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),go=[po];function fo(o,e){return a(),w("svg",co,go)}const vo={render:fo},mo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},yo=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),ho=[yo];function ko(o,e){return a(),w("svg",mo,ho)}const wo={render:ko},_o={name:"Controls",compatConfig:{MODE:3}},bo=L({..._o,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>St.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(o,{emit:e}){const{nodesDraggable:n,nodesConnectable:s,elementsSelectable:r,setInteractive:y,zoomIn:c,zoomOut:h,fitView:_,viewport:v,minZoom:i,maxZoom:p}=q(),E=Se(()=>n.value||s.value||r.value),g=Se(()=>v.value.zoom<=i.value),k=Se(()=>v.value.zoom>=p.value);function I(){c(),e("zoomIn")}function C(){h(),e("zoomOut")}function H(){_(o.fitViewParams),e("fitView")}function P(){y(!E.value),e("interactionChange",!E.value)}return(S,j)=>(a(),b(t(It),{class:"vue-flow__controls",position:S.position},{default:u(()=>[N(S.$slots,"top"),S.showZoom?(a(),w(R,{key:0},[N(S.$slots,"control-zoom-in",{},()=>[d(de,{class:"vue-flow__controls-zoomin",disabled:k.value,onClick:I},{default:u(()=>[N(S.$slots,"icon-zoom-in",{},()=>[(a(),b(W(t(Qa))))])]),_:3},8,["disabled"])]),N(S.$slots,"control-zoom-out",{},()=>[d(de,{class:"vue-flow__controls-zoomout",disabled:g.value,onClick:C},{default:u(()=>[N(S.$slots,"icon-zoom-out",{},()=>[(a(),b(W(t(so))))])]),_:3},8,["disabled"])])],64)):M("",!0),S.showFitView?N(S.$slots,"control-fit-view",{key:1},()=>[d(de,{class:"vue-flow__controls-fitview",onClick:H},{default:u(()=>[N(S.$slots,"icon-fit-view",{},()=>[(a(),b(W(t(uo))))])]),_:3})]):M("",!0),S.showInteractive?N(S.$slots,"control-interactive",{key:2},()=>[S.showInteractive?(a(),b(de,{key:0,class:"vue-flow__controls-interactive",onClick:P},{default:u(()=>[E.value?N(S.$slots,"icon-unlock",{key:0},()=>[(a(),b(W(t(wo))))]):M("",!0),E.value?M("",!0):N(S.$slots,"icon-lock",{key:1},()=>[(a(),b(W(t(vo))))])]),_:3})):M("",!0)]):M("",!0),N(S.$slots,"default")]),_:3},8,["position"]))}}),$o=L({__name:"ControlButtons",props:{workflow:{}},setup(o){return(e,n)=>(a(),b(t(bo),{position:"top-left","show-interactive":!1},{default:u(()=>[d(t(de),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:n[0]||(n[0]=s=>e.workflow.history.undo())},{default:u(()=>[d(t(Nt))]),_:1},8,["disabled"]),d(t(de),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:n[1]||(n[1]=s=>e.workflow.history.redo())},{default:u(()=>[d(t(ma))]),_:1},8,["disabled"])]),_:1}))}});class Co{constructor(e,n){Ae(this,"dx");Ae(this,"dy");this.dx=n.x-e.x,this.dy=n.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function Ao(o,e,n=0){const{x:s,y:r}=e.center,{width:y,height:c}=e,h=new Co(o,e.center),_=n*(h.x/h.length),v=n*(h.y/h.length),i=c/y;let p,E;if(Math.abs(h.m)>Math.abs(i)){const g=c/2*(1/h.m);p=s-(h.y>0?g:-g),E=r+(h.y>0?-c/2:c/2)}else{const g=y/2*h.m;p=s+(h.x>0?-y/2:y/2),E=r-(h.x>0?g:-g)}return{x:p+_,y:E+v}}const So=(o,e=0,n=0)=>{const s=Math.atan2(o.ty-o.sy,o.tx-o.sx),r=e*Math.sin(s),y=e*Math.cos(s),c=n*Math.cos(s),h=n*Math.sin(s);return{sourceX:o.sx-r+c,sourceY:o.sy+y+h,targetX:o.tx-r-c,targetY:o.ty+y-h}};function Ee(o,e,n=0){const s={x:o.computedPosition.x+o.dimensions.width/2,y:o.computedPosition.y+o.dimensions.height/2},y={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return Ao(s,y,n)}function Qe(o,e){const n=Ee(o,e,-10),s=Ee(e,o,-10);return{sx:s.x,sy:s.y,tx:n.x,ty:n.y}}const Io=L({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(o){return(e,n)=>(a(),b(t(J),{vertical:"",gap:"small",style:Q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:u(()=>[(a(!0),w(R,null,ce(e.menuOptions,s=>(a(),b(t(Re),{key:s.label,title:s.tooltip,placement:"right"},{default:u(()=>[d(t(De),{class:ze([{"warning-button":s.warning}]),disabled:s.disabled,style:Q({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:r=>s.click(r)},{default:u(()=>[d(t(J),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:u(()=>[T(U(s.label)+" ",1),s.key?(a(),b(t(K),{key:0,keyboard:"",disabled:s.disabled},{default:u(()=>[T(U(s.key),1)]),_:2},1032,["disabled"])):M("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const Mo=L({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(o){const e=o,n=[{label:"Edit task type",key:"E",click:()=>r.value="editing"},{label:"Delete",key:"Del",click:()=>E(e.data.id)}],s=z(e.data.props.taskType||""),r=z("idle"),y=()=>{r.value!=="idle"&&(s.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:s.value}),r.value="idle")},{onEdgeClick:c,onPaneClick:h,getSelectedEdges:_}=q();c(g=>{g.edge.id===e.id&&r.value==="idle"&&(r.value="selected")}),h(()=>y());const v=x(()=>Qe(e.sourceNode,e.targetNode)),i=x(()=>We(So(v.value))),p=g=>{!_.value.map(k=>k.id).includes(e.data.id)||(g.key==="Enter"&&y(),(g.key==="e"||g.key==="E")&&(r.value="editing"))},{removeEdges:E}=q();return we(()=>window.addEventListener("keydown",p)),Ve(()=>window.removeEventListener("keydown",p)),(g,k)=>(a(),w(R,null,[d(t(Mt),{path:i.value[0],"marker-end":g.markerEnd},null,8,["path","marker-end"]),d(t(xt),null,{default:u(()=>[r.value==="idle"?(a(),w("div",{key:0,style:Q({transform:`translate(-50%, -50%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(a(),b(t(K),{key:1},{default:u(()=>[T(U(e.data.props.taskType),1)]),_:1})):(a(),b(t(Pa),{key:0,size:16}))],4)):r.value==="selected"?(a(),w("div",{key:1,style:Q({transform:`translate(-50%, -120%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[d(Io,{"is-connecting":!0,"is-editing":!0,"menu-options":n})],4)):r.value==="editing"?(a(),w("div",{key:2,style:Q({transform:`translate(-50%, -50%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[d(t(ge),{value:s.value,"onUpdate:value":k[0]||(k[0]=I=>s.value=I),placeholder:"Task type"},null,8,["value"])],4)):M("",!0)]),_:1})],64))}});const xo=oe(Mo,[["__scopeId","data-v-aceb9f72"]]),Eo={key:0},Do=A("defs",null,[A("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[A("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),zo=["d"],Vo=L({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(o){const e=o,n=z(!0),{onNodeMouseEnter:s,onNodeMouseLeave:r}=q();s(_=>{_.node.id===e.sourceNode.id&&(n.value=!1)}),r(_=>{_.node.id===e.sourceNode.id&&(n.value=!0)});const y=x(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),c=x(()=>Qe(e.sourceNode,y.value)),h=x(()=>We({sourceX:c.value.sx,sourceY:c.value.sy,targetX:c.value.tx,targetY:c.value.ty}));return(_,v)=>n.value?(a(),w("g",Eo,[Do,A("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:h.value[0],"marker-end":"url(#arrowhead)"},null,8,zo)])):M("",!0)}}),Fo=L({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(o,{emit:e}){const n=o,s=x(()=>{const r=Ut(n.filename);return r.valid?n.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:r});return(r,y)=>(a(),b(t(gt),{open:r.creatingFileStatus==="prompting"||r.creatingFileStatus==="creating",closable:!1,"confirm-loading":r.creatingFileStatus==="creating",onOk:y[1]||(y[1]=c=>e("create-file",r.filename)),onCancel:y[2]||(y[2]=c=>e("cancel"))},{default:u(()=>[d(t(Xe),{layout:"vertical",disabled:r.creatingFileStatus=="creating"},{default:u(()=>[d(t(me),{label:"You're creating a new file. What should it be called?","validate-status":s.value.valid?"success":"error",help:s.value.valid?s.value.help:s.value.reason},{default:u(()=>[d(t(ge),{value:r.filename,onChange:y[0]||(y[0]=c=>e("update-filename",c.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),Ho={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},Bo=L({...Ho,props:{nodeId:null,isVisible:{type:Boolean},position:{default:pe.Top},offset:{default:10},align:{default:"center"}},setup(o){const e=o,n=G(Et,null),{viewportRef:s,viewport:r,getSelectedNodes:y,findNode:c}=q();function h(g,k,I,C,H){let P=.5;H==="start"?P=0:H==="end"&&(P=1);let S=[(g.x+g.width*P)*k.zoom+k.x,g.y*k.zoom+k.y-C],j=[-100*P,-100];switch(I){case pe.Right:S=[(g.x+g.width)*k.zoom+k.x+C,(g.y+g.height*P)*k.zoom+k.y],j=[0,-100*P];break;case pe.Bottom:S[1]=(g.y+g.height)*k.zoom+k.y+C,j[1]=0;break;case pe.Left:S=[g.x*k.zoom+k.x-C,(g.y+g.height*P)*k.zoom+k.y],j=[-100,-100*P];break}return`translate(${S[0]}px, ${S[1]}px) translate(${j[0]}%, ${j[1]}%)`}const _=x(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||n||""]).reduce((g,k)=>{const I=c(k);return I&&g.push(I),g},[])),v=x(()=>typeof e.isVisible=="boolean"?e.isVisible:_.value.length===1&&_.value[0].selected&&y.value.length===1),i=x(()=>Dt(_.value)),p=x(()=>Math.max(..._.value.map(g=>(g.computedPosition.z||1)+1))),E=x(()=>({position:"absolute",transform:h(i.value,r.value,e.position,e.offset,e.align),zIndex:p.value}));return(g,k)=>(a(),b(ft,{to:t(s),disabled:!t(s)},[t(v)&&t(_).length?(a(),w("div",he({key:0},g.$attrs,{style:t(E),class:"vue-flow__node-toolbar"}),[N(g.$slots,"default")],16)):M("",!0)],8,["to","disabled"]))}}),To=L({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(o){return(e,n)=>(a(),b(t(Bo),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:t(pe).Right},{default:u(()=>[d(t(J),{vertical:"",gap:"small",style:Q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:u(()=>[(a(!0),w(R,null,ce(e.menuOptions,s=>(a(),b(t(Re),{key:s.label,title:s.tooltip,placement:"right"},{default:u(()=>[d(t(De),{class:ze([{"warning-button":s.warning}]),disabled:s.disabled,style:Q({backgroundColor:s.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:r=>s.click(r)},{default:u(()=>[d(t(J),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:u(()=>[T(U(s.label)+" ",1),s.key?(a(),b(t(K),{key:0,keyboard:"",disabled:s.disabled},{default:u(()=>[T(U(s.key),1)]),_:2},1032,["disabled"])):M("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const Po=L({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(o,{emit:e}){var X;const n=o,s=z(!1),y=Ke().agentUsageMode,c=re.object({title:re.string(),clientStageId:re.string().uuid(),inputSchemas:re.any(),outputSchemas:re.any()});ke(()=>n.stageProps.projectId,()=>{s.value=!0,S()});const h=Rt(),_=()=>{var V;const $=(V=h.cloudProject)==null?void 0:V.id;return $?`https://cloud.abstra.io/projects/${$}/agents`:""},v=re.array(c),i=z((X=n.stageProps.projectId)!=null?X:""),p=z(!1),E=$=>g.loading.value||!g.result.value?null:g.result.value.find(V=>V.agentConnection.id===$),g=Me(async()=>_e.listConnections()),k=x(()=>g.loading.value||!g.result.value?[]:g.result.value.map($=>({label:$.agentConnection.connectionName,key:$.agentConnection.id,value:$.agent.projectId}))),{result:I,loading:C,refetch:H,error:P}=Me(async()=>{const $=n.stageProps.projectId;if(!$)return[];const Z=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${$}`)).json();return v.parse(Z)}),S=Ye.exports.debounce(()=>{s.value=!1,H()},500),j=x(()=>C.value||!I.value?[]:I.value.map($=>({label:$.title,value:$.clientStageId})));function ee($){e("update:stage-props",{...n.stageProps,projectId:$,clientStageId:null})}function se($){const V=E($.key);!V||(ee(V.agent.projectId),i.value=V.agent.projectId,p.value=!1)}function m($){const V=$.target;i.value=V.value,ee(V.value),p.value=!0}function D($){p.value=$}function F($){const V=String($);!I.value||e("update:stage-props",{...n.stageProps,clientStageId:V})}return($,V)=>(a(),w(R,null,[d(t(me),{label:"Project ID"},{default:u(()=>{var Z;return[t(y)?(a(),b(t(mt),{key:0,trigger:"click",visible:p.value,onVisibleChange:D},{overlay:u(()=>[d(t(vt),{onClick:se},{default:u(()=>[(a(!0),w(R,null,ce(k.value,ne=>(a(),b(t(je),{key:ne.key},{default:u(()=>[T(U(ne.label),1)]),_:2},1024))),128)),d(t(je),null,{default:u(()=>[d(t(Oe),{class:"cloud-link",href:_(),target:"_blank"},{default:u(()=>[T(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:u(()=>[d(t(ge),{value:i.value,"onUpdate:value":V[0]||(V[0]=ne=>i.value=ne),autofocus:"","allow-clear":"",onInput:m},null,8,["value"])]),_:1},8,["visible"])):(a(),b(t(ge),{key:1,value:(Z=$.stageProps.projectId)!=null?Z:"",placeholder:"Project ID",autofocus:"","onUpdate:value":ee},null,8,["value"]))]}),_:1}),d(t(me),{label:"Client entrypoint"},{default:u(()=>{var Z;return[s.value||t(C)?(a(),b(t(Ie),{key:0,disabled:"",loading:""})):t(P)?(a(),b(t(xe),{key:1,type:"error",message:"Invalid project id"})):$.stageProps.projectId?t(I).length===0?(a(),b(t(xe),{key:3,type:"warning",message:"The project has no entrypoints"})):(a(),b(t(Ie),{key:4,class:"entrypoint-select",options:j.value,value:(Z=$.stageProps.clientStageId)!=null?Z:void 0,"onUpdate:value":F},null,8,["options","value"])):(a(),b(t(Ie),{key:2,disabled:""}))]}),_:1})],64))}});const Lo=oe(Po,[["__scopeId","data-v-f4d2a34d"]]),No=L({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(o){var Ne;const e=o,{useToken:n}=Ge,{token:s}=n(),r=s.value.colorText,y=[{label:"Add transition",key:"C",click:l=>He(l)},{label:"Rename",key:"R",click:()=>O.value=!0},{label:"Go to editor",key:"Enter",click:()=>Fe()},{label:"Tasks",key:"M",click:()=>h.value=!0},{label:"Delete",key:"Del",click:()=>D(e.stage)}],c=x(()=>{let l=[...y];return _.value||l.unshift({label:"Create missing file",warning:!0,click:()=>P()}),e.controller.hasChanges()&&(l=l.map(f=>f.label==="Go to editor"?{...f,disabled:!0,tooltip:"Save it to allow editing"}:f.label==="Tasks"?{...f,disabled:!0,tooltip:"Save it to allow managing tasks"}:f)),(e.stage.type==="agents"||e.stage.type==="clients")&&(l=l.filter(f=>!["Create missing file","Go to editor","Tasks"].includes(f.label))),e.stage.type==="agents"&&(l=l.map(f=>f.label==="Rename"?{...f,label:"Edit"}:f)),l}),h=z(!1),_=z(!0);ke(()=>e.initialFileCheck,l=>{E.value||(_.value=l)});const v=l=>{k.value=l,g()},i=l=>{e.controller.updateStageProps(e.stage.id,l)},p=()=>{var l;I.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(k.value=(l=e.stage.props.filename)!=null?l:"",g())},E=x(()=>e.controller.getUnsavedFilenameStages().some(l=>l.id===e.stage.id)),g=Ye.exports.debounce(async()=>{if(E.value){_.value=!0;return}const l=k.value;if(!l){_.value=!0;return}ve.checkFile(l).then(f=>{_.value=f.exists})},500),k=z((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Ne=e.stage.props.filename)!=null?Ne:""),I=z("idle"),C=async()=>{I.value="creating",await ve.initFile(k.value,e.stage.type),_.value=!0;const l=await ve.checkFile(k.value);if(_.value=l.exists,I.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:k.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:k.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},H=x(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!_.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),P=()=>{I.value="prompting"},{startConnection:S,updateConnection:j,onNodeClick:ee,addEdges:se,endConnection:m,removeNodes:D,onPaneClick:F,getSelectedNodes:X,flowToScreenCoordinate:$,onNodeMouseEnter:V,onNodeMouseLeave:Z,getNodes:ne,onNodesChange:tt,applyNodeChanges:at}=q(),ot=yt(),te=z(!1),O=z(!1),ae=z(e.stage.title),be=z(!0),fe=x(()=>{const f=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Xt(ae.value,!1,!0)}.py`;return f!==k.value?f:null}),$e=z(!1),Ce=z(!1);tt(async l=>{var B;const f=[];for(const le of l)le.type==="remove"?O.value||((B=e.controller)==null||B.delete([le.id]),f.push(le)):f.push(le);at(f)});const Fe=()=>{const l=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Ce.value?window.open(`/_editor/${l}/${e.stage.id}`,"_blank"):ot.push({path:`/_editor/${l}/${e.stage.id}`})},He=(l,f=!0)=>{S({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:f?l.pageX:l.pageX-90,y:f?l.pageY-50:l.pageY-20}),document.addEventListener("mousemove",Be),te.value=!0},Be=l=>{te.value&&!$e.value&&j({x:l.pageX,y:l.pageY-52})};ee(l=>{if(l.node.id===e.stage.id&&g(),te.value&&l.node.id!==e.stage.id){const f={sourceStageId:e.stage.id,targetStageId:l.node.id,type:"task",id:it(),props:{taskType:null}};try{e.controller.connect([f]),document.removeEventListener("mousemove",Be),se({id:f.id,source:e.stage.id,target:l.node.id,type:"task",markerEnd:{type:zt.Arrow,width:24,height:24},data:f}),m(),te.value=!1}catch(B){console.error(B)}}}),V(l=>{if(te.value&&l.node.id!==e.stage.id){$e.value=!0;const f=ne.value.find(le=>le.id===e.stage.id);if(!f)return;const B=Ee(f,l.node,-10);j($({x:B.x,y:B.y-52}))}}),Z(()=>{$e.value=!1});const st=()=>{if(!_.value){const l=Zt(ae.value+".py");k.value=l;let f={filename:l,path:null};if(["forms","hooks"].includes(e.stage.type)){const B=Ot(ae.value);f={...f,path:B}}e.controller.updateStageProps(e.stage.id,f)}},Te=async()=>{e.stage.title!==ae.value&&(e.controller.updateStageTitle(e.stage.id,ae.value),be.value&&fe.value&&(k.value=fe.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:k.value})),st()),g()};F(()=>{O.value=!1,Te(),te.value=!1,m()});const Pe=l=>{if(Ce.value=Y(l),!!X.value.map(f=>f.id).includes(e.stage.id)&&I.value==="idle"){if(l.key==="Enter")if(O.value)O.value=!1,Te();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;Fe()}if(!O.value){if(l.key==="c"||l.key==="C"){const f=$(e.stage.position);He({pageX:f.x,pageY:f.y},!1)}if((l.key==="r"||l.key==="R")&&(O.value=!0),l.key==="m"||l.key==="M"){if(e.controller.hasChanges())return;h.value=!0}}}},Le=l=>{Ce.value=Y(l)};return we(()=>{E.value||(_.value=e.initialFileCheck),window.addEventListener("keydown",Pe),window.addEventListener("keyup",Le)}),Ve(()=>{window.removeEventListener("keydown",Pe),window.removeEventListener("keyup",Le)}),(l,f)=>(a(),w(R,null,[d(To,{"is-connecting":te.value,"is-editing":O.value,"menu-options":c.value},null,8,["is-connecting","is-editing","menu-options"]),A("div",{class:"stage",onDblclick:f[2]||(f[2]=B=>O.value=!0)},[d(t(J),{vertical:O.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:u(()=>[(a(),b(W(t(Bt)(l.stage.type)),{size:18,color:t(r)},null,8,["color"])),O.value?(a(),b(t(Xe),{key:1,layout:"vertical"},{default:u(()=>[d(t(me),{label:"Title"},{default:u(()=>[d(t(ge),{value:ae.value,"onUpdate:value":f[0]||(f[0]=B=>ae.value=B),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),fe.value?(a(),b(t(kt),{key:0,checked:be.value,"onUpdate:checked":f[1]||(f[1]=B=>be.value=B),style:{"margin-bottom":"12px"}},{default:u(()=>[T(" Update filename to "),d(t(K),{code:""},{default:u(()=>[T(U(fe.value),1)]),_:1})]),_:1},8,["checked"])):M("",!0),l.stage.type==="agents"?(a(),b(Lo,{key:1,"stage-props":l.stage.props,"onUpdate:stageProps":i},null,8,["stage-props"])):M("",!0)]),_:1})):(a(),b(t(ht),{key:0,class:"title"},{default:u(()=>[T(U(l.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),H.value?(a(),b(t(Wt),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):M("",!0),I.value==="prompting"||I.value==="creating"?(a(),b(Fo,{key:1,filename:k.value,"file-exists":_.value,"creating-file-status":I.value,onCreateFile:C,onCancel:p,onUpdateFilename:v},null,8,["filename","file-exists","creating-file-status"])):M("",!0),d(t(Yt),{visible:h.value,"onUpdate:visible":f[3]||(f[3]=B=>h.value=B),title:"Tasks",width:"500",onClose:f[4]||(f[4]=B=>h.value=!1)},{default:u(()=>[d(jt,{"stage-id":l.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const ue=oe(No,[["__scopeId","data-v-3cc89ce8"]]),et=o=>(wt("data-v-f4278104"),o=o(),_t(),o),jo={class:"empty-hint"},Uo={key:0,class:"drag-hint"},Zo=et(()=>A("div",{class:"title"},"Start here",-1)),Oo={key:1,class:"drop-hint"},Ro=et(()=>A("div",{class:"title"},"Drop here",-1)),Xo={key:2,class:"stages-hint"},Yo={class:"header"},Wo={class:"title"},Go={class:"description"},qo=L({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(o){return(e,n)=>(a(),w("div",jo,[e.showDragHint?(a(),w("div",Uo,[Zo,d(t(Ue),{size:32,class:"arrow"})])):M("",!0),e.showDragHint?M("",!0):(a(),w("div",Oo,[Ro,d(t(Ue),{size:32,class:"arrow"})])),e.showDragHint?(a(),w("div",Xo,[(a(!0),w(R,null,ce(t(ye).stages,s=>(a(),w("div",{key:s.key,class:"stage-hint"},[A("div",Yo,[(a(),b(W(s.icon))),A("span",Wo,U(s.title),1)]),A("div",Go,U(s.description),1)]))),128))])):M("",!0)]))}});const Ko=oe(qo,[["__scopeId","data-v-f4278104"]]),Jo=L({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(o){const e=o;bt(v=>({"188c19a4":t(c),ae9a8762:t(y)}));const n=Je(),{useToken:s}=Ge,{token:r}=s(),y=r.value.colorPrimaryBorder,c=r.value.colorBgElevated,{onInit:h}=q();h(v=>{v.fitView()});const _=v=>{var i;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:v&&(i=e.initialFileCheckStatus[v])!=null?i:!1};return we(()=>{const v=ie.subscribe("stageCreated",()=>{e.workflow.refetch()}),i=ie.subscribe("stageEdited",()=>{e.workflow.refetch()}),p=ie.subscribe("transitionCreated",()=>{e.workflow.refetch()});$t(()=>{ie.unsubscribe(v),ie.unsubscribe(p),ie.unsubscribe(i)})}),(v,i)=>v.workflow?(a(),b(t(Vt),{key:0,nodes:v.workflow.vueFlowNodes.value,edges:v.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":v.editable,"pan-on-scroll":t(qe).isMac,"elements-selectable":v.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":["delete","backspace"],onDragover:t(n).onDragOver,onDragleave:t(n).onDragLeave},{"connection-line":u(p=>[d(Vo,Ct(At(p)),null,16)]),"edge-task":u(p=>[d(xo,he(p,{controller:v.workflow}),null,16,["controller"])]),"node-forms":u(p=>[d(ue,{stage:p.data,node:p,controller:v.workflow,"initial-file-check":_(p.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":u(p=>[d(ue,{stage:p.data,node:p,controller:v.workflow,"initial-file-check":_(p.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":u(p=>[d(ue,{stage:p.data,node:p,controller:v.workflow,"initial-file-check":_(p.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":u(p=>[d(ue,{stage:p.data,node:p,controller:v.workflow,"initial-file-check":_(p.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":u(p=>[d(ue,{stage:p.data,node:p,controller:v.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":u(p=>[d(ue,{stage:p.data,node:p,controller:v.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:u(()=>[d(t(Pt)),v.editable&&!v.workflow.vueFlowNodes.value.length?(a(),b(Ko,{key:0,"show-drag-hint":v.showDragHint},null,8,["show-drag-hint"])):M("",!0),d(t(Lt),{pannable:"",zoomable:""}),v.editable?(a(),b($o,{key:1,workflow:v.workflow},null,8,["workflow"])):M("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):M("",!0)}});const Qo=oe(Jo,[["__scopeId","data-v-316557a0"]]),es=L({__name:"WorkflowEditor",setup(o){const e=dt(),{init:n,tearDown:s,onDragStart:r,onDrop:y,isDragging:c,isAdding:h,draggedType:_,mousePosition:v}=Je(),{result:i}=Me(async()=>await rt.init(ut,!0)),p=z(null),E=async()=>{if(!i.value)return;const m=i.value.vueFlowNodes.value.map(D=>{var F,X,$,V,Z;return((F=D.data)==null?void 0:F.type)==="forms"||((X=D.data)==null?void 0:X.type)==="hooks"||(($=D.data)==null?void 0:$.type)==="scripts"||((V=D.data)==null?void 0:V.type)==="jobs"?(Z=D.data)==null?void 0:Z.props.filename:null});p.value=await ve.checkFiles(m.filter(D=>typeof D=="string"))};ke(()=>i.value,()=>{i.value&&(n(i.value),E())});const{onNodeDragStop:g,onEdgesChange:k,getSelectedElements:I,getNodes:C,addSelectedNodes:H,zoomIn:P,fitView:S,zoomOut:j,applyEdgeChanges:ee}=q();g(m=>{var D;(D=i.value)==null||D.move(m.nodes.map(F=>({id:F.id,position:F.position})))}),k(m=>{var D;for(const F of m)F.type==="remove"&&((D=i.value)==null||D.delete([F.id]));ee(m)});const se=m=>{var D,F;e.isInputFocused||!i.value||((m.key==="z"||m.key==="Z")&&Y(m)&&(La(m)?i.value.history.redo():(D=i.value)==null||D.history.undo(),m.preventDefault()),Y(m)&&(m.key==="s"||m.key==="S")&&((F=i.value)==null||F.save(),m.preventDefault()),!(Y(m)&&(m.key==="f"||m.key==="F"))&&(I.value.length||(m.key==="f"||m.key==="F"?r(null,"forms"):m.key==="h"||m.key==="H"?r(null,"hooks"):m.key==="j"||m.key==="J"?r(null,"jobs"):m.key==="t"||m.key==="T"?r(null,"scripts"):(m.key==="a"||m.key==="A")&&Y(m)?(H(C.value),m.preventDefault()):m.key==="0"&&Y(m)?(S(),m.preventDefault()):(m.key==="="||m.key==="+")&&Y(m)?(m.preventDefault(),P()):m.key==="-"&&Y(m)&&(m.preventDefault(),j()))))};return we(()=>{window.addEventListener("keydown",se)}),Ve(()=>{window.removeEventListener("keydown",se),s()}),(m,D)=>t(i)?(a(),w("div",{key:0,class:ze(["workflow-container",{dragging:t(h)}]),onDrop:D[0]||(D[0]=(...F)=>t(y)&&t(y)(...F))},[d(Qo,{workflow:t(i),editable:"","show-drag-hint":!t(h),"check-file-status":!0,"initial-file-check-status":p.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),d(Oa,{controller:t(i),onDragStart:t(r)},null,8,["controller","onDragStart"]),(a(!0),w(R,null,ce(t(ye).stages,F=>{var X,$;return a(),w("div",{key:F.key},[t(h)&&!t(c)&&F.typeName===t(_)?(a(),w("div",{key:0,class:"dragging-node",style:Q({left:`${(X=t(v))==null?void 0:X.x}px`,top:`${($=t(v))==null?void 0:$.y}px`,position:"absolute",cursor:t(h)?"grabbing":"grab"})},[(a(),b(W(F.icon),{size:18}))],4)):M("",!0)])}),128))],34)):M("",!0)}});const Os=oe(es,[["__scopeId","data-v-aa8dbb66"]]);export{Os as default};
//# sourceMappingURL=WorkflowEditor.e1b17dd3.js.map

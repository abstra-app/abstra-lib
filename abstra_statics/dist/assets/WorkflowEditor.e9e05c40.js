var vt=Object.defineProperty;var ht=(t,e,o)=>e in t?vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var we=(t,e,o)=>(ht(t,typeof e!="symbol"?e+"":e,o),o);import{g as yt,W as mt,w as wt}from"./controller.787d25fd.js";import{o as te,u as kt}from"./omniChatStore.cbc03b15.js";import{a as Ie}from"./asyncComputed.92afc598.js";import{d as Z,af as X,g as V,o as i,K as y,O as N,F as S,e5 as ye,a as b,e as _t,f as x,b as f,w as c,u as n,aL as R,ea as ge,c as _,da as ne,d5 as ae,az as P,eb as U,d3 as We,ei as Q,cH as bt,Q as re,h as $e,bu as Se,am as Ge,aP as Re,ec as Ee,N as oe,bM as ke,J as Ce,a8 as ze,bE as he,cs as _e,cr as qe,cE as Ke,eA as $t,B as ce,ej as Je,bs as Ct,bq as Ue,bK as Ht,au as xe,e3 as At,d2 as Mt,bH as Vt,eP as St,eQ as xt,eo as It,aj as Dt,ep as Et,eq as zt}from"./index.7923872d.js";import{u as q,P as Ft,_ as Pt,g as Qe,a as Tt,b as Bt,c as fe,N as Lt,e as Zt,M as Nt,f as jt}from"./index.801e5797.js";import"./linters.6aa635bb.js";import{W as ve}from"./workspaces.48f01007.js";import{U as Ut}from"./UnsavedChangesHandler.e277666a.js";import{w as be,s as Ot}from"./metadata.d6518880.js";import{A as De}from"./index.36e989f5.js";import{_ as Yt,a as Xt}from"./vue-flow-minimap.d077e3b8.js";import{G as Wt}from"./PhArrowCounterClockwise.vue.126fefd2.js";import{F as Gt,C as Rt}from"./filesController.1fc25468.js";import{T as qt}from"./TasksManager.68d229d3.js";import{n as Kt}from"./string.1db8b38e.js";import{a as Jt,b as Qt,n as ea}from"./validations.8f92082d.js";import{u as ta}from"./editor.2732a1a6.js";import"./index.1c86e93d.js";import{A as aa}from"./index.b140e684.js";import{t as et}from"./index.a8104d0a.js";import{B as oa}from"./Badge.6368642a.js";import{G as Oe}from"./PhArrowDown.vue.b2ecc15f.js";import"./uuid.ccb756e3.js";import"./record.cd96e7d8.js";import"./runnerData.1e6afab8.js";import"./url.efbb3234.js";import"./colorHelpers.556f0b62.js";import"./ExclamationCircleOutlined.12b2bfd0.js";import"./PhWebhooksLogo.vue.ac17bd70.js";import"./tasksController.f43d0936.js";import"./gateway.8f02e2de.js";import"./popupNotifcation.34f1e459.js";import"./scripts.89897d49.js";import"./polling.563de528.js";import"./ant-design.37f438b2.js";import"./PhArrowSquareOut.vue.8f602bac.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.ffe433ca.js";import"./index.4327f21c.js";import"./Card.b3c6dc59.js";import"./TabPane.4551d364.js";import"./CollapsePanel.e01ad146.js";import"./userStore.603062a1.js";import"./workspaceStore.bece932a.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="158bcf71-52d4-4bf6-8003-72d07f6e86e8",t._sentryDebugIdIdentifier="sentry-dbid-158bcf71-52d4-4bf6-8003-72d07f6e86e8")}catch{}})();const na=["width","height","fill","transform"],sa={key:0},la=b("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),ia=[la],ra={key:1},ua=b("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),da=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ca=[ua,da],pa={key:2},ga=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),fa=[ga],va={key:3},ha=b("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),ya=[ha],ma={key:4},wa=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ka=[wa],_a={key:5},ba=b("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),$a=[ba],Ca={name:"PhArrowClockwise"},Ha=Z({...Ca,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,o=X("weight","regular"),s=X("size","1em"),l=X("color","currentColor"),g=X("mirrored",!1),u=V(()=>{var a;return(a=e.weight)!=null?a:o}),k=V(()=>{var a;return(a=e.size)!=null?a:s}),m=V(()=>{var a;return(a=e.color)!=null?a:l}),h=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:g?"scale(-1, 1)":void 0);return(a,C)=>(i(),y("svg",ye({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:m.value,transform:h.value},a.$attrs),[N(a.$slots,"default"),u.value==="bold"?(i(),y("g",sa,ia)):u.value==="duotone"?(i(),y("g",ra,ca)):u.value==="fill"?(i(),y("g",pa,fa)):u.value==="light"?(i(),y("g",va,ya)):u.value==="regular"?(i(),y("g",ma,ka)):u.value==="thin"?(i(),y("g",_a,$a)):S("",!0)],16,na))}}),Aa=["width","height","fill","transform"],Ma={key:0},Va=b("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),Sa=[Va],xa={key:1},Ia=b("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),Da=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ea=[Ia,Da],za={key:2},Fa=b("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),Pa=[Fa],Ta={key:3},Ba=b("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),La=[Ba],Za={key:4},Na=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),ja=[Na],Ua={key:5},Oa=b("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Ya=[Oa],Xa={name:"PhFunnel"},Wa=Z({...Xa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,o=X("weight","regular"),s=X("size","1em"),l=X("color","currentColor"),g=X("mirrored",!1),u=V(()=>{var a;return(a=e.weight)!=null?a:o}),k=V(()=>{var a;return(a=e.size)!=null?a:s}),m=V(()=>{var a;return(a=e.color)!=null?a:l}),h=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:g?"scale(-1, 1)":void 0);return(a,C)=>(i(),y("svg",ye({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:m.value,transform:h.value},a.$attrs),[N(a.$slots,"default"),u.value==="bold"?(i(),y("g",Ma,Sa)):u.value==="duotone"?(i(),y("g",xa,Ea)):u.value==="fill"?(i(),y("g",za,Pa)):u.value==="light"?(i(),y("g",Ta,La)):u.value==="regular"?(i(),y("g",Za,ja)):u.value==="thin"?(i(),y("g",Ua,Ya)):S("",!0)],16,Aa))}}),Ga=["width","height","fill","transform"],Ra={key:0},qa=b("path",{d:"M160,116h48a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20V60H128a28,28,0,0,0-28,28v28H76v-4A20,20,0,0,0,56,92H24A20,20,0,0,0,4,112v32a20,20,0,0,0,20,20H56a20,20,0,0,0,20-20v-4h24v28a28,28,0,0,0,28,28h12v12a20,20,0,0,0,20,20h48a20,20,0,0,0,20-20V160a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20v12H128a4,4,0,0,1-4-4V88a4,4,0,0,1,4-4h12V96A20,20,0,0,0,160,116ZM52,140H28V116H52Zm112,24h40v40H164Zm0-112h40V92H164Z"},null,-1),Ka=[qa],Ja={key:1},Qa=b("path",{d:"M64,112v32a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V112a8,8,0,0,1,8-8H56A8,8,0,0,1,64,112ZM208,40H160a8,8,0,0,0-8,8V96a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V48A8,8,0,0,0,208,40Zm0,112H160a8,8,0,0,0-8,8v48a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152Z",opacity:"0.2"},null,-1),eo=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),to=[Qa,eo],ao={key:2},oo=b("path",{d:"M144,96V80H128a8,8,0,0,0-8,8v80a8,8,0,0,0,8,8h16V160a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16v48a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V192H128a24,24,0,0,1-24-24V136H72v8a16,16,0,0,1-16,16H24A16,16,0,0,1,8,144V112A16,16,0,0,1,24,96H56a16,16,0,0,1,16,16v8h32V88a24,24,0,0,1,24-24h16V48a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16V96a16,16,0,0,1-16,16H160A16,16,0,0,1,144,96Z"},null,-1),no=[oo],so={key:3},lo=b("path",{d:"M160,110h48a14,14,0,0,0,14-14V48a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14V66H128a22,22,0,0,0-22,22v34H70V112A14,14,0,0,0,56,98H24a14,14,0,0,0-14,14v32a14,14,0,0,0,14,14H56a14,14,0,0,0,14-14V134h36v34a22,22,0,0,0,22,22h18v18a14,14,0,0,0,14,14h48a14,14,0,0,0,14-14V160a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14v18H128a10,10,0,0,1-10-10V88a10,10,0,0,1,10-10h18V96A14,14,0,0,0,160,110ZM58,144a2,2,0,0,1-2,2H24a2,2,0,0,1-2-2V112a2,2,0,0,1,2-2H56a2,2,0,0,1,2,2Zm100,16a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2v48a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Zm0-112a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2V96a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Z"},null,-1),io=[lo],ro={key:4},uo=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),co=[uo],po={key:5},go=b("path",{d:"M160,108h48a12,12,0,0,0,12-12V48a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12V68H128a20,20,0,0,0-20,20v36H68V112a12,12,0,0,0-12-12H24a12,12,0,0,0-12,12v32a12,12,0,0,0,12,12H56a12,12,0,0,0,12-12V132h40v36a20,20,0,0,0,20,20h20v20a12,12,0,0,0,12,12h48a12,12,0,0,0,12-12V160a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12v20H128a12,12,0,0,1-12-12V88a12,12,0,0,1,12-12h20V96A12,12,0,0,0,160,108ZM60,144a4,4,0,0,1-4,4H24a4,4,0,0,1-4-4V112a4,4,0,0,1,4-4H56a4,4,0,0,1,4,4Zm96,16a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4v48a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Zm0-112a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V96a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Z"},null,-1),fo=[go],vo={name:"PhTreeStructure"},ho=Z({...vo,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,o=X("weight","regular"),s=X("size","1em"),l=X("color","currentColor"),g=X("mirrored",!1),u=V(()=>{var a;return(a=e.weight)!=null?a:o}),k=V(()=>{var a;return(a=e.size)!=null?a:s}),m=V(()=>{var a;return(a=e.color)!=null?a:l}),h=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:g?"scale(-1, 1)":void 0);return(a,C)=>(i(),y("svg",ye({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:m.value,transform:h.value},a.$attrs),[N(a.$slots,"default"),u.value==="bold"?(i(),y("g",Ra,Ka)):u.value==="duotone"?(i(),y("g",Ja,to)):u.value==="fill"?(i(),y("g",ao,no)):u.value==="light"?(i(),y("g",so,io)):u.value==="regular"?(i(),y("g",ro,co)):u.value==="thin"?(i(),y("g",po,fo)):S("",!0)],16,Ga))}});class tt{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const K=t=>tt.isMac?t.metaKey:t.ctrlKey,yo=t=>t.shiftKey;class mo{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const Ye=new mo;class He{constructor(e){this.dto=e}static async listConnections(){return(await Ye.listConnections()).map(o=>new He(o))}static async getIsUsageMode(){return await Ye.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const at=_t("agents-usage-mode",()=>{const t=x(!1);return(async()=>{t.value=await He.getIsUsageMode()})(),{agentUsageMode:t}}),wo=["onDragstart"],ko={style:{display:"flex","flex-direction":"column","max-width":"250px"}},_o=Z({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){const o=at(),s=V(()=>o.agentUsageMode?be.stages:be.stages.filter(l=>!["agents","clients"].includes(l.typeName)));return(l,g)=>(i(),y(R,null,[f(n(ne),{class:"toolbar",align:"center"},{default:c(()=>[(i(!0),y(R,null,ge(s.value,u=>(i(),_(n(bt),{key:u.key,placement:"top"},{title:c(()=>[f(n(ne),{gap:"small"},{default:c(()=>[f(n(ae),null,{default:c(()=>[P(U(u.title),1)]),_:2},1024),f(n(ae),{keyboard:""},{default:c(()=>[P(U(u.key),1)]),_:2},1024)]),_:2},1024)]),content:c(()=>[b("div",ko,[f(n(ae),null,{default:c(()=>[P(U(u.description),1)]),_:2},1024),u.beta?(i(),_(n(De),{key:0,type:"warning",class:"beta-alert"},{description:c(()=>[f(n(ae),null,{default:c(()=>[P(" This is a beta feature, "),f(n(We),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:c(()=>[P(" click here ")]),_:1}),P(" to learn more about it ")]),_:1})]),_:1})):S("",!0)])]),default:c(()=>[b("div",{draggable:!0,class:"toolbar__item",onDragstart:k=>e("drag-start",k.dataTransfer,u.typeName)},[(i(),_(Q(u.icon),{size:18}))],40,wo)]),_:2},1024))),128))]),_:1}),f(Ut,{"has-changes":l.controller.hasChanges()},null,8,["has-changes"])],64))}});const bo=re(_o,[["__scopeId","data-v-43cbdf29"]]);function ot(){let t;const e={draggedType:x(null),isDragOver:x(!1),isAdding:x(!1),isDragging:x(!1),mousePosition:x(null)},{draggedType:o,isDragOver:s,isDragging:l,isAdding:g}=e,u=A=>{t=A,document.addEventListener("mousemove",d)},{screenToFlowCoordinate:k}=q();$e(g,A=>{document.body.style.userSelect=A?"none":""});function m(A,T){g.value=!0,A?(A.setData("application/vueflow",T),A.effectAllowed="move",o.value=T,l.value=!0,document.addEventListener("drop",C)):(o.value=T,document.addEventListener("click",H))}function h(A){A.preventDefault(),o.value&&(s.value=!0,A.dataTransfer&&(A.dataTransfer.dropEffect="move"))}function a(){s.value=!1}function C(){g.value=!1,l.value=!1,s.value=!1,o.value=null,document.removeEventListener("drop",C)}function d(A){const T={x:A.pageX-200,y:A.pageY-80};e.mousePosition.value=T}function p(A){if(!o.value)throw new Error("No dragged type");return k({x:A.clientX-70,y:A.clientY-25})}function H(A){if(!t)return;if(!o.value)throw new Error("No dragged type");const T=p(A);t.addStages([{type:o.value,position:T}]),C()}function F(){document.removeEventListener("mousemove",d)}return{init:u,tearDown:F,draggedType:o,isDragOver:s,isAdding:g,isDragging:l,mousePosition:e.mousePosition,onDragStart:m,onDragLeave:a,onDragOver:h,onDrop:H}}const $o={name:"ControlButton",compatConfig:{MODE:3}},Co=(t,e)=>{const o=t.__vccOpts||t;for(const[s,l]of e)o[s]=l;return o},Ho={class:"vue-flow__controls-button"};function Ao(t,e,o,s,l,g){return i(),y("button",Ho,[N(t.$slots,"default")])}const ie=Co($o,[["render",Ao]]),Mo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Vo=b("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),So=[Vo];function xo(t,e){return i(),y("svg",Mo,So)}const Io={render:xo},Do={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Eo=b("path",{d:"M0 0h32v4.2H0z"},null,-1),zo=[Eo];function Fo(t,e){return i(),y("svg",Do,zo)}const Po={render:Fo},To={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Bo=b("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Lo=[Bo];function Zo(t,e){return i(),y("svg",To,Lo)}const No={render:Zo},jo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Uo=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Oo=[Uo];function Yo(t,e){return i(),y("svg",jo,Oo)}const Xo={render:Yo},Wo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Go=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),Ro=[Go];function qo(t,e){return i(),y("svg",Wo,Ro)}const Ko={render:qo},Jo={name:"Controls",compatConfig:{MODE:3}},Qo=Z({...Jo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>Ft.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:o,nodesConnectable:s,elementsSelectable:l,setInteractive:g,zoomIn:u,zoomOut:k,fitView:m,viewport:h,minZoom:a,maxZoom:C}=q(),d=Se(()=>o.value||s.value||l.value),p=Se(()=>h.value.zoom<=a.value),H=Se(()=>h.value.zoom>=C.value);function F(){u(),e("zoomIn")}function A(){k(),e("zoomOut")}function T(){m(t.fitViewParams),e("fitView")}function B(){g(!d.value),e("interactionChange",!d.value)}return(M,I)=>(i(),_(n(Pt),{class:"vue-flow__controls",position:M.position},{default:c(()=>[N(M.$slots,"top"),M.showZoom?(i(),y(R,{key:0},[N(M.$slots,"control-zoom-in",{},()=>[f(ie,{class:"vue-flow__controls-zoomin",disabled:H.value,onClick:F},{default:c(()=>[N(M.$slots,"icon-zoom-in",{},()=>[(i(),_(Q(n(Io))))])]),_:3},8,["disabled"])]),N(M.$slots,"control-zoom-out",{},()=>[f(ie,{class:"vue-flow__controls-zoomout",disabled:p.value,onClick:A},{default:c(()=>[N(M.$slots,"icon-zoom-out",{},()=>[(i(),_(Q(n(Po))))])]),_:3},8,["disabled"])])],64)):S("",!0),M.showFitView?N(M.$slots,"control-fit-view",{key:1},()=>[f(ie,{class:"vue-flow__controls-fitview",onClick:T},{default:c(()=>[N(M.$slots,"icon-fit-view",{},()=>[(i(),_(Q(n(No))))])]),_:3})]):S("",!0),M.showInteractive?N(M.$slots,"control-interactive",{key:2},()=>[M.showInteractive?(i(),_(ie,{key:0,class:"vue-flow__controls-interactive",onClick:B},{default:c(()=>[d.value?N(M.$slots,"icon-unlock",{key:0},()=>[(i(),_(Q(n(Ko))))]):S("",!0),d.value?S("",!0):N(M.$slots,"icon-lock",{key:1},()=>[(i(),_(Q(n(Xo))))])]),_:3})):S("",!0)]):S("",!0),N(M.$slots,"default")]),_:3},8,["position"]))}}),en=Z({__name:"ControlButtons",props:{workflow:{}},setup(t){const e=t,{fitView:o}=q(),s=()=>{e.workflow.autoLayout(),Ge(()=>{o()})};return(l,g)=>(i(),_(n(Qo),{position:"top-left","show-interactive":!1},{default:c(()=>[f(n(ie),{title:"Auto layout",onClick:g[0]||(g[0]=u=>s())},{default:c(()=>[f(n(ho))]),_:1}),f(n(ie),{title:"Undo",disabled:!l.workflow.history.canUndo(),onClick:g[1]||(g[1]=u=>l.workflow.history.undo())},{default:c(()=>[f(n(Wt))]),_:1},8,["disabled"]),f(n(ie),{title:"Redo",disabled:!l.workflow.history.canRedo(),onClick:g[2]||(g[2]=u=>l.workflow.history.redo())},{default:c(()=>[f(n(Ha))]),_:1},8,["disabled"])]),_:1}))}});class Y{constructor(e){we(this,"angle");e=Y.normalize(e),this.angle=e}static normalize(e){const o=Math.PI;return((e+o)%(2*o)+2*o)%(2*o)-o}static fromRadians(e){return new Y(Y.normalize(e))}static fromDegrees(e){const o=e*Math.PI/180;return new Y(o)}static fromPoints(e,o){const s=o.x-e.x,l=o.y-e.y,g=Math.atan2(l,s);return new Y(g)}get degrees(){return this.angle*180/Math.PI}get radians(){return this.angle}get isZero(){return this.angle===0}get isPositive(){return this.angle>0}get complementary(){return new Y(Math.PI/2-this.angle)}get perpendicular(){return new Y(Math.PI/2+this.angle)}get sin(){return Math.sin(this.angle)}get cos(){return Math.cos(this.angle)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new Y(this.angle/e)}multiply(e){return new Y(this.angle*e)}}class J{constructor(e,o){we(this,"dx");we(this,"dy");this.dx=e,this.dy=o}static fromPoints(e,o){const s=o.x-e.x,l=o.y-e.y;return new J(s,l)}static fromAngleAndLength(e,o){const s=o*e.cos,l=o*e.sin;return new J(s,l)}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}get opposite(){return new J(-this.dx,-this.dy)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new J(this.dx/e,this.dy/e)}add(e){return new J(this.dx+e.dx,this.dy+e.dy)}subtract(e){return new J(this.dx-e.dx,this.dy-e.dy)}}function tn(t,e,o=1e-10){const s=e.center.x-e.width/2,l=e.center.x+e.width/2,g=e.center.y-e.height/2,u=e.center.y+e.height/2;return t.x>=s-o&&t.x<=l+o&&t.y>=g-o&&t.y<=u+o}function Xe(t,e,o,s=1e-10){const l=o.center.x-o.width/2,g=o.center.x+o.width/2,u=o.center.y-o.height/2,k=o.center.y+o.height/2,m=e.x-t.x,h=e.y-t.y;let a=1/0,C=null;if(tn(t,o,s))return null;if(Math.abs(m)>s){const d=(l-t.x)/m;if(d>0&&d<a){const p=t.y+d*h;p>=u-s&&p<=k+s&&(a=d,C={x:l,y:p})}}if(Math.abs(m)>s){const d=(g-t.x)/m;if(d>0&&d<a){const p=t.y+d*h;p>=u-s&&p<=k+s&&(a=d,C={x:g,y:p})}}if(Math.abs(h)>s){const d=(u-t.y)/h;if(d>0&&d<a){const p=t.x+d*m;p>=l-s&&p<=g+s&&(a=d,C={x:p,y:u})}}if(Math.abs(h)>s){const d=(k-t.y)/h;if(d>0&&d<a){const p=t.x+d*m;p>=l-s&&p<=g+s&&(a=d,C={x:p,y:k})}}return C}function an(t,e,o=0,s=0){o=Math.abs(o),t.height+=o*2,t.width+=o*2,e.height+=o*2,e.width+=o*2;const l=Y.fromPoints(t.center,e.center),g=s*l.perpendicular.cos,u=s*l.perpendicular.sin,k={x:t.center.x+g,y:t.center.y+u},m={x:e.center.x+g,y:e.center.y+u};let h=Xe(k,m,e);h||(h=e.center);let a=Xe(m,k,t);return a||(a=t.center),{sourceX:a.x,sourceY:a.y,targetX:h.x,targetY:h.y}}function on(t,e=0){const o=Y.fromPoints({x:t.sourceX,y:t.sourceY},{x:t.targetX,y:t.targetY}),s=Math.sqrt(Math.pow(t.targetX-t.sourceX,2)+Math.pow(t.targetY-t.sourceY,2)),l=Y.fromRadians(Math.atan(2*e/s)).multiply(4),g=s/2/l.divide(2).sin,u=new J(t.sourceX+t.targetX,t.sourceY+t.targetY).divide(2),k=g*(1+(l.isPositive?-1:1)*l.divide(2).cos),m=J.fromAngleAndLength(o.perpendicular,k),h=e>0===l.isPositive?u.add(m):u.subtract(m);return{sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,labelX:h.x,labelY:h.y,radius:g,largeArcFlag:l.isPositive?0:1,sweepFlag:0}}function nt(t,e,o=0,s=0){const g={center:{x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},width:t.dimensions.width,height:t.dimensions.height},k={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return an(g,k,o,s)}function st(t,e,o=0){return nt(t,e,10,o)}function nn(t,e,o=0){o=Math.abs(o);const s=st(t,e,o/2);if(o===0)return Qe(s);const l=on(s,o);return[`M${l.sourceX},${l.sourceY} A${l.radius},${l.radius} 0 ${l.largeArcFlag},${l.sweepFlag} ${l.targetX},${l.targetY}`,l.labelX,l.labelY,0,0]}const sn=Z({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,o)=>(i(),_(n(ne),{vertical:"",gap:"small",style:oe({marginBottom:`-${16*e.menuOptions.length}%`})},{default:c(()=>[(i(!0),y(R,null,ge(e.menuOptions,s=>(i(),_(n(Re),{key:s.label,title:s.tooltip,placement:"right"},{default:c(()=>[f(n(ke),{class:Ee([{"warning-button":s.warning}]),disabled:s.disabled,style:oe({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:l=>s.click(l)},{default:c(()=>[f(n(ne),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:c(()=>[P(U(s.label)+" ",1),s.key?(i(),_(n(ae),{key:0,keyboard:"",disabled:s.disabled},{default:c(()=>[P(U(s.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const ln=Z({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,o=[{label:"Edit task type",key:"E",click:()=>l.value="editing"},{label:"Delete",key:"Del",click:()=>d(e.data.id)}],s=x(e.data.props.taskType||""),l=x("idle"),g=()=>{l.value!=="idle"&&(s.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:s.value}),l.value="idle")},{onEdgeClick:u,onPaneClick:k,getSelectedEdges:m}=q();u(p=>{p.edge.id===e.id&&l.value==="idle"&&(l.value="selected")}),k(()=>g());const h=V(()=>e.controller.edgeIsLonely(e.id)?0:20),a=V(()=>nn(e.sourceNode,e.targetNode,h.value)),C=p=>{if(!!m.value.map(H=>H.id).includes(e.data.id)&&(p.key==="Enter"&&g(),(p.key==="e"||p.key==="E")&&(l.value="editing"),p.key==="Backspace"||p.key==="Delete")){if(l.value==="editing")return;d(e.data.id)}},{removeEdges:d}=q();return Ce(()=>window.addEventListener("keydown",C)),ze(()=>window.removeEventListener("keydown",C)),(p,H)=>(i(),y(R,null,[f(n(Tt),{path:a.value[0],"marker-end":p.markerEnd},null,8,["path","marker-end"]),f(n(Bt),null,{default:c(()=>[l.value==="idle"?(i(),y("div",{key:0,style:oe({transform:`translate(-50%, -50%) translate(${a.value[1]}px,${a.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(i(),_(n(ae),{key:1},{default:c(()=>[P(U(e.data.props.taskType),1)]),_:1})):(i(),_(n(Wa),{key:0,size:16}))],4)):l.value==="selected"?(i(),y("div",{key:1,style:oe({transform:`translate(-50%, -120%) translate(${a.value[1]}px,${a.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[f(sn,{"is-connecting":!0,"is-editing":!0,"menu-options":o})],4)):l.value==="editing"?(i(),y("div",{key:2,style:oe({transform:`translate(-50%, -50%) translate(${a.value[1]}px,${a.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[f(n(he),{value:s.value,"onUpdate:value":H[0]||(H[0]=F=>s.value=F),placeholder:"Task type"},null,8,["value"])],4)):S("",!0)]),_:1})],64))}});const rn=re(ln,[["__scopeId","data-v-dd919c09"]]),un={key:0},dn=b("defs",null,[b("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[b("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),cn=["d"],pn=Z({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,o=x(!0),{onNodeMouseEnter:s,onNodeMouseLeave:l}=q();s(m=>{m.node.id===e.sourceNode.id&&(o.value=!1)}),l(m=>{m.node.id===e.sourceNode.id&&(o.value=!0)});const g=V(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),u=V(()=>st(e.sourceNode,g.value)),k=V(()=>Qe(u.value));return(m,h)=>o.value?(i(),y("g",un,[dn,b("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:k.value[0],"marker-end":"url(#arrowhead)"},null,8,cn)])):S("",!0)}}),gn=Z({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const o=t,s=V(()=>{const l=Jt(o.filename);return l.valid?o.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:l});return(l,g)=>(i(),_(n(Ke),{open:l.creatingFileStatus==="prompting"||l.creatingFileStatus==="creating",closable:!1,"confirm-loading":l.creatingFileStatus==="creating",onOk:g[1]||(g[1]=u=>e("create-file",l.filename)),onCancel:g[2]||(g[2]=u=>e("cancel"))},{default:c(()=>[f(n(qe),{layout:"vertical",disabled:l.creatingFileStatus=="creating"},{default:c(()=>[f(n(_e),{label:"You're creating a new file. What should it be called?","validate-status":s.value.valid?"success":"error",help:s.value.valid?s.value.help:s.value.reason},{default:c(()=>[f(n(he),{value:l.filename,onChange:g[0]||(g[0]=u=>e("update-filename",u.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),fn={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},vn=Z({...fn,props:{nodeId:null,isVisible:{type:Boolean},position:{default:fe.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,o=X(Lt,null),{viewportRef:s,viewport:l,getSelectedNodes:g,findNode:u}=q();function k(p,H,F,A,T){let B=.5;T==="start"?B=0:T==="end"&&(B=1);let M=[(p.x+p.width*B)*H.zoom+H.x,p.y*H.zoom+H.y-A],I=[-100*B,-100];switch(F){case fe.Right:M=[(p.x+p.width)*H.zoom+H.x+A,(p.y+p.height*B)*H.zoom+H.y],I=[0,-100*B];break;case fe.Bottom:M[1]=(p.y+p.height)*H.zoom+H.y+A,I[1]=0;break;case fe.Left:M=[p.x*H.zoom+H.x-A,(p.y+p.height*B)*H.zoom+H.y],I=[-100,-100*B];break}return`translate(${M[0]}px, ${M[1]}px) translate(${I[0]}%, ${I[1]}%)`}const m=V(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||o||""]).reduce((p,H)=>{const F=u(H);return F&&p.push(F),p},[])),h=V(()=>typeof e.isVisible=="boolean"?e.isVisible:m.value.length===1&&m.value[0].selected&&g.value.length===1),a=V(()=>Zt(m.value)),C=V(()=>Math.max(...m.value.map(p=>(p.computedPosition.z||1)+1))),d=V(()=>({position:"absolute",transform:k(a.value,l.value,e.position,e.offset,e.align),zIndex:C.value}));return(p,H)=>(i(),_($t,{to:n(s),disabled:!n(s)},[n(h)&&n(m).length?(i(),y("div",ye({key:0},p.$attrs,{style:n(d),class:"vue-flow__node-toolbar"}),[N(p.$slots,"default")],16)):S("",!0)],8,["to","disabled"]))}}),hn=Z({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,o)=>(i(),_(n(vn),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:n(fe).Right},{default:c(()=>[f(n(ne),{vertical:"",gap:"small",style:oe({marginBottom:`-${16*e.menuOptions.length}%`})},{default:c(()=>[(i(!0),y(R,null,ge(e.menuOptions,s=>(i(),_(n(Re),{key:s.label,title:s.tooltip,placement:"right"},{default:c(()=>[f(n(ke),{class:Ee([{"warning-button":s.warning}]),disabled:s.disabled,style:oe({backgroundColor:s.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:l=>s.click(l)},{default:c(()=>[f(n(ne),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:c(()=>[P(U(s.label)+" ",1),s.key?(i(),_(n(ae),{key:0,keyboard:"",disabled:s.disabled},{default:c(()=>[P(U(s.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const yn=Z({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(t,{emit:e}){var G;const o=t,s=x(!1),g=at().agentUsageMode,u=ce.object({title:ce.string(),clientStageId:ce.string().uuid(),inputSchemas:ce.any(),outputSchemas:ce.any()});$e(()=>o.stageProps.projectId,()=>{s.value=!0,M()});const k=ta(),m=()=>{var E;const $=(E=k.cloudProject)==null?void 0:E.id;return $?`https://cloud.abstra.io/projects/${$}/agents`:""},h=ce.array(u),a=x((G=o.stageProps.projectId)!=null?G:""),C=x(!1),d=$=>p.loading.value||!p.result.value?null:p.result.value.find(E=>E.agentConnection.id===$),p=Ie(async()=>He.listConnections()),H=V(()=>p.loading.value||!p.result.value?[]:p.result.value.map($=>({label:$.agentConnection.connectionName,key:$.agentConnection.id,value:$.agent.projectId}))),{result:F,loading:A,refetch:T,error:B}=Ie(async()=>{const $=o.stageProps.projectId;if(!$)return[];const O=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${$}`)).json();return h.parse(O)}),M=Je.exports.debounce(()=>{s.value=!1,T()},500),I=V(()=>A.value||!F.value?[]:F.value.map($=>({label:$.title,value:$.clientStageId})));function j($){e("update:stage-props",{...o.stageProps,projectId:$,clientStageId:null})}function ue($){const E=d($.key);!E||(j(E.agent.projectId),a.value=E.agent.projectId,C.value=!1)}function w($){const E=$.target;a.value=E.value,j(E.value),C.value=!0}function D($){C.value=$}function z($){const E=String($);!F.value||e("update:stage-props",{...o.stageProps,clientStageId:E})}return($,E)=>(i(),y(R,null,[f(n(_e),{label:"Project ID"},{default:c(()=>{var O;return[n(g)?(i(),_(n(Ht),{key:0,trigger:"click",visible:C.value,onVisibleChange:D},{overlay:c(()=>[f(n(Ct),{onClick:ue},{default:c(()=>[(i(!0),y(R,null,ge(H.value,ee=>(i(),_(n(Ue),{key:ee.key},{default:c(()=>[P(U(ee.label),1)]),_:2},1024))),128)),f(n(Ue),null,{default:c(()=>[f(n(We),{class:"cloud-link",href:m(),target:"_blank"},{default:c(()=>[P(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:c(()=>[f(n(he),{value:a.value,"onUpdate:value":E[0]||(E[0]=ee=>a.value=ee),autofocus:"","allow-clear":"",onInput:w},null,8,["value"])]),_:1},8,["visible"])):(i(),_(n(he),{key:1,value:(O=$.stageProps.projectId)!=null?O:"",placeholder:"Project ID",autofocus:"","onUpdate:value":j},null,8,["value"]))]}),_:1}),f(n(_e),{label:"Client entrypoint"},{default:c(()=>{var O;return[s.value||n(A)?(i(),_(n(xe),{key:0,disabled:"",loading:""})):n(B)?(i(),_(n(De),{key:1,type:"error",message:"Invalid project id"})):$.stageProps.projectId?n(F).length===0?(i(),_(n(De),{key:3,type:"warning",message:"The project has no entrypoints"})):(i(),_(n(xe),{key:4,class:"entrypoint-select",options:I.value,value:(O=$.stageProps.clientStageId)!=null?O:void 0,"onUpdate:value":z},null,8,["options","value"])):(i(),_(n(xe),{key:2,disabled:""}))]}),_:1})],64))}});const mn=re(yn,[["__scopeId","data-v-f4d2a34d"]]),wn=Z({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var je;const e=t,{useToken:o}=et,s=At(),{token:l}=o(),g=l.value.colorText,u=[{label:"Add transition",key:"C",click:r=>Te(r)},{label:"Rename",key:"R",click:()=>W.value=!0},{label:"Go to editor",key:"Enter",click:()=>Pe()},{label:"Tasks",key:"M",click:()=>m.value=!0},{label:"Delete",key:"Del",click:()=>a.value=!0}],k=V(()=>{let r=[...u];return h.value||r.unshift({label:"Create missing file",warning:!0,click:()=>D()}),e.controller.hasChanges()&&(r=r.map(v=>v.label==="Go to editor"?{...v,disabled:!0,tooltip:"Save it to allow editing"}:v.label==="Tasks"?{...v,disabled:!0,tooltip:"Save it to allow managing tasks"}:v)),(e.stage.type==="agents"||e.stage.type==="clients")&&(r=r.filter(v=>!["Create missing file","Go to editor","Tasks"].includes(v.label))),e.stage.type==="agents"&&(r=r.map(v=>v.label==="Rename"?{...v,label:"Edit"}:v)),r}),m=x(!1),h=x(!0);$e(()=>e.initialFileCheck,r=>{B.value||(h.value=r)});const a=x(!1),C=()=>{a.value=!1,ee(e.stage)},d=new Rt,p=new Gt(d,{separator:"/"}),H=async()=>{if(a.value=!1,"filename"in e.stage.props&&e.stage.props.filename){const r=e.stage.props.filename;(await ve.checkFile(r)).exists&&await p.deleteFile([r])}ee(e.stage)},F=r=>{I.value=r,M()},A=r=>{e.controller.updateStageProps(e.stage.id,r)},T=()=>{var r;j.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(I.value=(r=e.stage.props.filename)!=null?r:"",M())},B=V(()=>e.controller.getUnsavedFilenameStages().some(r=>r.id===e.stage.id)),M=Je.exports.debounce(async()=>{if(B.value){h.value=!0;return}const r=I.value;if(!r){h.value=!0;return}ve.checkFile(r).then(v=>{h.value=v.exists})},500),I=x((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(je=e.stage.props.filename)!=null?je:""),j=x("idle"),ue=async()=>{j.value="creating",await ve.initFile(I.value,e.stage.type),h.value=!0;const r=await ve.checkFile(I.value);if(h.value=r.exists,j.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:I.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:I.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},w=V(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!h.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),D=()=>{j.value="prompting"},{startConnection:z,updateConnection:G,onNodeClick:$,addEdges:E,endConnection:O,removeNodes:ee,onPaneClick:it,getSelectedNodes:rt,flowToScreenCoordinate:Fe,onNodeMouseEnter:ut,onNodeMouseLeave:dt,getNodes:ct,onNodesChange:pt,applyNodeChanges:gt}=q(),se=x(!1),W=x(!1),le=x(e.stage.title),Ae=x(!0),me=V(()=>{const v=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Kt(le.value,!1,!0)}.py`;return v!==I.value?v:null}),Me=x(!1),Ve=x(!1);pt(async r=>{var L;const v=[];for(const de of r)de.type==="remove"?W.value||((L=e.controller)==null||L.delete([de.id]),v.push(de)):v.push(de);gt(v)});const Pe=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Ve.value?window.open(`/_editor/${r}/${e.stage.id}`,"_blank"):s.push({path:`/_editor/${r}/${e.stage.id}`})},Te=(r,v=!0)=>{z({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:v?r.pageX:r.pageX-90,y:v?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",Be),se.value=!0},Be=r=>{se.value&&!Me.value&&G({x:r.pageX,y:r.pageY-52})};$(r=>{if(r.node.id===e.stage.id&&M(),se.value&&r.node.id!==e.stage.id){const v={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:yt(),props:{taskType:null}};try{e.controller.connect([v]),document.removeEventListener("mousemove",Be),E({id:v.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:Nt.Arrow,width:24,height:24},data:v}),O(),se.value=!1}catch(L){console.error(L)}}}),ut(r=>{if(se.value&&r.node.id!==e.stage.id){Me.value=!0;const v=ct.value.find(de=>de.id===e.stage.id);if(!v)return;const L=nt(v,r.node,10);G(Fe({x:L.targetX,y:L.targetY-52}))}}),dt(()=>{Me.value=!1});const ft=()=>{if(!h.value){const r=Qt(le.value+".py");I.value=r;let v={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const L=ea(le.value);v={...v,path:L}}e.controller.updateStageProps(e.stage.id,v)}},Le=async()=>{e.stage.title!==le.value&&(e.controller.updateStageTitle(e.stage.id,le.value),Ae.value&&me.value&&(I.value=me.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:I.value})),ft()),M()};it(()=>{W.value&&Le(),W.value=!1,se.value=!1,O()});const Ze=r=>{if(Ve.value=K(r),!!rt.value.map(v=>v.id).includes(e.stage.id)&&j.value==="idle"){if(r.key==="Enter")if(W.value)W.value=!1,Le();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;Pe()}if(!W.value){if(r.key==="c"||r.key==="C"){const v=Fe(e.stage.position);Te({pageX:v.x,pageY:v.y},!1)}if((r.key==="r"||r.key==="R")&&(W.value=!0),r.key==="m"||r.key==="M"){if(e.controller.hasChanges())return;m.value=!0}(r.key==="Backspace"||r.key==="Delete")&&("filename"in e.stage.props&&e.stage.props.filename?a.value=!0:ee(e.stage))}}},Ne=r=>{Ve.value=K(r)};return Ce(()=>{B.value||(h.value=e.initialFileCheck),window.addEventListener("keydown",Ze),window.addEventListener("keyup",Ne)}),ze(()=>{window.removeEventListener("keydown",Ze),window.removeEventListener("keyup",Ne)}),(r,v)=>(i(),y(R,null,[f(hn,{"is-connecting":se.value,"is-editing":W.value,"menu-options":k.value},null,8,["is-connecting","is-editing","menu-options"]),f(n(Ke),{open:a.value,title:"Delete file",onCancel:v[0]||(v[0]=L=>a.value=!1)},{footer:c(()=>[f(n(ne),{justify:"space-between",gap:"small"},{default:c(()=>[f(n(ke),{onClick:C},{default:c(()=>[P("Delete only stage")]),_:1}),f(n(ke),{type:"primary",danger:"",onClick:H},{default:c(()=>[P("Yes, delete file")]),_:1})]),_:1})]),default:c(()=>[P(" Do you also want to delete the file associated with the stage "+U(r.stage.title)+"? ",1)]),_:1},8,["open"]),b("div",{class:"stage",onDblclick:v[3]||(v[3]=L=>W.value=!0)},[f(n(ne),{vertical:W.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:c(()=>[(i(),_(Q(n(Ot)(r.stage.type)),{size:18,color:n(g)},null,8,["color"])),W.value?(i(),_(n(qe),{key:1,layout:"vertical"},{default:c(()=>[f(n(_e),{label:"Title"},{default:c(()=>[f(n(he),{value:le.value,"onUpdate:value":v[1]||(v[1]=L=>le.value=L),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),me.value?(i(),_(n(Vt),{key:0,checked:Ae.value,"onUpdate:checked":v[2]||(v[2]=L=>Ae.value=L),style:{"margin-bottom":"12px"}},{default:c(()=>[P(" Update filename to "),f(n(ae),{code:""},{default:c(()=>[P(U(me.value),1)]),_:1})]),_:1},8,["checked"])):S("",!0),r.stage.type==="agents"?(i(),_(mn,{key:1,"stage-props":r.stage.props,"onUpdate:stageProps":A},null,8,["stage-props"])):S("",!0)]),_:1})):(i(),_(n(Mt),{key:0,class:"title"},{default:c(()=>[P(U(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),w.value?(i(),_(n(oa),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):S("",!0),j.value==="prompting"||j.value==="creating"?(i(),_(gn,{key:1,filename:I.value,"file-exists":h.value,"creating-file-status":j.value,onCreateFile:ue,onCancel:T,onUpdateFilename:F},null,8,["filename","file-exists","creating-file-status"])):S("",!0),f(n(aa),{visible:m.value,"onUpdate:visible":v[4]||(v[4]=L=>m.value=L),title:"Tasks",width:"500",onClose:v[5]||(v[5]=L=>m.value=!1)},{default:c(()=>[f(qt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const pe=re(wn,[["__scopeId","data-v-823e17c2"]]),lt=t=>(St("data-v-f4278104"),t=t(),xt(),t),kn={class:"empty-hint"},_n={key:0,class:"drag-hint"},bn=lt(()=>b("div",{class:"title"},"Start here",-1)),$n={key:1,class:"drop-hint"},Cn=lt(()=>b("div",{class:"title"},"Drop here",-1)),Hn={key:2,class:"stages-hint"},An={class:"header"},Mn={class:"title"},Vn={class:"description"},Sn=Z({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,o)=>(i(),y("div",kn,[e.showDragHint?(i(),y("div",_n,[bn,f(n(Oe),{size:32,class:"arrow"})])):S("",!0),e.showDragHint?S("",!0):(i(),y("div",$n,[Cn,f(n(Oe),{size:32,class:"arrow"})])),e.showDragHint?(i(),y("div",Hn,[(i(!0),y(R,null,ge(n(be).stages,s=>(i(),y("div",{key:s.key,class:"stage-hint"},[b("div",An,[(i(),_(Q(s.icon))),b("span",Mn,U(s.title),1)]),b("div",Vn,U(s.description),1)]))),128))])):S("",!0)]))}});const xn=re(Sn,[["__scopeId","data-v-f4278104"]]),In=Z({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;It(a=>({"380e1d00":n(u),"26e1693d":n(g)}));const o=ot(),{useToken:s}=et,{token:l}=s(),g=l.value.colorPrimaryBorder,u=l.value.colorBgElevated,{onInit:k,fitView:m}=q();k(a=>{a.fitView()});const h=a=>{var C;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:a&&(C=e.initialFileCheckStatus[a])!=null?C:!1};return Ce(()=>{const a=te.subscribe("stageCreated",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),C=te.subscribe("stageEdited",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),d=te.subscribe("transitionCreated",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),p=te.subscribe("finishActions",async()=>{Ge(()=>{m()})});Dt(()=>{te.unsubscribe(a),te.unsubscribe(d),te.unsubscribe(C),te.unsubscribe(p)})}),(a,C)=>a.workflow?(i(),_(n(jt),{key:0,nodes:a.workflow.vueFlowNodes.value,edges:a.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":a.editable,"pan-on-scroll":n(tt).isMac,"elements-selectable":a.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":[],onDragover:n(o).onDragOver,onDragleave:n(o).onDragLeave},{"connection-line":c(d=>[f(pn,Et(zt(d)),null,16)]),"edge-task":c(d=>[f(rn,ye(d,{controller:a.workflow}),null,16,["controller"])]),"node-forms":c(d=>[f(pe,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":h(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":c(d=>[f(pe,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":h(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":c(d=>[f(pe,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":h(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":c(d=>[f(pe,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":h(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":c(d=>[f(pe,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":c(d=>[f(pe,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:c(()=>[f(n(Yt)),a.editable&&!a.workflow.vueFlowNodes.value.length?(i(),_(xn,{key:0,"show-drag-hint":a.showDragHint},null,8,["show-drag-hint"])):S("",!0),f(n(Xt),{pannable:"",zoomable:""}),a.editable?(i(),_(en,{key:1,workflow:a.workflow},null,8,["workflow"])):S("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):S("",!0)}});const Dn=re(In,[["__scopeId","data-v-9d205dbf"]]),En=Z({__name:"WorkflowEditor",setup(t){const e=kt(),{init:o,tearDown:s,onDragStart:l,onDrop:g,isDragging:u,isAdding:k,draggedType:m,mousePosition:h}=ot(),{result:a}=Ie(async()=>await mt.init(wt,!0)),C=x(null),d=async()=>{if(!a.value)return;const w=a.value.vueFlowNodes.value.map(D=>{var z,G,$,E,O;return((z=D.data)==null?void 0:z.type)==="forms"||((G=D.data)==null?void 0:G.type)==="hooks"||(($=D.data)==null?void 0:$.type)==="scripts"||((E=D.data)==null?void 0:E.type)==="jobs"?(O=D.data)==null?void 0:O.props.filename:null});C.value=await ve.checkFiles(w.filter(D=>typeof D=="string"))};$e(()=>a.value,()=>{a.value&&(o(a.value),d())});const{onNodeDragStop:p,onEdgesChange:H,getSelectedElements:F,getNodes:A,addSelectedNodes:T,zoomIn:B,fitView:M,zoomOut:I,applyEdgeChanges:j}=q();p(w=>{var D;(D=a.value)==null||D.move(w.nodes.map(z=>({id:z.id,position:z.position})))}),H(w=>{var D;for(const z of w)z.type==="remove"&&((D=a.value)==null||D.delete([z.id]));j(w)});const ue=w=>{var D,z;e.isInputFocused||!a.value||((w.key==="z"||w.key==="Z")&&K(w)&&(yo(w)?a.value.history.redo():(D=a.value)==null||D.history.undo(),w.preventDefault()),K(w)&&(w.key==="s"||w.key==="S")&&((z=a.value)==null||z.save(),w.preventDefault()),!(K(w)&&(w.key==="f"||w.key==="F"))&&(F.value.length||(w.key==="f"||w.key==="F"?l(null,"forms"):w.key==="h"||w.key==="H"?l(null,"hooks"):w.key==="j"||w.key==="J"?l(null,"jobs"):w.key==="t"||w.key==="T"?l(null,"scripts"):(w.key==="a"||w.key==="A")&&K(w)?(T(A.value),w.preventDefault()):w.key==="0"&&K(w)?(M(),w.preventDefault()):(w.key==="="||w.key==="+")&&K(w)?(w.preventDefault(),B()):w.key==="-"&&K(w)&&(w.preventDefault(),I()))))};return Ce(()=>{window.addEventListener("keydown",ue)}),ze(()=>{window.removeEventListener("keydown",ue),s()}),(w,D)=>n(a)?(i(),y("div",{key:0,class:Ee(["workflow-container",{dragging:n(k)}]),onDrop:D[0]||(D[0]=(...z)=>n(g)&&n(g)(...z))},[f(Dn,{workflow:n(a),editable:"","show-drag-hint":!n(k),"check-file-status":!0,"initial-file-check-status":C.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),f(bo,{controller:n(a),onDragStart:n(l)},null,8,["controller","onDragStart"]),(i(!0),y(R,null,ge(n(be).stages,z=>{var G,$;return i(),y("div",{key:z.key},[n(k)&&!n(u)&&z.typeName===n(m)?(i(),y("div",{key:0,class:"dragging-node",style:oe({left:`${(G=n(h))==null?void 0:G.x}px`,top:`${($=n(h))==null?void 0:$.y}px`,position:"absolute",cursor:n(k)?"grabbing":"grab"})},[(i(),_(Q(z.icon),{size:18}))],4)):S("",!0)])}),128))],34)):S("",!0)}});const Cs=re(En,[["__scopeId","data-v-aa8dbb66"]]);export{Cs as default};
//# sourceMappingURL=WorkflowEditor.e9e05c40.js.map

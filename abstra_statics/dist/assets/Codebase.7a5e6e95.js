var z=Object.defineProperty;var B=(s,a,n)=>a in s?z(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n;var T=(s,a,n)=>(B(s,typeof a!="symbol"?a+"":a,n),n);import{S as L}from"./SourceCode.e3cb0f5e.js";import{_ as V}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.821d7c5c.js";import{C as W}from"./ContentLayout.0ff89c94.js";import{i as U,F as H,I as J,_ as O}from"./FilesNavigator.80836182.js";import{S as K}from"./SaveButton.bd655e5f.js";import{G as Q,I as X}from"./PhFilePy.vue.1f43d7bb.js";import{G as Y}from"./PhFolder.vue.5e7ade12.js";import{H as Z,F as ee}from"./PhPackage.vue.8bf7b48d.js";import{r as k,c as A,d as te,e4 as re,a as o,b,u as r,o as i,e as N,f as j,g as ae,A as se,h as D,db as ne,eI as oe,cC as ie,_ as ce}from"./jwt-decode.esm.d8763b5b.js";import{F as le,G as ue,a as pe,I as de}from"./PhWebhooksLogo.vue.709f8213.js";import"./linters.17034461.js";import{F as me,C as he}from"./filesController.f9a12522.js";import{W as fe}from"./workspaces.de471929.js";import"./omniChatStore.b69b1ac5.js";import"./record.19092615.js";import"./asyncComputed.82e95638.js";import"./polling.92851069.js";import"./validations.4e5a0aba.js";import"./string.3420fdec.js";import"./toggleHighContrast.2057d1be.js";import"./index.ffbfa13f.js";import"./Card.d9d1f8ed.js";import"./TabPane.382e7070.js";import"./Logo.baae960b.js";import"./popupNotifcation.7f1daeb6.js";import"./ant-design.45c13f7b.js";import"./PhDotsThree.vue.c96f87ab.js";import"./UnsavedChangesHandler.b5421034.js";import"./ExclamationCircleOutlined.663513a4.js";import"./runnerData.8197ed0d.js";import"./url.b9e61201.js";import"./colorHelpers.aaea5d39.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="05609eba-4e67-41af-9e9b-1b3ddf2a1cf1",s._sentryDebugIdIdentifier="sentry-dbid-05609eba-4e67-41af-9e9b-1b3ddf2a1cf1")}catch{}})();const ge=s=>{switch(s){case"abap":return"abap";case"apex":return"apex";case"azcli":return"azcli";case"bat":return"bat";case"bicep":return"bicep";case"c":return"c";case"cameligo":return"cameligo";case"clojure":return"clojure";case"coffeescript":return"coffeescript";case"cpp":return"cpp";case"csharp":return"csharp";case"csp":return"csp";case"css":return"css";case"cypher":return"cypher";case"dart":return"dart";case"dockerfile":return"dockerfile";case"ecl":return"ecl";case"elixir":return"elixir";case"flow9":return"flow9";case"freemarker2":return"freemarker2";case"freemarker2.tag-angle.interpolation-bracket":return"freemarker2.tag-angle.interpolation-bracket";case"freemarker2.tag-angle.interpolation-dollar":return"freemarker2.tag-angle.interpolation-dollar";case"freemarker2.tag-auto.interpolation-bracket":return"freemarker2.tag-auto.interpolation-bracket";case"freemarker2.tag-auto.interpolation-dollar":return"freemarker2.tag-auto.interpolation-dollar";case"freemarker2.tag-bracket.interpolation-bracket":return"freemarker2.tag-bracket.interpolation-bracket";case"freemarker2.tag-bracket.interpolation-dollar":return"freemarker2.tag-bracket.interpolation-dollar";case"fsharp":return"fsharp";case"go":return"go";case"graphql":return"graphql";case"handlebars":return"handlebars";case"hcl":return"hcl";case"html":return"html";case"ini":return"ini";case"java":return"java";case"javascript":return"javascript";case"json":return"json";case"julia":return"julia";case"kotlin":return"kotlin";case"less":return"less";case"lexon":return"lexon";case"liquid":return"liquid";case"lua":return"lua";case"m3":return"m3";case"markdown":return"markdown";case"mdx":return"mdx";case"mips":return"mips";case"msdax":return"msdax";case"mysql":return"mysql";case"objective-c":return"objective-c";case"pascal":return"pascal";case"pascaligo":return"pascaligo";case"perl":return"perl";case"pgsql":return"pgsql";case"php":return"php";case"pla":return"pla";case"plaintext":return"plaintext";case"postiats":return"postiats";case"powerquery":return"powerquery";case"powershell":return"powershell";case"proto":return"proto";case"pug":return"pug";case"python":return"python";case"qsharp":return"qsharp";case"r":return"r";case"razor":return"razor";case"redis":return"redis";case"redshift":return"redshift";case"restructuredtext":return"restructuredtext";case"ruby":return"ruby";case"rust":return"rust";case"sb":return"sb";case"scala":return"scala";case"scheme":return"scheme";case"scss":return"scss";case"shell":return"shell";case"sol":return"sol";case"sparql":return"sparql";case"sql":return"sql";case"st":return"st";case"swift":return"swift";case"systemverilog":return"systemverilog";case"tcl":return"tcl";case"twig":return"twig";case"typescript":return"typescript";case"typespec":return"typespec";case"vb":return"vb";case"verilog":return"verilog";case"xml":return"xml";case"yaml":return"yaml";default:return"plaintext"}};class ye{constructor(a,n,d,p){T(this,"initialContent");this.fileNode=a,this.content=n,this.sep=d,this.onSave=p,this.initialContent=new Uint8Array(n)}get file(){return this.fileNode.pathParts.join(this.sep)}get codeContent(){return this.text}set codeContent(a){this.text=a}updateInitialState(a,n){this.initialContent=new TextEncoder().encode(n)}get text(){return new TextDecoder().decode(this.content)}set text(a){const n=new TextEncoder;this.content=n.encode(a)}get url(){return`/_editor/api/codebase/files/${this.file}`}hasChanges(){return this.content.length!==this.initialContent.length||!this.content.every((a,n)=>a===this.initialContent[n])}async save(){await this.onSave(this),this.initialContent=new Uint8Array(this.content)}isImage(){return U(this.file)}isText(){return!this.isImage()}}const ke=s=>{const a=k([]),n=k(!1),d=k(null),p=k({separator:"/"}),m=new me(s.api,p.value),h=async()=>{n.value=!0;try{a.value=await s.api.list()}finally{n.value=!1}},F=async()=>{p.value=await s.api.settings()},f=s.router.currentRoute.value.query.f,q=async(e,u)=>{await m.uploadFile(e,u),await h()},P=async e=>{await m.deleteFile(e),await h()},I=async(e,u)=>{await m.renameFile(e,u),await h()},w=async(e,u)=>{await m.editFile(e,u)},E=async e=>await m.getFile(e),v=async e=>{await m.mkdir(e),await h()},$=e=>{switch(e.type){case"form":return{name:"formEditor",params:{id:e.id}};case"hook":return{name:"hookEditor",params:{id:e.id}};case"job":return{name:"jobEditor",params:{id:e.id}};case"script":return{name:"scriptEditor",params:{id:e.id}};default:throw new Error(`Unknown stage type: ${e.type}`)}},x=async e=>{var C;const u=e.join(p.value.separator),c=a.value.find(y=>y.file.pathParts.join(p.value.separator)===u);if(!c)throw new Error(`File not found: ${u}`);if(c.file.type==="directory")d.value=null;else if(c.file.pathParts.length===1&&c.file.pathParts[0]==="requirements.txt")s.router.push({name:"settingsRequirements"});else if(c.file.pathParts.length===1&&c.file.pathParts[0]===".env")s.router.push({name:"env-vars"});else if(!c.stages||c.stages.length===0)d.value=new ye(c.file,await E(e),(C=p.value.separator)!=null?C:"/",({content:t})=>w(e,t)),new URL(window.location.href).searchParams.set("f",e.join(p.value.separator)),s.router.replace({query:{...s.router.currentRoute.value.query,f:e}});else if(c.stages.length===1){const y=c.stages[0];s.router.push($(y))}},R=A(()=>a.value.map(({file:e})=>e)),S=A(()=>{var u;const e=(u=d.value)==null?void 0:u.file.split(".").pop();return e?ge(e):"plaintext"}),g=A(()=>d.value?d.value:null),_=k(null);return fe.get().then(e=>{_.value=e}),Promise.all([h(),F()]).then(()=>{typeof f=="string"&&x(f.split(p.value.separator))}),{files:R,loading:n,editing:d,language:S,settings:p,mkdir:v,fetchFiles:h,uploadFile:q,deleteFile:P,renameFile:I,editFile:w,open:x,sourceCodeEditable:g,workspaceModel:_,filesListResponse:a}},be={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"stretch","align-items":"stretch"}},we={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ve=te({__name:"Codebase",setup(s){const a=re(),n=t=>t.type==="file"&&t.pathParts[t.pathParts.length-1].endsWith(".py"),d=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]==="abstra.json",p=t=>t.type==="file"&&U(t.pathParts[t.pathParts.length-1]),m=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]==="requirements.txt",h=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]===".env",F=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]===".gitignore",f=(t,G)=>C.value.some(l=>l.stages.some(M=>M.type===t)&&l.file.pathParts.join("/")===G.pathParts.join("/")),q=t=>f("form",t),P=t=>f("hook",t),I=t=>f("job",t),w=t=>f("script",t),E=new he,{loading:v,uploadFile:$,deleteFile:x,open:R,files:S,editing:g,renameFile:_,sourceCodeEditable:e,mkdir:u,workspaceModel:c,filesListResponse:C,settings:y}=ke({api:E,router:a});return(t,G)=>(i(),o(W,{"full-width":!!r(g)},{default:b(()=>[N("div",be,[N("div",we,[j(r(se),null,{default:b(()=>[ae("Project files")]),_:1}),r(e)?(i(),o(K,{key:0,model:r(e),disabled:r(v)},null,8,["model","disabled"])):D("",!0)]),j(O,{"inner-class":"scroll-area","outer-style":{flexGrow:1},"inner-style":{display:"flex",justifyContent:"stretch",gap:"20px"}},{default:b(()=>[j(H,{class:"files-nav",files:r(S),loading:r(v),separator:r(y).separator,onCreate:r($),onDelete:r(x),onOpen:r(R),onRename:r(_),onMkdir:r(u)},{icon:b(({file:l})=>[j(r(ne),{style:{height:"100%"},justify:"center",align:"center"},{default:b(()=>[l.type==="directory"?(i(),o(r(Y),{key:0})):q(l)?(i(),o(r(le),{key:1})):P(l)?(i(),o(r(ue),{key:2})):I(l)?(i(),o(r(pe),{key:3})):w(l)?(i(),o(r(de),{key:4})):n(l)?(i(),o(r(Q),{key:5})):d(l)?(i(),o(V,{key:6,"hide-text":""})):m(l)?(i(),o(r(Z),{key:7})):h(l)?(i(),o(r(X),{key:8})):p(l)?(i(),o(r(oe),{key:9})):F(l)?(i(),o(r(ee),{key:10})):(i(),o(r(J),{key:11}))]),_:2},1024)]),_:1},8,["files","loading","separator","onCreate","onDelete","onOpen","onRename","onMkdir"]),r(g)&&r(g).isImage()?(i(),o(r(ie),{key:0,class:"editing-content",src:r(g).url},null,8,["src"])):r(e)&&r(c)?(i(),o(L,{key:1,script:r(e),class:"editing-content","hide-header":"",workspace:r(c)},null,8,["script","workspace"])):D("",!0)]),_:1})])]),_:1},8,["full-width"]))}});const tt=ce(ve,[["__scopeId","data-v-d29a6b1b"]]);export{tt as default};
//# sourceMappingURL=Codebase.7a5e6e95.js.map

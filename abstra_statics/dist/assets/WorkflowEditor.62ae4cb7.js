var st=Object.defineProperty;var nt=(t,e,o)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var ge=(t,e,o)=>(nt(t,typeof e!="symbol"?e+"":e,o),o);import{g as lt,W as it,w as rt}from"./controller.a402f323.js";import{o as q,u as ut}from"./omniChatStore.4b72ae26.js";import{a as dt}from"./asyncComputed.c1514d75.js";import{d as B,af as N,g as x,o as i,K as v,O as T,F as A,e5 as de,a as _,b as h,w as f,u as l,aL as G,ea as ce,c as H,da as K,d5 as oe,az as Z,eb as Y,ei as U,cH as ct,Q as le,f as D,h as $e,bu as be,am as Le,aP as Ze,ec as He,N as R,bM as ve,J as me,a8 as Ce,bE as Ve,cs as Pe,cr as Ne,cE as Ye,eA as pt,e3 as ft,ej as gt,d2 as ht,bH as vt,eP as mt,eQ as yt,eo as wt,aj as kt,ep as _t,eq as bt}from"./index.fd66f361.js";import{u as X,P as $t,_ as Ht,g as Oe,a as Ct,b as Vt,c as re,N as xt,e as At,M as Mt,f as St}from"./index.f303a37e.js";import"./linters.25176e5c.js";import{W as ue}from"./workspaces.5564e380.js";import{U as Dt}from"./UnsavedChangesHandler.c9ee5110.js";import{w as xe,s as Et}from"./metadata.79a32911.js";import{_ as zt,a as Ft}from"./vue-flow-minimap.24745f28.js";import{G as It}from"./PhArrowCounterClockwise.vue.064f9df6.js";import{F as Tt,C as Bt}from"./filesController.f12ed6af.js";import{T as Lt}from"./TasksManager.30284d3d.js";import{n as Zt}from"./string.973cdadd.js";import{a as Pt,b as Nt,n as Yt}from"./validations.9d3f6d16.js";import"./index.342e80c7.js";import{A as Ot}from"./index.5c28de1b.js";import{t as Xe}from"./index.19aeeb1f.js";import{B as Xt}from"./Badge.7cfeacae.js";import{G as Te}from"./PhArrowDown.vue.d1e08775.js";import"./uuid.0988391e.js";import"./record.8d6523fc.js";import"./runnerData.4633183b.js";import"./url.32de1d47.js";import"./colorHelpers.ffad89ea.js";import"./ExclamationCircleOutlined.06153509.js";import"./PhWebhooksLogo.vue.cd20e8b0.js";import"./tasksController.c343a60e.js";import"./gateway.c8676992.js";import"./popupNotifcation.45eb3465.js";import"./scripts.5832e54b.js";import"./polling.5fe64c23.js";import"./ant-design.01b4eef9.js";import"./PhArrowSquareOut.vue.761d1db3.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.fe7e55b8.js";import"./index.c2006748.js";import"./Card.e007ce72.js";import"./TabPane.e5cfdd05.js";import"./CollapsePanel.6e31af79.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="dcfe13c6-df64-48ab-a626-556a0d64b2fb",t._sentryDebugIdIdentifier="sentry-dbid-dcfe13c6-df64-48ab-a626-556a0d64b2fb")}catch{}})();const Wt=["width","height","fill","transform"],jt={key:0},Ut=_("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Gt=[Ut],qt={key:1},Rt=_("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Kt=_("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Jt=[Rt,Kt],Qt={key:2},ea=_("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),ta=[ea],aa={key:3},oa=_("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),sa=[oa],na={key:4},la=_("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ia=[la],ra={key:5},ua=_("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),da=[ua],ca={name:"PhArrowClockwise"},pa=B({...ca,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,o=N("weight","regular"),n=N("size","1em"),s=N("color","currentColor"),u=N("mirrored",!1),c=x(()=>{var a;return(a=e.weight)!=null?a:o}),k=x(()=>{var a;return(a=e.size)!=null?a:n}),y=x(()=>{var a;return(a=e.color)!=null?a:s}),g=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(a,C)=>(i(),v("svg",de({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:y.value,transform:g.value},a.$attrs),[T(a.$slots,"default"),c.value==="bold"?(i(),v("g",jt,Gt)):c.value==="duotone"?(i(),v("g",qt,Jt)):c.value==="fill"?(i(),v("g",Qt,ta)):c.value==="light"?(i(),v("g",aa,sa)):c.value==="regular"?(i(),v("g",na,ia)):c.value==="thin"?(i(),v("g",ra,da)):A("",!0)],16,Wt))}}),fa=["width","height","fill","transform"],ga={key:0},ha=_("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),va=[ha],ma={key:1},ya=_("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),wa=_("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),ka=[ya,wa],_a={key:2},ba=_("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),$a=[ba],Ha={key:3},Ca=_("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Va=[Ca],xa={key:4},Aa=_("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ma=[Aa],Sa={key:5},Da=_("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Ea=[Da],za={name:"PhFunnel"},Fa=B({...za,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,o=N("weight","regular"),n=N("size","1em"),s=N("color","currentColor"),u=N("mirrored",!1),c=x(()=>{var a;return(a=e.weight)!=null?a:o}),k=x(()=>{var a;return(a=e.size)!=null?a:n}),y=x(()=>{var a;return(a=e.color)!=null?a:s}),g=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(a,C)=>(i(),v("svg",de({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:y.value,transform:g.value},a.$attrs),[T(a.$slots,"default"),c.value==="bold"?(i(),v("g",ga,va)):c.value==="duotone"?(i(),v("g",ma,ka)):c.value==="fill"?(i(),v("g",_a,$a)):c.value==="light"?(i(),v("g",Ha,Va)):c.value==="regular"?(i(),v("g",xa,Ma)):c.value==="thin"?(i(),v("g",Sa,Ea)):A("",!0)],16,fa))}}),Ia=["width","height","fill","transform"],Ta={key:0},Ba=_("path",{d:"M160,116h48a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20V60H128a28,28,0,0,0-28,28v28H76v-4A20,20,0,0,0,56,92H24A20,20,0,0,0,4,112v32a20,20,0,0,0,20,20H56a20,20,0,0,0,20-20v-4h24v28a28,28,0,0,0,28,28h12v12a20,20,0,0,0,20,20h48a20,20,0,0,0,20-20V160a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20v12H128a4,4,0,0,1-4-4V88a4,4,0,0,1,4-4h12V96A20,20,0,0,0,160,116ZM52,140H28V116H52Zm112,24h40v40H164Zm0-112h40V92H164Z"},null,-1),La=[Ba],Za={key:1},Pa=_("path",{d:"M64,112v32a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V112a8,8,0,0,1,8-8H56A8,8,0,0,1,64,112ZM208,40H160a8,8,0,0,0-8,8V96a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V48A8,8,0,0,0,208,40Zm0,112H160a8,8,0,0,0-8,8v48a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152Z",opacity:"0.2"},null,-1),Na=_("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),Ya=[Pa,Na],Oa={key:2},Xa=_("path",{d:"M144,96V80H128a8,8,0,0,0-8,8v80a8,8,0,0,0,8,8h16V160a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16v48a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V192H128a24,24,0,0,1-24-24V136H72v8a16,16,0,0,1-16,16H24A16,16,0,0,1,8,144V112A16,16,0,0,1,24,96H56a16,16,0,0,1,16,16v8h32V88a24,24,0,0,1,24-24h16V48a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16V96a16,16,0,0,1-16,16H160A16,16,0,0,1,144,96Z"},null,-1),Wa=[Xa],ja={key:3},Ua=_("path",{d:"M160,110h48a14,14,0,0,0,14-14V48a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14V66H128a22,22,0,0,0-22,22v34H70V112A14,14,0,0,0,56,98H24a14,14,0,0,0-14,14v32a14,14,0,0,0,14,14H56a14,14,0,0,0,14-14V134h36v34a22,22,0,0,0,22,22h18v18a14,14,0,0,0,14,14h48a14,14,0,0,0,14-14V160a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14v18H128a10,10,0,0,1-10-10V88a10,10,0,0,1,10-10h18V96A14,14,0,0,0,160,110ZM58,144a2,2,0,0,1-2,2H24a2,2,0,0,1-2-2V112a2,2,0,0,1,2-2H56a2,2,0,0,1,2,2Zm100,16a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2v48a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Zm0-112a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2V96a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Z"},null,-1),Ga=[Ua],qa={key:4},Ra=_("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),Ka=[Ra],Ja={key:5},Qa=_("path",{d:"M160,108h48a12,12,0,0,0,12-12V48a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12V68H128a20,20,0,0,0-20,20v36H68V112a12,12,0,0,0-12-12H24a12,12,0,0,0-12,12v32a12,12,0,0,0,12,12H56a12,12,0,0,0,12-12V132h40v36a20,20,0,0,0,20,20h20v20a12,12,0,0,0,12,12h48a12,12,0,0,0,12-12V160a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12v20H128a12,12,0,0,1-12-12V88a12,12,0,0,1,12-12h20V96A12,12,0,0,0,160,108ZM60,144a4,4,0,0,1-4,4H24a4,4,0,0,1-4-4V112a4,4,0,0,1,4-4H56a4,4,0,0,1,4,4Zm96,16a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4v48a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Zm0-112a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V96a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Z"},null,-1),eo=[Qa],to={name:"PhTreeStructure"},ao=B({...to,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,o=N("weight","regular"),n=N("size","1em"),s=N("color","currentColor"),u=N("mirrored",!1),c=x(()=>{var a;return(a=e.weight)!=null?a:o}),k=x(()=>{var a;return(a=e.size)!=null?a:n}),y=x(()=>{var a;return(a=e.color)!=null?a:s}),g=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(a,C)=>(i(),v("svg",de({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:y.value,transform:g.value},a.$attrs),[T(a.$slots,"default"),c.value==="bold"?(i(),v("g",Ta,La)):c.value==="duotone"?(i(),v("g",Za,Ya)):c.value==="fill"?(i(),v("g",Oa,Wa)):c.value==="light"?(i(),v("g",ja,Ga)):c.value==="regular"?(i(),v("g",qa,Ka)):c.value==="thin"?(i(),v("g",Ja,eo)):A("",!0)],16,Ia))}});class We{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const W=t=>We.isMac?t.metaKey:t.ctrlKey,oo=t=>t.shiftKey,so=["onDragstart"],no={style:{display:"flex","flex-direction":"column","max-width":"250px"}},lo=B({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){return(o,n)=>(i(),v(G,null,[h(l(K),{class:"toolbar",align:"center"},{default:f(()=>[(i(!0),v(G,null,ce(l(xe).stages,s=>(i(),H(l(ct),{key:s.key,placement:"top"},{title:f(()=>[h(l(K),{gap:"small"},{default:f(()=>[h(l(oe),null,{default:f(()=>[Z(Y(s.title),1)]),_:2},1024),h(l(oe),{keyboard:""},{default:f(()=>[Z(Y(s.key),1)]),_:2},1024)]),_:2},1024)]),content:f(()=>[_("div",no,[h(l(oe),null,{default:f(()=>[Z(Y(s.description),1)]),_:2},1024)])]),default:f(()=>[_("div",{draggable:!0,class:"toolbar__item",onDragstart:u=>e("drag-start",u.dataTransfer,s.typeName)},[(i(),H(U(s.icon),{size:18}))],40,so)]),_:2},1024))),128))]),_:1}),h(Dt,{"has-changes":o.controller.hasChanges()},null,8,["has-changes"])],64))}});const io=le(lo,[["__scopeId","data-v-376981bb"]]);function je(){let t;const e={draggedType:D(null),isDragOver:D(!1),isAdding:D(!1),isDragging:D(!1),mousePosition:D(null)},{draggedType:o,isDragOver:n,isDragging:s,isAdding:u}=e,c=V=>{t=V,document.addEventListener("mousemove",d)},{screenToFlowCoordinate:k}=X();$e(u,V=>{document.body.style.userSelect=V?"none":""});function y(V,E){u.value=!0,V?(V.setData("application/vueflow",E),V.effectAllowed="move",o.value=E,s.value=!0,document.addEventListener("drop",C)):(o.value=E,document.addEventListener("click",$))}function g(V){V.preventDefault(),o.value&&(n.value=!0,V.dataTransfer&&(V.dataTransfer.dropEffect="move"))}function a(){n.value=!1}function C(){u.value=!1,s.value=!1,n.value=!1,o.value=null,document.removeEventListener("drop",C)}function d(V){const E={x:V.pageX-200,y:V.pageY-80};e.mousePosition.value=E}function p(V){if(!o.value)throw new Error("No dragged type");return k({x:V.clientX-70,y:V.clientY-25})}function $(V){if(!t)return;if(!o.value)throw new Error("No dragged type");const E=p(V);t.addStages([{type:o.value,position:E}]),C()}function L(){document.removeEventListener("mousemove",d)}return{init:c,tearDown:L,draggedType:o,isDragOver:n,isAdding:u,isDragging:s,mousePosition:e.mousePosition,onDragStart:y,onDragLeave:a,onDragOver:g,onDrop:$}}const ro={name:"ControlButton",compatConfig:{MODE:3}},uo=(t,e)=>{const o=t.__vccOpts||t;for(const[n,s]of e)o[n]=s;return o},co={class:"vue-flow__controls-button"};function po(t,e,o,n,s,u){return i(),v("button",co,[T(t.$slots,"default")])}const ae=uo(ro,[["render",po]]),fo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},go=_("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),ho=[go];function vo(t,e){return i(),v("svg",fo,ho)}const mo={render:vo},yo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},wo=_("path",{d:"M0 0h32v4.2H0z"},null,-1),ko=[wo];function _o(t,e){return i(),v("svg",yo,ko)}const bo={render:_o},$o={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ho=_("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Co=[Ho];function Vo(t,e){return i(),v("svg",$o,Co)}const xo={render:Vo},Ao={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Mo=_("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),So=[Mo];function Do(t,e){return i(),v("svg",Ao,So)}const Eo={render:Do},zo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Fo=_("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),Io=[Fo];function To(t,e){return i(),v("svg",zo,Io)}const Bo={render:To},Lo={name:"Controls",compatConfig:{MODE:3}},Zo=B({...Lo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>$t.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:o,nodesConnectable:n,elementsSelectable:s,setInteractive:u,zoomIn:c,zoomOut:k,fitView:y,viewport:g,minZoom:a,maxZoom:C}=X(),d=be(()=>o.value||n.value||s.value),p=be(()=>g.value.zoom<=a.value),$=be(()=>g.value.zoom>=C.value);function L(){c(),e("zoomIn")}function V(){k(),e("zoomOut")}function E(){y(t.fitViewParams),e("fitView")}function F(){u(!d.value),e("interactionChange",!d.value)}return(b,I)=>(i(),H(l(Ht),{class:"vue-flow__controls",position:b.position},{default:f(()=>[T(b.$slots,"top"),b.showZoom?(i(),v(G,{key:0},[T(b.$slots,"control-zoom-in",{},()=>[h(ae,{class:"vue-flow__controls-zoomin",disabled:$.value,onClick:L},{default:f(()=>[T(b.$slots,"icon-zoom-in",{},()=>[(i(),H(U(l(mo))))])]),_:3},8,["disabled"])]),T(b.$slots,"control-zoom-out",{},()=>[h(ae,{class:"vue-flow__controls-zoomout",disabled:p.value,onClick:V},{default:f(()=>[T(b.$slots,"icon-zoom-out",{},()=>[(i(),H(U(l(bo))))])]),_:3},8,["disabled"])])],64)):A("",!0),b.showFitView?T(b.$slots,"control-fit-view",{key:1},()=>[h(ae,{class:"vue-flow__controls-fitview",onClick:E},{default:f(()=>[T(b.$slots,"icon-fit-view",{},()=>[(i(),H(U(l(xo))))])]),_:3})]):A("",!0),b.showInteractive?T(b.$slots,"control-interactive",{key:2},()=>[b.showInteractive?(i(),H(ae,{key:0,class:"vue-flow__controls-interactive",onClick:F},{default:f(()=>[d.value?T(b.$slots,"icon-unlock",{key:0},()=>[(i(),H(U(l(Bo))))]):A("",!0),d.value?A("",!0):T(b.$slots,"icon-lock",{key:1},()=>[(i(),H(U(l(Eo))))])]),_:3})):A("",!0)]):A("",!0),T(b.$slots,"default")]),_:3},8,["position"]))}}),Po=B({__name:"ControlButtons",props:{workflow:{}},setup(t){const e=t,{fitView:o}=X(),n=()=>{e.workflow.autoLayout(),Le(()=>{o()})};return(s,u)=>(i(),H(l(Zo),{position:"top-left","show-interactive":!1},{default:f(()=>[h(l(ae),{title:"Auto layout",onClick:u[0]||(u[0]=c=>n())},{default:f(()=>[h(l(ao))]),_:1}),h(l(ae),{title:"Undo",disabled:!s.workflow.history.canUndo(),onClick:u[1]||(u[1]=c=>s.workflow.history.undo())},{default:f(()=>[h(l(It))]),_:1},8,["disabled"]),h(l(ae),{title:"Redo",disabled:!s.workflow.history.canRedo(),onClick:u[2]||(u[2]=c=>s.workflow.history.redo())},{default:f(()=>[h(l(pa))]),_:1},8,["disabled"])]),_:1}))}});class P{constructor(e){ge(this,"angle");e=P.normalize(e),this.angle=e}static normalize(e){const o=Math.PI;return((e+o)%(2*o)+2*o)%(2*o)-o}static fromRadians(e){return new P(P.normalize(e))}static fromDegrees(e){const o=e*Math.PI/180;return new P(o)}static fromPoints(e,o){const n=o.x-e.x,s=o.y-e.y,u=Math.atan2(s,n);return new P(u)}get degrees(){return this.angle*180/Math.PI}get radians(){return this.angle}get isZero(){return this.angle===0}get isPositive(){return this.angle>0}get complementary(){return new P(Math.PI/2-this.angle)}get perpendicular(){return new P(Math.PI/2+this.angle)}get sin(){return Math.sin(this.angle)}get cos(){return Math.cos(this.angle)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new P(this.angle/e)}multiply(e){return new P(this.angle*e)}}class j{constructor(e,o){ge(this,"dx");ge(this,"dy");this.dx=e,this.dy=o}static fromPoints(e,o){const n=o.x-e.x,s=o.y-e.y;return new j(n,s)}static fromAngleAndLength(e,o){const n=o*e.cos,s=o*e.sin;return new j(n,s)}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}get opposite(){return new j(-this.dx,-this.dy)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new j(this.dx/e,this.dy/e)}add(e){return new j(this.dx+e.dx,this.dy+e.dy)}subtract(e){return new j(this.dx-e.dx,this.dy-e.dy)}}function No(t,e,o=1e-10){const n=e.center.x-e.width/2,s=e.center.x+e.width/2,u=e.center.y-e.height/2,c=e.center.y+e.height/2;return t.x>=n-o&&t.x<=s+o&&t.y>=u-o&&t.y<=c+o}function Be(t,e,o,n=1e-10){const s=o.center.x-o.width/2,u=o.center.x+o.width/2,c=o.center.y-o.height/2,k=o.center.y+o.height/2,y=e.x-t.x,g=e.y-t.y;let a=1/0,C=null;if(No(t,o,n))return null;if(Math.abs(y)>n){const d=(s-t.x)/y;if(d>0&&d<a){const p=t.y+d*g;p>=c-n&&p<=k+n&&(a=d,C={x:s,y:p})}}if(Math.abs(y)>n){const d=(u-t.x)/y;if(d>0&&d<a){const p=t.y+d*g;p>=c-n&&p<=k+n&&(a=d,C={x:u,y:p})}}if(Math.abs(g)>n){const d=(c-t.y)/g;if(d>0&&d<a){const p=t.x+d*y;p>=s-n&&p<=u+n&&(a=d,C={x:p,y:c})}}if(Math.abs(g)>n){const d=(k-t.y)/g;if(d>0&&d<a){const p=t.x+d*y;p>=s-n&&p<=u+n&&(a=d,C={x:p,y:k})}}return C}function Yo(t,e,o=0,n=0){o=Math.abs(o),t.height+=o*2,t.width+=o*2,e.height+=o*2,e.width+=o*2;const s=P.fromPoints(t.center,e.center),u=n*s.perpendicular.cos,c=n*s.perpendicular.sin,k={x:t.center.x+u,y:t.center.y+c},y={x:e.center.x+u,y:e.center.y+c};let g=Be(k,y,e);g||(g=e.center);let a=Be(y,k,t);return a||(a=t.center),{sourceX:a.x,sourceY:a.y,targetX:g.x,targetY:g.y}}function Oo(t,e=0){const o=P.fromPoints({x:t.sourceX,y:t.sourceY},{x:t.targetX,y:t.targetY}),n=Math.sqrt(Math.pow(t.targetX-t.sourceX,2)+Math.pow(t.targetY-t.sourceY,2)),s=P.fromRadians(Math.atan(2*e/n)).multiply(4),u=n/2/s.divide(2).sin,c=new j(t.sourceX+t.targetX,t.sourceY+t.targetY).divide(2),k=u*(1+(s.isPositive?-1:1)*s.divide(2).cos),y=j.fromAngleAndLength(o.perpendicular,k),g=e>0===s.isPositive?c.add(y):c.subtract(y);return{sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,labelX:g.x,labelY:g.y,radius:u,largeArcFlag:s.isPositive?0:1,sweepFlag:0}}function Ue(t,e,o=0,n=0){const u={center:{x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},width:t.dimensions.width,height:t.dimensions.height},k={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return Yo(u,k,o,n)}function Ge(t,e,o=0){return Ue(t,e,10,o)}function Xo(t,e,o=0){o=Math.abs(o);const n=Ge(t,e,o/2);if(o===0)return Oe(n);const s=Oo(n,o);return[`M${s.sourceX},${s.sourceY} A${s.radius},${s.radius} 0 ${s.largeArcFlag},${s.sweepFlag} ${s.targetX},${s.targetY}`,s.labelX,s.labelY,0,0]}const Wo=B({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,o)=>(i(),H(l(K),{vertical:"",gap:"small",style:R({marginBottom:`-${16*e.menuOptions.length}%`})},{default:f(()=>[(i(!0),v(G,null,ce(e.menuOptions,n=>(i(),H(l(Ze),{key:n.label,title:n.tooltip,placement:"right"},{default:f(()=>[h(l(ve),{class:He([{"warning-button":n.warning}]),disabled:n.disabled,style:R({backgroundColor:n.disabled?"#f5f5f5":void 0}),onClick:s=>n.click(s)},{default:f(()=>[h(l(K),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:f(()=>[Z(Y(n.label)+" ",1),n.key?(i(),H(l(oe),{key:0,keyboard:"",disabled:n.disabled},{default:f(()=>[Z(Y(n.key),1)]),_:2},1032,["disabled"])):A("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const jo=B({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,o=[{label:"Edit task type",key:"E",click:()=>s.value="editing"},{label:"Delete",key:"Del",click:()=>d(e.data.id)}],n=D(e.data.props.taskType||""),s=D("idle"),u=()=>{s.value!=="idle"&&(n.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:n.value}),s.value="idle")},{onEdgeClick:c,onPaneClick:k,getSelectedEdges:y}=X();c(p=>{p.edge.id===e.id&&s.value==="idle"&&(s.value="selected")}),k(()=>u());const g=x(()=>e.controller.edgeIsLonely(e.id)?0:20),a=x(()=>Xo(e.sourceNode,e.targetNode,g.value)),C=p=>{if(!!y.value.map($=>$.id).includes(e.data.id)&&(p.key==="Enter"&&u(),(p.key==="e"||p.key==="E")&&(s.value="editing"),p.key==="Backspace"||p.key==="Delete")){if(s.value==="editing")return;d(e.data.id)}},{removeEdges:d}=X();return me(()=>window.addEventListener("keydown",C)),Ce(()=>window.removeEventListener("keydown",C)),(p,$)=>(i(),v(G,null,[h(l(Ct),{path:a.value[0],"marker-end":p.markerEnd},null,8,["path","marker-end"]),h(l(Vt),null,{default:f(()=>[s.value==="idle"?(i(),v("div",{key:0,style:R({transform:`translate(-50%, -50%) translate(${a.value[1]}px,${a.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(i(),H(l(oe),{key:1},{default:f(()=>[Z(Y(e.data.props.taskType),1)]),_:1})):(i(),H(l(Fa),{key:0,size:16}))],4)):s.value==="selected"?(i(),v("div",{key:1,style:R({transform:`translate(-50%, -120%) translate(${a.value[1]}px,${a.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[h(Wo,{"is-connecting":!0,"is-editing":!0,"menu-options":o})],4)):s.value==="editing"?(i(),v("div",{key:2,style:R({transform:`translate(-50%, -50%) translate(${a.value[1]}px,${a.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[h(l(Ve),{value:n.value,"onUpdate:value":$[0]||($[0]=L=>n.value=L),placeholder:"Task type"},null,8,["value"])],4)):A("",!0)]),_:1})],64))}});const Uo=le(jo,[["__scopeId","data-v-dd919c09"]]),Go={key:0},qo=_("defs",null,[_("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[_("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),Ro=["d"],Ko=B({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,o=D(!0),{onNodeMouseEnter:n,onNodeMouseLeave:s}=X();n(y=>{y.node.id===e.sourceNode.id&&(o.value=!1)}),s(y=>{y.node.id===e.sourceNode.id&&(o.value=!0)});const u=x(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),c=x(()=>Ge(e.sourceNode,u.value)),k=x(()=>Oe(c.value));return(y,g)=>o.value?(i(),v("g",Go,[qo,_("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:k.value[0],"marker-end":"url(#arrowhead)"},null,8,Ro)])):A("",!0)}}),Jo=B({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const o=t,n=x(()=>{const s=Pt(o.filename);return s.valid?o.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:s});return(s,u)=>(i(),H(l(Ye),{open:s.creatingFileStatus==="prompting"||s.creatingFileStatus==="creating",closable:!1,"confirm-loading":s.creatingFileStatus==="creating",onOk:u[1]||(u[1]=c=>e("create-file",s.filename)),onCancel:u[2]||(u[2]=c=>e("cancel"))},{default:f(()=>[h(l(Ne),{layout:"vertical",disabled:s.creatingFileStatus=="creating"},{default:f(()=>[h(l(Pe),{label:"You're creating a new file. What should it be called?","validate-status":n.value.valid?"success":"error",help:n.value.valid?n.value.help:n.value.reason},{default:f(()=>[h(l(Ve),{value:s.filename,onChange:u[0]||(u[0]=c=>e("update-filename",c.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),Qo={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},es=B({...Qo,props:{nodeId:null,isVisible:{type:Boolean},position:{default:re.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,o=N(xt,null),{viewportRef:n,viewport:s,getSelectedNodes:u,findNode:c}=X();function k(p,$,L,V,E){let F=.5;E==="start"?F=0:E==="end"&&(F=1);let b=[(p.x+p.width*F)*$.zoom+$.x,p.y*$.zoom+$.y-V],I=[-100*F,-100];switch(L){case re.Right:b=[(p.x+p.width)*$.zoom+$.x+V,(p.y+p.height*F)*$.zoom+$.y],I=[0,-100*F];break;case re.Bottom:b[1]=(p.y+p.height)*$.zoom+$.y+V,I[1]=0;break;case re.Left:b=[p.x*$.zoom+$.x-V,(p.y+p.height*F)*$.zoom+$.y],I=[-100,-100*F];break}return`translate(${b[0]}px, ${b[1]}px) translate(${I[0]}%, ${I[1]}%)`}const y=x(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||o||""]).reduce((p,$)=>{const L=c($);return L&&p.push(L),p},[])),g=x(()=>typeof e.isVisible=="boolean"?e.isVisible:y.value.length===1&&y.value[0].selected&&u.value.length===1),a=x(()=>At(y.value)),C=x(()=>Math.max(...y.value.map(p=>(p.computedPosition.z||1)+1))),d=x(()=>({position:"absolute",transform:k(a.value,s.value,e.position,e.offset,e.align),zIndex:C.value}));return(p,$)=>(i(),H(pt,{to:l(n),disabled:!l(n)},[l(g)&&l(y).length?(i(),v("div",de({key:0},p.$attrs,{style:l(d),class:"vue-flow__node-toolbar"}),[T(p.$slots,"default")],16)):A("",!0)],8,["to","disabled"]))}}),ts=B({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,o)=>(i(),H(l(es),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:l(re).Right},{default:f(()=>[h(l(K),{vertical:"",gap:"small",style:R({marginBottom:`-${16*e.menuOptions.length}%`})},{default:f(()=>[(i(!0),v(G,null,ce(e.menuOptions,n=>(i(),H(l(Ze),{key:n.label,title:n.tooltip,placement:"right"},{default:f(()=>[h(l(ve),{class:He([{"warning-button":n.warning}]),disabled:n.disabled,style:R({backgroundColor:n.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:s=>n.click(s)},{default:f(()=>[h(l(K),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:f(()=>[Z(Y(n.label)+" ",1),n.key?(i(),H(l(oe),{key:0,keyboard:"",disabled:n.disabled},{default:f(()=>[Z(Y(n.key),1)]),_:2},1032,["disabled"])):A("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const as=B({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Ie;const e=t,{useToken:o}=Xe,n=ft(),{token:s}=o(),u=s.value.colorText,c=[{label:"Add transition",key:"C",click:r=>Se(r)},{label:"Rename",key:"R",click:()=>O.value=!0},{label:"Go to editor",key:"Enter",click:()=>Me()},{label:"Tasks",key:"M",click:()=>y.value=!0},{label:"Delete",key:"Del",click:()=>a.value=!0}],k=x(()=>{let r=[...c];return g.value||r.unshift({label:"Create missing file",warning:!0,click:()=>w()}),e.controller.hasChanges()&&(r=r.map(m=>m.label==="Go to editor"?{...m,disabled:!0,tooltip:"Save it to allow editing"}:m.label==="Tasks"?{...m,disabled:!0,tooltip:"Save it to allow managing tasks"}:m)),r}),y=D(!1),g=D(!0);$e(()=>e.initialFileCheck,r=>{E.value||(g.value=r)});const a=D(!1),C=()=>{a.value=!1,se(e.stage)},d=new Bt,p=new Tt(d,{separator:"/"}),$=async()=>{if(a.value=!1,"filename"in e.stage.props&&e.stage.props.filename){const r=e.stage.props.filename;(await ue.checkFile(r)).exists&&await p.deleteFile([r])}se(e.stage)},L=r=>{b.value=r,F()},V=()=>{var r;I.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(b.value=(r=e.stage.props.filename)!=null?r:"",F())},E=x(()=>e.controller.getUnsavedFilenameStages().some(r=>r.id===e.stage.id)),F=gt.exports.debounce(async()=>{if(E.value){g.value=!0;return}const r=b.value;if(!r){g.value=!0;return}ue.checkFile(r).then(m=>{g.value=m.exists})},500),b=D((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Ie=e.stage.props.filename)!=null?Ie:""),I=D("idle"),ye=async()=>{I.value="creating",await ue.initFile(b.value,e.stage.type),g.value=!0;const r=await ue.checkFile(b.value);if(g.value=r.exists,I.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:b.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:b.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},pe=x(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!g.value:!1),w=()=>{I.value="prompting"},{startConnection:M,updateConnection:S,onNodeClick:J,addEdges:Q,endConnection:ie,removeNodes:se,onPaneClick:Re,getSelectedNodes:Ke,flowToScreenCoordinate:Ae,onNodeMouseEnter:Je,onNodeMouseLeave:Qe,getNodes:et,onNodesChange:tt,applyNodeChanges:at}=X(),ee=D(!1),O=D(!1),te=D(e.stage.title),we=D(!0),fe=x(()=>{const m=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Zt(te.value,!1,!0)}.py`;return m!==b.value?m:null}),ke=D(!1),_e=D(!1);tt(async r=>{var z;const m=[];for(const ne of r)ne.type==="remove"?O.value||((z=e.controller)==null||z.delete([ne.id]),m.push(ne)):m.push(ne);at(m)});const Me=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);_e.value?window.open(`/_editor/${r}/${e.stage.id}`,"_blank"):n.push({path:`/_editor/${r}/${e.stage.id}`})},Se=(r,m=!0)=>{M({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:m?r.pageX:r.pageX-90,y:m?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",De),ee.value=!0},De=r=>{ee.value&&!ke.value&&S({x:r.pageX,y:r.pageY-52})};J(r=>{if(r.node.id===e.stage.id&&F(),ee.value&&r.node.id!==e.stage.id){const m={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:lt(),props:{taskType:null}};try{e.controller.connect([m]),document.removeEventListener("mousemove",De),Q({id:m.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:Mt.Arrow,width:24,height:24},data:m}),ie(),ee.value=!1}catch(z){console.error(z)}}}),Je(r=>{if(ee.value&&r.node.id!==e.stage.id){ke.value=!0;const m=et.value.find(ne=>ne.id===e.stage.id);if(!m)return;const z=Ue(m,r.node,10);S(Ae({x:z.targetX,y:z.targetY-52}))}}),Qe(()=>{ke.value=!1});const ot=()=>{if(!g.value){const r=Nt(te.value+".py");b.value=r;let m={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const z=Yt(te.value);m={...m,path:z}}e.controller.updateStageProps(e.stage.id,m)}},Ee=async()=>{e.stage.title!==te.value&&(e.controller.updateStageTitle(e.stage.id,te.value),we.value&&fe.value&&(b.value=fe.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:b.value})),ot()),F()};Re(()=>{O.value&&Ee(),O.value=!1,ee.value=!1,ie()});const ze=r=>{if(_e.value=W(r),!!Ke.value.map(m=>m.id).includes(e.stage.id)&&I.value==="idle"){if(r.key==="Enter")if(O.value)O.value=!1,Ee();else{if(e.controller.hasChanges())return;Me()}if(!O.value){if(r.key==="c"||r.key==="C"){const m=Ae(e.stage.position);Se({pageX:m.x,pageY:m.y},!1)}if((r.key==="r"||r.key==="R")&&(O.value=!0),r.key==="m"||r.key==="M"){if(e.controller.hasChanges())return;y.value=!0}(r.key==="Backspace"||r.key==="Delete")&&("filename"in e.stage.props&&e.stage.props.filename?a.value=!0:se(e.stage))}}},Fe=r=>{_e.value=W(r)};return me(()=>{E.value||(g.value=e.initialFileCheck),window.addEventListener("keydown",ze),window.addEventListener("keyup",Fe)}),Ce(()=>{window.removeEventListener("keydown",ze),window.removeEventListener("keyup",Fe)}),(r,m)=>(i(),v(G,null,[h(ts,{"is-connecting":ee.value,"is-editing":O.value,"menu-options":k.value},null,8,["is-connecting","is-editing","menu-options"]),h(l(Ye),{open:a.value,title:"Delete file",onCancel:m[0]||(m[0]=z=>a.value=!1)},{footer:f(()=>[h(l(K),{justify:"space-between",gap:"small"},{default:f(()=>[h(l(ve),{onClick:C},{default:f(()=>[Z("Delete only stage")]),_:1}),h(l(ve),{type:"primary",danger:"",onClick:$},{default:f(()=>[Z("Yes, delete file")]),_:1})]),_:1})]),default:f(()=>[Z(" Do you also want to delete the file associated with the stage "+Y(r.stage.title)+"? ",1)]),_:1},8,["open"]),_("div",{class:"stage",onDblclick:m[3]||(m[3]=z=>O.value=!0)},[h(l(K),{vertical:O.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:f(()=>[(i(),H(U(l(Et)(r.stage.type)),{size:18,color:l(u)},null,8,["color"])),O.value?(i(),H(l(Ne),{key:1,layout:"vertical"},{default:f(()=>[h(l(Pe),{label:"Title"},{default:f(()=>[h(l(Ve),{value:te.value,"onUpdate:value":m[1]||(m[1]=z=>te.value=z),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),fe.value?(i(),H(l(vt),{key:0,checked:we.value,"onUpdate:checked":m[2]||(m[2]=z=>we.value=z),style:{"margin-bottom":"12px"}},{default:f(()=>[Z(" Update filename to "),h(l(oe),{code:""},{default:f(()=>[Z(Y(fe.value),1)]),_:1})]),_:1},8,["checked"])):A("",!0)]),_:1})):(i(),H(l(ht),{key:0,class:"title"},{default:f(()=>[Z(Y(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),pe.value?(i(),H(l(Xt),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):A("",!0),I.value==="prompting"||I.value==="creating"?(i(),H(Jo,{key:1,filename:b.value,"file-exists":g.value,"creating-file-status":I.value,onCreateFile:ye,onCancel:V,onUpdateFilename:L},null,8,["filename","file-exists","creating-file-status"])):A("",!0),h(l(Ot),{visible:y.value,"onUpdate:visible":m[4]||(m[4]=z=>y.value=z),title:"Tasks",width:"500",onClose:m[5]||(m[5]=z=>y.value=!1)},{default:f(()=>[h(Lt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const he=le(as,[["__scopeId","data-v-b6e56379"]]),qe=t=>(mt("data-v-f4278104"),t=t(),yt(),t),os={class:"empty-hint"},ss={key:0,class:"drag-hint"},ns=qe(()=>_("div",{class:"title"},"Start here",-1)),ls={key:1,class:"drop-hint"},is=qe(()=>_("div",{class:"title"},"Drop here",-1)),rs={key:2,class:"stages-hint"},us={class:"header"},ds={class:"title"},cs={class:"description"},ps=B({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,o)=>(i(),v("div",os,[e.showDragHint?(i(),v("div",ss,[ns,h(l(Te),{size:32,class:"arrow"})])):A("",!0),e.showDragHint?A("",!0):(i(),v("div",ls,[is,h(l(Te),{size:32,class:"arrow"})])),e.showDragHint?(i(),v("div",rs,[(i(!0),v(G,null,ce(l(xe).stages,n=>(i(),v("div",{key:n.key,class:"stage-hint"},[_("div",us,[(i(),H(U(n.icon))),_("span",ds,Y(n.title),1)]),_("div",cs,Y(n.description),1)]))),128))])):A("",!0)]))}});const fs=le(ps,[["__scopeId","data-v-f4278104"]]),gs=B({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;wt(a=>({fdcfe4e8:l(c),"7addc59e":l(u)}));const o=je(),{useToken:n}=Xe,{token:s}=n(),u=s.value.colorPrimaryBorder,c=s.value.colorBgElevated,{onInit:k,fitView:y}=X();k(a=>{a.fitView()});const g=a=>{var C;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:a&&(C=e.initialFileCheckStatus[a])!=null?C:!1};return me(()=>{const a=q.subscribe("stageCreated",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),C=q.subscribe("stageEdited",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),d=q.subscribe("transitionCreated",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),p=q.subscribe("finishActions",async()=>{Le(()=>{y()})});kt(()=>{q.unsubscribe(a),q.unsubscribe(d),q.unsubscribe(C),q.unsubscribe(p)})}),(a,C)=>a.workflow?(i(),H(l(St),{key:0,nodes:a.workflow.vueFlowNodes.value,edges:a.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":a.editable,"pan-on-scroll":l(We).isMac,"elements-selectable":a.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":[],onDragover:l(o).onDragOver,onDragleave:l(o).onDragLeave},{"connection-line":f(d=>[h(Ko,_t(bt(d)),null,16)]),"edge-task":f(d=>[h(Uo,de(d,{controller:a.workflow}),null,16,["controller"])]),"node-forms":f(d=>[h(he,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":f(d=>[h(he,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":f(d=>[h(he,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":f(d=>[h(he,{stage:d.data,node:d,controller:a.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),default:f(()=>[h(l(zt)),a.editable&&!a.workflow.vueFlowNodes.value.length?(i(),H(fs,{key:0,"show-drag-hint":a.showDragHint},null,8,["show-drag-hint"])):A("",!0),h(l(Ft),{pannable:"",zoomable:""}),a.editable?(i(),H(Po,{key:1,workflow:a.workflow},null,8,["workflow"])):A("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):A("",!0)}});const hs=le(gs,[["__scopeId","data-v-f22b2e78"]]),vs=B({__name:"WorkflowEditor",setup(t){const e=ut(),{init:o,tearDown:n,onDragStart:s,onDrop:u,isDragging:c,isAdding:k,draggedType:y,mousePosition:g}=je(),{result:a}=dt(async()=>await it.init(rt,!0)),C=D(null),d=async()=>{if(!a.value)return;const w=a.value.vueFlowNodes.value.map(M=>{var S,J,Q,ie,se;return((S=M.data)==null?void 0:S.type)==="forms"||((J=M.data)==null?void 0:J.type)==="hooks"||((Q=M.data)==null?void 0:Q.type)==="scripts"||((ie=M.data)==null?void 0:ie.type)==="jobs"?(se=M.data)==null?void 0:se.props.filename:null});C.value=await ue.checkFiles(w.filter(M=>typeof M=="string"))};$e(()=>a.value,()=>{a.value&&(o(a.value),d())});const{onNodeDragStop:p,onEdgesChange:$,getSelectedElements:L,getNodes:V,addSelectedNodes:E,zoomIn:F,fitView:b,zoomOut:I,applyEdgeChanges:ye}=X();p(w=>{var M;(M=a.value)==null||M.move(w.nodes.map(S=>({id:S.id,position:S.position})))}),$(w=>{var M;for(const S of w)S.type==="remove"&&((M=a.value)==null||M.delete([S.id]));ye(w)});const pe=w=>{var M,S;e.isInputFocused||!a.value||((w.key==="z"||w.key==="Z")&&W(w)&&(oo(w)?a.value.history.redo():(M=a.value)==null||M.history.undo(),w.preventDefault()),W(w)&&(w.key==="s"||w.key==="S")&&((S=a.value)==null||S.save(),w.preventDefault()),!(W(w)&&(w.key==="f"||w.key==="F"))&&(L.value.length||(w.key==="f"||w.key==="F"?s(null,"forms"):w.key==="h"||w.key==="H"?s(null,"hooks"):w.key==="j"||w.key==="J"?s(null,"jobs"):w.key==="t"||w.key==="T"?s(null,"scripts"):(w.key==="a"||w.key==="A")&&W(w)?(E(V.value),w.preventDefault()):w.key==="0"&&W(w)?(b(),w.preventDefault()):(w.key==="="||w.key==="+")&&W(w)?(w.preventDefault(),F()):w.key==="-"&&W(w)&&(w.preventDefault(),I()))))};return me(()=>{window.addEventListener("keydown",pe)}),Ce(()=>{window.removeEventListener("keydown",pe),n()}),(w,M)=>l(a)?(i(),v("div",{key:0,class:He(["workflow-container",{dragging:l(k)}]),onDrop:M[0]||(M[0]=(...S)=>l(u)&&l(u)(...S))},[h(hs,{workflow:l(a),editable:"","show-drag-hint":!l(k),"check-file-status":!0,"initial-file-check-status":C.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),h(io,{controller:l(a),onDragStart:l(s)},null,8,["controller","onDragStart"]),(i(!0),v(G,null,ce(l(xe).stages,S=>{var J,Q;return i(),v("div",{key:S.key},[l(k)&&!l(c)&&S.typeName===l(y)?(i(),v("div",{key:0,class:"dragging-node",style:R({left:`${(J=l(g))==null?void 0:J.x}px`,top:`${(Q=l(g))==null?void 0:Q.y}px`,position:"absolute",cursor:l(k)?"grabbing":"grab"})},[(i(),H(U(S.icon),{size:18}))],4)):A("",!0)])}),128))],34)):A("",!0)}});const on=le(vs,[["__scopeId","data-v-aa8dbb66"]]);export{on as default};
//# sourceMappingURL=WorkflowEditor.62ae4cb7.js.map

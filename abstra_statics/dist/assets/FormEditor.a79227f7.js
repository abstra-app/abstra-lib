import{d as $,r as x,v as H,b as i,c as f,x as a,F as C,L as T,N as q,W as M,a3 as N,e as n,O as Q,Q as j,q as A,K as X,z as t,t as w,w as y,D as V,H as Y,J as Z,S as ee}from"./registerWidgets.d08da683.js";import{L as te}from"./CircularLoading.7cd10bd6.js";import{E as oe}from"./Error.391f2cb7.js";import{R as re,F as ae}from"./broker.655dff97.js";import{R as se,S as le,_ as ne,L as ie}from"./UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.7472cac1.js";import{T as ue,a as W}from"./Tab.f838e399.js";import{a as me}from"./asyncComputed.2c01b8cd.js";import{F as ce}from"./forms.ef57eafe.js";import{W as de}from"./workspaces.0deab77a.js";import{B as pe}from"./BackButton.eae76dfa.js";import{S as fe}from"./SaveButton.da6bb2d8.js";import{D as _e}from"./DocsButton.01f54355.js";import{P as ve}from"./PreviewButton.464ac759.js";import"./lottie.bb3af4f6.js";import"./passwordlessManager.7e095e63.js";import"./pubsub.e3196f46.js";import"./icons.7be61185.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.b1d2dc3c.js";import"./Passwordless.085d1b35.js";import"./executeJs.b84003af.js";import"./PlayerNavbar.c5970910.js";import"./index.b8a07348.js";import"./WidgetsFrame.9b6b9f1d.js";import"./colors.ed508b5c.js";import"./Modal.f85e67ed.js";import"./dashes.bfd5a015.js";import"./activeRecord.7b9ccd8b.js";import"./runnerData.df9de565.js";import"./hooks.950d5aa7.js";import"./jobs.ae890079.js";import"./uuid.37b2dded.js";import"./login.2c2e3196.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[d]="17a29768-5be1-425e-9b8d-aa49b2161408",s._sentryDebugIdIdentifier="sentry-dbid-17a29768-5be1-425e-9b8d-aa49b2161408")}catch{}})();const ye="forms_workspace_id_path_key",U=s=>(Q("data-v-89e322ed"),s=s(),j(),s),he={class:"form-settings"},ge={class:"content"},be={class:"subsection-label"},ke={class:"property-label"},we=["value","onChange"],Se={class:"content"},xe={class:"property"},Ce=U(()=>a("div",{class:"property-label"},"Start smart form automatically",-1)),Ee={class:"property"},Fe=U(()=>a("div",{class:"property-label"},"Allow the user to restart the smart form after it is over",-1)),Re=$({__name:"FormSettings",props:{form:null},setup(s){const o=x(s.form),h=[{label:"General",props:[{label:"Form name",valueKey:"title"}]},{label:"Welcome Screen",props:[{label:"Title",valueKey:"welcome_title"},{label:"Subtitle",valueKey:"start_message"},{label:"Start button text",valueKey:"start_button_text"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"end_message"},{label:"Restart button text",valueKey:"restart_button_text"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"error_message"}]}],g=H({pathError:null,sectionsShown:[!0,!1,!1]}),S=_=>{_.detail.includes(ye)&&(g.pathError=r)},r="This path is already being used by another form or dash on your workspace";return addEventListener("hasura-error",S),(_,c)=>(i(),f("div",he,[a("div",ge,[(i(),f(C,null,T(h,l=>a("div",{key:l.label,class:"subsection"},[a("div",be,q(l.label),1),(i(!0),f(C,null,T(l.props,p=>(i(),f("div",{key:p.label,class:"property column"},[a("div",ke,q(p.label),1),a("input",{class:"property-input",type:"text",value:o.value.get(p.valueKey),onChange:u=>o.value.set(p.valueKey,u.target.value)},null,40,we)]))),128))])),64))]),a("div",Se,[a("div",xe,[M(a("input",{"onUpdate:modelValue":c[0]||(c[0]=l=>o.value.autoStart=l),class:"checkbox-input",type:"checkbox"},null,512),[[N,o.value.autoStart]]),Ce]),a("div",Ee,[M(a("input",{"onUpdate:modelValue":c[1]||(c[1]=l=>o.value.allowRestart=l),class:"checkbox-input",type:"checkbox"},null,512),[[N,o.value.allowRestart]]),Fe])]),n(se,{runtime:o.value},null,8,["runtime"])]))}});const Ke=A(Re,[["__scopeId","data-v-89e322ed"]]),Pe={class:"page"},Be={key:1,class:"error"},De=$({__name:"FormEditor",setup(s){var F,R,K;const d=Y(),o=Z(),h=H({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),p())});const g=x(null),{loading:S,result:r,error:_,refetch:c}=me(()=>Promise.all([de.get(),ce.get(o.params.formPath)]).then(([e,k])=>ee({workspace:e,form:k}))),l=x(!1);async function p(){var e;l.value=!0;try{await((e=r.value)==null?void 0:e.form.save())}finally{l.value=!1}}const u=ie.create(),b=X(()=>re.create({formPath:o.params.formPath}));(F=b.value)==null||F.on("stdout",e=>{u.log({type:"stdout",log:e.log})}),(R=b.value)==null||R.on("stderr",e=>{u.log({type:"stderr",log:e.log})}),(K=b.value)==null||K.onClose(()=>{u.log({type:"stderr",log:"Program closed"})});const z=()=>{u.clear()},E=async()=>{var e;return u.log({type:"restart"}),(e=g.value)==null?void 0:e.run()},G=({path:e,type:k})=>{k==="dash"?d.push({name:"dashEditor",params:{dashPath:e},query:o.query}):(d.push({name:"editor",params:{formPath:e},query:o.query}),c())},J=()=>{h.started=!0},O=()=>{h.started=!1};return(e,k)=>{var P,B,D,I,L;return i(),f(C,null,[a("div",Pe,[t(S)||!((P=t(r))!=null&&P.form)||!((B=t(r))!=null&&B.workspace)?(i(),w(te,{key:0})):t(_)?(i(),f("div",Be,[n(oe,{error:t(_),onReload:t(c)},null,8,["error","onReload"])])):(i(),w(ue,{key:2},{left:y(()=>[n(pe,{link:"/_editor/forms"})]),right:y(()=>{var m,v;return[n(_e),n(ve,{model:(m=t(r))==null?void 0:m.form},null,8,["model"]),n(fe,{model:(v=t(r))==null?void 0:v.form},null,8,["model"])]}),default:y(()=>[n(W,{title:"Preview"},{default:y(()=>{var m,v;return[n(ae,{ref_key:"runner",ref:g,form:(v=t(r))==null?void 0:v.form.makeRunnerData((m=t(r))==null?void 0:m.workspace),params:t(o).query,"is-preview":!0,"enable-auto-focus":!1,broker:t(b),style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:G,onLogout:E,onExit:O,onStart:J},null,8,["form","params","broker"])]}),_:1}),n(W,{title:"Settings"},{default:y(()=>{var m;return[(m=t(r))!=null&&m.form?(i(),w(Ke,{key:0,form:t(r).form},null,8,["form"])):V("",!0)]}),_:1})]),_:1})),(D=t(r))!=null&&D.form?(i(),w(le,{key:3,runtime:"forms","log-service":t(u),onRestart:E,onClearTerminal:z},null,8,["log-service"])):V("",!0)]),n(ne,{"has-changes":(L=(I=t(r))==null?void 0:I.form)==null?void 0:L.hasChanges()},null,8,["has-changes"])],64)}}});const ct=A(De,[["__scopeId","data-v-8b7849de"]]);export{ct as default};
//# sourceMappingURL=FormEditor.a79227f7.js.map

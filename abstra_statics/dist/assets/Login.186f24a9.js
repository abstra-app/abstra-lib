import{O as B,L as x}from"./CircularLoading.02fd7b7b.js";import{d as L,r as D,o as u,a5 as y,e as m,f as o,ed as l,u as a,eG as s,a as b,b as d,bJ as q,eF as N,cz as A,g,bR as h,cy as R,h as C,_ as P,e5 as V,eb as $,c as U,dt as z}from"./jwt-decode.esm.b204fb7d.js";import{j as I,T as F,k as S}from"./router.29d47df0.js";import{_ as G}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.37e7ad5b.js";import{i as K}from"./string.4a80abd5.js";import{A as M}from"./index.e6b397aa.js";import"./index.26a34a52.js";import"./Logo.cc2d4a95.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[i]="3e77267d-864d-4151-b381-aed9d0e00b52",c._sentryDebugIdIdentifier="sentry-dbid-3e77267d-864d-4151-b381-aed9d0e00b52")}catch{}})();const O={class:"form"},j={class:"header"},J={class:"description"},H={class:"description"},Q={class:"footer"},W={key:2,class:"loading"},X=L({__name:"Passwordless",emits:["done"],setup(c,{emit:i}){const e=D({stage:"collect-info",info:{email:""},token:"",invalid:!1,secsToAllowResend:0});function v(){const n=e.value.info.email,t=K(n);return e.value.invalid=!t,t}let _;const r=async({isResend:n}={})=>{if(!!v()){e.value.stage="loading";try{await I.authenticate(e.value.info.email,n),e.value.stage="collect-token",e.value.secsToAllowResend=120,clearInterval(_),_=setInterval(()=>{e.value.secsToAllowResend-=1,e.value.secsToAllowResend<=0&&clearInterval(_)},1e3)}catch{e.value.invalid=!0,e.value.stage="collect-info"}}},f=n=>{if(!n){e.value.info.email="";return}e.value.info.email=n.toLowerCase()},p=async()=>{var n;if(!!((n=e.value.info)!=null&&n.email)){e.value.stage="loading";try{const t=await I.verify(e.value.info.email,e.value.token);if(!t)throw new Error("[Passwordless] Login did not return an user");F.trackSession(),i("done",t),e.value.stage="done"}catch{e.value.invalid=!0,e.value.stage="collect-token"}}},T=async n=>{await fetch(`https://admin.abstra.app/_hooks/notify-email-not-received?email=${n}`,{method:"GET"})},k=()=>{e.value.info&&(r({isResend:!0}),T(e.value.info.email))},E=()=>{e.value.stage="collect-info",e.value.info={email:""},e.value.token="",e.value.invalid=!1};return(n,t)=>(u(),y("div",O,[m("div",j,[o(G,{"hide-text":"",size:"large"}),m("h2",null,l(a(s).translate("i18n_auth_validate_your_email_login",null,{brandName:"Abstra"})),1)]),e.value.stage==="collect-info"?(u(),b(a(R),{key:0,class:"section"},{default:d(()=>[m("div",J,l(a(s).translate("i18n_auth_info_description")),1),o(a(A),{"has-feedback":"","validate-status":e.value.invalid?"error":"",help:e.value.invalid?a(s).translate("i18n_auth_info_invalid_email"):""},{default:d(()=>[o(a(q),{type:"email",value:e.value.info.email,placeholder:a(s).translate("i18n_auth_enter_your_work_email"),autofocus:"",onBlur:v,onKeyup:t[0]||(t[0]=N(()=>r(),["enter"])),onChange:t[1]||(t[1]=w=>f(w.target.value))},null,8,["value","placeholder"])]),_:1},8,["validate-status","help"]),o(a(h),{type:"primary",onClick:t[2]||(t[2]=()=>r())},{default:d(()=>[g(l(a(s).translate("i18n_auth_info_send_code")),1)]),_:1})]),_:1})):e.value.stage==="collect-token"?(u(),b(a(R),{key:1,class:"section"},{default:d(()=>[m("div",H,l(a(s).translate("i18n_auth_token_label",null,e.value.info)),1),o(a(A),{"has-feedback":"","validate-status":e.value.invalid?"error":""},{default:d(()=>[o(B,{value:e.value.token,"onUpdate:value":t[3]||(t[3]=w=>e.value.token=w),length:6,numeric:!0,size:"large",onCollectToken:p},null,8,["value"]),e.value.invalid?(u(),b(a(M),{key:0,message:a(s).translate("i18n_auth_token_invalid"),type:"error",style:{"margin-top":"24px"}},null,8,["message"])):C("",!0)]),_:1},8,["validate-status"]),o(a(h),{type:"primary",onClick:p},{default:d(()=>[g(l(a(s).translate("i18n_auth_token_verify_email")),1)]),_:1}),o(a(h),{onClick:E},{default:d(()=>[g(l(a(s).translate("i18n_auth_edit_email")),1)]),_:1}),o(a(h),{disabled:!!e.value.secsToAllowResend,onClick:k},{default:d(()=>[g(l(a(s).translate("i18n_auth_token_resend_email"))+" ("+l(e.value.secsToAllowResend)+" s) ",1)]),_:1},8,["disabled"]),m("div",Q,l(a(s).translate("i18n_auth_token_footer_alternative_email")),1)]),_:1})):e.value.stage==="loading"?(u(),y("div",W,[o(x)])):C("",!0)]))}});const Y=P(X,[["__scopeId","data-v-d18467d0"]]),Z={key:0,class:"login"},ee={key:1,class:"loading"},ae=L({__name:"Login",setup(c){const i=V(),e=$();async function v(){const r=e.query.redirect,f=e.query["prev-redirect"],{status:p}=await S.getInfo();if(p!=="active"){i.push({name:"onboarding",query:{redirect:r,"prev-redirect":f}});return}if(r){const k=new URL(r,window.location.origin).pathname;await i.push({path:k,query:{...e.query,redirect:f,"prev-redirect":void 0}});return}i.push({name:"home"})}const _=U(()=>!I.getAuthor());return z(()=>{_.value||v()}),(r,f)=>_.value?(u(),y("div",Z,[o(Y,{onDone:v})])):(u(),y("div",ee,[o(x)]))}});const ue=P(ae,[["__scopeId","data-v-2abe81c3"]]);export{ue as default};
//# sourceMappingURL=Login.186f24a9.js.map

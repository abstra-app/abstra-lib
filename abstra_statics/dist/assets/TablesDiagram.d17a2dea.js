import{_ as R}from"./AbstraButton.vue_vue_type_script_setup_true_lang.86259ed3.js";import{a as F}from"./asyncComputed.699d7d74.js";import{F as S}from"./PhKey.vue.ad325f23.js";import{G as V}from"./PhPencil.vue.6430a5cc.js";import{_ as j,a as A}from"./vue-flow-minimap.e3c906b1.js";import{u as B,f as G,j as v,c as w,d as h}from"./index.91dbc3c0.js";import{d as H,e4 as M,g as $,f as P,r as Q,K as k,b as s,u as t,c as p,w as r,ec as U,aL as x,o as d,br as q,d5 as m,az as _,eb as g,ea as J,da as C,F as O,Q as W}from"./index.c030ad61.js";import"./gateway.f6f8954a.js";import{T as I}from"./columns.898324c2.js";import{_ as X}from"./TablesTabs.vue_vue_type_script_setup_true_lang.ad0f87b0.js";import{A as Y}from"./index.c09fc368.js";import{C as Z}from"./Card.a67eb70f.js";import"./popupNotifcation.c016879d.js";import"./record.1d5eabd6.js";import"./string.ab8243e4.js";import"./TabPane.e606f29d.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[c]="21d6bc69-c111-4c63-8538-67fd79084f0d",l._sentryDebugIdIdentifier="sentry-dbid-21d6bc69-c111-4c63-8538-67fd79084f0d")}catch{}})();const ee=H({__name:"TablesDiagram",setup(l){const c=(a,n)=>{const o=new h.graphlib.Graph;return o.setGraph({rankdir:"LR",align:"UL",ranker:"longest-path"}),o.setDefaultEdgeLabel(()=>({})),a.forEach(e=>{o.setNode(e.id,{width:500,height:200+e.data.getColumns().length*20})}),n.forEach(e=>{o.setEdge(e.source,e.target)}),h.layout(o),a.map(e=>({...e,position:{x:o.node(e.id).x,y:o.node(e.id).y}}))},f=M().params.projectId,{result:u,loading:y}=F(async()=>{const a=await I.list(f);return Promise.all(a.map(n=>I.get(f,n.id)))}),b=$(()=>{var a,n;return(n=(a=u.value)==null?void 0:a.flatMap(o=>o.getColumns().filter(e=>e.foreignKey).map(e=>({id:`${o.id}:${e.id}:${e.foreignKey.columnId}`,source:o.id,target:u.value.find(i=>i.getColumn(e.foreignKey.columnId)).id,targetHandle:`target-${e.foreignKey.columnId}`,sourceHandle:`source-${e.id}`}))))!=null?n:[]}),L=$(()=>y.value?[]:c(u.value.map(a=>({id:a.id,type:"table",data:a,position:{x:0,y:0}})),b.value)),{onInit:T,onNodeDragStop:E,onConnect:z,addEdges:K}=B(),N=P(!1);return T(a=>{a.fitView()}),E(({event:a,nodes:n,node:o})=>{console.log("Node Drag Stop",{event:a,nodes:n,node:o})}),z(a=>{K(a)}),(a,n)=>{const o=Q("RouterLink");return d(),k(x,null,[s(X),t(y)?(d(),p(t(q),{key:0,style:{width:"100%"}})):(d(),p(t(G),{key:1,nodes:L.value,edges:b.value,class:U([{dark:N.value},"basic-flow"]),"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.2,"max-zoom":4,"pan-on-scroll":""},{"node-table":r(e=>[s(t(Z),{style:{padding:"0"}},{title:r(()=>[s(t(m),{level:5},{default:r(()=>[_(g(e.data.name),1)]),_:2},1024)]),extra:r(()=>[s(o,{to:`/projects/${t(f)}/tables/${e.data.id}`},{default:r(()=>[s(t(Y),{size:"large"}),s(R,null,{default:r(()=>[s(t(V))]),_:1})]),_:2},1032,["to"])]),default:r(()=>[(d(!0),k(x,null,J(e.data.getColumns(),i=>(d(),p(t(C),{key:i.id,vertical:""},{default:r(()=>[s(t(C),{align:"center",gap:"small",style:{position:"relative"}},{default:r(()=>[s(t(v),{id:`target-${i.id}`,type:"target",position:t(w).Left,connectable:!1},null,8,["id","position"]),s(t(m),null,{default:r(()=>[_(g(i.name),1)]),_:2},1024),s(t(m),{type:"secondary"},{default:r(()=>[_(g(i.type),1)]),_:2},1024),i.primaryKey?(d(),p(t(S),{key:0})):O("",!0),s(t(v),{id:`source-${i.id}`,type:"source",position:t(w).Right,connectable:!1},null,8,["id","position"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),default:r(()=>[s(t(j),{"pattern-color":"#aaa",gap:16}),s(t(A),{pannable:""})]),_:1},8,["nodes","edges","class"]))],64)}}});const ye=W(ee,[["__scopeId","data-v-f0dbbd69"]]);export{ye as default};
//# sourceMappingURL=TablesDiagram.d17a2dea.js.map

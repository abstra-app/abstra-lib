import{_ as P}from"./DocsButton.vue_vue_type_script_setup_true_lang.28a130ec.js";import{F as R,I as U,S as q,a as H}from"./ImageViewer.589bbad2.js";import{z as W,d as L,eA as A,r as h,U as D,R as E,o as n,ac as g,f as d,u as l,S as z,e as x,t as y,ae as J,_ as M,w as S,b as m,g as I,i as k,A as Y,de as G,dj as B,aY as K,eB as Q,a as F,eD as X,h as Z}from"./jwt-decode.esm.fbcfeaec.js";import"./router.ed823a0a.js";import{F as N}from"./file.f714e498.js";import"./tables.76beaff5.js";import{e as V}from"./toggleHighContrast.012434e2.js";import{G as ee}from"./PhFolderPlus.vue.a1dee52a.js";import{T as te,A as $,C as ae}from"./Card.5199b9ee.js";import"./constants.b8ded506.js";import"./asyncComputed.5a2bb5ad.js";import"./string.b10c2096.js";import"./PhArrowUp.vue.d5012081.js";import"./PhWebhooksLogo.vue.b4180f20.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.41e88327.js";import"./ScrollArea.vue_vue_type_script_setup_true_lang.5b1fb7a5.js";import"./index.561c6514.js";import"./UploadOutlined.5316d336.js";import"./index.4d74f393.js";import"./xlsx.89ea120e.js";import"./index.d9ce41fc.js";import"./record.63a637c8.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[e]="20946973-c8d8-443f-bf47-8930dd170a20",p._sentryDebugIdIdentifier="sentry-dbid-20946973-c8d8-443f-bf47-8930dd170a20")}catch{}})();class se{constructor(e){this.filesModel=e}async list(e){const i=await this.filesModel.list(e.limit||20,e.offset||0,e.search,e.path);return{items:i.items.map(r=>this.mapToFileItem(r)),totalCount:i.totalCount}}async upload(e,i,r){await this.filesModel.upload(e,i,r)}async delete(e){await this.filesModel.delete(e)}async download(e){return await this.filesModel.download(e)}async createFolder(e){await this.filesModel.createFolder(e)}async move(e,i){await this.filesModel.move(e,i)}async preview(e){const i=await this.filesModel.download(e),r=e.split("/").pop()||e,{FileTypeHelper:_}=await W(()=>import("./ImageViewer.589bbad2.js").then(u=>u.f),["assets/ImageViewer.589bbad2.js","assets/asyncComputed.5a2bb5ad.js","assets/jwt-decode.esm.fbcfeaec.js","assets/jwt-decode.6e4bcae0.css","assets/string.b10c2096.js","assets/PhArrowUp.vue.d5012081.js","assets/PhFolderPlus.vue.a1dee52a.js","assets/PhWebhooksLogo.vue.b4180f20.js","assets/AbstraButton.vue_vue_type_script_setup_true_lang.41e88327.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang.5b1fb7a5.js","assets/index.561c6514.js","assets/UploadOutlined.5316d336.js","assets/index.4d74f393.js","assets/router.ed823a0a.js","assets/index.d9ce41fc.js","assets/xlsx.89ea120e.js","assets/ImageViewer.c26513a9.css"]),t=_.getMimeType(r);return{blob:new Blob([i],{type:t}),mimeType:t}}mapToFileItem(e){return{name:e.name,path:e.path,type:e.type,size:e.sizeBytes,_original:e}}}const oe={key:0,class:"loading-container"},le={key:1,class:"error-container"},ne={class:"error-message"},ie=L({__name:"ConsoleFileAdapter",props:{filePath:{},loadingText:{default:"Loading file..."}},setup(p){const e=p,r=A().params.projectId,_=h(!0),t=h(null),a=h(null),u=h(null),j=w=>{const f=w.toLowerCase().split(".").pop();return["txt","md","json","js","ts","jsx","tsx","py","html","css","scss","yaml","yml","xml","sql","sh","vue","csv"].includes(f||"")};return D(async()=>{try{const f=await N.fromProjectId(r).download(e.filePath);if(f.size<1e3){const C=await f.slice(0,f.size,f.type).text();if(C.includes("<!DOCTYPE")||C.includes("<html"))throw new Error("Downloaded file appears to be an HTML error page")}if(a.value=URL.createObjectURL(f),j(e.filePath)&&(u.value=await f.text(),e.filePath.toLowerCase().endsWith(".json")))try{const b=JSON.parse(u.value);u.value=JSON.stringify(b,null,2)}catch{}}catch(w){t.value=`Failed to load file: ${String(w)}`}finally{_.value=!1}}),E(()=>{a.value&&URL.revokeObjectURL(a.value)}),(w,f)=>_.value?(n(),g("div",oe,[d(l(z),{size:"large"}),x("p",null,y(p.loadingText),1)])):t.value?(n(),g("div",le,[x("p",ne,y(t.value),1)])):J(w.$slots,"default",{key:2,blobUrl:a.value,fileContent:u.value},void 0,!0)}});const re=M(ie,[["__scopeId","data-v-3ce1506a"]]),ce={key:0,class:"loading-container"},de={key:1,class:"error-container"},pe={class:"error-message"},ue=L({__name:"CodeViewer",props:{content:{},language:{default:"plaintext"},loadingText:{default:"Loading..."},readonly:{type:Boolean,default:!0}},setup(p){const e=p,i=h(!1),r=h(null),_=h();let t=null;return D(()=>{if(!!_.value)try{t=V.create(_.value,{value:e.content,language:e.language,readOnly:e.readonly,theme:"vs",automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",renderWhitespace:"selection",folding:!0,wordWrap:"on",quickSuggestions:!1,parameterHints:{enabled:!1},suggestOnTriggerCharacters:!1,acceptSuggestionOnCommitCharacter:!1,tabCompletion:"off",wordBasedSuggestions:!1})}catch(a){console.error("[CodeViewer] Failed to create editor:",a),r.value=`Failed to create editor: ${String(a)}`}}),S(()=>e.content,a=>{t&&a!==t.getValue()&&t.setValue(a)}),S(()=>e.language,a=>{if(t){const u=t.getModel();u&&V.setModelLanguage(u,a)}}),E(()=>{t==null||t.dispose()}),(a,u)=>i.value?(n(),g("div",ce,[d(l(z),{size:"large"}),x("p",null,y(p.loadingText),1)])):r.value?(n(),g("div",de,[x("p",pe,y(r.value),1)])):(n(),g("div",{key:2,ref_key:"editorContainer",ref:_,class:"code-viewer-container"},null,512))}});const fe=M(ue,[["__scopeId","data-v-f3162ce8"]]),me={class:"files-container"},_e={class:"tab-content"},ye={key:1,class:"pdf-viewer-container"},ge=["data"],ve={class:"pdf-fallback"},he={key:1,class:"pdf-loading"},we=L({__name:"Files",setup(p){const i=A().params.projectId,r=N.fromProjectId(i),_=new se(r),t=h("all-files"),a=h([]);function u(o){const c=o.split("/").pop()||o,s=a.value.find(T=>T.path===o);if(s){t.value=s.key;return}const v={key:`file-${Date.now()}`,name:c,path:o};a.value.push(v),t.value=v.key}function j(o,c){if(c==="remove"&&typeof o=="string"){const s=a.value.findIndex(v=>v.key===o);s!==-1&&(a.value.splice(s,1),a.value.length>0?t.value=a.value[Math.max(0,s-1)].key:t.value="all-files")}}function w(o){return H.getFileIcon(o)}function f(o){const c=o.toLowerCase().split(".").pop();return["jpg","jpeg","png","gif","webp","svg","bmp","ico"].includes(c||"")}function b(o){return o.toLowerCase().split(".").pop()==="pdf"}function C(o){const c=o.toLowerCase().split(".").pop();return["xlsx","xls","csv"].includes(c||"")}function O(o){const c=o.toLowerCase().split(".").pop();return{json:"json",py:"python",js:"javascript",ts:"typescript",jsx:"javascript",tsx:"typescript",html:"html",css:"css",scss:"scss",md:"markdown",yaml:"yaml",yml:"yaml",xml:"xml",sql:"sql",sh:"shell",vue:"vue"}[c||""]||"plaintext"}return(o,c)=>(n(),g("div",me,[d(l(Y),null,{default:m(()=>[I(y(l(k).translate("i18n_filesview_title")),1)]),_:1}),d(l(G),null,{default:m(()=>[I(y(l(k).translate("i18n_filesview_description"))+" ",1),d(P,{path:"tools/files"})]),_:1}),d(l(ae),{class:"files-card"},{default:m(()=>[d(l(te),{"active-key":t.value,"onUpdate:activeKey":c[0]||(c[0]=s=>t.value=s),"hide-add":"",type:"editable-card",size:"small",onEdit:j},{default:m(()=>[d(l($),{key:"all-files",closable:!1},{tab:m(()=>[d(l(B),{align:"center",gap:"small"},{default:m(()=>[d(l(ee),{size:16}),x("span",null,y(l(k).translate("i18n_filesview_all_files")),1)]),_:1})]),default:m(()=>[d(R,{repository:l(_),"show-pagination":!0,"enable-preview":!1,"enable-move":!0,"on-open":u},null,8,["repository"])]),_:1}),(n(!0),g(K,null,Q(a.value,s=>(n(),F(l($),{key:s.key,closable:!0},{tab:m(()=>[d(l(B),{align:"center",gap:"small"},{default:m(()=>[(n(),F(X(w(s.name)),{size:16})),I(" "+y(s.name),1)]),_:2},1024)]),default:m(()=>[x("div",_e,[d(re,{"file-path":s.path},{default:m(({blobUrl:v,fileContent:T})=>[f(s.name)&&v?(n(),F(U,{key:0,src:v},null,8,["src"])):b(s.name)?(n(),g("div",ye,[v?(n(),g("object",{key:0,data:v,type:"application/pdf",class:"pdf-object"},[x("p",ve,y(l(k).translate("i18n_filesview_pdf_fallback")),1)],8,ge)):(n(),g("div",he,[x("p",null,y(l(k).translate("i18n_filesview_pdf_loading")),1)]))])):C(s.name)?(n(),F(q,{key:2,"file-path":s.path},null,8,["file-path"])):T?(n(),F(fe,{key:3,content:T,language:O(s.name)},null,8,["content","language"])):Z("",!0)]),_:2},1032,["file-path"])])]),_:2},1024))),128))]),_:1},8,["active-key"])]),_:1})]))}});const Ue=M(we,[["__scopeId","data-v-bdaaad89"]]);export{Ue as default};
//# sourceMappingURL=Files.293fe2ab.js.map

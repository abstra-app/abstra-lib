var y=Object.defineProperty;var b=(n,e,t)=>e in n?y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(b(n,typeof e!="symbol"?e+"":e,t),t);import{C as I}from"./CrudView.423d8744.js";import{e as u,f,cM as C,ep as T,d as k,ea as E,eo as z,o as g,Y as _,u as a,c as w,S as j,b as c,w as m,aS as O,cz as v,bL as S,aB as N,cy as A,cL as D}from"./index.d0f12294.js";import"./gateway.ae1d6857.js";import{M as R}from"./member.8ffb8c1d.js";import{P,a as V}from"./project.fad91605.js";import"./tables.318f703e.js";import{a as x}from"./ant-design.d89b18ab.js";import{T as F,G as M}from"./tagColorProvider.36a797cb.js";import{I as U}from"./PhCopy.vue.dfade011.js";import{O as B}from"./organization.03372a7f.js";import"./router.375df57e.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.d6f2b20e.js";import"./BookOutlined.7c922f07.js";import"./url.121c9984.js";import"./PhDotsThreeVertical.vue.d0b16f96.js";import"./Badge.f6241be2.js";import"./index.a82e0ed1.js";import"./popupNotifcation.a0a6244b.js";import"./record.8c284c67.js";import"./string.d9c83adf.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="a6c1d219-ff94-4879-86be-9d80aa450ce1",n._sentryDebugIdIdentifier="sentry-dbid-a6c1d219-ff94-4879-86be-9d80aa450ce1")}catch{}})();const L=[{key:"name",label:"Project Name"}];class ${constructor(e,t,r){o(this,"projects",u(null));o(this,"organization",u(null));o(this,"editingProject",u(null));o(this,"teamColorProvider",new F);o(this,"teamOptions",u([]));o(this,"table",f(()=>this.makeCrudViewTable()));o(this,"loading",f(()=>!this.projects.value||!this.organization.value));o(this,"createProject",async e=>{const t=await P.create({organizationId:this.organizationId,name:e.name});this.handlers.navigateToProject(t.id)});o(this,"deleteProject",async({key:e})=>{var r,s;if(!!await x("Are you sure you want to delete this project?")){try{await((s=(r=this.projects.value)==null?void 0:r.find(l=>l.id===e))==null?void 0:s.delete())}catch(l){C.error({message:"Error deleting project",description:String(l)})}await this.fetchInitialState()}});o(this,"duplicateProject",async({key:e})=>{var r;const t=(r=this.projects.value)==null?void 0:r.find(s=>s.id===e);if(t){const s=await t.duplicate();this.handlers.navigateToProject(s.id)}});o(this,"saveEdit",async()=>{if(!this.editingProject.value)return;const{projectId:e,newName:t,newTeam:r}=this.editingProject.value;await this.apis.project.update(e,{name:t,team:r}),await this.fetchInitialState(),this.editingProject.value=null});o(this,"cancelEdit",()=>{this.editingProject.value=null});o(this,"getActions",e=>{var t;return[{icon:M,label:"Edit project",onClick:()=>this.startEditingProject(e)},{icon:U,label:"Duplicate",onClick:()=>this.duplicateProject({key:e.id}),hide:!!((t=this.organization.value)!=null&&t.featureFlags.DUPLICATE_PROJECTS)},{icon:T,label:"Delete",onClick:()=>this.deleteProject({key:e.id}),dangerous:!0}]});o(this,"getRows",()=>this.projects.value?this.projects.value.map(e=>({key:e.id,cells:[{type:"link",text:e.name,to:`/projects/${encodeURIComponent(e.id)}`},{type:"tag",text:e.team||"No team",tagColor:e.team?this.teamColorProvider.getColor(e.team):"default"},{type:"actions",actions:this.getActions(e)}]})):[]);this.organizationId=e,this.handlers=t,this.apis=r}async fetchInitialState(){this.projects.value=await P.list(this.organizationId),this.organization.value=await B.get(this.organizationId),this.teamOptions.value=await this.fetchTeamOptions()}async fetchTeamOptions(){return(await this.apis.member.fetchTeamOptions(this.organizationId)).map(t=>({label:t,value:t}))}startEditingProject(e){var t;this.editingProject.value={projectId:e.id,newName:e.name,newTeam:(t=e.team)!=null?t:""}}makeCrudViewTable(){return{columns:[{title:"Project",align:"left"},{title:"Team",align:"center"},{title:"",align:"right"}],rows:this.getRows()}}}const ue=k({__name:"ProjectsView",setup(n){const t=E().params.organizationId,r=z(),s={navigateToProject:h=>r.push({name:"project",params:{organizationId:t,projectId:h}})},l={member:new R,project:new V},i=new $(t,s,l);return i.fetchInitialState(),(h,d)=>(g(),_(O,null,[a(i).table.value?(g(),w(I,{key:0,"entity-name":"project",loading:a(i).loading.value,title:"Projects",description:"Organize your team\u2019s work into different Projects, each with it\u2019s own environment settings, authorized end-users and editor permissions.","create-button-text":"Create Project","empty-title":"No projects here yet",table:a(i).table.value,fields:a(L),create:a(i).createProject},null,8,["loading","table","fields","create"])):j("",!0),c(a(D),{open:!!a(i).editingProject.value,title:"Edit project",onCancel:a(i).cancelEdit,onOk:a(i).saveEdit},{default:m(()=>[a(i).editingProject.value?(g(),w(a(A),{key:0,layout:"vertical"},{default:m(()=>[c(a(v),{label:"Name"},{default:m(()=>[c(a(S),{value:a(i).editingProject.value.newName,"onUpdate:value":d[0]||(d[0]=p=>a(i).editingProject.value.newName=p)},null,8,["value"])]),_:1}),c(a(v),{label:"Team",tooltip:"Create Teams by adding them on the Editors page",help:a(i).editingProject.value.newTeam?`Only editors within '${a(i).editingProject.value.newTeam}' or organization Admins can view the project`:"Project will be visible to all editors"},{default:m(()=>[c(a(N),{value:a(i).editingProject.value.newTeam,"onUpdate:value":d[1]||(d[1]=p=>a(i).editingProject.value.newTeam=p),"allow-clear":"",options:a(i).teamOptions.value,placeholder:"Select or type new team name","not-found-content":"Create a team first on the Editors page"},null,8,["value","options"])]),_:1},8,["help"])]),_:1})):j("",!0)]),_:1},8,["open","onCancel","onOk"])],64))}});export{ue as default};
//# sourceMappingURL=ProjectsView.413629ec.js.map

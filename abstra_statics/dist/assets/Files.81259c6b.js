import{_ as _e}from"./DocsButton.vue_vue_type_script_setup_true_lang.c50f6a0a.js";import{f as c,ee as B,f9 as ye,d as le,r as z,al as V,w as L,c as $,o as m,ac as F,e as C,b as u,u as n,aY as be,ej as we,a as _,t as O,dj as x,g as P,i as f,cy as Z,h as S,cI as Oe,bT as K,el as Ce,eq as Ie,cC as Pe,bV as je,bQ as ze,M as Se,K as k,_ as se,ei as $e,A as xe,de as ke}from"./jwt-decode.esm.32f71954.js";import{k as I,f as Ae,e as Fe,p as Ue}from"./router.29e08ea4.js";import{a as He}from"./asyncComputed.f9fa4c71.js";import{f as ee}from"./string.ff0b4ef9.js";import{a as De,I as Me}from"./files.e8f04848.js";import{a as Te,G as Ve}from"./PhFolderPlus.vue.53737c9c.js";import{_ as A}from"./AbstraButton.vue_vue_type_script_setup_true_lang.9c0844e1.js";import{_ as Le}from"./ScrollArea.vue_vue_type_script_setup_true_lang.e8269806.js";import{B as Be,A as te}from"./Breadcrumb.ae24888f.js";import{U as Ee}from"./UploadOutlined.113850a1.js";import"./tables.94d324c3.js";import{C as Re}from"./Card.e1ec3051.js";import"./constants.b5d83622.js";import"./index.2400150a.js";import"./record.41c9caee.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="9f89b712-acc4-436e-a228-75ebe238c3ad",o._sentryDebugIdIdentifier="sentry-dbid-9f89b712-acc4-436e-a228-75ebe238c3ad")}catch{}})();var Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"};const Ge=Ne;var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"};const Qe=qe;function ae(o){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable}))),i.forEach(function(s){Ye(o,s,r[s])})}return o}function Ye(o,e,r){return e in o?Object.defineProperty(o,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[e]=r,o}var E=function(e,r){var i=ae({},e,r.attrs);return c(B,ae({},i,{icon:ye}),null)};E.displayName="DeleteOutlined";E.inheritAttrs=!1;const Je=E;function ne(o){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable}))),i.forEach(function(s){We(o,s,r[s])})}return o}function We(o,e,r){return e in o?Object.defineProperty(o,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[e]=r,o}var R=function(e,r){var i=ne({},e,r.attrs);return c(B,ne({},i,{icon:Ge}),null)};R.displayName="FolderAddOutlined";R.inheritAttrs=!1;const Xe=R;function re(o){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable}))),i.forEach(function(s){Ze(o,s,r[s])})}return o}function Ze(o,e,r){return e in o?Object.defineProperty(o,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[e]=r,o}var N=function(e,r){var i=re({},e,r.attrs);return c(B,re({},i,{icon:Qe}),null)};N.displayName="HomeOutlined";N.inheritAttrs=!1;const Ke=N;class G{constructor(e){this.projectId=e}static fromProjectId(e){return new G(e)}async list(e,r,i,s){const v=new URLSearchParams;v.set("limit",e.toString()),v.set("offset",r.toString()),i&&i.trim()&&v.set("search",i.trim()),s&&s.trim()&&v.set("path",s.trim());const U=v.toString(),d=`projects/${this.projectId}/files?${U}`,p=await I.get(d);return{items:p.items,totalCount:p.totalCount}}async upload(e,r){const i={"Content-Type":"multipart/form-data"},s=new File([r||new Uint8Array],De(e));return I.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e)}`,s,i)}async download(e){return I.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return I.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,r){return I.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(r)}`,{})}async createFolder(e){return I.post(`projects/${this.projectId}/files/create-folder`,{path:e})}}const et={class:"files-navigator"},tt={class:"header-container",style:{"margin-bottom":"8px"}},at=["onClick"],nt={class:"list-header"},rt=["onClick"],lt={class:"file-name"},st={key:2,class:"file-size"},ot=le({__name:"FilesNavigator",props:{filesModel:{}},setup(o){const e=o,r=z(!1),i=z(""),s=z(new Set),v=z(!1),U=a=>{if(!y.searchTerm.trim())return k("span",a);const t=ee(y.searchTerm,a);return t?k("span",a.split("").map((l,h)=>t.includes(h)?k("span",{class:"char-match"},l):l)):k("span",a)},d=V({currentIndex:1,pageSize:20,totalCount:0}),p=V({currentPath:"",breadcrumbs:[]}),y=V({searchTerm:"",isSearching:!1}),{loading:H,result:j,refetch:w}=He(async()=>{const a=await e.filesModel.list(d.pageSize,(d.currentIndex-1)*d.pageSize,y.searchTerm||void 0,p.currentPath||void 0);return d.totalCount=a.totalCount,a});L([()=>d.currentIndex,()=>d.pageSize],()=>{w()}),L(()=>y.searchTerm,()=>{console.log("Search term changed:",y.searchTerm),d.currentIndex=1,w()}),L(()=>p.currentPath,()=>{w()});const D=$(()=>j.value?j.value.items:[]);async function oe(a,t){const l=a.join("/");await e.filesModel.upload(l,t),await w()}async function q(a){a.forEach(async t=>{const l=await e.filesModel.download(t),h=URL.createObjectURL(l),b=document.createElement("a");b.href=h,b.download=t.split("/").pop()||"download",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(h)})}function M(a){p.currentPath=a,p.breadcrumbs=a?a.split("/").filter(t=>t.length>0):[],d.currentIndex=1,w()}async function ie(a){for(const t of a)await e.filesModel.delete(t.path);s.value.clear(),await w()}const ce=a=>a.type==="directory"?"":a.type==="file"?a.sizeHuman:"",g=$(()=>D.value?y.searchTerm.trim()?D.value.filter(a=>ee(y.searchTerm,a.name)):D.value:[]),ue=$(()=>g.value?g.value.filter(a=>s.value.has(a.path)):[]);function de(a){a.type==="directory"?(s.value.clear(),v.value=!1,M(a.path)):q([a.path])}const Q=z(!1);function fe(a){if(a&&a.type==="file")return;const t=document.createElement("input");t.type="file",t.onchange=async()=>{var b,J,W;const l=(b=t.files)==null?void 0:b[0],h=await(l==null?void 0:l.arrayBuffer());if(!!l)try{Q.value=!0;const X=(J=a==null?void 0:a.path.split("/").filter(T=>T.length>0))!=null?J:p.currentPath?p.currentPath.split("/").filter(T=>T.length>0):[];await oe([...X,(W=l.name)!=null?W:f.translate("i18n_filesnavigator_untitled_file")],h?new Uint8Array(h):void 0),await w()}catch{Ue(f.translate("i18n_filesnavigator_failed_to_upload"),f.translate("i18n_filesnavigator_file_already_exists"))}finally{Q.value=!1}},t.click()}const pe=$(()=>{const a=p.currentPath?`/${p.currentPath}`:"/";return f.translate("i18n_filesnavigator_search_files_in",null,{path:a})});function me(a){const t=a.path;s.value.has(t)?s.value.delete(t):s.value.add(t),he()}function ve(){var a;v.value?s.value.clear():(a=g.value)==null||a.forEach(t=>{s.value.add(t.path)}),v.value=!v.value}function he(){var l;const a=((l=g.value)==null?void 0:l.length)||0,t=s.value.size;v.value=a>0&&t===a}function ge(){i.value="",r.value=!0}async function Y(){if(i.value.trim()){const a=p.currentPath,t=i.value,l=a?`${a}/${t}`:t;await e.filesModel.createFolder(l),await w(),r.value=!1,i.value=""}}return(a,t)=>(m(),F("div",et,[C("div",tt,[c(n(x),{justify:"space-between",align:"center",gap:"small"},{default:u(()=>[c(n(Be),null,{default:u(()=>[c(n(te),null,{default:u(()=>[C("a",{onClick:t[0]||(t[0]=l=>M(""))},[c(n(Ke))])]),_:1}),(m(!0),F(be,null,we(p.breadcrumbs,(l,h)=>(m(),_(n(te),{key:h},{default:u(()=>[C("a",{onClick:b=>M(p.breadcrumbs.slice(0,h+1).join("/"))},O(l),9,at)]),_:2},1024))),128))]),_:1}),c(n(x),{gap:"small"},{default:u(()=>[n(H)?S("",!0):(m(),_(n(Z),{key:0},{default:u(()=>[c(A,{size:"small",onClick:t[1]||(t[1]=()=>fe())},{default:u(()=>[c(n(Ee)),P(" "+O(n(f).translate("i18n_filesnavigator_upload_file")),1)]),_:1}),c(A,{size:"small",onClick:t[2]||(t[2]=()=>ge())},{default:u(()=>[c(n(Xe)),P(" "+O(n(f).translate("i18n_filesnavigator_new_folder")),1)]),_:1})]),_:1})),s.value.size>0?(m(),_(n(Z),{key:1},{default:u(()=>[c(A,{size:"small",onClick:t[3]||(t[3]=()=>q(Array.from(s.value)))},{default:u(()=>[c(n(Te),{size:"18"}),P(" "+O(n(f).translate("i18n_filesnavigator_download",null,{count:s.value.size})),1)]),_:1}),c(A,{size:"small",danger:"",onClick:t[4]||(t[4]=()=>ie(ue.value))},{default:u(()=>[c(n(Je)),P(" "+O(n(f).translate("i18n_filesnavigator_delete",null,{count:s.value.size})),1)]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})]),c(Le,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:u(()=>[C("div",nt,[c(n(x),{justify:"space-between",align:"center",gap:"small",style:{"margin-bottom":"8px"}},{default:u(()=>[c(n(Oe),{value:y.searchTerm,"onUpdate:value":t[5]||(t[5]=l=>y.searchTerm=l),loading:n(H),placeholder:pe.value,style:{"max-width":"300px"},size:"small"},null,8,["value","loading","placeholder"]),g.value&&g.value.length>0?(m(),_(n(K),{key:0,checked:v.value,indeterminate:s.value.size>0&&s.value.size<g.value.length,class:"select-all-checkbox",onChange:ve},null,8,["checked","indeterminate"])):S("",!0)]),_:1})]),g.value&&g.value.length>0?(m(),_(n(Fe),{key:0,class:"files-list","data-source":g.value},{renderItem:u(({item:l})=>[c(n(Ae),{class:"compact-list-item"},{default:u(()=>[c(n(x),{align:"center",justify:"space-between",style:{width:"100%"}},{default:u(()=>[C("div",{style:{display:"flex","align-items":"center",gap:"8px",flex:"1",cursor:"pointer","min-width":"0"},onClick:h=>de(l)},[l.type==="directory"?(m(),_(n(Ve),{key:0,size:"18px"})):(m(),_(n(Me),{key:1,size:"18px"})),C("span",lt,[(m(),_(Ce(U(l.name))))]),l.type==="file"?(m(),F("span",st,O(ce(l)),1)):S("",!0)],8,rt),c(n(K),{checked:s.value.has(l.path),onChange:()=>me(l),onClick:t[6]||(t[6]=Ie(()=>{},["stop"]))},null,8,["checked","onChange"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])):(m(),_(n(Pe),{key:1,description:n(H)?n(f).translate("i18n_filesnavigator_loading"):n(f).translate("i18n_filesnavigator_no_files")},null,8,["description"]))]),_:1}),n(j)&&n(j).totalCount>d.pageSize?(m(),_(n(je),{key:0,current:d.currentIndex,"onUpdate:current":t[7]||(t[7]=l=>d.currentIndex=l),"page-size":d.pageSize,"onUpdate:pageSize":t[8]||(t[8]=l=>d.pageSize=l),total:n(j).totalCount,"show-total":l=>n(f).translate("i18n_filesnavigator_items",null,{total:l}),"show-size-changer":"","page-size-options":["10","20","50","100"],style:{"margin-top":"20px","text-align":"center"}},null,8,["current","page-size","total","show-total"])):S("",!0),c(n(Se),{open:r.value,"onUpdate:open":t[10]||(t[10]=l=>r.value=l),title:n(f).translate("i18n_filesnavigator_create_folder"),onOk:Y,onCancel:t[11]||(t[11]=l=>r.value=!1)},{default:u(()=>[c(n(ze),{value:i.value,"onUpdate:value":t[9]||(t[9]=l=>i.value=l),placeholder:n(f).translate("i18n_filesnavigator_enter_folder_name"),onPressEnter:Y},null,8,["value","placeholder"])]),_:1},8,["open","title"])]))}});const it=se(ot,[["__scopeId","data-v-99774134"]]),ct={class:"files-container"},ut=le({__name:"Files",setup(o){const r=$e().params.projectId,i=G.fromProjectId(r);return(s,v)=>(m(),F("div",ct,[c(n(xe),null,{default:u(()=>[P(O(n(f).translate("i18n_filesview_title")),1)]),_:1}),c(n(ke),null,{default:u(()=>[P(O(n(f).translate("i18n_filesview_description"))+" ",1),c(_e,{path:"tools/files"})]),_:1}),c(n(Re),{class:"files-card"},{default:u(()=>[c(it,{"files-model":n(i)},null,8,["files-model"])]),_:1})]))}});const zt=se(ut,[["__scopeId","data-v-1d917c14"]]);export{zt as default};
//# sourceMappingURL=Files.81259c6b.js.map

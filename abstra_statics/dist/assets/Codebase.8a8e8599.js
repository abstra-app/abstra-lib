var he=Object.defineProperty;var me=(a,e,t)=>e in a?he(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var X=(a,e,t)=>(me(a,typeof e!="symbol"?e+"":e,t),t);import{S as ye}from"./SourceCode.72c80f83.js";import{_ as ge}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.7c41edc8.js";import{C as ve}from"./ContentLayout.1e4962d7.js";import{d as N,af as I,g as O,o as u,K as A,O as T,F as w,e4 as be,a as _,b as v,e5 as U,eI as we,N as Y,eb as K,f as $,u as n,cw as ke,w as y,c as f,az as x,ea as ee,d4 as Fe,bM as B,cm as Pe,da as ie,eg as Ae,bK as _e,eE as je,bs as Ce,bq as q,cZ as Oe,cq as Se,t as L,Q as le,eH as xe,d6 as Ee,eJ as Ve,cy as Me}from"./index.430c17d4.js";import{p as $e}from"./popupNotifcation.ce59df22.js";import{a as He}from"./ant-design.9829a706.js";import{U as te,D as Re,a as ze,G as qe,f as Z,i as ce}from"./files.f34fe844.js";import{f as re}from"./string.96f862a3.js";import{G as ue}from"./PhFolder.vue.b5e2d049.js";import{S as De}from"./SaveButton.349e9441.js";import{G as Ie,I as Le}from"./PhFilePy.vue.8722b9cf.js";import{H as Ne,F as Be}from"./PhPackage.vue.a84cc223.js";import{F as Ze,G as Te,a as Ue,I as Ge}from"./PhWebhooksLogo.vue.3c2271a7.js";import{A as Je,b as We,c as Qe,d as Xe,e as Ye,f as Ke,g as et,h as tt}from"./linters.362dea33.js";import{W as rt}from"./workspaces.f7785544.js";import"./asyncComputed.9d10fb73.js";import"./polling.28fcf93c.js";import"./validations.31439d54.js";import"./toggleHighContrast.4787c2ec.js";import"./index.7baa0565.js";import"./Card.10ec19af.js";import"./TabPane.97f7a953.js";import"./Logo.f70a869f.js";import"./UnsavedChangesHandler.bbd953b7.js";import"./ExclamationCircleOutlined.d0192b09.js";import"./workspaceStore.14ac764c.js";import"./userStore.39c06a4e.js";import"./url.3e47104d.js";import"./colorHelpers.5f45d283.js";import"./record.577ad8df.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="d37f5730-0cae-4792-a9f4-6d26cb54296d",a._sentryDebugIdIdentifier="sentry-dbid-d37f5730-0cae-4792-a9f4-6d26cb54296d")}catch{}})();var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"};const nt=at;var st={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"};const ot=st,it=["width","height","fill","transform"],lt={key:0},ct=_("path",{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},null,-1),ut=[ct],dt={key:1},pt=_("path",{d:"M208,88H152V32Z",opacity:"0.2"},null,-1),ft=_("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Z"},null,-1),ht=[pt,ft],mt={key:2},yt=_("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM152,88V44l44,44Z"},null,-1),gt=[yt],vt={key:3},bt=_("path",{d:"M212.24,83.76l-56-56A6,6,0,0,0,152,26H56A14,14,0,0,0,42,40V216a14,14,0,0,0,14,14H200a14,14,0,0,0,14-14V88A6,6,0,0,0,212.24,83.76ZM158,46.48,193.52,82H158ZM200,218H56a2,2,0,0,1-2-2V40a2,2,0,0,1,2-2h90V88a6,6,0,0,0,6,6h50V216A2,2,0,0,1,200,218Z"},null,-1),wt=[bt],kt={key:4},Ft=_("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Z"},null,-1),Pt=[Ft],At={key:5},_t=_("path",{d:"M210.83,85.17l-56-56A4,4,0,0,0,152,28H56A12,12,0,0,0,44,40V216a12,12,0,0,0,12,12H200a12,12,0,0,0,12-12V88A4,4,0,0,0,210.83,85.17ZM156,41.65,198.34,84H156ZM200,220H56a4,4,0,0,1-4-4V40a4,4,0,0,1,4-4h92V88a4,4,0,0,0,4,4h52V216A4,4,0,0,1,200,220Z"},null,-1),jt=[_t],Ct={name:"PhFile"},de=N({...Ct,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(a){const e=a,t=I("weight","regular"),c=I("size","1em"),l=I("color","currentColor"),g=I("mirrored",!1),F=O(()=>{var b;return(b=e.weight)!=null?b:t}),j=O(()=>{var b;return(b=e.size)!=null?b:c}),C=O(()=>{var b;return(b=e.color)!=null?b:l}),V=O(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:g?"scale(-1, 1)":void 0);return(b,M)=>(u(),A("svg",be({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:j.value,height:j.value,fill:C.value,transform:V.value},b.$attrs),[T(b.$slots,"default"),F.value==="bold"?(u(),A("g",lt,ut)):F.value==="duotone"?(u(),A("g",dt,ht)):F.value==="fill"?(u(),A("g",mt,gt)):F.value==="light"?(u(),A("g",vt,wt)):F.value==="regular"?(u(),A("g",kt,Pt)):F.value==="thin"?(u(),A("g",At,jt)):w("",!0)],16,it))}});function ae(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),c.forEach(function(l){Ot(a,l,t[l])})}return a}function Ot(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var G=function(e,t){var c=ae({},e,t.attrs);return v(U,ae({},c,{icon:we}),null)};G.displayName="EditOutlined";G.inheritAttrs=!1;const St=G;function ne(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),c.forEach(function(l){xt(a,l,t[l])})}return a}function xt(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var J=function(e,t){var c=ne({},e,t.attrs);return v(U,ne({},c,{icon:nt}),null)};J.displayName="FileAddOutlined";J.inheritAttrs=!1;const se=J;function oe(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),c.forEach(function(l){Et(a,l,t[l])})}return a}function Et(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var W=function(e,t){var c=oe({},e,t.attrs);return v(U,oe({},c,{icon:ot}),null)};W.displayName="FolderAddOutlined";W.inheritAttrs=!1;const Vt=W;class Mt{async list(){const t=await(await fetch("/_editor/api/codebase/files")).json();return Je.parse(t)}async create(e,t){const l=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"POST",body:t})).json();return We.parse(l)}async delete(e){const c=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();return Qe.parse(c)}async update(e,t){const l=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"PUT",body:t})).json();return Xe.parse(l)}async retrieve(e){const c=await(await fetch(`/_editor/api/codebase/files/${e}`)).arrayBuffer();return new Uint8Array(c)}async rename(e,t){const c=Ye.parse({pathParts:e,newPathParts:t}),g=await(await fetch("/_editor/api/codebase/files/rename",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).json();return Ke.parse(g)}async mkdir(e){const c=await(await fetch(`/_editor/api/codebase/dir/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();return et.parse(c)}async settings(){const t=await(await fetch("/_editor/api/codebase/settings")).json();return tt.parse(t)}}const pe=N({__name:"ScrollArea",props:{innerClass:{},outerClass:{},outerStyle:{},innerStyle:{}},setup(a){const e=a,t=O(()=>e.outerStyle?{position:"relative",...e.outerStyle}:{position:"relative"}),c=O(()=>{var l;return{position:"absolute",inset:0,overflow:"auto",...(l=e.innerStyle)!=null?l:{}}});return(l,g)=>(u(),A("div",{style:Y(t.value),class:K(l.outerClass)},[_("div",{style:Y(c.value),class:K(l.innerClass)},[T(l.$slots,"default")],6)],6))}}),$t={class:"files-navigator"},Ht={key:0},Rt={key:1},zt={key:0,class:"file-size"},qt=N({__name:"FilesNavigator",props:{files:{},loading:{type:Boolean},onCreate:{type:Function},onDownload:{type:Function},onDelete:{type:Function},onRefetch:{type:Function},onRename:{type:Function},onOpen:{type:Function},onMkdir:{type:Function},separator:{}},setup(a){const e=a,t=r=>s=>{var i,d;return{key:s.pathParts.join(e.separator),title:r.keepFullPath?s.pathParts.join(e.separator):Z(s.pathParts),isLeaf:s.type==="file",file:s,children:r.keepFullPath?void 0:(d=(i=s.children)==null?void 0:i.map(o=>{var m;const h=(m=e.files)==null?void 0:m.find(S=>S.pathParts.join(e.separator)===o.join(e.separator));if(!h)throw new Error("Child node not found");return t({keepFullPath:r.keepFullPath})(h)}))!=null?d:[]}},c=r=>{if(!P.value.trim())return L("span",r);const s=re(P.value,r);return s?L("span",r.split("").map((i,d)=>s.includes(d)?L("span",{class:"char-match"},i):i)):L("span",r)},l=r=>{if(r.type==="directory")return"";const s=r.size;if(s<1024)return`${s} B`;const i=s/1024;if(i<1024)return`${i.toFixed(2)} KB`;const d=i/1024;return d<1024?`${d.toFixed(2)} MB`:`${(d/1024).toFixed(2)} GB`},g=O(()=>{var r,s;return P.value.trim()?(r=e.files)==null?void 0:r.filter(i=>i.pathParts.length===1&&re(P.value,i.pathParts.join(e.separator))).map(t({keepFullPath:!0})):(s=e.files)==null?void 0:s.filter(i=>i.pathParts.length===1).map(t({keepFullPath:!1}))}),F=r=>{var s,i;return r.isLeaf?1:(i=(s=r.children)==null?void 0:s.reduce((d,o)=>d+F(o),0))!=null?i:0},j=O(()=>g.value?g==null?void 0:g.value.reduce((r,s)=>r+F(s),0):0),C=$(!1);function V(r){if(r&&r.type==="file")return;const s=document.createElement("input");s.type="file",s.onchange=async()=>{var o,h,m,S,E;const i=(o=s.files)==null?void 0:o[0],d=await(i==null?void 0:i.arrayBuffer());if(!!i)try{C.value=!0,await((S=e.onCreate)==null?void 0:S.call(e,[...(h=r==null?void 0:r.pathParts)!=null?h:[],(m=i.name)!=null?m:"Untitled file"],d?new Uint8Array(d):void 0)),await((E=e.onRefetch)==null?void 0:E.call(e))}catch{$e("Failed to upload file","File already exists")}finally{C.value=!1}},s.click()}function b(r){var d;if(r&&r.type==="file")return;const s=prompt("Enter the name of the new file");if(!s)return;const i=r?[...r.pathParts,s]:[s];(d=e.onCreate)==null||d.call(e,i)}async function M(r){if(!r||!e.onDownload)return;const s=await e.onDownload(r.pathParts),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=Z(r.pathParts),i.click()}async function R(r){var i,d;if(!r)return;const s="Are you sure you want to delete this "+(r.type==="file"?"file":"directory and all its contents")+"?";await He(s)&&(await((i=e.onDelete)==null?void 0:i.call(e,r.pathParts)),await((d=e.onRefetch)==null?void 0:d.call(e)))}async function z(r){var d,o;if(!r)return;const s=prompt("Enter the new name of the file",Z(r.pathParts));if(!s)return;const i=[...r.pathParts.slice(0,-1),s];await((d=e.onRename)==null?void 0:d.call(e,r.pathParts,i)),await((o=e.onRefetch)==null?void 0:o.call(e))}async function H(r){var d;if(r&&r.type==="file")return;const s=prompt("Enter the name of the new folder");if(!s)return;const i=r?[...r.pathParts,s]:[s];(d=e.onMkdir)==null||d.call(e,i)}const P=$("");return(r,s)=>(u(),A("div",$t,[v(n(ke),{value:P.value,"onUpdate:value":s[0]||(s[0]=i=>P.value=i),loading:e.loading,placeholder:"Search files"},null,8,["value","loading"]),v(n(ie),{justify:"space-between"},{default:y(()=>[j.value>0?(u(),f(n(Fe),{key:0},{default:y(()=>[_("b",null,[x(ee(j.value)+" File",1),j.value!==1?(u(),A("span",Ht,"s")):w("",!0),P.value?(u(),A("span",Rt," found ")):w("",!0)])]),_:1})):w("",!0),r.loading?w("",!0):(u(),f(n(Pe),{key:1},{default:y(()=>[r.onCreate?(u(),f(n(B),{key:0,onClick:s[1]||(s[1]=()=>b())},{default:y(()=>[v(n(se)),x(" New File ")]),_:1})):w("",!0),r.onCreate?(u(),f(n(B),{key:1,onClick:s[2]||(s[2]=()=>V())},{default:y(()=>[v(n(te)),x(" Upload ")]),_:1})):w("",!0),r.onMkdir?(u(),f(n(B),{key:2,onClick:s[3]||(s[3]=()=>H())},{default:y(()=>[v(n(Vt)),x(" New Folder ")]),_:1})):w("",!0)]),_:1}))]),_:1}),v(pe,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:y(()=>[g.value&&g.value.length>0?(u(),f(n(Oe),{key:0,class:"files-tree","tree-data":g.value,selectable:"",onSelect:s[5]||(s[5]=(i,{node:{file:d}})=>{var o;return(o=e.onOpen)==null?void 0:o.call(e,d.pathParts)})},{title:y(({title:i,isLeaf:d,file:o})=>[_("span",null,[(u(),f(Ae(c(i)))),d?(u(),A("span",zt,"("+ee(l(o))+")",1)):w("",!0)]),v(n(_e),{onClick:s[4]||(s[4]=je(()=>{},["stop"]))},{overlay:y(()=>[v(n(Ce),{disabled:r.loading},{default:y(()=>[r.onDownload?(u(),f(n(q),{key:0,onClick:()=>M(o)},{default:y(()=>[v(n(Re)),x(" Download ")]),_:2},1032,["onClick"])):w("",!0),r.onRename?(u(),f(n(q),{key:1,onClick:()=>z(o)},{default:y(()=>[v(n(St)),x(" Rename ")]),_:2},1032,["onClick"])):w("",!0),!d&&r.onCreate?(u(),f(n(q),{key:2,onClick:()=>b(o)},{default:y(()=>[v(n(se)),x(" New File ")]),_:2},1032,["onClick"])):w("",!0),r.onCreate?(u(),f(n(q),{key:3,loading:r.loading,onClick:()=>V(o)},{default:y(()=>[v(n(te)),x(" Upload ")]),_:2},1032,["loading","onClick"])):w("",!0),r.onDelete?(u(),f(n(q),{key:4,danger:"",onClick:()=>R(o)},{default:y(()=>[v(n(ze)),x(" Delete ")]),_:2},1032,["onClick"])):w("",!0)]),_:2},1032,["disabled"])]),default:y(()=>[v(n(qe),{style:{cursor:"pointer",float:"inline-end"},size:"25px"})]),_:2},1024)]),icon:y(({file:i})=>[T(r.$slots,"icon",{file:i},()=>[i.type==="directory"?(u(),f(n(ue),{key:0})):(u(),f(n(de),{key:1}))],!0)]),_:3},8,["tree-data"])):(u(),f(n(Se),{key:1,description:r.loading?"Loading...":"No files"},null,8,["description"]))]),_:3})]))}});const Dt=le(qt,[["__scopeId","data-v-1c0a4c2f"]]),It=a=>{switch(a){case"abap":return"abap";case"apex":return"apex";case"azcli":return"azcli";case"bat":return"bat";case"bicep":return"bicep";case"c":return"c";case"cameligo":return"cameligo";case"clojure":return"clojure";case"coffeescript":return"coffeescript";case"cpp":return"cpp";case"csharp":return"csharp";case"csp":return"csp";case"css":return"css";case"cypher":return"cypher";case"dart":return"dart";case"dockerfile":return"dockerfile";case"ecl":return"ecl";case"elixir":return"elixir";case"flow9":return"flow9";case"freemarker2":return"freemarker2";case"freemarker2.tag-angle.interpolation-bracket":return"freemarker2.tag-angle.interpolation-bracket";case"freemarker2.tag-angle.interpolation-dollar":return"freemarker2.tag-angle.interpolation-dollar";case"freemarker2.tag-auto.interpolation-bracket":return"freemarker2.tag-auto.interpolation-bracket";case"freemarker2.tag-auto.interpolation-dollar":return"freemarker2.tag-auto.interpolation-dollar";case"freemarker2.tag-bracket.interpolation-bracket":return"freemarker2.tag-bracket.interpolation-bracket";case"freemarker2.tag-bracket.interpolation-dollar":return"freemarker2.tag-bracket.interpolation-dollar";case"fsharp":return"fsharp";case"go":return"go";case"graphql":return"graphql";case"handlebars":return"handlebars";case"hcl":return"hcl";case"html":return"html";case"ini":return"ini";case"java":return"java";case"javascript":return"javascript";case"json":return"json";case"julia":return"julia";case"kotlin":return"kotlin";case"less":return"less";case"lexon":return"lexon";case"liquid":return"liquid";case"lua":return"lua";case"m3":return"m3";case"markdown":return"markdown";case"mdx":return"mdx";case"mips":return"mips";case"msdax":return"msdax";case"mysql":return"mysql";case"objective-c":return"objective-c";case"pascal":return"pascal";case"pascaligo":return"pascaligo";case"perl":return"perl";case"pgsql":return"pgsql";case"php":return"php";case"pla":return"pla";case"plaintext":return"plaintext";case"postiats":return"postiats";case"powerquery":return"powerquery";case"powershell":return"powershell";case"proto":return"proto";case"pug":return"pug";case"python":return"python";case"qsharp":return"qsharp";case"r":return"r";case"razor":return"razor";case"redis":return"redis";case"redshift":return"redshift";case"restructuredtext":return"restructuredtext";case"ruby":return"ruby";case"rust":return"rust";case"sb":return"sb";case"scala":return"scala";case"scheme":return"scheme";case"scss":return"scss";case"shell":return"shell";case"sol":return"sol";case"sparql":return"sparql";case"sql":return"sql";case"st":return"st";case"swift":return"swift";case"systemverilog":return"systemverilog";case"tcl":return"tcl";case"twig":return"twig";case"typescript":return"typescript";case"typespec":return"typespec";case"vb":return"vb";case"verilog":return"verilog";case"xml":return"xml";case"yaml":return"yaml";default:return"plaintext"}};class Lt{constructor(e,t,c,l){X(this,"initialContent");this.fileNode=e,this.content=t,this.sep=c,this.onSave=l,this.initialContent=new Uint8Array(t)}get file(){return this.fileNode.pathParts.join(this.sep)}get codeContent(){return this.text}set codeContent(e){this.text=e}updateInitialState(e,t){this.initialContent=new TextEncoder().encode(t)}get text(){return new TextDecoder().decode(this.content)}set text(e){const t=new TextEncoder;this.content=t.encode(e)}get url(){return`/_editor/api/codebase/files/${this.file}`}hasChanges(){return this.content.length!==this.initialContent.length||!this.content.every((e,t)=>e===this.initialContent[t])}async save(){await this.onSave(this),this.initialContent=new Uint8Array(this.content)}isImage(){return ce(this.file)}isText(){return!this.isImage()}}const Nt=a=>{const e=$([]),t=$(!1),c=$(null),l=$({separator:"/"}),g=async()=>{t.value=!0;try{e.value=await a.api.list()}finally{t.value=!1}},F=async()=>{l.value=await a.api.settings()},j=a.router.currentRoute.value.query.f,C=async(o,h)=>{const m=o.join(l.value.separator);await a.api.create(m,h),await g()},V=async o=>{const h=o.join(l.value.separator);await a.api.delete(h),await g()},b=async(o,h)=>{await a.api.rename(o,h),await g()},M=async(o,h)=>{const m=o.join(l.value.separator);await a.api.update(m,h)},R=async o=>{const h=o.join(l.value.separator);return a.api.retrieve(h)},z=async o=>{const h=o.join(l.value.separator);await a.api.mkdir(h),await g()},H=o=>{switch(o.type){case"form":return{name:"formEditor",params:{id:o.id}};case"hook":return{name:"hookEditor",params:{id:o.id}};case"job":return{name:"jobEditor",params:{id:o.id}};case"script":return{name:"scriptEditor",params:{id:o.id}};default:throw new Error(`Unknown stage type: ${o.type}`)}},P=async o=>{var S;const h=o.join(l.value.separator),m=e.value.find(E=>E.file.pathParts.join(l.value.separator)===h);if(!m)throw new Error(`File not found: ${h}`);if(m.file.type==="directory")c.value=null;else if(m.file.pathParts.length===1&&m.file.pathParts[0]==="requirements.txt")a.router.push({name:"settingsRequirements"});else if(m.file.pathParts.length===1&&m.file.pathParts[0]===".env")a.router.push({name:"env-vars"});else if(!m.stages||m.stages.length===0)c.value=new Lt(m.file,await R(o),(S=l.value.separator)!=null?S:"/",({content:D})=>M(o,D)),new URL(window.location.href).searchParams.set("f",o.join(l.value.separator)),a.router.replace({query:{...a.router.currentRoute.value.query,f:o}});else if(m.stages.length===1){const E=m.stages[0];a.router.push(H(E))}},r=O(()=>e.value.map(({file:o})=>o)),s=O(()=>{var h;const o=(h=c.value)==null?void 0:h.file.split(".").pop();return o?It(o):"plaintext"}),i=O(()=>c.value?c.value:null),d=$(null);return rt.get().then(o=>{d.value=o}),Promise.all([g(),F()]).then(()=>{typeof j=="string"&&P(j.split(l.value.separator))}),{files:r,loading:t,editing:c,language:s,settings:l,mkdir:z,fetchFiles:g,uploadFile:C,deleteFile:V,renameFile:b,editFile:M,open:P,sourceCodeEditable:i,workspaceModel:d,filesListResponse:e}},Bt={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"stretch","align-items":"stretch"}},Zt={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Tt=N({__name:"Codebase",setup(a){const e=xe(),t=p=>p.type==="file"&&p.pathParts[p.pathParts.length-1].endsWith(".py"),c=p=>p.type==="file"&&p.pathParts.length===1&&p.pathParts[0]==="abstra.json",l=p=>p.type==="file"&&ce(p.pathParts[p.pathParts.length-1]),g=p=>p.type==="file"&&p.pathParts.length===1&&p.pathParts[0]==="requirements.txt",F=p=>p.type==="file"&&p.pathParts.length===1&&p.pathParts[0]===".env",j=p=>p.type==="file"&&p.pathParts.length===1&&p.pathParts[0]===".gitignore",C=(p,Q)=>E.value.some(k=>k.stages.some(fe=>fe.type===p)&&k.file.pathParts.join("/")===Q.pathParts.join("/")),V=p=>C("form",p),b=p=>C("hook",p),M=p=>C("job",p),R=p=>C("script",p),z=new Mt,{loading:H,uploadFile:P,deleteFile:r,open:s,files:i,editing:d,renameFile:o,sourceCodeEditable:h,mkdir:m,workspaceModel:S,filesListResponse:E,settings:D}=Nt({api:z,router:e});return(p,Q)=>(u(),f(ve,{"full-width":!!n(d)},{default:y(()=>[_("div",Bt,[_("div",Zt,[v(n(Ee),null,{default:y(()=>[x("Source Code")]),_:1}),n(h)?(u(),f(De,{key:0,model:n(h),disabled:n(H)},null,8,["model","disabled"])):w("",!0)]),v(pe,{"inner-class":"scroll-area","outer-style":{flexGrow:1},"inner-style":{display:"flex",justifyContent:"stretch",gap:"20px"}},{default:y(()=>[v(Dt,{class:"files-nav",files:n(i),loading:n(H),separator:n(D).separator,onCreate:n(P),onDelete:n(r),onOpen:n(s),onRename:n(o),onMkdir:n(m)},{icon:y(({file:k})=>[v(n(ie),{style:{height:"100%"},justify:"center",align:"center"},{default:y(()=>[k.type==="directory"?(u(),f(n(ue),{key:0})):V(k)?(u(),f(n(Ze),{key:1})):b(k)?(u(),f(n(Te),{key:2})):M(k)?(u(),f(n(Ue),{key:3})):R(k)?(u(),f(n(Ge),{key:4})):t(k)?(u(),f(n(Ie),{key:5})):c(k)?(u(),f(ge,{key:6,"hide-text":""})):g(k)?(u(),f(n(Ne),{key:7})):F(k)?(u(),f(n(Le),{key:8})):l(k)?(u(),f(n(Ve),{key:9})):j(k)?(u(),f(n(Be),{key:10})):(u(),f(n(de),{key:11}))]),_:2},1024)]),_:1},8,["files","loading","separator","onCreate","onDelete","onOpen","onRename","onMkdir"]),n(d)&&n(d).isImage()?(u(),f(n(Me),{key:0,class:"editing-content",src:n(d).url},null,8,["src"])):n(h)&&n(S)?(u(),f(ye,{key:1,script:n(h),class:"editing-content","hide-header":"",workspace:n(S)},null,8,["script","workspace"])):w("",!0)]),_:1})])]),_:1},8,["full-width"]))}});const Pr=le(Tt,[["__scopeId","data-v-8c65d618"]]);export{Pr as default};
//# sourceMappingURL=Codebase.8a8e8599.js.map

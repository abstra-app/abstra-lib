import{a as _,H as m,p as v,b as l,f as c,w as n,h as s,u as r,E as u,c3 as w,ak as y,g as d,t as p,i as h,T as f,aK as I,r as b,ag as P}from"./jwt-decode.esm-BRRA-bKi.js";import{_ as x}from"./AbstraLogo.vue_vue_type_script_setup_true_lang-BhCyIHNg.js";import{B as E}from"./BaseLayout-DDesBafq.js";import{l as g}from"./fetch-6UfJcZbB.js";import"./router-Bh5EUIsF.js";import{P as j}from"./project-BTgwRZj3.js";import"./tables-Cb0rOdcm.js";import"./logo-BiWG9_W5.js";import"./Logo-DQ-KAI-Y.js";import"./ts.worker-D9N1lSIu.js";import"./record-B_JjtlWo.js";import"./string-BUHbcr79.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="67fc6a32-4a2c-4aa5-b747-2293cdaa1228",e._sentryDebugIdIdentifier="sentry-dbid-67fc6a32-4a2c-4aa5-b747-2293cdaa1228")}catch{}})();const T=_({__name:"View",props:{controller:{}},setup(e){const t=e,i=t.controller.loadingPercentage();return m(()=>{t.controller.start()}),v(()=>{t.controller.cleanUp()}),(a,o)=>(c(),l(E,null,{content:n(()=>[s(r(u),{align:"center",justify:"center",style:{width:"100vw",height:"100dvh"}},{default:n(()=>[s(r(u),{gap:"large",align:"center",justify:"space-evenly",vertical:"",style:{width:"45%","min-width":"600px",height:"100%"}},{default:n(()=>[s(x,{size:"large"}),s(r(w),{size:[10,10],"show-info":!1,percent:r(i),"stroke-color":"#EA576A"},null,8,["percent"]),s(r(y),{level:3},{default:n(()=>[d(p(r(h).translate("i18n_webeditorview_preparing_environment")),1)]),_:1}),r(i)<100?(c(),l(r(f),{key:0},{default:n(()=>[d(p(r(h).translate("i18n_webeditorview_setting_up")),1)]),_:1})):(c(),l(r(f),{key:1},{default:n(()=>[d(p(r(h).translate("i18n_webeditorview_redirecting_soon")),1)]),_:1}))]),_:1})]),_:1})]),_:1}))}}),W=I(T,[["__scopeId","data-v-5fd653ca"]]);function k(e,t){if(!e)return"";const i=t.toString();if(!i)return e;const o=e.includes("?")?"&":"?";return`${e}${o}${i}`}class R{projectId;loading;fetch=g;interval=null;urls=null;totalWaitTime;poolingInterval;pingResponded=!1;redirectPath;constructor(t,i,a=g){this.projectId=t,this.loading=b(0),this.fetch=a,this.totalWaitTime=6e4,this.poolingInterval=2500,this.redirectPath=i}increment(){this.loading.value+=100/(this.totalWaitTime/this.poolingInterval)}speedUp(){this.totalWaitTime=5e3,this.poolingInterval=500,this.interval&&clearInterval(this.interval),this.interval=setInterval(async()=>{this.increment(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}navigate(){if(this.urls){const t=new URLSearchParams;this.redirectPath&&t.set("redirect",this.redirectPath);const i=k(this.urls.redirect,t);window.location.replace(i)}this.cleanUp()}async ping(){if(!this.urls)return!1;if(this.pingResponded)return!0;const t=await this.fetch(this.urls.ping,{signal:AbortSignal.timeout(500)});return this.pingResponded=t.status===200,this.pingResponded}async start(){const t=await j.startWebEditor(this.projectId);this.urls=t,this.interval=setInterval(async()=>{this.increment(),this.pingResponded||await this.ping()&&this.speedUp(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}cleanUp(){this.interval&&clearInterval(this.interval)}loadingPercentage(){return this.loading}}const H=_({__name:"WebEditor",setup(e){const t=P(),i=t.params.projectId,a=t.query.redirect,o=new R(i,a);return(A,D)=>(c(),l(W,{controller:r(o)},null,8,["controller"]))}});export{H as default};
//# sourceMappingURL=WebEditor-D-SeMYnh.js.map

var _=Object.defineProperty;var m=(t,e,n)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>(m(t,typeof e!="symbol"?e+"":e,n),n);import{d as g,J as v,I as y,a as c,b as s,o as d,f as o,u as r,de as h,cO as w,A as I,g as p,da as u,_ as b,r as P,eb as x}from"./jwt-decode.esm.875a2b0a.js";import{_ as W}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.0381cf1c.js";import{B as j}from"./BaseLayout.2c857436.js";import{l as f}from"./fetch.06f1feff.js";import"./router.431cd93c.js";import{a as A}from"./project.8c7c5d16.js";import"./tables.4819d887.js";import"./Logo.1b44b8f3.js";import"./index.3dc4874a.js";import"./record.b26704dd.js";import"./string.7c188654.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="f726767f-c4fa-4506-aef4-1d40ec0aeb28",t._sentryDebugIdIdentifier="sentry-dbid-f726767f-c4fa-4506-aef4-1d40ec0aeb28")}catch{}})();const E=g({__name:"View",props:{controller:{}},setup(t){const e=t,n=e.controller.loadingPercentage();return v(()=>{e.controller.start()}),y(()=>{e.controller.cleanUp()}),(a,l)=>(d(),c(j,null,{content:s(()=>[o(r(h),{align:"center",justify:"center",style:{width:"100vw",height:"100dvh"}},{default:s(()=>[o(r(h),{gap:"large",align:"center",justify:"space-evenly",vertical:"",style:{width:"45%","min-width":"600px",height:"100%"}},{default:s(()=>[o(W,{size:"large"}),o(r(w),{size:[10,10],"show-info":!1,percent:r(n),"stroke-color":"#EA576A"},null,8,["percent"]),o(r(I),{level:3},{default:s(()=>[p("Preparing your environment")]),_:1}),r(n)<100?(d(),c(r(u),{key:0},{default:s(()=>[p("We are setting things up... This may take up to 1 minute.")]),_:1})):(d(),c(r(u),{key:1},{default:s(()=>[p("You will be redirected soon")]),_:1}))]),_:1})]),_:1})]),_:1}))}});const T=b(E,[["__scopeId","data-v-0794e790"]]);function k(t,e){if(!t)return"";const n=e.toString();if(!n)return t;const l=t.includes("?")?"&":"?";return`${t}${l}${n}`}class R{constructor(e,n,a=f){i(this,"projectId");i(this,"loading");i(this,"fetch",f);i(this,"interval",null);i(this,"urls",null);i(this,"totalWaitTime");i(this,"poolingInterval");i(this,"pingResponded",!1);i(this,"redirectPath");this.projectId=e,this.loading=P(0),this.fetch=a,this.totalWaitTime=6e4,this.poolingInterval=2500,this.redirectPath=n}increment(){this.loading.value+=100/(this.totalWaitTime/this.poolingInterval)}speedUp(){this.totalWaitTime=5e3,this.poolingInterval=500,this.interval&&clearInterval(this.interval),this.interval=setInterval(async()=>{this.increment(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}navigate(){if(this.urls){const e=new URLSearchParams;this.redirectPath&&e.set("redirect",this.redirectPath);const n=k(this.urls.redirect,e);window.location.replace(n)}this.cleanUp()}async ping(){if(!this.urls)return!1;if(this.pingResponded)return!0;const e=await this.fetch(this.urls.ping,{signal:AbortSignal.timeout(500)});return this.pingResponded=e.status===200,this.pingResponded}async start(){const e=await A.startWebEditor(this.projectId);this.urls=e,this.interval=setInterval(async()=>{this.increment(),this.pingResponded||await this.ping()&&this.speedUp(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}cleanUp(){this.interval&&clearInterval(this.interval)}loadingPercentage(){return this.loading}}const O=g({__name:"WebEditor",setup(t){const e=x(),n=e.params.projectId,a=e.query.redirect,l=new R(n,a);return(U,V)=>(d(),c(T,{controller:r(l)},null,8,["controller"]))}});export{O as default};
//# sourceMappingURL=WebEditor.0e03dfa6.js.map

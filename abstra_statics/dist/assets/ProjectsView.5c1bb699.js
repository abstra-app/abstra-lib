var y=Object.defineProperty;var I=(r,e,t)=>e in r?y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>(I(r,typeof e!="symbol"?e+"":e,t),t);import{C}from"./CrudView.eba26808.js";import{e as u,f as j,cL as k,ep as T,d as E,ea as z,eo as _,o as g,X as O,u as a,c as v,R as w,b as c,w as m,aR as A,cy as P,bK as N,aA as R,cx as S,cK as D}from"./vue-router.b8278ae0.js";import"./gateway.017627e4.js";import{M as V}from"./member.bd6f52ed.js";import{P as b,a as x}from"./project.4be49246.js";import"./tables.00341c83.js";import{a as F}from"./ant-design.883fac2a.js";import{T as M,G as U}from"./tagColorProvider.793f0f42.js";import{I as $}from"./PhCopy.vue.0f9c82f3.js";import{O as B}from"./organization.17a98197.js";import"./router.b6d759a6.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.74a15f42.js";import"./BookOutlined.14129c8c.js";import"./url.4c829cdd.js";import"./PhDotsThreeVertical.vue.f26615e4.js";import"./Badge.e69c3f58.js";import"./index.74c6d037.js";import"./popupNotifcation.0d878add.js";import"./record.1ce8e230.js";import"./string.4e2df4c8.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="aada0da2-9d28-4220-bb49-5d7e36038b29",r._sentryDebugIdIdentifier="sentry-dbid-aada0da2-9d28-4220-bb49-5d7e36038b29")}catch{}})();const L=[{key:"name",label:"Project Name"}];class G{constructor(e,t,n){o(this,"projects",u(null));o(this,"organization",u(null));o(this,"editingProject",u(null));o(this,"teamColorProvider",new M);o(this,"teamOptions",u([]));o(this,"table",j(()=>this.makeCrudViewTable()));o(this,"loading",j(()=>!this.projects.value||!this.organization.value));o(this,"createProject",async e=>{const t=await b.create({organizationId:this.organizationId,name:e.name});this.handlers.navigateToProject(t.id)});o(this,"deleteProject",async({key:e})=>{var n,s;if(!!await F("Are you sure you want to delete this project?")){try{await((s=(n=this.projects.value)==null?void 0:n.find(l=>l.id===e))==null?void 0:s.delete())}catch(l){k.error({message:"Error deleting project",description:String(l)})}await this.fetchInitialState()}});o(this,"duplicateProject",async({key:e})=>{var n;const t=(n=this.projects.value)==null?void 0:n.find(s=>s.id===e);if(t){const s=await t.duplicate();this.handlers.navigateToProject(s.id)}});o(this,"saveEdit",async()=>{if(!this.editingProject.value)return;const{projectId:e,newName:t,newTeam:n}=this.editingProject.value;await this.apis.project.update(e,{name:t,team:n!=null?n:null}),await this.fetchInitialState(),this.editingProject.value=null});o(this,"cancelEdit",()=>{this.editingProject.value=null});o(this,"getActions",e=>{var t;return[{icon:U,label:"Edit project",onClick:()=>this.startEditingProject(e)},{icon:$,label:"Duplicate",onClick:()=>this.duplicateProject({key:e.id}),hide:!!((t=this.organization.value)!=null&&t.featureFlags.DUPLICATE_PROJECTS)},{icon:T,label:"Delete",onClick:()=>this.deleteProject({key:e.id}),dangerous:!0}]});o(this,"getRows",()=>this.projects.value?this.projects.value.map(e=>({key:e.id,cells:[{type:"link",text:e.name,to:`/projects/${encodeURIComponent(e.id)}`},{type:"tag",text:e.team||"No team",tagColor:e.team?this.teamColorProvider.getColor(e.team):"default"},{type:"actions",actions:this.getActions(e)}]})):[]);this.organizationId=e,this.handlers=t,this.apis=n}async fetchInitialState(){this.projects.value=await b.list(this.organizationId),this.organization.value=await B.get(this.organizationId),this.teamOptions.value=await this.fetchTeamOptions()}async fetchTeamOptions(){return(await this.apis.member.fetchTeamOptions(this.organizationId)).map(t=>({label:t,value:t}))}startEditingProject(e){var t;this.editingProject.value={projectId:e.id,newName:e.name,newTeam:(t=e.team)!=null?t:""}}makeCrudViewTable(){return{columns:[{title:"Project",align:"left"},{title:"Team",align:"center"},{title:"",align:"right"}],rows:this.getRows()}}}const me=E({__name:"ProjectsView",setup(r){const t=z().params.organizationId,n=_(),s={navigateToProject:h=>n.push({name:"project",params:{organizationId:t,projectId:h}})},l={member:new V,project:new x},i=new G(t,s,l);return i.fetchInitialState(),(h,d)=>{var f;return g(),O(A,null,[a(i).table.value?(g(),v(C,{key:0,"entity-name":"project",loading:a(i).loading.value,title:`${(f=a(i).organization.value)==null?void 0:f.name}'s Projects`,description:"Organize your team\u2019s work into different Projects, each with it\u2019s own environment settings and authorized users.","create-button-text":"Create Project","empty-title":"No projects here yet",table:a(i).table.value,fields:a(L),create:a(i).createProject},null,8,["loading","title","table","fields","create"])):w("",!0),c(a(D),{open:!!a(i).editingProject.value,title:"Edit project",onCancel:a(i).cancelEdit,onOk:a(i).saveEdit},{default:m(()=>[a(i).editingProject.value?(g(),v(a(S),{key:0,layout:"vertical"},{default:m(()=>[c(a(P),{label:"Name"},{default:m(()=>[c(a(N),{value:a(i).editingProject.value.newName,"onUpdate:value":d[0]||(d[0]=p=>a(i).editingProject.value.newName=p)},null,8,["value"])]),_:1}),c(a(P),{label:"Team",tooltip:"Create Teams by adding them on the Editors page",help:a(i).editingProject.value.newTeam?`Only editors within '${a(i).editingProject.value.newTeam}' or organization Admins can view the project`:"Project will be visible to all editors"},{default:m(()=>[c(a(R),{value:a(i).editingProject.value.newTeam,"onUpdate:value":d[1]||(d[1]=p=>a(i).editingProject.value.newTeam=p),"allow-clear":"",options:a(i).teamOptions.value,placeholder:"Select or type new team name","not-found-content":"Create a team first on the Editors page"},null,8,["value","options"])]),_:1},8,["help"])]),_:1})):w("",!0)]),_:1},8,["open","onCancel","onOk"])],64)}}});export{me as default};
//# sourceMappingURL=ProjectsView.5c1bb699.js.map

var K=Object.defineProperty;var Y=(u,e,o)=>e in u?K(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o;var _=(u,e,o)=>(Y(u,typeof e!="symbol"?e+"":e,o),o);import{_ as Q}from"./DocsButton.vue_vue_type_script_setup_true_lang.8b8577c6.js";import{_ as X}from"./AbstraButton.vue_vue_type_script_setup_true_lang.68abc039.js";import{d as q,am as M,c as w,o as s,a5 as v,a7 as ee,h as f,e6 as te,e as k,r as ne,M as N,a as h,b as i,f as l,u as t,de as m,d4 as ae,g as p,da as b,ec as I,e9 as oe,_ as R,ea as ie,aR as V,A as U,d9 as D,eb as j,bP as le,bx as se,bw as O,bJ as E,cW as ce,cy as re,cE as ue,cz as de,eF as pe,ev as he,ew as ve}from"./jwt-decode.esm.e2eb277f.js";import{G as ge}from"./PhDotsThreeVertical.vue.b50a745e.js";import{h as A,l as me}from"./router.9affa46d.js";import{G as ye}from"./PhWebhooksLogo.vue.7cdf1467.js";import{A as W}from"./index.ff3b06b0.js";import{C as J}from"./Card.47018899.js";import{A as fe}from"./index.0f2f9b41.js";import"./constants.183cb5c5.js";import"./index.ff8f73b1.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[e]="bc25c492-c2fb-40db-991d-1632b40a321b",u._sentryDebugIdIdentifier="sentry-dbid-bc25c492-c2fb-40db-991d-1632b40a321b")}catch{}})();const Ce=["width","height","fill","transform"],_e={key:0},we=k("path",{d:"M224,64H180V56a28,28,0,0,0-28-28H104A28,28,0,0,0,76,56v8H32A20,20,0,0,0,12,84V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V84A20,20,0,0,0,224,64ZM100,56a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4v8H100ZM220,88v32H196v-4a12,12,0,0,0-24,0v4H84v-4a12,12,0,0,0-24,0v4H36V88ZM36,188V144H60v4a12,12,0,0,0,24,0v-4h88v4a12,12,0,0,0,24,0v-4h24v44Z"},null,-1),ke=[we],Ve={key:1},He=k("path",{d:"M232,120v72a8,8,0,0,1-8,8H32a8,8,0,0,1-8-8V120Z",opacity:"0.2"},null,-1),be=k("path",{d:"M224,64H176V56a24,24,0,0,0-24-24H104A24,24,0,0,0,80,56v8H32A16,16,0,0,0,16,80V192a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V80A16,16,0,0,0,224,64ZM96,56a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96ZM32,80H224v32H192v-8a8,8,0,0,0-16,0v8H80v-8a8,8,0,0,0-16,0v8H32ZM224,192H32V128H64v8a8,8,0,0,0,16,0v-8h96v8a8,8,0,0,0,16,0v-8h32v64Z"},null,-1),Ae=[He,be],Ie={key:2},Se=k("path",{d:"M224,64H176V56a24,24,0,0,0-24-24H104A24,24,0,0,0,80,56v8H32A16,16,0,0,0,16,80v28a4,4,0,0,0,4,4H64V96.27A8.17,8.17,0,0,1,71.47,88,8,8,0,0,1,80,96v16h96V96.27A8.17,8.17,0,0,1,183.47,88,8,8,0,0,1,192,96v16h44a4,4,0,0,0,4-4V80A16,16,0,0,0,224,64Zm-64,0H96V56a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8Zm80,68v60a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V132a4,4,0,0,1,4-4H64v16a8,8,0,0,0,8.53,8A8.17,8.17,0,0,0,80,143.73V128h96v16a8,8,0,0,0,8.53,8,8.17,8.17,0,0,0,7.47-8.25V128h44A4,4,0,0,1,240,132Z"},null,-1),Te=[Se],$e={key:3},xe=k("path",{d:"M224,66H174V56a22,22,0,0,0-22-22H104A22,22,0,0,0,82,56V66H32A14,14,0,0,0,18,80V192a14,14,0,0,0,14,14H224a14,14,0,0,0,14-14V80A14,14,0,0,0,224,66ZM94,56a10,10,0,0,1,10-10h48a10,10,0,0,1,10,10V66H94ZM32,78H224a2,2,0,0,1,2,2v34H190V104a6,6,0,0,0-12,0v10H78V104a6,6,0,0,0-12,0v10H30V80A2,2,0,0,1,32,78ZM224,194H32a2,2,0,0,1-2-2V126H66v10a6,6,0,0,0,12,0V126H178v10a6,6,0,0,0,12,0V126h36v66A2,2,0,0,1,224,194Z"},null,-1),Me=[xe],je={key:4},Ne=k("path",{d:"M224,64H176V56a24,24,0,0,0-24-24H104A24,24,0,0,0,80,56v8H32A16,16,0,0,0,16,80V192a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V80A16,16,0,0,0,224,64ZM96,56a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96ZM224,80v32H192v-8a8,8,0,0,0-16,0v8H80v-8a8,8,0,0,0-16,0v8H32V80Zm0,112H32V128H64v8a8,8,0,0,0,16,0v-8h96v8a8,8,0,0,0,16,0v-8h32v64Z"},null,-1),Ze=[Ne],ze={key:5},Ue=k("path",{d:"M224,68H172V56a20,20,0,0,0-20-20H104A20,20,0,0,0,84,56V68H32A12,12,0,0,0,20,80V192a12,12,0,0,0,12,12H224a12,12,0,0,0,12-12V80A12,12,0,0,0,224,68ZM92,56a12,12,0,0,1,12-12h48a12,12,0,0,1,12,12V68H92ZM32,76H224a4,4,0,0,1,4,4v36H188V104a4,4,0,0,0-8,0v12H76V104a4,4,0,0,0-8,0v12H28V80A4,4,0,0,1,32,76ZM224,196H32a4,4,0,0,1-4-4V124H68v12a4,4,0,0,0,8,0V124H180v12a4,4,0,0,0,8,0V124h40v68A4,4,0,0,1,224,196Z"},null,-1),De=[Ue],Ee={name:"PhToolbox"},qe=q({...Ee,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(u){const e=u,o=M("weight","regular"),n=M("size","1em"),r=M("color","currentColor"),y=M("mirrored",!1),C=w(()=>{var g;return(g=e.weight)!=null?g:o}),x=w(()=>{var g;return(g=e.size)!=null?g:n}),Z=w(()=>{var g;return(g=e.color)!=null?g:r}),z=w(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(g,c)=>(s(),v("svg",te({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:x.value,height:x.value,fill:Z.value,transform:z.value},g.$attrs),[ee(g.$slots,"default"),C.value==="bold"?(s(),v("g",_e,ke)):C.value==="duotone"?(s(),v("g",Ve,Ae)):C.value==="fill"?(s(),v("g",Ie,Te)):C.value==="light"?(s(),v("g",$e,Me)):C.value==="regular"?(s(),v("g",je,Ze)):C.value==="thin"?(s(),v("g",ze,De)):f("",!0)],16,Ce))}});class Pe{async getLoginUrl(e,o,n,r){return A.get(`projects/${e}/connectors/${n}/connections/${o}/login-url`,{scopeIds:r.join(",")})}async listConnectors(e){return A.get(`projects/${e}/connectors`)}async createTokenConnection(e){const{projectId:o,connectionName:n,connectorType:r,tokens:y}=e,C={type:"tokens",tokens:y};return A.post(`projects/${o}/connectors/${r}/connections/${n}`,C)}async listConnections(e){return A.get(`projects/${e}/connections`)}async deleteConnection(e){const{projectId:o,connectionName:n,connectorType:r}=e;return A.delete(`projects/${o}/connectors/${r}/connections/${n}`)}async renameConnection(e){const{projectId:o,connectionName:n,connectorType:r,newConnectionName:y}=e;return A.patch(`projects/${o}/connectors/${r}/connections/${n}`,{newConnectionName:y})}}class Be{constructor(e,o){_(this,"state");_(this,"hasChanges",w(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));_(this,"handleDeletionClick",async e=>{N.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(e)})});_(this,"handleDeleteConnection",async e=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});_(this,"handleAddConnectionSubmit",async()=>{var r,y;const e=(r=this.state.value.addingConnection)==null?void 0:r.connector.metadata.key,o=(y=this.state.value.addingConnection)==null?void 0:y.selectedScopeIds;if(!e||!o)throw new Error("No connector or scope selected");const{url:n}=await this.getLoginUrl(e,this.getUniqueName(e),o);window.location.href=n});_(this,"handleAddTokenConnectionSubmit",async()=>{const e=this.state.value.addingConnection;if(!e)throw new Error("No connection is being added");const o=e.connector.metadata.key,n=this.getUniqueName(o);await this.api.createTokenConnection({projectId:this.projectId,connectionName:n,connectorType:o,tokens:e.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()});_(this,"renameConnection",async()=>{const{editingConnection:e}=this.state.value;if(!e)throw new Error("No connection is being edited");const o=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType,newConnectionName:e.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};N.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:o})});_(this,"showAddConfirmationModal",e=>{this.state.value.addingConnection={selectedScopeIds:e.auth.type==="oauth2"?e.auth.scopes.map(o=>o.key):[],connector:e,tokenValues:{}}});_(this,"handleScopeToggle",(e,o)=>{o?this.state.value.addingConnection.selectedScopeIds.push(e):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(n=>n!==e)});this.projectId=e,this.api=o,this.state=ne({connectors:[],connections:[],addingConnection:null,editingConnection:null})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchInitialState(){await this.fetchConnectors(),await this.refetchConnections()}async refetchConnections(){this.state.value.connections=(await this.api.listConnections(this.projectId)).map(e=>{const o=this.state.value.connectors.find(n=>n.metadata.key===e.connectionType);if(!o)throw new Error(`Unknown connector type: ${e.connectionType}`);return{name:e.name,connectorTitle:o.metadata.label,connectorType:e.connectionType,icon:o.metadata.logoUrl}})}handleEditConnectionClick(e){this.state.value.editingConnection={...e,newName:e.name}}async getLoginUrl(e,o,n){return this.api.getLoginUrl(this.projectId,o,e,n)}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(e){const o=this.state.value.connections.filter(n=>n.connectorType===e).length;return o===0?e:`${e}-${o}`}}const Ge=q({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{}},setup(u){const e=u,o=w(()=>{var r;return((r=e.connector)==null?void 0:r.triggers)&&e.connector.triggers.length>0}),n=w(()=>{var r;return((r=e.connector)==null?void 0:r.actions)&&e.connector.actions.length>0});return(r,y)=>(s(),h(t(J),{class:oe({"connector-card":!0,unavailable:r.unavailable})},{default:i(()=>[l(t(m),{style:{width:"100%"},vertical:"",gap:12},{default:i(()=>[l(t(m),{justify:"space-between"},{default:i(()=>[l(t(W),{src:r.logoUrl,shape:"square",size:"large"},null,8,["src"]),l(t(m),{gap:8},{default:i(()=>[o.value?(s(),h(t(ye),{key:0,size:16})):f("",!0),n.value?(s(),h(t(qe),{key:1,size:16})):f("",!0),r.unavailable?(s(),h(t(ae),{key:2,style:{height:"fit-content"}},{default:i(()=>[p("Talk to us")]),_:1})):f("",!0)]),_:1})]),_:1}),l(t(m),{vertical:""},{default:i(()=>[l(t(b),{strong:""},{default:i(()=>[p(I(r.title),1)]),_:1}),l(t(b),{type:"secondary"},{default:i(()=>[p(I(r.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const Le=R(Ge,[["__scopeId","data-v-f5866f99"]]),Fe=u=>(he("data-v-be4ef1ed"),u=u(),ve(),u),Oe=Fe(()=>k("div",{style:{"flex-grow":"1"}},null,-1)),Re={class:"connectors-grid"},We=q({__name:"ConnectorsView",setup(u){const o=ie().params.projectId,n=new Be(o,new Pe),r=w(()=>{var c;return((c=n.state.value.addingConnection)==null?void 0:c.connector.auth.type)==="oauth2"?n.state.value.addingConnection.connector.auth.scopes:[]}),y=w(()=>{var c;return((c=n.state.value.addingConnection)==null?void 0:c.connector.auth.type)==="tokens"?n.state.value.addingConnection.connector.auth.tokens:[]}),C=w(()=>[...n.state.value.connectors.filter(c=>c.auth.type==="oauth2"),...n.state.value.connectors.filter(c=>c.auth.type==="tokens"),...n.state.value.connectors.filter(c=>c.auth.type==="manual")]);n.fetchInitialState();function x(){var d;switch((d=n.state.value.addingConnection)==null?void 0:d.connector.auth.type){case"oauth2":return"Authorize";case"tokens":return"Create Connection";default:return"OK"}}function Z(){var d;switch((d=n.state.value.addingConnection)==null?void 0:d.connector.auth.type){case"oauth2":return n.handleAddConnectionSubmit();case"tokens":return n.handleAddTokenConnectionSubmit()}}function z(c){var S,T;const d=[];return c.key&&d.push({required:!0,message:`${c.label||c.key} is required`}),(S=c.input)!=null&&S.minSize&&d.push({min:c.input.minSize,message:`Minimum length is ${c.input.minSize}`}),(T=c.input)!=null&&T.maxSize&&d.push({max:c.input.maxSize,message:`Maximum length is ${c.input.maxSize}`}),d}function g(c){c.auth.type==="manual"?me.showNewMessage(pe.translate("i18n_connectors_ask_for_access",null,c.metadata.label)):n.showAddConfirmationModal(c)}return(c,d)=>{var S,T;return s(),v(V,null,[l(t(fe),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:i(()=>[l(t(m),{align:"center",justify:"space-between"},{default:i(()=>[l(t(U),null,{default:i(()=>[p("Connectors")]),_:1})]),_:1}),l(t(D),null,{default:i(()=>[p(" Add and manage external integrations to your project. "),l(Q)]),_:1}),t(n).state.value.connections.length?(s(),h(t(m),{key:0,vertical:""},{default:i(()=>[l(t(U),{level:2},{default:i(()=>[p("Installed")]),_:1}),l(t(m),{vertical:"",gap:10},{default:i(()=>[(s(!0),v(V,null,j(t(n).state.value.connections,a=>(s(),h(t(J),{key:a.name},{default:i(()=>[l(t(m),{align:"center",gap:20},{default:i(()=>[l(t(W),{src:a.icon,height:"40px",shape:"square"},null,8,["src"]),l(t(b),{strong:""},{default:i(()=>[p(I(a.connectorTitle),1)]),_:2},1024),Oe,l(t(b),{content:a.name,copyable:"",code:""},null,8,["content"]),l(t(le),null,{overlay:i(()=>[l(t(se),null,{default:i(()=>[l(t(O),{onClick:H=>t(n).handleEditConnectionClick(a)},{default:i(()=>[p(" Rename ")]),_:2},1032,["onClick"]),l(t(O),{danger:"",onClick:H=>t(n).handleDeletionClick(a)},{default:i(()=>[p(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[l(t(ge))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):f("",!0),l(t(m),{vertical:""},{default:i(()=>[t(n).state.value.connections.length?(s(),h(t(U),{key:0,level:2},{default:i(()=>[p("Available")]),_:1})):f("",!0),k("div",Re,[(s(!0),v(V,null,j(C.value,a=>(s(),h(Le,{key:a.metadata.key,title:a.metadata.label,"logo-url":a.metadata.logoUrl,description:a.metadata.description,unavailable:a.auth.type==="manual",connector:a,onClick:H=>g(a)},null,8,["title","logo-url","description","unavailable","connector","onClick"]))),128))])]),_:1})]),_:1}),l(t(N),{open:!!t(n).state.value.editingConnection,title:`${(S=t(n).state.value.editingConnection)==null?void 0:S.connectorTitle} Connection`,onCancel:d[2]||(d[2]=a=>t(n).state.value.editingConnection=null)},{footer:i(()=>[l(t(m),{justify:"end"},{default:i(()=>[l(X,{disabled:!t(n).hasChanges.value,onClick:d[1]||(d[1]=a=>t(n).renameConnection())},{default:i(()=>[p(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[t(n).state.value.editingConnection?(s(),h(t(E),{key:0,value:t(n).state.value.editingConnection.newName,"onUpdate:value":d[0]||(d[0]=a=>t(n).state.value.editingConnection.newName=a)},null,8,["value"])):f("",!0)]),_:1},8,["open","title"]),l(t(N),{open:!!t(n).state.value.addingConnection,title:`Add ${(T=t(n).state.value.addingConnection)==null?void 0:T.connector.metadata.label} Connection`,"ok-text":x(),"wrap-class-name":"full-modal",onCancel:d[3]||(d[3]=a=>t(n).state.value.addingConnection=null),onOk:Z},{default:i(()=>[t(n).state.value.addingConnection?(s(),v(V,{key:0},[t(n).state.value.addingConnection.connector.auth.type==="oauth2"?(s(),v(V,{key:0},[l(t(D),null,{default:i(()=>[p(" Please select the scopes you want to authorize for this connection. You can change these later by deleting and re-adding the connection. ")]),_:1}),l(t(m),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:i(()=>[(s(!0),v(V,null,j(r.value,a=>(s(),h(t(m),{key:a.key,justify:"space-between",align:"center"},{default:i(()=>[l(t(m),{vertical:""},{default:i(()=>[l(t(b),null,{default:i(()=>[p(I(a.description),1)]),_:2},1024),l(t(b),{type:"secondary"},{default:i(()=>[p(I(a.key),1)]),_:2},1024)]),_:2},1024),l(t(ce),{checked:t(n).state.value.addingConnection.selectedScopeIds.includes(a.key),onChange:H=>t(n).handleScopeToggle(a.key,H)},null,8,["checked","onChange"])]),_:2},1024))),128))]),_:1})],64)):f("",!0),t(n).state.value.addingConnection.connector.auth.type==="tokens"?(s(),v(V,{key:1},[l(t(D),null,{default:i(()=>[p(" Please provide the required tokens/credentials for this connection. ")]),_:1}),l(t(re),{model:t(n).state.value.addingConnection.tokenValues,layout:"vertical"},{default:i(()=>[(s(!0),v(V,null,j(y.value,a=>(s(),h(t(de),{key:a.key,label:a.label,name:a.key,rules:z(a)},{default:i(()=>{var H,P,B,G,L,F;return[((H=a.input)==null?void 0:H.type)==="small-string"?(s(),h(t(E),{key:0,value:t(n).state.value.addingConnection.tokenValues[a.key],"onUpdate:value":$=>t(n).state.value.addingConnection.tokenValues[a.key]=$,placeholder:a.description,maxlength:(P=a.input)==null?void 0:P.maxSize,minlength:(B=a.input)==null?void 0:B.minSize,type:"password"},null,8,["value","onUpdate:value","placeholder","maxlength","minlength"])):((G=a.input)==null?void 0:G.type)==="large-text"?(s(),h(t(ue),{key:1,value:t(n).state.value.addingConnection.tokenValues[a.key],"onUpdate:value":$=>t(n).state.value.addingConnection.tokenValues[a.key]=$,placeholder:a.description,maxlength:(L=a.input)==null?void 0:L.maxSize,minlength:(F=a.input)==null?void 0:F.minSize,rows:4},null,8,["value","onUpdate:value","placeholder","maxlength","minlength"])):(s(),h(t(E),{key:2,value:t(n).state.value.addingConnection.tokenValues[a.key],"onUpdate:value":$=>t(n).state.value.addingConnection.tokenValues[a.key]=$,placeholder:a.description,type:"password"},null,8,["value","onUpdate:value","placeholder"])),a.description?(s(),h(t(b),{key:3,type:"secondary",style:{"font-size":"12px"}},{default:i(()=>[p(I(a.description),1)]),_:2},1024)):f("",!0)]}),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"])],64)):f("",!0)],64)):f("",!0)]),_:1},8,["open","title","ok-text"])],64)}}});const st=R(We,[["__scopeId","data-v-be4ef1ed"]]);export{st as default};
//# sourceMappingURL=ConnectorsView.ecb4f6b0.js.map

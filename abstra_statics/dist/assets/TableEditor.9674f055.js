import{a as U}from"./asyncComputed.c09cd499.js";import{d as N,H as q,b as t,c as n,x as e,W as f,Z as x,G as B,e as p,z as d,I as g,F as h,L as k,t as I,D as T,X as G,N as $,a3 as H,U as A,O as J,Q,q as W,r as R,ad as D,w as C,J as X}from"./registerWidgets.6b985ae3.js";import{T as K}from"./tables.6e5b192d.js";import{L}from"./CircularLoading.77724a89.js";import{T as Z,a as E}from"./Tab.c1b492be.js";import{B as P}from"./BackButton.d4902235.js";import{j as M,E as Y,t as j,D as ee,g as te,i as ae}from"./icons.d11f56c4.js";import{D as le}from"./DocsButton.0195f6db.js";import"./activeRecord.2d62b323.js";import"./pubsub.f8c17d6a.js";import"./lottie.7867235e.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[s]="0482fade-ae45-479f-9d53-c91a616c4505",a._sentryDebugIdIdentifier="sentry-dbid-0482fade-ae45-479f-9d53-c91a616c4505")}catch{}})();const S=a=>(J("data-v-5812aa88"),a=a(),Q(),a),ne={class:"table-settings"},se=S(()=>e("label",null,"Name",-1)),oe={class:"table-field"},ue={class:"columns"},de=S(()=>e("label",null,"Columns",-1)),ie=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],pe=["onUpdate:modelValue","disabled"],be=S(()=>e("label",null,"Not null",-1)),me=["onClick"],_e=["onClick"],ve=N({__name:"TableSettings",props:{table:null},setup(a){var o;const s=a,{result:m}=U(()=>K.dbTypes()),w=q();(o=s.table)==null||o.onUpdate(()=>{w.replace({name:"tableEditor",params:{tableName:s.table.name}})});function _(b){confirm(`Are you sure you want to delete column "${b.name}"?`)&&b.delete()}return(b,c)=>(t(),n("div",ne,[se,e("div",oe,[f(e("input",{"onUpdate:modelValue":c[0]||(c[0]=l=>a.table.name=l),class:"table-name"},null,512),[[x,a.table.name]]),e("button",{class:B(["button","save",{disabled:!a.table.hasChanges()}]),onClick:c[1]||(c[1]=l=>a.table.save())},[p(g,{path:d(M)},null,8,["path"])],2)]),e("div",ue,[de,(t(!0),n(h,null,k(a.table.columns,l=>(t(),n("div",{key:l.id,class:"column"},[l.primaryKey?(t(),I(g,{key:0,class:"column-primary-key",path:d(Y)},null,8,["path"])):T("",!0),d(m)?f((t(),n("select",{key:1,"onUpdate:modelValue":i=>l.type=i,class:"column-type"},[(t(!0),n(h,null,k(d(m),i=>(t(),n("option",{key:i.type},$(i.type),1))),128))],8,ie)),[[G,l.type]]):T("",!0),f(e("input",{"onUpdate:modelValue":i=>l.name=i,class:"column-name",placeholder:"Column name"},null,8,re),[[x,l.name]]),f(e("input",{"onUpdate:modelValue":i=>l.default=i,class:"column-default",placeholder:"Default value"},null,8,ce),[[x,l.default]]),f(e("input",{"onUpdate:modelValue":i=>l.notNull=i,type:"checkbox",disabled:!l.default},null,8,pe),[[H,l.notNull]]),be,l.primaryKey?T("",!0):(t(),n("button",{key:2,class:"button delete",onClick:i=>_(l)},[p(g,{path:d(j)},null,8,["path"])],8,me)),e("button",{class:B(["button","save",{disabled:!l.hasChanges()}]),onClick:i=>l.save()},[p(g,{path:d(M)},null,8,["path"])],10,_e)]))),128)),e("button",{class:"button add",onClick:c[2]||(c[2]=l=>a.table.createColumn())},[p(g,{path:d(ee)},null,8,["path"]),A(" Add Column ")])])]))}});const ye=W(ve,[["__scopeId","data-v-5812aa88"]]),fe={class:"table-data"},he={class:"column-header"},ke={class:"column-name"},we=e("th",null,null,-1),ge={key:1},Ce=["open"],$e={key:0,class:"editing-row-content"},Te={class:"editing-row-header"},Ve=["onUpdate:modelValue"],xe={key:0,class:"row-error"},Ie=N({__name:"TableData",props:{table:null},setup(a){const s=a,{result:m,loading:w,refetch:_}=U(()=>s.table.select()),o=R(null),b=R(null),c=R(null);function l(){!s.table||(o.value={},c.value=null,b.value=null)}function i(r){return Object.keys(r).reduce((V,u)=>{var v;return(v=s.table.columns.find(y=>y.name===u))!=null&&v.primaryKey?{[u]:r[u]}:V},{})}async function z(){if(!(!s.table||!o.value))if(c.value){const r=await s.table.updateRow(i(c.value),o.value);r.type==="update-row:error"?b.value=r.reason:(o.value=null,c.value=null,b.value=null,_())}else{const r=await s.table.insertRow(o.value);r.type==="insert-row:error"?b.value=r.reason:(o.value=null,c.value=null,b.value=null,_())}}function F(r){!s.table||(o.value={...r},c.value={...r},b.value=null)}async function O(r){confirm("Are you sure you want to delete this row?")&&(await s.table.deleteRow(i(r)),_())}return(r,V)=>(t(),n("div",fe,[e("button",{class:"add-row",onClick:l},"Add Row"),e("table",null,[e("thead",null,[e("tr",null,[(t(!0),n(h,null,k(a.table.columns,u=>(t(),n("th",{key:u.id},[e("div",he,[e("div",ke,$(u.name),1)])]))),128)),we])]),d(w)?(t(),I(L,{key:0})):(t(),n("tbody",ge,[(t(!0),n(h,null,k(d(m),(u,v)=>(t(),n("tr",{key:v},[(t(!0),n(h,null,k(a.table.columns,y=>(t(),n("td",{key:y.id},$(u[y.name]),1))),128)),e("td",null,[p(D,{class:"delete-row",path:d(j),onClick:y=>O(u)},null,8,["path","onClick"]),p(D,{class:"edit-row",path:d(te),onClick:y=>F(u)},null,8,["path","onClick"])])]))),128))]))]),e("dialog",{class:"editing-row-container",open:!!o.value},[o.value?(t(),n("div",$e,[e("div",Te,[A(" New Row "),p(D,{path:d(ae),class:"close",onClick:V[0]||(V[0]=u=>o.value=null)},null,8,["path"])]),(t(!0),n(h,null,k(a.table.columns,u=>(t(),n("div",{key:u.id,class:"column"},[e("label",null,$(u.name),1),f(e("input",{"onUpdate:modelValue":v=>o.value[u.name]=v,type:"text"},null,8,Ve),[[x,o.value[u.name]]])]))),128)),e("button",{class:"button save",onClick:z},"Save"),b.value?(t(),n("div",xe,$(b.value),1)):T("",!0)])):T("",!0)],8,Ce)]))}});const je=N({__name:"TableEditor",setup(a){const s=X(),{result:m,loading:w}=U(()=>K.get(s.params.tableName));return(_,o)=>d(w)||!d(m)?(t(),I(L,{key:0})):(t(),I(Z,{key:1,class:"editor"},{left:C(()=>[p(P,{link:"/_editor/tables"})]),right:C(()=>[p(le,{path:"tables"})]),default:C(()=>[p(E,{title:"Table data"},{default:C(()=>[p(Ie,{table:d(m)},null,8,["table"])]),_:1}),p(E,{title:"Settings"},{default:C(()=>[p(ye,{table:d(m)},null,8,["table"])]),_:1})]),_:1}))}});export{je as default};
//# sourceMappingURL=TableEditor.9674f055.js.map

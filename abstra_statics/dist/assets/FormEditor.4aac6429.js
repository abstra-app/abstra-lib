import{F as ce,r as ee,R as pe}from"./FormRunner.becdc600.js";import{f as t,eG as me,d as U,r as R,H as A,b as c,c as g,w as r,ar as p,eD as fe,u as e,bV as C,cB as Q,ev as I,eC as ve,cF as ge,bO as k,a$ as te,G as ye,S as Y,J as ae,eA as re,a as he,ex as P,bv as be,eE as _e,eF as ke,e as z,v as we,bP as J,eB as Se,eK as Pe}from"./outputWidgets.6e85bcee.js";import{R as xe,S as Ae,a as Re,L as Ce}from"./SourceCode.d6c82270.js";import{B as Fe}from"./BaseLayout.30635c8f.js";import{a as oe}from"./asyncComputed.3f33381d.js";import{F as Le}from"./forms.d75f72df.js";import{W as le}from"./workspaces.d67cb646.js";import{l as K,N as Te}from"./NavbarControls.48f3ba66.js";import{r as $e,d as Be,p as De}from"./icons.a9b6e7be.js";import{a as Ie}from"./Base.3f7d4919.js";import{A as _}from"./FormItem.292de928.js";import{A as T}from"./index.fb7f959e.js";import{M as Oe}from"./Modal.23898cb6.js";import{A as Ue}from"./Link.aca2039b.js";import{A as Ee}from"./index.20b9f0da.js";import{F as ne}from"./Form.6e39a739.js";import{A as O}from"./Title.ad44d345.js";import{_ as Me}from"./SaveButton.vue_vue_type_script_setup_true_lang.18d453c0.js";import{A as X,T as qe}from"./TabPane.6607fa75.js";import"./Card.d7f8a52a.js";import{c as Ne}from"./index.e0a134eb.js";import{A as Qe}from"./index.e881f095.js";import{E as je}from"./ExpandOutlined.bb4f1721.js";import"./api.7b3f271b.js";import"./runnerData.20d5af3d.js";import"./url.90e87206.js";import"./index.01731d2b.js";import"./pubsub.629d594a.js";import"./Passwordless.9390b38b.js";import"./CircularLoading.900d6799.js";import"./PlayerNavbar.df08247a.js";import"./ActionButton.a5651a00.js";import"./WidgetsFrame.12ef9875.js";import"./index.64cbd231.js";import"./Paragraph.c6943545.js";import"./Text.e6eada3a.js";import"./uuid.36637945.js";import"./jobs.8d75109b.js";import"./record.2ea7bf27.js";import"./scripts.a973cc04.js";import"./validations.7f54b601.js";import"./string.c9fd9f43.js";import"./toggleHighContrast.7d0f3fca.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.5f1ba444.js";import"./popupNotifcation.4a8c2941.js";import"./hasIn.dcca7708.js";import"./ant-design.1935e552.js";import"./index.26532c1a.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new Error().stack;u&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[u]="ab326807-2365-4809-a5f5-a848e8f7c9e1",i._sentryDebugIdIdentifier="sentry-dbid-ab326807-2365-4809-a5f5-a848e8f7c9e1")}catch{}})();var Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const ze=Ve;function Z(i){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?Object(arguments[u]):{},n=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),n.forEach(function(o){He(i,o,a[o])})}return i}function He(i,u,a){return u in i?Object.defineProperty(i,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[u]=a,i}var H=function(u,a){var n=Z({},u,a.attrs);return t(me,Z({},n,{icon:ze}),null)};H.displayName="LinkOutlined";H.inheritAttrs=!1;const Ge=H,We=U({__name:"LaunchButton",props:{path:{}},setup(i){const u=i,a=R({state:"loading"}),n=A(()=>a.value.state!=="found"),o=A(()=>a.value.state==="loading"),s=A(()=>a.value.state==="found"?a.value.url:void 0),d=A(()=>{switch(a.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${a.value}`)}}),$=A(()=>{switch(a.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${a.value}`)}});async function B(b){const y=`https://${b}.abstra.app/_version`;return(await fetch(y)).ok}async function m(b){const y=`https://${b}.abstra.app/_pages/${u.path}`;return(await fetch(y)).ok}async function D(){if(!(await K.get()).logged){a.value={state:"not-logged"};return}const y=await K.getProjectInfo().catch(()=>null);if(!y){a.value={state:"error"};return}if(!await B(y.subdomain).catch(()=>null)){a.value={state:"not-deployed"};return}if(!await m(y.subdomain).catch(()=>null)){a.value={state:"not-found"};return}const f=`https://${y.subdomain}.abstra.app/${u.path}`;a.value={state:"found",url:f}}return D(),(b,y)=>(c(),g(e(Q),{title:d.value},{content:r(()=>[p(fe($.value),1)]),default:r(()=>[t(e(C),{href:s.value,target:"_blank",disabled:n.value,loading:o.value,size:"small",type:"link"},{icon:r(()=>[t(e(Ge))]),default:r(()=>[p(" Open Deployed ")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Ye="abstra-run-id",Je=U({__name:"QueryParamsModal",props:{open:{type:Boolean},close:{type:Function},state:{},addQueryParam:{type:Function},removeQueryParam:{type:Function}},setup(i){return(u,a)=>(c(),g(e(Oe),{open:u.open,onCancel:u.close},{footer:r(()=>[t(e(C),{type:"primary",onClick:u.close},{default:r(()=>[p("OK")]),_:1},8,["onClick"])]),default:r(()=>[t(e(T),{vertical:"",gap:"20"},{default:r(()=>[t(e(Ie),null,{default:r(()=>[p("Query params")]),_:1}),(c(!0),I(te,null,ve(u.state.queryParams,(n,o)=>(c(),g(e(_),{key:o},{default:r(()=>[t(e(ge),null,{default:r(()=>[t(e(k),{value:n.name,"onUpdate:value":s=>n.name=s,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(k),{value:n.value,"onUpdate:value":s=>n.value=s,type:"text",placeholder:"value",disabled:n.name===Ye},null,8,["value","onUpdate:value","disabled"]),t(e(C),{danger:"",onClick:s=>u.removeQueryParam(o)},{default:r(()=>[p("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(_),null,{default:r(()=>[t(e(C),{type:"dashed",style:{width:"100%"},onClick:u.addQueryParam},{default:r(()=>[p(" Add Query Param ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["open","onCancel"]))}}),Ke=i=>(_e("data-v-ba31712e"),i=i(),ke(),i),Xe={key:0},Ze={key:1},et=Ke(()=>z("br",null,null,-1)),tt={key:2,class:"form-preview-container"},V="abstra-run-id",at=U({__name:"FormTester",props:{form:{},logService:{},broker:{},disabled:{type:Boolean}},emits:["redirect","exit"],setup(i,{expose:u,emit:a}){var G;const n=i,o=()=>{a("exit")},s=R(!1),d=()=>{s.value=!0},$=()=>{s.value=!1},B=A(()=>`/${n.form.path}?${de.value.query}`),m=ye({queryParams:[{name:"foo",value:"bar"}],url:`${n.form.path}`,stageRunId:null}),D=l=>{m.stageRunId=l},b=R((G=Y.get("dontShowRestartHelper"))!=null?G:!1),y=()=>{Y.set("dontShowRestartHelper",!0),b.value=!0},{result:F,loading:E}=oe(()=>le.get()),f=()=>{m.queryParams.push({name:"",value:""})},x=l=>{m.queryParams=m.queryParams.filter((L,v)=>v!==l)};ae([()=>m.stageRunId,()=>m.queryParams],([l,L])=>{const v=L.find(h=>h.name===V);if(l&&!v){m.queryParams.push({name:V,value:l});return}if(!l&&v){m.queryParams=m.queryParams.filter(h=>h.name!==V);return}l&&v&&l!==v.value&&(v.value=l)}),n.broker.on("stdout",l=>{n.logService.log({type:"stdout",log:l.log})}),n.broker.on("stderr",l=>{n.logService.log({type:"stderr",log:l.log})}),n.broker.onClose(()=>{n.logService.log({type:"stderr",log:"Program closed"})}),n.broker.on("files:changed",()=>{n.logService.log({type:"files-changed",log:"Files changed"})});const w=re(),M=({path:l})=>{ee("editor",w,l)};function se(l,L){a("redirect",l,L)}const S=R(null);async function j(){var l;return n.logService.log({type:"restart"}),(l=S.value)==null?void 0:l.run()}async function ue(){var l;return(l=S.value)==null?void 0:l.run()}async function ie(){var l;return n.logService.log({type:"restart"}),(l=S.value)==null?void 0:l.exit()}const de=A(()=>{const l=new URLSearchParams(m.queryParams.filter(v=>v.name.trim()).reduce((v,h)=>({...v,[h.name]:h.value}),{})).toString();return{subdomain:"[your-subdomain]",path:n.form.path,query:l}});return u({restart:j,runner:S}),(l,L)=>{const v=he("icon");return c(),I(te,null,[t(e(ne),{layout:"vertical"},{default:r(()=>[P("",!0),t(e(T),{gap:"small"},{default:r(()=>{var h,q,N,W;return[((h=S.value)==null?void 0:h.formState)==="over"||((q=S.value)==null?void 0:q.formState)==="error"?(c(),g(e(Q),{key:0,placement:"bottom",visible:b.value?void 0:!0},{content:r(()=>[b.value?(c(),I("span",Xe,"Restart form")):(c(),I("span",Ze,[p(" You can restart the form here"),et,t(e(Ue),{onClick:y},{default:r(()=>[p("Don't show this again")]),_:1})]))]),default:r(()=>[t(e(C),{disabled:l.disabled,onClick:j},{default:r(()=>[t(v,{path:e($e),width:"20"},null,8,["path"])]),_:1},8,["disabled"])]),_:1},8,["visible"])):P("",!0),((N=S.value)==null?void 0:N.formState)==="running"?(c(),g(e(Q),{key:1,placement:"bottom"},{content:r(()=>[p("Stop form")]),default:r(()=>[t(e(C),{onClick:ie},{default:r(()=>[t(v,{path:e(Be),width:"20"},null,8,["path"])]),_:1})]),_:1})):P("",!0),((W=S.value)==null?void 0:W.formState)==="idle"?(c(),g(e(Q),{key:2,placement:"bottom"},{content:r(()=>[p("Start form")]),default:r(()=>[t(e(C),{disabled:l.disabled,onClick:ue},{default:r(()=>[t(v,{path:e(De),width:"20"},null,8,["path"])]),_:1},8,["disabled"])]),_:1})):P("",!0),t(e(k),{value:B.value,onClick:d},null,8,["value"])]}),_:1}),e(E)||!e(F)?(c(),g(e(be),{key:1})):m.stageRunId||n.form.isInitial?(c(),I("div",tt,[t(ce,{ref_key:"runner",ref:S,form:l.form.makeRunnerData(e(F)),params:{...m.queryParams.reduce((h,{name:q,value:N})=>({...h,[q]:N}),{})},"is-preview":"","enable-auto-focus":"",broker:l.broker,disabled:l.disabled,onNavigate:M,onRedirect:se,onLogout:j,onExit:o},null,8,["form","params","broker","disabled"])])):(c(),g(e(Ee),{key:3,message:"This form is an intermediate task within the workflow. Please select a thread to initiate the form.",type:"warning","show-icon":""}))]),_:1}),t(Je,{open:s.value,close:$,state:m,"add-query-param":f,"remove-query-param":x},null,8,["open","state"])],64)}}});const rt=we(at,[["__scopeId","data-v-ba31712e"]]),ot=U({__name:"FormSettings",props:{form:{}},setup(i){const a=R(i.form);return(n,o)=>(c(),g(e(ne),{layout:"vertical"},{default:r(()=>[t(xe,{runtime:a.value},null,8,["runtime"]),t(e(_),{label:"Form name"},{default:r(()=>[t(e(k),{value:a.value.title,"onUpdate:value":o[0]||(o[0]=s=>a.value.title=s),type:"text",onChange:o[1]||(o[1]=s=>{var d;return a.value.title=(d=s.target.value)!=null?d:""})},null,8,["value"])]),_:1}),t(e(O),{level:3},{default:r(()=>[p(" Texts ")]),_:1}),t(e(O),{level:4},{default:r(()=>[p(" Welcome Screen ")]),_:1}),t(e(_),{label:"Title"},{default:r(()=>[t(e(k),{value:a.value.welcomeTitle,"onUpdate:value":o[2]||(o[2]=s=>a.value.welcomeTitle=s),type:"text",placeholder:a.value.title,disabled:a.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),t(e(_),{label:"Description"},{default:r(()=>[t(e(k),{value:a.value.startMessage,"onUpdate:value":o[3]||(o[3]=s=>a.value.startMessage=s),type:"text",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(_),{label:"Start button label"},{default:r(()=>[t(e(k),{value:a.value.startButtonText,"onUpdate:value":o[4]||(o[4]=s=>a.value.startButtonText=s),type:"text",placeholder:"Start",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(_),null,{default:r(()=>[t(e(J),{checked:a.value.autoStart,"onUpdate:checked":o[5]||(o[5]=s=>a.value.autoStart=s)},{default:r(()=>[p("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),t(e(O),{level:4},{default:r(()=>[p(" End Screen ")]),_:1}),t(e(_),{label:"End text"},{default:r(()=>[t(e(k),{value:a.value.endMessage,"onUpdate:value":o[6]||(o[6]=s=>a.value.endMessage=s),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),t(e(_),{label:"Restart button label"},{default:r(()=>[t(e(k),{value:a.value.restartButtonText,"onUpdate:value":o[7]||(o[7]=s=>a.value.restartButtonText=s),placeholder:"Restart",type:"text",disabled:!a.value.allowRestart},null,8,["value","disabled"])]),_:1}),t(e(_),null,{default:r(()=>[t(e(J),{checked:a.value.allowRestart,"onUpdate:checked":o[8]||(o[8]=s=>a.value.allowRestart=s)},{default:r(()=>[p("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),t(e(O),{level:4},{default:r(()=>[p(" Alert Messages ")]),_:1}),t(e(_),{label:"Error message"},{default:r(()=>[t(e(k),{value:a.value.errorMessage,"onUpdate:value":o[9]||(o[9]=s=>a.value.errorMessage=s),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),lt={style:{width:"50%"}},nt={style:{width:"50%"}},ta=U({__name:"FormEditor",setup(i){const u=re(),a=Se(),n=R(null),o=R("source-code");function s(){u.push({name:"home"})}const{result:d,refetch:$}=oe(()=>Promise.all([le.get(),Le.get(a.params.id)]).then(([f,x])=>Pe({workspace:f,form:x}))),B=f=>{!d.value||(d.value.form.file=f)},m=Ce.create(),D=A(()=>pe.create(a.params.id));function b(f,x){ee("editor",u,f,x)}const y=R(null),F=()=>{var f;(f=y.value)==null||f.restartEditor()},E=()=>{var f;u.push({name:"formPreview",query:a.query,params:{id:(f=d.value)==null?void 0:f.form.id}})};return ae(()=>a.params.id,()=>{$()}),(f,x)=>(c(),g(Fe,null,{navbar:r(()=>[e(d)?(c(),g(e(Ne),{key:0,title:e(d).form.title,style:{padding:"5px 25px"},onBack:s},{extra:r(()=>[t(Te,{"docs-path":"forms/overview","show-v-s-code-button":"","show-save-button":!1,"editing-model":e(d).form},null,8,["editing-model"])]),_:1},8,["title"])):P("",!0)]),content:r(()=>[e(d)?(c(),g(e(T),{key:0,gap:"40",style:{width:"calc(100% - 80px)"}},{default:r(()=>[z("div",lt,[t(e(qe),{"active-key":o.value,"onUpdate:activeKey":x[0]||(x[0]=w=>o.value=w)},{rightExtra:r(()=>[t(Me,{model:e(d).form},null,8,["model"])]),default:r(()=>[t(e(X),{key:"source-code",tab:"Source code"}),t(e(X),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"]),o.value==="source-code"?(c(),g(Ae,{key:0,ref_key:"code",ref:y,script:e(d).form,workspace:e(d).workspace,broker:D.value,onUpdateFile:B},null,8,["script","workspace","broker"])):P("",!0),o.value==="settings"?(c(),g(ot,{key:1,form:e(d).form},null,8,["form"])):P("",!0)]),z("div",nt,[t(e(T),{justify:"space-between"},{default:r(()=>[t(e(T),{align:"center",gap:"large",style:{margin:"10px 0 24px 0"}},{default:r(()=>{var w,M;return[t(e(O),{level:4,style:{margin:"0"}},{default:r(()=>[p("Form preview")]),_:1}),((M=(w=n.value)==null?void 0:w.runner)==null?void 0:M.formState)==="running"?(c(),g(e(Qe),{key:0,color:"green"},{default:r(()=>[p(" Running ")]),_:1})):P("",!0)]}),_:1}),t(e(T),{gap:"8",align:"center",style:{height:"fit-content","margin-top":"10px"}},{default:r(()=>[t(We,{path:e(d).form.path},null,8,["path"]),t(e(C),{target:"_blank",onClick:E},{icon:r(()=>[t(e(je))]),default:r(()=>[p(" Preview ")]),_:1})]),_:1})]),_:1}),t(rt,{ref_key:"tester",ref:n,form:e(d).form,"log-service":e(m),broker:D.value,disabled:e(d).form.hasChanges("code_content"),onRedirect:b,onExit:F},null,8,["form","log-service","broker","disabled"])])]),_:1})):P("",!0)]),footer:r(()=>{var w;return[t(Re,{runtime:"forms","log-service":e(m),onRestart:(w=n.value)==null?void 0:w.restart},null,8,["log-service","onRestart"])]}),_:1}))}});export{ta as default};
//# sourceMappingURL=FormEditor.4aac6429.js.map

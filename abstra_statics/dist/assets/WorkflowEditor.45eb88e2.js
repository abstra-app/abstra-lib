var et=Object.defineProperty;var tt=(t,e,s)=>e in t?et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var ce=(t,e,s)=>(tt(t,typeof e!="symbol"?e+"":e,s),s);import{g as at,W as ot,w as st}from"./controller.9c067ab9.js";import{a as Ce}from"./asyncComputed.b31540a4.js";import{d as L,D as W,f as M,o as n,Y as m,$ as F,S as I,ed as he,a as A,e as B,b as p,w as r,u as a,aS as R,e9 as ue,c as b,dh as J,dc as oe,aG as N,ea as Z,da as je,ey as Y,cO as nt,bT as Ie,a0 as se,g as me,bB as _e,aW as Ze,ei as Me,Z as Q,X as De,ah as xe,bL as ge,cz as ve,cy as Ue,cL as lt,ev as it,O as ie,ep as Oe,bz as rt,bx as He,bR as dt,aB as be,eF as ut,d9 as ct,eD as pt,eE as gt,em as ft,en as vt,eo as yt}from"./index.82b3148c.js";import{u as G,P as ht,_ as mt,a as kt,b as wt,g as Re,c as pe,N as _t,d as bt,M as $t,e as Ct}from"./vue-flow-core.63b4f0fe.js";import"./linters.38c38cf1.js";import{W as fe}from"./workspaces.114e35d6.js";import{d as At}from"./workspaceStore.d9227179.js";import{U as St,G as It}from"./UnsavedChangesHandler.d162f298.js";import{w as ye,s as Mt}from"./metadata.79e5a077.js";import{A as Ae}from"./index.4f532519.js";import{A as Dt}from"./index.f441bd75.js";import{_ as xt,a as Et}from"./vue-flow-minimap.83f2e1b8.js";import{G as zt}from"./PhArrowCounterClockwise.vue.003e83ba.js";import{T as Bt}from"./TasksManager.6575570b.js";import{a as Vt,b as Pt,n as Tt}from"./validations.7e1d00d3.js";import{u as Lt}from"./editor.5a271fd3.js";import{A as Ht}from"./index.1adb88d7.js";import{t as Ke}from"./index.d5ff2b7b.js";import{B as Ft}from"./Badge.8b0acfd8.js";import{G as Fe}from"./PhArrowDown.vue.756f62dd.js";import"./uuid.e4fb3756.js";import"./record.cb9a902e.js";import"./colorHelpers.d4cbfb24.js";import"./url.3209a6f7.js";import"./ExclamationCircleOutlined.280af49b.js";import"./PhRobot.vue.6eecdc74.js";import"./PhWebhooksLogo.vue.359fbd65.js";import"./tasksController.de8badda.js";import"./gateway.8733a5f3.js";import"./popupNotifcation.e1bf1f8c.js";import"./scripts.10d6bd7a.js";import"./polling.e4e328fc.js";import"./string.ab0c206a.js";import"./ant-design.9b251c5e.js";import"./PhArrowSquareOut.vue.1aeb60d7.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.36fca7f4.js";import"./Card.cef79d50.js";import"./TabPane.3a7649ae.js";import"./CollapsePanel.fa92e55e.js";import"./index.8fbc4239.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="6529e8fb-0701-475f-8aad-3edfc44962a1",t._sentryDebugIdIdentifier="sentry-dbid-6529e8fb-0701-475f-8aad-3edfc44962a1")}catch{}})();const Nt=["width","height","fill","transform"],jt={key:0},Zt=A("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Ut=[Zt],Ot={key:1},Rt=A("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Kt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Xt=[Rt,Kt],Yt={key:2},Wt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),Gt=[Wt],qt={key:3},Jt=A("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),Qt=[Jt],ea={key:4},ta=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),aa=[ta],oa={key:5},sa=A("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),na=[sa],la={name:"PhArrowClockwise"},ia=L({...la,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,s=W("weight","regular"),o=W("size","1em"),l=W("color","currentColor"),v=W("mirrored",!1),d=M(()=>{var g;return(g=e.weight)!=null?g:s}),h=M(()=>{var g;return(g=e.size)!=null?g:o}),w=M(()=>{var g;return(g=e.color)!=null?g:l}),u=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:v?"scale(-1, 1)":void 0);return(g,f)=>(n(),m("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:w.value,transform:u.value},g.$attrs),[F(g.$slots,"default"),d.value==="bold"?(n(),m("g",jt,Ut)):d.value==="duotone"?(n(),m("g",Ot,Xt)):d.value==="fill"?(n(),m("g",Yt,Gt)):d.value==="light"?(n(),m("g",qt,Qt)):d.value==="regular"?(n(),m("g",ea,aa)):d.value==="thin"?(n(),m("g",oa,na)):I("",!0)],16,Nt))}}),ra=["width","height","fill","transform"],da={key:0},ua=A("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),ca=[ua],pa={key:1},ga=A("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),fa=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),va=[ga,fa],ya={key:2},ha=A("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),ma=[ha],ka={key:3},wa=A("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),_a=[wa],ba={key:4},$a=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ca=[$a],Aa={key:5},Sa=A("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Ia=[Sa],Ma={name:"PhFunnel"},Da=L({...Ma,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,s=W("weight","regular"),o=W("size","1em"),l=W("color","currentColor"),v=W("mirrored",!1),d=M(()=>{var g;return(g=e.weight)!=null?g:s}),h=M(()=>{var g;return(g=e.size)!=null?g:o}),w=M(()=>{var g;return(g=e.color)!=null?g:l}),u=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:v?"scale(-1, 1)":void 0);return(g,f)=>(n(),m("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:w.value,transform:u.value},g.$attrs),[F(g.$slots,"default"),d.value==="bold"?(n(),m("g",da,ca)):d.value==="duotone"?(n(),m("g",pa,va)):d.value==="fill"?(n(),m("g",ya,ma)):d.value==="light"?(n(),m("g",ka,_a)):d.value==="regular"?(n(),m("g",ba,Ca)):d.value==="thin"?(n(),m("g",Aa,Ia)):I("",!0)],16,ra))}});class Ee{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const ae=t=>Ee.isMac?t.metaKey:t.ctrlKey,xa=t=>t.altKey,Xe=t=>t.shiftKey,$e={alt:xa,"arrow-up":t=>t.code==="ArrowUp","arrow-down":t=>t.code==="ArrowDown","arrow-left":t=>t.code==="ArrowLeft","arrow-right":t=>t.code==="ArrowRight",ctrl:ae,delete:t=>Ee.isMac?t.code==="Backspace":t.code==="Delete",enter:t=>t.code==="Enter",escape:t=>t.code==="Escape",shift:Xe,space:t=>t.code==="Space",a:t=>t.code==="KeyA",b:t=>t.code==="KeyB",c:t=>t.code==="KeyC",d:t=>t.code==="KeyD",f:t=>t.code==="KeyF",g:t=>t.code==="KeyG",h:t=>t.code==="KeyH",k:t=>t.code==="KeyK",p:t=>t.code==="KeyP",v:t=>t.code==="KeyV",x:t=>t.code==="KeyX",z:t=>t.code==="KeyZ",0:t=>t.code==="Digit0","[":t=>t.code==="BracketLeft","]":t=>t.code==="BracketRight"};class Ea{constructor(e){ce(this,"pressedKeys");ce(this,"evt");this.evt=e,this.pressedKeys={};const s=o=>l=>{Object.keys($e).forEach(v=>{$e[v](l)&&this.setPressed(v,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(e,s){this.pressedKeys[e]=s}isPressed(e){var s;return this.evt?$e[e](this.evt):(s=this.pressedKeys[e])!=null?s:!1}}new Ea;class za{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const Ne=new za;class ke{constructor(e){this.dto=e}static async listConnections(){return(await Ne.listConnections()).map(s=>new ke(s))}static async getIsUsageMode(){return await Ne.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const Ye=At("agents-usage-mode",()=>{const t=B(!1);return(async()=>{t.value=await ke.getIsUsageMode()})(),{agentUsageMode:t}}),Ba=["onDragstart"],Va={style:{display:"flex","flex-direction":"column","max-width":"250px"}},Pa=L({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){const s=Ye(),o=M(()=>s.agentUsageMode?ye.stages:ye.stages.filter(l=>!["agents","clients"].includes(l.typeName)));return(l,v)=>(n(),m(R,null,[p(a(J),{class:"toolbar",align:"center"},{default:r(()=>[(n(!0),m(R,null,ue(o.value,d=>(n(),b(a(nt),{key:d.key,placement:"top"},{title:r(()=>[p(a(J),{gap:"small"},{default:r(()=>[p(a(oe),null,{default:r(()=>[N(Z(d.title),1)]),_:2},1024),p(a(oe),{keyboard:""},{default:r(()=>[N(Z(d.key),1)]),_:2},1024)]),_:2},1024)]),content:r(()=>[A("div",Va,[p(a(oe),null,{default:r(()=>[N(Z(d.description),1)]),_:2},1024),d.beta?(n(),b(a(Ae),{key:0,type:"warning",class:"beta-alert"},{description:r(()=>[p(a(oe),null,{default:r(()=>[N(" This is a beta feature, "),p(a(je),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:r(()=>[N(" click here ")]),_:1}),N(" to learn more about it ")]),_:1})]),_:1})):I("",!0)])]),default:r(()=>[A("div",{draggable:!0,class:"toolbar__item",onDragstart:h=>e("drag-start",h.dataTransfer,d.typeName)},[(n(),b(Y(d.icon),{size:18}))],40,Ba)]),_:2},1024))),128)),p(a(Dt),{type:"vertical"}),p(a(Ie),{disabled:!l.controller.hasChanges(),onClick:v[0]||(v[0]=d=>l.controller.save())},{default:r(()=>[p(a(J),{align:"center",gap:"small"},{default:r(()=>[p(a(It),{size:16}),N(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),p(St,{"has-changes":l.controller.hasChanges()},null,8,["has-changes"])],64))}});const Ta=se(Pa,[["__scopeId","data-v-d855dff0"]]);function We(){let t;const e={draggedType:B(null),isDragOver:B(!1),isAdding:B(!1),isDragging:B(!1),mousePosition:B(null)},{draggedType:s,isDragOver:o,isDragging:l,isAdding:v}=e,d=$=>{t=$,document.addEventListener("mousemove",D)},{screenToFlowCoordinate:h}=G();me(v,$=>{document.body.style.userSelect=$?"none":""});function w($,P){v.value=!0,$?($.setData("application/vueflow",P),$.effectAllowed="move",s.value=P,l.value=!0,document.addEventListener("drop",f)):(s.value=P,document.addEventListener("click",_))}function u($){$.preventDefault(),s.value&&(o.value=!0,$.dataTransfer&&($.dataTransfer.dropEffect="move"))}function g(){o.value=!1}function f(){v.value=!1,l.value=!1,o.value=!1,s.value=null,document.removeEventListener("drop",f)}function D($){const P={x:$.pageX-200,y:$.pageY-80};e.mousePosition.value=P}function c($){if(!s.value)throw new Error("No dragged type");return h({x:$.clientX-70,y:$.clientY-25})}function _($){if(!t)return;if(!s.value)throw new Error("No dragged type");const P=c($);t.addStages([{type:s.value,position:P}]),f()}function V(){document.removeEventListener("mousemove",D)}return{init:d,tearDown:V,draggedType:s,isDragOver:o,isAdding:v,isDragging:l,mousePosition:e.mousePosition,onDragStart:w,onDragLeave:g,onDragOver:u,onDrop:_}}const La={name:"ControlButton",compatConfig:{MODE:3}},Ha=(t,e)=>{const s=t.__vccOpts||t;for(const[o,l]of e)s[o]=l;return s},Fa={class:"vue-flow__controls-button"};function Na(t,e,s,o,l,v){return n(),m("button",Fa,[F(t.$slots,"default")])}const de=Ha(La,[["render",Na]]),ja={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Za=A("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),Ua=[Za];function Oa(t,e){return n(),m("svg",ja,Ua)}const Ra={render:Oa},Ka={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Xa=A("path",{d:"M0 0h32v4.2H0z"},null,-1),Ya=[Xa];function Wa(t,e){return n(),m("svg",Ka,Ya)}const Ga={render:Wa},qa={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ja=A("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Qa=[Ja];function eo(t,e){return n(),m("svg",qa,Qa)}const to={render:eo},ao={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},oo=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),so=[oo];function no(t,e){return n(),m("svg",ao,so)}const lo={render:no},io={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ro=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),uo=[ro];function co(t,e){return n(),m("svg",io,uo)}const po={render:co},go={name:"Controls",compatConfig:{MODE:3}},fo=L({...go,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>ht.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:s,nodesConnectable:o,elementsSelectable:l,setInteractive:v,zoomIn:d,zoomOut:h,fitView:w,viewport:u,minZoom:g,maxZoom:f}=G(),D=_e(()=>s.value||o.value||l.value),c=_e(()=>u.value.zoom<=g.value),_=_e(()=>u.value.zoom>=f.value);function V(){d(),e("zoomIn")}function $(){h(),e("zoomOut")}function P(){w(t.fitViewParams),e("fitView")}function T(){v(!D.value),e("interactionChange",!D.value)}return(S,j)=>(n(),b(a(mt),{class:"vue-flow__controls",position:S.position},{default:r(()=>[F(S.$slots,"top"),S.showZoom?(n(),m(R,{key:0},[F(S.$slots,"control-zoom-in",{},()=>[p(de,{class:"vue-flow__controls-zoomin",disabled:_.value,onClick:V},{default:r(()=>[F(S.$slots,"icon-zoom-in",{},()=>[(n(),b(Y(a(Ra))))])]),_:3},8,["disabled"])]),F(S.$slots,"control-zoom-out",{},()=>[p(de,{class:"vue-flow__controls-zoomout",disabled:c.value,onClick:$},{default:r(()=>[F(S.$slots,"icon-zoom-out",{},()=>[(n(),b(Y(a(Ga))))])]),_:3},8,["disabled"])])],64)):I("",!0),S.showFitView?F(S.$slots,"control-fit-view",{key:1},()=>[p(de,{class:"vue-flow__controls-fitview",onClick:P},{default:r(()=>[F(S.$slots,"icon-fit-view",{},()=>[(n(),b(Y(a(to))))])]),_:3})]):I("",!0),S.showInteractive?F(S.$slots,"control-interactive",{key:2},()=>[S.showInteractive?(n(),b(de,{key:0,class:"vue-flow__controls-interactive",onClick:T},{default:r(()=>[D.value?F(S.$slots,"icon-unlock",{key:0},()=>[(n(),b(Y(a(po))))]):I("",!0),D.value?I("",!0):F(S.$slots,"icon-lock",{key:1},()=>[(n(),b(Y(a(lo))))])]),_:3})):I("",!0)]):I("",!0),F(S.$slots,"default")]),_:3},8,["position"]))}}),vo=L({__name:"ControlButtons",props:{workflow:{}},setup(t){return(e,s)=>(n(),b(a(fo),{position:"top-left","show-interactive":!1},{default:r(()=>[p(a(de),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:s[0]||(s[0]=o=>e.workflow.history.undo())},{default:r(()=>[p(a(zt))]),_:1},8,["disabled"]),p(a(de),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:s[1]||(s[1]=o=>e.workflow.history.redo())},{default:r(()=>[p(a(ia))]),_:1},8,["disabled"])]),_:1}))}});class yo{constructor(e,s){ce(this,"dx");ce(this,"dy");this.dx=s.x-e.x,this.dy=s.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function ho(t,e,s=0){const{x:o,y:l}=e.center,{width:v,height:d}=e,h=new yo(t,e.center),w=s*(h.x/h.length),u=s*(h.y/h.length),g=d/v;let f,D;if(Math.abs(h.m)>Math.abs(g)){const c=d/2*(1/h.m);f=o-(h.y>0?c:-c),D=l+(h.y>0?-d/2:d/2)}else{const c=v/2*h.m;f=o+(h.x>0?-v/2:v/2),D=l-(h.x>0?c:-c)}return{x:f+w,y:D+u}}const mo=(t,e=0,s=0)=>{const o=Math.atan2(t.ty-t.sy,t.tx-t.sx),l=e*Math.sin(o),v=e*Math.cos(o),d=s*Math.cos(o),h=s*Math.sin(o);return{sourceX:t.sx-l+d,sourceY:t.sy+v+h,targetX:t.tx-l-d,targetY:t.ty+v-h}};function Se(t,e,s=0){const o={x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},v={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return ho(o,v,s)}function Ge(t,e){const s=Se(t,e,-10),o=Se(e,t,-10);return{sx:o.x,sy:o.y,tx:s.x,ty:s.y}}const ko=L({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,s)=>(n(),b(a(J),{vertical:"",gap:"small",style:Q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:r(()=>[(n(!0),m(R,null,ue(e.menuOptions,o=>(n(),b(a(Ze),{key:o.label,title:o.tooltip,placement:"right"},{default:r(()=>[p(a(Ie),{class:Me([{"warning-button":o.warning}]),disabled:o.disabled,style:Q({backgroundColor:o.disabled?"#f5f5f5":void 0}),onClick:l=>o.click(l)},{default:r(()=>[p(a(J),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:r(()=>[N(Z(o.label)+" ",1),o.key?(n(),b(a(oe),{key:0,keyboard:"",disabled:o.disabled},{default:r(()=>[N(Z(o.key),1)]),_:2},1032,["disabled"])):I("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const wo=L({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,s=[{label:"Edit task type",key:"T",click:()=>l.value="editing"},{label:"Delete",key:"Del",click:()=>D(e.data.id)}],o=B(e.data.props.taskType||""),l=B("idle"),v=()=>{l.value!=="idle"&&(o.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:o.value}),l.value="idle")},{onEdgeClick:d,onPaneClick:h,getSelectedEdges:w}=G();d(c=>{c.edge.id===e.id&&l.value==="idle"&&(l.value="selected")}),h(()=>v());const u=M(()=>Ge(e.sourceNode,e.targetNode)),g=M(()=>Re(mo(u.value))),f=c=>{!w.value.map(_=>_.id).includes(e.data.id)||(c.key==="Enter"&&v(),(c.key==="t"||c.key==="T")&&(l.value="editing"))},{removeEdges:D}=G();return De(()=>window.addEventListener("keydown",f)),xe(()=>window.removeEventListener("keydown",f)),(c,_)=>(n(),m(R,null,[p(a(kt),{path:g.value[0],"marker-end":c.markerEnd},null,8,["path","marker-end"]),p(a(wt),null,{default:r(()=>[l.value==="idle"?(n(),m("div",{key:0,style:Q({transform:`translate(-50%, -50%) translate(${g.value[1]}px,${g.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(n(),b(a(oe),{key:1},{default:r(()=>[N(Z(e.data.props.taskType),1)]),_:1})):(n(),b(a(Da),{key:0,size:16}))],4)):l.value==="selected"?(n(),m("div",{key:1,style:Q({transform:`translate(-50%, -120%) translate(${g.value[1]}px,${g.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[p(ko,{"is-connecting":!0,"is-editing":!0,"menu-options":s})],4)):l.value==="editing"?(n(),m("div",{key:2,style:Q({transform:`translate(-50%, -50%) translate(${g.value[1]}px,${g.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[p(a(ge),{value:o.value,"onUpdate:value":_[0]||(_[0]=V=>o.value=V),placeholder:"Task type"},null,8,["value"])],4)):I("",!0)]),_:1})],64))}});const _o=se(wo,[["__scopeId","data-v-48e71e28"]]),bo={key:0},$o=A("defs",null,[A("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[A("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),Co=["d"],Ao=L({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,s=B(!0),{onNodeMouseEnter:o,onNodeMouseLeave:l}=G();o(w=>{w.node.id===e.sourceNode.id&&(s.value=!1)}),l(w=>{w.node.id===e.sourceNode.id&&(s.value=!0)});const v=M(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),d=M(()=>Ge(e.sourceNode,v.value)),h=M(()=>Re({sourceX:d.value.sx,sourceY:d.value.sy,targetX:d.value.tx,targetY:d.value.ty}));return(w,u)=>s.value?(n(),m("g",bo,[$o,A("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:h.value[0],"marker-end":"url(#arrowhead)"},null,8,Co)])):I("",!0)}}),So=L({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const s=t,o=M(()=>{const l=Vt(s.filename);return l.valid?s.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:l});return(l,v)=>(n(),b(a(lt),{open:l.creatingFileStatus==="prompting"||l.creatingFileStatus==="creating",closable:!1,"confirm-loading":l.creatingFileStatus==="creating",onOk:v[1]||(v[1]=d=>e("create-file",l.filename)),onCancel:v[2]||(v[2]=d=>e("cancel"))},{default:r(()=>[p(a(Ue),{layout:"vertical",disabled:l.creatingFileStatus=="creating"},{default:r(()=>[p(a(ve),{label:"You're creating a new file. What should it be called?","validate-status":o.value.valid?"success":"error",help:o.value.valid?o.value.help:o.value.reason},{default:r(()=>[p(a(ge),{value:l.filename,onChange:v[0]||(v[0]=d=>e("update-filename",d.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),Io={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},Mo=L({...Io,props:{nodeId:null,isVisible:{type:Boolean},position:{default:pe.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,s=W(_t,null),{viewportRef:o,viewport:l,getSelectedNodes:v,findNode:d}=G();function h(c,_,V,$,P){let T=.5;P==="start"?T=0:P==="end"&&(T=1);let S=[(c.x+c.width*T)*_.zoom+_.x,c.y*_.zoom+_.y-$],j=[-100*T,-100];switch(V){case pe.Right:S=[(c.x+c.width)*_.zoom+_.x+$,(c.y+c.height*T)*_.zoom+_.y],j=[0,-100*T];break;case pe.Bottom:S[1]=(c.y+c.height)*_.zoom+_.y+$,j[1]=0;break;case pe.Left:S=[c.x*_.zoom+_.x-$,(c.y+c.height*T)*_.zoom+_.y],j=[-100,-100*T];break}return`translate(${S[0]}px, ${S[1]}px) translate(${j[0]}%, ${j[1]}%)`}const w=M(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||s||""]).reduce((c,_)=>{const V=d(_);return V&&c.push(V),c},[])),u=M(()=>typeof e.isVisible=="boolean"?e.isVisible:w.value.length===1&&w.value[0].selected&&v.value.length===1),g=M(()=>bt(w.value)),f=M(()=>Math.max(...w.value.map(c=>(c.computedPosition.z||1)+1))),D=M(()=>({position:"absolute",transform:h(g.value,l.value,e.position,e.offset,e.align),zIndex:f.value}));return(c,_)=>(n(),b(it,{to:a(o),disabled:!a(o)},[a(u)&&a(w).length?(n(),m("div",he({key:0},c.$attrs,{style:a(D),class:"vue-flow__node-toolbar"}),[F(c.$slots,"default")],16)):I("",!0)],8,["to","disabled"]))}}),Do=L({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,s)=>(n(),b(a(Mo),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:a(pe).Right},{default:r(()=>[p(a(J),{vertical:"",gap:"small",style:Q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:r(()=>[(n(!0),m(R,null,ue(e.menuOptions,o=>(n(),b(a(Ze),{key:o.label,title:o.tooltip,placement:"right"},{default:r(()=>[p(a(Ie),{class:Me([{"warning-button":o.warning}]),disabled:o.disabled,style:Q({backgroundColor:o.disabled?"#f5f5f5":void 0}),onClick:l=>o.click(l)},{default:r(()=>[p(a(J),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:r(()=>[N(Z(o.label)+" ",1),o.key?(n(),b(a(oe),{key:0,keyboard:"",disabled:o.disabled},{default:r(()=>[N(Z(o.key),1)]),_:2},1032,["disabled"])):I("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const xo=L({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(t,{emit:e}){var U;const s=t,o=B(!1),v=Ye().agentUsageMode,d=ie.object({title:ie.string(),clientStageId:ie.string().uuid(),inputSchemas:ie.any(),outputSchemas:ie.any()});me(()=>s.stageProps.projectId,()=>{o.value=!0,S()});const h=Lt(),w=()=>{var E;const C=(E=h.cloudProject)==null?void 0:E.id;return C?`https://cloud.abstra.io/projects/${C}/agents`:""},u=ie.array(d),g=B((U=s.stageProps.projectId)!=null?U:""),f=B(!1),D=C=>c.loading.value||!c.result.value?null:c.result.value.find(E=>E.agentConnection.id===C),c=Ce(async()=>ke.listConnections()),_=M(()=>c.loading.value||!c.result.value?[]:c.result.value.map(C=>({label:C.agentConnection.connectionName,key:C.agentConnection.id,value:C.agent.projectId}))),{result:V,loading:$,refetch:P,error:T}=Ce(async()=>{const C=s.stageProps.projectId;if(!C)return[];const X=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${C}`)).json();return u.parse(X)}),S=Oe.exports.debounce(()=>{o.value=!1,P()},500),j=M(()=>$.value||!V.value?[]:V.value.map(C=>({label:C.title,value:C.clientStageId})));function q(C){e("update:stage-props",{...s.stageProps,projectId:C,clientStageId:null})}function y(C){const E=D(C.key);!E||(q(E.agent.projectId),g.value=E.agent.projectId,f.value=!1)}function x(C){const E=C.target;g.value=E.value,q(E.value),f.value=!0}function z(C){f.value=C}function K(C){const E=String(C);!V.value||e("update:stage-props",{...s.stageProps,clientStageId:E})}return(C,E)=>(n(),m(R,null,[p(a(ve),{label:"Project ID"},{default:r(()=>{var X;return[a(v)?(n(),b(a(dt),{key:0,trigger:"click",visible:f.value,onVisibleChange:z},{overlay:r(()=>[p(a(rt),{onClick:y},{default:r(()=>[(n(!0),m(R,null,ue(_.value,ne=>(n(),b(a(He),{key:ne.key},{default:r(()=>[N(Z(ne.label),1)]),_:2},1024))),128)),p(a(He),null,{default:r(()=>[p(a(je),{class:"cloud-link",href:w(),target:"_blank"},{default:r(()=>[N(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:r(()=>[p(a(ge),{value:g.value,"onUpdate:value":E[0]||(E[0]=ne=>g.value=ne),autofocus:"","allow-clear":"",onInput:x},null,8,["value"])]),_:1},8,["visible"])):(n(),b(a(ge),{key:1,value:(X=C.stageProps.projectId)!=null?X:"",placeholder:"Project ID",autofocus:"","onUpdate:value":q},null,8,["value"]))]}),_:1}),p(a(ve),{label:"Client entrypoint"},{default:r(()=>{var X;return[o.value||a($)?(n(),b(a(be),{key:0,disabled:"",loading:""})):a(T)?(n(),b(a(Ae),{key:1,type:"error",message:"Invalid project id"})):C.stageProps.projectId?a(V).length===0?(n(),b(a(Ae),{key:3,type:"warning",message:"The project has no entrypoints"})):(n(),b(a(be),{key:4,class:"entrypoint-select",options:j.value,value:(X=C.stageProps.clientStageId)!=null?X:void 0,"onUpdate:value":K},null,8,["options","value"])):(n(),b(a(be),{key:2,disabled:""}))]}),_:1})],64))}});const Eo=se(xo,[["__scopeId","data-v-f4d2a34d"]]),zo=L({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Le;const e=t,{useToken:s}=Ke,{token:o}=s(),l=o.value.colorText,v=[{label:"Add transition",key:"T",click:i=>Be(i)},{label:"Rename",key:"R",click:()=>O.value=!0},{label:"Go to editor",key:"Enter",click:()=>ze()},{label:"Tasks",key:"M",click:()=>h.value=!0},{label:"Delete",key:"Del",click:()=>x(e.stage)}],d=M(()=>{let i=[...v];return w.value||i.unshift({label:"Create missing file",warning:!0,click:()=>P()}),e.controller.hasChanges()&&(i=i.map(k=>k.label==="Go to editor"?{...k,disabled:!0,tooltip:"Save it to allow editing"}:k)),(e.stage.type==="agents"||e.stage.type==="clients")&&(i=i.filter(k=>!["Create missing file","Go to editor","Tasks"].includes(k.label))),e.stage.type==="agents"&&(i=i.map(k=>k.label==="Rename"?{...k,label:"Edit"}:k)),i}),h=B(!1),w=B(e.initialFileCheck);me(()=>e.initialFileCheck,i=>{w.value=i});const u=i=>{c.value=i,D()},g=i=>{e.controller.updateStageProps(e.stage.id,i)},f=()=>{var i;_.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(c.value=(i=e.stage.props.filename)!=null?i:"",D())},D=Oe.exports.debounce(async()=>{const i=c.value;if(!i){w.value=!0;return}fe.checkFile(i).then(k=>{w.value=k.exists})},500),c=B((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Le=e.stage.props.filename)!=null?Le:""),_=B("idle"),V=async()=>{_.value="creating",await fe.initFile(c.value,e.stage.type),w.value=!0;const i=await fe.checkFile(c.value);if(w.value=i.exists,_.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:c.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:c.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},$=M(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!w.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),P=()=>{_.value="prompting"},{startConnection:T,updateConnection:S,onNodeClick:j,addEdges:q,endConnection:y,removeNodes:x,onPaneClick:z,getSelectedNodes:K,flowToScreenCoordinate:U,onNodeMouseEnter:C,onNodeMouseLeave:E,getNodes:X,onNodesChange:ne,applyNodeChanges:Je}=G(),Qe=ut(),ee=B(!1),O=B(!1),te=B(e.stage.title),we=B(!1);ne(async i=>{var H;const k=[];for(const le of i)le.type==="remove"?O.value||((H=e.controller)==null||H.delete([le.id]),k.push(le)):k.push(le);Je(k)});const ze=()=>{const i=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Qe.push({path:`/_editor/${i}/${e.stage.id}`})},Be=(i,k=!0)=>{T({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:k?i.pageX:i.pageX-90,y:k?i.pageY-50:i.pageY-20}),document.addEventListener("mousemove",Ve),ee.value=!0},Ve=i=>{ee.value&&!we.value&&S({x:i.pageX,y:i.pageY-52})};j(i=>{if(i.node.id===e.stage.id&&D(),ee.value&&i.node.id!==e.stage.id){const k={sourceStageId:e.stage.id,targetStageId:i.node.id,type:"task",id:at(),props:{taskType:null}};try{e.controller.connect([k]),document.removeEventListener("mousemove",Ve),q({id:k.id,source:e.stage.id,target:i.node.id,type:"task",markerEnd:{type:$t.Arrow,width:24,height:24},data:k}),y(),ee.value=!1}catch(H){console.error(H)}}}),C(i=>{if(ee.value&&i.node.id!==e.stage.id){we.value=!0;const k=X.value.find(le=>le.id===e.stage.id);if(!k)return;const H=Se(k,i.node,-10);S(U({x:H.x,y:H.y-52}))}}),E(()=>{we.value=!1});const Pe=()=>{if(!w.value){const i=Pt(te.value+".py");c.value=i;let k={filename:i,path:null};if(["forms","hooks"].includes(e.stage.type)){const H=Tt(te.value);k={...k,path:H}}e.controller.updateStageProps(e.stage.id,k)}};z(()=>{O.value=!1,e.stage.title!==te.value&&(e.controller.updateStageTitle(e.stage.id,te.value),Pe()),ee.value=!1,y()});const Te=i=>{if(!!K.value.map(k=>k.id).includes(e.stage.id)&&_.value==="idle"){if(i.key==="Enter")if(O.value)O.value=!1,e.controller.updateStageTitle(e.stage.id,te.value),Pe();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;ze()}if(!O.value){if(i.key==="t"||i.key==="T"){const k=U(e.stage.position);Be({pageX:k.x,pageY:k.y},!1)}(i.key==="r"||i.key==="R")&&(O.value=!0),(i.key==="m"||i.key==="M")&&(h.value=!0)}}};return De(()=>{window.addEventListener("keydown",Te)}),xe(()=>{window.removeEventListener("keydown",Te)}),(i,k)=>(n(),m(R,null,[p(Do,{"is-connecting":ee.value,"is-editing":O.value,"menu-options":d.value},null,8,["is-connecting","is-editing","menu-options"]),A("div",{class:"stage",onDblclick:k[1]||(k[1]=H=>O.value=!0)},[p(a(J),{vertical:O.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:r(()=>[(n(),b(Y(a(Mt)(i.stage.type)),{size:18,color:a(l)},null,8,["color"])),O.value?(n(),b(a(Ue),{key:1,layout:"vertical"},{default:r(()=>[p(a(ve),{label:"Title"},{default:r(()=>[p(a(ge),{value:te.value,"onUpdate:value":k[0]||(k[0]=H=>te.value=H),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),i.stage.type==="agents"?(n(),b(Eo,{key:0,"stage-props":i.stage.props,"onUpdate:stageProps":g},null,8,["stage-props"])):I("",!0)]),_:1})):(n(),b(a(ct),{key:0,class:"title"},{default:r(()=>[N(Z(i.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),$.value?(n(),b(a(Ft),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):I("",!0),_.value==="prompting"||_.value==="creating"?(n(),b(So,{key:1,filename:c.value,"file-exists":w.value,"creating-file-status":_.value,onCreateFile:V,onCancel:f,onUpdateFilename:u},null,8,["filename","file-exists","creating-file-status"])):I("",!0),p(a(Ht),{visible:h.value,"onUpdate:visible":k[2]||(k[2]=H=>h.value=H),title:"Tasks",width:"500",onClose:k[3]||(k[3]=H=>h.value=!1)},{default:r(()=>[p(Bt,{"stage-id":i.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const re=se(zo,[["__scopeId","data-v-ccfb2273"]]),qe=t=>(pt("data-v-f4278104"),t=t(),gt(),t),Bo={class:"empty-hint"},Vo={key:0,class:"drag-hint"},Po=qe(()=>A("div",{class:"title"},"Start here",-1)),To={key:1,class:"drop-hint"},Lo=qe(()=>A("div",{class:"title"},"Drop here",-1)),Ho={key:2,class:"stages-hint"},Fo={class:"header"},No={class:"title"},jo={class:"description"},Zo=L({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,s)=>(n(),m("div",Bo,[e.showDragHint?(n(),m("div",Vo,[Po,p(a(Fe),{size:32,class:"arrow"})])):I("",!0),e.showDragHint?I("",!0):(n(),m("div",To,[Lo,p(a(Fe),{size:32,class:"arrow"})])),e.showDragHint?(n(),m("div",Ho,[(n(!0),m(R,null,ue(a(ye).stages,o=>(n(),m("div",{key:o.key,class:"stage-hint"},[A("div",Fo,[(n(),b(Y(o.icon))),A("span",No,Z(o.title),1)]),A("div",jo,Z(o.description),1)]))),128))])):I("",!0)]))}});const Uo=se(Zo,[["__scopeId","data-v-f4278104"]]),Oo=L({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;ft(u=>({ecafe25e:a(d),"3094d9cc":a(v)}));const s=We(),{useToken:o}=Ke,{token:l}=o(),v=l.value.colorPrimaryBorder,d=l.value.colorBgElevated,{onInit:h}=G();h(u=>{u.fitView()});const w=u=>{var g;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:u&&(g=e.initialFileCheckStatus[u])!=null?g:!1};return(u,g)=>u.workflow?(n(),b(a(Ct),{key:0,nodes:u.workflow.vueFlowNodes.value,edges:u.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":u.editable,"pan-on-scroll":a(Ee).isMac,"elements-selectable":u.editable,"snap-to-grid":"","apply-default":!1,onDragover:a(s).onDragOver,onDragleave:a(s).onDragLeave},{"connection-line":r(f=>[p(Ao,vt(yt(f)),null,16)]),"edge-task":r(f=>[p(_o,he(f,{controller:u.workflow}),null,16,["controller"])]),"node-forms":r(f=>[p(re,{stage:f.data,node:f,controller:u.workflow,"initial-file-check":w(f.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":r(f=>[p(re,{stage:f.data,node:f,controller:u.workflow,"initial-file-check":w(f.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":r(f=>[p(re,{stage:f.data,node:f,controller:u.workflow,"initial-file-check":w(f.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":r(f=>[p(re,{stage:f.data,node:f,controller:u.workflow,"initial-file-check":w(f.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":r(f=>[p(re,{stage:f.data,node:f,controller:u.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":r(f=>[p(re,{stage:f.data,node:f,controller:u.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:r(()=>[p(a(xt)),u.editable&&!u.workflow.vueFlowNodes.value.length?(n(),b(Uo,{key:0,"show-drag-hint":u.showDragHint},null,8,["show-drag-hint"])):I("",!0),p(a(Et),{pannable:"",zoomable:""}),u.editable?(n(),b(vo,{key:1,workflow:u.workflow},null,8,["workflow"])):I("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):I("",!0)}});const Ro=se(Oo,[["__scopeId","data-v-d709f269"]]),Ko=L({__name:"WorkflowEditor",setup(t){const{init:e,tearDown:s,onDragStart:o,onDrop:l,isDragging:v,isAdding:d,draggedType:h,mousePosition:w}=We(),{result:u}=Ce(async()=>await ot.init(st,!0)),g=B(null),f=async()=>{if(!u.value)return;const y=u.value.vueFlowNodes.value.map(x=>{var z,K,U,C,E;return((z=x.data)==null?void 0:z.type)==="forms"||((K=x.data)==null?void 0:K.type)==="hooks"||((U=x.data)==null?void 0:U.type)==="scripts"||((C=x.data)==null?void 0:C.type)==="jobs"?(E=x.data)==null?void 0:E.props.filename:null});g.value=await fe.checkFiles(y.filter(x=>typeof x=="string"))};me(()=>u.value,()=>{u.value&&(e(u.value),f())});const{onNodeDragStop:D,onEdgesChange:c,getSelectedElements:_,getNodes:V,addSelectedNodes:$,zoomIn:P,fitView:T,zoomOut:S,applyEdgeChanges:j}=G();D(y=>{var x;(x=u.value)==null||x.move(y.nodes.map(z=>({id:z.id,position:z.position})))}),c(y=>{var x;for(const z of y)z.type==="remove"&&((x=u.value)==null||x.delete([z.id]));j(y)});const q=y=>{var x,z;!u.value||((y.key==="z"||y.key==="Z")&&ae(y)&&(Xe(y)?u.value.history.redo():(x=u.value)==null||x.history.undo(),y.preventDefault()),ae(y)&&(y.key==="s"||y.key==="S")&&((z=u.value)==null||z.save(),y.preventDefault()),!_.value.length&&(y.key==="f"||y.key==="F"?o(null,"forms"):y.key==="h"||y.key==="H"?o(null,"hooks"):y.key==="j"||y.key==="J"?o(null,"jobs"):y.key==="o"||y.key==="O"?o(null,"scripts"):(y.key==="a"||y.key==="A")&&ae(y)?($(V.value),y.preventDefault()):y.key==="0"&&ae(y)?(T(),y.preventDefault()):(y.key==="="||y.key==="+")&&ae(y)?(y.preventDefault(),P()):y.key==="-"&&ae(y)&&(y.preventDefault(),S())))};return De(()=>{window.addEventListener("keydown",q)}),xe(()=>{window.removeEventListener("keydown",q),s()}),(y,x)=>a(u)?(n(),m("div",{key:0,class:Me(["workflow-container",{dragging:a(d)}]),onDrop:x[0]||(x[0]=(...z)=>a(l)&&a(l)(...z))},[p(Ro,{workflow:a(u),editable:"","show-drag-hint":!a(d),"check-file-status":!0,"initial-file-check-status":g.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),p(Ta,{controller:a(u),onDragStart:a(o)},null,8,["controller","onDragStart"]),(n(!0),m(R,null,ue(a(ye).stages,z=>{var K,U;return n(),m("div",{key:z.key},[a(d)&&!a(v)&&z.typeName===a(h)?(n(),m("div",{key:0,class:"dragging-node",style:Q({left:`${(K=a(w))==null?void 0:K.x}px`,top:`${(U=a(w))==null?void 0:U.y}px`,position:"absolute",cursor:a(d)?"grabbing":"grab"})},[(n(),b(Y(z.icon),{size:18}))],4)):I("",!0)])}),128))],34)):I("",!0)}});const Vs=se(Ko,[["__scopeId","data-v-5f802ac0"]]);export{Vs as default};
//# sourceMappingURL=WorkflowEditor.45eb88e2.js.map

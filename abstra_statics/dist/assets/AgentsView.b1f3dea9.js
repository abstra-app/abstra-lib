var U=Object.defineProperty;var R=(s,e,n)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>(R(s,typeof e!="symbol"?e+"":e,n),n);import{C as T}from"./ConnectorCard.be762d08.js";import{_ as V}from"./AbstraButton.vue_vue_type_script_setup_true_lang.ac50365f.js";import{e as P,cL as b,d as M,o as l,c as u,w as i,b as a,u as t,dc as D,aG as c,e9 as L,d5 as O,bR as x,bz as B,bx as v,S as f,dh as p,em as G,en as z,a as j,a0 as S,ea as Y,Y as w,aS as _,dd as y,db as E,eb as $,cz as q,bL as H,eO as J}from"./index.af5935c5.js";import{C as A}from"./gateway.080706ea.js";import{C as K}from"./router.d78f9794.js";import{G as Q}from"./PhDotsThreeVertical.vue.25910ae8.js";import{A as W}from"./Avatar.08a85760.js";import{C as X}from"./Card.20071def.js";import{A as Z}from"./index.327f331f.js";import"./popupNotifcation.d7845d1b.js";import"./Badge.698eb2df.js";import"./TabPane.1ece305b.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="34528b39-ad97-4ea1-8d07-1b850d870c8f",s._sentryDebugIdIdentifier="sentry-dbid-34528b39-ad97-4ea1-8d07-1b850d870c8f")}catch{}})();class ee{async listAgents(){return A.get("agents")}async listAgentConnections(e){return A.get(`projects/${e}/agents/connections`)}async createAgentConnection({projectId:e,agentId:n}){return A.post(`projects/${e}/agents/connections`,{agentId:n})}async renameAgentConnection({projectId:e,agentConnectionId:n,newAgentConnectionName:o}){return A.patch(`projects/${e}/agents/connections/${n}`,{newAgentConnectionName:o})}async deleteAgentConnection({projectId:e,agentConnectionId:n}){return A.delete(`projects/${e}/agents/connections/${n}`)}}const te="/src/assets/logo.svg";class F{constructor(e){this.data=e}get id(){return this.data.id}get name(){return this.data.name}get description(){return this.data.description}get setupPath(){return this.data.setupPath}get logoURL(){return this.data.logoURL||te}get unavailable(){return!this.data.isAvailable}}class ne{constructor(e){this.data=e}get id(){return this.data.id}get connectionName(){return this.data.connectionName}get agentId(){return this.data.agentId}get clientProjectId(){return this.data.clientProjectId}get connectionStatus(){return this.data.connectionStatus}}class oe{constructor(e){C(this,"agentConnection");C(this,"agent");C(this,"redirectURL");this.data=e,this.agentConnection=new ne(e.agentConnection),this.agent=new F(e.agent),this.redirectURL=e.redirectURL}}class ie{constructor(e,n){C(this,"state");this.api=e,this.projectId=n,this.state=P({agents:[],agentConnectionDetailsList:[],selectedAgentForConnection:null,editingAgentConnection:{selectedAgentConnection:null,newName:"",errorMessage:null}})}get agents(){return this.state.value.agents}get agentConnectionDetailsList(){return this.state.value.agentConnectionDetailsList}get selectedAgentForConnection(){return this.state.value.selectedAgentForConnection}get selectedAgentConnectionForEditing(){return this.state.value.editingAgentConnection.selectedAgentConnection}get editingNewName(){return this.state.value.editingAgentConnection.newName}set editingNewName(e){this.state.value.editingAgentConnection.newName=e}get editingErrorMessage(){return this.state.value.editingAgentConnection.errorMessage}hasChanges(){return!!this.state.value.editingAgentConnection.selectedAgentConnection&&this.state.value.editingAgentConnection.newName!==this.state.value.editingAgentConnection.selectedAgentConnection.connectionName}async fetchInitialState(){await Promise.all([this.fetchAgents(),this.fetchAgentConnections()])}async fetchAgents(){const e=await this.api.listAgents();this.state.value.agents=e.map(n=>new F(n))}async fetchAgentConnections(){const e=await this.api.listAgentConnections(this.projectId);this.state.value.agentConnectionDetailsList=e.map(n=>new oe(n))}cancelAgentConnectionCreation(){this.state.value.selectedAgentForConnection=null}cancelAgentConnectionEditing(){this.state.value.editingAgentConnection.selectedAgentConnection=null,this.state.value.editingAgentConnection.newName="",this.removeEditingErrorMessage()}async createAgentConnection(){if(!this.state.value.selectedAgentForConnection)return;const n=(await this.api.createAgentConnection({projectId:this.projectId,agentId:this.state.value.selectedAgentForConnection.id})).redirectUrl;n?window.location.href=n:(await this.fetchAgentConnections(),this.cancelAgentConnectionCreation())}handleEditAgentConnectionClick(e){this.state.value.editingAgentConnection.newName=e.connectionName,this.state.value.editingAgentConnection.selectedAgentConnection=e}async renameAgentConnection(){try{await this.api.renameAgentConnection({projectId:this.projectId,agentConnectionId:this.state.value.editingAgentConnection.selectedAgentConnection.id,newAgentConnectionName:this.state.value.editingAgentConnection.newName}),this.cancelAgentConnectionEditing(),await this.fetchAgentConnections()}catch{this.state.value.editingAgentConnection.errorMessage="There's already a connection to the same agent with this name"}}removeEditingErrorMessage(){this.state.value.editingAgentConnection.errorMessage=null}async deleteAgentConnection(e){await this.api.deleteAgentConnection({projectId:this.projectId,agentConnectionId:e}),await this.fetchAgentConnections()}handleDeleteAgentConnectionClick(e){b.confirm({title:`Are you sure you want to delete ${e.connectionName}?`,onOk:()=>this.deleteAgentConnection(e.id)})}showNewAgentConnectionModal(e){this.state.value.selectedAgentForConnection=e}handleSetupAgentConnectionClick(e){!e.redirectURL||(window.location.href=e.redirectURL)}}const ae=s=>(G("data-v-4372bea0"),s=s(),z(),s),se=ae(()=>j("div",{style:{"flex-grow":"1"}},null,-1)),re=M({__name:"AgentConnectionCard",props:{agentConnectionDetails:{},controller:{}},setup(s){function e(n){switch(n){case"connected":return"success";case"pending":return"warning";default:return"default"}}return(n,o)=>(l(),u(t(X),null,{default:i(()=>[a(t(p),{align:"center",gap:16},{default:i(()=>[a(t(W),{src:n.agentConnectionDetails.agent.logoURL,height:"40px",shape:"square"},null,8,["src"]),a(t(D),{strong:""},{default:i(()=>[c(L(n.agentConnectionDetails.agent.name),1)]),_:1}),se,a(t(D),{content:n.agentConnectionDetails.agentConnection.connectionName,code:""},null,8,["content"]),a(t(O),{class:"status-tag",color:e(n.agentConnectionDetails.agentConnection.connectionStatus)},{default:i(()=>[c(L(n.agentConnectionDetails.agentConnection.connectionStatus),1)]),_:1},8,["color"]),a(t(x),null,{overlay:i(()=>[a(t(B),null,{default:i(()=>[n.agentConnectionDetails.redirectURL?(l(),u(t(v),{key:0,onClick:o[0]||(o[0]=h=>n.controller.handleSetupAgentConnectionClick(n.agentConnectionDetails))},{default:i(()=>[c(" Setup ")]),_:1})):f("",!0),a(t(v),{onClick:o[1]||(o[1]=h=>n.controller.handleEditAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:i(()=>[c(" Rename ")]),_:1}),a(t(v),{danger:"",onClick:o[2]||(o[2]=h=>n.controller.handleDeleteAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:i(()=>[c(" Disconnect ")]),_:1})]),_:1})]),default:i(()=>[a(t(Q))]),_:1})]),_:1})]),_:1}))}});const ce=S(re,[["__scopeId","data-v-4372bea0"]]),le={class:"agents-grid"},de=M({__name:"AgentsView",setup(s){const n=Y().params.projectId,o=new ie(new ee,n);o.fetchInitialState();function h(m){m.unavailable?K.showNewMessage(J.translate("i18n_agents_ask_for_access",null,m.name)):o.showNewAgentConnectionModal(m)}return(m,r)=>{var I,N;return l(),w(_,null,[a(t(Z),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:i(()=>{var d,k;return[a(t(y),null,{default:i(()=>[c("Agents")]),_:1}),a(t(E),null,{default:i(()=>[c("Add and manage external integrations to your project.")]),_:1}),(d=t(o).agentConnectionDetailsList)!=null&&d.length?(l(),u(t(p),{key:0,vertical:""},{default:i(()=>[a(t(y),{level:2},{default:i(()=>[c("Connected")]),_:1}),a(t(p),{vertical:"",gap:10},{default:i(()=>[(l(!0),w(_,null,$(t(o).agentConnectionDetailsList,g=>(l(),u(ce,{key:g.agentConnection.id,"agent-connection-details":g,controller:t(o)},null,8,["agent-connection-details","controller"]))),128))]),_:1})]),_:1})):f("",!0),(k=t(o).agents)!=null&&k.length?(l(),u(t(p),{key:1,vertical:""},{default:i(()=>[a(t(y),{level:2},{default:i(()=>[c("All")]),_:1}),j("div",le,[(l(!0),w(_,null,$(t(o).agents,g=>(l(),u(T,{key:g.id,title:g.name,"logo-url":g.logoURL,description:g.description,unavailable:g.unavailable,onClick:ge=>h(g)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})):f("",!0)]}),_:1}),a(t(b),{open:!!t(o).selectedAgentForConnection,title:(I=t(o).selectedAgentForConnection)==null?void 0:I.name,"ok-text":"Connect",onCancel:r[0]||(r[0]=d=>t(o).cancelAgentConnectionCreation()),onOk:r[1]||(r[1]=d=>t(o).createAgentConnection())},{default:i(()=>[a(t(E),null,{default:i(()=>[c("You will be redirected to the Agent's setup page.")]),_:1})]),_:1},8,["open","title"]),a(t(b),{open:!!t(o).selectedAgentConnectionForEditing,title:`${(N=t(o).selectedAgentConnectionForEditing)==null?void 0:N.connectionName} Connection`,onCancel:r[5]||(r[5]=d=>t(o).cancelAgentConnectionEditing())},{footer:i(()=>[a(t(p),{justify:"end"},{default:i(()=>[a(V,{type:"primary",disabled:!t(o).hasChanges(),onClick:r[4]||(r[4]=d=>t(o).renameAgentConnection())},{default:i(()=>[c(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[a(t(q),{"has-feedback":"","validate-status":t(o).editingErrorMessage?"error":"",help:t(o).editingErrorMessage},{default:i(()=>[t(o).selectedAgentConnectionForEditing?(l(),u(t(H),{key:0,value:t(o).editingNewName,"onUpdate:value":r[2]||(r[2]=d=>t(o).editingNewName=d),onChange:r[3]||(r[3]=d=>t(o).removeEditingErrorMessage())},null,8,["value"])):f("",!0)]),_:1},8,["validate-status","help"])]),_:1},8,["open","title"])],64)}}});const Ne=S(de,[["__scopeId","data-v-f3283209"]]);export{Ne as default};
//# sourceMappingURL=AgentsView.b1f3dea9.js.map

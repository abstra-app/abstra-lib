import{f as n,eG as Oe,fb as Re,d as re,eB as se,H as q,r as x,J as me,eM as ee,a as ie,b as p,c as h,w as a,u as e,bG as R,ar as E,cE as ve,bz as G,bg as Ae,ex as A,o as Fe,e as F,ae as Ke,v as Le,eA as $e,G as Me,ev as Y,fc as Je,eD as W,bE as Ve,bh as He,bf as De,aD as pe,cz as Ge,aH as Qe,cG as Ye,eC as xe,eJ as Ze,bA as We,eL as Xe,I as et}from"./outputWidgets.cb8125c8.js";import{p as Ee,T as Z,d as tt}from"./tables.92a59e5d.js";import{B as at}from"./BaseLayout.e3221a94.js";import{a as ye}from"./asyncComputed.6371a492.js";import{p as ue}from"./popupNotifcation.847864fc.js";import{Y as Ue,Z as Ne,_ as nt,H as lt}from"./icons.761f499f.js";import"./router.8af9b9a1.js";import{P as ge}from"./project.05ccc251.js";import"./index.51599d9a.js";import{A as Te}from"./index.40b2a98b.js";import{A as N,F as be}from"./Form.2624236f.js";import{A as te}from"./index.feb4dc44.js";import{A as he}from"./index.e140988e.js";import{a as ut}from"./ant-design.178d8a9a.js";import{E as ot}from"./Base.78af0cff.js";import{L as rt}from"./LoadingOutlined.99c2ed5f.js";import{A as oe}from"./index.9597c69d.js";import{D as st}from"./DeleteOutlined.65a435fa.js";import{A as it}from"./index.88be4d2d.js";import{O as dt}from"./organization.5b469394.js";import{B as ct,a as ft,c as pt}from"./index.dfe7eea5.js";import"./record.ccc69b14.js";import"./pubsub.6ee8a225.js";import"./string.50397de7.js";import"./index.cf4c23b9.js";import"./index.978da9da.js";import"./hasIn.9225fb6c.js";import"./isNumeric.75337b1e.js";import"./index.980cd2fb.js";import"./Modal.945e24ca.js";import"./Typography.df8b404a.js";import"./DeleteOutlined.f8ba9770.js";import"./ArrowRightOutlined.08fa31dd.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[s]="0bd7b81b-6085-4cdd-8a06-7ba39469bf3f",m._sentryDebugIdIdentifier="sentry-dbid-0bd7b81b-6085-4cdd-8a06-7ba39469bf3f")}catch{}})();function Se(m){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?Object(arguments[s]):{},C=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(C=C.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),C.forEach(function(g){mt(m,g,t[g])})}return m}function mt(m,s,t){return s in m?Object.defineProperty(m,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):m[s]=t,m}var ke=function(s,t){var C=Se({},s,t.attrs);return n(Oe,Se({},C,{icon:Re}),null)};ke.displayName="DownOutlined";ke.inheritAttrs=!1;const vt=ke;function Ie(m){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?Object(arguments[s]):{},C=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(C=C.concat(Object.getOwnPropertySymbols(t).filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable}))),C.forEach(function(g){yt(m,g,t[g])})}return m}function yt(m,s,t){return s in m?Object.defineProperty(m,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):m[s]=t,m}var _e=function(s,t){var C=Ie({},s,t.attrs);return n(Oe,Ie({},C,{icon:ot}),null)};_e.displayName="EditOutlined";_e.inheritAttrs=!1;const gt=_e,je=(m,s)=>s.includes(m)?{status:"error",help:"There already is a column with this name in the table"}:{status:""},bt=re({__name:"NewColumn",props:{open:{type:Boolean},table:{}},emits:["created","cancel"],setup(m,{emit:s}){const t=m,g=se().params.projectId,T=q(()=>{var f;return((f=t.table)==null?void 0:f.getColumns().map(d=>d.name))||[]}),U=q(()=>je(i.value.name,T.value)),w={name:"",type:"varchar",default:"",nullable:!0,unique:!1},i=x(w),J=()=>{i.value={...w}},z=x([{value:"reference",label:"reference",isLeaf:!1},...Ee.map(f=>({value:f,label:f,isLeaf:!0}))]),B=f=>{if(!f)return;const d=f[f.length-1];switch(f.length){case 0:return;case 1:d.loading=!0,Z.list(g).then(I=>{d.children=I.map(D=>({value:D.id,label:D.name,isLeaf:!1})),d.loading=!1});return;case 2:d.loading=!0,Z.get(g,d.value).then(I=>{d.children=I.getColumns().map(D=>({type:D.type,value:D.id,label:D.name,isLeaf:!0})),d.loading=!1});return}},b=(f,d)=>{if(!!f){if(f.length===1){i.value.type=f[0],i.value.foreignKey=void 0;return}if(f.length===3){const I=d[d.length-1];i.value.type=I.type,i.value.foreignKey={columnId:I.value}}}},S=f=>{const d=f.selectedOptions;return d?d.length===1?d[0].label:d.length===3?`reference to ${d[1].label}(${d[2].label})`:"":"Select type"},y=x({...{status:"success",message:"",fakeLoading:!1}}),K=()=>{y.value.fakeLoading=!0,X()};me(()=>i.value.type,()=>{i.value.default=tt[i.value.type]||"",K()});const X=ee.exports.debounce(async()=>{if(!i.value.default){y.value.status="success",y.value.message="",y.value.fakeLoading=!1;return}const f=`select (${i.value.default})::${i.value.type} `;ge.executeQuery(g,f,[]).then(d=>{y.value.status=d.errors.length>0?"error":"success",y.value.message=d.errors[0]||"",y.value.fakeLoading=!1})},500);function V(){s("cancel")}async function L(){if(!!t.table&&!(!i.value.name||!i.value.type))try{await t.table.addColumn(i.value),J(),s("created")}catch(f){f instanceof Error&&ue("Database error",f.message)}}return(f,d)=>{const I=ie("icon");return p(),h(e(he),{title:"New column",width:720,open:t.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:V},{extra:a(()=>[n(e(ve),null,{default:a(()=>[n(e(R),{onClick:V},{default:a(()=>[E("Cancel")]),_:1}),n(e(R),{type:"primary",onClick:L},{default:a(()=>[E("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(be),{model:i.value,layout:"vertical"},{default:a(()=>[n(e(N),{key:"name",label:"Name",required:"","validate-status":U.value.status,help:U.value.help},{default:a(()=>[n(e(G),{value:i.value.name,"onUpdate:value":d[0]||(d[0]=D=>i.value.name=D)},null,8,["value"])]),_:1},8,["validate-status","help"]),n(e(N),{key:"type",label:"Type",required:""},{default:a(()=>[n(e(Te),{options:z.value,"load-data":B,"display-render":S,"allow-clear":!1,onChange:b},null,8,["options"])]),_:1}),n(e(N),{key:"default-value",label:"Default value","validate-status":y.value.status,help:y.value.message},{default:a(()=>[n(e(G),{value:i.value.default,"onUpdate:value":d[1]||(d[1]=D=>i.value.default=D),onInput:K},{suffix:a(()=>[y.value.fakeLoading?(p(),h(e(Ae),{key:0})):A("",!0),!y.value.fakeLoading&&y.value.status==="success"?(p(),h(I,{key:1,path:e(Ue),width:"18",height:"18"},null,8,["path"])):A("",!0),!y.value.fakeLoading&&y.value.status==="error"?(p(),h(I,{key:2,path:e(Ne),width:"18",height:"18"},null,8,["path"])):A("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),n(e(N),{key:"nullable",label:"Nullable"},{default:a(()=>[n(e(te),{checked:i.value.nullable,"onUpdate:checked":d[2]||(d[2]=D=>i.value.nullable=D)},null,8,["checked"])]),_:1}),n(e(N),{key:"unique",label:"Unique"},{default:a(()=>[n(e(te),{checked:i.value.unique,"onUpdate:checked":d[3]||(d[3]=D=>i.value.unique=D)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),ht={class:"twin-container"},kt={class:"fullwidth-input"},_t={class:"fullwidth-input"},Ct={class:"using-container"},wt={class:"fullwidth-input"},Dt=re({__name:"UpdateColumn",props:{open:{type:Boolean},table:{},column:{}},emits:["updated","cancel"],setup(m,{emit:s}){const t=m,g=se().params.projectId,T=x(t.column.record.initialState.type);Fe(async()=>{if(!t.column.foreignKey)return;T.value="loading...";const l=await Z.fromColumnId(g,t.column.foreignKey.columnId),u=l.getColumn(t.column.foreignKey.columnId);T.value=`reference to ${l.name}(${u.name})`});const U=q(()=>{var l;return((l=t.table)==null?void 0:l.getColumns().map(u=>u.record.initialState.name))||[]}),w=q(()=>t.column.name===t.column.record.initialState.name?{status:"",help:""}:je(t.column.name,U.value)),{result:i,loading:J}=ye(async()=>t.table.select({},10,0).then(({total:l})=>l));function z(){t.column.record.resetChanges(),s("cancel")}const b=x({status:"success",message:"",fakeLoading:!1}),S=()=>{b.value.fakeLoading=!0,j()},j=ee.exports.debounce(async()=>{if(!t.column.default){b.value.status="success",b.value.message="",b.value.fakeLoading=!1;return}const l=`select (${t.column.default})::${t.column.type} `,u=await ge.executeQuery(g,l,[]);b.value.status=u.errors.length>0?"error":"success",b.value.message=u.errors[0]||"",b.value.fakeLoading=!1},500),y=x([{value:"reference",label:"reference",isLeaf:!1},...Ee.map(l=>({value:l,label:l,isLeaf:!0}))]),K=l=>{if(!l)return;const u=l[l.length-1];switch(l.length){case 0:return;case 1:u.loading=!0,Z.list(g).then(v=>{u.children=v.map(k=>({value:k.id,label:k.name,isLeaf:!1})),u.loading=!1});return;case 2:u.loading=!0,Z.get(g,u.value).then(v=>{u.children=v.getColumns().map(k=>({type:k.type,value:k.id,label:k.name,isLeaf:!0})),u.loading=!1});return}},ae=l=>{const u=l.selectedOptions;return u?u.length===1?u[0].label:u.length===3?`reference to ${u[1].label}(${u[2].label})`:"":"Select type"},X=(l,u)=>{if(!!l){if(l.length===1){t.column.type=l[0],t.column.foreignKey=null;return}if(l.length===3){if(t.column.foreignKey&&t.column.foreignKey.columnId===l[2])return;const v=u[u.length-1];t.column.type=v.type,t.column.foreignKey={columnId:v.value}}}},V=()=>i.value===0||J.value?!1:t.column.record.hasChangesDeep("type"),L=x({type:"default"}),f=()=>{t.column.type=t.column.record.initialState.type,L.value={type:"default"}};function d(l,u){return u==="varchar"||l==="int"&&u==="boolean"||l==="boolean"&&u==="int"}me(()=>t.column.type,()=>{S(),D.value||(L.value={type:"user-defined",using:Q.value,mandatory:!0})});const D=q(()=>L.value.type==="default"&&d(t.column.record.initialState.type,t.column.type)),ne=q(()=>!d(t.column.record.initialState.type,t.column.type));function le(l){l?L.value={type:"default"}:L.value={type:"user-defined",using:Q.value,mandatory:!1}}function de(l){if(L.value.type==="default")throw new Error("Can't change using when using default casting");L.value.using=l!=null?l:""}const H=()=>ne.value?!0:V()&&L.value.type==="user-defined",Q=q(()=>`${t.column.record.initialState.name}::${t.column.type}`);async function ce(){if(!t.column)return;let l=L.value.type==="default"?Q.value:L.value.using;i.value===0&&(l=`${t.column.name}::text::${t.column.type}`);try{await t.column.update(l),s("updated")}catch(u){u instanceof Error&&ue("Database error",u.message)}}return(l,u)=>{const v=ie("icon");return p(),h(e(he),{title:"Edit column",width:720,open:l.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:z},{extra:a(()=>[n(e(ve),null,{default:a(()=>[n(e(R),{onClick:z},{default:a(()=>[E("Cancel")]),_:1}),n(e(R),{type:"primary",onClick:ce},{default:a(()=>[E("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(be),{model:l.column,layout:"vertical"},{default:a(()=>[n(e(N),{key:"name",label:"Name","validate-status":w.value.status,help:w.value.help},{default:a(()=>[n(e(G),{value:l.column.name,"onUpdate:value":u[0]||(u[0]=k=>l.column.name=k)},null,8,["value"])]),_:1},8,["validate-status","help"]),F("div",ht,[F("span",kt,[n(e(N),{key:"type",label:"Current Type"},{default:a(()=>[n(e(Ke),{value:T.value,"onUpdate:value":u[1]||(u[1]=k=>T.value=k),"default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),n(v,{class:"right-arrow",path:e(nt)},null,8,["path"]),F("span",_t,[n(e(N),{key:"new-type",label:"New Type"},{default:a(()=>[n(e(Te),{options:y.value,"load-data":K,"display-render":ae,"allow-clear":!0,onClear:f,onChange:X},null,8,["options"])]),_:1})])]),n(e(N),{key:"default-value",label:"Default value","validate-status":b.value.status,help:b.value.message},{default:a(()=>[n(e(G),{value:l.column.default,"onUpdate:value":u[2]||(u[2]=k=>l.column.default=k),onInput:S},{suffix:a(()=>[b.value.fakeLoading?(p(),h(e(Ae),{key:0,size:"small"})):A("",!0),!b.value.fakeLoading&&b.value.status==="success"?(p(),h(v,{key:1,path:e(Ue),width:"18",height:"18"},null,8,["path"])):A("",!0),!b.value.fakeLoading&&b.value.status==="error"?(p(),h(v,{key:2,path:e(Ne),width:"18",height:"18"},null,8,["path"])):A("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),F("div",Ct,[V()?(p(),h(e(N),{key:"default-casting",label:"Use default casting"},{default:a(()=>[n(e(te),{checked:D.value,disabled:ne.value,"onUpdate:checked":u[3]||(u[3]=k=>le(!!k))},null,8,["checked","disabled"])]),_:1})):A("",!0),F("span",wt,[V()?(p(),h(e(N),{key:"using",label:"Using"},{default:a(()=>[n(e(G),{value:L.value.type==="user-defined"?L.value.using:Q.value,disabled:!H(),onInput:u[4]||(u[4]=k=>de(k.target.value))},null,8,["value","disabled"])]),_:1})):A("",!0)])]),n(e(N),{key:"nullable",label:"Nullable"},{default:a(()=>[n(e(te),{checked:l.column.nullable,"onUpdate:checked":u[5]||(u[5]=k=>l.column.nullable=k)},null,8,["checked"])]),_:1}),n(e(N),{key:"unique",label:"Unique"},{default:a(()=>[n(e(te),{checked:l.column.unique,"onUpdate:checked":u[6]||(u[6]=k=>l.column.unique=k)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}});const St=Le(Dt,[["__scopeId","data-v-d14cbe65"]]),It={class:"table-data",style:{width:"calc(100% - 120px)"}},Ot={style:{overflow:"hidden","white-space":"wrap"}},At={key:1},Lt={key:1},$t={key:1},xt=["onClick"],Et=F("a",null,"Delete",-1),Ut=re({__name:"TableData",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(m,{emit:s}){var Ce;const t=m,C=x(1),g=x(10),T=q(()=>{var o,c;return{total:(c=(o=f.value)==null?void 0:o.total)!=null?c:0,current:C.value,pageSize:g.value,totalBoundaryShowSizeChanger:10,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],onChange:async(_,r)=>{C.value=_,g.value=r,await I()}}}),U=se(),w=$e(),i=x(typeof U.query.q=="string"?U.query.q:""),J=q(()=>{try{return JSON.parse(U.params.where)}catch{return{}}});me(i,()=>{w.replace({query:{...U.query,where:JSON.stringify(U.query.value),q:i.value}})});const z=x(!1),B=x({type:"idle"}),b=()=>{z.value=!0,S()},S=ee.exports.debounce(()=>{I(),z.value=!1},500);function j(){B.value={type:"idle"}}async function y(){j(),s("refresh"),await I(),Q()}function K(){B.value={type:"creating"}}const ae=o=>{if(!t.table)throw new Error("Table not found");B.value={type:"editing",column:t.table.getColumn(o)}};async function X(o){await ut("Are you sure you want to delete this column?")&&await V(o)}async function V(o){var c,_;await((_=(c=t.table)==null?void 0:c.getColumn(o))==null?void 0:_.delete()),s("refresh"),await I(),Q()}const L=q(()=>{var o;return((o=f.value)==null?void 0:o.rows.length)===1}),{result:f,loading:d,refetch:I}=ye(()=>Promise.all([t.table.select(J,(C.value-1)*g.value,g.value,i.value),Promise.all(t.table.getColumns().filter(o=>o.foreignKey).map(o=>Z.fromColumnId(U.params.projectId,o.foreignKey.columnId).then(c=>[o.name,c])))]).then(([{rows:o,total:c},_])=>({rows:o,total:c,columns:_.reduce((r,[$,P])=>({...r,[$]:P}),{})}))),D=(o,c)=>{var P,O;const _=(P=t.table)==null?void 0:P.getColumns().find(M=>M.name===o);if(!_)return"";const r=(O=f.value)==null?void 0:O.columns[_.name],$=r==null?void 0:r.getColumns().find(M=>{var we;return M.id===((we=_.foreignKey)==null?void 0:we.columnId)});return!r||!$?"":{name:"tableEditor",params:{projectId:U.params.projectId,tableId:r.id},query:{where:JSON.stringify({[$.name]:c})}}},ne=(o,c)=>_=>{if(o==="json"&&_==""){v.value[c]="null";return}v.value[c]=_},le=()=>[...t.table.getColumns().map(o=>{var c;return{key:(c=o.id)!=null?c:"",title:o.name,dataIndex:o.name,width:220,resizable:!0,ellipsis:!1}}),{key:"action",title:"",fixed:"right",width:100,align:"center",resizable:!1,ellipsis:!1}],de=le(),H=x(de),Q=()=>H.value=le();function ce(o,c){H.value=H.value.map(_=>_.key===c.key?{..._,width:o}:_)}const l=q(()=>{var o;return((o=f.value)==null?void 0:o.rows.map(c=>({key:c.id,...c})))||[]}),u=x(!1),v=x({}),k=()=>{u.value=!0},fe=()=>{v.value={},u.value=!1};let qe=Me((Ce=t.table)==null?void 0:Ce.getUnprotectedColumns().reduce((o,c)=>({...o,[c.name]:""}),{}));async function ze(){if(!(!t.table||!qe))try{v.value.id?await t.table.updateRow(v.value.id,v.value):await t.table.insertRow(v.value),v.value={},I(),fe()}catch(o){o instanceof Error&&ue("Database error",o.message)}}const Be=async o=>{if(!(!f.value||!f.value.rows.find(c=>c.id===o)))try{await t.table.deleteRow(o),L.value&&(C.value=Math.max(1,C.value-1)),I()}catch(c){c instanceof Error&&ue("Database error",c.message)}},Pe=o=>{var P;const c=(P=l.value)==null?void 0:P.filter(O=>o===O.key)[0],_=t.table.getColumns(),r=_.map(O=>O.name),$=_.filter(O=>O.type==="json").map(O=>O.name);v.value=ee.exports.pick(ee.exports.cloneDeep(c),r),$.forEach(O=>{v.value[O]&&(v.value[O]=JSON.stringify(v.value[O]))}),k()};return(o,c)=>{const _=ie("router-link");return p(),Y("div",It,[n(e(oe),{justify:"space-between",style:{"margin-bottom":"16px"},gap:"middle"},{default:a(()=>[n(e(G),{value:i.value,"onUpdate:value":[c[0]||(c[0]=r=>i.value=r),b],placeholder:"Search",style:{width:"400px"},"allow-clear":""},{prefix:a(()=>[n(e(Je))]),suffix:a(()=>[z.value?(p(),h(e(rt),{key:0})):A("",!0)]),_:1},8,["value"]),n(e(R),{type:"primary",onClick:K},{default:a(()=>[E("+ Add new column")]),_:1})]),_:1}),n(e(Ye),{columns:H.value,"data-source":l.value,pagination:T.value,bordered:"",loading:e(d)||o.loading,scroll:{x:1e3,y:720},size:"small",onResizeColumn:ce},{headerCell:a(({column:r})=>[r.title!=="id"&&r.title!=="created_at"&&r.key!=="action"?(p(),h(e(oe),{key:0,align:"center",justify:"space-between",gap:"small"},{default:a(()=>[F("span",Ot,W(r.title),1),n(e(Ve),{placement:"bottomRight",trigger:"click"},{overlay:a(()=>[n(e(He),null,{default:a(()=>[n(e(De),{onClick:$=>ae(String(r.key))},{icon:a(()=>[n(e(gt))]),default:a(()=>[E(" Edit ")]),_:2},1032,["onClick"]),n(e(De),{danger:"",onClick:$=>X(String(r.key))},{icon:a(()=>[n(e(st))]),default:a(()=>[E(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(e(vt))]),_:2},1024)]),_:2},1024)):(p(),Y("span",At,W(r.title),1))]),bodyCell:a(({column:r,text:$,record:P})=>{var O;return[H.value.map(M=>M.title).includes(r.dataIndex)?(p(),Y(pe,{key:0},[(O=o.table.getColumns().find(M=>M.name===r.dataIndex))!=null&&O.foreignKey?(p(),h(_,{key:0,to:D(r.dataIndex,$),target:"_blank"},{default:a(()=>[E(W($),1)]),_:2},1032,["to"])):(p(),Y("span",Lt,W($),1))],64)):A("",!0),r.key==="action"?(p(),Y("div",$t,[F("span",null,[F("a",{onClick:M=>Pe(P.id)},"Edit",8,xt)]),n(e(it),{type:"vertical"}),n(e(Ge),{title:"Sure to delete?",onConfirm:M=>Be(P.id)},{default:a(()=>[Et]),_:2},1032,["onConfirm"])])):A("",!0)]}),footer:a(()=>[H.value.length===3?(p(),h(e(Qe),{key:0,title:"Add a first column prior to data entry",placement:"right"},{default:a(()=>[n(e(R),{type:"primary",disabled:!0,onClick:k},{default:a(()=>[E(" + Add New Data ")]),_:1})]),_:1})):(p(),h(e(R),{key:1,type:"primary",onClick:k},{default:a(()=>[E("+ Add New Data")]),_:1}))]),_:1},8,["columns","data-source","pagination","loading"]),n(e(he),{title:"Data",width:720,open:u.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:fe},{extra:a(()=>[n(e(ve),null,{default:a(()=>[n(e(R),{onClick:fe},{default:a(()=>[E("Cancel")]),_:1}),n(e(R),{type:"primary",onClick:ze},{default:a(()=>[E("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(be),{model:v.value,layout:"vertical"},{default:a(()=>[(p(!0),Y(pe,null,xe(o.table.getUnprotectedColumns(),r=>(p(),h(e(N),{key:r.id,label:r.name,required:!r.nullable},{default:a(()=>[v.value?(p(),h(e(G),{key:0,placeholder:r.type,value:v.value[r.name],disabled:v.value[r.name]===null,"onUpdate:value":$=>ne(r.type,r.name)($)},Ze({_:2},[r.nullable?{name:"addonAfter",fn:a(()=>[n(e(We),{checked:v.value[r.name]===null,"onUpdate:checked":$=>v.value[r.name]=$?null:""},{default:a(()=>[E(" NULL ")]),_:2},1032,["checked","onUpdate:checked"])]),key:"0"}:void 0]),1032,["placeholder","value","disabled","onUpdate:value"])):A("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])]),_:1},8,["open"]),o.table&&B.value.type==="creating"?(p(),h(bt,{key:0,open:"",table:t.table,onClose:j,onCancel:j,onCreated:y},null,8,["table"])):A("",!0),o.table&&B.value.type==="editing"?(p(),h(St,{key:1,column:B.value.column,open:"",table:o.table,onUpdated:y,onClose:j,onCancel:j},null,8,["column","table"])):A("",!0)])}}});const Nt={style:{"font-size":"20px"}},Tt=re({__name:"TableEditor",setup(m){const s=$e(),t=se(),C=t.params.tableId,g=t.params.projectId,T=x(!1),U=()=>{var b;T.value=!1,(b=w.value)==null||b.table.save(),J()},{result:w,loading:i,refetch:J}=ye(()=>Promise.all([ge.get(g).then(async b=>{const S=await dt.get(b.organizationId);return{project:b,organization:S}}),Z.get(g,C)]).then(([{project:b,organization:S},j])=>Xe({project:b,organization:S,table:j}))),z=q(()=>!i.value&&w.value?[{label:"My organizations",path:"/organizations"},{label:w.value.organization.name,path:`/organizations/${w.value.organization.id}`},{label:w.value.project.name,path:`/projects/${w.value.project.id}/tables`}]:void 0);function B(){s.push({name:"tables",params:{projectId:g}})}return(b,S)=>{const j=ie("router-link");return p(),h(at,null,{navbar:a(()=>[n(e(pt),{style:{padding:"5px 25px"},onBack:B},{title:a(()=>[T.value?(p(),h(e(oe),{key:1,align:"center",gap:"large"},{default:a(()=>[e(w)?(p(),h(e(G),{key:0,value:e(w).table.name,"onUpdate:value":S[1]||(S[1]=y=>e(w).table.name=y),class:"borderless-input"},null,8,["value"])):A("",!0),n(e(R),{onClick:U},{default:a(()=>[E("Save")]),_:1})]),_:1})):(p(),h(e(oe),{key:0,align:"center",gap:"small"},{default:a(()=>{var y;return[F("span",Nt,W((y=e(w))==null?void 0:y.table.name),1),n(et,{path:e(lt),width:"22",style:{cursor:"pointer"},onClick:S[0]||(S[0]=K=>T.value=!0)},null,8,["path"])]}),_:1}))]),breadcrumb:a(()=>[z.value?(p(),h(e(ct),{key:0},{default:a(()=>[(p(!0),Y(pe,null,xe(z.value,(y,K)=>(p(),h(e(ft),{key:K},{default:a(()=>[n(j,{to:y.path},{default:a(()=>[E(W(y.label),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):A("",!0)]),_:1})]),content:a(()=>[e(w)?(p(),h(Ut,{key:0,loading:e(i),table:e(w).table,onRefresh:S[2]||(S[2]=y=>e(J)())},null,8,["loading","table"])):A("",!0)]),_:1})}}});const va=Le(Tt,[["__scopeId","data-v-594196a3"]]);export{va as default};
//# sourceMappingURL=TableEditor.9a2510a6.js.map

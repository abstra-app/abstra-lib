import{N as ue}from"./Navbar-BOpCPCWb.js";import{a as O}from"./asyncComputed-B7wN3TEJ.js";import{m as ce}from"./url-Bpnhj1_P.js";import{a as pe,r as A,c as _,ag as fe,k as N,f as o,h as s,m as ge,b as d,u as a,b4 as $,w as n,e as c,ak as _e,g as f,t as g,i,b5 as v,b6 as P,b7 as y,b8 as m,Q as F,Z as x,b3 as K,b9 as ve,B as ye,ba as me,aK as we}from"./jwt-decode.esm-BicT5bVN.js";import{A as ze}from"./apiKey-B3uDWQ7C.js";import{b as G}from"./router-DgySwpZX.js";import{M as Ie}from"./member-DKWTebg8.js";import{a as be}from"./organization-DLs7Xqs9.js";import{a as je}from"./project-OkOOskHh.js";import"./tables-Dghgxh0i.js";import{F as he}from"./folder-B9kqNglc.js";import"./logo-BiWG9_W5.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang-BIjGauJ1.js";import"./constants-DWbxCu8u.js";import"./PhNotePencil.vue-DC7QVlFn.js";import"./PhTranslate.vue-DzvQPGyh.js";import"./PhSignOut.vue-De9yApdF.js";import"./index-DZ7gB_3o.js";import"./index-DbHHXRkZ.js";import"./organizationSwitcher-Nao_35DK.js";import"./PhPlus.vue-CxZ8YRJU.js";import"./omniChatStore-BHaCEeok.js";import"./record-B4usCteB.js";import"./uuid-BKqSea82.js";import"./PhCopySimple.vue-YKsltp8X.js";import"./PhSparkle.vue-Dozz7bpr.js";import"./index-Z1CTzTd9.js";import"./ts.worker-B2ibprJy.js";import"./string-Bb5jOs6Z.js";(function(){try{var w=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new Error().stack;p&&(w._sentryDebugIds=w._sentryDebugIds||{},w._sentryDebugIds[p]="a1f382d2-def7-44a2-9ac5-8b1962006f35",w._sentryDebugIdIdentifier="sentry-dbid-a1f382d2-def7-44a2-9ac5-8b1962006f35")}catch{}})();const ke={class:"container"},Ne={class:"content"},E="NEW_ORGANIZATION_KEY",M="NEW_FOLDER_KEY",C="NEW_PROJECT_KEY",Ee=pe({__name:"EditorLogin",setup(w){const p=new he,S=new be,z=new je,D=new Ie,Z=G.getAuthor()?.claims.email,{result:R,loading:q}=O(async()=>{const t=await S.list();return W(t.length>0?t[0].id:E),t}),{result:I,loading:b,refetch:U}=O(async()=>e.value.type==="loading-organizations"||e.value.type==="new-organization"?[]:z.list(e.value.organizationId)),{result:L,loading:V,refetch:Q}=O(async()=>e.value.type==="loading-organizations"||e.value.type==="new-organization"?[]:p.list(e.value.organizationId)),B=_(()=>R.value?.map(t=>({key:t.id,label:t.name}))??[]),J=_(()=>I.value?I.value.filter(t=>{switch(e.value.type){case"new-project":return t.folderId===e.value.folderId;case"selected-project":return t.folderId===e.value.folderId;case"loading-folder":return t.folderId===e.value.folderId;default:return!1}}).map(t=>({key:t.id,label:t.name})):[]),T=_(()=>L.value?.map(t=>({value:t.id,label:t.name}))??[]),H=_(()=>{switch(e.value.type){case"new-organization":return!e.value.organizationName;case"new-folder":return!e.value.folderName;case"new-project":return!e.value.projectName||!e.value.folderId;case"selected-project":return!1;case"loading-organization":case"loading-folder":return!0;default:throw new Error(`Invalid state ${JSON.stringify(e.value)}`)}}),j=async t=>await ze.create({projectId:t,name:"default"}),e=A({type:"loading-organizations"}),X=_(()=>e.value.type==="new-organization"||e.value.type==="loading-organizations"?E:e.value.organizationId),ee=_(()=>{if(e.value.type==="new-organization"||e.value.type==="new-folder"||e.value.type==="new-project"||e.value.type==="loading-organization"||e.value.type==="loading-folder"||e.value.type==="loading-organizations")return C;if(e.value.type==="selected-project")return e.value.projectId;throw new Error(`Invalid state ${JSON.stringify(e.value)}`)}),ae=_(()=>e.value.type==="new-project"||e.value.type==="selected-project"?e.value.folderId:M);function te(t){return t.split("@")[1].split(".")[0]}async function W(t){if(t===E)e.value={type:"new-organization",organizationName:te(G.getAuthor().claims.email),folderName:"My team folder",projectName:"My project"};else{e.value={type:"loading-organization",organizationId:String(t)},await Promise.all([U(),Q()]);const l=L.value?.find(u=>u.organizationId===String(t)),r=I.value?.find(u=>u.folderId===l?.id);l?r?e.value={type:"selected-project",organizationId:String(t),folderId:l.id,projectId:r.id}:e.value={type:"new-project",organizationId:String(t),folderId:l.id,projectName:"My project"}:e.value={type:"new-folder",organizationId:String(t),folderName:"My team folder",projectName:"My project"}}}function re(t){if(e.value.type==="new-organization"||e.value.type==="new-folder"||e.value.type==="loading-organization"||e.value.type==="loading-folder"||e.value.type==="loading-organizations")throw new Error(`Invalid state ${JSON.stringify(e.value)}`);t===C?e.value={type:"new-project",organizationId:e.value.organizationId,folderId:e.value.folderId,projectName:"New project"}:e.value={type:"selected-project",organizationId:e.value.organizationId,folderId:e.value.folderId,projectId:String(t)}}async function le(t){if(e.value.type==="new-organization"||e.value.type==="loading-organizations")throw new Error(`Invalid state ${JSON.stringify(e.value)}`);if(t===M)e.value={type:"new-folder",organizationId:e.value.organizationId,folderName:"New folder",projectName:"New project"};else{e.value={type:"loading-folder",organizationId:e.value.organizationId,folderId:String(t)},await U();const l=I.value?.find(r=>r.folderId===String(t));l?e.value={type:"selected-project",organizationId:e.value.organizationId,folderId:String(t),projectId:l.id}:e.value={type:"new-project",organizationId:e.value.organizationId,folderId:String(t),projectName:"New project"}}}async function ne(t){const r=(await D.list(t)).find(u=>u.email===Z);if(!r)throw new Error("Member not found");return r.id}async function oe(t){const l=await D.list(t);return(await p.list(t)).length===0&&await p.create({name:"Default Folder",organizationId:t,memberIds:[...l.map(se=>se.id)]}),(await p.list(t))[0]}const h=A(!1);async function ie(){if(!h.value){h.value=!0;try{if(e.value.type==="new-organization"){const t=await S.create({name:e.value.organizationName}),l=await oe(t.id),r=await z.create({name:e.value.projectName,organizationId:t.id,folderId:l.id}),u=await j(r.id);u.value&&k(u.value)}else if(e.value.type==="new-folder"){const t=await ne(e.value.organizationId),l=await p.create({name:e.value.folderName,organizationId:e.value.organizationId,memberIds:[t]}),r=await z.create({name:e.value.projectName,organizationId:e.value.organizationId,folderId:l.id}),u=await j(r.id);u.value&&k(u.value)}else if(e.value.type==="new-project"){const t=await z.create({name:e.value.projectName,organizationId:e.value.organizationId,folderId:e.value.folderId}),l=await j(t.id);l.value&&k(l.value)}else if(e.value.type==="selected-project"){const t=await j(e.value.projectId);t.value&&k(t.value)}}finally{h.value=!1}}}const Y=fe(),de=A(null);async function k(t){if(Y.query.redirect){const l=Y.query.redirect;if(!l.match(/http:\/\/localhost:\d+/))throw new Error("Invalid redirect");const r=decodeURIComponent(l);location.href=ce(r,{"api-key":t})}else de.value=t}return(t,l)=>(o(),N("div",ke,[s(ue),ge("div",Ne,[a(q)||!a(R)?(o(),d(a($),{key:0})):(o(),d(a(me),{key:1,layout:"vertical",class:"card"},{default:n(()=>[s(a(_e),{level:3,style:{padding:"0px",margin:"0px","margin-bottom":"30px"}},{default:n(()=>[f(g(a(i).translate("i18n_create_or_choose_project")),1)]),_:1}),s(a(v),{label:a(i).translate("i18n_get_api_key_organization")},{default:n(()=>[s(a(P),{style:{width:"100%"},placeholder:a(i).translate("i18n_get_api_key_choose_organization"),size:"large",value:X.value,"onUpdate:value":W},{default:n(()=>[s(a(y),{label:a(i).translate("i18n_get_api_key_new_organization")},{default:n(()=>[(o(),d(a(m),{key:E},{default:n(()=>[f(g(a(i).translate("i18n_get_api_key_create_new_organization")),1)]),_:1}))]),_:1},8,["label"]),B.value.length>0?(o(),d(a(y),{key:0,label:a(i).translate("i18n_get_api_key_existing_organizations")},{default:n(()=>[(o(!0),N(F,null,x(B.value,r=>(o(),d(a(m),{key:r.key},{default:n(()=>[f(g(r.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):c("",!0)]),_:1},8,["placeholder","value"])]),_:1},8,["label"]),e.value.type=="new-organization"?(o(),d(a(v),{key:0,label:a(i).translate("i18n_get_api_key_organization_name")},{default:n(()=>[s(a(K),{value:e.value.organizationName,"onUpdate:value":l[0]||(l[0]=r=>e.value.organizationName=r),placeholder:a(i).translate("i18n_get_api_key_choose_organization_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):c("",!0),e.value.type!=="new-organization"?(o(),d(a(v),{key:1,label:a(i).translate("i18n_get_api_key_folder")},{default:n(()=>[s(a(P),{disabled:a(V),value:ae.value,loading:a(V),size:"large","onUpdate:value":le},{default:n(()=>[s(a(y),{label:a(i).translate("i18n_get_api_key_new_folder")},{default:n(()=>[(o(),d(a(m),{key:M},{default:n(()=>[f(g(a(i).translate("i18n_get_api_key_create_new_folder")),1)]),_:1}))]),_:1},8,["label"]),T.value.length>0?(o(),d(a(y),{key:0,label:a(i).translate("i18n_get_api_key_existing_folders")},{default:n(()=>[(o(!0),N(F,null,x(T.value,r=>(o(),d(a(m),{key:r.value},{default:n(()=>[f(g(r.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):c("",!0)]),_:1},8,["disabled","value","loading"])]),_:1},8,["label"])):c("",!0),e.value.type==="new-organization"||e.value.type==="new-folder"?(o(),d(a(v),{key:2,label:a(i).translate("i18n_get_api_key_folder_name")},{default:n(()=>[s(a(K),{value:e.value.folderName,"onUpdate:value":l[1]||(l[1]=r=>e.value.folderName=r),placeholder:a(i).translate("i18n_get_api_key_choose_folder_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):c("",!0),e.value.type!=="new-organization"&&e.value.type!=="new-folder"?(o(),d(a(v),{key:3,label:a(i).translate("i18n_get_api_key_project")},{default:n(()=>[s(a(P),{style:{width:"100%"},disabled:a(b),placeholder:a(i).translate("i18n_get_api_key_choose_project"),size:"large",value:ee.value,"onUpdate:value":re},ve({default:n(()=>[a(b)?c("",!0):(o(),d(a(y),{key:0,label:a(i).translate("i18n_get_api_key_new_project")},{default:n(()=>[(o(),d(a(m),{key:C},{default:n(()=>[f(g(a(i).translate("i18n_get_api_key_create_new_project")),1)]),_:1}))]),_:1},8,["label"])),J.value.length>0&&!a(b)?(o(),d(a(y),{key:1,label:a(i).translate("i18n_get_api_key_existing_projects")},{default:n(()=>[(o(!0),N(F,null,x(J.value,r=>(o(),d(a(m),{key:r.key},{default:n(()=>[f(g(r.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):c("",!0)]),_:2},[a(b)?{name:"notFoundContent",fn:n(()=>[s(a($),{size:"small"})]),key:"0"}:void 0]),1032,["disabled","placeholder","value"])]),_:1},8,["label"])):c("",!0),e.value.type==="new-organization"||e.value.type==="new-folder"||e.value.type==="new-project"?(o(),d(a(v),{key:4,label:"Project name"},{default:n(()=>[s(a(K),{value:e.value.projectName,"onUpdate:value":l[2]||(l[2]=r=>e.value.projectName=r),placeholder:a(i).translate("i18n_get_api_key_choose_project_name"),size:"large"},null,8,["value","placeholder"])]),_:1})):c("",!0),s(a(v),{style:{"margin-top":"40px"}},{default:n(()=>[s(a(ye),{type:"primary",disabled:H.value,loading:h.value,style:{width:"100%"},onClick:ie},{default:n(()=>[f(g(a(i).translate("i18n_login_with_this_project")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))])]))}}),ra=we(Ee,[["__scopeId","data-v-cafd5a5e"]]);export{ra as default};
//# sourceMappingURL=EditorLogin-1GUel7Bo.js.map

import{B as I}from"./BaseLayout.2eb77e5e.js";import{R as N,S as D,E as P,a as $,b as M,L as W}from"./SmartChat.12b60eb6.js";import{L as F}from"./tasksController.a7392939.js";import{d as B,e as k,o as d,c as f,w as o,b as s,u as e,bL as U,cB as A,cA as E,f as L,Y as O,aB as z,eo as H,ea as V,eg as q,z as J,S as b,bT as K,eM as Y,cO as j}from"./index.73a38d81.js";import{a as G}from"./asyncComputed.c6319089.js";import"./linters.19a229f9.js";import{S as Q}from"./scripts.345756e7.js";import{W as X}from"./workspaces.d6292660.js";import{_ as Z}from"./RunButton.vue_vue_type_script_setup_true_lang.4561320c.js";import{T as ee}from"./TasksManager.1b0c87d8.js";import{N as te}from"./NavbarControls.f99c5e32.js";import{b as se}from"./index.1d99cd36.js";import{A as T,T as ae}from"./TabPane.5f6856ea.js";import"./validations.aa32a170.js";import"./string.ead22143.js";import"./editor.a961dd5c.js";import"./workspaceStore.9a1cf89e.js";import"./url.9bc6af1d.js";import"./colorHelpers.2f665bfc.js";import"./uuid.8c8c77c5.js";import"./PhCaretRight.vue.cd4f7433.js";import"./Badge.c734bd0c.js";import"./LoadingOutlined.70a572c4.js";import"./SaveButton.30165a8c.js";import"./UnsavedChangesHandler.186eda01.js";import"./ExclamationCircleOutlined.670eff0a.js";import"./polling.b4e09b79.js";import"./PhFolder.vue.f61e1a65.js";import"./PhPencil.vue.e94c1cbe.js";import"./toggleHighContrast.e2e5f044.js";import"./index.78e04c78.js";import"./Card.f9ea02bd.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.30c7ded0.js";import"./Logo.20f38e81.js";import"./ai.d3dc1da1.js";import"./PhCheckCircle.vue.40ecb9b7.js";import"./PhCopySimple.vue.ec2f2118.js";import"./Avatar.b56b94ed.js";import"./gateway.e9e7eb7d.js";import"./popupNotifcation.3e5ffef1.js";import"./record.0e492bf3.js";import"./ant-design.dfa6c76d.js";import"./PhArrowSquareOut.vue.86b1b3ba.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.aa101f2b.js";import"./index.c30ceca6.js";import"./CollapsePanel.5b52b88b.js";import"./index.904b936f.js";import"./index.2d36535b.js";import"./CloseCircleOutlined.f621b712.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.14bb05c7.js";import"./BookOutlined.0a5325b1.js";import"./PhChats.vue.0ddbb468.js";import"./index.6a44bd55.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[v]="ddb6a4e5-3e16-44c2-8c40-9e8efa920cc0",u._sentryDebugIdIdentifier="sentry-dbid-ddb6a4e5-3e16-44c2-8c40-9e8efa920cc0")}catch{}})();const re=B({__name:"ScriptSettings",props:{script:{}},setup(u){const i=k(u.script);return(S,n)=>(d(),f(e(E),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:o(()=>[s(e(A),{label:"Name",required:""},{default:o(()=>[s(e(U),{value:i.value.title,"onUpdate:value":n[0]||(n[0]=y=>i.value.title=y)},null,8,["value"])]),_:1}),s(N,{runtime:i.value},null,8,["runtime"])]),_:1}))}}),oe={style:{width:"100%",display:"flex","flex-direction":"column"}},ie=B({__name:"ScriptTester",props:{script:{},disabledWarning:{},tasks:{}},emits:["refetch-tasks"],setup(u,{emit:v}){const i=u,S=L(()=>{var c,p;return(p=(c=i.tasks)==null?void 0:c.map(m=>{const x=m.payload,g=JSON.stringify(x,null,2),t=g.length>80?g.slice(0,80)+"...":g,h=new Date(m.created.at).toLocaleString();return{label:`${t} - ${h}`,value:m.id}}))!=null?p:[]}),n=k(void 0),y=L(()=>n.value?null:{title:"No trigger task selected",message:"Please select the task that will trigger the script"}),w=k(!1),l=async()=>{var c;w.value=!0;try{await i.script.run((c=n.value)!=null?c:null)}finally{w.value=!1,n.value=void 0,v("refetch-tasks",i.script.id)}};return(c,p)=>(d(),O("div",oe,[s(e(E),{layout:"vertical",style:{overflow:"auto"}},{default:o(()=>[s(e(A),{label:"Trigger task"},{default:o(()=>[s(e(z),{options:S.value,value:n.value,onSelect:p[0]||(p[0]=m=>n.value=m)},null,8,["options","value"])]),_:1})]),_:1}),s(Z,{loading:w.value,disabled:c.disabledWarning||y.value,onClick:l,onSave:p[1]||(p[1]=m=>c.script.save())},null,8,["loading","disabled"])]))}}),it=B({__name:"ScriptEditor",setup(u){const v=H(),i=V();function S(){v.push({name:"stages"})}const n=k(null),y=k(null),w=a=>{!t.value||(t.value.script.file=a)},l=k("source-code");function c(){var r;if(!t.value)return;const a=t.value.script.codeContent;(r=n.value)==null||r.updateLocalEditorCode(a)}const p=k(null),m=new F,x=L(()=>{var a;return(a=t.value)!=null&&a.script.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),g=async a=>{const r=await m.getStageTasks(a);p.value=r.tasks.filter(C=>C.status==="pending")},{result:t}=G(async()=>{const[a,r]=await Promise.all([X.get(),Q.get(i.params.id)]);return g(r.id),J({workspace:a,script:r})}),h=W.create(),_=a=>{var r;return a!==l.value&&((r=t.value)==null?void 0:r.script.hasChanges())};async function R(){var a,r;(a=y.value)==null||a.closeConsole();try{await((r=t.value)==null?void 0:r.script.save()),c(),l.value="test"}catch{j.error({message:"Error saving"})}}return(a,r)=>(d(),f(I,null,q({navbar:o(()=>[e(t)?(d(),f(e(se),{key:0,title:e(t).script.title,style:{padding:"5px 25px",border:"1px solid #f6f6f6"},onBack:S},{extra:o(()=>[s(te,{"editing-model":e(t).script},null,8,["editing-model"])]),_:1},8,["title"])):b("",!0)]),content:o(()=>[e(t)?(d(),f(P,{key:0},{left:o(()=>[s(e(ae),{"active-key":l.value,"onUpdate:activeKey":r[0]||(r[0]=C=>l.value=C)},{rightExtra:o(()=>[s(e(K),{onClick:R},{default:o(()=>[s(e(Y),{size:"20"})]),_:1})]),default:o(()=>[s(e(T),{key:"source-code",tab:"Source code",disabled:_("source-code")},null,8,["disabled"]),s(e(T),{key:"test",tab:"Test",disabled:_("test")},null,8,["disabled"]),s(e(T),{key:"tasks",tab:"Tasks",disabled:_("tasks")},null,8,["disabled"]),s(e(T),{key:"settings",tab:"Settings",disabled:_("settings")},null,8,["disabled"])]),_:1},8,["active-key"]),l.value==="source-code"?(d(),f($,{key:0,script:e(t).script,workspace:e(t).workspace,onUpdateFile:w},null,8,["script","workspace"])):b("",!0),e(t).script&&l.value==="tasks"?(d(),f(ee,{key:1,ref:"tasksManager","stage-id":e(t).script.id,onRefetchTasks:g},null,8,["stage-id"])):b("",!0),e(t).script&&l.value==="test"?(d(),f(ie,{key:2,ref:"tester",script:e(t).script,"disabled-warning":x.value,tasks:p.value,onRefetchTasks:g},null,8,["script","disabled-warning","tasks"])):b("",!0),e(t).script&&l.value==="settings"?(d(),f(re,{key:3,script:e(t).script},null,8,["script"])):b("",!0)]),right:o(()=>[s(M,{"stage-type":"scripts",workspace:e(t).workspace,stage:e(t).script,"log-service":e(h)},null,8,["workspace","stage","log-service"])]),_:1})):b("",!0)]),_:2},[e(t)?{name:"footer",fn:o(()=>[s(D,{ref_key:"smartConsole",ref:y,"stage-type":"scripts",stage:e(t).script,"log-service":e(h),workspace:e(t).workspace},null,8,["stage","log-service","workspace"])]),key:"0"}:void 0]),1024))}});export{it as default};
//# sourceMappingURL=ScriptEditor.2c06f4d9.js.map

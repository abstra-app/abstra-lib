import{b as o,e6 as ge,eE as ye,d as O,f as I,g as C,c as y,w as a,u as e,o as p,cs as P,da as $,bK as _e,bs as we,K as M,ea as oe,bq as be,az as d,eb as x,aL as V,a as k,eF as ke,cx as Ce,cr as Y,d5 as N,F,cE as se,h as Se,d2 as Ae,cL as Fe,cH as D,d4 as E,cK as U,eG as Ie,eH as Te,Q as ne,bE as Q,aP as xe,bM as G,au as $e,cN as Oe,ek as Pe,e3 as Ne,d6 as je,d3 as De,c_ as Ee,ep as Ue}from"./index.79dc3613.js";import{C as Ge}from"./ContentLayout.3ecf07ec.js";import{C as Be}from"./CrudView.c7477f1b.js";import{a as Z}from"./ant-design.ac026d59.js";import{a as z}from"./asyncComputed.3aa6bfc4.js";import{c as He}from"./string.5e94f9fd.js";import{F as Le}from"./PhArrowSquareOut.vue.9d53934e.js";import{G as Me}from"./PhSparkle.vue.a26f57a4.js";import"./linters.a2a3c525.js";import{F as B,H,J as L,S as J}from"./scripts.d3d21022.js";import{W as le}from"./workspaces.9b8d8b61.js";import{A as re}from"./index.745c1115.js";import{c as Re,a as ie}from"./validations.6a3e760f.js";import{F as qe,G as We,I as ze,a as Je}from"./PhWebhooksLogo.vue.3b2d5a30.js";import{_ as ee}from"./DocsButton.vue_vue_type_script_setup_true_lang.0f78f6af.js";import"./router.885555f2.js";import"./Badge.2ec6bac1.js";import"./gateway.2413dea4.js";import"./popupNotifcation.31410171.js";import"./url.c29c9736.js";import"./PhDotsThreeVertical.vue.fa17ee5f.js";import"./index.989018db.js";import"./index.69b7eacf.js";import"./record.fadf5b09.js";import"./workspaceStore.527cc49d.js";import"./userStore.d0fdc011.js";import"./colorHelpers.473bf6ef.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new Error().stack;l&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[l]="3e12aa24-1945-4473-9c22-a67f341179b8",n._sentryDebugIdIdentifier="sentry-dbid-3e12aa24-1945-4473-9c22-a67f341179b8")}catch{}})();function te(n){for(var l=1;l<arguments.length;l++){var s=arguments[l]!=null?Object(arguments[l]):{},r=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(s).filter(function(u){return Object.getOwnPropertyDescriptor(s,u).enumerable}))),r.forEach(function(u){Ve(n,u,s[u])})}return n}function Ve(n,l,s){return l in n?Object.defineProperty(n,l,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[l]=s,n}var X=function(l,s){var r=te({},l,s.attrs);return o(ge,te({},r,{icon:ye}),null)};X.displayName="DownOutlined";X.inheritAttrs=!1;const Ye=X;class Xe{static async generateProject(l){const s=await fetch("/_editor/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:l})});if(!s.ok){const r=await s.text();throw new Error(r)}}}const Ke=O({__name:"AiPromptInput",props:{open:{type:Boolean}},emits:["close","close-and-refetch"],setup(n,{emit:l}){const s=I(""),r=I(!1),u=I(!1),v=C(()=>u.value?"Retry":r.value?"Generating":"Generate"),h=[{title:"Reimbursement approval",prompt:"Create a workflow that implements a reimbursement approval process. It starts with a user submitting a request in a form by inputing a file of the receipt. In the same form, use abstra.ai to get the company name and the amount of the receipt with the parameter format, and save those values in the thread. Then, there is an approval form, filled by me, that will get the data from the thread and I will check the amount and decide if I will approve or not the reinbursement."},{title:"Customer onboarding",prompt:'Do a workflow to implememt a customer onboarding process. It starts with the customer filling a form with some data from their company, like name and CNPJ. After that form, there is a script that generates the contract document using python-docx lib and the same script saves the generated document in persistent dir. Following that, there is an approval form, in which someone will approve or not the contrct, setting a variable approved. With that variable, this form is followed by a condition and if approved is "True" it ends with a script that sends this document via docusign and if is "False" it goes to a internal analysis form.'},{title:"Credit approval",prompt:'Create a workflow to implement a credit approval process. It starts with the user filling a form that asks its name, email, monthly income and loan amount in a Abstra Page. After that there is a script that checks if the loan amount is greater than 1/3 of the monthly income, and if yes, sets a variable score as "low" and else as "high". Following this script there is a condition that takes to an automatic review form if the score is high and to a manual review form if the score is low.'},{title:"Vacation request",prompt:'Create a workflow to implement a vacation request process. It starts with a form to the employee fill that asks separately the start and end date of the vacation. This dates are converted to string and saved in the thread. After that, there is a script that calculates the number of days of the vacation and saves this value in the thread. Following that, there is an approval form, in which the manager will approve or not the vacation request. In the same form, save the vacation in abstra tables in a table "vacations", using insert function from abstra.tables.'}],g=t=>{s.value=t.prompt},f=I(-1),b=["Did you know Abstra is open-source? You can star us on GitHub!","Python is the most popular language among non-developers","With our AI, you can create a full project in less than a minute!","Breaking your process into smaller steps can help debug it","Ask anything to Smart Console, our AI assistant","Check our documentation to learn more about Abstra","You can send tasks that the next stages will consume","Customize your workspace by changing the theme in the settings"],_=async()=>{u.value=!1,r.value=!0,f.value=0;const t=setInterval(()=>{f.value++,f.value>=b.length&&(f.value=0),f.value>=b.length&&(clearInterval(t),f.value=-1)},8e3);try{await Xe.generateProject(s.value),r.value=!1,clearInterval(t),f.value=-1,s.value="",l("close-and-refetch")}catch{r.value=!1,clearInterval(t),f.value=-1,u.value=!0}},S=()=>{u.value=!1,s.value="",l("close")};return(t,A)=>(p(),y(e(se),{open:t.open,title:"Let AI help you start your project","ok-text":v.value,"confirm-loading":r.value,onCancel:S,onOk:_},{default:a(()=>[o(e(Y),{layout:"vertical"},{default:a(()=>[o(e(P),{label:"What do you need to automate? Write a Workflow prompt below, and our AI will create it all for you \u2014 code included"},{default:a(()=>[o(e($),{justify:"end",style:{"margin-bottom":"6px"}},{default:a(()=>[o(e(_e),{trigger:"click",placement:"bottomRight"},{overlay:a(()=>[o(e(we),null,{default:a(()=>[(p(),M(V,null,oe(h,T=>o(e(be),{key:T.title,onClick:q=>g(T)},{default:a(()=>[d(x(T.title),1)]),_:2},1032,["onClick"])),64))]),_:1})]),default:a(()=>[k("a",{class:"ant-dropdown-link",onClick:A[0]||(A[0]=ke(()=>{},["prevent"]))},[d(" Examples "),o(e(Ye))])]),_:1})]),_:1}),o(e(Ce),{value:s.value,"onUpdate:value":A[1]||(A[1]=T=>s.value=T),rows:8,placeholder:h[0].prompt},null,8,["value","placeholder"])]),_:1})]),_:1}),o(e(N),null,{default:a(()=>[d(x(b[f.value]),1)]),_:1}),u.value?(p(),y(e(re),{key:0,type:"error",message:"There was an internal error, please try again"})):F("",!0)]),_:1},8,["open","ok-text","confirm-loading"]))}}),R=n=>(Ie("data-v-ef0f78d6"),n=n(),Te(),n),Qe={key:0,class:"choose-type"},Ze={class:"option-content"},et=R(()=>k("span",null,"Forms",-1)),tt={class:"option-content"},at=R(()=>k("span",null,"Hooks",-1)),ot={class:"option-content"},st=R(()=>k("span",null,"Tasklets",-1)),nt={class:"option-content"},lt=R(()=>k("span",null,"Jobs",-1)),rt=O({__name:"ChooseStageType",props:{state:{}},emits:["choose-type"],setup(n,{emit:l}){const s=n,r=C(()=>s.state.type==="form"?"#fff":void 0),u=C(()=>s.state.type==="hook"?"#fff":void 0),v=C(()=>s.state.type==="tasklet"?"#fff":void 0),h=C(()=>s.state.type==="job"?"#fff":void 0);return Se(()=>s.state.type,g=>{g&&l("choose-type",g)}),(g,f)=>g.state.state==="choosing-type"?(p(),M("div",Qe,[o(e($),{vertical:"",gap:"30"},{default:a(()=>[o(e(Ae),null,{default:a(()=>[d("Choose your stage type")]),_:1}),o(e(Fe),{value:g.state.type,"onUpdate:value":f[0]||(f[0]=b=>g.state.type=b),size:"large","button-style":"solid"},{default:a(()=>[o(e($),{gap:"24",vertical:""},{default:a(()=>[o(e($),{gap:"24"},{default:a(()=>[o(e(D),{placement:"left",title:"Forms"},{content:a(()=>[o(e(E),null,{default:a(()=>[d(" Use to collect user input via interaction with a form interface ")]),_:1}),o(ee,{path:"workflow/forms"})]),default:a(()=>[o(e(U),{value:"form",class:"option"},{default:a(()=>[k("div",Ze,[(p(),y(e(qe),{key:r.value,color:r.value},null,8,["color"])),et])]),_:1})]),_:1}),o(e(D),{placement:"right",title:"Hooks"},{content:a(()=>[o(e(E),null,{default:a(()=>[d("Use to build endpoints triggered by HTTP requests")]),_:1}),o(ee,{path:"workflow/forms"})]),default:a(()=>[o(e(U),{value:"hook",class:"option"},{default:a(()=>[k("div",tt,[(p(),y(e(We),{key:u.value,color:u.value},null,8,["color"])),at])]),_:1})]),_:1})]),_:1}),o(e($),{gap:"24"},{default:a(()=>[o(e(D),{placement:"left",title:"Tasklet"},{content:a(()=>[o(e(E),null,{default:a(()=>[d(" Use to write plain Python scripts ")]),_:1})]),default:a(()=>[o(e(U),{value:"tasklet",class:"option"},{default:a(()=>[k("div",ot,[(p(),y(e(ze),{key:v.value,color:v.value},null,8,["color"])),st])]),_:1})]),_:1}),o(e(D),{placement:"right",title:"Jobs"},{content:a(()=>[o(e(E),null,{default:a(()=>[d(" Use to schedule your script execution periodically ")]),_:1})]),default:a(()=>[o(e(U),{value:"job",class:"option"},{default:a(()=>[k("div",nt,[(p(),y(e(Je),{key:h.value,color:h.value},null,8,["color"])),lt])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):F("",!0)}});const it=ne(rt,[["__scopeId","data-v-ef0f78d6"]]),ut=k("br",null,null,-1),ct=O({__name:"NewStage",props:{state:{}},emits:["update-name","update-file"],setup(n,{emit:l}){const s=n,{result:r}=z(()=>fetch("/_editor/api/workspace/root").then(_=>_.text())),u=C(()=>s.state.state!=="creating"?"":`${r.value}/${s.state.stage.filename}`),v=C(()=>s.state.state!=="creating"?"":`${s.state.stage.type[0].toUpperCase()+s.state.stage.type.slice(1)} title`),h=_=>{l("update-name",_);const S=Re(_);l("update-file",S),f()},{result:g,refetch:f}=z(()=>le.checkFile(s.state.stage.filename)),b=C(()=>ie(s.state.stage.filename));return(_,S)=>(p(),y(e(Y),{layout:"vertical"},{default:a(()=>{var t;return[o(e(P),{label:v.value,required:!0},{default:a(()=>[o(e(Q),{value:_.state.stage.title,"onUpdate:value":h},null,8,["value"])]),_:1},8,["label"]),o(e(P),{label:"Generated file",required:!0,"validate-status":b.value.valid?"success":"error",help:b.value.valid?void 0:b.value.reason},{default:a(()=>[o(e(xe),{placement:"right"},{title:a(()=>[d(" You can change this later ")]),default:a(()=>[o(e(Q),{value:_.state.stage.filename,"onUpdate:value":S[0]||(S[0]=A=>_.state.stage.filename=A),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["validate-status","help"]),o(e(P),null,{default:a(()=>[o(e(N),null,{default:a(()=>[d(" Your stage source code will be generated at: ")]),_:1}),ut,o(e(N),{code:""},{default:a(()=>[d(x(u.value),1)]),_:1})]),_:1}),(t=e(g))!=null&&t.exists?(p(),y(e(re),{key:0,type:"warning","show-icon":""},{message:a(()=>[o(e(N),null,{default:a(()=>[d(" This file already exists and might be in use by another stage. Contents will be left unchanged. ")]),_:1})]),_:1})):F("",!0)]}),_:1}))}}),pt=O({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-stage","update-name","update-file"],setup(n,{emit:l}){const s=n,r=I(!1),u=t=>l("update-name",t),v=t=>l("update-file",t),h=()=>l("close"),g=t=>l("choose-type",t),f=()=>l("next-step"),b=()=>l("previous-step"),_=()=>{r.value=!0,l("create-stage")},S=C(()=>!(s.state.state!=="creating"||!ie(s.state.stage.filename).valid||!s.state.stage.title||r.value));return(t,A)=>(p(),y(e(se),{open:t.open,title:"Create a new stage",onCancel:h},{footer:a(()=>[t.state.state==="creating"?(p(),y(e(G),{key:0,onClick:b},{default:a(()=>[d("Previous")]),_:1})):F("",!0),t.state.state==="creating"?(p(),y(e(G),{key:1,type:"primary",disabled:!S.value,onClick:_},{default:a(()=>[d(" Create ")]),_:1},8,["disabled"])):F("",!0),t.state.state==="choosing-type"?(p(),y(e(G),{key:2,type:"primary",disabled:!t.state.type,onClick:f},{default:a(()=>[d(" Next ")]),_:1},8,["disabled"])):F("",!0)]),default:a(()=>[t.state.state==="choosing-type"?(p(),y(it,{key:0,state:t.state,onChooseType:g},null,8,["state"])):F("",!0),t.state.state==="creating"?(p(),y(ct,{key:1,state:t.state,onUpdateName:u,onUpdateFile:v},null,8,["state"])):F("",!0)]),_:1},8,["open"]))}}),dt=O({__name:"FilterStages",emits:["update-filter"],setup(n,{emit:l}){const s=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],r=u=>{if(!u){l("update-filter",[]);return}if(!Array.isArray(u)){l("update-filter",[u]);return}const v=u.map(h=>h);l("update-filter",v)};return(u,v)=>(p(),y(e(Y),null,{default:a(()=>[o(e(P),{label:"Filter"},{default:a(()=>[o(e($e),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":r},{default:a(()=>[(p(),M(V,null,oe(s,h=>o(e(Oe),{key:h.value,value:h.value},{default:a(()=>[d(x(h.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),ft=200,mt=n=>{if(!n)return[0,0];if(n.length===0)return[0,0];let l=-1/0,s=0;for(const r of n)r.position.x>l&&(l=r.position.x),s+=r.position.y/n.length;return[l+ft,s]},W=n=>{if(n instanceof B)return"form";if(n instanceof H)return"hook";if(n instanceof L)return"job";if(n instanceof J)return"tasklet";throw new Error("Invalid script type")},ht=n=>n instanceof B?`/${n.path}`:n instanceof H?`/_hooks/${n.path}`:n instanceof L?`${n.schedule}`:"",vt={class:"ellipsis",style:{"max-width":"300px"}},gt={class:"ellipsis",style:{"max-width":"250px"}},yt={class:"ellipsis",style:{"max-width":"200px"}},ae=100,_t=O({__name:"Stages",setup(n){Pe(i=>({"649821fe":he()}));const l=Ne(),{loading:s,result:r,refetch:u}=z(async()=>Promise.all([B.list(),H.list(),L.list(),J.list()]).then(([i,c,m,w])=>[...i,...c,...m,...w])),v=I(!1),h=async()=>{v.value=!1,u()},g=I([]),f=i=>{g.value=i},b=C(()=>r.value?g.value.length===0?r.value:r.value.filter(i=>g.value.includes(W(i))):[]),_=i=>{le.openFile(i)},S=C(()=>{const i=[{title:"Type",align:"left"},{title:"Title",align:"left"},{title:"File",align:"left"},{title:"Trigger",align:"left"},{title:"",align:"right"}],c=b.value;if(!c)return{columns:i,rows:[]};const m=c.map(w=>{const j=He(W(w));return{key:w.id,cells:[{type:"tag",text:j},{type:"slot",key:"title",payload:{script:w}},{type:"slot",key:"file",payload:{script:w}},{type:"slot",key:"trigger",payload:{script:w}},{type:"actions",actions:[{icon:Le,label:"Open .py file",onClick:()=>_(w.file)},{icon:Ue,label:"Delete",onClick:()=>me(w.id)}]}]}});return{columns:i,rows:m}}),t=I({state:"idle"}),A=C(()=>t.value.state==="choosing-type"||t.value.state==="creating"),T=()=>{t.value={state:"choosing-type",type:null}},q=()=>{t.value={state:"idle"}},ue=i=>{t.value.state==="choosing-type"&&(t.value={state:"choosing-type",type:i})},ce=()=>{t.value.state==="choosing-type"&&t.value.type!==null&&(t.value={state:"creating",stage:{type:t.value.type,title:`Untitled ${t.value.type}`,filename:`untitled_${t.value.type}.py`}})},pe=()=>{t.value.state==="creating"&&(t.value={state:"choosing-type",type:t.value.stage.type})},de=i=>{t.value.state==="creating"&&(t.value.stage.title=i)},fe=i=>{t.value.state==="creating"&&(t.value.stage.filename=i)},me=async i=>{var c,m;if(await Z("Are you sure you want to delete this script?")){const w=await Z("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});await((m=(c=r.value)==null?void 0:c.find(j=>j.id===i))==null?void 0:m.delete(w)),await u()}},he=()=>(ae/1e3).toString()+"s",ve=async()=>{if(t.value.state!=="creating")return;const i=mt(r.value||[]);let c;if(t.value.stage.type==="form"?c=await B.create(t.value.stage.title,t.value.stage.filename,i):t.value.stage.type==="hook"?c=await H.create(t.value.stage.title,t.value.stage.filename,i):t.value.stage.type==="job"?c=await L.create(t.value.stage.title,t.value.stage.filename,i):t.value.stage.type==="tasklet"&&(c=await J.create(t.value.stage.title,t.value.stage.filename,i)),!c)throw new Error("Failed to create script");const m=c.id,w=t.value.stage.type;setTimeout(async()=>{await K(m,w),q()},ae)},K=async(i,c)=>{c==="form"&&await l.push({name:"formEditor",params:{id:i}}),c==="hook"&&await l.push({name:"hookEditor",params:{id:i}}),c==="tasklet"&&await l.push({name:"scriptEditor",params:{id:i}}),c==="job"&&await l.push({name:"jobEditor",params:{id:i}})};return(i,c)=>(p(),M(V,null,[o(Ge,null,{default:a(()=>[o(e(je),null,{default:a(()=>[d("Stages")]),_:1}),o(dt,{onUpdateFilter:f}),o(Be,{"empty-title":"There are no scripts","entity-name":"scripts",description:"",table:S.value,loading:e(s),title:"","create-button-text":"Create new",create:T},{title:a(({payload:m})=>[k("div",vt,[o(e(De),{onClick:w=>K(m.script.id,e(W)(m.script))},{default:a(()=>[d(x(m.script.title),1)]),_:2},1032,["onClick"])])]),secondary:a(()=>[e(r)&&!e(r).length?(p(),y(e(G),{key:0,onClick:c[0]||(c[0]=m=>v.value=!0)},{default:a(()=>[o(e($),{gap:"4",align:"center"},{default:a(()=>[d(" Start with AI "),o(e(Me),{size:16})]),_:1})]),_:1})):F("",!0)]),file:a(({payload:m})=>[k("div",gt,[o(e(N),null,{default:a(()=>[d(x(m.script.file),1)]),_:2},1024)])]),trigger:a(({payload:m})=>[o(e(Ee),{color:"default"},{default:a(()=>[k("div",yt,x(e(ht)(m.script)),1)]),_:2},1024)]),_:1},8,["table","loading"])]),_:1}),o(pt,{open:A.value,state:t.value,onClose:q,onChooseType:ue,onNextStep:ce,onPreviousStep:pe,onCreateStage:ve,onUpdateName:de,onUpdateFile:fe},null,8,["open","state"]),o(Ke,{open:v.value,onClose:c[1]||(c[1]=m=>v.value=!1),onCloseAndRefetch:h},null,8,["open"])],64))}});const Jt=ne(_t,[["__scopeId","data-v-0b083a15"]]);export{Jt as default};
//# sourceMappingURL=Stages.3dde2098.js.map

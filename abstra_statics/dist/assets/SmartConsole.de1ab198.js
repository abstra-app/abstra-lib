import{d as J,u as A,G as U,K as se,b as r,c as u,y as l,V,W as H,v as e,B as b,H as R,e as E,a8 as ne,R as oe,N as O,O as Y,q as G,r as v,Q as ae,X as K,o as re,U as le,E as D,I,z as ie,F as ue,J as ce,$ as de,t as pe,L as me}from"./registerWidgets.d12d7cf9.js";import{p as he,n as N,o as ve,q as fe}from"./icons.a63cb90b.js";import{a as W}from"./CircularLoading.89577a16.js";import{F as ye}from"./forms.7bc6baea.js";import{D as _e}from"./dashes.8e41d473.js";import{H as ge}from"./hooks.944007d1.js";import{J as q}from"./jobs.987450d7.js";import{W as ke}from"./workspaces.32af92db.js";import{l as $}from"./log.2520bfaa.js";const Q=t=>(O("data-v-7d69f0ed"),t=t(),Y(),t),Se={class:"runtime-settings"},Ce={key:0,class:"field"},$e=Q(()=>e("div",{class:"label"},"Path",-1)),be={class:"field"},we=Q(()=>e("div",{class:"label"},"Code",-1)),xe={class:"input-row"},Ie={key:1,class:"root-path loading"},Re={class:"path-feedback"},Ee={key:1,class:"error"},Pe=J({__name:"RuntimeCommonSettings",props:{runtime:null},setup(t){const s=t,a=A({pathError:null}),{result:c}=W(()=>ke.get()),h=()=>{!c.value||!s.runtime.file||c.value.openFile(s.runtime.file)},P=U(()=>{var d;return(d=s.runtime.file)!=null&&d.endsWith(".py")?null:"It should be a .py file"}),w=()=>{!c.value||!S.value||c.value.openFile(".")},k=se(),{result:S}=W(()=>fetch("/_editor/api/workspace/root-path").then(d=>d.text()));return s.runtime.onUpdate(()=>{if(!(s.runtime instanceof q))if(console.log("runtime updated",s.runtime.path),s.runtime instanceof ye)k.push({path:`/_editor/form/${encodeURIComponent(s.runtime.path)}`});else if(s.runtime instanceof ge)k.push({path:`/_editor/hook/${encodeURIComponent(s.runtime.path)}`});else if(s.runtime instanceof _e)k.push({path:`/_editor/dash/${encodeURIComponent(s.runtime.path)}`});else throw new Error(`Unknown runtime type ${s.runtime}`)}),(d,p)=>(r(),u("div",Se,[t.runtime instanceof l(q)?b("",!0):(r(),u("div",Ce,[$e,V(e("input",{"onUpdate:modelValue":p[0]||(p[0]=f=>t.runtime.path=f),class:"path-input",type:"text"},null,512),[[H,t.runtime.path]])])),e("div",be,[we,e("div",xe,[l(S)?(r(),u("button",{key:0,class:"root-path",onClick:p[1]||(p[1]=f=>w())},R(l(S)),1)):(r(),u("span",Ie," Loading... ")),V(e("input",{"onUpdate:modelValue":p[2]||(p[2]=f=>t.runtime.file=f),type:"text"},null,512),[[H,t.runtime.file]]),e("button",{class:"open-file-icon",onClick:p[3]||(p[3]=f=>h())},[E(ne,{path:l(he)},null,8,["path"]),oe(" Open in editor ")])]),e("div",Re,R(l(P)),1)]),a.pathError?(r(),u("div",Ee,R(a.pathError),1)):b("",!0)]))}});const tt=G(Pe,[["__scopeId","data-v-7d69f0ed"]]),Le=t=>(O("data-v-1f2f90f4"),t=t(),Y(),t),De={class:"smart-console"},Ue={class:"header"},Fe=Le(()=>e("div",{class:"left"},"Console",-1)),Me={class:"right"},Te={class:"cli"},ze={class:"left"},Be={class:"entry ai-output"},Ve={key:0},He={class:"local-entry"},Ke={key:0,class:"input"},Ne=["pointer-events","onKeydown"],We={class:"right"},qe=J({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},dashPlayerState:null,formCode:null,runtime:null},emits:["clear-terminal","restart","enter"],setup(t,{emit:s}){const a=t,c=v(""),h=v(null),P=me(),w=U(()=>a.runtime==="dashes"?x:$.logs),k=v(!1),S=()=>{$.clear(),s("restart")};ae(P,()=>{$.clear(),s("clear-terminal")});const d=v(null),p=v("assistant"),f=async n=>{var i;if(n.preventDefault(),c.value=((i=d.value)==null?void 0:i.innerText)||"",n.shiftKey){document.execCommand("insertLineBreak");return}d.value&&(d.value.innerText=""),await X()},X=async()=>{c.value&&(y({type:"eval-request",log:`>>> ${c.value}`}),j(c.value),c.value="")},x=A([]),y=async n=>{x.push(n),await K(),h.value&&(h.value.scrollTop=h.value.scrollHeight)},j=n=>{var i,m,_;(_=(i=a.dashPlayerState)==null?void 0:i.broker)==null||_.send({type:"eval",expression:n,state:(m=a.dashPlayerState)==null?void 0:m.apiPageState})};(()=>{var n,i,m,_,z,B;(n=a.dashPlayerState)==null||n.on("eval-return",o=>{o.repr&&y({type:"log",log:o.repr})}),(i=a.dashPlayerState)==null||i.on("eval-error",o=>{y({type:"error",log:o.repr})}),(m=a.dashPlayerState)==null||m.on("stderr",o=>{y({type:"stderr",log:o.log})}),(_=a.dashPlayerState)==null||_.on("stdout",o=>{y({type:"stdout",log:o.log})}),(z=a.dashPlayerState)==null||z.on("widgets-computed",o=>{var C;(C=o.errors)!=null&&C.general&&y({type:"error",log:o.errors.general.repr})}),(B=a.dashPlayerState)==null||B.on("program-start-failed",o=>{var C;y({type:"error",log:(C=o.error)!=null?C:""})})})();const Z=()=>{p.value==="assistant"&&$.clear(),x.splice(0,x.length)};$.listen(async n=>{n.type!=="restart"&&(g.value=!0,await K(),h.value&&(h.value.scrollTop=h.value.scrollHeight))});const g=v(!1),F=v(400),ee=U(()=>({height:`${F.value}px`})),L=v(!1),te=()=>L.value=!0,M=n=>{!L.value||(F.value=document.body.clientHeight-n.clientY)},T=()=>L.value=!1;return re(()=>{document.addEventListener("mousemove",M),document.addEventListener("mouseup",T)}),le(()=>{document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",T)}),(n,i)=>(r(),u("div",De,[e("div",Ue,[Fe,e("div",Me,[e("div",{class:"changes-container"},[e("button",{class:"header-button",onClick:S},"Restart")]),e("div",{class:"toggle-button",onClick:i[0]||(i[0]=m=>g.value=!g.value)},[E(I,{class:D(["icon",{open:g.value}]),path:l(N),fill:"#fff"},null,8,["class","path"])])])]),g.value?(r(),u("div",{key:0,class:"terminal",style:ie(l(ee))},[e("div",{class:"resize-handler",onMousedown:te},null,32),e("div",Te,[e("div",ze,[e("div",{ref_key:"entriesContainer",ref:h,class:"entries"},[e("div",Be,[l(w).length==0?(r(),u("span",Ve," You can inspect your code here. ")):(r(!0),u(ue,{key:1},ce(l(w),(m,_)=>(r(),u("div",{key:_,class:D([m.type,"entry"])},[e("div",He,R(m.type==="restart"?"-- restarted --":m.log),1)],2))),128))])],512),t.runtime==="dashes"?(r(),u("div",Ke,[E(I,{class:D(["icon",{open:g.value}]),path:l(N)},null,8,["class","path"]),e("div",{ref_key:"inputRef",ref:d,class:"input-text",contenteditable:"","pointer-events":k.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:de(f,["enter"])},null,40,Ne)])):b("",!0)]),e("div",We,[e("div",{class:"icons",onClick:Z},[E(I,{class:"icon",path:l(ve)},null,8,["path"])]),e("div",null,[t.runtime==="dashes"?(r(),pe(I,{key:0,class:"icon",path:l(fe)},null,8,["path"])):b("",!0)])])])],4)):b("",!0)]))}});const st=G(qe,[["__scopeId","data-v-1f2f90f4"]]);export{tt as R,st as S};
//# sourceMappingURL=SmartConsole.de1ab198.js.map

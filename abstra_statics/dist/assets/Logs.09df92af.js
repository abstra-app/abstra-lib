import{d as Y,r as N,H as U,G as E,eB as q,F as J,eH as K,b as i,c as v,w as r,u as e,eG as Q,f as l,aq as F,ad as T,cr as W,bu as X,cF as S,eu as b,eC as Z,ew as P,eD as c,e as x,cN as ee,a_ as te,bR as ae,cn as le,t as se}from"./outputWidgets.609857d3.js";import{t as ne}from"./ant-design.1b8375a2.js";import{C as j}from"./gateway.18443e48.js";import{A as C}from"./router.1cab72b8.js";import{B as re}from"./build.0ad53b19.js";import"./index.bd6c8cf6.js";import{a as oe}from"./asyncComputed.ee441ca1.js";import{R as ue}from"./dayjs.5a979a37.js";import{f as ie}from"./index.b048d0fb.js";import{A as de}from"./Title.86fadf94.js";import{A as z,a as pe}from"./Text.5910ec7d.js";import{A as g,F as ce}from"./Base.cff9ddf5.js";import{A as fe,C as me}from"./CollapsePanel.e6e2936c.js";import{A as k}from"./index.ce7a4e40.js";import"./transButton.29406144.js";import"./index.efb45bdb.js";import"./record.5fdd269a.js";import"./pubsub.54491294.js";import"./index.000ad336.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[t]="dc79405d-4c27-4b8f-97f1-f59ed1b51bf7",y._sentryDebugIdIdentifier="sentry-dbid-dc79405d-4c27-4b8f-97f1-f59ed1b51bf7")}catch{}})();class ve{list(t){return j.post(`projects/${t.projectId}/builds/${t.buildId}/logs`,t)}filters(t){return j.get(`projects/${t}/log-filters`)}}const O=new ve;class A{constructor(t,d,f,h,w,I,_){this.executionId=t,this.runtimeType=d,this.runtimeName=f,this.payload=h,this.event=w,this.buildId=I,this.createdAt=_}static fromDTO(t){return new A(t.executionId,t.runtimeType,t.runtimeName,t.payload,t.event,t.buildId,new Date(t.createdAt))}static async list(t){const d=await O.list(t);return{total:d.total,logs:d.logs.map(A.fromDTO)}}static async filters(t){return O.filters(t)}}const ye={key:0},be=["title"],_e=["textContent"],ge=["textContent"],Ae=["textContent"],he=["textContent"],we=Y({__name:"Logs",setup(y){function t(n){return ie(n,new Date,{addSuffix:!0})}const d=N(1),f=N(10);U([d,f],([n,s])=>{d.value=n,f.value=s,B()});function h(n){return(n.event==="stderr"||n.event==="stdout")&&typeof n.payload.log=="string"&&n.payload.log.trim().length===0}const w=E(()=>{var n,s;return{runtimes:(n=m.value)==null?void 0:n.filters.runtimes.map(({runtimeName:p,runtimeType:u})=>({label:`[${u}] ${p}`,value:p})),events:(s=m.value)==null?void 0:s.filters.events.map(p=>({label:`[${p.runtimeType}] ${p.event}`,value:p.event}))}}),I=q(),_=I.params.projectId,o=J({selectedBuild:I.query.buildId||"latest",dateRange:void 0,search:"",runtimeNames:[],events:[]}),V=K.exports.debounce(async()=>{await B(),D.value=!1},500),D=N(!1);U(o,()=>{D.value=!0,d.value=1,V()});const G=E(()=>m.value?[{label:"Latest",value:"latest"},{label:"All",value:"all"},...m.value.builds.map(n=>({label:`${t(n.createdAt)} (${n.id.slice(0,8)})`,value:n.id}))]:[{label:"Latest",value:"latest"},{label:"All",value:"all"}]),H=n=>{o.selectedBuild=n,B()},{loading:M,result:m,refetch:B}=oe(()=>{var n,s;return Promise.all([A.list({projectId:_,limit:f.value,offset:(d.value-1)*f.value,buildId:o.selectedBuild,from:(n=o.dateRange)==null?void 0:n[0].toDate(),to:(s=o.dateRange)==null?void 0:s[1].toDate(),search:o.search,runtimeNames:o.runtimeNames,events:o.events}),re.list(_),A.filters(_)]).then(([{total:p,logs:u},a,R])=>Q({total:p,logs:u,builds:a,filters:R}))});return(n,s)=>(i(),v(e(S),{direction:"vertical"},{default:r(()=>{var p;return[l(e(de),null,{default:r(()=>[F("Logs")]),_:1}),l(e(ce),{layout:"vertical"},{default:r(()=>[l(e(z),{gutter:10},{default:r(()=>[l(e(C),{span:12},{default:r(()=>[l(e(g),{label:"Build"},{default:r(()=>[l(e(T),{value:o.selectedBuild,"onUpdate:value":s[0]||(s[0]=u=>o.selectedBuild=u),options:G.value,"option-label":"label","option-value":"value",filter:!1,onChange:H},null,8,["value","options"])]),_:1})]),_:1}),l(e(C),{span:12},{default:r(()=>[l(e(g),{label:"Date"},{default:r(()=>[l(e(ue),{value:o.dateRange,"onUpdate:value":s[1]||(s[1]=u=>o.dateRange=u),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(e(z),{gutter:10},{default:r(()=>[l(e(C),{span:12},{default:r(()=>[l(e(g),{label:"Runtimes"},{default:r(()=>[l(e(T),{value:o.runtimeNames,"onUpdate:value":s[2]||(s[2]=u=>o.runtimeNames=u),options:w.value.runtimes,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1}),l(e(C),{span:12},{default:r(()=>[l(e(g),{label:"Events"},{default:r(()=>[l(e(T),{value:o.events,"onUpdate:value":s[3]||(s[3]=u=>o.events=u),options:w.value.events,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),l(e(g),{label:"Search"},{default:r(()=>[l(e(W),{value:o.search,"onUpdate:value":s[4]||(s[4]=u=>o.search=u),type:"search"},null,8,["value"])]),_:1})]),_:1}),e(M)||D.value?(i(),v(e(X),{key:0,style:{width:"100%"}})):(p=e(m))!=null&&p.logs.length?(i(),v(e(S),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>{var u;return[l(e(me),{"data-source":(u=e(m))==null?void 0:u.logs},{default:r(()=>[(i(!0),b(te,null,Z(e(m).logs,(a,R)=>(i(),v(e(fe),{key:R,disabled:h(a)},{extra:r(()=>[h(a)?(i(),v(e(pe),{key:0},{default:r(()=>[F(" EMPTY ")]),_:1})):P("",!0)]),header:r(()=>[l(e(S),null,{default:r(()=>[o.selectedBuild=="all"?(i(),b("span",ye,c(a.buildId.split("-")[0]),1)):P("",!0),l(e(k),{type:"vertical"}),x("span",{title:a.createdAt.toISOString()},c(t(a.createdAt)),9,be),l(e(k),{type:"vertical"}),x("span",null," ["+c(a.runtimeType)+"] "+c(a.runtimeName),1),l(e(k),{type:"vertical"}),x("span",null,c(a.executionId.slice(0,8)),1),l(e(k),{type:"vertical"}),x("span",null,c(a.event),1)]),_:2},1024)]),default:r(()=>{var $,L;return[a.event==="stdout"?(i(),b("pre",{key:0,class:"stdio-log",textContent:c(a.payload.log)},null,8,_e)):a.event==="stderr"?(i(),b("pre",{key:1,class:"stdio-log",textContent:c(a.payload.log)},null,8,ge)):a.event==="program-start-failed"?(i(),b("pre",{key:2,textContent:c(a.payload.error)},null,8,Ae)):a.event==="widgets-computed"&&((L=($=a.payload.errors)==null?void 0:$.general)==null?void 0:L.repr)?(i(),b("pre",{key:3,textContent:c(a.payload.errors.general.repr)},null,8,he)):(i(),v(e(ee),{key:4,"tree-data":e(ne)(a.payload)},null,8,["tree-data"]))]}),_:2},1032,["disabled"]))),128))]),_:1},8,["data-source"]),l(e(ae),{current:d.value,"onUpdate:current":s[5]||(s[5]=a=>d.value=a),"page-size":f.value,"onUpdate:pageSize":s[6]||(s[6]=a=>f.value=a),"show-size-changer":"",total:e(m).total},null,8,["current","page-size","total"])]}),_:1})):(i(),v(e(le),{key:2}))]}),_:1}))}});const Ve=se(we,[["__scopeId","data-v-48248974"]]);export{Ve as default};
//# sourceMappingURL=Logs.09df92af.js.map

var y=Object.defineProperty;var g=(r,e,t)=>e in r?y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>(g(r,typeof e!="symbol"?e+"":e,t),t);import{ep as h}from"./registerWidgets.ce5f9e65.js";import{P as b}from"./pubsub.4ee72047.js";import{S as u}from"./storage.18190b76.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="dead7e36-81e0-43fa-989c-47ee38c24ed5",r._sentryDebugIdIdentifier="sentry-dbid-dead7e36-81e0-43fa-989c-47ee38c24ed5")}catch{}})();const m=()=>window.location.host.includes(".abstra.io"),v={authn:"/api/authn","cloud-api":"/api/cloud-api"},E={authn:"https://authn.abstra.cloud","cloud-api":"https://cloud-api.abstra.cloud"},l=r=>{const e="VITE_"+h.toUpper(h.snakeCase(r)),t={VITE_SENTRY_RELEASE:"eff9efeedd22d5a0532ead115a8f5825c43af4ce",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}[e];return t||(m()?v[r]:E[r])};function p(r){this.message=r}p.prototype=new Error,p.prototype.name="InvalidCharacterError";var w=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new p("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,a=0,o=0,f="";n=e.charAt(o++);~n&&(t=a%4?64*t+n:n,a++%4)?f+=String.fromCharCode(255&t>>(-2*a&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return f};function k(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(w(t).replace(/(.)/g,function(n,a){var o=a.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch{return w(e)}}function c(r){this.message=r}function I(r,e){if(typeof r!="string")throw new c("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(k(r.split(".")[t]))}catch(n){throw new c("Invalid token specified: "+n.message)}}c.prototype=new Error,c.prototype.name="InvalidTokenError";const s=class{constructor(){d(this,"pubsub");this.pubsub=new b}async authenticate(e){try{const t=await fetch(`${l("authn")}/authenticate`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw new Error(await t.text());return null}catch(t){return t.message}}async verify(e,t){const n=await fetch(`${l("authn")}/verify`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:e,token:t})});if(!n.ok)throw new Error(await n.text());const a=await n.json();this.saveJWT(a.jwt);const o=this.getUser();return this.pubsub.publish("authenticated",o),o}saveJWT(e){u.set(s.key,e)}getJWT(){return u.get(s.key)}getUser(){const e=this.getJWT();if(e)try{const t=I(e);if(t.exp&&t.exp>Date.now()/1e3)return{jwt:e,claims:t}}catch{console.warn("Invalid JWT")}return null}removeUser(){u.remove(s.key)}getUserHeaders(e="User-Authorization"){const t=this.getJWT();return t?{[e]:`Bearer ${t}`}:{}}};let i=s;d(i,"key","hackerforms:auth:jwt");const R=new i;export{R as p,l as t};
//# sourceMappingURL=passwordlessManager.2133f51e.js.map

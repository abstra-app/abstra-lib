import{d as A,G as k,a as oe,b as c,c as f,w as t,f as a,u as e,aq as u,eD as M,bh as we,bf as Z,ey as ke,bM as Se,ex as C,v as J,e as h,eE as K,eF as Q,ev as U,ai as Ce,cy as H,ah as P,eL as O,H as Fe,r as W,bH as ee,bO as L,ad as Ie,eC as le,cB as Te,bq as Y,eM as Ae,eA as xe,c4 as Ne}from"./outputWidgets.7bf30641.js";import{F as x}from"./forms.80f9d79c.js";import{H as N,S as D,J as E,v as ne,n as $e}from"./validations.3a482a06.js";import{W as ie}from"./workspaces.cd9dd466.js";import{a as G}from"./asyncComputed.cf41ff13.js";import{a as te}from"./ant-design.a887cdff.js";import{f as re,a as pe,b as ce,j as ue,m as Me,c as Ue}from"./icons.0dd46489.js";import{A as I}from"./index.ae5e0684.js";import"./index.a2d70879.js";import{A as F,a as De}from"./Text.85465eb9.js";import{C as de}from"./Card.45269e9e.js";import{_ as ae}from"./DocsButton.vue_vue_type_script_setup_true_lang.2e64fa00.js";import{A as V,M as Ee,a as je}from"./Title.c96c9fa7.js";import{A as q}from"./FormItem.e2824bfb.js";import{A as Be}from"./index.e3ede662.js";import{F as fe}from"./Form.b21cc552.js";import"./index.7d2d6618.js";import"./record.476a0b13.js";import"./pubsub.a4e44688.js";import"./string.576e6875.js";import"./url.fb476188.js";import"./index.11ada48b.js";import"./index.3d31b05f.js";import"./TabPane.3daa7032.js";import"./hasIn.8de9ce1e.js";import"./Link.c33ff4f4.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[n]="b4e23d3f-49fa-432a-a9eb-630440cfde2f",i._sentryDebugIdIdentifier="sentry-dbid-b4e23d3f-49fa-432a-a9eb-630440cfde2f")}catch{}})();const He=A({__name:"ScriptCard",props:{script:{},workspace:{}},emits:["delete","go-to-script"],setup(i,{emit:n}){const s=i,d=async()=>{if(await te("Are you sure you want to delete this script?")){const r=await te("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});n("delete",s.script.id,r)}},v=()=>{s.script instanceof x&&n("go-to-script",s.script.id,"form"),s.script instanceof N&&n("go-to-script",s.script.id,"hook"),s.script instanceof D&&n("go-to-script",s.script.id,"script"),s.script instanceof E&&n("go-to-script",s.script.id,"job")},g=k(()=>{if(s.script instanceof x)return re;if(s.script instanceof N)return pe;if(s.script instanceof D)return ce;if(s.script instanceof E)return ue;throw new Error("Invalid script type")}),_=()=>{!s.script.file||!s.workspace||s.workspace.openFile(s.script.file)};return(r,m)=>{const b=oe("icon");return c(),f(e(de),{key:r.script.title,class:"script-card",onClick:v},{title:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(b,{path:g.value},null,8,["path"]),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[u(M(r.script.title),1)]),_:1})]),_:1})]),extra:t(()=>[a(e(Se),{trigger:["click"],onClick:m[0]||(m[0]=ke(()=>{},["stop"]))},{overlay:t(()=>[a(e(we),null,{default:t(()=>[a(e(Z),{onClick:_},{default:t(()=>[u("Open .py file")]),_:1}),a(e(Z),{danger:"",onClick:d},{default:t(()=>[u("Delete")]),_:1})]),_:1})]),default:t(()=>[a(b,{path:e(Me),style:{cursor:"pointer"}},null,8,["path"])]),_:1})]),default:t(()=>[r.script instanceof e(x)||r.script instanceof e(N)?(c(),f(e(I),{key:0,gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[u("URL path:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[u("/"+M(r.script.path),1)]),_:1})]),_:1})):C("",!0),a(e(I),{gap:"12"},{default:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[u("Code:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"125px"}},{default:t(()=>[u(M(r.script.file),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const Pe=J(He,[["__scopeId","data-v-0e55c24b"]]),Oe=i=>(K("data-v-14680ef5"),i=i(),Q(),i),Ve={class:"card-content"},qe=Oe(()=>h("span",null,"New",-1)),Ge=A({__name:"NewScriptCard",setup(i){return(n,s)=>{const d=oe("icon");return c(),f(e(de),{class:"new-script-card"},{default:t(()=>[h("div",Ve,[a(d,{path:e(Ue)},null,8,["path"]),qe])]),_:1})}}});const Je=J(Ge,[["__scopeId","data-v-14680ef5"]]),R=i=>(K("data-v-b0d14829"),i=i(),Q(),i),Re={key:0,class:"choose-type"},ze={class:"option-content"},Le=R(()=>h("span",null,"Forms",-1)),We={class:"option-content"},Ye=R(()=>h("span",null,"Hooks",-1)),Ke={class:"option-content"},Qe=R(()=>h("span",null,"Scripts",-1)),Xe={class:"option-content"},Ze=R(()=>h("span",null,"Jobs",-1)),et=A({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(i,{emit:n}){const s=i,d=k(()=>s.state.type==="form"?"#fff":void 0),v=k(()=>s.state.type==="hook"?"#fff":void 0),g=k(()=>s.state.type==="script"?"#fff":void 0),_=k(()=>s.state.type==="job"?"#fff":void 0),r=m=>n("choose-type",m);return(m,b)=>m.state.state==="choosing-type"?(c(),U("div",Re,[a(e(I),{vertical:"",gap:"30"},{default:t(()=>[a(e(De),null,{default:t(()=>[u("Choose your script type")]),_:1}),a(e(Ce),{value:m.state.type,"onUpdate:value":[b[0]||(b[0]=o=>m.state.type=o),r],size:"large","button-style":"solid"},{default:t(()=>[a(e(I),{gap:"24",vertical:""},{default:t(()=>[a(e(I),{gap:"24"},{default:t(()=>[a(e(H),{placement:"left",title:"Forms"},{content:t(()=>[a(e(V),null,{default:t(()=>[u(" Use to collect user input via interaction with a form interface ")]),_:1}),a(ae,{path:"forms/overview"})]),default:t(()=>[a(e(P),{value:"form",class:"option"},{default:t(()=>[h("div",ze,[(c(),f(O,{key:d.value,path:e(re),fill:d.value},null,8,["path","fill"])),Le])]),_:1})]),_:1}),a(e(H),{placement:"right",title:"Hooks"},{content:t(()=>[a(e(V),null,{default:t(()=>[u("Use to build endpoints triggered by HTTP requests")]),_:1}),a(ae,{path:"forms/overview"})]),default:t(()=>[a(e(P),{value:"hook",class:"option"},{default:t(()=>[h("div",We,[(c(),f(O,{key:v.value,path:e(pe),fill:v.value},null,8,["path","fill"])),Ye])]),_:1})]),_:1})]),_:1}),a(e(I),{gap:"24"},{default:t(()=>[a(e(H),{placement:"left",title:"Scripts"},{content:t(()=>[a(e(V),null,{default:t(()=>[u(" Use to write plain Python scripts ")]),_:1})]),default:t(()=>[a(e(P),{value:"script",class:"option"},{default:t(()=>[h("div",Ke,[(c(),f(O,{key:g.value,path:e(ce),fill:g.value},null,8,["path","fill"])),Qe])]),_:1})]),_:1}),a(e(H),{placement:"right",title:"Jobs"},{content:t(()=>[a(e(V),null,{default:t(()=>[u(" Use to schedule your script execution periodically ")]),_:1})]),default:t(()=>[a(e(P),{value:"job",class:"option"},{default:t(()=>[h("div",Xe,[(c(),f(O,{key:_.value,path:e(ue),fill:_.value},null,8,["path","fill"])),Ze])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):C("",!0)}});const tt=J(et,[["__scopeId","data-v-b0d14829"]]),at=h("br",null,null,-1),st=A({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(i,{emit:n}){const s=i,{result:d}=G(()=>fetch("/_editor/api/workspace/root").then(S=>S.text()));Fe(()=>s.state.stage.filename,()=>r.value=s.state.stage.filename);const v=k(()=>s.state.state!=="creating"?"":`${d.value}/${r.value}`),g=k(()=>s.state.state!=="creating"?"":`${s.state.stage.type[0].toUpperCase()+s.state.stage.type.slice(1)} title`),_=S=>n("update-name",S),r=W(s.state.stage.filename),{result:m,refetch:b}=G(()=>ie.checkFile(r.value)),o=()=>{p.value.valid?n("update-file",$e(r.value)):n("update-file",r.value),b()},p=k(()=>ne(r.value));return(S,$)=>(c(),f(e(fe),{layout:"vertical"},{default:t(()=>{var j;return[a(e(q),{label:g.value,required:!0},{default:t(()=>[a(e(ee),{value:S.state.stage.title,"onUpdate:value":_},null,8,["value"])]),_:1},8,["label"]),a(e(q),{label:"Generated file",required:!0,"validate-status":p.value.valid?"success":"error",help:p.value.valid?void 0:p.value.reason},{default:t(()=>[a(e(ee),{value:r.value,"onUpdate:value":$[0]||($[0]=z=>r.value=z),onBlur:o},null,8,["value"])]),_:1},8,["validate-status","help"]),a(e(q),null,{default:t(()=>[a(e(F),null,{default:t(()=>[u(" Your script will be generated at: ")]),_:1}),at,a(e(F),{code:""},{default:t(()=>[u(M(v.value),1)]),_:1})]),_:1}),(j=e(m))!=null&&j.exists?(c(),f(e(Be),{key:0,type:"warning"},{message:t(()=>[a(e(F),null,{default:t(()=>[a(e(F),{strong:""},{default:t(()=>[u("Warning:")]),_:1}),u(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):C("",!0)]}),_:1}))}}),ot=A({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(i,{emit:n}){const s=i,d=p=>n("update-name",p),v=p=>n("update-file",p),g=()=>n("close"),_=p=>n("choose-type",p),r=()=>n("next-step"),m=()=>n("previous-step"),b=()=>n("create-script"),o=k(()=>!(s.state.state!=="creating"||!ne(s.state.stage.filename).valid||!s.state.stage.title));return(p,S)=>(c(),f(e(Ee),{open:p.open,title:"Create a new script",onCancel:g},{footer:t(()=>[p.state.state==="creating"?(c(),f(e(L),{key:0,onClick:m},{default:t(()=>[u("Previous")]),_:1})):C("",!0),p.state.state==="creating"?(c(),f(e(L),{key:1,type:"primary",disabled:!o.value,onClick:b},{default:t(()=>[u(" Create ")]),_:1},8,["disabled"])):C("",!0),p.state.state==="choosing-type"?(c(),f(e(L),{key:2,type:"primary",disabled:!p.state.type,onClick:r},{default:t(()=>[u(" Next ")]),_:1},8,["disabled"])):C("",!0)]),default:t(()=>[p.state.state==="choosing-type"?(c(),f(tt,{key:0,state:p.state,onChooseType:_},null,8,["state"])):C("",!0),p.state.state==="creating"?(c(),f(st,{key:1,state:p.state,onUpdateName:d,onUpdateFile:v},null,8,["state"])):C("",!0)]),_:1},8,["open"]))}}),lt=A({__name:"FilterScripts",emits:["update-filter"],setup(i,{emit:n}){const s=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],d=v=>n("update-filter",v);return(v,g)=>(c(),f(e(fe),null,{default:t(()=>[a(e(q),{label:"Filter"},{default:t(()=>[a(e(Ie),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":d},{default:t(()=>[(c(),U(Y,null,le(s,_=>a(e(Te),{key:_.value,value:_.value},{default:t(()=>[u(M(_.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),nt=i=>(K("data-v-00f8f457"),i=i(),Q(),i),it={key:0},rt=nt(()=>h("span",null,"loading",-1)),pt=[rt],se=100,ct=A({__name:"Scripts",setup(i){Ae(l=>({e9cb4458:he()}));const n=xe(),{loading:s,result:d,refetch:v}=G(async()=>Promise.all([x.list(),N.list(),E.list(),D.list()]).then(([l,w,y,T])=>[...l,...w,...y,...T])),g=l=>{if(l instanceof x)return"form";if(l instanceof N)return"hook";if(l instanceof E)return"job";if(l instanceof D)return"script";throw new Error("Invalid script type")},{result:_}=G(()=>ie.get()),r=W([]),m=l=>{r.value=l},b=k(()=>d.value?r.value.length===0?d.value:d.value.filter(l=>r.value.includes(g(l))):[]),o=W({state:"idle"}),p=k(()=>o.value.state==="choosing-type"||o.value.state==="creating"),S=()=>{o.value={state:"choosing-type",type:null}},$=()=>{o.value={state:"idle"}},j=l=>{o.value.state==="choosing-type"&&(o.value={state:"choosing-type",type:l})},z=()=>{o.value.state==="choosing-type"&&o.value.type!==null&&(o.value={state:"creating",stage:{type:o.value.type,title:`Untitled ${o.value.type}`,filename:`untitled_${o.value.type}.py`}})},_e=()=>{o.value.state==="creating"&&(o.value={state:"choosing-type",type:o.value.stage.type})},ve=l=>{o.value.state==="creating"&&(o.value.stage.title=l)},me=l=>{o.value.state==="creating"&&(o.value.stage.filename=l)},ye=async(l,w)=>{var y,T;await((T=(y=d.value)==null?void 0:y.find(B=>B.id===l))==null?void 0:T.delete(w)),await v()},he=()=>(se/1e3).toString()+"s",ge=async()=>{if(o.value.state!=="creating")return;let l;if(o.value.stage.type==="form"?l=await x.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="hook"?l=await N.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="job"?l=await E.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="script"&&(l=await D.create(o.value.stage.title,o.value.stage.filename)),!l)throw new Error("Failed to create script");const w=l.id,y=o.value.stage.type;$(),await v(),setTimeout(()=>{X(w,y)},se)},X=(l,w)=>{var y,T;if(w==="form"&&n.push({name:"formEditor",params:{id:l}}),w==="hook"&&n.push({name:"hookEditor",params:{id:l}}),w==="script"){const B=(y=d.value)==null?void 0:y.find(be=>be.id===l);if(!B)return;(T=_.value)==null||T.openFile(B.file)}w==="job"&&n.push({name:"jobEditor",params:{id:l}})};return(l,w)=>(c(),U(Y,null,[e(s)?(c(),U("span",it,pt)):C("",!0),a(e(je),null,{default:t(()=>[u("Home")]),_:1}),a(lt,{onUpdateFilter:m}),a(e(I),{wrap:"wrap",gap:"large",class:"scripts-container"},{default:t(()=>[a(Ne,null,{default:t(()=>[(c(!0),U(Y,null,le(b.value,y=>(c(),f(Pe,{key:y.title,script:y,workspace:e(_),onDelete:ye,onGoToScript:X},null,8,["script","workspace"]))),128))]),_:1}),a(Je,{onClick:S})]),_:1}),a(ot,{open:p.value,state:o.value,onClose:$,onChooseType:j,onNextStep:z,onPreviousStep:_e,onCreateScript:ge,onUpdateName:ve,onUpdateFile:me},null,8,["open","state"])],64))}});const Bt=J(ct,[["__scopeId","data-v-00f8f457"]]);export{Bt as default};
//# sourceMappingURL=Scripts.37b9e4ad.js.map

import{d as T,H as k,a as ae,b as u,c as d,w as t,f as a,u as e,ar as p,eD as N,bw as be,bu as X,ey as we,bT as ke,ex as C,v as J,e as w,eE as q,eF as z,ev as U,aj as Se,cB as j,ai as H,eH as P,bO as K,b3 as Ce,bV as L,ae as Fe,eC as se,cE as Ie,a$ as Y,eM as Te,eA as Ae,r as Q,c8 as xe}from"./outputWidgets.bb2f46e4.js";import{F as x}from"./forms.4a4aaf38.js";import{H as $,J as E}from"./jobs.7dfff146.js";import{W as oe}from"./workspaces.18464cbe.js";import{S as M}from"./scripts.9ec9b0e6.js";import{a as V}from"./asyncComputed.8bd59622.js";import{a as Z}from"./ant-design.9ba9b232.js";import{f as le,a as ie,b as ne,j as re,m as $e,c as Ne}from"./icons.94ad51fe.js";import{A as F}from"./Text.3cea9169.js";import{A as I}from"./index.77677488.js";import{C as ce}from"./Card.37a856a7.js";import{_ as ee}from"./DocsButton.vue_vue_type_script_setup_true_lang.aaad4840.js";import{a as Ue}from"./Base.3e5c9785.js";import{A as B}from"./Paragraph.c54bf5b6.js";import{v as pe,b as Ee}from"./validations.2566ac57.js";import{A as O}from"./FormItem.744edb5b.js";import{A as Me}from"./index.fa71dea0.js";import{F as ue}from"./Form.fe337595.js";import{M as De}from"./Modal.6f9d473d.js";import{A as je}from"./Title.85b45f4d.js";import"./record.dd66f38b.js";import"./pubsub.9e4f8bfd.js";import"./runnerData.94af0e51.js";import"./url.1b83203f.js";import"./index.e2651b4f.js";import"./TabPane.cc681b73.js";import"./hasIn.9a8a8af5.js";import"./string.22481e13.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[i]="8189c969-576e-420d-aed7-cbcec9432029",l._sentryDebugIdIdentifier="sentry-dbid-8189c969-576e-420d-aed7-cbcec9432029")}catch{}})();const He=T({__name:"ScriptCard",props:{script:{},workspace:{}},emits:["delete","go-to-script"],setup(l,{emit:i}){const o=l,r=async()=>{if(await Z("Are you sure you want to delete this script?")){const _=await Z("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});i("delete",o.script.id,_)}},y=()=>{o.script instanceof x&&i("go-to-script",o.script.id,"form"),o.script instanceof $&&i("go-to-script",o.script.id,"hook"),o.script instanceof M&&i("go-to-script",o.script.id,"script"),o.script instanceof E&&i("go-to-script",o.script.id,"job")},g=k(()=>{if(o.script instanceof x)return le;if(o.script instanceof $)return ie;if(o.script instanceof M)return ne;if(o.script instanceof E)return re;throw new Error("Invalid script type")}),f=()=>{!o.script.file||!o.workspace||o.workspace.openFile(o.script.file)};return(_,h)=>{const s=ae("icon");return u(),d(e(ce),{key:_.script.title,class:"script-card",onClick:y},{title:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(s,{path:g.value},null,8,["path"]),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[p(N(_.script.title),1)]),_:1})]),_:1})]),extra:t(()=>[a(e(ke),{trigger:["click"],onClick:h[0]||(h[0]=we(()=>{},["stop"]))},{overlay:t(()=>[a(e(be),null,{default:t(()=>[a(e(X),{onClick:f},{default:t(()=>[p("Open .py file")]),_:1}),a(e(X),{danger:"",onClick:r},{default:t(()=>[p("Delete")]),_:1})]),_:1})]),default:t(()=>[a(s,{path:e($e),style:{cursor:"pointer"}},null,8,["path"])]),_:1})]),default:t(()=>[_.script instanceof e(x)||_.script instanceof e($)?(u(),d(e(I),{key:0,gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[p("URL path:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[p("/"+N(_.script.path),1)]),_:1})]),_:1})):C("",!0),a(e(I),{gap:"12"},{default:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[p("Code:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"125px"}},{default:t(()=>[p(N(_.script.file),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const Pe=J(He,[["__scopeId","data-v-0e55c24b"]]),Be=l=>(q("data-v-14680ef5"),l=l(),z(),l),Oe={class:"card-content"},Ve=Be(()=>w("span",null,"New",-1)),Je=T({__name:"NewScriptCard",setup(l){return(i,o)=>{const r=ae("icon");return u(),d(e(ce),{class:"new-script-card"},{default:t(()=>[w("div",Oe,[a(r,{path:e(Ne)},null,8,["path"]),Ve])]),_:1})}}});const Re=J(Je,[["__scopeId","data-v-14680ef5"]]),R=l=>(q("data-v-94df32a7"),l=l(),z(),l),Ge={key:0,class:"choose-type"},Le={class:"option-content"},Ye=R(()=>w("span",null,"Forms",-1)),qe={class:"option-content"},ze=R(()=>w("span",null,"Hooks",-1)),We={class:"option-content"},Xe=R(()=>w("span",null,"Scripts",-1)),Ke={class:"option-content"},Qe=R(()=>w("span",null,"Jobs",-1)),Ze=T({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(l,{emit:i}){const o=l,r=k(()=>o.state.type==="form"?"#fff":void 0),y=k(()=>o.state.type==="hook"?"#fff":void 0),g=k(()=>o.state.type==="script"?"#fff":void 0),f=k(()=>o.state.type==="job"?"#fff":void 0),_=h=>i("choose-type",h);return(h,s)=>h.state.state==="choosing-type"?(u(),U("div",Ge,[a(e(I),{vertical:"",gap:"30"},{default:t(()=>[a(e(Ue),null,{default:t(()=>[p("Choose your script type")]),_:1}),a(e(Se),{value:h.state.type,"onUpdate:value":[s[0]||(s[0]=v=>h.state.type=v),_],size:"large","button-style":"solid"},{default:t(()=>[a(e(I),{gap:"24",vertical:""},{default:t(()=>[a(e(I),{gap:"24"},{default:t(()=>[a(e(j),{placement:"left",title:"Forms"},{content:t(()=>[a(e(B),null,{default:t(()=>[p(" Use to collect user input via interaction with a form interface ")]),_:1}),a(ee,{path:"forms/overview"})]),default:t(()=>[a(e(H),{value:"form",class:"option"},{default:t(()=>[w("div",Le,[(u(),d(P,{key:r.value,path:e(le),fill:r.value},null,8,["path","fill"])),Ye])]),_:1})]),_:1}),a(e(j),{placement:"right",title:"Hooks"},{content:t(()=>[a(e(B),null,{default:t(()=>[p("Use to build endpoints triggered by HTTP requests")]),_:1}),a(ee,{path:"forms/overview"})]),default:t(()=>[a(e(H),{value:"hook",class:"option"},{default:t(()=>[w("div",qe,[(u(),d(P,{key:y.value,path:e(ie),fill:y.value},null,8,["path","fill"])),ze])]),_:1})]),_:1})]),_:1}),a(e(I),{gap:"24"},{default:t(()=>[a(e(j),{placement:"left",title:"Scripts"},{content:t(()=>[a(e(B),null,{default:t(()=>[p(" Use to write plain Python scripts ")]),_:1})]),default:t(()=>[a(e(H),{value:"script",class:"option"},{default:t(()=>[w("div",We,[(u(),d(P,{key:g.value,path:e(ne),fill:g.value},null,8,["path","fill"])),Xe])]),_:1})]),_:1}),a(e(j),{placement:"right",title:"Jobs"},{content:t(()=>[a(e(B),null,{default:t(()=>[p(" Use to schedule your script execution periodically ")]),_:1})]),default:t(()=>[a(e(H),{value:"job",class:"option"},{default:t(()=>[w("div",Ke,[(u(),d(P,{key:f.value,path:e(re),fill:f.value},null,8,["path","fill"])),Qe])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):C("",!0)}});const et=J(Ze,[["__scopeId","data-v-94df32a7"]]),tt=w("br",null,null,-1),at=T({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(l,{emit:i}){const o=l,{result:r}=V(()=>fetch("/_editor/api/workspace/root").then(v=>v.text())),y=k(()=>o.state.state!=="creating"?"":`${r.value}/${o.state.stage.filename}`),g=k(()=>o.state.state!=="creating"?"":`${o.state.stage.type[0].toUpperCase()+o.state.stage.type.slice(1)} title`),f=v=>{i("update-name",v);const c=Ee(v);i("update-file",c),h()},{result:_,refetch:h}=V(()=>oe.checkFile(o.state.stage.filename)),s=k(()=>pe(o.state.stage.filename));return(v,c)=>(u(),d(e(ue),{layout:"vertical"},{default:t(()=>{var A;return[a(e(O),{label:g.value,required:!0},{default:t(()=>[a(e(K),{value:v.state.stage.title,"onUpdate:value":f},null,8,["value"])]),_:1},8,["label"]),a(e(O),{label:"Generated file",required:!0,"validate-status":s.value.valid?"success":"error",help:s.value.valid?void 0:s.value.reason},{default:t(()=>[a(e(Ce),{placement:"right"},{title:t(()=>[p(" You can change this later ")]),default:t(()=>[a(e(K),{value:v.state.stage.filename,"onUpdate:value":c[0]||(c[0]=G=>v.state.stage.filename=G),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["validate-status","help"]),a(e(O),null,{default:t(()=>[a(e(F),null,{default:t(()=>[p(" Your script will be generated at: ")]),_:1}),tt,a(e(F),{code:""},{default:t(()=>[p(N(y.value),1)]),_:1})]),_:1}),(A=e(_))!=null&&A.exists?(u(),d(e(Me),{key:0,type:"warning"},{message:t(()=>[a(e(F),null,{default:t(()=>[a(e(F),{strong:""},{default:t(()=>[p("Warning:")]),_:1}),p(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):C("",!0)]}),_:1}))}}),st=T({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(l,{emit:i}){const o=l,r=c=>i("update-name",c),y=c=>i("update-file",c),g=()=>i("close"),f=c=>i("choose-type",c),_=()=>i("next-step"),h=()=>i("previous-step"),s=()=>i("create-script"),v=k(()=>!(o.state.state!=="creating"||!pe(o.state.stage.filename).valid||!o.state.stage.title));return(c,A)=>(u(),d(e(De),{open:c.open,title:"Create a new script",onCancel:g},{footer:t(()=>[c.state.state==="creating"?(u(),d(e(L),{key:0,onClick:h},{default:t(()=>[p("Previous")]),_:1})):C("",!0),c.state.state==="creating"?(u(),d(e(L),{key:1,type:"primary",disabled:!v.value,onClick:s},{default:t(()=>[p(" Create ")]),_:1},8,["disabled"])):C("",!0),c.state.state==="choosing-type"?(u(),d(e(L),{key:2,type:"primary",disabled:!c.state.type,onClick:_},{default:t(()=>[p(" Next ")]),_:1},8,["disabled"])):C("",!0)]),default:t(()=>[c.state.state==="choosing-type"?(u(),d(et,{key:0,state:c.state,onChooseType:f},null,8,["state"])):C("",!0),c.state.state==="creating"?(u(),d(at,{key:1,state:c.state,onUpdateName:r,onUpdateFile:y},null,8,["state"])):C("",!0)]),_:1},8,["open"]))}}),ot=T({__name:"FilterScripts",emits:["update-filter"],setup(l,{emit:i}){const o=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],r=y=>i("update-filter",y);return(y,g)=>(u(),d(e(ue),null,{default:t(()=>[a(e(O),{label:"Filter"},{default:t(()=>[a(e(Fe),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":r},{default:t(()=>[(u(),U(Y,null,se(o,f=>a(e(Ie),{key:f.value,value:f.value},{default:t(()=>[p(N(f.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),lt=200,it=l=>{if(!l)return[0,0];if(l.length===0)return[0,0];let i=-1/0,o=0;for(const r of l)r.position.x>i&&(i=r.position.x),o+=r.position.y/l.length;return[i+lt,o]},nt=l=>{if(l instanceof x)return"form";if(l instanceof $)return"hook";if(l instanceof E)return"job";if(l instanceof M)return"script";throw new Error("Invalid script type")},rt=l=>(q("data-v-f170da7e"),l=l(),z(),l),ct={key:0},pt=rt(()=>w("span",null,"loading",-1)),ut=[pt],te=100,dt=T({__name:"Scripts",setup(l){Te(n=>({"69f5c37e":ye()}));const i=Ae(),{loading:o,result:r,refetch:y}=V(async()=>Promise.all([x.list(),$.list(),E.list(),M.list()]).then(([n,m,b,S])=>[...n,...m,...b,...S])),{result:g}=V(()=>oe.get()),f=Q([]),_=n=>{f.value=n},h=k(()=>r.value?f.value.length===0?r.value:r.value.filter(n=>f.value.includes(nt(n))):[]),s=Q({state:"idle"}),v=k(()=>s.value.state==="choosing-type"||s.value.state==="creating"),c=()=>{s.value={state:"choosing-type",type:null}},A=()=>{s.value={state:"idle"}},G=n=>{s.value.state==="choosing-type"&&(s.value={state:"choosing-type",type:n})},de=()=>{s.value.state==="choosing-type"&&s.value.type!==null&&(s.value={state:"creating",stage:{type:s.value.type,title:`Untitled ${s.value.type}`,filename:`untitled_${s.value.type}.py`}})},fe=()=>{s.value.state==="creating"&&(s.value={state:"choosing-type",type:s.value.stage.type})},_e=n=>{s.value.state==="creating"&&(s.value.stage.title=n)},me=n=>{s.value.state==="creating"&&(s.value.stage.filename=n)},ve=async(n,m)=>{var b,S;await((S=(b=r.value)==null?void 0:b.find(D=>D.id===n))==null?void 0:S.delete(m)),await y()},ye=()=>(te/1e3).toString()+"s",he=async()=>{if(s.value.state!=="creating")return;const n=it(r.value||[]);let m;if(s.value.stage.type==="form"?m=await x.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="hook"?m=await $.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="job"?m=await E.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="script"&&(m=await M.create(s.value.stage.title,s.value.stage.filename,n)),!m)throw new Error("Failed to create script");const b=m.id,S=s.value.stage.type;A(),await y(),setTimeout(()=>{W(b,S)},te)},W=(n,m)=>{var b,S;if(m==="form"&&i.push({name:"formEditor",params:{id:n}}),m==="hook"&&i.push({name:"hookEditor",params:{id:n}}),m==="script"){const D=(b=r.value)==null?void 0:b.find(ge=>ge.id===n);if(!D)return;(S=g.value)==null||S.openFile(D.file)}m==="job"&&i.push({name:"jobEditor",params:{id:n}})};return(n,m)=>(u(),U(Y,null,[e(o)?(u(),U("span",ct,ut)):C("",!0),a(e(je),null,{default:t(()=>[p("Home")]),_:1}),a(ot,{onUpdateFilter:_}),a(e(I),{wrap:"wrap",gap:"large",class:"scripts-container"},{default:t(()=>[a(xe,null,{default:t(()=>[(u(!0),U(Y,null,se(h.value,b=>(u(),d(Pe,{key:b.title,script:b,workspace:e(g),onDelete:ve,onGoToScript:W},null,8,["script","workspace"]))),128))]),_:1}),a(Re,{onClick:c})]),_:1}),a(st,{open:v.value,state:s.value,onClose:A,onChooseType:G,onNextStep:de,onPreviousStep:fe,onCreateScript:he,onUpdateName:_e,onUpdateFile:me},null,8,["open","state"])],64))}});const Vt=J(dt,[["__scopeId","data-v-f170da7e"]]);export{Vt as default};
//# sourceMappingURL=Scripts.cee68be7.js.map

import{d as E,f as v,o as n,c as u,w as a,b as t,u as e,dj as r,bO as Y,Y as b,eb as h,db as q,aG as d,e9 as f,d4 as H,de as p,aS as C,d7 as Q,S as T,a0 as R,X as W,ah as Z,bT as L,el as x,eC as B,F as ee,cA as ae,cB as O,bL as te,cG as se,cN as le,em as ne,en as de,a as oe}from"./index.0c55f17a.js";import{T as re,L as ue}from"./tasksController.58394b92.js";import{t as ie}from"./ant-design.1583a7ca.js";import{F as P}from"./PhArrowSquareOut.vue.e4c92c1b.js";import{_ as G}from"./AbstraButton.vue_vue_type_script_setup_true_lang.b65ad276.js";import{A as ce}from"./index.58d38a04.js";import{C as pe}from"./Card.1b68c184.js";import{A as F,C as ge}from"./CollapsePanel.58d76a21.js";import"./index.19ffc856.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_=new Error().stack;_&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[_]="a9a212a9-ac63-4b2a-9ca5-25ee4d203c22",i._sentryDebugIdIdentifier="sentry-dbid-a9a212a9-ac63-4b2a-9ca5-25ee4d203c22")}catch{}})();const ke=E({__name:"TaskCard",props:{task:{},checked:{type:Boolean},type:{},map:{}},emits:["change"],setup(i,{emit:_}){const c=i,S=(l,o)=>{let y=`/_editor/${l}/${o}`;window.open(`${y}`,"_blank")},w=v(()=>c.task.targetStageTitle.length<15?c.task.targetStageTitle:c.task.targetStageTitle.slice(0,15)+"..."),A=v(()=>c.task.sourceStageTitle.length<15?c.task.sourceStageTitle:c.task.sourceStageTitle.slice(0,15)+"...");return(l,o)=>(n(),u(e(pe),{size:"small"},{default:a(()=>[t(e(r),{justify:"space-between",align:"center"},{default:a(()=>[t(e(r),{align:"start",gap:"large"},{default:a(()=>[t(e(Y),{checked:l.checked,disabled:l.type==="sent",onChange:o[0]||(o[0]=y=>_("change",l.task.id))},null,8,["checked","disabled"]),t(e(r),{vertical:""},{default:a(()=>[(n(!0),b(C,null,h(l.task.payload,(y,I)=>(n(),u(e(r),{key:I},{default:a(()=>[t(e(q),{class:"center"},{default:a(()=>[d(f(I)+":",1)]),_:2},1024),t(e(H),{"tree-data":e(ie)(y),selectable:!1,style:{padding:"0"}},{title:a(({title:g})=>[t(e(p),{type:"secondary",style:{"max-width":"200px"},ellipsis:""},{default:a(()=>[d(f(g),1)]),_:2},1024)]),_:2},1032,["tree-data"])]),_:2},1024))),128))]),_:1})]),_:1}),t(e(r),{align:"center"},{default:a(()=>[t(e(Q),{color:l.map.get(l.task.type)},{default:a(()=>[d(f(l.task.type),1)]),_:1},8,["color"]),t(e(ce),{type:"vertical"}),l.type==="received"&&l.task.sourceStageTitle?(n(),u(e(r),{key:0,align:"center"},{default:a(()=>[t(e(p),{type:"secondary"},{default:a(()=>[d("Sent by: ")]),_:1}),t(G,{type:"link",onClick:o[1]||(o[1]=y=>S(l.task.sourceStageType,l.task.created.byStageId))},{default:a(()=>[d(f(A.value)+" ",1),t(e(P),{size:16})]),_:1})]),_:1})):T("",!0),l.type==="received"&&!l.task.sourceStageTitle?(n(),u(e(r),{key:1,align:"center"},{default:a(()=>[t(e(p),{type:"secondary"},{default:a(()=>[d("Created manually")]),_:1})]),_:1})):T("",!0),l.type==="sent"?(n(),u(e(r),{key:2,align:"center"},{default:a(()=>[t(e(p),{type:"secondary"},{default:a(()=>[d("Sent to: ")]),_:1}),t(G,{type:"link",onClick:o[2]||(o[2]=y=>S(l.task.targetStageType,l.task.targetStageId))},{default:a(()=>[d(f(w.value)+" ",1),t(e(P),{size:16})]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}))}});const N=R(ke,[["__scopeId","data-v-e1b117c5"]]),fe=i=>(ne("data-v-f5e9bb62"),i=i(),de(),i),ye=fe(()=>oe("code",null,"send_task",-1)),_e=E({__name:"TasksManager",props:{stageId:{}},emits:["refetch-tasks"],setup(i,{emit:_}){const c=i,S=new ue,w=k=>{k(),_("refetch-tasks",c.stageId)},{setup:A,tearDown:l,state:o,createTask:y,startCreatingTask:I,creatingTaskState:g,cancelCreatingTask:J,isPayloadValid:V,collapseValue:$,getPossibleActions:K,checkTask:M}=re({api:S,poll:!1,stageId:c.stageId,stages:null}),z=v(()=>o.tasks.filter(k=>k.status==="pending")),U=v(()=>o.tasks.filter(k=>k.status==="completed")),j=v(()=>{var k;return(k=o.sentTasks)!=null?k:[]}),X=v(()=>K());return W(()=>A()),Z(()=>l()),(k,m)=>(n(),u(e(r),{vertical:"",gap:"small",class:"tasks-manager"},{default:a(()=>[t(e(r),{justify:"end",gap:"small"},{default:a(()=>[(n(!0),b(C,null,h(X.value,s=>(n(),u(e(L),{key:s.name,onClick:D=>w(s.handler)},{default:a(()=>[d(f(s.label),1)]),_:2},1032,["onClick"]))),128)),t(e(L),{type:"primary",onClick:x(e(I),["stop"])},{default:a(()=>[d("Add Task")]),_:1},8,["onClick"])]),_:1}),t(e(ge),{"active-key":e($),"onUpdate:activeKey":m[0]||(m[0]=s=>ee($)?$.value=s:null),ghost:""},{default:a(()=>[t(e(F),{key:"pending"},{header:a(()=>[t(e(r),{justify:"space-between"},{default:a(()=>[t(e(p),null,{default:a(()=>[d("Pending tasks : "+f(z.value.length),1)]),_:1})]),_:1})]),default:a(()=>[t(e(r),{vertical:"",gap:"small"},{default:a(()=>[t(B,null,{default:a(()=>[(n(!0),b(C,null,h(z.value,s=>(n(),u(N,{key:s.id+"-pending",task:s,type:"received",map:e(o).colorMap,checked:!!s.checked,onChange:D=>e(M)(s.id)},null,8,["task","map","checked","onChange"]))),128))]),_:1})]),_:1})]),_:1}),t(e(F),{key:"completed"},{header:a(()=>[t(e(p),null,{default:a(()=>[d("Completed tasks : "+f(U.value.length),1)]),_:1})]),default:a(()=>[t(e(r),{vertical:"",gap:"small"},{default:a(()=>[t(B,null,{default:a(()=>[(n(!0),b(C,null,h(U.value,s=>(n(),u(N,{key:s.id+"-completed",task:s,checked:!!s.checked,type:"received",map:e(o).colorMap,onChange:D=>e(M)(s.id)},null,8,["task","checked","map","onChange"]))),128))]),_:1})]),_:1})]),_:1}),t(e(F),{key:"sent"},{header:a(()=>[t(e(p),null,{default:a(()=>[d("Sent tasks : "+f(j.value.length),1)]),_:1})]),default:a(()=>[t(e(r),{vertical:"",gap:"small"},{default:a(()=>[t(B,null,{default:a(()=>[(n(!0),b(C,null,h(j.value,s=>(n(),u(N,{key:s.id+"-sent",task:s,checked:!!s.checked,type:"sent",map:e(o).colorMap,onChange:D=>e(M)(s.id)},null,8,["task","checked","map","onChange"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["active-key"]),t(e(le),{open:e(g).state==="creating","ok-button-props":{disabled:!e(V)},onCancel:e(J),onOk:e(y)},{title:a(()=>[t(e(p),null,{default:a(()=>[d("Add Task")]),_:1})]),default:a(()=>[t(e(ae),{layout:"vertical"},{default:a(()=>[t(e(O),{label:"Task type"},{default:a(()=>[e(g).state==="creating"?(n(),u(e(te),{key:0,value:e(g).name,"onUpdate:value":m[1]||(m[1]=s=>e(g).name=s),"auto-size":""},null,8,["value"])):T("",!0)]),_:1}),t(e(O),{label:"Task data"},{default:a(()=>[e(g).state==="creating"?(n(),u(e(se),{key:0,value:e(g).payloadCode,"onUpdate:value":m[2]||(m[2]=s=>e(g).payloadCode=s),"auto-size":""},null,8,["value"])):T("",!0)]),_:1})]),_:1}),e(V)?T("",!0):(n(),u(e(p),{key:0,type:"danger"},{default:a(()=>[d("Invalid JSON")]),_:1}))]),_:1},8,["open","ok-button-props","onCancel","onOk"]),t(e(p),{type:"secondary"},{default:a(()=>[d(" Use "),ye,d(" on previous stages to send tasks to this stage. ")]),_:1})]),_:1}))}});const Ae=R(_e,[["__scopeId","data-v-f5e9bb62"]]);export{Ae as T};
//# sourceMappingURL=TasksManager.6230fe8b.js.map

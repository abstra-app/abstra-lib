var Me=Object.defineProperty;var Ae=(p,t,i)=>t in p?Me(p,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[t]=i;var ge=(p,t,i)=>(Ae(p,typeof t!="symbol"?t+"":t,i),i);import{_ as Q}from"./AbstraButton.vue_vue_type_script_setup_true_lang.0c71d3aa.js";import{F as $e,I as Le,O as je}from"./os.3a58da32.js";import{d as U,at as R,c as I,o as u,ac as B,ae as Ce,h as W,ed as ze,e as w,f as s,u as e,a as j,b as a,g as x,t as m,df as q,ad as Te,aY as he,_ as pe,dj as E,ej as Pe,f8 as fe,de as ee,i as k,cS as ye,cT as xe,ei as ke,ec as be,el as se,bE as Ze,bD as oe,eh as ue,bW as Be,cM as Ne,eF as Ee,fi as Ve,v as We,r as Z,w as me,ax as De,U as He,S as Fe,A as ie,dd as Ye,eI as Xe,eJ as Ge,eu as Oe,ev as qe}from"./jwt-decode.esm.1ee7cadb.js";import{F as Je}from"./PhArrowSquareOut.vue.4241f31c.js";import{I as _e}from"./PhCopy.vue.2dcec229.js";import{G as Ue}from"./PhPencilSimple.vue.2bf74731.js";import{_ as Ke}from"./vue-flow-background.24b7f8a9.js";import{a as Qe,b as Re,g as ne,u as et,e as tt,M as at}from"./vue-flow-core.db109246.js";import{k as re}from"./router.13d72c72.js";import{a as ve,B as st,b as ot}from"./build.7c599342.js";import{a as it,P as nt}from"./project.6126448c.js";import"./tables.b5e08f5a.js";import{G as rt}from"./PhArrowCounterClockwise.vue.ffcc6fe4.js";import{I as lt}from"./PhCopySimple.vue.dba65d28.js";import{G as dt}from"./PhDotsThreeVertical.vue.13c64f06.js";import{F as ct,G as ut,I as pt,a as gt}from"./PhWebhooksLogo.vue.48942e7d.js";import{g as ft}from"./datetime.dd7b3120.js";import{_ as mt}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang.0c75e3c9.js";import{u as _t}from"./polling.db3f8687.js";import{C as le}from"./Card.e4d9e54b.js";import"./index.1f7d63d4.js";import"./record.28abdbea.js";import"./string.e55f6c4f.js";import"./LoadingOutlined.fe8d90cc.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[t]="79d8719b-8bc0-4490-91ee-c03201da589e",p._sentryDebugIdIdentifier="sentry-dbid-79d8719b-8bc0-4490-91ee-c03201da589e")}catch{}})();const vt=["width","height","fill","transform"],wt={key:0},ht=w("path",{d:"M227.85,46.89a20,20,0,0,0-18.74-18.74c-13.13-.77-46.65.42-74.48,28.24L131,60H74.36a19.83,19.83,0,0,0-14.14,5.86L25.87,100.19a20,20,0,0,0,11.35,33.95l37.14,5.18,42.32,42.32,5.19,37.18A19.88,19.88,0,0,0,135.34,235a20.13,20.13,0,0,0,6.37,1,19.9,19.9,0,0,0,14.1-5.87l34.34-34.35A19.85,19.85,0,0,0,196,181.64V125l3.6-3.59C227.43,93.54,228.62,60,227.85,46.89ZM76,84h31L75.75,115.28l-27.23-3.8ZM151.6,73.37A72.27,72.27,0,0,1,204,52a72.17,72.17,0,0,1-21.38,52.41L128,159,97,128ZM172,180l-27.49,27.49-3.8-27.23L172,149Zm-72,22c-8.71,11.85-26.19,26-60,26a12,12,0,0,1-12-12c0-33.84,14.12-51.32,26-60A12,12,0,1,1,68.18,175.3C62.3,179.63,55.51,187.8,53,203c15.21-2.51,23.37-9.3,27.7-15.18A12,12,0,1,1,100,202Z"},null,-1),yt=[ht],kt={key:1},bt=w("path",{d:"M184,120v61.65a8,8,0,0,1-2.34,5.65l-34.35,34.35a8,8,0,0,1-13.57-4.53L128,176ZM136,72H74.35a8,8,0,0,0-5.65,2.34L34.35,108.69a8,8,0,0,0,4.53,13.57L80,128ZM40,216c37.65,0,50.69-19.69,54.56-28.18L68.18,161.44C59.69,165.31,40,178.35,40,216Z",opacity:"0.2"},null,-1),St=w("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),It=[bt,St],Mt={key:2},At=w("path",{d:"M101.85,191.14C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Zm122-144a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.4,27.07h0L88,108.7A8,8,0,0,1,76.67,97.39l26.56-26.57A4,4,0,0,0,100.41,64H74.35A15.9,15.9,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A16,16,0,0,0,192,181.65V155.59a4,4,0,0,0-6.83-2.82l-26.57,26.56a8,8,0,0,1-11.71-.42,8.2,8.2,0,0,1,.6-11.1l49.27-49.27h0C223.45,91.86,224.6,59.71,223.85,47.12Z"},null,-1),$t=[At],Lt={key:3},jt=w("path",{d:"M221.86,47.24a14,14,0,0,0-13.11-13.1c-12.31-.73-43.77.39-69.88,26.5L133.52,66H74.35a13.9,13.9,0,0,0-9.89,4.1L30.11,104.44a14,14,0,0,0,7.94,23.76l39.13,5.46,45.16,45.16L127.8,218a14,14,0,0,0,23.76,7.92l34.35-34.35a13.91,13.91,0,0,0,4.1-9.89V122.48l5.35-5.35h0C221.46,91,222.59,59.56,221.86,47.24ZM38.11,115a2,2,0,0,1,.49-2L72.94,78.58A2,2,0,0,1,74.35,78h47.17L77.87,121.64l-38.14-5.32A1.93,1.93,0,0,1,38.11,115ZM178,181.65a2,2,0,0,1-.59,1.41L143.08,217.4a2,2,0,0,1-3.4-1.11l-5.32-38.16L178,134.48Zm8.87-73h0L128,167.51,88.49,128l58.87-58.88a78.47,78.47,0,0,1,60.69-23A2,2,0,0,1,209.88,48,78.47,78.47,0,0,1,186.88,108.64ZM100,190.31C95.68,199.84,81.13,222,40,222a6,6,0,0,1-6-6c0-41.13,22.16-55.68,31.69-60a6,6,0,1,1,5,10.92c-7,3.17-22.53,13.52-24.47,42.91,29.39-1.94,39.74-17.52,42.91-24.47a6,6,0,1,1,10.92,5Z"},null,-1),Ct=[jt],zt={key:4},Tt=w("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),Pt=[Tt],xt={key:5},Zt=w("path",{d:"M219.86,47.36a12,12,0,0,0-11.22-11.22c-12-.71-42.82.38-68.35,25.91L134.35,68h-60a11.9,11.9,0,0,0-8.48,3.52L31.52,105.85a12,12,0,0,0,6.81,20.37l39.79,5.55,46.11,46.11,5.55,39.81a12,12,0,0,0,20.37,6.79l34.34-34.35a11.9,11.9,0,0,0,3.52-8.48v-60l5.94-5.94C219.48,90.18,220.57,59.41,219.86,47.36ZM36.21,115.6a3.94,3.94,0,0,1,1-4.09L71.53,77.17A4,4,0,0,1,74.35,76h52L78.58,123.76,39.44,118.3A3.94,3.94,0,0,1,36.21,115.6ZM180,181.65a4,4,0,0,1-1.17,2.83l-34.35,34.34a4,4,0,0,1-6.79-2.25l-5.46-39.15L180,129.65Zm-52-11.31L85.66,128l60.28-60.29c23.24-23.24,51.25-24.23,62.22-23.58a3.93,3.93,0,0,1,3.71,3.71c.65,11-.35,39-23.58,62.22ZM98.21,189.48C94,198.66,80,220,40,220a4,4,0,0,1-4-4c0-40,21.34-54,30.52-58.21a4,4,0,0,1,3.32,7.28c-7.46,3.41-24.43,14.66-25.76,46.85,32.19-1.33,43.44-18.3,46.85-25.76a4,4,0,1,1,7.28,3.32Z"},null,-1),Bt=[Zt],Nt={name:"PhRocketLaunch"},Et=U({...Nt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(p){const t=p,i=R("weight","regular"),h=R("size","1em"),L=R("color","currentColor"),n=R("mirrored",!1),r=I(()=>{var c;return(c=t.weight)!=null?c:i}),o=I(()=>{var c;return(c=t.size)!=null?c:h}),f=I(()=>{var c;return(c=t.color)!=null?c:L}),d=I(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:n?"scale(-1, 1)":void 0);return(c,M)=>(u(),B("svg",ze({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:o.value,height:o.value,fill:f.value,transform:d.value},c.$attrs),[Ce(c.$slots,"default"),r.value==="bold"?(u(),B("g",wt,yt)):r.value==="duotone"?(u(),B("g",kt,It)):r.value==="fill"?(u(),B("g",Mt,$t)):r.value==="light"?(u(),B("g",Lt,Ct)):r.value==="regular"?(u(),B("g",zt,Pt)):r.value==="thin"?(u(),B("g",xt,Bt)):W("",!0)],16,vt))}}),Vt=U({__name:"WorkflowEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(p){const t=p;function i(n,r,o=0){const f=r.center.x-n.center.x,d=r.center.y-n.center.y,c=Math.sqrt(f*f+d*d);if(c===0)return{sourceX:n.center.x,sourceY:n.center.y,targetX:r.center.x,targetY:r.center.y};const M=f/c,_=d/c,b=n.width/2,S=n.height/2;let y=n.center.x,D=n.center.y;Math.abs(M)*S>Math.abs(_)*b?(y=n.center.x+(M>0?b:-b),D=n.center.y+_*b/Math.abs(M)):(y=n.center.x+M*S/Math.abs(_),D=n.center.y+(_>0?S:-S));const v=r.width/2,C=r.height/2;let z=r.center.x,V=r.center.y;return Math.abs(M)*C>Math.abs(_)*v?(z=r.center.x-(M>0?v:-v),V=r.center.y-_*v/Math.abs(M)):(z=r.center.x-M*C/Math.abs(_),V=r.center.y-(_>0?C:-C)),y+=M*o,D+=_*o,z-=M*o,V-=_*o,{sourceX:y,sourceY:D,targetX:z,targetY:V}}function h(n,r){const f={center:{x:n.computedPosition.x+n.dimensions.width/2,y:n.computedPosition.y+n.dimensions.height/2},width:n.dimensions.width,height:n.dimensions.height},c={center:{x:r.computedPosition.x+r.dimensions.width/2,y:r.computedPosition.y+r.dimensions.height/2},width:r.dimensions.width,height:r.dimensions.height};return i(f,c,10)}const L=I(()=>{if(!t.sourceNode||!t.targetNode)return ne({sourceX:0,sourceY:0,targetX:0,targetY:0});if(!t.sourceNode.dimensions.width||!t.targetNode.dimensions.width||!t.sourceNode.dimensions.height||!t.targetNode.dimensions.height)return ne({sourceX:0,sourceY:0,targetX:0,targetY:0});const n=h(t.sourceNode,t.targetNode);return ne(n)});return(n,r)=>{var o,f;return u(),B(he,null,[s(e(Qe),{path:L.value[0],"marker-end":t.markerEnd},null,8,["path","marker-end"]),(f=(o=t.data)==null?void 0:o.props)!=null&&f.taskType?(u(),j(e(Re),{key:0},{default:a(()=>[w("div",{style:Te({transform:`translate(-50%, -50%) translate(${L.value[1]}px,${L.value[2]}px)`}),class:"nodrag nopan edge-label"},[s(e(q),null,{default:a(()=>[x(m(t.data.props.taskType),1)]),_:1})],4)]),_:1})):W("",!0)],64)}}});const Wt=pe(Vt,[["__scopeId","data-v-8f1859d4"]]);class Dt{async list(t){return re.get(`projects/${t}/disabled-stages`)}async disableStage({projectId:t,stageId:i}){return re.patch(`projects/${t}/disabled-stages/${i}`,{enable:!1})}async enableStage({projectId:t,stageId:i}){return re.patch(`projects/${t}/disabled-stages/${i}`,{enable:!0})}}const de=new Dt;class J{constructor(t){ge(this,"id");this.dto=t,this.id=t}static async list(t){return(await de.list(t)).map(h=>new J(h))}static async disableStage({projectId:t,stageId:i}){return de.disableStage({projectId:t,stageId:i})}static async enableStage({projectId:t,stageId:i}){return de.enableStage({projectId:t,stageId:i})}}const Ht=U({__name:"WorkflowStageExecutions",props:{stageId:{},projectId:{},statistics:{}},setup(p){const t=p,i=o=>{if(!o.createdAt||!o.updatedAt)return 0;const f=new Date(o.createdAt).getTime(),d=new Date(o.updatedAt).getTime();return Math.round((d-f)/1e3)},h=I(()=>t.statistics?Math.round(t.statistics.completedTasks/t.statistics.totalTasks*100):0),L=I(()=>{const o=h.value;return o===100?"#52c41a":o>=50?"#1890ff":"#faad14"}),n=o=>ft(o,{weekday:void 0}),r=o=>{if(o<60)return`${Math.round(o)}s`;const f=Math.floor(o/60);if(f<60)return`${f}m`;const d=Math.floor(f/60);return d<24?`${d}h`:`${Math.floor(d/24)}d`};return(o,f)=>(u(),j(e(E),{vertical:"",size:4,style:{width:"100%"}},{default:a(()=>[o.statistics.lastExecutions&&o.statistics.lastExecutions.length>0?(u(),j(e(E),{key:0,size:4,gap:4},{default:a(()=>[(u(!0),B(he,null,Pe(o.statistics.lastExecutions,d=>(u(),j(e(fe),{key:d.id,to:{name:"logs",params:{projectId:o.projectId},query:{executionId:d.id}}},{default:a(()=>[s(e(ye),{title:n(new Date(d.createdAt))},{content:a(()=>[s(e(E),{vertical:"",size:4},{default:a(()=>[s(e(ee),null,{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_status"))+": "+m(d.status),1)]),_:2},1024),d.updatedAt&&d.updatedAt!==d.createdAt?(u(),j(e(ee),{key:0},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_duration"))+": "+m(i(d))+"s ",1)]),_:2},1024)):W("",!0),s(e(ee),null,{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_version"))+": "+m(d.buildId.slice(0,6)),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[s(mt,{status:d.status},null,8,["status"])]),_:2},1032,["title"])]),_:2},1032,["to"]))),128))]),_:1})):W("",!0),o.statistics.totalTasks>0?(u(),j(e(fe),{key:1,to:{name:"tasks",params:{projectId:o.projectId},query:{stage:o.stageId,status:"pending"}}},{default:a(()=>[s(e(E),{vertical:"",size:2},{default:a(()=>[s(e(xe),{"show-info":!1,percent:h.value,"stroke-color":L.value,size:"small"},null,8,["percent","stroke-color"]),s(e(E),{vertical:"",size:0},{default:a(()=>[o.statistics.pendingTasks>0&&o.statistics.averageCompletionSeconds?(u(),j(e(ee),{key:0,type:"secondary",style:{fontSize:"11px"}},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_pending_tasks").replace("{count}",o.statistics.pendingTasks.toString()))+" ("+m(r(o.statistics.averageCompletionSeconds))+" "+m(e(k).translate("i18n_workflowviewer_average"))+") ",1)]),_:1})):W("",!0)]),_:1})]),_:1})]),_:1},8,["to"])):W("",!0)]),_:1}))}}),Ft={class:"stage-content"},Yt={class:"stage-title"},Xt={class:"action-item"},Gt={class:"action-item"},Ot={class:"action-warning"},qt={key:1,class:"action-item"},we="3.18.0",Jt=U({__name:"WorkflowStageNode",props:{stage:{},statistics:{},disabledStages:{},project:{},buildSpec:{}},emits:["refetch-disabled-stages"],setup(p,{emit:t}){const i=p,h=ke(),L=be(),n=h.params.projectId,r=I(()=>({forms:ct,hooks:ut,scripts:pt,jobs:gt})[i.stage.type]),o=()=>{L.push({name:"logs",params:{projectId:n},query:{stageId:i.stage.id}})},f=I(()=>i.stage.type==="forms"||i.stage.type==="hooks"),d=()=>{var z;if(!i.stage.path)return;const v=i.stage.type==="forms"?`/${i.stage.path}`:`/_hooks/${i.stage.path}`,C=(z=i.project)==null?void 0:z.getUrl(v);!C||(navigator.clipboard.writeText(C),Ne.success(k.translate("i18n_workflowviewer_copied_url")))},c=I(()=>{var v;return(v=i.disabledStages)==null?void 0:v.map(C=>C.id).includes(i.stage.id)}),M=(v,C)=>{const[z,V,K]=v.split(".").map(Number),[X,F,ae]=C.split(".").map(Number);return z>X?!0:z<X?!1:V>F?!0:V<F?!1:K>=ae},_=I(()=>c.value?Ee:Ve),b=I(()=>c.value?k.translate("i18n_workflowviewer_enable_stage"):k.translate("i18n_workflowviewer_disable_stage")),S=I(()=>{var v;return!M(((v=i.buildSpec)==null?void 0:v.abstraVersion)||"0.0.0",we)}),y=I(()=>S.value?k.translate("i18n_workflowviewer_disable_stages_warning").replace("{version}",we):""),D=async()=>{S.value||(c.value?await J.enableStage({projectId:n,stageId:i.stage.id}):await J.disableStage({projectId:n,stageId:i.stage.id}),await t("refetch-disabled-stages"))};return(v,C)=>(u(),B("div",{class:ue(["stage-node",{disabled:c.value}])},[w("div",Ft,[(u(),j(se(r.value),{size:18,class:"stage-icon"})),w("div",Yt,m(v.stage.title),1),s(e(Be),{trigger:["click"]},{overlay:a(()=>[s(e(Ze),null,{default:a(()=>[s(e(oe),{onClick:o},{default:a(()=>[w("div",Xt,[s(e(rt),{size:16}),w("span",null,m(e(k).translate("i18n_workflowviewer_view_logs")),1)])]),_:1}),f.value?(u(),j(e(oe),{key:0,onClick:d},{default:a(()=>[w("div",Gt,[s(e(lt),{size:16}),w("span",null,m(e(k).translate("i18n_workflowviewer_copy_url")),1)])]),_:1})):W("",!0),s(e(oe),{onClick:D},{default:a(()=>[S.value?(u(),j(e(ye),{key:0,placement:"left"},{content:a(()=>[w("div",Ot,[s(e(q),null,{default:a(()=>[x(m(y.value),1)]),_:1})])]),default:a(()=>[w("div",{class:ue(["action-item",{disabled:S.value}])},[(u(),j(se(_.value),{size:16})),w("span",null,m(b.value),1)],2)]),_:1})):(u(),B("div",qt,[(u(),j(se(_.value),{size:16})),w("span",null,m(b.value),1)]))]),_:1})]),_:1})]),default:a(()=>[s(e(dt),{style:{cursor:"pointer"},size:20,class:"actions-menu"})]),_:1})]),v.statistics?(u(),j(Ht,{key:0,"stage-id":v.stage.id,"project-id":e(n),statistics:v.statistics,style:{"margin-top":"8px"}},null,8,["stage-id","project-id","statistics"])):W("",!0)],2))}});const te=pe(Jt,[["__scopeId","data-v-1c61a077"]]),Ut=We("workflow",()=>{const p=Z([]),t=Z(null),i=Z(!1);let h=null,L=null,n=null,r=[];async function o(){if(!L||!n){console.warn("Cannot load data: no project context set");return}i.value=!0;try{const _=await n.getWorkflowStatistics(L),b=new Set(r),S=new Map(_.filter(y=>b.has(y.stageId)).map(y=>[y.stageId,y]));p.value=r.map(y=>S.has(y)?S.get(y):{stageId:y,lastExecutions:[],pendingTasks:0,lockedTasks:0,completedTasks:0,averageCompletionSeconds:void 0,totalTasks:0}),t.value=await J.list(L)}catch(_){console.error("Failed to load workflow data:",_)}finally{i.value=!1}}function f(_,b,S){if(h&&h.endPolling(),n=_,L=b,r=S,S.length>0){const y=_t({task:o,interval:15e3});h=y,o(),y.startPolling()}}function d(){h&&(h.endPolling(),h=null)}function c(){d(),p.value=[],t.value=null,i.value=!1,L=null,n=null,r=[]}const M=I(()=>_=>p.value.find(b=>b.stageId===_)||null);return{statistics:p,disabledStages:t,loading:i,getStatisticsForStage:M,initializePolling:f,stopPolling:d,resetStore:c,refetch:o}}),Se=p=>(Oe("data-v-a90f8899"),p=p(),qe(),p),Kt={class:"flow-container"},Qt={class:"code-container"},Rt=Se(()=>w("code",{class:"install-code"},"pip install abstra",-1)),ea={class:"code-container"},ta=Se(()=>w("code",{class:"install-code"},"abstra editor .",-1)),aa={key:0,class:"edit-button-text"},ce="#ea576a",sa=U({__name:"WorkflowViewer",setup(p){const{onInit:t}=et(),i=new ot,h=ke(),L=be(),n=h.params.projectId,r=h.query.buildId,o=Z(!0),f=Z(null),d=Z(!0),c=Z(!1),M=()=>{L.push({name:"web-editor",params:{projectId:n}})},_=async A=>{try{await navigator.clipboard.writeText(A)}catch(l){console.error("Failed to copy:",l)}};t(A=>{d.value&&(A.fitView(),d.value=!1)});const b=Z([]),S=Z([]),y=I(()=>b.value.map(A=>A.id)),D=new nt,v=Ut(),C=I(()=>v.statistics),z=Z();me(y,A=>{v.initializePolling(D,n,A)},{immediate:!0}),De(()=>{v.stopPolling()});const V=Z(!1),K=I(()=>b.value.length>0&&V.value),X=A=>b.value.map(l=>({id:l.id,type:l.type,data:{stage:l,statistics:A.find(g=>g.stageId===l.id)||null},position:{x:l.position.x,y:l.position.y*1.5}})),F=Z(X(C.value));me(()=>C.value,()=>{F.value=X(C.value)});const ae=I(()=>{const A=new Set(F.value.map(l=>l.id));return S.value.filter(l=>{const g=A.has(l.sourceStageId),Y=A.has(l.targetStageId);return g&&Y}).map(l=>({id:l.id,source:l.sourceStageId,target:l.targetStageId,type:"task",data:{id:l.id,props:{taskType:l.taskType}},markerEnd:{type:at.Arrow,width:24,height:24}}))});function Ie(A){const l=[],g=[],Y=["jobs","hooks","forms","scripts"];for(const P of Y){const $=A[P]||[];for(const T of $){l.push({id:T.id,type:P,title:T.title,position:{x:T.workflow_position[0],y:T.workflow_position[1]},file:T.file,path:T.path,schedule:T.schedule});for(const H of T.transitions||[])g.push({id:H.id,sourceStageId:T.id,targetStageId:H.target_id,taskType:H.task_type})}}const N=new Set(l.map(P=>P.id)),O=g.filter(P=>N.has(P.sourceStageId)&&N.has(P.targetStageId));b.value=l,S.value=O,V.value=!0}const G=Z();return He(async()=>{var A,l,g,Y;try{o.value=!0,z.value=await it.get(n);let N;if(r){const T=(await ve.list(n)).find(H=>H.id===r);if(!T){f.value="Build not found";return}N=T}else{const T=(await ve.list(n)).find(H=>H.latest);if(!T){f.value="No builds found for this project";return}N=T}const O=await i.get(N.id);if(!O||!O.abstraJson){f.value="No workflow data available for this build";return}const P=JSON.parse(O.abstraJson);Ie(P),G.value=st.fromDTO(n,N.id,P.version,{forms:((A=P.forms)==null?void 0:A.map($=>({id:$.id,path:$.path,title:$.title})))||[],hooks:((l=P.hooks)==null?void 0:l.map($=>({id:$.id,path:$.path,title:$.title})))||[],jobs:((g=P.jobs)==null?void 0:g.map($=>({id:$.id,schedule:$.schedule,title:$.title})))||[],scripts:((Y=P.scripts)==null?void 0:Y.map($=>({id:$.id,title:$.title})))||[]})}catch(N){f.value=N instanceof Error?N.message:"Failed to load workflow",console.error(N)}finally{o.value=!1}}),(A,l)=>(u(),B("div",Kt,[o.value?(u(),j(e(Fe),{key:0,style:{width:"100%"}})):K.value?(u(),j(e(tt),{key:`workflow-${b.value.length}-${S.value.length}`,nodes:F.value,edges:ae.value,"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.1,"max-zoom":1.25,"pan-on-scroll":e(je).isMac,"snap-to-grid":""},{"edge-task":a(g=>[s(Wt,Xe(Ge(g)),null,16)]),"node-forms":a(g=>[s(te,{stage:g.data.stage,statistics:g.data.statistics,project:z.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),"node-hooks":a(g=>[s(te,{stage:g.data.stage,statistics:g.data.statistics,project:z.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),"node-scripts":a(g=>[s(te,{stage:g.data.stage,statistics:g.data.statistics,project:z.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),"node-jobs":a(g=>[s(te,{stage:g.data.stage,statistics:g.data.statistics,project:z.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),default:a(()=>[s(e(Ke),{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","pan-on-scroll"])):(u(),j(e(le),{key:1,class:"empty-state-card"},{default:a(()=>[s(e(E),{vertical:"",gap:24,align:"center"},{default:a(()=>[s(e(Et),{size:64,color:ce}),s(e(E),{vertical:"",gap:8,align:"center"},{default:a(()=>[s(e(ie),{level:3},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_getting_started")),1)]),_:1}),s(e(q),{type:"secondary",style:{"text-align":"center"}},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_no_workflow_description")),1)]),_:1})]),_:1}),s(e(E),{gap:16,wrap:"wrap",justify:"center"},{default:a(()=>[s(e(le),{class:"option-card"},{default:a(()=>[s(e(E),{vertical:"",gap:12},{default:a(()=>[s(e($e),{size:32,color:ce}),s(e(ie),{level:5},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_option_cli")),1)]),_:1}),s(e(q),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_cli_description")),1)]),_:1}),s(e(E),{vertical:"",gap:8},{default:a(()=>[w("div",Qt,[Rt,s(Q,{type:"text",size:"small",onClick:l[0]||(l[0]=g=>_("pip install abstra"))},{default:a(()=>[s(e(_e),{size:16})]),_:1})]),w("div",ea,[ta,s(Q,{type:"text",size:"small",onClick:l[1]||(l[1]=g=>_("abstra editor ."))},{default:a(()=>[s(e(_e),{size:16})]),_:1})])]),_:1})]),_:1})]),_:1}),s(e(le),{class:"option-card"},{default:a(()=>[s(e(E),{vertical:"",gap:12},{default:a(()=>[s(e(Le),{size:32,color:ce}),s(e(ie),{level:5},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_option_online")),1)]),_:1}),s(e(q),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_online_description")),1)]),_:1}),s(Q,{type:"primary",onClick:M},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_open_editor")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(Ye),{href:"https://www.abstra.io/docs",target:"_blank"},{default:a(()=>[x(m(e(k).translate("i18n_workflowviewer_view_docs"))+" ",1),s(e(Je),{size:14,style:{"margin-left":"4px"}})]),_:1})]),_:1})]),_:1})),!o.value&&K.value?(u(),j(Q,{key:3,class:ue(["edit-button",{expanded:c.value}]),type:"primary",size:"large",onClick:M,onMouseenter:l[2]||(l[2]=g=>c.value=!0),onMouseleave:l[3]||(l[3]=g=>c.value=!1)},{default:a(()=>[s(e(Ue),{size:24}),c.value?(u(),B("span",aa,m(e(k).translate("i18n_workflowviewer_edit_online")),1)):W("",!0)]),_:1},8,["class"])):W("",!0)]))}});const ja=pe(sa,[["__scopeId","data-v-a90f8899"]]);export{ja as default};
//# sourceMappingURL=WorkflowViewer.f2a8041a.js.map

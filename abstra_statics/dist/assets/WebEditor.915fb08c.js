var _=Object.defineProperty;var m=(t,e,i)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var n=(t,e,i)=>(m(t,typeof e!="symbol"?e+"":e,i),i);import{d as g,J as v,I as y,a as l,b as s,o as c,f as a,u as r,de as h,cO as b,A as w,g as d,da as u,_ as I,r as P,eb as x}from"./jwt-decode.esm.17444e35.js";import{_ as W}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.999b1832.js";import{B as j}from"./BaseLayout.4b142ff5.js";import{l as f}from"./fetch.8d3bfac3.js";import"./router.60397891.js";import{a as A}from"./project.25ddb4fc.js";import"./tables.b1edb5fa.js";import"./Logo.37b68641.js";import"./index.5e1035be.js";import"./record.1229e418.js";import"./string.fc9538f8.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="0f9c3c6a-fda9-4b41-83b1-6ebffd1132b9",t._sentryDebugIdIdentifier="sentry-dbid-0f9c3c6a-fda9-4b41-83b1-6ebffd1132b9")}catch{}})();const T=g({__name:"View",props:{controller:{}},setup(t){const e=t,i=e.controller.loadingPercentage();return v(()=>{e.controller.start()}),y(()=>{e.controller.cleanUp()}),(o,p)=>(c(),l(j,null,{content:s(()=>[a(r(h),{align:"center",justify:"center",style:{width:"100vw",height:"100dvh"}},{default:s(()=>[a(r(h),{gap:"large",align:"center",justify:"space-evenly",vertical:"",style:{width:"45%","min-width":"600px",height:"100%"}},{default:s(()=>[a(W,{size:"large"}),a(r(b),{size:[10,10],"show-info":!1,percent:r(i),"stroke-color":"#EA576A"},null,8,["percent"]),a(r(w),{level:3},{default:s(()=>[d("Preparing your environment")]),_:1}),r(i)<100?(c(),l(r(u),{key:0},{default:s(()=>[d("We are setting things up... This may take up to 1 minute.")]),_:1})):(c(),l(r(u),{key:1},{default:s(()=>[d("You will be redirected soon")]),_:1}))]),_:1})]),_:1})]),_:1}))}});const k=I(T,[["__scopeId","data-v-0794e790"]]);class R{constructor(e,i,o=f){n(this,"projectId");n(this,"loading");n(this,"fetch",f);n(this,"interval",null);n(this,"urls",null);n(this,"totalWaitTime");n(this,"poolingInterval");n(this,"pingResponded",!1);n(this,"redirectPath");this.projectId=e,this.loading=P(0),this.fetch=o,this.totalWaitTime=6e4,this.poolingInterval=2500,this.redirectPath=i}increment(){this.loading.value+=100/(this.totalWaitTime/this.poolingInterval)}speedUp(){this.totalWaitTime=5e3,this.poolingInterval=500,this.interval&&clearInterval(this.interval),this.interval=setInterval(async()=>{this.increment(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}navigate(){if(this.urls){const e=new URLSearchParams;this.redirectPath&&e.set("redirect",this.redirectPath),window.location.replace(this.urls.redirect+"?"+e.toString())}this.cleanUp()}async ping(){if(!this.urls)return!1;if(this.pingResponded)return!0;const e=await this.fetch(this.urls.ping,{signal:AbortSignal.timeout(500)});return this.pingResponded=e.status===200,this.pingResponded}async start(){const e=await A.startWebEditor(this.projectId);this.urls=e,this.interval=setInterval(async()=>{this.increment(),this.pingResponded||await this.ping()&&this.speedUp(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}cleanUp(){this.interval&&clearInterval(this.interval)}loadingPercentage(){return this.loading}}const J=g({__name:"WebEditor",setup(t){const e=x(),i=e.params.projectId,o=e.query.redirect,p=new R(i,o);return(U,E)=>(c(),l(k,{controller:r(p)},null,8,["controller"]))}});export{J as default};
//# sourceMappingURL=WebEditor.915fb08c.js.map

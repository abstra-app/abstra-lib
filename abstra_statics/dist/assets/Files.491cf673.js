import{_ as O}from"./DocsButton.vue_vue_type_script_setup_true_lang.86b0bfda.js";import{F as P,I as R,S as U,a as q}from"./ImageViewer.24bf7bc0.js";import{z as H,d as M,eA as D,r as g,U as E,R as $,o as u,ac as w,f as i,u as l,S as z,e as x,t as v,ae as W,_ as L,w as S,b as m,g as I,i as j,A as J,de as Y,dj as B,aY as G,eB as K,a as F,eD as Q,h as X}from"./jwt-decode.esm.5418d57c.js";import"./router.2fd242d8.js";import{F as N}from"./file.53626e89.js";import"./tables.3dfd442e.js";import{e as V}from"./toggleHighContrast.fab10c86.js";import{G as Z}from"./PhFolderPlus.vue.b23bfff6.js";import{T as ee,A,C as te}from"./Card.ee51917c.js";import"./constants.59600c3d.js";import"./asyncComputed.a3796583.js";import"./string.eaee8887.js";import"./PhArrowUp.vue.4abeeac9.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.f6b886f2.js";import"./ScrollArea.vue_vue_type_script_setup_true_lang.0ee19f03.js";import"./index.74ea4823.js";import"./UploadOutlined.fdbcd90e.js";import"./xlsx.89ea120e.js";import"./index.173b7964.js";import"./record.44a28a42.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="0d0100e2-5374-4326-aa49-89b89171c573",r._sentryDebugIdIdentifier="sentry-dbid-0d0100e2-5374-4326-aa49-89b89171c573")}catch{}})();class ae{constructor(e){this.filesModel=e}async list(e){const n=await this.filesModel.list(e.limit||20,e.offset||0,e.search,e.path);return{items:n.items.map(p=>this.mapToFileItem(p)),totalCount:n.totalCount}}async upload(e,n){await this.filesModel.upload(e,n)}async delete(e){await this.filesModel.delete(e)}async download(e){return await this.filesModel.download(e)}async createFolder(e){await this.filesModel.createFolder(e)}async move(e,n){await this.filesModel.move(e,n)}async preview(e){const n=await this.filesModel.download(e),p=e.split("/").pop()||e,{FileTypeHelper:_}=await H(()=>import("./ImageViewer.24bf7bc0.js").then(c=>c.f),["assets/ImageViewer.24bf7bc0.js","assets/asyncComputed.a3796583.js","assets/jwt-decode.esm.5418d57c.js","assets/jwt-decode.6e4bcae0.css","assets/string.eaee8887.js","assets/PhArrowUp.vue.4abeeac9.js","assets/PhFolderPlus.vue.b23bfff6.js","assets/AbstraButton.vue_vue_type_script_setup_true_lang.f6b886f2.js","assets/ScrollArea.vue_vue_type_script_setup_true_lang.0ee19f03.js","assets/index.74ea4823.js","assets/UploadOutlined.fdbcd90e.js","assets/router.2fd242d8.js","assets/index.173b7964.js","assets/xlsx.89ea120e.js","assets/ImageViewer.7b9f20c0.css"]),t=_.getMimeType(p);return{blob:new Blob([n],{type:t}),mimeType:t}}mapToFileItem(e){return{name:e.name,path:e.path,type:e.type,size:e.sizeBytes,_original:e}}}const se={key:0,class:"loading-container"},oe={key:1,class:"error-container"},le={class:"error-message"},ne=M({__name:"ConsoleFileAdapter",props:{filePath:{},loadingText:{default:"Loading file..."}},setup(r){const e=r,p=D().params.projectId,_=g(!0),t=g(null),a=g(null),c=g(null),T=y=>{const f=y.toLowerCase().split(".").pop();return["txt","md","json","js","ts","jsx","tsx","py","html","css","scss","yaml","yml","xml","sql","sh","vue","csv"].includes(f||"")};return E(async()=>{try{const f=await N.fromProjectId(p).download(e.filePath);if(f.size<1e3){const C=await f.slice(0,f.size,f.type).text();if(C.includes("<!DOCTYPE")||C.includes("<html"))throw new Error("Downloaded file appears to be an HTML error page")}if(a.value=URL.createObjectURL(f),T(e.filePath)&&(c.value=await f.text(),e.filePath.toLowerCase().endsWith(".json")))try{const b=JSON.parse(c.value);c.value=JSON.stringify(b,null,2)}catch{}}catch(y){t.value=`Failed to load file: ${String(y)}`}finally{_.value=!1}}),$(()=>{a.value&&URL.revokeObjectURL(a.value)}),(y,f)=>_.value?(u(),w("div",se,[i(l(z),{size:"large"}),x("p",null,v(r.loadingText),1)])):t.value?(u(),w("div",oe,[x("p",le,v(t.value),1)])):W(y.$slots,"default",{key:2,blobUrl:a.value,fileContent:c.value},void 0,!0)}});const ie=L(ne,[["__scopeId","data-v-3ce1506a"]]),re={key:0,class:"loading-container"},ce={key:1,class:"error-container"},de={class:"error-message"},ue=M({__name:"CodeViewer",props:{content:{},language:{default:"plaintext"},loadingText:{default:"Loading..."},readonly:{type:Boolean,default:!0}},setup(r){const e=r,n=g(!1),p=g(null),_=g();let t=null;return E(()=>{if(!!_.value)try{t=V.create(_.value,{value:e.content,language:e.language,readOnly:e.readonly,theme:"vs",automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",renderWhitespace:"selection",folding:!0,wordWrap:"on",quickSuggestions:!1,parameterHints:{enabled:!1},suggestOnTriggerCharacters:!1,acceptSuggestionOnCommitCharacter:!1,tabCompletion:"off",wordBasedSuggestions:!1})}catch(a){console.error("[CodeViewer] Failed to create editor:",a),p.value=`Failed to create editor: ${String(a)}`}}),S(()=>e.content,a=>{t&&a!==t.getValue()&&t.setValue(a)}),S(()=>e.language,a=>{if(t){const c=t.getModel();c&&V.setModelLanguage(c,a)}}),$(()=>{t==null||t.dispose()}),(a,c)=>n.value?(u(),w("div",re,[i(l(z),{size:"large"}),x("p",null,v(r.loadingText),1)])):p.value?(u(),w("div",ce,[x("p",de,v(p.value),1)])):(u(),w("div",{key:2,ref_key:"editorContainer",ref:_,class:"code-viewer-container"},null,512))}});const pe=L(ue,[["__scopeId","data-v-f3162ce8"]]),fe={class:"files-container"},me={class:"tab-content"},_e=M({__name:"Files",setup(r){const n=D().params.projectId,p=N.fromProjectId(n),_=new ae(p),t=g("all-files"),a=g([]);function c(o){const d=o.split("/").pop()||o,s=a.value.find(k=>k.path===o);if(s){t.value=s.key;return}const h={key:`file-${Date.now()}`,name:d,path:o};a.value.push(h),t.value=h.key}function T(o,d){if(d==="remove"&&typeof o=="string"){const s=a.value.findIndex(h=>h.key===o);s!==-1&&(a.value.splice(s,1),a.value.length>0?t.value=a.value[Math.max(0,s-1)].key:t.value="all-files")}}function y(o){return q.getFileIcon(o)}function f(o){const d=o.toLowerCase().split(".").pop();return["jpg","jpeg","png","gif","webp","svg","bmp","ico"].includes(d||"")}function b(o){const d=o.toLowerCase().split(".").pop();return["xlsx","xls","csv"].includes(d||"")}function C(o){const d=o.toLowerCase().split(".").pop();return{json:"json",py:"python",js:"javascript",ts:"typescript",jsx:"javascript",tsx:"typescript",html:"html",css:"css",scss:"scss",md:"markdown",yaml:"yaml",yml:"yaml",xml:"xml",sql:"sql",sh:"shell",vue:"vue"}[d||""]||"plaintext"}return(o,d)=>(u(),w("div",fe,[i(l(J),null,{default:m(()=>[I(v(l(j).translate("i18n_filesview_title")),1)]),_:1}),i(l(Y),null,{default:m(()=>[I(v(l(j).translate("i18n_filesview_description"))+" ",1),i(O,{path:"tools/files"})]),_:1}),i(l(te),{class:"files-card"},{default:m(()=>[i(l(ee),{"active-key":t.value,"onUpdate:activeKey":d[0]||(d[0]=s=>t.value=s),"hide-add":"",type:"editable-card",size:"small",onEdit:T},{default:m(()=>[i(l(A),{key:"all-files",closable:!1},{tab:m(()=>[i(l(B),{align:"center",gap:"small"},{default:m(()=>[i(l(Z),{size:16}),x("span",null,v(l(j).translate("i18n_filesview_all_files")),1)]),_:1})]),default:m(()=>[i(P,{repository:l(_),"show-pagination":!0,"enable-preview":!1,"enable-move":!0,"on-open":c},null,8,["repository"])]),_:1}),(u(!0),w(G,null,K(a.value,s=>(u(),F(l(A),{key:s.key,closable:!0},{tab:m(()=>[i(l(B),{align:"center",gap:"small"},{default:m(()=>[(u(),F(Q(y(s.name)),{size:16})),I(" "+v(s.name),1)]),_:2},1024)]),default:m(()=>[x("div",me,[i(ie,{"file-path":s.path},{default:m(({blobUrl:h,fileContent:k})=>[f(s.name)&&h?(u(),F(R,{key:0,src:h},null,8,["src"])):b(s.name)?(u(),F(U,{key:1,"file-path":s.path},null,8,["file-path"])):k?(u(),F(pe,{key:2,content:k,language:C(s.name)},null,8,["content","language"])):X("",!0)]),_:2},1032,["file-path"])])]),_:2},1024))),128))]),_:1},8,["active-key"])]),_:1})]))}});const Ee=L(_e,[["__scopeId","data-v-2b221937"]]);export{Ee as default};
//# sourceMappingURL=Files.491cf673.js.map

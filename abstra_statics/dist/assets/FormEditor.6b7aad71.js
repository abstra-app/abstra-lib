import{R as ue,F as ie,r as ee}from"./FormRunner.69073e6e.js";import{f as a,eF as te,d as U,r as P,G as x,b as g,c as h,w as r,az as m,eC as $,u as e,bX as B,cC as ae,F as de,H as re,ez as oe,ew as R,eu as G,eB as ce,cG as pe,bQ as w,b6 as me,bx as fe,e as ve,bR as W,eA as ge,eI as ye}from"./outputWidgets.e350d8e4.js";import{R as he,S as be,L as we}from"./RuntimeCommonSettings.cc0f5939.js";import{B as _e}from"./BaseLayout.b0581931.js";import{a as le}from"./asyncComputed.11f5ac08.js";import{F as ke}from"./forms.18b318ed.js";import{W as ne}from"./workspaces.d55c46a0.js";import{l as Y,N as xe}from"./NavbarControls.28e8594f.js";import"./index.8e7b7695.js";import{C as Se,A as Pe}from"./CollapsePanel.21107047.js";import{A as X}from"./index.4fdbc10f.js";import{a as F}from"./index.6d013bd4.js";import{A as v,F as se}from"./Form.b043e834.js";import{A as Oe}from"./index.ecead728.js";import{A as Ae}from"./index.310b827e.js";import{A as T}from"./Title.f9a2b403.js";import{A as J,T as Re}from"./TabPane.2086b8e4.js";import"./index.e89916aa.js";import{c as Le}from"./index.8a6c1078.js";import"./url.958bb521.js";import"./index.4993d509.js";import"./pubsub.dd4743a2.js";import"./icons.2c394e63.js";import"./CircularLoading.d2abb58c.js";import"./PlayerNavbar.dd8fc9d1.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.a8f037ab.js";import"./WidgetsFrame.30d75202.js";import"./uuid.1fc6eff2.js";import"./scripts.efa04b3e.js";import"./record.8c9e165d.js";import"./popupNotifcation.c1aedb4f.js";import"./SaveButton.vue_vue_type_script_setup_true_lang.914c9988.js";import"./ant-design.7e214e2a.js";import"./index.7f484079.js";import"./Text.1223a40d.js";import"./index.5f655278.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new Error().stack;l&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[l]="830de789-5884-4fd9-999c-19ae59bb5d87",s._sentryDebugIdIdentifier="sentry-dbid-830de789-5884-4fd9-999c-19ae59bb5d87")}catch{}})();var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"};const Ce=Te;var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const Be=$e;function Z(s){for(var l=1;l<arguments.length;l++){var t=arguments[l]!=null?Object(arguments[l]):{},u=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),u.forEach(function(o){Ue(s,o,t[o])})}return s}function Ue(s,l,t){return l in s?Object.defineProperty(s,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[l]=t,s}var I=function(l,t){var u=Z({},l,t.attrs);return a(te,Z({},u,{icon:Ce}),null)};I.displayName="ExpandOutlined";I.inheritAttrs=!1;const De=I;function K(s){for(var l=1;l<arguments.length;l++){var t=arguments[l]!=null?Object(arguments[l]):{},u=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),u.forEach(function(o){Ee(s,o,t[o])})}return s}function Ee(s,l,t){return l in s?Object.defineProperty(s,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[l]=t,s}var q=function(l,t){var u=K({},l,t.attrs);return a(te,K({},u,{icon:Be}),null)};q.displayName="LinkOutlined";q.inheritAttrs=!1;const Fe=q,Ie=U({__name:"LaunchButton",props:{path:{}},setup(s){const l=s,t=P({state:"loading"}),u=x(()=>t.value.state!=="found"),o=x(()=>t.value.state==="loading"),i=x(()=>t.value.state==="found"?t.value.url:void 0),n=x(()=>{switch(t.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${t.value}`)}}),L=x(()=>{switch(t.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${t.value}`)}});async function k(f){const c=`https://${f}.abstra.app/_version`;return(await fetch(c)).ok}async function O(f){const c=`https://${f}.abstra.app/_pages/${l.path}`;return(await fetch(c)).ok}async function A(){if(!(await Y.get()).logged){t.value={state:"not-logged"};return}const c=await Y.getProjectInfo().catch(()=>null);if(!c){t.value={state:"error"};return}if(!await k(c.subdomain).catch(()=>null)){t.value={state:"not-deployed"};return}if(!await O(c.subdomain).catch(()=>null)){t.value={state:"not-found"};return}const D=`https://${c.subdomain}.abstra.app/${l.path}`;t.value={state:"found",url:D}}return A(),(f,c)=>(g(),h(e(ae),{title:n.value},{content:r(()=>[m($(L.value),1)]),default:r(()=>[a(e(B),{href:i.value,target:"_blank",disabled:u.value,loading:o.value,size:"small",type:"link"},{icon:r(()=>[a(e(Fe))]),default:r(()=>[m(" Open Deployed ")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),qe=ve("p",{style:{width:"200px"}}," Add query params to simulate someone using your forms with specific data in the URL. ",-1),Me={key:2,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},C="abstra-run-id",Ne=U({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(s,{expose:l,emit:t}){var z,Q,V,H;const u=s,o=P(void 0);function i(){o.value=o.value?void 0:"query-params"}const n=de({queryParams:[],url:`${u.form.path}`,stageRunId:null}),L=d=>{n.stageRunId=d},{result:k,loading:O}=le(()=>ne.get()),A=()=>{n.queryParams.push({name:"",value:""})},f=d=>{n.queryParams=n.queryParams.filter((_,p)=>p!==d)};re([()=>n.stageRunId,()=>n.queryParams],([d,_])=>{const p=_.find(y=>y.name===C);if(d&&!p){n.queryParams.push({name:C,value:d});return}if(!d&&p){n.queryParams=n.queryParams.filter(y=>y.name!==C);return}d&&p&&d!==p.value&&(p.value=d)});const c=x(()=>ue.create(u.form.id));(z=c.value)==null||z.on("stdout",d=>{u.logService.log({type:"stdout",log:d.log})}),(Q=c.value)==null||Q.on("stderr",d=>{u.logService.log({type:"stderr",log:d.log})}),(V=c.value)==null||V.onClose(()=>{u.logService.log({type:"stderr",log:"Program closed"})}),(H=c.value)==null||H.on("files:changed",()=>{u.logService.log({type:"files-changed",log:"Files changed"})});const b=oe(),M=({path:d})=>{ee("editor",b,d)};function D(d,_){t("redirect",d,_)}const N=P(null);async function j(){var d;return u.logService.log({type:"restart"}),(d=N.value)==null?void 0:d.run()}const E=x(()=>{const d=new URLSearchParams(n.queryParams.filter(p=>p.name.trim()).reduce((p,y)=>({...p,[y.name]:y.value}),{})).toString();return{subdomain:"[your-subdomain]",path:u.form.path,query:d}});return l({restart:j}),(d,_)=>(g(),h(e(se),{layout:"vertical"},{default:r(()=>[R("",!0),a(e(v),{label:"Testing URL"},{default:r(()=>[a(e(X),{gap:0,style:{overflow:"hidden"}},{default:r(()=>[m(" https:// "),a(e(F),{style:{"margin-right":"0"}},{default:r(()=>[m($(E.value.subdomain),1)]),_:1}),m(" .abstra.app/ "),a(e(F),{style:{"margin-right":"0","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis"}},{default:r(()=>[m($(E.value.path),1)]),_:1}),a(e(X),null,{default:r(()=>[m(" ? "),a(e(ae),{title:"Query params"},{content:r(()=>[qe]),default:r(()=>[a(e(F),{style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer"},onClick:i},{default:r(()=>[m($(E.value.query||"[ ... ]"),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(v),null,{default:r(()=>[a(e(Se),{"active-key":o.value,"onUpdate:activeKey":_[1]||(_[1]=p=>o.value=p),ghost:""},{default:r(()=>[a(e(Pe),{key:"query-params",header:`Query Params (${n.queryParams.length})`},{default:r(()=>[(g(!0),G(me,null,ce(n.queryParams,(p,y)=>(g(),h(e(v),{key:y},{default:r(()=>[a(e(pe),null,{default:r(()=>[a(e(w),{value:p.name,"onUpdate:value":S=>p.name=S,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),a(e(w),{value:p.value,"onUpdate:value":S=>p.value=S,type:"text",placeholder:"value",disabled:p.name===C},null,8,["value","onUpdate:value","disabled"]),a(e(B),{danger:"",onClick:S=>f(y)},{default:r(()=>[m("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(e(v),null,{default:r(()=>[a(e(B),{type:"dashed",style:{width:"100%"},onClick:A},{default:r(()=>[m("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1},8,["active-key"])]),_:1})]),_:1}),a(e(Oe),{orientation:"left"},{default:r(()=>[m("Quick Preview")]),_:1}),e(O)||!e(k)?(g(),h(e(fe),{key:1})):n.stageRunId||u.form.isInitial?(g(),G("div",Me,[a(ie,{ref_key:"runner",ref:N,form:d.form.makeRunnerData(e(k)),params:{...n.queryParams.reduce((p,{name:y,value:S})=>({...p,[y]:S}),{})},"is-preview":"","enable-auto-focus":"",broker:c.value,onNavigate:M,onRedirect:D,onLogout:j},null,8,["form","params","broker"])])):(g(),h(e(Ae),{key:3,message:"This form is an intermediate task within the workflow. Please select a task instance to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}}),je=U({__name:"FormSettings",props:{form:{}},setup(s){const t=P(s.form);return(u,o)=>(g(),h(e(se),{layout:"vertical"},{default:r(()=>[a(he,{runtime:t.value},null,8,["runtime"]),a(e(v),{label:"Form name"},{default:r(()=>[a(e(w),{value:t.value.title,"onUpdate:value":o[0]||(o[0]=i=>t.value.title=i),type:"text",onChange:o[1]||(o[1]=i=>{var n;return t.value.title=(n=i.target.value)!=null?n:""})},null,8,["value"])]),_:1}),a(e(T),{level:3},{default:r(()=>[m(" Texts ")]),_:1}),a(e(T),{level:4},{default:r(()=>[m(" Welcome Screen ")]),_:1}),a(e(v),{label:"Title"},{default:r(()=>[a(e(w),{value:t.value.welcomeTitle,"onUpdate:value":o[2]||(o[2]=i=>t.value.welcomeTitle=i),type:"text",placeholder:t.value.title,disabled:t.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),a(e(v),{label:"Description"},{default:r(()=>[a(e(w),{value:t.value.startMessage,"onUpdate:value":o[3]||(o[3]=i=>t.value.startMessage=i),type:"text",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(v),{label:"Start button label"},{default:r(()=>[a(e(w),{value:t.value.startButtonText,"onUpdate:value":o[4]||(o[4]=i=>t.value.startButtonText=i),type:"text",placeholder:"Start",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(v),null,{default:r(()=>[a(e(W),{checked:t.value.autoStart,"onUpdate:checked":o[5]||(o[5]=i=>t.value.autoStart=i)},{default:r(()=>[m("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),a(e(T),{level:4},{default:r(()=>[m(" End Screen ")]),_:1}),a(e(v),{label:"End text"},{default:r(()=>[a(e(w),{value:t.value.endMessage,"onUpdate:value":o[6]||(o[6]=i=>t.value.endMessage=i),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),a(e(v),{label:"Restart button label"},{default:r(()=>[a(e(w),{value:t.value.restartButtonText,"onUpdate:value":o[7]||(o[7]=i=>t.value.restartButtonText=i),placeholder:"Restart",type:"text",disabled:!t.value.allowRestart},null,8,["value","disabled"])]),_:1}),a(e(v),null,{default:r(()=>[a(e(W),{checked:t.value.allowRestart,"onUpdate:checked":o[8]||(o[8]=i=>t.value.allowRestart=i)},{default:r(()=>[m("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),a(e(T),{level:4},{default:r(()=>[m(" Alert Messages ")]),_:1}),a(e(v),{label:"Error message"},{default:r(()=>[a(e(w),{value:t.value.errorMessage,"onUpdate:value":o[9]||(o[9]=i=>t.value.errorMessage=i),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),Pt=U({__name:"FormEditor",setup(s){const l=oe(),t=ge(),u=P(null),o=P("test");function i(){l.push({name:"scripts"})}const{result:n,refetch:L}=le(()=>Promise.all([ne.get(),ke.get(t.params.id)]).then(([f,c])=>ye({workspace:f,form:c}))),k=we.create();function O(f,c){ee("editor",l,f,c)}const A=()=>{var f;l.push({name:"formPreview",query:t.query,params:{id:(f=n.value)==null?void 0:f.form.id}})};return re(()=>t.params.id,()=>{L()}),(f,c)=>(g(),h(_e,null,{navbar:r(()=>[e(n)?(g(),h(e(Le),{key:0,title:e(n).form.title,style:{padding:"5px 10px"},onBack:i},{footer:r(()=>[a(e(Re),{"active-key":o.value,"onUpdate:activeKey":c[0]||(c[0]=b=>o.value=b)},{default:r(()=>[a(e(J),{key:"test",tab:"Test"}),a(e(J),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:r(()=>[a(xe,{"docs-path":"forms/overview","show-v-s-code-button":"","show-save-button":o.value==="settings","editing-model":e(n).form},{default:r(()=>[a(Ie,{path:e(n).form.path},null,8,["path"]),a(e(B),{target:"_blank",onClick:A},{icon:r(()=>[a(e(De))]),default:r(()=>[m(" Preview ")]),_:1})]),_:1},8,["show-save-button","editing-model"])]),_:1},8,["title"])):R("",!0)]),content:r(()=>[e(n)&&o.value==="test"?(g(),h(Ne,{key:0,ref_key:"tester",ref:u,form:e(n).form,"log-service":e(k),onRedirect:O},null,8,["form","log-service"])):R("",!0),e(n)&&o.value==="settings"?(g(),h(je,{key:1,form:e(n).form},null,8,["form"])):R("",!0)]),footer:r(()=>{var b;return[e(n)&&o.value==="test"?(g(),h(be,{key:0,runtime:"forms","log-service":e(k),onRestart:(b=u.value)==null?void 0:b.restart},null,8,["log-service","onRestart"])):R("",!0)]}),_:1}))}});export{Pt as default};
//# sourceMappingURL=FormEditor.6b7aad71.js.map

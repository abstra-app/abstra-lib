var U=Object.defineProperty;var R=(s,e,n)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>(R(s,typeof e!="symbol"?e+"":e,n),n);import{C as T}from"./ConnectorCard.f465c281.js";import{_ as V}from"./AbstraButton.vue_vue_type_script_setup_true_lang.b6fdca00.js";import{f as P,cG as b,d as F,o as l,c as u,w as a,b as i,u as t,d7 as D,az as r,ea as E,d0 as G,bK as O,bs as B,bq as v,F as f,dc as p,eF as x,eG as q,a as M,Q as j,e3 as K,K as w,aL as _,d8 as y,d6 as L,e9 as $,cu as z,bE as Q,ef as Y}from"./index.d4d161e1.js";import{C as A}from"./gateway.a7037399.js";import{C as H}from"./router.677765f8.js";import{G as J}from"./PhDotsThreeVertical.vue.5f1cea66.js";import{A as W}from"./Avatar.e2c3e6a6.js";import{C as X}from"./Card.87f819bd.js";import{A as Z}from"./index.4afa9727.js";import"./popupNotifcation.eae85431.js";import"./Badge.38264a07.js";import"./TabPane.5791ca0b.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="43b4a8bc-a168-4ca5-9c9a-6a47d340bab6",s._sentryDebugIdIdentifier="sentry-dbid-43b4a8bc-a168-4ca5-9c9a-6a47d340bab6")}catch{}})();class ee{async listAgents(){return A.get("agents")}async listAgentConnections(e){return A.get(`projects/${e}/agents/connections`)}async createAgentConnection({projectId:e,agentId:n}){return A.post(`projects/${e}/agents/connections`,{agentId:n})}async renameAgentConnection({projectId:e,agentConnectionId:n,newAgentConnectionName:o}){return A.patch(`projects/${e}/agents/connections/${n}`,{newAgentConnectionName:o})}async deleteAgentConnection({projectId:e,agentConnectionId:n}){return A.delete(`projects/${e}/agents/connections/${n}`)}}const te="/src/assets/logo.svg";class S{constructor(e){this.data=e}get id(){return this.data.id}get name(){return this.data.name}get description(){return this.data.description}get setupPath(){return this.data.setupPath}get logoURL(){return this.data.logoURL||te}get unavailable(){return!this.data.isAvailable}}class ne{constructor(e){this.data=e}get id(){return this.data.id}get connectionName(){return this.data.connectionName}get agentId(){return this.data.agentId}get clientProjectId(){return this.data.clientProjectId}get connectionStatus(){return this.data.connectionStatus}}class oe{constructor(e){C(this,"agentConnection");C(this,"agent");C(this,"redirectURL");this.data=e,this.agentConnection=new ne(e.agentConnection),this.agent=new S(e.agent),this.redirectURL=e.redirectURL}}class ae{constructor(e,n){C(this,"state");this.api=e,this.projectId=n,this.state=P({agents:[],agentConnectionDetailsList:[],selectedAgentForConnection:null,editingAgentConnection:{selectedAgentConnection:null,newName:"",errorMessage:null}})}get agents(){return this.state.value.agents}get agentConnectionDetailsList(){return this.state.value.agentConnectionDetailsList}get selectedAgentForConnection(){return this.state.value.selectedAgentForConnection}get selectedAgentConnectionForEditing(){return this.state.value.editingAgentConnection.selectedAgentConnection}get editingNewName(){return this.state.value.editingAgentConnection.newName}set editingNewName(e){this.state.value.editingAgentConnection.newName=e}get editingErrorMessage(){return this.state.value.editingAgentConnection.errorMessage}hasChanges(){return!!this.state.value.editingAgentConnection.selectedAgentConnection&&this.state.value.editingAgentConnection.newName!==this.state.value.editingAgentConnection.selectedAgentConnection.connectionName}async fetchInitialState(){await Promise.all([this.fetchAgents(),this.fetchAgentConnections()])}async fetchAgents(){const e=await this.api.listAgents();this.state.value.agents=e.map(n=>new S(n))}async fetchAgentConnections(){const e=await this.api.listAgentConnections(this.projectId);this.state.value.agentConnectionDetailsList=e.map(n=>new oe(n))}cancelAgentConnectionCreation(){this.state.value.selectedAgentForConnection=null}cancelAgentConnectionEditing(){this.state.value.editingAgentConnection.selectedAgentConnection=null,this.state.value.editingAgentConnection.newName="",this.removeEditingErrorMessage()}async createAgentConnection(){if(!this.state.value.selectedAgentForConnection)return;const n=(await this.api.createAgentConnection({projectId:this.projectId,agentId:this.state.value.selectedAgentForConnection.id})).redirectUrl;n?window.location.href=n:(await this.fetchAgentConnections(),this.cancelAgentConnectionCreation())}handleEditAgentConnectionClick(e){this.state.value.editingAgentConnection.newName=e.connectionName,this.state.value.editingAgentConnection.selectedAgentConnection=e}async renameAgentConnection(){try{await this.api.renameAgentConnection({projectId:this.projectId,agentConnectionId:this.state.value.editingAgentConnection.selectedAgentConnection.id,newAgentConnectionName:this.state.value.editingAgentConnection.newName}),this.cancelAgentConnectionEditing(),await this.fetchAgentConnections()}catch{this.state.value.editingAgentConnection.errorMessage="There's already a connection to the same agent with this name"}}removeEditingErrorMessage(){this.state.value.editingAgentConnection.errorMessage=null}async deleteAgentConnection(e){await this.api.deleteAgentConnection({projectId:this.projectId,agentConnectionId:e}),await this.fetchAgentConnections()}handleDeleteAgentConnectionClick(e){b.confirm({title:`Are you sure you want to delete ${e.connectionName}?`,onOk:()=>this.deleteAgentConnection(e.id)})}showNewAgentConnectionModal(e){this.state.value.selectedAgentForConnection=e}handleSetupAgentConnectionClick(e){!e.redirectURL||(window.location.href=e.redirectURL)}}const ie=s=>(x("data-v-4372bea0"),s=s(),q(),s),se=ie(()=>M("div",{style:{"flex-grow":"1"}},null,-1)),ce=F({__name:"AgentConnectionCard",props:{agentConnectionDetails:{},controller:{}},setup(s){function e(n){switch(n){case"connected":return"success";case"pending":return"warning";default:return"default"}}return(n,o)=>(l(),u(t(X),null,{default:a(()=>[i(t(p),{align:"center",gap:16},{default:a(()=>[i(t(W),{src:n.agentConnectionDetails.agent.logoURL,height:"40px",shape:"square"},null,8,["src"]),i(t(D),{strong:""},{default:a(()=>[r(E(n.agentConnectionDetails.agent.name),1)]),_:1}),se,i(t(D),{content:n.agentConnectionDetails.agentConnection.connectionName,code:""},null,8,["content"]),i(t(G),{class:"status-tag",color:e(n.agentConnectionDetails.agentConnection.connectionStatus)},{default:a(()=>[r(E(n.agentConnectionDetails.agentConnection.connectionStatus),1)]),_:1},8,["color"]),i(t(O),null,{overlay:a(()=>[i(t(B),null,{default:a(()=>[n.agentConnectionDetails.redirectURL?(l(),u(t(v),{key:0,onClick:o[0]||(o[0]=h=>n.controller.handleSetupAgentConnectionClick(n.agentConnectionDetails))},{default:a(()=>[r(" Setup ")]),_:1})):f("",!0),i(t(v),{onClick:o[1]||(o[1]=h=>n.controller.handleEditAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:a(()=>[r(" Rename ")]),_:1}),i(t(v),{danger:"",onClick:o[2]||(o[2]=h=>n.controller.handleDeleteAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:a(()=>[r(" Disconnect ")]),_:1})]),_:1})]),default:a(()=>[i(t(J))]),_:1})]),_:1})]),_:1}))}});const re=j(ce,[["__scopeId","data-v-4372bea0"]]),le={class:"agents-grid"},ge=F({__name:"AgentsView",setup(s){const n=K().params.projectId,o=new ae(new ee,n);o.fetchInitialState();function h(m){m.unavailable?H.showNewMessage(Y.translate("i18n_agents_ask_for_access",null,m.name)):o.showNewAgentConnectionModal(m)}return(m,c)=>{var I,N;return l(),w(_,null,[i(t(Z),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:a(()=>{var g,k;return[i(t(y),null,{default:a(()=>[r("Agents")]),_:1}),i(t(L),null,{default:a(()=>[r("Add and manage external integrations to your project.")]),_:1}),(g=t(o).agentConnectionDetailsList)!=null&&g.length?(l(),u(t(p),{key:0,vertical:""},{default:a(()=>[i(t(y),{level:2},{default:a(()=>[r("Connected")]),_:1}),i(t(p),{vertical:"",gap:10},{default:a(()=>[(l(!0),w(_,null,$(t(o).agentConnectionDetailsList,d=>(l(),u(re,{key:d.agentConnection.id,"agent-connection-details":d,controller:t(o)},null,8,["agent-connection-details","controller"]))),128))]),_:1})]),_:1})):f("",!0),(k=t(o).agents)!=null&&k.length?(l(),u(t(p),{key:1,vertical:""},{default:a(()=>[i(t(y),{level:2},{default:a(()=>[r("All")]),_:1}),M("div",le,[(l(!0),w(_,null,$(t(o).agents,d=>(l(),u(T,{key:d.id,title:d.name,"logo-url":d.logoURL,description:d.description,unavailable:d.unavailable,onClick:de=>h(d)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})):f("",!0)]}),_:1}),i(t(b),{open:!!t(o).selectedAgentForConnection,title:(I=t(o).selectedAgentForConnection)==null?void 0:I.name,"ok-text":"Connect",onCancel:c[0]||(c[0]=g=>t(o).cancelAgentConnectionCreation()),onOk:c[1]||(c[1]=g=>t(o).createAgentConnection())},{default:a(()=>[i(t(L),null,{default:a(()=>[r("You will be redirected to the Agent's setup page.")]),_:1})]),_:1},8,["open","title"]),i(t(b),{open:!!t(o).selectedAgentConnectionForEditing,title:`${(N=t(o).selectedAgentConnectionForEditing)==null?void 0:N.connectionName} Connection`,onCancel:c[5]||(c[5]=g=>t(o).cancelAgentConnectionEditing())},{footer:a(()=>[i(t(p),{justify:"end"},{default:a(()=>[i(V,{type:"primary",disabled:!t(o).hasChanges(),onClick:c[4]||(c[4]=g=>t(o).renameAgentConnection())},{default:a(()=>[r(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[i(t(z),{"has-feedback":"","validate-status":t(o).editingErrorMessage?"error":"",help:t(o).editingErrorMessage},{default:a(()=>[t(o).selectedAgentConnectionForEditing?(l(),u(t(Q),{key:0,value:t(o).editingNewName,"onUpdate:value":c[2]||(c[2]=g=>t(o).editingNewName=g),onChange:c[3]||(c[3]=g=>t(o).removeEditingErrorMessage())},null,8,["value"])):f("",!0)]),_:1},8,["validate-status","help"])]),_:1},8,["open","title"])],64)}}});const Ne=j(ge,[["__scopeId","data-v-f3283209"]]);export{Ne as default};
//# sourceMappingURL=AgentsView.08d2c345.js.map

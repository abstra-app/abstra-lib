import{_ as H}from"./DocsButton.vue_vue_type_script_setup_true_lang.50bbaf08.js";import{C as G}from"./ContentLayout.458eb25f.js";import{p as W}from"./popupNotifcation.b3d7898e.js";import{a as q}from"./ant-design.c69720e9.js";import{a as J}from"./asyncComputed.7c051de7.js";import{G as X}from"./PhDotsThree.vue.cfccf254.js";import{b as i,ey as B,fb as Y,d as Z,eu as Q,f as S,e as K,c as _,w as s,o as p,ax as m,u as o,cY as ee,Z as te,cW as x,bL as O,a as v,et as C,W as A,R as b,cT as ne,bJ as ae,bq as oe,bo as E,cX as N,cm as re,eC as le,eD as ie,$ as se}from"./vue-router.4fd4520f.js";import{C as h}from"./gateway.2e2b2bcf.js";import"./tables.cb9d1914.js";import{D as R}from"./DeleteOutlined.d227f527.js";import{C as ce}from"./Card.48e09d8b.js";import"./BookOutlined.3f1562e1.js";import"./record.ab5bf640.js";import"./string.3be91b30.js";import"./TabPane.517c1b34.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="11af2dec-8a67-43c3-a839-9cc75b61ef3a",n._sentryDebugIdIdentifier="sentry-dbid-11af2dec-8a67-43c3-a839-9cc75b61ef3a")}catch{}})();var de={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const ue=de;function T(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),l.forEach(function(d){pe(n,d,a[d])})}return n}function pe(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var I=function(e,a){var l=T({},e,a.attrs);return i(B,T({},l,{icon:Y}),null)};I.displayName="DownloadOutlined";I.inheritAttrs=!1;const fe=I;function V(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),l.forEach(function(d){me(n,d,a[d])})}return n}function me(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var j=function(e,a){var l=V({},e,a.attrs);return i(B,V({},l,{icon:ue}),null)};j.displayName="UploadOutlined";j.inheritAttrs=!1;const z=j;class k{constructor(e){this.projectId=e}static fromProjectId(e){return new k(e)}async list(){return h.get(`projects/${this.projectId}/files`)}async upload(e,a=""){const l={"Content-Type":"multipart/form-data"};return h.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(a+"/"+e.name)}`,e,l)}async download(e){return h.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return h.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,a){return h.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(a)}`,{})}}const ye=n=>(le("data-v-ad463589"),n=n(),ie(),n),_e=ye(()=>v("br",null,null,-1)),be={key:0},he={key:0,class:"file-size"},ve={class:"action-item"},ge={class:"action-item"},we=Z({__name:"Files",setup(n){const a=Q().params.projectId,l=k.fromProjectId(a),{loading:d,result:L,refetch:$}=J(()=>l.list());function D(t){var r,c;return{key:t.path,title:t.name,isLeaf:t.type==="file",file:t,children:t.type==="file"?[]:(c=(r=t.children)==null?void 0:r.map(D))!=null?c:[]}}const y=S(()=>{var t;return(t=L.value)==null?void 0:t.map(D)}),U=t=>{var r,c;return t.isLeaf?1:(c=(r=t.children)==null?void 0:r.reduce((u,f)=>u+U(f),0))!=null?c:0},g=S(()=>y.value?y==null?void 0:y.value.reduce((t,r)=>t+U(r),0):0),w=K(!1);function F(t){if(t&&t.type==="file")return;const r=document.createElement("input");r.type="file",r.onchange=async()=>{var u;const c=(u=r.files)==null?void 0:u[0];if(!!c)try{w.value=!0,await l.upload(c,t==null?void 0:t.path),await $()}catch{W("Failed to upload file","File already exists")}finally{w.value=!1}},r.click()}async function M(t){if(!t)return;const r=await l.download(t.path),c=document.createElement("a");c.href=URL.createObjectURL(r),c.download=t.name,c.click()}async function P(t){if(!t)return;const r="Are you sure you want to delete this "+(t.type==="file"?"file":"directory and all its contents")+"?";await q(r)&&(await l.delete(t.path),await $())}return(t,r)=>(p(),_(G,null,{default:s(()=>[i(o(ee),null,{default:s(()=>[m("Files")]),_:1}),i(o(x),null,{default:s(()=>[m(" Here you can upload, download and delete files in your persistent dir."),_e,m(" Files can be used in your scripts. "),i(H,{path:"cloud/files"}),te(t.$slots,"description",{},void 0,!0)]),_:3}),i(o(O),{type:"primary",loading:w.value,onClick:r[0]||(r[0]=c=>F())},{default:s(()=>[i(o(z)),m(" Upload ")]),_:1},8,["loading"]),i(o(ce),null,{default:s(()=>[g.value>0?(p(),_(o(x),{key:0},{default:s(()=>[v("b",null,[m(C(g.value)+" file",1),g.value!==1?(p(),A("span",be,"s")):b("",!0)])]),_:1})):b("",!0),y.value&&y.value.length>0?(p(),_(o(ne),{key:1,"tree-data":y.value,selectable:!1},{title:s(({title:c,isLeaf:u,file:f})=>[v("span",null,[m(C(c)+" ",1),u?(p(),A("span",he,"("+C(f.size)+")",1)):b("",!0)]),u?(p(),_(o(O),{key:0,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>M(f)},{default:s(()=>[i(o(fe))]),_:2},1032,["onClick"])):b("",!0),u?(p(),_(o(O),{key:1,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>P(f)},{default:s(()=>[i(o(R))]),_:2},1032,["onClick"])):b("",!0),u?b("",!0):(p(),_(o(ae),{key:2},{overlay:s(()=>[i(o(oe),{disabled:o(d)},{default:s(()=>[i(o(E),{danger:!1,onClick:()=>F(f)},{default:s(()=>[v("div",ve,[i(o(z)),i(o(N),null,{default:s(()=>[m(" Upload ")]),_:1})])]),_:2},1032,["onClick"]),i(o(E),{danger:!1,onClick:()=>P(f)},{default:s(()=>[v("div",ge,[i(o(R)),i(o(N),null,{default:s(()=>[m(" Delete ")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1032,["disabled"])]),default:s(()=>[i(o(X),{style:{cursor:"pointer",float:"inline-end"},size:"25px"})]),_:2},1024))]),_:1},8,["tree-data"])):(p(),_(o(re),{key:2,description:o(d)?"Loading...":"No files"},null,8,["description"]))]),_:1})]),_:3}))}});const Re=se(we,[["__scopeId","data-v-ad463589"]]);export{Re as default};
//# sourceMappingURL=Files.27a7c755.js.map

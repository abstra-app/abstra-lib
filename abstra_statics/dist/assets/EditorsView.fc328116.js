var M=Object.defineProperty;var w=(r,e,t)=>e in r?M(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>(w(r,typeof e!="symbol"?e+"":e,t),t);import{C as y}from"./CrudView.1f8b884c.js";import{e as s,f as I,ej as E,ep as C,d as T,ea as k,eo as x,o as f,X as z,b as l,u as a,w as u,aR as _,c as A,cy as b,cR as R,aA as O,dg as V,R as S,cK as D}from"./vue-router.3b71935d.js";import{a as v}from"./gateway.a84ceeab.js";import{M as P}from"./member.d19135aa.js";import"./tables.ebc87ad8.js";import{a as g}from"./ant-design.f00625c0.js";import{T as j,G as F}from"./tagColorProvider.9e582fc6.js";import"./router.74e4263a.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.5b28678d.js";import"./BookOutlined.55a6a936.js";import"./url.deb5af1a.js";import"./PhDotsThreeVertical.vue.b6de7f3d.js";import"./Badge.e735c20f.js";import"./index.f47b46c5.js";import"./popupNotifcation.dda4d9fd.js";import"./record.77dee426.js";import"./string.bc3d5afd.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="5d455d36-61ef-46d7-98d9-4ad004d6664f",r._sentryDebugIdIdentifier="sentry-dbid-5d455d36-61ef-46d7-98d9-4ad004d6664f")}catch{}})();const L=[{key:"email",label:"Email"}],N=[{label:"Admin",value:"admin"},{label:"Editor",value:"editor"}],B={admin:"Has full access to the organization, projects and editors",editor:"Can only manage projects within their teams"};class G{constructor({authorEmail:e,organizationId:t,api:n,handlers:d}){i(this,"members",s([]));i(this,"teamOptions",s([]));i(this,"selectedMember",s(null));i(this,"draftMember",s(null));i(this,"table");i(this,"loading",s(!1));i(this,"authorEmail");i(this,"organizationId");i(this,"api");i(this,"handlers");i(this,"currentMember",s(null));i(this,"teamColorProvider",new j);i(this,"addMember",async e=>{await this.api.create({organizationId:this.organizationId,email:e.email}),await this.fetchMembers()});i(this,"openEditMemberModal",e=>{this.draftMember.value=E.exports.cloneDeep(e),this.selectedMember.value=e,this.fetchTeamOptions()});i(this,"commitEditMember",async()=>{var e,t;this.loading.value=!0,this.draftMember.value&&(await this.api.update(this.organizationId,this.draftMember.value.authorId,{role:(e=this.draftMember.value)==null?void 0:e.role,teams:(t=this.draftMember.value)==null?void 0:t.teams}),await this.fetchMembers(),this.draftMember.value=null,this.selectedMember.value=null,this.loading.value=!1)});i(this,"cancelEditMember",()=>{this.draftMember.value=null,this.selectedMember.value=null});this.authorEmail=e,this.organizationId=t,this.api=n,this.handlers=d,this.table=I(()=>this.makeCrudViewTable())}async fetchInitialState(){await this.fetchMembers(),this.setCurrentMember()}setCurrentMember(){var e;this.currentMember.value=(e=this.members.value.find(t=>t.email===this.authorEmail))!=null?e:null}async fetchMembers(){this.members.value=await this.api.list(this.organizationId)}async fetchTeamOptions(){const e=await this.api.fetchTeamOptions(this.organizationId);this.teamOptions.value=e.map(t=>({label:t,value:t}))}async removeMember(e){var n;if(((n=v.getAuthor())==null?void 0:n.claims.email)===e.email){await g("Removing your own access will block you from this organization. Are you sure?",{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),this.handlers.onSelfRemove());return}await g(`Are you sure you want to remove ${e.email} access?`,{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),await this.fetchMembers())}makeCrudViewActions(e){var t;return((t=this.currentMember.value)==null?void 0:t.role)==="editor"?[]:[{icon:F,label:"Edit Permissions",onClick:()=>this.openEditMemberModal(e)},{icon:C,label:"Remove access",onClick:()=>this.removeMember(e),dangerous:!0}]}getTeamTags(e){const t=e.teams.map(n=>({text:n,color:this.teamColorProvider.getColor(n)}));return e.role==="admin"&&t.unshift({text:"Admin",color:"red"}),t}makeCrudViewTable(){return{columns:[{title:"Email",align:"center"},{title:"Teams",align:"center"},{title:"",align:"right"}],rows:this.members.value.map(e=>({key:e.email,cells:[{type:"text",text:e.email},{type:"tags",tags:this.getTeamTags(e)},{type:"actions",actions:this.makeCrudViewActions(e)}]}))}}}const le=T({__name:"EditorsView",setup(r){var p;const e=k(),t=x(),n=e.params.organizationId,d=new P,h=(p=v.getAuthor())==null?void 0:p.claims.email;if(!h)throw new Error("Author email is not available");const o=new G({organizationId:n,api:d,authorEmail:h,handlers:{onSelfRemove:()=>{t.push("organizations")}}});return o.fetchInitialState(),(U,m)=>(f(),z(_,null,[l(y,{"entity-name":"editors",loading:a(o).loading.value,title:"Organization Editors",description:"Manage the editors and their permissions for this organization.","empty-title":"No editors yet",table:a(o).table.value,"create-button-text":"Invite editor",fields:a(L),create:a(o).addMember},null,8,["loading","table","fields","create"]),l(a(D),{open:!!a(o).draftMember.value,title:"Editor Permissions","ok-text":"Apply","cancel-text":"Cancel","confirm-loading":a(o).loading.value,onOk:a(o).commitEditMember,onCancel:a(o).cancelEditMember},{default:u(()=>[a(o).draftMember.value?(f(),A(a(V),{key:0,vertical:"",justify:"center",gap:"0",style:{padding:"15px 0px 0px 0px"}},{default:u(()=>[l(a(b),{colon:!1,label:"Role",help:a(B)[a(o).draftMember.value.role]},{default:u(()=>[l(a(R),{value:a(o).draftMember.value.role,"onUpdate:value":m[0]||(m[0]=c=>a(o).draftMember.value.role=c),options:a(N)},null,8,["value","options"])]),_:1},8,["help"]),l(a(b),{colon:!1,label:"Teams",tooltip:"Editor will have access to projects within these teams"},{default:u(()=>[l(a(O),{value:a(o).draftMember.value.teams,"onUpdate:value":m[1]||(m[1]=c=>a(o).draftMember.value.teams=c),options:a(o).teamOptions.value,mode:"tags",placeholder:"Select or type new team name"},null,8,["value","options"])]),_:1})]),_:1})):S("",!0)]),_:1},8,["open","confirm-loading","onOk","onCancel"])],64))}});export{le as default};
//# sourceMappingURL=EditorsView.fc328116.js.map

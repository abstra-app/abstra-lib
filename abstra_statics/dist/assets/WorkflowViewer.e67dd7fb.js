var It=Object.defineProperty;var Mt=(n,e,o)=>e in n?It(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var ft=(n,e,o)=>(Mt(n,typeof e!="symbol"?e+"":e,o),o);import{_ as R}from"./AbstraButton.vue_vue_type_script_setup_true_lang.d8bcc7e4.js";import{F as At,I as $t,O as Lt}from"./os.c6d79f86.js";import{d as U,at as tt,c as I,o as p,ac as B,ae as xt,h as E,ew as Ct,e as w,f as s,u as t,a as C,b as a,g as T,t as m,df as q,ad as jt,aY as yt,_ as gt,dj as V,eB as zt,ft as mt,de as et,i as k,cS as kt,cT as Tt,eA as bt,ec as St,eD as ot,bE as Pt,bD as it,ez as pt,bW as Zt,cM as Bt,eV as Nt,fw as Vt,v as Dt,r as Z,w as vt,ax as Et,U as Wt,S as Ht,A as nt,dd as Ft,eY as Yt,eZ as Xt}from"./jwt-decode.esm.7c9b757c.js";import{F as Gt}from"./PhArrowSquareOut.vue.5643a79c.js";import{I as wt}from"./PhCopy.vue.3324271a.js";import{G as Ot}from"./PhPencilSimple.vue.f94f7fc1.js";import{_ as qt}from"./vue-flow-background.f766fdc7.js";import{a as Jt,b as Ut,g as lt,u as Kt,e as Qt,M as Rt}from"./vue-flow-core.b8b3bffa.js";import{k as rt}from"./router.95e6e4b6.js";import{a as _t,B as te,b as ee}from"./build.33535639.js";import{a as ae,P as se}from"./project.b76602c4.js";import"./tables.4a013a6e.js";import{G as oe}from"./PhArrowCounterClockwise.vue.3c24d769.js";import{I as ie}from"./PhCopySimple.vue.c37a5bbd.js";import{G as ne}from"./PhDotsThreeVertical.vue.23d4ad15.js";import{F as le,G as re,I as de,a as ce}from"./PhWebhooksLogo.vue.2458f971.js";import{g as ue}from"./datetime.6bbd15b7.js";import{_ as pe}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang.224b5d73.js";import{u as ge}from"./polling.65b21949.js";import{C as dt}from"./Card.929a13fd.js";import"./index.33534fc9.js";import"./record.c6bfac6e.js";import"./string.fea0919a.js";import"./LoadingOutlined.2a8e794f.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="f8ac8845-8f97-4cd1-89ac-239b98111d50",n._sentryDebugIdIdentifier="sentry-dbid-f8ac8845-8f97-4cd1-89ac-239b98111d50")}catch{}})();const fe=["width","height","fill","transform"],me={key:0},ve=w("path",{d:"M227.85,46.89a20,20,0,0,0-18.74-18.74c-13.13-.77-46.65.42-74.48,28.24L131,60H74.36a19.83,19.83,0,0,0-14.14,5.86L25.87,100.19a20,20,0,0,0,11.35,33.95l37.14,5.18,42.32,42.32,5.19,37.18A19.88,19.88,0,0,0,135.34,235a20.13,20.13,0,0,0,6.37,1,19.9,19.9,0,0,0,14.1-5.87l34.34-34.35A19.85,19.85,0,0,0,196,181.64V125l3.6-3.59C227.43,93.54,228.62,60,227.85,46.89ZM76,84h31L75.75,115.28l-27.23-3.8ZM151.6,73.37A72.27,72.27,0,0,1,204,52a72.17,72.17,0,0,1-21.38,52.41L128,159,97,128ZM172,180l-27.49,27.49-3.8-27.23L172,149Zm-72,22c-8.71,11.85-26.19,26-60,26a12,12,0,0,1-12-12c0-33.84,14.12-51.32,26-60A12,12,0,1,1,68.18,175.3C62.3,179.63,55.51,187.8,53,203c15.21-2.51,23.37-9.3,27.7-15.18A12,12,0,1,1,100,202Z"},null,-1),we=[ve],_e={key:1},he=w("path",{d:"M184,120v61.65a8,8,0,0,1-2.34,5.65l-34.35,34.35a8,8,0,0,1-13.57-4.53L128,176ZM136,72H74.35a8,8,0,0,0-5.65,2.34L34.35,108.69a8,8,0,0,0,4.53,13.57L80,128ZM40,216c37.65,0,50.69-19.69,54.56-28.18L68.18,161.44C59.69,165.31,40,178.35,40,216Z",opacity:"0.2"},null,-1),ye=w("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),ke=[he,ye],be={key:2},Se=w("path",{d:"M101.85,191.14C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Zm122-144a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.4,27.07h0L88,108.7A8,8,0,0,1,76.67,97.39l26.56-26.57A4,4,0,0,0,100.41,64H74.35A15.9,15.9,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A16,16,0,0,0,192,181.65V155.59a4,4,0,0,0-6.83-2.82l-26.57,26.56a8,8,0,0,1-11.71-.42,8.2,8.2,0,0,1,.6-11.1l49.27-49.27h0C223.45,91.86,224.6,59.71,223.85,47.12Z"},null,-1),Ie=[Se],Me={key:3},Ae=w("path",{d:"M221.86,47.24a14,14,0,0,0-13.11-13.1c-12.31-.73-43.77.39-69.88,26.5L133.52,66H74.35a13.9,13.9,0,0,0-9.89,4.1L30.11,104.44a14,14,0,0,0,7.94,23.76l39.13,5.46,45.16,45.16L127.8,218a14,14,0,0,0,23.76,7.92l34.35-34.35a13.91,13.91,0,0,0,4.1-9.89V122.48l5.35-5.35h0C221.46,91,222.59,59.56,221.86,47.24ZM38.11,115a2,2,0,0,1,.49-2L72.94,78.58A2,2,0,0,1,74.35,78h47.17L77.87,121.64l-38.14-5.32A1.93,1.93,0,0,1,38.11,115ZM178,181.65a2,2,0,0,1-.59,1.41L143.08,217.4a2,2,0,0,1-3.4-1.11l-5.32-38.16L178,134.48Zm8.87-73h0L128,167.51,88.49,128l58.87-58.88a78.47,78.47,0,0,1,60.69-23A2,2,0,0,1,209.88,48,78.47,78.47,0,0,1,186.88,108.64ZM100,190.31C95.68,199.84,81.13,222,40,222a6,6,0,0,1-6-6c0-41.13,22.16-55.68,31.69-60a6,6,0,1,1,5,10.92c-7,3.17-22.53,13.52-24.47,42.91,29.39-1.94,39.74-17.52,42.91-24.47a6,6,0,1,1,10.92,5Z"},null,-1),$e=[Ae],Le={key:4},xe=w("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),Ce=[xe],je={key:5},ze=w("path",{d:"M219.86,47.36a12,12,0,0,0-11.22-11.22c-12-.71-42.82.38-68.35,25.91L134.35,68h-60a11.9,11.9,0,0,0-8.48,3.52L31.52,105.85a12,12,0,0,0,6.81,20.37l39.79,5.55,46.11,46.11,5.55,39.81a12,12,0,0,0,20.37,6.79l34.34-34.35a11.9,11.9,0,0,0,3.52-8.48v-60l5.94-5.94C219.48,90.18,220.57,59.41,219.86,47.36ZM36.21,115.6a3.94,3.94,0,0,1,1-4.09L71.53,77.17A4,4,0,0,1,74.35,76h52L78.58,123.76,39.44,118.3A3.94,3.94,0,0,1,36.21,115.6ZM180,181.65a4,4,0,0,1-1.17,2.83l-34.35,34.34a4,4,0,0,1-6.79-2.25l-5.46-39.15L180,129.65Zm-52-11.31L85.66,128l60.28-60.29c23.24-23.24,51.25-24.23,62.22-23.58a3.93,3.93,0,0,1,3.71,3.71c.65,11-.35,39-23.58,62.22ZM98.21,189.48C94,198.66,80,220,40,220a4,4,0,0,1-4-4c0-40,21.34-54,30.52-58.21a4,4,0,0,1,3.32,7.28c-7.46,3.41-24.43,14.66-25.76,46.85,32.19-1.33,43.44-18.3,46.85-25.76a4,4,0,1,1,7.28,3.32Z"},null,-1),Te=[ze],Pe={name:"PhRocketLaunch"},Ze=U({...Pe,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(n){const e=n,o=tt("weight","regular"),_=tt("size","1em"),x=tt("color","currentColor"),i=tt("mirrored",!1),l=I(()=>{var u;return(u=e.weight)!=null?u:o}),d=I(()=>{var u;return(u=e.size)!=null?u:_}),f=I(()=>{var u;return(u=e.color)!=null?u:x}),c=I(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:i?"scale(-1, 1)":void 0);return(u,M)=>(p(),B("svg",Ct({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:d.value,height:d.value,fill:f.value,transform:c.value},u.$attrs),[xt(u.$slots,"default"),l.value==="bold"?(p(),B("g",me,we)):l.value==="duotone"?(p(),B("g",_e,ke)):l.value==="fill"?(p(),B("g",be,Ie)):l.value==="light"?(p(),B("g",Me,$e)):l.value==="regular"?(p(),B("g",Le,Ce)):l.value==="thin"?(p(),B("g",je,Te)):E("",!0)],16,fe))}}),Be=U({__name:"WorkflowEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(n){const e=n;function o(i,l,d=0){const f=l.center.x-i.center.x,c=l.center.y-i.center.y,u=Math.sqrt(f*f+c*c);if(u===0)return{sourceX:i.center.x,sourceY:i.center.y,targetX:l.center.x,targetY:l.center.y};const M=f/u,v=c/u,b=i.width/2,S=i.height/2;let h=i.center.x,W=i.center.y;Math.abs(M)*S>Math.abs(v)*b?(h=i.center.x+(M>0?b:-b),W=i.center.y+v*b/Math.abs(M)):(h=i.center.x+M*S/Math.abs(v),W=i.center.y+(v>0?S:-S));const D=l.width/2,y=l.height/2;let A=l.center.x,P=l.center.y;return Math.abs(M)*y>Math.abs(v)*D?(A=l.center.x-(M>0?D:-D),P=l.center.y-v*D/Math.abs(M)):(A=l.center.x-M*y/Math.abs(v),P=l.center.y-(v>0?y:-y)),h+=M*d,W+=v*d,A-=M*d,P-=v*d,{sourceX:h,sourceY:W,targetX:A,targetY:P}}function _(i,l){const f={center:{x:i.computedPosition.x+i.dimensions.width/2,y:i.computedPosition.y+i.dimensions.height/2},width:i.dimensions.width,height:i.dimensions.height},u={center:{x:l.computedPosition.x+l.dimensions.width/2,y:l.computedPosition.y+l.dimensions.height/2},width:l.dimensions.width,height:l.dimensions.height};return o(f,u,10)}const x=I(()=>{if(!e.sourceNode||!e.targetNode)return lt({sourceX:0,sourceY:0,targetX:0,targetY:0});if(!e.sourceNode.dimensions.width||!e.targetNode.dimensions.width||!e.sourceNode.dimensions.height||!e.targetNode.dimensions.height)return lt({sourceX:0,sourceY:0,targetX:0,targetY:0});const i=_(e.sourceNode,e.targetNode);return lt(i)});return(i,l)=>{var d,f;return p(),B(yt,null,[s(t(Jt),{path:x.value[0],"marker-end":e.markerEnd},null,8,["path","marker-end"]),(f=(d=e.data)==null?void 0:d.props)!=null&&f.taskType?(p(),C(t(Ut),{key:0},{default:a(()=>[w("div",{style:jt({transform:`translate(-50%, -50%) translate(${x.value[1]}px,${x.value[2]}px)`}),class:"nodrag nopan edge-label"},[s(t(q),null,{default:a(()=>[T(m(e.data.props.taskType),1)]),_:1})],4)]),_:1})):E("",!0)],64)}}});const Ne=gt(Be,[["__scopeId","data-v-8f1859d4"]]);class Ve{async list(e){return rt.get(`projects/${e}/disabled-stages`)}async disableStage({projectId:e,stageId:o}){return rt.patch(`projects/${e}/disabled-stages/${o}`,{enable:!1})}async enableStage({projectId:e,stageId:o}){return rt.patch(`projects/${e}/disabled-stages/${o}`,{enable:!0})}}const ct=new Ve;class J{constructor(e){ft(this,"id");this.dto=e,this.id=e}static async list(e){return(await ct.list(e)).map(_=>new J(_))}static async disableStage({projectId:e,stageId:o}){return ct.disableStage({projectId:e,stageId:o})}static async enableStage({projectId:e,stageId:o}){return ct.enableStage({projectId:e,stageId:o})}}const De=U({__name:"WorkflowStageExecutions",props:{stageId:{},projectId:{},statistics:{}},setup(n){const e=n,o=d=>{if(!d.createdAt||!d.updatedAt)return 0;const f=new Date(d.createdAt).getTime(),c=new Date(d.updatedAt).getTime();return Math.round((c-f)/1e3)},_=I(()=>e.statistics?Math.round(e.statistics.completedTasks/e.statistics.totalTasks*100):0),x=I(()=>{const d=_.value;return d===100?"#52c41a":d>=50?"#1890ff":"#faad14"}),i=d=>ue(d,{weekday:void 0}),l=d=>{if(d<60)return`${Math.round(d)}s`;const f=Math.floor(d/60);if(f<60)return`${f}m`;const c=Math.floor(f/60);return c<24?`${c}h`:`${Math.floor(c/24)}d`};return(d,f)=>(p(),C(t(V),{vertical:"",size:4,style:{width:"100%"}},{default:a(()=>[n.statistics.lastExecutions&&n.statistics.lastExecutions.length>0?(p(),C(t(V),{key:0,size:4,gap:4},{default:a(()=>[(p(!0),B(yt,null,zt(n.statistics.lastExecutions,c=>(p(),C(t(mt),{key:c.id,to:{name:"logs",params:{projectId:n.projectId},query:{executionId:c.id}}},{default:a(()=>[s(t(kt),{title:i(new Date(c.createdAt))},{content:a(()=>[s(t(V),{vertical:"",size:4},{default:a(()=>[s(t(et),null,{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_status"))+": "+m(c.status),1)]),_:2},1024),c.updatedAt&&c.updatedAt!==c.createdAt?(p(),C(t(et),{key:0},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_duration"))+": "+m(o(c))+"s ",1)]),_:2},1024)):E("",!0),s(t(et),null,{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_version"))+": "+m(c.buildId.slice(0,6)),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[s(pe,{status:c.status},null,8,["status"])]),_:2},1032,["title"])]),_:2},1032,["to"]))),128))]),_:1})):E("",!0),n.statistics.totalTasks>0?(p(),C(t(mt),{key:1,to:{name:"tasks",params:{projectId:n.projectId},query:{stage:n.stageId,status:"pending"}}},{default:a(()=>[s(t(V),{vertical:"",size:2},{default:a(()=>[s(t(Tt),{"show-info":!1,percent:_.value,"stroke-color":x.value,size:"small"},null,8,["percent","stroke-color"]),s(t(V),{vertical:"",size:0},{default:a(()=>[n.statistics.pendingTasks>0&&n.statistics.averageCompletionSeconds?(p(),C(t(et),{key:0,type:"secondary",style:{fontSize:"11px"}},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_pending_tasks").replace("{count}",n.statistics.pendingTasks.toString()))+" ("+m(l(n.statistics.averageCompletionSeconds))+" "+m(t(k).translate("i18n_workflowviewer_average"))+") ",1)]),_:1})):E("",!0)]),_:1})]),_:1})]),_:1},8,["to"])):E("",!0)]),_:1}))}}),Ee={class:"stage-content"},We={class:"stage-title"},He={class:"action-item"},Fe={class:"action-item"},Ye={class:"action-warning"},Xe={key:1,class:"action-item"},ht="3.18.0",Ge=U({__name:"WorkflowStageNode",props:{stage:{},statistics:{},disabledStages:{},project:{},buildSpec:{}},emits:["refetch-disabled-stages"],setup(n,{emit:e}){const o=n,_=bt(),x=St(),i=_.params.projectId,l=I(()=>({forms:le,hooks:re,scripts:de,jobs:ce})[o.stage.type]),d=()=>{x.push({name:"logs",params:{projectId:i},query:{stageId:o.stage.id}})},f=I(()=>o.stage.type==="forms"||o.stage.type==="hooks"),c=()=>{var P;if(!o.stage.path)return;const y=o.stage.type==="forms"?`/${o.stage.path}`:`/_hooks/${o.stage.path}`,A=(P=o.project)==null?void 0:P.getUrl(y);!A||(navigator.clipboard.writeText(A),Bt.success(k.translate("i18n_workflowviewer_copied_url")))},u=I(()=>{var y;return(y=o.disabledStages)==null?void 0:y.map(A=>A.id).includes(o.stage.id)}),M=(y,A)=>{const[P,X,K]=y.split(".").map(Number),[F,Q,st]=A.split(".").map(Number);return P>F?!0:P<F?!1:X>Q?!0:X<Q?!1:K>=st},v=I(()=>u.value?Nt:Vt),b=I(()=>u.value?k.translate("i18n_workflowviewer_enable_stage"):k.translate("i18n_workflowviewer_disable_stage")),S=I(()=>{var y;return!M(((y=o.buildSpec)==null?void 0:y.abstraVersion)||"0.0.0",ht)}),h=I(()=>S.value?k.translate("i18n_workflowviewer_disable_stages_warning").replace("{version}",ht):""),W=e,D=async()=>{S.value||(u.value?await J.enableStage({projectId:i,stageId:o.stage.id}):await J.disableStage({projectId:i,stageId:o.stage.id}),await W("refetch-disabled-stages"))};return(y,A)=>(p(),B("div",{class:pt(["stage-node",{disabled:u.value}])},[w("div",Ee,[(p(),C(ot(l.value),{size:18,class:"stage-icon"})),w("div",We,m(n.stage.title),1),s(t(Zt),{trigger:["click"]},{overlay:a(()=>[s(t(Pt),null,{default:a(()=>[s(t(it),{onClick:d},{default:a(()=>[w("div",He,[s(t(oe),{size:16}),w("span",null,m(t(k).translate("i18n_workflowviewer_view_logs")),1)])]),_:1}),f.value?(p(),C(t(it),{key:0,onClick:c},{default:a(()=>[w("div",Fe,[s(t(ie),{size:16}),w("span",null,m(t(k).translate("i18n_workflowviewer_copy_url")),1)])]),_:1})):E("",!0),s(t(it),{onClick:D},{default:a(()=>[S.value?(p(),C(t(kt),{key:0,placement:"left"},{content:a(()=>[w("div",Ye,[s(t(q),null,{default:a(()=>[T(m(h.value),1)]),_:1})])]),default:a(()=>[w("div",{class:pt(["action-item",{disabled:S.value}])},[(p(),C(ot(v.value),{size:16})),w("span",null,m(b.value),1)],2)]),_:1})):(p(),B("div",Xe,[(p(),C(ot(v.value),{size:16})),w("span",null,m(b.value),1)]))]),_:1})]),_:1})]),default:a(()=>[s(t(ne),{style:{cursor:"pointer"},size:20,class:"actions-menu"})]),_:1})]),n.statistics?(p(),C(De,{key:0,"stage-id":n.stage.id,"project-id":t(i),statistics:n.statistics,style:{"margin-top":"8px"}},null,8,["stage-id","project-id","statistics"])):E("",!0)],2))}});const at=gt(Ge,[["__scopeId","data-v-1c61a077"]]),Oe=Dt("workflow",()=>{const n=Z([]),e=Z(null),o=Z(!1);let _=null,x=null,i=null,l=[];async function d(){if(!x||!i){console.warn("Cannot load data: no project context set");return}o.value=!0;try{const v=await i.getWorkflowStatistics(x),b=new Set(l),S=new Map(v.filter(h=>b.has(h.stageId)).map(h=>[h.stageId,h]));n.value=l.map(h=>S.has(h)?S.get(h):{stageId:h,lastExecutions:[],pendingTasks:0,lockedTasks:0,completedTasks:0,averageCompletionSeconds:void 0,totalTasks:0}),e.value=await J.list(x)}catch(v){console.error("Failed to load workflow data:",v)}finally{o.value=!1}}function f(v,b,S){if(_&&_.endPolling(),i=v,x=b,l=S,S.length>0){const h=ge({task:d,interval:15e3});_=h,d(),h.startPolling()}}function c(){_&&(_.endPolling(),_=null)}function u(){c(),n.value=[],e.value=null,o.value=!1,x=null,i=null,l=[]}const M=I(()=>v=>n.value.find(b=>b.stageId===v)||null);return{statistics:n,disabledStages:e,loading:o,getStatisticsForStage:M,initializePolling:f,stopPolling:c,resetStore:u,refetch:d}}),qe={class:"flow-container"},Je={class:"code-container"},Ue={class:"code-container"},Ke={key:0,class:"edit-button-text"},ut="#ea576a",Qe=U({__name:"WorkflowViewer",setup(n){const{onInit:e}=Kt(),o=new ee,_=bt(),x=St(),i=_.params.projectId,l=_.query.buildId,d=Z(!0),f=Z(null),c=Z(!0),u=Z(!1),M=()=>{x.push({name:"web-editor",params:{projectId:i}})},v=async $=>{try{await navigator.clipboard.writeText($)}catch(r){console.error("Failed to copy:",r)}};e($=>{c.value&&($.fitView(),c.value=!1)});const b=Z([]),S=Z([]),h=I(()=>b.value.map($=>$.id)),W=new se,D=Oe(),y=I(()=>D.statistics),A=Z();vt(h,$=>{D.initializePolling(W,i,$)},{immediate:!0}),Et(()=>{D.stopPolling()});const P=Z(!1),X=I(()=>b.value.length>0&&P.value),K=$=>b.value.map(r=>({id:r.id,type:r.type,data:{stage:r,statistics:$.find(g=>g.stageId===r.id)||null},position:{x:r.position.x,y:r.position.y*1.5}})),F=Z(K(y.value));vt(()=>y.value,()=>{F.value=K(y.value)});const Q=I(()=>{const $=new Set(F.value.map(r=>r.id));return S.value.filter(r=>{const g=$.has(r.sourceStageId),Y=$.has(r.targetStageId);return g&&Y}).map(r=>({id:r.id,source:r.sourceStageId,target:r.targetStageId,type:"task",data:{id:r.id,props:{taskType:r.taskType}},markerEnd:{type:Rt.Arrow,width:24,height:24}}))});function st($){const r=[],g=[],Y=["jobs","hooks","forms","scripts"];for(const z of Y){const L=$[z]||[];for(const j of L){r.push({id:j.id,type:z,title:j.title,position:{x:j.workflow_position[0],y:j.workflow_position[1]},file:j.file,path:j.path,schedule:j.schedule});for(const H of j.transitions||[])g.push({id:H.id,sourceStageId:j.id,targetStageId:H.target_id,taskType:H.task_type})}}const N=new Set(r.map(z=>z.id)),O=g.filter(z=>N.has(z.sourceStageId)&&N.has(z.targetStageId));b.value=r,S.value=O,P.value=!0}const G=Z();return Wt(async()=>{var $,r,g,Y;try{d.value=!0,A.value=await ae.get(i);let N;if(l){const j=(await _t.list(i)).find(H=>H.id===l);if(!j){f.value="Build not found";return}N=j}else{const j=(await _t.list(i)).find(H=>H.latest);if(!j){f.value="No builds found for this project";return}N=j}const O=await o.get(N.id);if(!O||!O.abstraJson){f.value="No workflow data available for this build";return}const z=JSON.parse(O.abstraJson);st(z),G.value=te.fromDTO(i,N.id,z.version,{forms:(($=z.forms)==null?void 0:$.map(L=>({id:L.id,path:L.path,title:L.title})))||[],hooks:((r=z.hooks)==null?void 0:r.map(L=>({id:L.id,path:L.path,title:L.title})))||[],jobs:((g=z.jobs)==null?void 0:g.map(L=>({id:L.id,schedule:L.schedule,title:L.title})))||[],scripts:((Y=z.scripts)==null?void 0:Y.map(L=>({id:L.id,title:L.title})))||[]})}catch(N){f.value=N instanceof Error?N.message:"Failed to load workflow",console.error(N)}finally{d.value=!1}}),($,r)=>(p(),B("div",qe,[d.value?(p(),C(t(Ht),{key:0,style:{width:"100%"}})):X.value?(p(),C(t(Qt),{key:`workflow-${b.value.length}-${S.value.length}`,nodes:F.value,edges:Q.value,"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.1,"max-zoom":1.25,"pan-on-scroll":t(Lt).isMac,"snap-to-grid":""},{"edge-task":a(g=>[s(Ne,Yt(Xt(g)),null,16)]),"node-forms":a(g=>[s(at,{stage:g.data.stage,statistics:g.data.statistics,project:A.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),"node-hooks":a(g=>[s(at,{stage:g.data.stage,statistics:g.data.statistics,project:A.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),"node-scripts":a(g=>[s(at,{stage:g.data.stage,statistics:g.data.statistics,project:A.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),"node-jobs":a(g=>[s(at,{stage:g.data.stage,statistics:g.data.statistics,project:A.value,"build-spec":G.value},null,8,["stage","statistics","project","build-spec"])]),default:a(()=>[s(t(qt),{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","pan-on-scroll"])):(p(),C(t(dt),{key:1,class:"empty-state-card"},{default:a(()=>[s(t(V),{vertical:"",gap:24,align:"center"},{default:a(()=>[s(t(Ze),{size:64,color:ut}),s(t(V),{vertical:"",gap:8,align:"center"},{default:a(()=>[s(t(nt),{level:3},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_getting_started")),1)]),_:1}),s(t(q),{type:"secondary",style:{"text-align":"center"}},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_no_workflow_description")),1)]),_:1})]),_:1}),s(t(V),{gap:16,wrap:"wrap",justify:"center"},{default:a(()=>[s(t(dt),{class:"option-card"},{default:a(()=>[s(t(V),{vertical:"",gap:12},{default:a(()=>[s(t(At),{size:32,color:ut}),s(t(nt),{level:5},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_option_cli")),1)]),_:1}),s(t(q),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_cli_description")),1)]),_:1}),s(t(V),{vertical:"",gap:8},{default:a(()=>[w("div",Je,[r[4]||(r[4]=w("code",{class:"install-code"},"pip install abstra",-1)),s(R,{type:"text",size:"small",onClick:r[0]||(r[0]=g=>v("pip install abstra"))},{default:a(()=>[s(t(wt),{size:16})]),_:1})]),w("div",Ue,[r[5]||(r[5]=w("code",{class:"install-code"},"abstra editor .",-1)),s(R,{type:"text",size:"small",onClick:r[1]||(r[1]=g=>v("abstra editor ."))},{default:a(()=>[s(t(wt),{size:16})]),_:1})])]),_:1})]),_:1})]),_:1}),s(t(dt),{class:"option-card"},{default:a(()=>[s(t(V),{vertical:"",gap:12},{default:a(()=>[s(t($t),{size:32,color:ut}),s(t(nt),{level:5},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_option_online")),1)]),_:1}),s(t(q),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_online_description")),1)]),_:1}),s(R,{type:"primary",onClick:M},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_open_editor")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(t(Ft),{href:"https://www.abstra.io/docs",target:"_blank"},{default:a(()=>[T(m(t(k).translate("i18n_workflowviewer_view_docs"))+" ",1),s(t(Gt),{size:14,style:{"margin-left":"4px"}})]),_:1})]),_:1})]),_:1})),!d.value&&X.value?(p(),C(R,{key:3,class:pt(["edit-button",{expanded:u.value}]),type:"primary",size:"large",onClick:M,onMouseenter:r[2]||(r[2]=g=>u.value=!0),onMouseleave:r[3]||(r[3]=g=>u.value=!1)},{default:a(()=>[s(t(Ot),{size:24}),u.value?(p(),B("span",Ke,m(t(k).translate("i18n_workflowviewer_edit_online")),1)):E("",!0)]),_:1},8,["class"])):E("",!0)]))}});const Ia=gt(Qe,[["__scopeId","data-v-a90f8899"]]);export{Ia as default};
//# sourceMappingURL=WorkflowViewer.e67dd7fb.js.map

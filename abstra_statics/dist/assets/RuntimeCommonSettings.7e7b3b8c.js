var he=Object.defineProperty;var ve=(s,e,t)=>e in s?he(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var A=(s,e,t)=>(ve(s,typeof e!="symbol"?e+"":e,t),t);import{u as P}from"./uuid.92b68c2e.js";import{F as X,d as O,r as p,S as H,G as j,b as d,eu as v,e as o,ey as $,eD as Z,eE as ee,t as z,eA as ge,H as fe,a3 as me,o as ye,K as _e,a as te,f as h,u as i,I,az as W,eC as D,ew as E,ev as we,b6 as se,eB as be,c as F,eR as Ce,eW as ke,w as C,bQ as ne}from"./outputWidgets.3acae187.js";import{s as J,n as V,o as q,g as Se,q as Ie,e as Ee}from"./icons.238cb834.js";import{l as xe}from"./NavbarControls.56d9c88d.js";import{a as G}from"./asyncComputed.4acb40f3.js";import{J as Te}from"./jobs.f9bdba5e.js";import{W as Re}from"./workspaces.7a27fae6.js";import{A as Ae}from"./record.8667ddd6.js";import{A as Y}from"./Form.01134ed5.js";import{A as $e}from"./index.a63dba09.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="bc36db31-835a-4048-90a9-d80710624b5e",s._sentryDebugIdIdentifier="sentry-dbid-bc36db31-835a-4048-90a9-d80710624b5e")}catch{}})();class je{async list(){return await(await fetch("/_editor/api/scripts")).json()}async create(){return await(await fetch("/_editor/api/scripts",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}async get(e){return await(await fetch(`/_editor/api/scripts/${e}`)).json()}async update(e,t){return await(await fetch(`/_editor/api/scripts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async delete(e,t){const n=t?"?remove_file=true":"",r=`/_editor/api/scripts/${e}`+n;await fetch(r,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async test(e){return(await fetch(`/_editor/api/scripts/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()}}const b=new je;class x{constructor(e){A(this,"record");this.record=Ae.create(b,e)}static async list(){return(await b.list()).map(t=>new x(t))}static async create(){const e=await b.create();return new x(e)}static async get(e){const t=await b.get(e);return new x(t)}async delete(e){await b.delete(this.id,e)}async duplicate(){return this}async save(){await this.record.save()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(e){return this.record.hasChanges(e)}get id(){return this.record.get("id")}get schedule(){return this.record.get("schedule")}set schedule(e){this.record.set("schedule",e)}get title(){return this.record.get("title")}set title(e){this.record.set("title",e)}get file(){return this.record.get("file")}set file(e){this.record.set("file",e)}get path(){return this.record.get("path")}set path(e){this.record.set("path",e)}async test(){return b.test(this.id)}get position(){const[e,t]=this.record.get("workflow_position");return{x:e,y:t,referential:"world"}}get isInitial(){return!1}}class ae{constructor(){A(this,"logState",X({log:[]}));A(this,"_listeners",{})}static create(){return new ae}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const n=t?this.logs.find(r=>r.id===t):null;return n?Object.assign(n,e):this.logs.push({...e,id:t||P()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=P();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class De{static async*sendMessage(e,t){var l;const r=(l=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:l.getReader();if(!r)throw new Error("No response body");for(;;){const c=await r.read();if(c.done)break;yield new TextDecoder().decode(c.value)}}}const Oe=s=>(Z("data-v-59ca7295"),s=s(),ee(),s),Be=Oe(()=>o("div",{class:"text"}," Changes were made in your code. Click Restart to refresh the preview window. ",-1)),Q="ignoreCodeChangesWarning",Le=O({__name:"ChangesWarning",props:{hasChanges:{type:Boolean}},setup(s){var l;const e=s,t=p((l=H.get(Q))!=null?l:!1),n=j(()=>e.hasChanges&&!t.value),r=()=>{H.set(Q,!0),t.value=!0};return(c,f)=>(d(),v("div",{class:$(["changes-warning",{visible:n.value}])},[Be,o("div",{class:"no-more-alert",onClick:r},"Do not show again")],2))}});const Ne=z(Le,[["__scopeId","data-v-59ca7295"]]),Pe=s=>(Z("data-v-fa74f10a"),s=s(),ee(),s),ze={class:"smart-console"},We={class:"header"},Fe={class:"left"},Me={class:"right"},Ue={class:"changes-container"},Ke=["unseen-severity"],He={class:"cli"},Je={class:"left"},Ve=Pe(()=>o("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),qe={key:1,class:"local-entry"},Ge={class:"input"},Ye=["pointer-events","onKeydown"],Qe={class:"right"},Xe=O({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(s,{emit:e}){const t=s,n=p(""),r=p(null),l=ge(),c=p({type:"seen"}),f=p(!1),u=p(!1),m=()=>{t.logService.clear(),e("restart")},T=()=>{S.value=S.value==="assistant"?"debugger":"assistant"};function k(a){switch(a.type){case"ai-input":return{role:"user",content:a.log};case"ai-output":return{role:"assistant",content:a.log};case"stderr":case"stdout":return{role:"user",content:a.log};case"restart":return{role:"user",content:"-- new session --"};case"files-changed":return{role:"user",content:"-- files changed --"};default:throw new Error(`Unknown log type: ${a.type}`)}}const oe=j(()=>t.logService.logs.some(a=>a.type==="files-changed"));function re(){_.value=!_.value,_.value&&(c.value={type:"seen"})}fe(l,()=>{t.logService.clear(),e("clear-terminal")});const R=p(null),S=p("assistant"),ie=async a=>{var y;if(a.preventDefault(),n.value=((y=R.value)==null?void 0:y.innerText)||"",a.shiftKey){document.execCommand("insertLineBreak");return}R.value&&(R.value.innerText=""),S.value==="assistant"?await le():await ce()},le=async()=>{var y;if(e("enter",n.value),t.logService.log({type:"ai-input",log:n.value}),n.value="",!u.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}f.value=!0;const a={role:"user",content:(y=t.formCode)!=null?y:""};try{const w=P();let g="";const L=De.sendMessage([a,...t.logService.logs.map(N=>k(N)),{role:"user",content:n.value}],t.runtime);for await(const N of L)g+=N,t.logService.log({type:"ai-output",log:g},w)}catch(w){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(w),ke(w)}finally{f.value=!1}},ce=async()=>{n.value&&(t.logService.log({type:"eval-input",log:`>>> ${n.value}`}),e("eval-request",n.value),n.value="")},ue=()=>{t.logService.clear()};t.logService.listen(async a=>{_.value||(c.value={type:"unseen",count:c.value.type==="unseen"?c.value.count+1:1,severity:a.type==="stderr"?"error":"info"}),a.type!=="restart"&&(await me(),r.value&&(r.value.scrollTop=r.value.scrollHeight))});const _=p(!1),M=p(400),de=j(()=>({height:`${M.value}px`})),B=p(!1),pe=()=>B.value=!0,U=a=>{!B.value||(M.value=document.body.clientHeight-a.clientY)},K=()=>B.value=!1;return ye(()=>{document.addEventListener("mousemove",U),document.addEventListener("mouseup",K),xe.get().then(a=>{u.value=!!a.logged})}),_e(()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",K)}),(a,y)=>{const w=te("Markdown");return d(),v("div",ze,[o("div",We,[o("div",Fe,[h(I,{path:S.value==="assistant"?i(J):i(V)},null,8,["path"]),W(" Smart Console ")]),o("div",Me,[o("div",Ue,[h(Ne,{"has-changes":oe.value},null,8,["has-changes"]),o("button",{class:"header-button",onClick:m},"Restart")]),o("div",{class:"toggle-button",onClick:re},[h(I,{class:$(["icon",{open:_.value}]),path:i(q),fill:"#fff"},null,8,["class","path"]),c.value.type==="unseen"?(d(),v("div",{key:0,class:"unseen-count","unseen-severity":c.value.severity},D(c.value.count),9,Ke)):E("",!0)])])]),_.value?(d(),v("div",{key:0,class:"terminal",style:we(de.value)},[o("div",{class:"resize-handler",onMousedown:pe},null,32),o("div",He,[o("div",Je,[o("div",{ref_key:"entriesContainer",ref:r,class:"entries"},[Ve,(d(!0),v(se,null,be(t.logService.logs,(g,L)=>(d(),v("div",{key:L,class:$([g.type,"entry"])},[g.type==="ai-output"?(d(),F(w,{key:0,source:g.log},null,8,["source"])):(d(),v("div",qe,D(g.type==="restart"?"-- restarted --":g.log),1))],2))),128))],512),o("div",Ge,[h(I,{class:$(["icon",{open:_.value}]),path:i(q)},null,8,["class","path"]),o("div",{ref_key:"inputRef",ref:R,class:"input-text",contenteditable:"","pointer-events":f.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:Ce(ie,["enter"])},null,40,Ye)])]),o("div",Qe,[o("div",{class:"icons",onClick:ue},[h(I,{class:"icon",path:i(Se)},null,8,["path"])]),o("div",null,[h(I,{class:"icon clickable",path:S.value==="assistant"?i(J):i(V),onClick:y[0]||(y[0]=g=>T())},null,8,["path"])])])])],4)):E("",!0)])}}});const vt=z(Xe,[["__scopeId","data-v-fa74f10a"]]),Ze=O({__name:"PathInput",props:{runtime:{}},setup(s){const e=s,t=p(!1),n=async()=>{t.value=!0;const l=await(await fetch("/_editor/api/utils/normalize_path",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e.runtime.path})})).text();l&&l!==e.runtime.path&&(e.runtime.path=l),t.value=!1};return(r,l)=>(d(),F(i(ne),{value:r.runtime.path,"onUpdate:value":l[0]||(l[0]=c=>r.runtime.path=c),type:"text",disabled:t.value,onBlur:n},{addonBefore:C(()=>[W(" https://[your-subdomain].abstra.app/ ")]),_:1},8,["value","disabled"]))}}),et={class:"file-path"},tt={key:1},st=O({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(s){const e=s,t=X({pathError:null}),{result:n}=G(()=>Re.get()),r=()=>{!n.value||!e.runtime.file||n.value.openFile(e.runtime.file)},l=j(()=>{var u;return(u=e.runtime.file)!=null&&u.endsWith(".py")?e.runtime.hasChanges("file")?"The original file will be renamed after saving":null:"It should be a .py file"}),c=()=>{!n.value||!f.value||n.value.openFile(".")},{result:f}=G(()=>fetch("/_editor/api/workspace/root").then(u=>u.text()));return(u,m)=>{const T=te("icon");return d(),v(se,null,[h(i($e),null,{default:C(()=>[h(i(Y),{label:"Source code",help:l.value},{default:C(()=>[h(i(ne),{value:u.runtime.file,"onUpdate:value":m[2]||(m[2]=k=>u.runtime.file=k),type:"text"},{addonBefore:C(()=>[i(f)?(d(),v("span",{key:0,class:"clickable",onClick:m[0]||(m[0]=k=>c())},[h(T,{class:"clickable",path:i(Ie)},null,8,["path"]),o("p",et,D(i(f)),1)])):E("",!0)]),addonAfter:C(()=>[o("span",{class:"clickable",onClick:m[1]||(m[1]=k=>r())},[h(T,{class:"clickable",path:i(Ee)},null,8,["path"]),W(" Open file ")])]),_:1},8,["value"])]),_:1},8,["help"])]),_:1}),u.runtime instanceof i(Te)||u.runtime instanceof i(x)?E("",!0):(d(),F(i(Y),{key:0,label:"URL path"},{default:C(()=>[h(Ze,{runtime:u.runtime},null,8,["runtime"])]),_:1})),t.pathError?(d(),v("div",tt,D(t.pathError),1)):E("",!0)],64)}}});const gt=z(st,[["__scopeId","data-v-2ed86fc9"]]);export{ae as L,gt as R,vt as S};
//# sourceMappingURL=RuntimeCommonSettings.7e7b3b8c.js.map

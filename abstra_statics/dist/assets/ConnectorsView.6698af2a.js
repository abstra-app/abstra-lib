var de=Object.defineProperty;var pe=(l,t,a)=>t in l?de(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var K=(l,t,a)=>(pe(l,typeof t!="symbol"?t+"":t,a),a);import{_ as ge}from"./DocsButton.vue_vue_type_script_setup_true_lang.bd96adff.js";import{_ as ee}from"./AbstraButton.vue_vue_type_script_setup_true_lang.f540b263.js";import{d as Z,at as G,c as B,o as c,ac as w,ae as ye,h as $,ew as he,e as P,z as me,r as M,M as J,w as oe,a as v,b as i,eB as D,u as n,cE as fe,bQ as W,cW as ve,aY as j,cU as Ce,g as C,t as k,cA as _e,bT as ke,aI as be,cJ as we,dg as Ie,f as s,i as m,df as H,cD as Te,dj as T,de as O,c$ as xe,d9 as le,ez as Se,_ as ce,eA as Ae,Z as ie,cM as Y,A as Q,bW as Ue,bE as je,bD as se,cI as $e}from"./jwt-decode.esm.3f85b5bd.js";import{G as Ne}from"./PhDotsThreeVertical.vue.238bcbc1.js";import{k as z,o as Ve}from"./router.15a12e65.js";import{U as Ee}from"./UploadOutlined.098af60f.js";import{_ as Ke}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.76eea27b.js";import{L as Le}from"./Logo.26a483eb.js";import{A as re}from"./index.8b0cec7f.js";import{C as ue}from"./Card.8d826208.js";import{b as Fe}from"./index.c0e60a0a.js";import"./constants.67b980b7.js";import"./index.9bf11922.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[t]="7f97dd94-002b-40ca-b546-0865a25bb064",l._sentryDebugIdIdentifier="sentry-dbid-7f97dd94-002b-40ca-b546-0865a25bb064")}catch{}})();const ze=["width","height","fill","transform"],He={key:0},Re=P("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),Be=[Re],Pe={key:1},Me=P("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),De=P("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Ze=[Me,De],qe={key:2},Ge=P("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),Oe=[Ge],Je={key:3},We=P("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),Ye=[We],Qe={key:4},Xe=P("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),en=[Xe],nn={key:5},tn=P("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),an=[tn],on={name:"PhArrowsLeftRight"},ln=Z({...on,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const t=l,a=G("weight","regular"),e=G("size","1em"),r=G("color","currentColor"),h=G("mirrored",!1),_=B(()=>{var I;return(I=t.weight)!=null?I:a}),u=B(()=>{var I;return(I=t.size)!=null?I:e}),x=B(()=>{var I;return(I=t.color)!=null?I:r}),N=B(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:h?"scale(-1, 1)":void 0);return(I,L)=>(c(),w("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:u.value,height:u.value,fill:x.value,transform:N.value},I.$attrs),[ye(I.$slots,"default"),_.value==="bold"?(c(),w("g",He,Be)):_.value==="duotone"?(c(),w("g",Pe,Ze)):_.value==="fill"?(c(),w("g",qe,Oe)):_.value==="light"?(c(),w("g",Je,Ye)):_.value==="regular"?(c(),w("g",Qe,en)):_.value==="thin"?(c(),w("g",nn,an)):$("",!0)],16,ze))}});class sn{async generateEcdsaKey(t){const{projectId:a,connectionName:e,connectorType:r}=t;return z.post(`projects/${a}/connectors/${r}/connections/${e}/ecdsa-key`,{})}async createEcdsaConnection(t){const{projectId:a,connectionName:e,connectorType:r,publicKey:h,privateKey:_,accessId:u}=t;return z.post(`projects/${a}/connectors/${r}/connections/${e}/create-ecdsa`,{publicKey:h,privateKey:_,accessId:u})}async generateRsaKey(t){const{projectId:a,connectionName:e,connectorType:r}=t;return z.post(`projects/${a}/connectors/${r}/connections/${e}/rsa-key`,{})}async createRsaConnection(t){const{projectId:a,connectionName:e,connectorType:r,publicKey:h,privateKey:_,apiToken:u}=t;return z.post(`projects/${a}/connectors/${r}/connections/${e}/create-rsa`,{publicKey:h,privateKey:_,apiToken:u})}async getLoginUrl(t,a,e,r,h){return z.get(`projects/${t}/connectors/${e}/connections/${a}/login-url`,{scopeIds:r.join(","),...h})}async listConnectors(t){return z.get(`projects/${t}/connectors`)}async getConnectorsBetaStatus(){const{EnvURL:t}=await me(()=>import("./router.15a12e65.js").then(a=>a.q),["assets/router.15a12e65.js","assets/jwt-decode.esm.3f85b5bd.js","assets/jwt-decode.6e4bcae0.css","assets/index.9bf11922.js"]);try{const a=await fetch(`${t.cloudApi}/public/connectors/beta-status`);if(!a.ok){if(a.status===404)return console.warn("Beta status endpoint not available yet, returning empty status"),{};throw new Error("Failed to fetch connectors beta status")}return a.json()}catch(a){return console.error("Error fetching beta status:",a),{}}}async createTokenConnection(t){const{projectId:a,connectionName:e,connectorType:r,tokens:h}=t,_={type:"tokens",tokens:h};return z.post(`projects/${a}/connectors/${r}/connections/${e}`,_)}async listConnections(t){return z.get(`projects/${t}/connections`)}async deleteConnection(t){const{projectId:a,connectionName:e,connectorType:r}=t;return z.delete(`projects/${a}/connectors/${r}/connections/${e}`)}async renameConnection(t){const{projectId:a,connectionName:e,connectorType:r,newConnectionName:h}=t;return z.patch(`projects/${a}/connectors/${r}/connections/${e}`,{newConnectionName:h})}}class cn{constructor(t,a){K(this,"state");K(this,"hasChanges",B(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));K(this,"handleDeletionClick",async t=>{J.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(t)})});K(this,"handleDeleteConnection",async t=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});K(this,"handleAddConnectionSubmit",async()=>{var h,_,u,x;const t=(h=this.state.value.addingConnection)==null?void 0:h.connector.metadata.key,a=(_=this.state.value.addingConnection)==null?void 0:_.selectedScopeIds,e=(x=(u=this.state.value.addingConnection)==null?void 0:u.tokenValues)!=null?x:{};if(!t||!a)throw new Error("No connector or scope selected");const{url:r}=await this.getLoginUrl(t,this.getUniqueName(t),a,e);window.location.href=r});K(this,"handleAddTokenConnectionSubmit",async()=>{const t=this.state.value.addingConnection;if(!t)throw new Error("No connection is being added");const a=t.connector.metadata.key,e=this.getUniqueName(a);await this.api.createTokenConnection({projectId:this.projectId,connectionName:e,connectorType:a,tokens:t.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()});K(this,"handleAddEcdsaConnectionSubmit",async(t,a)=>{const e=this.state.value.addingConnection;if(!e||!t)throw new Error("No connection is being added or public key is missing");if(!e.connectionName||!e.ecdsaKeys)throw new Error("Keys or connection name not found");const r=e.connector.metadata.key;if(r==="iugu"){if(!a)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:e.connectionName,connectorType:r,publicKey:e.ecdsaKeys.publicKey,privateKey:e.ecdsaKeys.privateKey,apiToken:a})}else{if(!a)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:e.connectionName,connectorType:r,publicKey:e.ecdsaKeys.publicKey,privateKey:e.ecdsaKeys.privateKey,accessId:a})}this.state.value.addingConnection=null,await this.refetchConnections()});K(this,"renameConnection",async()=>{const{editingConnection:t}=this.state.value;if(!t)throw new Error("No connection is being edited");const a=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType,newConnectionName:t.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};J.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:a})});K(this,"showAddConfirmationModal",t=>{this.state.value.addingConnection={selectedScopeIds:t.auth.type==="oauth2"?t.auth.scopes.map(a=>a.key):[],connector:t,tokenValues:{}}});K(this,"handleScopeToggle",(t,a)=>{a?this.state.value.addingConnection.selectedScopeIds.push(t):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(e=>e!==t)});this.projectId=t,this.api=a,this.state=M({connectors:[],connections:[],addingConnection:null,editingConnection:null,betaStatus:{}})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchBetaStatus(){this.state.value.betaStatus=await this.api.getConnectorsBetaStatus()}async fetchInitialState(){await this.fetchConnectors(),await Promise.all([this.fetchBetaStatus(),this.refetchConnections()])}async refetchConnections(){const t=await this.api.listConnections(this.projectId);this.state.value.connections=t.map(a=>{const e=this.state.value.connectors.find(r=>r.metadata.key===a.connectionType);return e?{name:a.name,connectorTitle:e.metadata.label,connectorType:a.connectionType,icon:e.metadata.logoUrl}:null}).filter(a=>a!==null)}handleEditConnectionClick(t){this.state.value.editingConnection={...t,newName:t.name}}async getLoginUrl(t,a,e,r){return this.api.getLoginUrl(this.projectId,a,t,e,r)}slugify(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(t){const a=this.state.value.connections.filter(e=>e.connectorType===t).length;return a===0?t:`${t}-${a}`}async generateEcdsaKey(){const t=this.state.value.addingConnection;if(!t)throw new Error("No connection is being added");const a=t.connector.metadata.key,e=this.getUniqueName(a),h=a==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:e,connectorType:a}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:e,connectorType:a});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=e,this.state.value.addingConnection.ecdsaKeys=h),h.publicKey}}function rn(l){return new Promise((t,a)=>{const e=new FileReader;e.onload=()=>{const h=e.result.split(",")[1];t(h)},e.onerror=()=>a(e.error),e.readAsDataURL(l)})}const un={key:6,style:{"margin-top":"16px"}},X=Z({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(l,{emit:t}){const a=l,e=t,r=M(a.uploadedFiles||{});function h(d){const p=u.value[d];return p?p.split(",").map(o=>o.trim()):[]}function _(d,p){Array.isArray(p)?x(d,p.join(",")):console.error("Expected array for checkbox/select value")}const u=M({...a.tokenValues});oe(()=>a.tokenValues,d=>{u.value={...d}},{deep:!0}),oe(()=>a.uploadedFiles,d=>{r.value=d||{}},{deep:!0});function x(d,p){u.value[d]=p;const o={...u.value};e("update:tokenValues",o),e("tokenChange")}function N(d){var o,A;const p=[];return d.key&&p.push({required:!0,message:m.translate("i18n_auth_form_field_required",null,d.label||d.key)}),(o=d.input)!=null&&o.minSize&&p.push({min:d.input.minSize,message:m.translate("i18n_auth_form_field_min_length",null,d.input.minSize)}),(A=d.input)!=null&&A.maxSize&&p.push({max:d.input.maxSize,message:m.translate("i18n_auth_form_field_max_length",null,d.input.maxSize)}),p}async function I(d,p){try{const o=await rn(d),A={...r.value,[p]:{file:d,base64:o}};r.value=A,e("update:uploadedFiles",A),u.value[p]=o;const R={...u.value};e("update:tokenValues",R),e("tokenChange")}catch(o){console.error("Error converting file to base64:",o)}return!1}function L(d){const p={...r.value};delete p[d],r.value=p,e("update:uploadedFiles",p),u.value[d]="";const o={...u.value};e("update:tokenValues",o),e("tokenChange")}function V(d){const p=r.value[d];return p?[{uid:d,name:p.file.name,status:"done",size:p.file.size}]:[]}return(d,p)=>(c(),v(n(Te),{model:u.value,layout:"vertical"},{default:i(()=>[(c(!0),w(j,null,D(l.tokens,o=>(c(),v(n(fe),{key:o.key,label:o.label,name:o.key,rules:N(o)},{default:i(()=>{var A,R,g,f,y,U,S,F,E,q,ne,te,ae;return[((A=o.input)==null?void 0:A.type)==="small-string"?(c(),v(n(W),{key:0,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,placeholder:o.description,maxlength:(R=o.input)==null?void 0:R.maxSize,minlength:(g=o.input)==null?void 0:g.minSize,type:"password",onInput:()=>x(o.key,u.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((f=o.input)==null?void 0:f.type)==="radiobox"?(c(),v(n(ve),{key:1,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,onChange:()=>x(o.key,u.value[o.key]||"")},{default:i(()=>[(c(!0),w(j,null,D(o.input.options,b=>(c(),v(n(Ce),{key:b.value,value:b.value},{default:i(()=>[C(k(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):((y=o.input)==null?void 0:y.type)==="checkbox"?(c(),w(j,{key:2},[((F=(S=(U=o.input)==null?void 0:U.options)==null?void 0:S.length)!=null?F:0)<=10?(c(),v(n(_e),{key:0,value:h(o.key),onChange:b=>_(o.key,b)},{default:i(()=>[(c(!0),w(j,null,D(o.input.options,b=>(c(),v(n(ke),{key:b.value,value:b.value},{default:i(()=>[C(k(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(c(),v(n(be),{key:1,mode:"multiple",style:{width:"100%"},value:h(o.key),options:(E=o.input.options)!=null?E:[],onChange:b=>_(o.key,b)},null,8,["value","options","onChange"]))],64)):((q=o.input)==null?void 0:q.type)==="large-text"?(c(),v(n(we),{key:3,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,placeholder:o.description,maxlength:(ne=o.input)==null?void 0:ne.maxSize,minlength:(te=o.input)==null?void 0:te.minSize,rows:4,onInput:()=>x(o.key,u.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((ae=o.input)==null?void 0:ae.type)==="file"?(c(),v(n(Ie),{key:4,"file-list":V(o.key),"before-upload":b=>I(b,o.key),"max-count":1,"show-upload-list":!0,onRemove:()=>L(o.key)},{default:i(()=>[s(ee,null,{default:i(()=>[s(n(Ee)),C(" "+k(n(m).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:1},8,["file-list","before-upload","onRemove"])):(c(),v(n(W),{key:5,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,placeholder:o.description,type:"password",onInput:()=>x(o.key,u.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),o.instructions?(c(),w("div",un,[s(n(H),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:i(()=>[C(k(o.instructions),1)]),_:2},1024)])):$("",!0),o.description&&!o.instructions?(c(),v(n(H),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:i(()=>[C(k(o.description),1)]),_:2},1024)):$("",!0)]}),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"]))}}),dn=Z({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(l){return(t,a)=>(c(),v(n(T),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:i(()=>[s(Ke,{"hide-text":"",size:"large"}),s(n(ln),{size:24}),s(Le,{"image-url":l.connectorLogoUrl,"brand-name":l.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),pn=Z({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(l,{emit:t}){const a=l,e=t,r=B(()=>{var d,p,o;switch((d=a.addingConnection)==null?void 0:d.connector.auth.type){case"oauth2":return m.translate("i18n_connection_modal_button_authorize",null);case"tokens":return m.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!a.ecdsaPublicKey)return m.translate("i18n_connection_modal_button_ok",null);const A=((p=a.addingConnection)==null?void 0:p.connector.auth.params)||[],R=((o=a.addingConnection)==null?void 0:o.tokenValues)||{};return A.every(f=>R[f.key]&&R[f.key].trim().length>0)?m.translate("i18n_connection_modal_button_create",null):m.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return m.translate("i18n_connection_modal_button_ok",null)}});function h(){e("cancel")}function _(){e("submit")}function u(V,d){e("scope-toggle",V,d)}function x(){e("generate-ecdsa-key")}function N(V){e("update:token-values",V)}function I(V){e("update:uploaded-files",V)}function L(){e("token-change")}return(V,d)=>(c(),v(n(J),{open:!!l.addingConnection,title:l.addingConnection?n(m).translate("i18n_connection_modal_title_add",null,l.addingConnection.connector.metadata.label):"","ok-text":r.value,"ok-button-props":{disabled:r.value.includes("Required")},"confirm-loading":l.loading,"wrap-class-name":"full-modal",onCancel:h,onOk:_},{default:i(()=>[l.addingConnection?(c(),w(j,{key:0},[s(dn,{"connector-logo-url":l.addingConnection.connector.metadata.logoUrl,"connector-label":l.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),l.addingConnection.connector.auth.type==="oauth2"?(c(),w(j,{key:0},[s(n(O),null,{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),s(n(T),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:i(()=>{var p;return[(c(!0),w(j,null,D(l.addingConnection.connector.auth.scopes,o=>(c(),v(n(T),{key:o.key,justify:"space-between",align:"center"},{default:i(()=>[s(n(T),{vertical:""},{default:i(()=>[s(n(H),null,{default:i(()=>[C(k(o.description),1)]),_:2},1024),s(n(H),{type:"secondary"},{default:i(()=>[C(k(o.key),1)]),_:2},1024)]),_:2},1024),s(n(xe),{checked:l.addingConnection.selectedScopeIds.includes(o.key),onChange:A=>u(o.key,A)},null,8,["checked","onChange"])]),_:2},1024))),128)),(p=l.addingConnection.connector.auth.params)!=null&&p.length?(c(),v(X,{key:0,tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":N,"onUpdate:uploadedFiles":I,onTokenChange:L},null,8,["tokens","token-values","uploaded-files"])):$("",!0)]}),_:1})],64)):$("",!0),l.addingConnection.connector.auth.type==="tokens"?(c(),w(j,{key:1},[s(n(O),null,{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),s(X,{tokens:l.addingConnection.connector.auth.tokens,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":N,"onUpdate:uploadedFiles":I,onTokenChange:L},null,8,["tokens","token-values","uploaded-files"])],64)):$("",!0),l.addingConnection.connector.auth.type==="ecdsa"?(c(),w(j,{key:2},[l.ecdsaPublicKey?(c(),v(n(T),{key:1,vertical:"",gap:"16"},{default:i(()=>[s(n(H),{strong:""},{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),s(n(H),{strong:""},{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),s(n(W),{value:l.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),s(X,{tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":N,"onUpdate:uploadedFiles":I,onTokenChange:L},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(c(),w(j,{key:0},[s(n(O),null,{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),s(n(T),{vertical:"",gap:"16"},{default:i(()=>[s(ee,{loading:l.ecdsaKeyLoading,onClick:x},{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):$("",!0)],64)):$("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),gn=Z({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{},isBeta:{type:Boolean}},setup(l){return(t,a)=>(c(),v(n(ue),{class:Se({"connector-card":!0,unavailable:l.unavailable})},{default:i(()=>[s(n(T),{style:{width:"100%"},vertical:"",gap:12},{default:i(()=>[s(n(T),{justify:"space-between"},{default:i(()=>[s(n(re),{src:l.logoUrl,shape:"square",size:"large"},null,8,["src"]),s(n(T),{gap:8},{default:i(()=>[l.isBeta?(c(),v(n(le),{key:0,color:"orange",style:{height:"fit-content"}},{default:i(()=>[...a[0]||(a[0]=[C("BETA",-1)])]),_:1})):$("",!0),l.unavailable?(c(),v(n(le),{key:1,style:{height:"fit-content"}},{default:i(()=>[C(k(n(m).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):$("",!0)]),_:1})]),_:1}),s(n(T),{vertical:""},{default:i(()=>[s(n(H),{strong:""},{default:i(()=>[C(k(l.title),1)]),_:1}),s(n(H),{type:"secondary"},{default:i(()=>[C(k(l.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const yn=ce(gn,[["__scopeId","data-v-86187920"]]),hn={class:"connectors-grid"},mn=Z({__name:"ConnectorsView",setup(l){const a=Ae().params.projectId,e=new cn(a,new sn),r=M(null),h=M(!1),_=M({}),u=M(!1),x=B(()=>[...e.state.value.connectors.filter(g=>g.auth.type==="oauth2"),...e.state.value.connectors.filter(g=>g.auth.type==="tokens"),...e.state.value.connectors.filter(g=>g.auth.type==="ecdsa"),...e.state.value.connectors.filter(g=>g.auth.type==="manual")]),N=M(""),I=B(()=>{if(!N.value.trim())return x.value;const g=N.value.trim().toLowerCase();return x.value.filter(f=>{var S,F;const y=((S=f.metadata.label)==null?void 0:S.toLowerCase())||"",U=((F=f.metadata.key)==null?void 0:F.toLowerCase())||"";return y.includes(g)||U.includes(g)})}),L=B(()=>e.state.value.connections.filter(g=>g&&g.name&&g.connectorTitle&&g.connectorType));e.fetchInitialState();function V(g){e.state.value.addingConnection&&(e.state.value.addingConnection.tokenValues=g)}function d(g){_.value=g}function p(){r.value=null,h.value=!1,_.value={}}async function o(){h.value=!0;try{const f=(await e.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");r.value=f}finally{h.value=!1}}async function A(){var f,y,U;const g=(f=e.state.value.addingConnection)==null?void 0:f.connector.auth.type;u.value=!0;try{switch(g){case"oauth2":return await e.handleAddConnectionSubmit();case"tokens":return await e.handleAddTokenConnectionSubmit();case"ecdsa":{const S=((y=e.state.value.addingConnection)==null?void 0:y.tokenValues)||{},F=(U=e.state.value.addingConnection)==null?void 0:U.connector.metadata.key;let E="";F==="starkbank"?E=S.projectId||"":F==="iugu"&&(E=S.apiToken||"");const q=await e.handleAddEcdsaConnectionSubmit(r.value,E);return p(),q}default:break}}catch(S){const F=E=>{try{return JSON.parse(E),!0}catch{return!1}};if(S instanceof Error&&F(S.message)){const E=ie.object({error:ie.string()}).safeParse(JSON.parse(S.message));if(E.success){Y.error(E.data.error);return}else{Y.error(m.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:S instanceof Error?S.message:"Unknown error"}));return}}else Y.error(m.translate("i18n_connectorsview_failed_to_create"))}finally{u.value=!1}}function R(g){g.auth.type==="manual"?Ve.showNewMessage(m.translate("i18n_connectors_ask_for_access",null,g.metadata.label)):e.showAddConfirmationModal(g)}return(g,f)=>(c(),w(j,null,[s(n(Fe),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:i(()=>[s(n(T),{align:"center",justify:"space-between"},{default:i(()=>[s(n(Q),null,{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),s(n(O),null,{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_description"))+" ",1),s(ge)]),_:1}),L.value.length?(c(),v(n(T),{key:0,vertical:""},{default:i(()=>[s(n(Q),{level:2},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_installed")),1)]),_:1}),s(n(T),{vertical:"",gap:10},{default:i(()=>[(c(!0),w(j,null,D(L.value,y=>(c(),v(n(ue),{key:y.name},{default:i(()=>[s(n(T),{align:"center",gap:20},{default:i(()=>[s(n(re),{src:y.icon,height:"40px",shape:"square"},null,8,["src"]),s(n(H),{strong:""},{default:i(()=>[C(k(y.connectorTitle),1)]),_:2},1024),f[6]||(f[6]=P("div",{style:{"flex-grow":"1"}},null,-1)),s(n(H),{content:y.name,copyable:"",code:""},null,8,["content"]),s(n(Ue),null,{overlay:i(()=>[s(n(je),null,{default:i(()=>[s(n(se),{onClick:U=>n(e).handleEditConnectionClick(y)},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_rename")),1)]),_:1},8,["onClick"]),s(n(se),{danger:"",onClick:U=>n(e).handleDeletionClick(y)},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:i(()=>[s(n(Ne))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):$("",!0),s(n(T),{vertical:""},{default:i(()=>[L.value.length?(c(),v(n(Q),{key:0,level:2},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_available")),1)]),_:1})):$("",!0),s(n($e),{value:N.value,"onUpdate:value":f[0]||(f[0]=y=>N.value=y),placeholder:n(m).translate("i18n_connectorsview_search_placeholder"),style:{width:"300px","margin-bottom":"40px"}},null,8,["value","placeholder"]),P("div",hn,[(c(!0),w(j,null,D(I.value,y=>{var U;return c(),v(yn,{key:y.metadata.key,title:y.metadata.label,"logo-url":y.metadata.logoUrl,description:y.metadata.description,unavailable:y.auth.type==="manual",connector:y,"is-beta":(U=n(e).state.value.betaStatus[y.metadata.key])!=null?U:!1,onClick:S=>R(y)},null,8,["title","logo-url","description","unavailable","connector","is-beta","onClick"])}),128))])]),_:1})]),_:1}),s(n(J),{open:!!n(e).state.value.editingConnection,title:n(e).state.value.editingConnection?n(m).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:n(e).state.value.editingConnection.connectorTitle}):"",onCancel:f[3]||(f[3]=y=>n(e).state.value.editingConnection=null)},{footer:i(()=>[s(n(T),{justify:"end"},{default:i(()=>[s(ee,{disabled:!n(e).hasChanges.value,onClick:f[2]||(f[2]=y=>n(e).renameConnection())},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[n(e).state.value.editingConnection?(c(),v(n(W),{key:0,value:n(e).state.value.editingConnection.newName,"onUpdate:value":f[1]||(f[1]=y=>n(e).state.value.editingConnection.newName=y)},null,8,["value"])):$("",!0)]),_:1},8,["open","title"]),s(pn,{"adding-connection":n(e).state.value.addingConnection,"ecdsa-public-key":r.value,"ecdsa-key-loading":h.value,"uploaded-files":_.value,loading:u.value,onCancel:f[4]||(f[4]=()=>{n(e).state.value.addingConnection=null,p()}),onSubmit:A,onScopeToggle:f[5]||(f[5]=(y,U)=>n(e).handleScopeToggle(y,U)),onGenerateEcdsaKey:o,"onUpdate:tokenValues":V,"onUpdate:uploadedFiles":d},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}});const $n=ce(mn,[["__scopeId","data-v-41fbcf6c"]]);export{$n as default};
//# sourceMappingURL=ConnectorsView.6698af2a.js.map

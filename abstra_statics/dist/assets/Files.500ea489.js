import{_ as be}from"./DocsButton.vue_vue_type_script_setup_true_lang.a564aea3.js";import{f as c,e7 as k,f3 as _e,d as oe,r as S,ae as L,w as E,c as $,o as p,a5 as A,e as O,b as u,u as i,aR as Oe,ec as we,a as g,ed as z,de as I,g as P,ct as Z,h as j,cD as Pe,bM as K,ef as Ce,ei as Se,cx as je,bO as $e,bJ as ze,M as Ie,H as x,_ as se,eb as xe,A as Fe,d9 as Ae}from"./jwt-decode.esm.4c0b19d6.js";import{h as w,e as ke,d as Ue,p as De}from"./router.cb6bfcb7.js";import{a as He}from"./asyncComputed.6fae62bc.js";import{f as ee}from"./string.4eb83fc1.js";import{a as Me,I as Ve,_ as Le}from"./files.1bd0ade4.js";import{G as Ee,a as Te}from"./PhFolderPlus.vue.df5d6e97.js";import{_ as F}from"./AbstraButton.vue_vue_type_script_setup_true_lang.d01e2385.js";import{B as Be,A as te}from"./Breadcrumb.d1ac8b56.js";import"./tables.f904b54d.js";import{C as Re}from"./Card.3cffdaaf.js";import"./constants.bf6e84ec.js";import"./index.3ba05fce.js";import"./record.c117af00.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="a7f53f79-3866-410c-b49e-afda5981c384",r._sentryDebugIdIdentifier="sentry-dbid-a7f53f79-3866-410c-b49e-afda5981c384")}catch{}})();var Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"};const Ge=Ne;var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"};const Je=qe;var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const We=Qe;function ae(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),s.forEach(function(l){Xe(r,l,t[l])})}return r}function Xe(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var T=function(e,t){var s=ae({},e,t.attrs);return c(k,ae({},s,{icon:_e}),null)};T.displayName="DeleteOutlined";T.inheritAttrs=!1;const Ye=T;function ne(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),s.forEach(function(l){Ze(r,l,t[l])})}return r}function Ze(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var B=function(e,t){var s=ne({},e,t.attrs);return c(k,ne({},s,{icon:Ge}),null)};B.displayName="FolderAddOutlined";B.inheritAttrs=!1;const Ke=B;function re(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),s.forEach(function(l){et(r,l,t[l])})}return r}function et(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var R=function(e,t){var s=re({},e,t.attrs);return c(k,re({},s,{icon:Je}),null)};R.displayName="HomeOutlined";R.inheritAttrs=!1;const tt=R;function le(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),s.forEach(function(l){at(r,l,t[l])})}return r}function at(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var N=function(e,t){var s=le({},e,t.attrs);return c(k,le({},s,{icon:We}),null)};N.displayName="UploadOutlined";N.inheritAttrs=!1;const nt=N;class G{constructor(e){this.projectId=e}static fromProjectId(e){return new G(e)}async list(e,t,s,l){const m=new URLSearchParams;m.set("limit",e.toString()),m.set("offset",t.toString()),s&&s.trim()&&m.set("search",s.trim()),l&&l.trim()&&m.set("path",l.trim());const U=m.toString(),d=`projects/${this.projectId}/files?${U}`,f=await w.get(d);return{items:f.items,totalCount:f.totalCount}}async upload(e,t){const s={"Content-Type":"multipart/form-data"},l=new File([t||new Uint8Array],Me(e));return w.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e)}`,l,s)}async download(e){return w.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return w.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,t){return w.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(t)}`,{})}async createFolder(e){return w.post(`projects/${this.projectId}/files/create-folder`,{path:e})}}const rt={class:"files-navigator"},lt={class:"header-container",style:{"margin-bottom":"8px"}},ot=["onClick"],st={class:"list-header"},it=["onClick"],ct={class:"file-name"},ut={key:2,class:"file-size"},dt=oe({__name:"FilesNavigator",props:{filesModel:{}},setup(r){const e=r,t=S(!1),s=S(""),l=S(new Set),m=S(!1),U=n=>{if(!y.searchTerm.trim())return x("span",n);const a=ee(y.searchTerm,n);return a?x("span",n.split("").map((o,h)=>a.includes(h)?x("span",{class:"char-match"},o):o)):x("span",n)},d=L({currentIndex:1,pageSize:20,totalCount:0}),f=L({currentPath:"",breadcrumbs:[]}),y=L({searchTerm:"",isSearching:!1}),{loading:D,result:C,refetch:_}=He(async()=>{const n=await e.filesModel.list(d.pageSize,(d.currentIndex-1)*d.pageSize,y.searchTerm||void 0,f.currentPath||void 0);return d.totalCount=n.totalCount,n});E([()=>d.currentIndex,()=>d.pageSize],()=>{_()}),E(()=>y.searchTerm,()=>{console.log("Search term changed:",y.searchTerm),d.currentIndex=1,_()}),E(()=>f.currentPath,()=>{_()});const H=$(()=>C.value?C.value.items:[]);async function ie(n,a){const o=n.join("/");await e.filesModel.upload(o,a),await _()}async function q(n){n.forEach(async a=>{const o=await e.filesModel.download(a),h=URL.createObjectURL(o),b=document.createElement("a");b.href=h,b.download=a.split("/").pop()||"download",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(h)})}function M(n){f.currentPath=n,f.breadcrumbs=n?n.split("/").filter(a=>a.length>0):[],d.currentIndex=1,_()}async function ce(n){for(const a of n)await e.filesModel.delete(a.path);l.value.clear(),await _()}const ue=n=>n.type==="directory"?"":n.type==="file"?n.sizeHuman:"",v=$(()=>H.value?y.searchTerm.trim()?H.value.filter(n=>ee(y.searchTerm,n.name)):H.value:[]),de=$(()=>v.value?v.value.filter(n=>l.value.has(n.path)):[]);function fe(n){n.type==="directory"?(l.value.clear(),m.value=!1,M(n.path)):q([n.path])}const J=S(!1);function pe(n){if(n&&n.type==="file")return;const a=document.createElement("input");a.type="file",a.onchange=async()=>{var b,W,X;const o=(b=a.files)==null?void 0:b[0],h=await(o==null?void 0:o.arrayBuffer());if(!!o)try{J.value=!0;const Y=(W=n==null?void 0:n.path.split("/").filter(V=>V.length>0))!=null?W:f.currentPath?f.currentPath.split("/").filter(V=>V.length>0):[];await ie([...Y,(X=o.name)!=null?X:"Untitled file"],h?new Uint8Array(h):void 0),await _()}catch{De("Failed to upload file","File already exists")}finally{J.value=!1}},a.click()}const me=$(()=>`Search files in ${f.currentPath?`/${f.currentPath}`:"/"}`);function he(n){const a=n.path;l.value.has(a)?l.value.delete(a):l.value.add(a),ge()}function ve(){var n;m.value?l.value.clear():(n=v.value)==null||n.forEach(a=>{l.value.add(a.path)}),m.value=!m.value}function ge(){var o;const n=((o=v.value)==null?void 0:o.length)||0,a=l.value.size;m.value=n>0&&a===n}function ye(){s.value="",t.value=!0}async function Q(){if(s.value.trim()){const n=f.currentPath,a=s.value,o=n?`${n}/${a}`:a;await e.filesModel.createFolder(o),await _(),t.value=!1,s.value=""}}return(n,a)=>(p(),A("div",rt,[O("div",lt,[c(i(I),{justify:"space-between",align:"center",gap:"small"},{default:u(()=>[c(i(Be),null,{default:u(()=>[c(i(te),null,{default:u(()=>[O("a",{onClick:a[0]||(a[0]=o=>M(""))},[c(i(tt))])]),_:1}),(p(!0),A(Oe,null,we(f.breadcrumbs,(o,h)=>(p(),g(i(te),{key:h},{default:u(()=>[O("a",{onClick:b=>M(f.breadcrumbs.slice(0,h+1).join("/"))},z(o),9,ot)]),_:2},1024))),128))]),_:1}),c(i(I),{gap:"small"},{default:u(()=>[i(D)?j("",!0):(p(),g(i(Z),{key:0},{default:u(()=>[c(F,{size:"small",onClick:a[1]||(a[1]=()=>pe())},{default:u(()=>[c(i(nt)),P(" Upload File ")]),_:1}),c(F,{size:"small",onClick:a[2]||(a[2]=()=>ye())},{default:u(()=>[c(i(Ke)),P(" New Folder ")]),_:1})]),_:1})),l.value.size>0?(p(),g(i(Z),{key:1},{default:u(()=>[c(F,{size:"small",onClick:a[3]||(a[3]=()=>q(Array.from(l.value)))},{default:u(()=>[c(i(Ee),{size:"18"}),P(" Download ("+z(l.value.size)+") ",1)]),_:1}),c(F,{size:"small",danger:"",onClick:a[4]||(a[4]=()=>ce(de.value))},{default:u(()=>[c(i(Ye)),P(" Delete ("+z(l.value.size)+") ",1)]),_:1})]),_:1})):j("",!0)]),_:1})]),_:1})]),c(Le,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:u(()=>[O("div",st,[c(i(I),{justify:"space-between",align:"center",gap:"small",style:{"margin-bottom":"8px"}},{default:u(()=>[c(i(Pe),{value:y.searchTerm,"onUpdate:value":a[5]||(a[5]=o=>y.searchTerm=o),loading:i(D),placeholder:me.value,style:{"max-width":"300px"},size:"small"},null,8,["value","loading","placeholder"]),v.value&&v.value.length>0?(p(),g(i(K),{key:0,checked:m.value,indeterminate:l.value.size>0&&l.value.size<v.value.length,class:"select-all-checkbox",onChange:ve},null,8,["checked","indeterminate"])):j("",!0)]),_:1})]),v.value&&v.value.length>0?(p(),g(i(Ue),{key:0,class:"files-list","data-source":v.value},{renderItem:u(({item:o})=>[c(i(ke),{class:"compact-list-item"},{default:u(()=>[c(i(I),{align:"center",justify:"space-between",style:{width:"100%"}},{default:u(()=>[O("div",{style:{display:"flex","align-items":"center",gap:"8px",flex:"1",cursor:"pointer","min-width":"0"},onClick:h=>fe(o)},[o.type==="directory"?(p(),g(i(Te),{key:0,size:"18px"})):(p(),g(i(Ve),{key:1,size:"18px"})),O("span",ct,[(p(),g(Ce(U(o.name))))]),o.type==="file"?(p(),A("span",ut,z(ue(o)),1)):j("",!0)],8,it),c(i(K),{checked:l.value.has(o.path),onChange:()=>he(o),onClick:a[6]||(a[6]=Se(()=>{},["stop"]))},null,8,["checked","onChange"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])):(p(),g(i(je),{key:1,description:i(D)?"Loading...":"No files"},null,8,["description"]))]),_:1}),i(C)&&i(C).totalCount>d.pageSize?(p(),g(i($e),{key:0,current:d.currentIndex,"onUpdate:current":a[7]||(a[7]=o=>d.currentIndex=o),"page-size":d.pageSize,"onUpdate:pageSize":a[8]||(a[8]=o=>d.pageSize=o),total:i(C).totalCount,"show-total":o=>`${o} items`,"show-size-changer":"","page-size-options":["10","20","50","100"],style:{"margin-top":"20px","text-align":"center"}},null,8,["current","page-size","total","show-total"])):j("",!0),c(i(Ie),{open:t.value,"onUpdate:open":a[10]||(a[10]=o=>t.value=o),title:"Create Folder",onOk:Q,onCancel:a[11]||(a[11]=o=>t.value=!1)},{default:u(()=>[c(i(ze),{value:s.value,"onUpdate:value":a[9]||(a[9]=o=>s.value=o),placeholder:"Enter folder name",onPressEnter:Q},null,8,["value"])]),_:1},8,["open"])]))}});const ft=se(dt,[["__scopeId","data-v-2be8fa34"]]),pt={class:"files-container"},mt=oe({__name:"Files",setup(r){const t=xe().params.projectId,s=G.fromProjectId(t);return(l,m)=>(p(),A("div",pt,[c(i(Fe),null,{default:u(()=>[P("Files")]),_:1}),c(i(Ae),null,{default:u(()=>[P(" Manage files located in your project's persistent directory "),c(be,{path:"tools/files"})]),_:1}),c(i(Re),{class:"files-card"},{default:u(()=>[c(ft,{"files-model":i(s)},null,8,["files-model"])]),_:1})]))}});const It=se(mt,[["__scopeId","data-v-d42eb84d"]]);export{It as default};
//# sourceMappingURL=Files.500ea489.js.map

var Ns=Object.defineProperty;var Cs=(e,t,s)=>t in e?Ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var le=(e,t,s)=>(Cs(e,typeof t!="symbol"?t+"":t,s),s);import{r as xs}from"./index.314cf40a.js";import{R as Ms,T as Ws,B as Bs,a as $t}from"./BackButton.e9f71cf5.js";import{p as Gs,h as Zt,r as Ye,v as et,x as Fs,j as Jt,y as Hs}from"./icons.907f45d7.js";import{d as Z,b,c as O,e as $,q as J,p as q,r as F,G,Q as ve,V as Ce,a8 as pt,v as w,H,y as g,F as ke,J as Te,z as $e,B as V,u as ht,U as ft,a as Ie,$ as Us,E as ce,t as ge,X as vt,o as Qt,af as zs,D as Ks,N as gt,O as mt,W as qt,ag as js,ah as Vs,w as we,R as Be,ai as Zs,K as Js,L as Qs}from"./registerWidgets.fff064a1.js";import{i as qs,w as be,l as rt,v as Xs,r as Xt,a as Yt,s as Pe,p as Ys,b as X,c as _,d as Re,e as eo,f as L,D as to,g as Nt,C as so,h as Ct,j as oo,k as xt,m as tt,n as Mt}from"./DashPlayer.56553644.js";import{a as Wt,L as ao}from"./CircularLoading.59d7fd3d.js";import{i as U,g as B,a as Ge,b as he,f as _e,w as re,c as yt,e as ro,h as no,s as io,j as lo,k as co}from"./runnerData.81f4c073.js";import{u as ze}from"./WidgetsFrame.cebd6d3d.js";import{D as uo}from"./dashes.f5f65b41.js";import{W as po}from"./workspaces.32af92db.js";import{S as ho}from"./SaveButton.90897407.js";import"./forms.7bc6baea.js";import"./utils.3371dfe5.js";import"./hooks.039c0cd9.js";import"./jobs.af366134.js";import"./Modal.2ceba592.js";const fo={class:"dash-settings"},vo=Z({__name:"DashSettings",props:{dash:null},setup(e){return(t,s)=>(b(),O("div",fo,[$(Ms,{runtime:e.dash},null,8,["runtime"])]))}});const go=J(vo,[["__scopeId","data-v-03c0dedb"]]);class wt{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const mo=e=>wt.isMac&&e.ctrlKey,De=e=>wt.isMac?e.metaKey:e.ctrlKey,nt=e=>e.altKey,pe=e=>e.shiftKey,st={alt:nt,"arrow-up":e=>e.code==="ArrowUp","arrow-down":e=>e.code==="ArrowDown","arrow-left":e=>e.code==="ArrowLeft","arrow-right":e=>e.code==="ArrowRight",ctrl:De,delete:e=>wt.isMac?e.code==="Backspace":e.code==="Delete",enter:e=>e.code==="Enter",escape:e=>e.code==="Escape",shift:pe,space:e=>e.code==="Space",a:e=>e.code==="KeyA",b:e=>e.code==="KeyB",c:e=>e.code==="KeyC",d:e=>e.code==="KeyD",f:e=>e.code==="KeyF",g:e=>e.code==="KeyG",h:e=>e.code==="KeyH",k:e=>e.code==="KeyK",p:e=>e.code==="KeyP",v:e=>e.code==="KeyV",x:e=>e.code==="KeyX",z:e=>e.code==="KeyZ",0:e=>e.code==="Digit0","[":e=>e.code==="BracketLeft","]":e=>e.code==="BracketRight"};class yo{constructor(t){le(this,"pressedKeys");le(this,"evt");this.evt=t,this.pressedKeys={};const s=o=>a=>{Object.keys(st).forEach(n=>{st[n](a)&&this.setPressed(n,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(t,s){this.pressedKeys[t]=s}isPressed(t){var s;return this.evt?st[t](this.evt):(s=this.pressedKeys[t])!=null?s:!1}}const wo=new yo;/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var _o=globalThis&&globalThis.__extends||function(){var e=function(t,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var n in a)a.hasOwnProperty(n)&&(o[n]=a[n])},e(t,s)};return function(t,s){e(t,s);function o(){this.constructor=t}t.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}(),So=Object.prototype.hasOwnProperty;function it(e,t){return So.call(e,t)}function lt(e){if(Array.isArray(e)){for(var t=new Array(e.length),s=0;s<t.length;s++)t[s]=""+s;return t}if(Object.keys)return Object.keys(e);var o=[];for(var a in e)it(e,a)&&o.push(a);return o}function z(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ct(e){for(var t=0,s=e.length,o;t<s;){if(o=e.charCodeAt(t),o>=48&&o<=57){t++;continue}return!1}return!0}function fe(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function es(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ut(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,s=e.length;t<s;t++)if(ut(e[t]))return!0}else if(typeof e=="object"){for(var o=lt(e),a=o.length,n=0;n<a;n++)if(ut(e[o[n]]))return!0}}return!1}function Bt(e,t){var s=[e];for(var o in t){var a=typeof t[o]=="object"?JSON.stringify(t[o],null,2):t[o];typeof a<"u"&&s.push(o+": "+a)}return s.join(`
`)}var ts=function(e){_o(t,e);function t(s,o,a,n,i){var c=this.constructor,u=e.call(this,Bt(s,{name:o,index:a,operation:n,tree:i}))||this;return u.name=o,u.index=a,u.operation=n,u.tree=i,Object.setPrototypeOf(u,c.prototype),u.message=Bt(s,{name:o,index:a,operation:n,tree:i}),u}return t}(Error),C=ts,Eo=z,Se={add:function(e,t,s){return e[t]=this.value,{newDocument:s}},remove:function(e,t,s){var o=e[t];return delete e[t],{newDocument:s,removed:o}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:function(e,t,s){var o=Fe(s,this.path);o&&(o=z(o));var a=me(s,{op:"remove",path:this.from}).removed;return me(s,{op:"add",path:this.path,value:a}),{newDocument:s,removed:o}},copy:function(e,t,s){var o=Fe(s,this.from);return me(s,{op:"add",path:this.path,value:z(o)}),{newDocument:s}},test:function(e,t,s){return{newDocument:s,test:Ne(e[t],this.value)}},_get:function(e,t,s){return this.value=e[t],{newDocument:s}}},bo={add:function(e,t,s){return ct(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:s,index:t}},remove:function(e,t,s){var o=e.splice(t,1);return{newDocument:s,removed:o[0]}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:Se.move,copy:Se.copy,test:Se.test,_get:Se._get};function Fe(e,t){if(t=="")return e;var s={op:"_get",path:t};return me(e,s),s.value}function me(e,t,s,o,a,n){if(s===void 0&&(s=!1),o===void 0&&(o=!0),a===void 0&&(a=!0),n===void 0&&(n=0),s&&(typeof s=="function"?s(t,0,e,t.path):He(t,0)),t.path===""){var i={newDocument:e};if(t.op==="add")return i.newDocument=t.value,i;if(t.op==="replace")return i.newDocument=t.value,i.removed=e,i;if(t.op==="move"||t.op==="copy")return i.newDocument=Fe(e,t.from),t.op==="move"&&(i.removed=e),i;if(t.op==="test"){if(i.test=Ne(e,t.value),i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument=e,i}else{if(t.op==="remove")return i.removed=e,i.newDocument=null,i;if(t.op==="_get")return t.value=e,i;if(s)throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e);return i}}else{o||(e=z(e));var c=t.path||"",u=c.split("/"),l=e,v=1,f=u.length,d=void 0,h=void 0,S=void 0;for(typeof s=="function"?S=s:S=He;;){if(h=u[v],h&&h.indexOf("~")!=-1&&(h=es(h)),a&&(h=="__proto__"||h=="prototype"&&v>0&&u[v-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(s&&d===void 0&&(l[h]===void 0?d=u.slice(0,v).join("/"):v==f-1&&(d=t.path),d!==void 0&&S(t,0,e,d)),v++,Array.isArray(l)){if(h==="-")h=l.length;else{if(s&&!ct(h))throw new C("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);ct(h)&&(h=~~h)}if(v>=f){if(s&&t.op==="add"&&h>l.length)throw new C("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);var i=bo[t.op].call(t,l,h,e);if(i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}}else if(v>=f){var i=Se[t.op].call(t,l,h,e);if(i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}if(l=l[h],s&&v<f&&(!l||typeof l!="object"))throw new C("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function M(e,t,s,o,a){if(o===void 0&&(o=!0),a===void 0&&(a=!0),s&&!Array.isArray(t))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=z(e));for(var n=new Array(t.length),i=0,c=t.length;i<c;i++)n[i]=me(e,t[i],s,!0,a,i),e=n[i].newDocument;return n.newDocument=e,n}function Po(e,t,s){var o=me(e,t);if(o.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument}function He(e,t,s,o){if(typeof e!="object"||e===null||Array.isArray(e))throw new C("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,s);if(Se[e.op]){if(typeof e.path!="string")throw new C("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,s);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new C('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,s);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new C("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ut(e.value))throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,s);if(s){if(e.op=="add"){var a=e.path.split("/").length,n=o.split("/").length;if(a!==n+1&&a!==n)throw new C("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,s)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==o)throw new C("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,s)}else if(e.op==="move"||e.op==="copy"){var i={op:"_get",path:e.from,value:void 0},c=ss([i],s);if(c&&c.name==="OPERATION_PATH_UNRESOLVABLE")throw new C("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,s)}}}else throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,s)}function ss(e,t,s){try{if(!Array.isArray(e))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)M(z(t),z(e),s||!0);else{s=s||He;for(var o=0;o<e.length;o++)s(e[o],o,t,void 0)}}catch(a){if(a instanceof C)return a;throw a}}function Ne(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var s=Array.isArray(e),o=Array.isArray(t),a,n,i;if(s&&o){if(n=e.length,n!=t.length)return!1;for(a=n;a--!==0;)if(!Ne(e[a],t[a]))return!1;return!0}if(s!=o)return!1;var c=Object.keys(e);if(n=c.length,n!==Object.keys(t).length)return!1;for(a=n;a--!==0;)if(!t.hasOwnProperty(c[a]))return!1;for(a=n;a--!==0;)if(i=c[a],!Ne(e[i],t[i]))return!1;return!0}return e!==e&&t!==t}const Io=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:C,deepClone:Eo,getValueByPointer:Fe,applyOperation:me,applyPatch:M,applyReducer:Po,validator:He,validate:ss,_areEquals:Ne},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var _t=new WeakMap,Oo=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Ao=function(){function e(t,s){this.callback=t,this.observer=s}return e}();function Lo(e){return _t.get(e)}function Ro(e,t){return e.observers.get(t)}function Do(e,t){e.observers.delete(t.callback)}function ko(e,t){t.unobserve()}function To(e,t){var s=[],o,a=Lo(e);if(!a)a=new Oo(e),_t.set(e,a);else{var n=Ro(a,t);o=n&&n.observer}if(o)return o;if(o={},a.value=z(e),t){o.callback=t,o.next=null;var i=function(){dt(o)},c=function(){clearTimeout(o.next),o.next=setTimeout(i)};typeof window<"u"&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return o.patches=s,o.object=e,o.unobserve=function(){dt(o),clearTimeout(o.next),Do(a,o),typeof window<"u"&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new Ao(t,o)),o}function dt(e,t){t===void 0&&(t=!1);var s=_t.get(e.object);St(s.value,e.object,e.patches,"",t),e.patches.length&&M(s.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function St(e,t,s,o,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var n=lt(t),i=lt(e),c=!1,u=i.length-1;u>=0;u--){var l=i[u],v=e[l];if(it(t,l)&&!(t[l]===void 0&&v!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof v=="object"&&v!=null&&typeof f=="object"&&f!=null&&Array.isArray(v)===Array.isArray(f)?St(v,f,s,o+"/"+fe(l),a):v!==f&&(a&&s.push({op:"test",path:o+"/"+fe(l),value:z(v)}),s.push({op:"replace",path:o+"/"+fe(l),value:z(f)}))}else Array.isArray(e)===Array.isArray(t)?(a&&s.push({op:"test",path:o+"/"+fe(l),value:z(v)}),s.push({op:"remove",path:o+"/"+fe(l)}),c=!0):(a&&s.push({op:"test",path:o,value:e}),s.push({op:"replace",path:o,value:t}))}if(!(!c&&n.length==i.length))for(var u=0;u<n.length;u++){var l=n[u];!it(e,l)&&t[l]!==void 0&&s.push({op:"add",path:o+"/"+fe(l),value:z(t[l])})}}}function $o(e,t,s){s===void 0&&(s=!1);var o=[];return St(e,t,o,"",s),o}const No=Object.freeze(Object.defineProperty({__proto__:null,unobserve:ko,observe:To,generate:dt,compare:$o},Symbol.toStringTag,{value:"Module"}));Object.assign({},Io,No,{JsonPatchError:ts,deepClone:z,escapePathComponent:fe,unescapePathComponent:es});function Et(e,t,s){const{selectedWidgets:o,grid:a}=e,n=[...o,...s||[]],i=Math.min(...n.map(f=>{var d,h;return(h=(d=he(f,t))==null?void 0:d.colStart)!=null?h:null}).filter(f=>f!==null)),c=Math.max(...n.map(f=>{var d,h;return(h=(d=he(f,t))==null?void 0:d.colEnd)!=null?h:null}).filter(f=>f!==null)),u=Math.min(...n.map(f=>{var d,h;return(h=(d=he(f,t))==null?void 0:d.rowStart)!=null?h:null}).filter(f=>f!==null)),l=c>a.columns-1?a.columns-1-c:i<0?-i:0,v=u<0?-u:0;return n.flatMap(f=>{const d=he(f,t);if(l===0&&v===0)return[];if(!d||!U(d))return[];const h=ee(Y(f,B(t)),t);return[{op:"replace",path:`${h}/${f}/colStart`,backup:d,value:d.colStart+l},{op:"replace",path:`${h}/${f}/colEnd`,backup:d,value:d.colEnd+l},{op:"replace",path:`${h}/${f}/rowStart`,backup:d,value:d.rowStart+v},{op:"replace",path:`${h}/${f}/rowEnd`,backup:d,value:d.rowEnd+v}]})}const Y=(e,t,s=null)=>{for(const o in t){const a=t[o];if(U(a)){if(o==e)return s}else{const n=Y(e,a.slot,o);if(n)return n}}return null},Co=(e,t)=>e.rowStart>=t.row&&e.rowStart<t.row+t.height,os=(e,t)=>{var s;return(s=Object.keys(t.slottables).find(o=>Co(e,t.slottables[o].position)))!=null?s:null},Gt=(e,t)=>{const s=B(t),o=(n,i,c)=>{for(const u in i){if(u==n)return c;const l=i[u];if(U(l))continue;const v=o(n,l.slot,`${c}/${u}/slot`);if(v)return v}return null},a=o(e,s,Ge(t));if(!a)throw new Error("Widget not found in layout");return a},ee=(e,t)=>e?`${Ge(t)}/${e}/slot`:Ge(t),Ue=(e,t,s)=>{if(s){const a=t.slottables[s];return{...e,rowStart:e.rowStart-a.position.row,rowEnd:e.rowEnd-a.position.row}}const o=Object.values(t.slottables).reduce((a,n)=>a+(n.position.row<e.rowStart?n.position.height:0),0);return{...e,rowStart:e.rowStart-o,rowEnd:e.rowEnd-o}};function xo(e){const{grid:t,mouseState:s,workingLayout:o,calculatedPositions:a}=e;if(s.state!=="MOVING_SLOTTABLE")return[];const n=t.cellAt(s.mousePos.x,s.mousePos.y),i=[],c=s.slottableId,u=o.getSlottable(c);if(!u)throw new Error("Slottable not found");const l=ns(rs(n,u.height),a,c);return i.push({op:"replace",path:`/slot/${c}/row`,backup:u.row,value:l.row}),i.push({op:"replace",path:`/slot/${c}/order`,backup:u.order,value:l.order}),i}function Mo(e,t){const{grid:s,mouseState:o,selectedWidgets:a,calculatedPositions:n,workingLayout:i}=e;if(o.state!=="MOVING")return[];const c=s.cellAt(o.initialMousePos.x,o.initialMousePos.y),u=s.cellAt(o.mousePos.x,o.mousePos.y),l={deltaI:u.i-c.i,deltaJ:u.j-c.j},v=[];for(const f of a){const d=n.widgets[f],h={colStart:d.position.colStart+l.deltaI,colEnd:d.position.colEnd+l.deltaI,rowStart:d.position.rowStart+l.deltaJ,rowEnd:d.position.rowEnd+l.deltaJ},S=ee(Y(f,B(i.layout)),i.layout),P=os(h,n),T=ee(P,i.layout),A=_e(f,B(t));!A||!U(A)||(S===T?v.push({op:"replace",path:`${S}/${f}`,backup:A,value:{...A,...Ue(h,n,P)}}):(v.push({op:"remove",path:`${S}/${f}`,backup:A}),v.push({op:"add",path:`${T}/${f}`,value:{...A,...Ue(h,n,P)}})))}return v}function Wo(e,t,s,o){const a=[];for(const n of e.selectedWidgets){const i=ee(Y(n,B(o)),o),c=he(n,o);!U(c)||(a.push({op:"replace",path:`${i}/${n}/colStart`,backup:c,value:c.colStart+t}),a.push({op:"replace",path:`${i}/${n}/colEnd`,backup:c,value:c.colEnd+t}),a.push({op:"replace",path:`${i}/${n}/rowStart`,backup:c,value:c.rowStart+s}),a.push({op:"replace",path:`${i}/${n}/rowEnd`,backup:c,value:c.rowEnd+s}))}return a}function as(e,t,s,o){const{camera:a,mouseState:n,grid:i}=e;if(!a)throw new Error("No camera value yet");if(n.state!=="RESIZING"&&n.state!=="SLOTTABLE_RESIZING")return null;const c=n.side,u=a.screenPoint2world(n.mousePos),l=c==="bottom"||c==="right"?"bottom-right":"top-left",v=i.snap(u,l),f=c.includes("left")?v.x:t.x,d=c.includes("top")?v.y:t.y,h=c.includes("right")?v.x:t.x+t.width,S=c.includes("bottom")?v.y:t.y+t.height,P=Math.abs(h-f),T=Math.abs(S-d);let A={x:Math.min(f,h),y:Math.min(d,S),width:P,height:T,referential:v.referential};return P<s&&(A={...A,width:s}),T<o&&(A={...A,height:o}),A}const Bo=({selectedWidgets:e,grid:t,calculatedPositions:s})=>Xt(Object.entries(s.widgets).filter(([o])=>e.has(o)).map(([o,a])=>be(s.widgets[o].position,t)).filter(o=>o!==null));function Go(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="SLOTTABLE_RESIZING")return[];const a=o.slottables[t.slottableId],n={colStart:0,rowStart:a.position.row,colEnd:s.columns,rowEnd:a.position.row+a.position.height},i=s.rectFromArea(n);if(!i)return[];const c=as(e,i,s.width,s.cellHeight);if(!c)return[];const u=s.areaFromRect(c);return[{op:"replace",path:`/slot/${t.slottableId}/height`,backup:a.position.height,value:u.rowEnd-u.rowStart+1}]}function Fo(e){const{mouseState:t,selectedWidgets:s,grid:o,workingLayout:a,calculatedPositions:n}=e;if(t.state!=="RESIZING")return[];const i=t.side,c=Bo(e);if(!c)return[];const u=Array.from(s).filter(f=>{const d=n.widgets[f];return qs(be(d.position,o),c,i)}),{minWidth:l,minHeight:v}=re[t.type].dashProperties;return u.flatMap(f=>{const d=n.widgets[f],h=be(d.position,o),S=as(e,h,l,v);if(!S)return[];const P=Y(f,B(a.layout)),T=ee(P,a.layout),A=o.areaFromRect(h),ne=Ue(o.areaFromRect(S),n,P);return[{op:"replace",path:`${T}/${f}/colStart`,backup:A.colStart,value:Math.max(ne.colStart,0)},{op:"replace",path:`${T}/${f}/colEnd`,backup:A.colEnd,value:Math.min(ne.colEnd,rt.columns-1)},{op:"replace",path:`${T}/${f}/rowStart`,backup:A.rowStart,value:Math.max(ne.rowStart,0)},{op:"replace",path:`${T}/${f}/rowEnd`,backup:A.rowEnd,value:ne.rowEnd}]})}function Ho(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING")return{operations:[]};const a=Object.values(re[t.type].pythonAPI.params).reduce((h,S)=>(S.isKwarg||!S.dashesInitialValue||(h[S.argName]=S.dashesInitialValue),h),{}),{initialWidth:n,initialHeight:i}=re[t.type].dashProperties,c=s.areaFromRect({x:t.x,y:t.y,width:n,height:i,referential:"world"}),u=os(c,o),l=ee(u,e.workingLayout.layout),v=ze(),f={id:v,type:t.type,props:{...a},...Ue(c,o,u),events:{}};return{operations:[{op:"add",path:`${l}/${v}`,value:f}],widgetId:v}}const rs=({j:e},t)=>({row:e,height:t,order:0}),Uo=(e,t)=>Object.keys(e).reduce((s,o)=>(o===t||(s[o]=e[o]),s),{}),ns=(e,t,s)=>{const o=s?{...t,slottables:Uo(t.slottables,s)}:t,a=Math.max(Object.values(o.slottables).reduce((i,c)=>c.position.row>=e.row?i:c.position.row+c.position.height<=e.row?i-c.position.height:i-(e.row-c.position.row),e.row),0),n=zo(e,o);return{...e,row:a,order:n}},Ft=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).find(o=>e.row>=o.position.row+o.position.height/2&&e.row<=o.position.row+o.position.height),Ht=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).filter(o=>o.position.row+o.position.height/2>e.row&&o.position.row<=e.row+e.height).reduce((o,a)=>!o||a.position.order<o.position.order?a:o,null),zo=(e,t)=>{var v,f;const s=Ft(e,t),o=Ht(e,t),a=s?Ht(s.position,t,s.id):null,n=o?Ft(o.position,t,o.id):null,i=[s,n].reduce((d,h)=>d?h&&d.position.order>h.position.order?h:d:h,null),c=[o,a].reduce((d,h)=>d?h&&d.position.order<h.position.order?h:d:h,null);if(!i&&!c)return 0;const u=(v=i==null?void 0:i.position.order)!=null?v:c.position.order-2,l=(f=c==null?void 0:c.position.order)!=null?f:i.position.order+2;return(u+l)/2};function Ko(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING_SLOTTABLE")return{operations:[]};const a=s.cellAt(t.x,t.y),n=ze(),i={id:n,type:t.type,props:{condition:"True"},slot:{},...ns(rs(a,1),o)};return{operations:[{op:"add",path:`/slot/${n}`,value:i}],widgetId:n}}function jo(e,t){const{mouseState:s,selectedWidgets:o}=e;if(s.state!=="MOVING"||!s.duplicating)return[];const a=[];for(const n of o){const i=ee(Y(n,B(t)),t),c=he(n,t);if(!c)continue;const u=ze();a.push({op:"add",path:`${i}/${u}`,value:{...q.exports.cloneDeep(c),id:u}})}return a}function is(e,t,s){const o=e.selectedWidgets,a=o.keys().next().value,n=Y(a,B(t)),i=n?yt(n,t).slot:B(t),u=Object.keys(i).filter(f=>!o.has(f)&&!(s!=null&&s.some(d=>f==d))&&U(i[f])).sort((f,d)=>Xs(_e(f,B(t)),_e(d,B(t)))),l=[...o,...s||[]].map(f=>_e(f,B(t))).filter(f=>f!=null),v=[];return u.forEach(f=>{const d=_e(f,B(t));if(!d||!U(d))return;let h=0,S={...d};const P=()=>l.some(T=>Yt(S,T));for(;P();)h++,S={...d,rowStart:d.rowStart+h,rowEnd:d.rowEnd+h};if(h){const T=ee(n,t);v.push({op:"replace",path:`${T}/${f}/rowStart`,backup:d.rowStart,value:d.rowStart+h}),v.push({op:"replace",path:`${T}/${f}/rowEnd`,backup:d.rowEnd,value:d.rowEnd+h})}l.push(S)}),v}function Vo(e,t,s,o){const a=e.selectedWidgets;if(!a.size)return[];const n=[...a],i=[];return n.some(u=>{const l=Y(u,B(o)),v=l?yt(l,o).slot:B(o),f=Object.keys(v).filter(h=>!a.has(h)&&U(v[h])),d=he(u,o);return f.some(h=>Yt(d,v[h]))})&&a.forEach(u=>{const l=_e(u,B(o)),v=ee(Y(u,B(o)),o);!l||!U(l)||(i.push({op:"replace",path:`${v}/${u}/rowStart`,backup:l.rowStart,value:l.rowStart-s}),i.push({op:"replace",path:`${v}/${u}/rowEnd`,backup:l.rowEnd,value:l.rowEnd-s}),i.push({op:"replace",path:`${v}/${u}/colStart`,backup:l.colStart,value:l.colStart-t}),i.push({op:"replace",path:`${v}/${u}/colEnd`,backup:l.colEnd,value:l.colEnd-t}))}),i}function Zo(e,t){const s=[],o=[];for(const a of t){const n=ze();s.push({op:"add",path:`/slot/${n}`,value:{...q.exports.cloneDeep(a),id:n}}),o.push(n)}return{operations:s,widgetsId:o}}function Jo(e){const t=z(e.workingLayout.layout),s=jo(e,t);M(t,s);const o=xo(e);M(t,o);const a=Mo(e,t);M(t,a);const n=Fo(e);M(t,n);const i=Go(e);M(t,i);const c=Ho(e);M(t,c.operations);const u=Ko(e);M(t,u.operations);const l=Et(e,t,c.widgetId?[c.widgetId]:[]);M(t,l);const v=is(e,t,c.widgetId?[c.widgetId]:[]);return M(t,v),{layout:t,operations:[...s,...a,...o,...n,...i,...c.operations,...l,...v,...u.operations]}}function Qo(e,t,s){const o=e.workingLayout.layout,a=Wo(e,t,s,o);M(o,a);const n=Vo(e,t,s,o);M(o,n);const i=Et(e,o);return M(o,i),[...a,...n,...i]}function qo(e,t){const s=e.workingLayout.layout,o=Zo(e,t);M(s,o.operations);const a=Et(e,s,o.widgetsId);M(s,a);const n=is(e,s,o.widgetsId);return M(s,n),[...o.operations,...a,...n]}const Xo={class:"zoom-bar"},Yo={class:"zoom-value"},ea=Z({__name:"ZoomBar",props:{camera:null},emits:["hover","leave"],setup(e,{emit:t}){const s=e,o=F(!1),a=F(null),n=()=>{var l;(l=s.camera)==null||l.zoomIn(1.1,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},i=()=>{var l;(l=s.camera)==null||l.zoomIn(.9,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},c=G(()=>{var u,l;return`${Math.floor(((l=(u=s.camera)==null?void 0:u.zoom)!=null?l:1)*100)}%`});return ve(()=>{var u;return(u=s.camera)==null?void 0:u.zoom},()=>{clearTimeout(a.value),o.value=!0,a.value=setTimeout(()=>o.value=!1,3e3)}),(u,l)=>Ce((b(),O("div",{class:"zoom-bar-wrapper",onMouseover:l[0]||(l[0]=v=>t("hover")),onMouseleave:l[1]||(l[1]=v=>t("leave"))},[w("div",Xo,[w("span",{class:"zoom-control",onClick:i},"-"),w("span",Yo,H(g(c)),1),w("span",{class:"zoom-control",onClick:n},"+")])],544)),[[pt,e.camera&&o.value]])}});const ta=J(ea,[["__scopeId","data-v-f937a967"]]),sa=()=>window.location.href.startsWith("vscode-webview://"),oa=(e,t)=>{!sa()||window.vscode.postMessage({type:"usage-event",event:{type:e,payload:t}})},aa=async({operations:e,name:t})=>{oa("widgets_updated",{checkpoint:t,operations:z(e)})};class bt{constructor(t,s){le(this,"checkpointHistory",{undos:[],redos:[]});le(this,"_save",null);this.workingLayout=t,this.appState=s}static create(t,s){return new bt(t,s)}setWorkingLayout(t){this.workingLayout=t}undo(){if(this.appState.isPreview||!this.checkpointHistory.undos.length)return;const t=this.checkpointHistory.undos.pop();if(t)return M(this.workingLayout,t.operations),this.checkpointHistory.redos.push(ot(t)),t}redo(){if(this.appState.isPreview)return;const t=this.checkpointHistory.redos.pop();if(t)return M(this.workingLayout,t.operations),this.checkpointHistory.undos.push(ot(t)),t}execute(t){this.appState.isPreview||(M(this.workingLayout,t.operations),this.checkpointHistory.undos.push(ot(t)),this.checkpointHistory.redos=[],this.save(),aa(t))}onSave(t){this._save=t}save(){var t;this.appState.isPreview||(t=this._save)==null||t.call(this)}}const ot=e=>({selection:e.selection,name:`RE: ${e.name}`,operations:e.operations.slice().reverse().map(t=>ra(t))}),ra=e=>{switch(e.op){case"add":return{op:"remove",backup:e.value,path:e.path};case"remove":return{op:"add",path:e.path,value:e.backup};case"replace":return{op:"replace",backup:e.value,path:e.path,value:e.backup}}};class Pt{constructor(t,s){le(this,"operationQueue");this.layout=t,this.operationQueue=bt.create(t,s)}getRootSlot(){return B(this.layout)}getRootSlotPath(){return Ge(this.layout)}setLayout(t){this.operationQueue.setWorkingLayout(t)}static create(t,s){return new Pt(t,s)}getWidget(t){return he(t,this.layout)}getWidgetOrSlottable(t){const s=ro(t,this.layout);if(!s)throw new Error(`Could not find widget or slottable with id ${t}`);return s}get widgets(){return this.getRootSlot()}get allWidgets(){const t=s=>Object.entries(s).reduce((o,[a,n])=>U(n)?{...o,[a]:n}:{...o,...t(n.slot)},{});return t(this.widgets)}getSlottable(t){return yt(t,this.layout)}redo(){let t=this.operationQueue.redo();for(;t&&t.operations.length===0;)t=this.operationQueue.redo();return this.operationQueue.save(),t}undo(){let t=this.operationQueue.undo();for(;t&&t.operations.length===0;)t=this.operationQueue.undo();return this.operationQueue.save(),t}updateVariable(t,s){const o=this.getWidget(s);if(!U(o))return;const a=ee(Y(s,this.getRootSlot()),this.layout);this.operationQueue.execute({name:"update variable",selection:new Set([s]),operations:[{op:"replace",backup:o.variable,value:t,path:`${a}/${s}/variable`}]})}updateProp({param:t,value:s},o){const a=i=>this.getWidgetOrSlottable(i).props,n=(i,c,u)=>{const l=Gt(i,this.layout);return[{op:"replace",backup:a(i)[c],value:u,path:`${l}/${i}/props/${c}`}]};this.operationQueue.execute({name:"update props",operations:o.flatMap(i=>n(i,t.argName,s)),selection:new Set(o)})}updateEvent({event:t,value:s},o){const a=i=>this.getWidget(i).events,n=(i,c,u)=>{const l=ee(Y(i,this.getRootSlot()),this.layout);return[{op:"replace",backup:a(i)[c],value:u,path:`${l}/${i}/events/${c}`}]};this.operationQueue.execute({name:"update events",operations:o.flatMap(i=>n(i,t.key,s)),selection:new Set(o)})}delete(t){this.operationQueue.execute({name:"widgets deleted",operations:t.map(s=>{const o=Gt(s,this.layout);return{op:"remove",backup:this.getWidgetOrSlottable(s),path:`${o}/${s}`}}),selection:new Set(t)})}onSave(t){this.operationQueue.onSave(t)}updateVersion(){this.layout.version!=="0.2"&&this.operationQueue.execute({name:"Version updated",operations:[{op:"replace",backup:this.layout.version,value:"0.2",path:"/version"},{op:"add",value:this.layout.widgets,path:"/slot"},{op:"remove",path:"/widgets",backup:this.layout.widgets}],selection:new Set})}}const Ut={PandasDataFrame:"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html",PlotlyFigure:"https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html","datetime.time":"https://docs.python.org/3/library/datetime.html#datetime.time","datetime.date":"https://docs.python.org/3/library/datetime.html#datetime.date","io.IOBase":"https://docs.python.org/3/library/io.html#io.IOBase","time.struct_time":"https://docs.python.org/3/library/time.html#time.struct_time"},na="#E286A3",ia="#EF9542",la="#B462DB",ca="#40B6D3",ua="#6FB96E",da=[na,ia,la,ca,ua];function zt(e){let t=e;return Object.keys(Ut).forEach(s=>{if(e.includes(s)){const o=Ut[s];t=t.replace(s,`<a href="${o}" target="_blank">${s}</a>`)}}),t}const Ee={},pa=e=>t=>{if(Ee[t])return Ee[t];const s=Object.keys(Ee).length%e.length;return Ee[t]=e[s],e[s]},Kt=pa([...da]),ha=()=>{Object.keys(Ee).forEach(e=>delete Ee[e])};class fa{constructor(){le(this,"globalEventListeners",[])}addGlobalEventListener(t,s){addEventListener(t,s),this.globalEventListeners.find(o=>o.evt===t)||this.globalEventListeners.push({evt:t,handler:s})}removeGlobalEventListeners(){this.globalEventListeners.forEach(({evt:t,handler:s})=>{removeEventListener(t,s)}),this.globalEventListeners=[]}}const va={class:"param-types"},ga=["innerHTML"],ma={key:1,class:"prop-type"},ya=["innerHTML"],wa=Z({__name:"ParamTypes",props:{param:null},setup(e){return(t,s)=>(b(),O("div",va,[e.param&&e.param.typeDescription?(b(!0),O(ke,{key:0},Te(e.param.typeDescription,o=>(b(),O("div",{key:o,class:"prop-type"},[w("p",{class:"type",style:$e({color:g(Kt)(o)}),innerHTML:g(zt)(o)},null,12,ga)]))),128)):e.param&&e.param.typeName?(b(),O("div",ma,[w("p",{class:"type",style:$e({color:g(Kt)(e.param.typeName)}),innerHTML:g(zt)(e.param.typeName)},null,12,ya)])):V("",!0)]))}});const jt=J(wa,[["__scopeId","data-v-d6aed39d"]]),_a=["value","placeholder"],Sa=["value","placeholder"],Ea=Z({__name:"PythonPropInputRaw",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input","change","clearSuggestions"],setup(e,{emit:t}){const s=e,o=ht({isActive:!1,hasChanges:!1}),a=u=>{t("input",u),o.hasChanges=!0},n=()=>{o.isActive=!1,t("clearSuggestions")},i=u=>{u.preventDefault();const l=u.target,v=l.selectionStart,f=l.selectionEnd,d=l.value;l.value=d.substring(0,v)+"	"+d.substring(f),l.selectionStart=l.selectionEnd=v+1,l.dispatchEvent(new Event("input"))},c=u=>{s.commit(u),o.hasChanges=!1};return ft(()=>{o.hasChanges&&s.commit(s.value)}),(u,l)=>{var f,d;const v=Ie("icon");return b(),O("div",{class:ce(["input-container",{error:e.hasError}])},[$(v,{path:g(Gs),class:"icon",fill:e.hasError?"#D35249":o.isActive?"#3482E5":void 0},null,8,["path","fill"]),e.isCode?(b(),O("textarea",{key:0,value:e.value,class:"prop-input",placeholder:(f=e.placeholder)!=null?f:void 0,onInput:l[0]||(l[0]=h=>a(h.target.value)),onClick:l[1]||(l[1]=h=>o.isActive=!0),onBlur:n,onKeydown:l[2]||(l[2]=Us(h=>i(h),["tab"])),onChange:l[3]||(l[3]=h=>c(h.target.value))},null,40,_a)):(b(),O("input",{key:1,value:e.value,class:"prop-input",placeholder:(d=e.placeholder)!=null?d:void 0,onInput:l[4]||(l[4]=h=>a(h.target.value)),onClick:l[5]||(l[5]=h=>o.isActive=!0),onBlur:n,onChange:l[6]||(l[6]=h=>c(h.target.value))},null,40,Sa))],2)}}});const ba=J(Ea,[["__scopeId","data-v-1159e0c0"]]),Pa={class:"suggestions"},Ia=["onMousedown"],Oa=Z({__name:"PythonAutoCompleteSuggestions",props:{suggestions:null},emits:["select"],setup(e,{emit:t}){return(s,o)=>Ce((b(),O("div",Pa,[(b(!0),O(ke,null,Te(e.suggestions,a=>(b(),O("div",{key:a,class:"suggestion",onMousedown:n=>t("select",a)},H(a),41,Ia))),128))],512)),[[pt,e.suggestions.length]])}});const Aa=J(Oa,[["__scopeId","data-v-afec000d"]]),La={class:"python-wrapper"},Ra=Z({__name:"PythonPropInput",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,dashPlayerState:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input"],setup(e,{emit:t}){const s=e,o=G(()=>s.dashPlayerState.suggestionsFor),a=G(()=>s.dashPlayerState.suggestions),n=l=>{c(s.paramName,l),t("input",l)},i=l=>{u(),t("input",l),s.commit(l)},c=async(l,v)=>{!v||s.dashPlayerState.getAutocompleteSuggestions(l,v)},u=async()=>{await vt(),s.dashPlayerState.clearSuggestions()};return(l,v)=>(b(),O("div",La,[$(ba,{value:e.value,commit:e.commit,"is-code":e.isCode,"param-name":e.paramName,"dash-player-state":e.dashPlayerState,onInput:n,onClearSuggestions:u},null,8,["value","commit","is-code","param-name","dash-player-state"]),g(o)===e.paramName?(b(),ge(Aa,{key:0,suggestions:g(a),onSelect:i},null,8,["suggestions"])):V("",!0)]))}});const at=J(Ra,[["__scopeId","data-v-5e99cdec"]]),te=e=>(gt("data-v-772fa7a8"),e=e(),mt(),e),Da={class:"wrapper"},ka={class:"title"},Ta={key:0,class:"widget-prop"},$a=te(()=>w("h2",null,"Error",-1)),Na=te(()=>w("p",{class:"section-description"}," Some errors were found while computing the widget. ",-1)),Ca=["textContent"],xa={key:1,class:"section"},Ma=te(()=>w("h2",null,"VARIABLE",-1)),Wa={key:0,class:"section-content"},Ba={class:"widget-prop"},Ga=te(()=>w("p",{class:"prop-label"},"Bind a variable",-1)),Fa=te(()=>w("p",{class:"prop-description"}," Create a variable to be controlled by this widget. ",-1)),Ha={class:"input-container"},Ua={key:0,class:"variable-error prop-error"},za=te(()=>w("pre",null,"Variable not defined",-1)),Ka={key:1,class:"prop-error",textContent:"SyntaxError: This field must be a variable name"},ja=["textContent"],Va={key:2,class:"section"},Za=te(()=>w("h2",null,"EVENTS",-1)),Ja={key:0,class:"section-content"},Qa=te(()=>w("p",{class:"section-description"}," Each event is a Python code that runs on specified situations ",-1)),qa={class:"prop-label"},Xa={class:"prop-description"},Ya={class:"section"},er=te(()=>w("h2",null,"PROPERTIES",-1)),tr={key:0,class:"section-content"},sr=te(()=>w("p",{class:"section-description"}," Each property is a Python expression, make sure to use the correct syntax. ",-1)),or={class:"prop-label"},ar={class:"prop-description"},rr=["textContent"],nr=te(()=>w("div",{class:"feedback"},null,-1)),ir=[nr],lr=Z({__name:"WidgetEditor",props:{selectedWidgetErrors:null,layoutModel:null,selectedWidgets:null,dashPlayerState:null},emits:["close","create-variable"],setup(e,{emit:t}){const s=e,o=F(null);ve(()=>s.selectedWidgetErrors,()=>{o.value=null});const a=E=>{P.openedSections.includes(E)?P.openedSections=P.openedSections.filter(I=>I!==E):P.openedSections.push(E)},n=E=>P.openedSections.includes(E),i=E=>U(E)?re[E.type].name:Pe[E.type].name,c=G(()=>o.value===null?s.selectedWidgetErrors:o.value==="variable"?q.exports.omit(s.selectedWidgetErrors,"variable"):{...s.selectedWidgetErrors,props:q.exports.omit(s.selectedWidgetErrors.props,o.value)}),u=G(()=>l.value.type.includes("-input")&&l.value.type!=="click-input"),l=G(()=>s.selectedWidgets[0]),v=G(()=>{var R;if(!U(l.value))return;const I=((R=re[l.value.type].pythonAPI.params)!=null?R:[]).find(N=>N.argName==="initial_value");return I||null});function f(E){this.style.height="0",this.style.height=this.scrollHeight-24+"px"}const d=new fa,h=F(null),S=402,P=ht({isActive:!1,resizing:!1,width:S,openedSections:["properties","variable"]});Qt(()=>{h.value&&(d.addGlobalEventListener("mouseup",()=>P.resizing=!1),d.addGlobalEventListener("mousemove",R=>T(R))),document.querySelectorAll(".widget-props-editor textarea").forEach(R=>{!R||(R.setAttribute("style","height:"+(R.scrollHeight-24)+"px;overflow-y:hidden;"),R.addEventListener("input",f,!1))})}),zs(()=>{ha(),d.removeGlobalEventListeners()});const T=E=>{P.resizing&&(P.width=Math.max(P.width-E.movementX,S))},A=G(()=>({width:`${P.width}px`})),ne=E=>Pe[E.type].params,Ke=G(()=>{const E=(N,K)=>N.argName===K.argName&&N.typeName===K.typeName,I=(N,K,D)=>D.findIndex(ue=>E(N,ue))===K,R=N=>!N.formOnly;return s.selectedWidgets.flatMap(N=>{var K;return U(N)?(K=re[N.type])==null?void 0:K.pythonAPI.params:ne(N)}).filter(Boolean).filter(R).filter(I)}),ye=G(()=>{const E=(R,N)=>R.key===N.key,I=(R,N,K)=>K.findIndex(D=>E(R,D))===N;return s.selectedWidgets.flatMap(R=>{var N;return U(R)?(N=re[R.type])==null?void 0:N.events:[]}).filter(Boolean).filter(I).filter(R=>R.key!=="change")}),je=E=>{s.layoutModel.updateVariable(E,l.value.id),o.value="variable"},xe=E=>I=>{s.layoutModel.updateProp({param:E,value:I},s.selectedWidgets.map(R=>R.id)),o.value=E.argName},Ve=E=>I=>{s.layoutModel.updateEvent({event:E,value:I},s.selectedWidgets.map(R=>R.id))},Ze=()=>{var E,I;return(I=(E=c.value.variable)==null?void 0:E.repr)==null?void 0:I.includes("SyntaxError")},Je=()=>{var E,I;return(I=(E=c.value.variable)==null?void 0:E.repr)==null?void 0:I.includes("NameError")},y=E=>{var I;!E||((I=s.dashPlayerState.broker)==null||I.send({name:E,value:null,type:"variable-created",state:s.dashPlayerState.apiPageState}),t("create-variable",E))},x=()=>{var E,I;return((E=c.value.widget)==null?void 0:E.repr)&&!Object.values((I=c.value.props)!=null?I:{}).some(R=>R.repr)},Q=E=>{var I,R;return(R=(I=c.value.props)==null?void 0:I[E])==null?void 0:R.repr},se=E=>q.exports.upperFirst(E.replace(/_/g," "));return(E,I)=>{var N,K;const R=Ie("icon");return b(),O("div",{class:"widget-props-editor",style:$e(g(A))},[w("div",Da,[w("div",ka,[w("h1",null,H(i(g(l))),1),$(R,{path:g(Zt),fill:"#414A58",class:"close-icon",width:"16",height:"16",onClick:I[0]||(I[0]=D=>t("close"))},null,8,["path"])]),x()?(b(),O("div",Ta,[$a,Na,w("pre",{class:"prop-error",textContent:H(x())},null,8,Ca)])):V("",!0),g(u)?(b(),O("div",xa,[w("div",{class:"section-header",onClick:I[1]||(I[1]=D=>a("variable"))},[$(R,{path:n("variable")?g(Ye):g(et),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Ma]),n("variable")?(b(),O("div",Wa,[w("div",Ba,[Ga,Fa,w("div",Ha,[$(at,{placeholder:"variable_name","param-name":"variable","dash-player-state":e.dashPlayerState,value:(N=g(l).variable)!=null?N:"",commit:je,"is-code":!1,onInput:I[2]||(I[2]=D=>g(l).variable=D)},null,8,["dash-player-state","value"])]),Je()&&g(l).variable?(b(),O("div",Ua,[za,w("button",{onClick:I[3]||(I[3]=D=>y(g(l).variable))}," Create ")])):Ze()?(b(),O("pre",Ka)):(K=g(c).variable)!=null&&K.repr?(b(),O("pre",{key:2,class:"prop-error",textContent:H(g(c).variable.repr)},null,8,ja)):V("",!0),$(jt,{param:g(v)},null,8,["param"])])])):V("",!0)])):V("",!0),g(ye).length?(b(),O("div",Va,[w("div",{class:"section-header",onClick:I[4]||(I[4]=D=>a("events"))},[$(R,{path:n("events")?g(Ye):g(et),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Za]),n("events")?(b(),O("div",Ja,[Qa,(b(!0),O(ke,null,Te(g(ye),D=>(b(),O("div",{key:D.key,class:"widget-prop"},[w("label",qa,"On "+H(D.key),1),w("p",Xa,"Executed after "+H(D.key),1),$(at,{"param-name":D.key,"dash-player-state":e.dashPlayerState,value:g(l).events[D.key],commit:Ve(D),"is-code":!0,onInput:ue=>g(l).events[D.key]=ue},null,8,["param-name","dash-player-state","value","commit","onInput"])]))),128))])):V("",!0)])):V("",!0),w("div",Ya,[w("div",{class:"section-header",onClick:I[5]||(I[5]=D=>a("properties"))},[$(R,{path:n("properties")?g(Ye):g(et),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),er]),n("properties")?(b(),O("div",tr,[sr,(b(!0),O(ke,null,Te(g(Ke),D=>{var ue;return b(),O("div",{key:D.argName,class:"widget-prop"},[w("p",or,H(se(D.argName)),1),w("p",ar,H(D.description),1),$(at,{"has-error":!!Q(D.argName),placeholder:(ue=D.default)!=null?ue:void 0,"param-name":D.argName,"dash-player-state":e.dashPlayerState,value:g(l).props[D.argName],commit:xe(D),"is-code":!0,onInput:de=>g(l).props[D.argName]=de},null,8,["has-error","placeholder","param-name","dash-player-state","value","commit","onInput"]),Q(D.argName)?(b(),O("pre",{key:0,class:"prop-error",textContent:H(Q(D.argName))},null,8,rr)):V("",!0),$(jt,{param:D},null,8,["param"])])}),128))])):V("",!0)])]),w("div",{ref_key:"handlerRef",ref:h,class:"handler",onMousedown:I[6]||(I[6]=Ks(D=>P.resizing=!0,["stop"]))},ir,544)],4)}}});const cr=J(lr,[["__scopeId","data-v-772fa7a8"]]),ls=e=>(gt("data-v-0d595f79"),e=e(),mt(),e),ur={class:"interact-menu"},dr={class:"icon-container"},pr=ls(()=>w("span",{class:"edit"},"Edit [Shift + P]",-1)),hr={class:"icon-container"},fr=ls(()=>w("span",null,"Interact [Shift + P]",-1)),vr=Z({__name:"InteractMenu",props:{isPreview:{type:Boolean}},emits:["changePreview"],setup(e,{emit:t}){return(s,o)=>{const a=Ie("icon");return b(),O("div",ur,[w("div",dr,[$(a,{class:ce(["icon",{active:!e.isPreview}]),path:g(Fs),fill:"#5A677A",onClick:o[0]||(o[0]=n=>t("changePreview",!1))},null,8,["class","path"]),pr]),w("div",hr,[$(a,{class:ce(["icon",{active:e.isPreview}]),path:g(Jt),fill:"#5A677A",onClick:o[1]||(o[1]=n=>t("changePreview",!0))},null,8,["class","path"]),fr])])}}});const gr=J(vr,[["__scopeId","data-v-0d595f79"]]),mr={class:"header"},yr={key:0},wr={key:1},_r=Z({__name:"RuntimeHeader",props:{title:{type:String},path:{type:String,required:!0}},setup(e){return(t,s)=>(b(),O("div",mr,[e.title?(b(),O("p",yr,H(e.title),1)):(b(),O("p",wr,H(e.path),1))]))}});const Sr=J(_r,[["__scopeId","data-v-c8a406b2"]]);function Er(e){var s;const t=(s=document.getSelection())==null?void 0:s.toString();return(e==null?void 0:e.selectionStart)!==void 0||!!t}const br={key:0,class:"widget-metadata-card"},Pr=["src"],Ir={class:"metadata-title"},Or={class:"metadata-description"},Ar={key:1,class:"collapsed-widget-metadata-card"},Lr=["src"],Rr=Z({__name:"WidgetMetadataCard",props:{metadata:null,collapsed:{type:Boolean}},setup(e){const t=window.__baseURL?`${window.__baseURL}/media`:"",s=a=>a in Pe?`${t}/${Pe[a].thumbname}`:`${t}/widget-thumbs/${no(a)}.svg`,o=window.__vscodeTheme===2?"dark":"light";return(a,n)=>e.collapsed?(b(),O("div",Ar,[w("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:$e(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,Lr)])):(b(),O("div",br,[w("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:$e(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,Pr),w("div",Ir,H(e.metadata.name),1),w("div",Or,H(e.metadata.description),1)]))}});const Dr=J(Rr,[["__scopeId","data-v-2b654c57"]]),We={"click-input":-1,"text-output":0,"number-input":1,"text-input":2,"link-output":3,"multiple-choice-input":4,"file-input":5,"email-input":6,"markdown-output":7,"dropdown-input":8,"date-input":9,"cards-input":10,"textarea-input":11,"list-input":12,"file-output":13,"html-output":14,"pandas-output":15,"checkbox-input":16,"cnpj-input":17,"code-input":18,"progress-output":19,"pandas-row-selection-input":20,"image-input":21,"password-input":22,"currency-input":23,"iframe-output":24,"checklist-input":25,"image-output":26,"nps-input":27,"phone-input":28},kr=Z({__name:"WidgetsMetadataList",emits:["dragstart","hover","leave"],setup(e,{emit:t}){const s=F(""),o=F(),a=F(!0),n=()=>{a.value=!1},i=()=>{a.value=!0,u()},c=async()=>{await vt(),o.value&&o.value.focus()},u=()=>{s.value=""},l=Object.values(re).concat(Object.entries(Pe).map(([d,h])=>({type:d,...h}))).reduce((d,h)=>h.formOnly?d:{...d,[h.type]:h},{}),v=G(()=>s.value?Object.values(l).map(d=>({widget:d,score:io(d,s.value.split(" "))})).filter(({score:d})=>d>0).sort(({score:d},{score:h})=>h-d).map(({widget:d})=>d):Object.values(l).sort((d,h)=>{const S=d.type,P=h.type;if(S in We){if(!(P in We))return-1}else return 1;return We[S]-We[P]}));function f(d,h){t("dragstart",d,h)}return(d,h)=>{const S=Ie("icon");return b(),O("div",{class:"widgets-metadata",onMouseover:n,onMouseleave:i},[w("div",js({class:["search",{collapsed:a.value}]},Vs(a.value?{click:c}:{},!0)),[$(S,{path:g(Hs),class:"search-icon"},null,8,["path"]),a.value?V("",!0):Ce((b(),O("input",{key:0,ref_key:"searchInput",ref:o,"onUpdate:modelValue":h[0]||(h[0]=P=>s.value=P),type:"search",class:"widgets-metadata-filter",placeholder:"Find widgets"},null,512)),[[qt,s.value]])],16),w("div",{class:ce(["widgets-metadata-list",{collapsed:a.value}])},[(b(!0),O(ke,null,Te(g(v),P=>(b(),ge(Dr,{key:P.type,metadata:P,draggable:!0,collapsed:a.value,onDragstart:T=>f(T,P.type)},{default:we(()=>[Be(H(P.type),1)]),_:2},1032,["metadata","collapsed","onDragstart"]))),128))],2)],32)}}});const Tr=J(kr,[["__scopeId","data-v-cb0151ea"]]),$r=e=>t=>q.exports.uniq(e.map(Ys(t))).length===1,Nr=e=>e.some(t=>re[t.type].autoHeight);function Cr(e,t){const s=$r(e),o=Nr(e),a=[],n=16,i=6;return s("colStart")&&a.push({rect:{x:t.x-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"left"}),s("colEnd")&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"right"}),s("colStart")&&s("rowStart")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-left"}),s("colEnd")&&s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-right"}),s("colStart")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-left"}),s("colEnd")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-right"}),s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y-i/2,width:n,height:i,referential:"screen"},side:"top"}),s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y+t.height-i/2,width:n,height:i,referential:"screen"},side:"bottom"}),a}const xr=e=>({type:"copyAndPaste",selectedWidgets:e});function Mr(e,t){return e.setData("text/plain",JSON.stringify(xr(t))),!0}function Wr(e,t,s){const o=e.getData("text/plain");try{const a=o&&JSON.parse(o);if(!(a&&"type"in a&&a.type==="copyAndPaste"&&"selectedWidgets"in a&&Array.isArray(a.selectedWidgets)))return!1;const i=qo(t,a.selectedWidgets);return s.operationQueue.execute({name:"paste",operations:i,selection:t.selectedWidgets}),!0}catch{return!1}}const cs=e=>(gt("data-v-2c14d939"),e=e(),mt(),e),Br={class:"runtime-editor"},Gr={class:"title"},Fr=cs(()=>w("br",null,null,-1)),Hr={class:"properties"},Ur={class:"property"},zr=cs(()=>w("p",{class:"property-name"},"Title",-1)),Kr=Z({__name:"RuntimePropertiesEditor",props:{runtime:{type:Object,required:!0}},emits:["close"],setup(e,{emit:t}){return(s,o)=>{const a=Ie("icon");return b(),O("div",Br,[w("div",Gr,[w("h1",null,[Be(H(e.runtime.title),1),Fr,Be(" properties ")]),$(a,{path:g(Zt),fill:"#414A58",class:"close-icon",onClick:o[0]||(o[0]=n=>t("close"))},null,8,["path"])]),w("div",Hr,[w("div",Ur,[zr,Ce(w("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>e.runtime.title=n),type:"text",class:"property-input"},null,512),[[qt,e.runtime.title]])])])])}}});const jr=J(Kr,[["__scopeId","data-v-2c14d939"]]);class Vr{constructor(t){le(this,"event");this.event=t}setData(t,s){var o;(o=this.event.clipboardData)==null||o.setData(t,s)}getData(t){var s,o;return(o=(s=this.event.clipboardData)==null?void 0:s.getData(t))!=null?o:null}getTransferItems(){var t,s;return Object.values((s=(t=this.event.clipboardData)==null?void 0:t.items)!=null?s:[]).map(Jr)}}class Zr{constructor(t){le(this,"item");this.item=t}get type(){return this.item.type}getAsString(){return new Promise(t=>this.item.getAsString(s=>t(s)))}getJSONValue(){return this.getAsString().then(t=>{try{return t?JSON.parse(t):null}catch{return null}})}getAsFile(){return this.item.getAsFile()}}function Jr(e){return new Zr(e)}function Vt(e){return new Vr(e)}const Qr=Z({__name:"DashLayoutEditor",props:{dash:null,params:null,dashPlayerState:null,workspace:null},emits:["navigate","change-preview","create-variable"],setup(e,{emit:t}){const s=e,o=()=>A.updateVersion(),a=F(null),n=F(null),i=r=>t("navigate",r),c=r=>t("create-variable",r),u=r=>t("change-preview",r),l=()=>{var r;return(r=L)==null?void 0:r.correct()},v=r=>{if(!L||s.dashPlayerState.brokerIsClosed)return;const p={x:r.pageX,y:r.pageY,referential:"screen"},m=L.screenPoint2world(p);if(y.value.state==="PANNING"){const k={dx:-r.movementX,dy:-r.movementY},W=L.screenDelta2world({dx:k.dx,dy:k.dy,referential:"screen"});L.translate(W),r.preventDefault(),r.stopPropagation();return}y.value.state==="MOVING"&&(y.value.mousePos=m,y.value.duplicating=nt(r)),y.value.state==="MOVING_SLOTTABLE"&&(y.value.mousePos=m),y.value.state==="JUST_CLICKED"&&Nt(y.value.pos,m)*L.zoom>5&&(_.has(y.value.widgetId)||(pe(r)?_.addToSelectedWidgets(y.value.widgetId):(_.resetSelection(),_.addToSelectedWidgets(y.value.widgetId))),y.value={state:"MOVING",initialMousePos:y.value.pos,mousePos:m,duplicating:nt(r)}),y.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&Nt(y.value.mousePos,m)*L.zoom>5&&(y.value={state:"MOVING_SLOTTABLE",initialMousePos:L.screenPoint2world(y.value.mousePos),mousePos:m,slottableId:y.value.slottableId}),y.value.state==="SELECTING"&&(y.value.mousePos=p),y.value.state==="RESIZING"&&(y.value.mousePos=p),y.value.state==="SLOTTABLE_RESIZING"&&(y.value.mousePos=p),Rt(p)},f=r=>{Er(r==null?void 0:r.target)||Mr(Vt(r),_.selectedWidgets)&&r.preventDefault()},d=r=>{Wr(Vt(r),de(),A)&&r.preventDefault()},h=ht({active:!1,hoverZoomBar:!1}),S=()=>{h.hoverZoomBar=!0},P=()=>{h.hoverZoomBar=!1},T=F(null),A=Pt.create(q.exports.cloneDeep(s.dash.layout),X);ve(s.dash.layout,()=>{A.setLayout(s.dash.layout)});const ne=G(()=>X.isPreview||s.dashPlayerState.brokerIsClosed),Ke=G(()=>Object.keys(s.dash.rootSlot).reduce((r,p)=>{const m=s.dash.rootSlot[p];return m.position&&(r[p]=m),r},{}));let ye=null;const je=q.exports.throttle(()=>{q.exports.isEqual(s.dash.rootSlot,ye)||(ye=q.exports.cloneDeep(s.dash.rootSlot),ds())},500),xe=()=>{A.onSave(async()=>{!s.workspace||(s.dash.layout=A.layout,s.dashPlayerState.updateDashData(s.dash.makeRunnerData(s.workspace)),je())})};xe(),ve(A,xe);const Ve=G(()=>Object.keys(A.widgets).reduce((r,p)=>{var j,oe,ae;const m=(j=s.dashPlayerState.computedErrors.props)==null?void 0:j[p],k=(oe=s.dashPlayerState.computedErrors.variables)==null?void 0:oe[p],W=(ae=s.dashPlayerState.computedErrors.widgets)==null?void 0:ae[p];return!m&&!k&&!W||!Object.keys({...m,...k,...W}).length?r:r?[...r,p]:[p]},[])),Ze=G(()=>{var r,p,m,k,W,j;return{props:(p=s.dashPlayerState.computedErrors.props)==null?void 0:p[(r=_.selectedSlottableId)!=null?r:_.selectedWidgetId],widget:(k=s.dashPlayerState.computedErrors.widgets)==null?void 0:k[(m=_.selectedSlottableId)!=null?m:_.selectedWidgetId],variable:(j=s.dashPlayerState.computedErrors.variables)==null?void 0:j[(W=_.selectedSlottableId)!=null?W:_.selectedWidgetId]}});function Je(r,p){if(!L)return;const m=L.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});_.resetSelection(),p in Pe?y.value={state:"DRAGGING_SLOTTABLE",...m,type:p}:y.value={state:"DRAGGING",...m,type:p}}const y=F({state:"IDLE"});let x={state:"NONE"};const Q=G(()=>(rt.setDashRunnerData(s.dashPlayerState.navbarVisible,s.dashPlayerState.hasSidebar),rt));ve(Q,()=>{var r;return(r=L)==null?void 0:r.updateGrid(Q.value)});const se=F(null),E=F(null),I=F(null),R=F(null);function N(){var k,W;const r=E.value,p=R.value;if(!r)throw new Error(`canvas = ${r}`);if(!p)throw new Error(`editor = ${p}`);L.setProjectedCanvas(r),L.correct(),p.addEventListener("wheel",K),r.addEventListener("mousedown",ue),r.addEventListener("drop",Lt),r.addEventListener("dragover",ps),(k=r.parentElement)==null||k.addEventListener("keydown",bs),(W=r.parentElement)==null||W.addEventListener("keyup",Ps);const m=r.getContext("2d");if(!m)throw new Error(`I can't get no context 2d ${r}`);T.value=so.create(r),Qe(m)}function K(r){if(!L)return;const p={x:r.pageX,y:r.pageY,referential:"screen"};if(De(r)||mo(r))L.zoomIn(Math.exp(-Math.sign(r.deltaY)*.05),p),r.preventDefault();else{const m=pe(r)?{dx:r.deltaY,dy:0}:{dx:r.deltaX,dy:r.deltaY},k=L.screenDelta2world({dx:m.dx,dy:m.dy,referential:"screen"});L.translate(k)}r.stopPropagation()}function D(r){var p;Re.overrideProps(r,{condition:!((p=Re.props)!=null&&p[r].condition)})}function ue(r){var k;if(!L)return;const p={x:r.pageX,y:r.pageY,referential:"screen"};if(r.button==1||r.button==0&&wo.isPressed("space")){y.value={state:"PANNING",initialMousePos:p,mousePos:p};return}const m=L.screenPoint2world(p);x.state==="HOVERING_WIDGET"?y.value={state:"JUST_CLICKED",pos:m,widgetId:x.widgetId}:x.state==="HOVERING_RESIZE_HANDLER"?y.value={state:"RESIZING",side:x.side,initialMousePos:p,mousePos:p,type:(k=_.selectedWidget)==null?void 0:k.type}:x.state==="HOVERING_TOGGLE"?y.value={state:"JUST_CLICKED_TOGGLE",mousePos:p,slottable:x.slottable}:x.state==="HOVERING_SLOTTABLE_RESIZE_HANDLER"?y.value={state:"SLOTTABLE_RESIZING",initialMousePos:p,mousePos:p,slottableId:x.slottableId,side:"bottom"}:x.state==="HOVERING_SLOTTABLE_SELECTOR"?y.value={state:"JUST_CLICKED_SLOTTABLE_SELECTOR",slottableId:x.slottableId,mousePos:p}:(pe(r)||_.resetSelection(),y.value={state:"SELECTING",initialMousePos:p,mousePos:p})}const de=()=>{var r;return{mouseState:y.value,grid:Q.value,camera:L,workingLayout:A,hoverState:x,resizeHandlerRects:Ot(),widgetsInRectangularSelection:qe(),selectedWidgets:new Set(_.selectedWidgetsIds),dash:s.dash,calculatedPositions:Ct(s.dashPlayerState.runnerData.layout.slot,(r=Re.props)!=null?r:{},Q.value),selectedSlottable:_.selectedSlottableId}},us=()=>{var W,j,oe,ae,Oe,Ae,Le,Dt,kt,Tt;const r=L.screenRect2world(L.canvasRect),p=L.screenDelta2world({dx:8,dy:8,referential:"screen"}),m=L.screenRect2world({x:(W=n.value)==null?void 0:W.$el.getBoundingClientRect().x,y:(j=n.value)==null?void 0:j.$el.getBoundingClientRect().y,width:(oe=n.value)==null?void 0:oe.$el.getBoundingClientRect().width,height:(ae=n.value)==null?void 0:ae.$el.getBoundingClientRect().height,referential:"screen"});Xe({origin:{x:Math.min(Q.value.width+p.dx,r.x+r.width-m.width-p.dx),y:Math.max(r.y+p.dy,0),referential:"world"},element:(Oe=n==null?void 0:n.value)==null?void 0:Oe.$el,ignoreZoom:!0});const k=L.screenRect2world({x:(Ae=se.value)==null?void 0:Ae.$el.getBoundingClientRect().x,y:(Le=se.value)==null?void 0:Le.$el.getBoundingClientRect().y,width:(Dt=se.value)==null?void 0:Dt.$el.getBoundingClientRect().width,height:(kt=se.value)==null?void 0:kt.$el.getBoundingClientRect().height,referential:"screen"});Xe({origin:{x:0,y:-k.height-p.dy,referential:"world"},element:(Tt=se==null?void 0:se.value)==null?void 0:Tt.$el,ignoreZoom:!0})},ds=()=>{var r;(r=s.dashPlayerState.broker)==null||r.send({type:"widgets-changed",state:s.dashPlayerState.apiPageState,dashDefinition:{slot:s.dash.rootSlot}})},ie=F(null);function Qe(r){var j,oe,ae,Oe,Ae,Le;if(!L||!s.workspace)return;Xe({origin:{x:0,y:0,referential:"world"},element:(j=a==null?void 0:a.value)==null?void 0:j.$el}),us();const p=r.canvas.getBoundingClientRect();if(r.canvas.width=r.canvas.offsetWidth,r.canvas.height=r.canvas.offsetHeight,r.clearRect(0,0,r.canvas.width,r.canvas.height),r.translate(-p.x,-p.y),r.canvas.style.cursor=(ae=(oe=T.value)==null?void 0:oe.cursor(y.value,x))!=null?ae:"default",!T.value){requestAnimationFrame(()=>Qe(r));return}const m=de(),k=Jo(m);(!q.exports.isEqual(k.operations,(Oe=ie.value)==null?void 0:Oe.operations)||!q.exports.isEqual(k.layout,(Ae=ie.value)==null?void 0:Ae.layout))&&(ie.value=k,s.dashPlayerState.updateRunnerData(s.dash.makeRunnerData(s.workspace,ie.value.layout))),ie.value&&T.value.render({...m,computedState:ie.value,isPreview:X.isPreview,calculatedPositions:Ct(s.dash.makeRunnerData(s.workspace,ie.value.layout).layout.slot,(Le=Re.props)!=null?Le:{},Q.value)}),requestAnimationFrame(()=>Qe(r))}s.dashPlayerState.onWidgetsComputedMessage(r=>{var k;const p=Object.keys(s.dashPlayerState.runnerData.layout.slot),m=Object.keys((k=r.props)!=null?k:{});lo(p,m)}),Qt(()=>{o(),ye=q.exports.cloneDeep(co(Ke.value,re)),Re.setInitialEditProps(s.dash.rootSlot),_.setLayoutModel(A),addEventListener("resize",l),addEventListener("copy",f),addEventListener("paste",d),addEventListener("mousemove",v),vt(()=>{N()})}),ft(()=>{removeEventListener("resize",l),removeEventListener("copy",f),removeEventListener("paste",d),removeEventListener("mousemove",v),eo()});function ps(r){if(!L)return;r.preventDefault();const p=L.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});y.value={...y.value,...p}}const hs=()=>{y.value.state==="IDLE"&&_.resetSelection(),At({referential:"screen",x:0,y:0})},It=()=>{_.selectedSlottableId?A.delete([_.selectedSlottableId]):A.delete(_.selectedWidgetsIds),_.resetSelection()},fs=r=>{if(De(r)&&pe(r)){r.preventDefault(),r.stopPropagation();const p=A.redo();if(p){if(p.operations.some(m=>m.op==="remove")){_.resetSelection();return}_.selectedWidgetsIds=[...new Set(p.selection)]}return}else if(De(r)){r.preventDefault(),r.stopPropagation();const p=A.undo();if(p){if(p.operations.some(m=>m.op==="remove")){_.resetSelection();return}_.selectedWidgetsIds=[...new Set(p.selection)]}return}},Me=(r,p)=>{const[m,k]={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}[p],W=Qo(r,m,k);A.operationQueue.execute({name:`move ${p}`,operations:W,selection:r.selectedWidgets})},vs=()=>{Me(de(),"up")},gs=()=>{Me(de(),"down")},ms=()=>{Me(de(),"left")},ys=()=>{Me(de(),"right")},ws=r=>{De(r)&&(r.preventDefault(),r.stopPropagation(),_.selectAll())};ve(()=>s.dashPlayerState.authenticating,r=>{r&&(X.isPreview=!0)});const _s=r=>{pe(r)&&u(!X.isPreview)},Ss=()=>{y.value.state!=="PANNING"&&(y.value.state="START_PANNING")},Es=r=>({escape:()=>hs(),backspace:()=>It(),delete:()=>It(),z:()=>fs(r),arrowup:()=>vs(),arrowdown:()=>gs(),arrowleft:()=>ms(),arrowright:()=>ys(),a:()=>ws(r),p:()=>_s(r),space:()=>Ss()}),bs=r=>{var p,m;return(m=(p=Es(r))[r.key.toLowerCase().trim()?r.key.toLowerCase():r.code.toLowerCase()])==null?void 0:m.call(p)},Ps=()=>{y.value.state="IDLE"};function Is(){if(y.value.state!=="SELECTING")return null;const{x:r,y:p}=y.value.initialMousePos,{x:m,y:k}=y.value.mousePos;return{x:Math.min(r,m),y:Math.min(p,k),width:Math.abs(r-m),height:Math.abs(p-k),referential:"screen"}}function qe(){if(!L)throw new Error("No camera value yet");const r=Is();return r?new Set(Object.keys(s.dashPlayerState.widgets).filter(p=>oo(L.worldRect2screen(be(s.dashPlayerState.getWidgetPosition(p),Q.value)),r))):new Set}function Os(){return _.selectedWidgetsIds.every(r=>Object.keys(s.dashPlayerState.widgets).includes(r))}const As=()=>Xt(Object.entries(s.dashPlayerState.widgets).filter(([r])=>_.has(r)).map(([r,p])=>be(p.position,Q.value)));function Ot(){if(!L)throw new Error("No camera value yet");const r=As();return!r||!Os()?[]:Cr(_.selectedWidgets,L.worldRect2screen(r))}function At(r){y.value={state:"IDLE"},Rt(r)}const Ls=r=>{y.value=y.value,pe(r)?qe().forEach(p=>{_.toggleWidgetSelection(p)}):(_.resetSelection(),qe().forEach(p=>{_.addToSelectedWidgets(p)}))};function Lt(r){var m;(m=ie.value)!=null&&m.operations.length&&A.operationQueue.execute({name:"mouse up",operations:ie.value.operations,selection:new Set(_.selectedWidgetsIds)}),y.value.state==="SELECTING"&&Ls(r),y.value.state==="JUST_CLICKED"&&(_.isDashSelected=!1,pe(r)?_.toggleWidgetSelection(y.value.widgetId):(_.clearWidgetSelection(),_.selectedSlottableId=null,_.addToSelectedWidgets(y.value.widgetId))),y.value.state==="JUST_CLICKED_TOGGLE"&&D(y.value.slottable),y.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&(_.isDashSelected=!1,_.selectedSlottableId=y.value.slottableId);const p={x:r.pageX,y:r.pageY,referential:"screen"};At(p)}addEventListener("mouseup",Lt);const Rs=r=>{for(const p of Ot())if(xt(r,p.rect)){x={state:"HOVERING_RESIZE_HANDLER",side:p.side};return}},Ds=r=>{var m;const p=(m=Object.keys(s.dashPlayerState.widgets).find(k=>xt(L.screenPoint2world(r),be(s.dashPlayerState.getWidgetPosition(k),Q.value))))!=null?m:null;p?x={state:"HOVERING_WIDGET",widgetId:p}:x={state:"NONE"}},ks=r=>{const p=tt.getToggleUnderCursor(r);p&&(x={state:"HOVERING_TOGGLE",slottable:p.id})},Ts=r=>{const p=tt.getSelectorUnderCursor(r);p&&(x={state:"HOVERING_SLOTTABLE_SELECTOR",slottableId:p.id})},$s=r=>{const p=tt.getResizerUnderCursor(r);p&&(x={state:"HOVERING_SLOTTABLE_RESIZE_HANDLER",slottableId:p.id})};function Rt(r){!L||(Ds(r),Rs(r),ks(r),Ts(r),$s(r))}const Xe=r=>{const{origin:p,element:m,ignoreZoom:k}=r;if(!L||!m||!m.style)return;const W=L.worldPoint2screen(p),j=E.value.getBoundingClientRect(),oe=[`translate(${W.x-j.x}px, ${W.y-j.y}px)`,k?null:`scale(${L.zoom})`].filter(ae=>ae).join(" ");Object.assign(m.style,{transform:oe,transformOrigin:"top left"})};return(r,p)=>(b(),O("div",{class:ce(["dash-layout-editor",{isInactive:e.dashPlayerState.brokerIsClosed}])},[Ce($(Tr,{onDragstart:Je},null,512),[[pt,!g(ne)]]),w("div",{ref_key:"editor",ref:I,class:ce(["editor",{isInactive:e.dashPlayerState.brokerIsClosed}]),onDblclick:p[1]||(p[1]=(...m)=>g(_).selectDash&&g(_).selectDash(...m))},[w("div",{ref_key:"listeners",ref:R,class:"listeners",tabindex:"0"},[$(to,{ref_key:"player",ref:a,class:ce(["player",{preview:g(X).isPreview},{selected:g(_).isDashSelected}]),style:{top:0,left:0,height:"unset"},"is-preview":!0,params:e.params,camera:g(L),"editing-mode":!g(X).isPreview,"force-responsivity":"desktop","widgets-with-errors":g(Ve),"dash-player-state":e.dashPlayerState,onNavigate:i},null,8,["class","params","camera","editing-mode","widgets-with-errors","dash-player-state"]),w("canvas",{ref_key:"canvas",ref:E,class:ce(["layout-canvas",{hide:g(ne)}])},null,2)],512),$(Sr,{ref_key:"runtimeHeader",ref:se,title:e.dashPlayerState.runnerData.title,path:e.dashPlayerState.runnerData.path,onClick:p[0]||(p[0]=m=>g(_).selectDash())},null,8,["title","path"]),$(gr,{ref_key:"interactMenu",ref:n,class:"interact-menu","is-preview":g(X).isPreview,onChangePreview:u},null,8,["is-preview"])],34),(g(_).selectedWidgetsIds.length>0||g(_).selectedSlottableId)&&!g(X).isPreview&&y.value.state==="IDLE"?(b(),ge(cr,{key:0,"selected-widget-errors":g(Ze),"layout-model":g(A),"selected-widgets":g(_).selectedSlottable?[g(_).selectedSlottable]:g(_).selectedWidgets,"dash-player-state":e.dashPlayerState,onClose:p[2]||(p[2]=m=>g(_).clearWidgetSelection()),onCreateVariable:c},null,8,["selected-widget-errors","layout-model","selected-widgets","dash-player-state"])):V("",!0),g(_).isDashSelected&&!g(X).isPreview?(b(),ge(jr,{key:1,runtime:e.dash,"runtime-type":"dash",onClose:p[3]||(p[3]=m=>g(_).isDashSelected=!1)},null,8,["runtime"])):V("",!0),$(ta,{camera:g(L),class:"zoom-bar",onHover:S,onLeave:P},null,8,["camera"])],2))}});const qr=J(Qr,[["__scopeId","data-v-b271b3a1"]]),Xr={class:"dash-editor"},Yr=Z({__name:"DashEditor",setup(e){const t=Js(),s=G(()=>{var S,P,T,A;return(P=(S=d.value)==null?void 0:S.broker)==null||P.observable.observe(),((A=(T=d.value)==null?void 0:T.broker)==null?void 0:A.state)==="RUNNING"}),{result:o}=Wt(()=>po.get()),a=({id:S,type:P})=>{P==="dash"?(t.push({name:"dashEditor",params:{dashId:S},query:i.query}),l()):t.push({name:"editor",params:{formId:S},query:i.query})},n=()=>{var S;!((S=u.value)!=null&&S.path)||t.push(`/_editor/dash/${encodeURIComponent(u.value.path)}/preview`)},i=Qs(),{loading:c,result:u,refetch:l}=Wt(()=>uo.get(i.params.dashPath)),v=S=>{X.isPreview=S},f=S=>{var P;return(P=u.value)==null?void 0:P.addVariableToCode(S)};let d=Zs(null);return ve(u,()=>{var S;if(!(!u.value||!o.value)){if(u.value.path===((S=d.value)==null?void 0:S.runnerData.path)){d.value.updateDashData(u.value.makeRunnerData(o.value));return}console.log(d),d.value=Mt.create(u.value.makeRunnerData(o.value),!0),d.value.onRedirect(({url:P,queryParams:T})=>xs(t,P,T))}}),ft(()=>{var S;!u.value||!o.value||Mt.delete((S=u.value)==null?void 0:S.makeRunnerData(o.value).idOrPath)}),(S,P)=>{const T=Ie("icon");return b(),O("div",Xr,[g(c)||!g(u)||!g(o)?(b(),ge(ao,{key:0,class:"loading",justify:"center"})):(b(),ge(Ws,{key:1},{left:we(()=>[$(Bs,{link:"/_editor/dashes"})]),right:we(()=>[w("button",{class:"preview-button",onClick:n},[$(T,{class:"icon",path:g(Jt),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),Be(" Preview ")]),$(ho,{runtime:g(u)},null,8,["runtime"])]),default:we(()=>[$($t,{title:"Layout editor"},{default:we(()=>[g(d)?(b(),ge(qr,{key:0,workspace:g(o),class:ce({"not-running":!g(s)}),dash:g(u),"dash-player-state":g(d),params:g(i).query,onNavigate:a,onChangePreview:v,onCreateVariable:f},null,8,["workspace","class","dash","dash-player-state","params"])):V("",!0)]),_:1}),$($t,{title:"Settings"},{default:we(()=>[$(go,{dash:g(u)},null,8,["dash"])]),_:1})]),_:1}))])}}});const yn=J(Yr,[["__scopeId","data-v-759399b4"]]);export{yn as default};
//# sourceMappingURL=DashEditor.7273a648.js.map

var ue=Object.defineProperty;var ce=(s,e,t)=>e in s?ue(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var D=(s,e,t)=>(ce(s,typeof e!="symbol"?e+"":e,t),t);import{d as A,v as J,K as W,H as de,b as d,c as p,z as c,W as z,Z as H,x as n,D as x,N as I,e as k,ad as pe,U as Y,O as j,Q as G,q as Q,r as h,a2 as Z,ae as ve,o as X,Y as ee,I as S,G as T,A as fe,F as he,L as me,af as ge,J as _e,a as ye,t as we,ag as be,ah as ke}from"./registerWidgets.c1da2b93.js";import{p as Ce,n as N,o as V,q as O,r as Se}from"./icons.de44105b.js";import{a as K}from"./asyncComputed.519c40eb.js";import{F as Ie}from"./forms.df852ef0.js";import{D as $e}from"./dashes.cf477994.js";import{H as xe}from"./hooks.9a9497c0.js";import{J as q}from"./jobs.593aaa08.js";import{W as Ee}from"./workspaces.988d2c26.js";import{u as U}from"./uuid.50ac8eef.js";import{L as Le}from"./login.605940bb.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="5fcd6223-9df0-4384-acb7-4eaef2ecac8a",s._sentryDebugIdIdentifier="sentry-dbid-5fcd6223-9df0-4384-acb7-4eaef2ecac8a")}catch{}})();const te=s=>(j("data-v-0dfc8705"),s=s(),G(),s),Re={class:"runtime-settings"},Me={key:0,class:"field"},De=te(()=>n("div",{class:"label"},"Path",-1)),Te={class:"field"},Ue=te(()=>n("div",{class:"label"},"Code",-1)),Ae={class:"input-row"},Be={key:1,class:"root-path loading"},Fe={class:"path-feedback"},Pe={key:1,class:"error"},ze=A({__name:"RuntimeCommonSettings",props:{runtime:null},setup(s){const e=s,t=J({pathError:null}),{result:o}=K(()=>Ee.get()),u=()=>{!o.value||!e.runtime.file||o.value.openFile(e.runtime.file)},m=W(()=>{var a;return(a=e.runtime.file)!=null&&a.endsWith(".py")?null:"It should be a .py file"}),l=()=>{!o.value||!_.value||o.value.openFile(".")},i=de(),{result:_}=K(()=>fetch("/_editor/api/workspace/root-path").then(a=>a.text()));return e.runtime.onUpdate(a=>{if(e.runtime instanceof q||!a||!("path"in a)||!(a!=null&&a.path))return;const f=[{runtime:Ie,basePath:"form"},{runtime:xe,basePath:"hook"},{runtime:$e,basePath:"dash"}].find(E=>e.runtime instanceof E.runtime);if(!f)throw new Error(`Unknown runtime type ${e.runtime}`);i.push({path:`/_editor/${f.basePath}/${encodeURIComponent(a.path)}`})}),(a,v)=>(d(),p("div",Re,[s.runtime instanceof c(q)?x("",!0):(d(),p("div",Me,[De,z(n("input",{"onUpdate:modelValue":v[0]||(v[0]=f=>s.runtime.path=f),class:"path-input",type:"text"},null,512),[[H,s.runtime.path]])])),n("div",Te,[Ue,n("div",Ae,[c(_)?(d(),p("button",{key:0,class:"root-path",onClick:v[1]||(v[1]=f=>l())},I(c(_)),1)):(d(),p("span",Be," Loading... ")),z(n("input",{"onUpdate:modelValue":v[2]||(v[2]=f=>s.runtime.file=f),type:"text"},null,512),[[H,s.runtime.file]]),n("button",{class:"open-file-icon",onClick:v[3]||(v[3]=f=>u())},[k(pe,{path:c(Ce)},null,8,["path"]),Y(" Open in editor ")])]),n("div",Fe,I(c(m)),1)]),t.pathError?(d(),p("div",Pe,I(t.pathError),1)):x("",!0)]))}});const vt=Q(ze,[["__scopeId","data-v-0dfc8705"]]);class se{constructor(){D(this,"logState",J({log:[]}));D(this,"_listeners",{})}static create(){return new se}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const o=t?this.logs.find(u=>u.id===t):null;return o?Object.assign(o,e):this.logs.push({...e,id:t||U()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=U();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class He{static async*sendMessage(e,t){var m;const u=(m=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:m.getReader();if(!u)throw new Error("No response body");for(;;){const l=await u.read();if(l.done)break;yield new TextDecoder().decode(l.value)}}}const Ne=s=>(j("data-v-cfdedb79"),s=s(),G(),s),Ve={class:"smart-console"},Oe={class:"header"},Ke={class:"left"},qe={class:"right"},Je=["unseen-severity"],We={class:"cli"},Ye={class:"left"},je=Ne(()=>n("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Ge={key:1,class:"local-entry"},Qe={class:"input"},Ze=["pointer-events","onKeydown"],Xe={class:"right"},et=A({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:null,runtime:null,logService:null},emits:["eval-request","clear-terminal","restart","enter"],setup(s,{emit:e}){const t=s,o=h(""),u=h(null),m=_e(),l=h({type:"seen"}),i=h(!1),_=h(!1),a=()=>{t.logService.clear(),e("restart")},v=()=>{C.value=C.value==="assistant"?"debugger":"assistant"};function f(r){switch(r.type){case"ai-input":return{role:"user",content:r.log};case"ai-output":return{role:"assistant",content:r.log};case"stderr":case"stdout":return{role:"user",content:r.log};case"restart":return{role:"user",content:"-- new session --"};default:throw new Error(`Unknown log type: ${r.type}`)}}function E(){w.value=!w.value,w.value&&(l.value={type:"seen"})}Z(m,()=>{t.logService.clear(),e("clear-terminal")});const $=h(null),C=h("assistant"),ne=async r=>{var y;if(r.preventDefault(),o.value=((y=$.value)==null?void 0:y.innerText)||"",r.shiftKey){document.execCommand("insertLineBreak");return}$.value&&($.value.innerText=""),C.value==="assistant"?await oe():await ae()},oe=async()=>{var y;if(e("enter",o.value),t.logService.log({type:"ai-input",log:o.value}),o.value="",!_.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}i.value=!0;const r={role:"user",content:(y=t.formCode)!=null?y:""};try{const b=U();let g="";const R=He.sendMessage([r,...t.logService.logs.map(M=>f(M)),{role:"user",content:o.value}],t.runtime);for await(const M of R)g+=M,t.logService.log({type:"ai-output",log:g},b)}catch(b){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(b),be(b)}finally{i.value=!1}},ae=async()=>{o.value&&(t.logService.log({type:"eval-input",log:`>>> ${o.value}`}),e("eval-request",o.value),o.value="")},re=()=>{t.logService.clear()};t.logService.listen(async r=>{w.value||(l.value={type:"unseen",count:l.value.type==="unseen"?l.value.count+1:1,severity:r.type==="stderr"?"error":"info"}),r.type!=="restart"&&(await ve(),u.value&&(u.value.scrollTop=u.value.scrollHeight))});const w=h(!1),B=h(400),le=W(()=>({height:`${B.value}px`})),L=h(!1),ie=()=>L.value=!0,F=r=>{!L.value||(B.value=document.body.clientHeight-r.clientY)},P=()=>L.value=!1;return X(()=>{document.addEventListener("mousemove",F),document.addEventListener("mouseup",P),Le.get().then(r=>_.value=!!r)}),ee(()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",P)}),(r,y)=>{const b=ye("Markdown");return d(),p("div",Ve,[n("div",Oe,[n("div",Ke,[k(S,{path:C.value==="assistant"?c(N):c(V)},null,8,["path"]),Y(" Smart Console ")]),n("div",qe,[n("div",{class:"changes-container"},[n("button",{class:"header-button",onClick:a},"Restart")]),n("div",{class:"toggle-button",onClick:E},[k(S,{class:T(["icon",{open:w.value}]),path:c(O),fill:"#fff"},null,8,["class","path"]),l.value.type==="unseen"?(d(),p("div",{key:0,class:"unseen-count","unseen-severity":l.value.severity},I(l.value.count),9,Je)):x("",!0)])])]),w.value?(d(),p("div",{key:0,class:"terminal",style:fe(c(le))},[n("div",{class:"resize-handler",onMousedown:ie},null,32),n("div",We,[n("div",Ye,[n("div",{ref_key:"entriesContainer",ref:u,class:"entries"},[je,(d(!0),p(he,null,me(t.logService.logs,(g,R)=>(d(),p("div",{key:R,class:T([g.type,"entry"])},[g.type==="ai-output"?(d(),we(b,{key:0,source:g.log},null,8,["source"])):(d(),p("div",Ge,I(g.type==="restart"?"-- restarted --":g.log),1))],2))),128))],512),n("div",Qe,[k(S,{class:T(["icon",{open:w.value}]),path:c(O)},null,8,["class","path"]),n("div",{ref_key:"inputRef",ref:$,class:"input-text",contenteditable:"","pointer-events":i.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:ge(ne,["enter"])},null,40,Ze)])]),n("div",Xe,[n("div",{class:"icons",onClick:re},[k(S,{class:"icon",path:c(Se)},null,8,["path"])]),n("div",null,[k(S,{class:"icon clickable",path:C.value==="assistant"?c(N):c(V),onClick:y[0]||(y[0]=g=>v())},null,8,["path"])])])])],4)):x("",!0)])}}});const ft=Q(et,[["__scopeId","data-v-cfdedb79"]]),tt={class:"unsaved-changes-handler"},ht=A({__name:"UnsavedChangesHandler",props:{hasChanges:{type:Boolean}},setup(s){const e=s,t="You have unsaved changes. Are you sure you want to leave?",o=i=>(i=i||window.event,i&&(i.returnValue=t),t),u=()=>{window.addEventListener("beforeunload",o)};ke((i,_,a)=>{if(!e.hasChanges)return a();confirm(t)?a():a(!1)});const m=()=>window.removeEventListener("beforeunload",o),l=i=>i?u():m();return Z(()=>e.hasChanges,l),X(()=>l(e.hasChanges)),ee(m),(i,_)=>(d(),p("div",tt))}});export{se as L,vt as R,ft as S,ht as _};
//# sourceMappingURL=UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.83e6e3f7.js.map

import{a as U,i as C,c as P,b as p,e as i,f as $,g as k,h as F,m as B,r as I,H as Q,a9 as R,ac as G,ad as q,j as r,p as v,w as l,S as f,U as c,u as e,ae as o,aj as J,bB as W,v as g,M as A,W as N,b2 as K,bp as H,b7 as X,bt as Y,aJ as V,aK as L,aL as S,b8 as z,aP as x,a8 as E,aN as ee}from"./jwt-decode.esm-X_JHyrHe.js";import{_ as m}from"./AbstraButton.vue_vue_type_script_setup_true_lang-BBCNEuoZ.js";import{H as D}from"./PhCube.vue-Gyi4tAda.js";import{G as O}from"./PhFilePlus.vue-Cl9n1snb.js";import{G as Z,a as te}from"./PhFolderPlus.vue-C9d-wT9w.js";import{F as ae}from"./PhGear.vue-CxzCePwx.js";import{G as re}from"./PhPencilSimple.vue-3Y3iUjS-.js";import{F as le}from"./PhUsersThree.vue-gj9YN_Cm.js";import{b as oe,e as ie,f as de,L as se,g as ne}from"./router-BfX34XLs.js";import{M as ue}from"./member-BGyppV9w.js";import{P as ce,a as fe}from"./project-Di93b8x1.js";import"./tables-DRvslhiY.js";import{F as ve}from"./folder-Hqq983bO.js";import{a as T}from"./ant-design-BcHu_TfS.js";import{O as he}from"./organization-SNc0JO6D.js";import"./ts.worker-BwKuk5mh.js";import"./record-BoeAoZE0.js";import"./string-DXA1IHkK.js";(function(){try{var b=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(b._sentryDebugIds=b._sentryDebugIds||{},b._sentryDebugIds[a]="987f8faf-91ae-4eea-8636-a3e6f4c85854",b._sentryDebugIdIdentifier="sentry-dbid-987f8faf-91ae-4eea-8636-a3e6f4c85854")}catch{}})();const me=["width","height","fill","transform"],pe={key:0},_e=F("path",{d:"M248.23,112.31A20,20,0,0,0,232,104H220V88a20,20,0,0,0-20-20H132L105.34,48a20.12,20.12,0,0,0-12-4H40A20,20,0,0,0,20,64V208a12,12,0,0,0,12,12H211.1a12,12,0,0,0,11.33-8l28.49-81.47.06-.17A20,20,0,0,0,248.23,112.31ZM92,68l28.8,21.6A12,12,0,0,0,128,92h68v12H69.77a20,20,0,0,0-18.94,13.58L44,137.15V68ZM202.59,196H48.89l23.72-68H226.37Z"},null,-1),je=[_e],we={key:1},ge=F("path",{d:"M208,88v24H69.77a8,8,0,0,0-7.59,5.47L32,208V64a8,8,0,0,1,8-8H93.33a8,8,0,0,1,4.8,1.6L128,80h72A8,8,0,0,1,208,88Z",opacity:"0.2"},null,-1),Fe=F("path",{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"},null,-1),be=[ge,Fe],ye={key:2},Pe=F("path",{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Z"},null,-1),Ie=[Pe],Me={key:3},ke=F("path",{d:"M243.36,111.81A14,14,0,0,0,232,106H214V88a14,14,0,0,0-14-14H130L101.74,52.8a14.06,14.06,0,0,0-8.4-2.8H40A14,14,0,0,0,26,64V208a6,6,0,0,0,6,6H211.1a6,6,0,0,0,5.69-4.1l28.49-85.47A14,14,0,0,0,243.36,111.81ZM40,62H93.34a2,2,0,0,1,1.2.4L124.4,84.8A6,6,0,0,0,128,86h72a2,2,0,0,1,2,2v18H69.77a14,14,0,0,0-13.28,9.57L38,171V64A2,2,0,0,1,40,62Zm193.9,58.63L206.78,202H40.33l27.54-82.63a2,2,0,0,1,1.9-1.37H232a2,2,0,0,1,1.9,2.63Z"},null,-1),Ce=[ke],He={key:4},Le=F("path",{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"},null,-1),Ae=[Le],Ne={key:5},Ve=F("path",{d:"M241.72,113a11.88,11.88,0,0,0-9.73-5H212V88a12,12,0,0,0-12-12H129.33l-28.8-21.6a12.05,12.05,0,0,0-7.2-2.4H40A12,12,0,0,0,28,64V208a4,4,0,0,0,4,4H211.09a4,4,0,0,0,3.79-2.74l28.49-85.47A11.86,11.86,0,0,0,241.72,113ZM40,60H93.33a4,4,0,0,1,2.4.8L125.6,83.2a4,4,0,0,0,2.4.8h72a4,4,0,0,1,4,4v20H69.76a12,12,0,0,0-11.38,8.21L36,183.35V64A4,4,0,0,1,40,60Zm195.78,61.26L208.2,204H37.55L66,118.74A4,4,0,0,1,69.76,116H232a4,4,0,0,1,3.79,5.26Z"},null,-1),Se=[Ve],ze={name:"PhFolderOpen"},xe=U({...ze,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(b){const a=b,d=C("weight","regular"),u=C("size","1em"),_=C("color","currentColor"),y=C("mirrored",!1),j=P(()=>a.weight??d),h=P(()=>a.size??u),t=P(()=>a.color??_),M=P(()=>a.mirrored!==void 0?a.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(s,n)=>(i(),p("svg",B({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:t.value,transform:M.value},s.$attrs),[$(s.$slots,"default"),j.value==="bold"?(i(),p("g",pe,je)):j.value==="duotone"?(i(),p("g",we,be)):j.value==="fill"?(i(),p("g",ye,Ie)):j.value==="light"?(i(),p("g",Me,Ce)):j.value==="regular"?(i(),p("g",He,Ae)):j.value==="thin"?(i(),p("g",Ne,Se)):k("",!0)],16,me))}});class Ee{fetchedState=I(null);activeFolderIds;draftFolder=I(null);draftProject=I(null);searchQuery=I("");isDraftProjectValid=P(()=>this.validateDraftProject());isDraftFolderValid=P(()=>this.validateDraftFolder());isDraftFolderUnique=I(!0);memberOptions=P(()=>this.getMemberOptions());folderOptions=P(()=>this.getFolderOptions());organizationId;currentUserEmail;handlers;apis;constructor(a){this.organizationId=a.organizationId,this.currentUserEmail=a.currentUserEmail,this.handlers=a.handlers,this.apis=a.apis,a.routeHash.startsWith("#")?this.activeFolderIds=I([a.routeHash.slice(1)]):this.activeFolderIds=I([])}async refetchState(a=!0){a&&this.closeModals(),this.fetchedState.value=null;const[d,u,_,y]=await Promise.all([ce.list(this.organizationId),he.get(this.organizationId),this.apis.member.list(this.organizationId),this.apis.folder.list(this.organizationId)]),j=_.find(h=>h.email===this.currentUserEmail)??null;y.length===1&&this.activeFolderIds.value?.includes(y[0].id),this.fetchedState.value={projects:d.sort((h,t)=>h.name.localeCompare(t.name)),organization:u,members:_,folders:y.sort((h,t)=>h.name.localeCompare(t.name)),currentMember:j},Q(this.searchQuery,h=>{h.trim()?this.activeFolderIds.value=this.listFolders().map(t=>t.id):this.activeFolderIds.value=[]})}deleteProject=async()=>{!this.draftProject.value||this.draftProject.value.mode!=="edit"||!await T("Are you sure you want to delete this project? All data will be lost.")||(this.draftProject.value={...this.draftProject.value,buttonLoading:"delete"},await this.apis.project.delete(this.draftProject.value.id),await this.refetchState())};deleteFolder=async()=>{if(!this.draftFolder.value||this.draftFolder.value.mode!=="edit")throw new Error("[PROJECTS_CONTROLLER] Invalid state deleting folder");this.getFolderProjects(this.draftFolder.value.id).length>0||!await T("Are you sure you want to delete this empty folder?",{okText:"Delete",cancelText:"Cancel"})||(this.draftFolder.value={...this.draftFolder.value,buttonLoading:"delete"},await this.apis.folder.delete(this.organizationId,this.draftFolder.value.id),await this.refetchState())};duplicateProject=async({key:a})=>{const d=this.fetchedState.value?.projects.find(u=>u.id===a);if(d){const u=await d.duplicate();this.handlers.navigateToProject(u.id)}};openEditFolderModal=a=>{this.fetchedState.value?.projects.filter(u=>u.folderId===a.id).map(u=>u.id)&&(this.draftFolder.value={currentName:a.name,modalTitle:`${a.name} - Settings`,id:a.id,mode:"edit",newName:a.name,newMemberIds:[...a.memberIds],currentMemberIds:a.memberIds,buttonLoading:null})};openCreateFolderModal=()=>{if(!this.fetchedState.value)throw new Error("[PROJECTS_CONTROLLER] Invalid state opening create folder modal");this.draftFolder.value={currentName:"",mode:"create",currentMemberIds:[],modalTitle:"Create Folder",newName:"",newMemberIds:[this.fetchedState.value.currentMember?.id].filter(Boolean),buttonLoading:null}};openCreateProjectModal=(a="")=>{this.draftProject.value={currentName:"",mode:"create",currentFolderId:"",modalTitle:"Create Project",newName:"",newFolderId:a,buttonLoading:null}};openEditProjectModal=a=>{this.draftProject.value={id:a.id,mode:"edit",currentName:a.name,currentFolderId:a.folderId,modalTitle:`Edit Project: ${a.name}`,newName:a.name,newFolderId:a.folderId,buttonLoading:null}};saveFolder=async()=>{if(this.isDraftFolderUnique.value=!0,!!this.draftFolder.value){if(this.draftFolder.value.newName!==this.draftFolder.value.currentName&&!await this.apis.folder.checkNameAvailability(this.organizationId,this.draftFolder.value.newName)){this.isDraftFolderUnique.value=!1;return}this.draftFolder.value={...this.draftFolder.value,buttonLoading:"save"},this.draftFolder.value.mode==="edit"?await this.apis.folder.update(this.organizationId,{id:this.draftFolder.value.id,name:this.draftFolder.value.newName,memberIds:this.draftFolder.value.newMemberIds,organizationId:this.organizationId}):this.draftFolder.value.mode==="create"&&await this.apis.folder.create({organizationId:this.organizationId,name:this.draftFolder.value.newName,memberIds:this.draftFolder.value.newMemberIds}),await this.refetchState()}};saveProject=async()=>{if(this.draftProject.value){if(this.draftProject.value={...this.draftProject.value,buttonLoading:"save"},this.draftProject.value.mode==="edit")await this.apis.project.update(this.draftProject.value.id,{name:this.draftProject.value.newName,folderId:this.draftProject.value.newFolderId});else if(this.draftProject.value.mode==="create"){const a=await this.apis.project.create({name:this.draftProject.value.newName,folderId:this.draftProject.value.newFolderId,organizationId:this.organizationId});this.handlers.navigateToProject(a.id);return}await this.refetchState()}};closeModals=()=>{this.draftFolder.value=null,this.draftProject.value=null,this.activeFolderIds.value=[]};validateDraftFolder=()=>{if(!this.draftFolder.value)return!1;const a=this.draftFolder.value.newName!==this.draftFolder.value.currentName,d=this.draftFolder.value.newName.trim().length>0,u=!R.isEqual(this.draftFolder.value.newMemberIds,this.draftFolder.value.currentMemberIds),_=this.draftFolder.value.newMemberIds.length>0;return this.draftFolder.value.mode==="edit"?a&&d||u&&_:d&&_};validateDraftProject=()=>{if(!this.draftProject.value)return!1;const a=!!this.draftProject.value.newFolderId,d=this.draftProject.value.newName.trim().length>0,u=this.draftProject.value.newName!==this.draftProject.value.currentName,_=this.draftProject.value.newFolderId!==this.draftProject.value.currentFolderId;return this.draftProject.value.mode==="edit"?u&&d||_:a&&d};getMemberOptions=()=>this.fetchedState.value?.members.map(a=>({label:a.email,value:a.id,disabled:a.id===this.fetchedState.value?.currentMember?.id})).sort((a,d)=>a.label.localeCompare(d.label));getFolderOptions=()=>this.fetchedState.value?.folders.map(a=>({label:a.name,value:a.id}));getFolderProjects=a=>this.fetchedState.value?.projects.filter(d=>d.folderId===a&&(!this.searchQuery.value.trim()||d.name.toLowerCase().includes(this.searchQuery.value.toLowerCase())));listFolders(){return this.searchQuery.value.trim()?this.fetchedState.value?.folders.filter(a=>this.getFolderProjects(a.id).length>0)??[]:this.fetchedState.value?.folders??[]}}const De={key:0},Oe={key:1},Ze=U({__name:"ProjectsView",setup(b){const d=G().params.organizationId,u=q(),_={navigateToProject:M=>u.push({name:"project",params:{organizationId:d,projectId:M}})},y=oe.getAuthor()?.claims.email;if(!y)throw new Error("User not logged in");const j=(M,s)=>s?.label?.toLowerCase().includes(M.toLowerCase())??!1,h={member:new ue,project:new fe,folder:new ve},t=new Ee({organizationId:d,currentUserEmail:y,handlers:_,apis:h,routeHash:location.hash});return t.refetchState(!1),(M,s)=>(i(),p(A,null,[r(e(J),null,{default:l(()=>[f(c(e(o).translate("i18n_projectsview_title")),1)]),_:1}),r(e(g),{style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"5px",margin:"0px 0px 50px"}},{default:l(()=>[r(e(W),{value:e(t).searchQuery.value,"onUpdate:value":s[0]||(s[0]=n=>e(t).searchQuery.value=n),placeholder:e(o).translate("i18n_projectsview_search_placeholder"),style:{width:"300px"}},null,8,["value","placeholder"]),r(m,{onClick:e(t).openCreateFolderModal},{default:l(()=>[r(e(Z)),f(" "+c(e(o).translate("i18n_projectsview_create_folder")),1)]),_:1},8,["onClick"])]),_:1}),r(e(g),{vertical:"",gap:"middle",style:{"padding-bottom":"50px"}},{default:l(()=>[(i(!0),p(A,null,N(e(t).listFolders(),n=>(i(),v(e(ie),{key:n.id,"active-key":e(t).activeFolderIds.value,"onUpdate:activeKey":s[1]||(s[1]=w=>e(t).activeFolderIds.value=w)},{expandIcon:l(({isActive:w})=>[w?(i(),v(e(xe),{key:0,size:"20"})):(i(),v(e(te),{key:1,size:"20"}))]),default:l(()=>[(i(),v(e(de),{key:n.id,header:n.name},{extra:l(()=>[r(e(g),{gap:"10"},{default:l(()=>[r(e(g),{gap:"5",align:"flex-start"},{default:l(()=>[r(e(D),{size:"20"}),f(" "+c(e(o).translate("i18n_projectsview_projects_count",null,e(t).getFolderProjects(n.id)?.length)),1)]),_:2},1024),r(e(g),{gap:"5"},{default:l(()=>[r(e(le),{size:"20"}),f(" "+c(e(o).translate("i18n_projectsview_editors_count",null,n.memberIds.length)),1)]),_:2},1024),r(m,{size:"small",onClick:H(w=>e(t).openCreateProjectModal(n.id),["stop"])},{default:l(()=>[r(e(O)),f(" "+c(e(o).translate("i18n_projectsview_new_project")),1)]),_:1},8,["onClick"]),r(m,{size:"small",onClick:H(w=>e(t).openEditFolderModal(n),["stop"])},{default:l(()=>[r(e(ae))]),_:1},8,["onClick"])]),_:2},1024)]),default:l(()=>[r(e(se),{locale:{emptyText:e(o).translate("i18n_projectsview_empty_folder")}},{default:l(()=>[(i(!0),p(A,null,N(e(t).getFolderProjects(n.id),w=>(i(),v(e(ne),{key:w.id,type:"link",class:"project-list-item"},{default:l(()=>[r(e(D)),r(e(K),{href:`/projects/${w.id}`},{default:l(()=>[f(c(w.name),1)]),_:2},1032,["href"]),r(m,{size:"small",style:{position:"absolute",right:"10px"},onClick:H(Te=>e(t).openEditProjectModal(w),["stop"])},{default:l(()=>[r(e(re))]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:2},1032,["locale"])]),_:2},1032,["header"]))]),_:2},1032,["active-key"]))),128))]),_:1}),e(t).fetchedState.value?e(t).listFolders().length===0?(i(),v(e(Y),{key:1},{description:l(()=>[F("div",null,[e(t).searchQuery.value.trim()?(i(),p("p",De,c(e(o).translate("i18n_projectsview_no_projects_search",null,e(t).searchQuery.value)),1)):(i(),p("p",Oe,c(e(o).translate("i18n_projectsview_no_folders")),1)),F("p",null,c(e(o).translate("i18n_projectsview_click_create_folder")),1)])]),default:l(()=>[e(t).searchQuery.value.trim()?(i(),v(m,{key:0,type:"primary",onClick:s[2]||(s[2]=n=>e(t).openCreateProjectModal())},{default:l(()=>[r(e(O)),f(" "+c(e(o).translate("i18n_projectsview_create_project")),1)]),_:1})):(i(),v(m,{key:1,type:"primary",onClick:e(t).openCreateFolderModal},{default:l(()=>[r(e(Z)),f(" "+c(e(o).translate("i18n_projectsview_create_folder")),1)]),_:1},8,["onClick"]))]),_:1})):k("",!0):(i(),v(e(X),{key:0,style:{width:"100%"}})),r(e(E),{open:!!e(t).draftFolder.value,title:e(t).draftFolder.value?.modalTitle,onCancel:e(t).closeModals},{footer:l(()=>[r(e(g),{justify:e(t).draftFolder.value?.mode==="edit"?"space-between":"flex-end"},{default:l(()=>[e(t).draftFolder.value?.mode==="edit"?(i(),v(m,{key:0,danger:"","disabled-tooltip":e(o).translate("i18n_projectsview_cannot_delete_folder"),disabled:e(t).getFolderProjects(e(t).draftFolder.value?.id).length>0,loading:e(t).draftFolder.value?.buttonLoading==="delete",onClick:s[5]||(s[5]=H(n=>e(t).deleteFolder(),["stop"]))},{default:l(()=>[r(e(x)),f(" "+c(e(o).translate("i18n_projectsview_delete_folder")),1)]),_:1},8,["disabled-tooltip","disabled","loading"])):k("",!0),r(e(g),{justify:"flex-end"},{default:l(()=>[r(m,{onClick:e(t).closeModals},{default:l(()=>[f(c(e(o).translate("i18n_projectsview_cancel")),1)]),_:1},8,["onClick"]),r(m,{type:"primary",disabled:!e(t).isDraftFolderValid.value,loading:e(t).draftFolder.value?.buttonLoading==="save",onClick:e(t).saveFolder},{default:l(()=>[f(c(e(o).translate("i18n_projectsview_save")),1)]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1},8,["justify"])]),default:l(()=>[e(t).draftFolder.value?(i(),v(e(V),{key:0,layout:"vertical"},{default:l(()=>[r(e(L),{label:e(o).translate("i18n_projectsview_folder_name"),"validate-status":e(t).isDraftFolderUnique.value?"":"error",help:e(t).isDraftFolderUnique.value?"":e(o).translate("i18n_projectsview_folder_exists")},{default:l(()=>[r(e(S),{value:e(t).draftFolder.value.newName,"onUpdate:value":s[3]||(s[3]=n=>e(t).draftFolder.value.newName=n)},null,8,["value"])]),_:1},8,["label","validate-status","help"]),r(e(L),{label:e(o).translate("i18n_projectsview_editors"),tooltip:e(o).translate("i18n_projectsview_editors_tooltip")},{default:l(()=>[r(e(z),{value:e(t).draftFolder.value.newMemberIds,"onUpdate:value":s[4]||(s[4]=n=>e(t).draftFolder.value.newMemberIds=n),mode:"multiple",options:e(t).memberOptions.value,"filter-option":j,placeholder:e(o).translate("i18n_projectsview_choose_editors")},null,8,["value","options","placeholder"])]),_:1},8,["label","tooltip"])]),_:1})):k("",!0)]),_:1},8,["open","title","onCancel"]),r(e(E),{open:!!e(t).draftProject.value,title:e(t).draftProject.value?.modalTitle,onCancel:e(t).closeModals},{footer:l(()=>[r(e(g),{justify:e(t).draftProject.value?.mode==="edit"?"space-between":"flex-end"},{default:l(()=>[e(t).draftProject.value?.mode==="edit"?(i(),v(m,{key:0,danger:"",loading:e(t).draftProject.value?.buttonLoading==="delete",onClick:e(t).deleteProject},{default:l(()=>[r(e(x)),f(" "+c(e(o).translate("i18n_projectsview_delete_project")),1)]),_:1},8,["loading","onClick"])):k("",!0),r(e(g),{justify:"flex-end"},{default:l(()=>[r(m,{onClick:e(t).closeModals},{default:l(()=>[f(c(e(o).translate("i18n_projectsview_cancel")),1)]),_:1},8,["onClick"]),r(m,{disabled:!e(t).isDraftProjectValid.value,type:"primary",loading:e(t).draftProject.value?.buttonLoading==="save",onClick:e(t).saveProject},{default:l(()=>[f(c(e(o).translate("i18n_projectsview_save")),1)]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1},8,["justify"])]),default:l(()=>[e(t).draftProject.value?(i(),v(e(V),{key:0,layout:"vertical"},{default:l(()=>[r(e(L),{label:e(o).translate("i18n_projectsview_project_name")},{default:l(()=>[r(e(S),{value:e(t).draftProject.value.newName,"onUpdate:value":s[6]||(s[6]=n=>e(t).draftProject.value.newName=n)},null,8,["value"])]),_:1},8,["label"]),r(e(L),{label:e(o).translate("i18n_projectsview_project_folder")},{default:l(()=>[r(e(z),{value:e(t).draftProject.value.newFolderId,"onUpdate:value":s[7]||(s[7]=n=>e(t).draftProject.value.newFolderId=n),options:e(t).folderOptions.value,placeholder:e(o).translate("i18n_projectsview_choose_folder")},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1})):k("",!0)]),_:1},8,["open","title","onCancel"])],64))}}),it=ee(Ze,[["__scopeId","data-v-06a14512"]]);export{it as default};
//# sourceMappingURL=ProjectsView-B12CQR_V.js.map

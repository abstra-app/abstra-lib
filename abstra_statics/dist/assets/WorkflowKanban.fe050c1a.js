var ce=Object.defineProperty;var fe=(n,t,a)=>t in n?ce(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var L=(n,t,a)=>(fe(n,typeof t!="symbol"?t+"":t,a),a);import{t as pe}from"./ant-design.52d15eea.js";import{f as u,eG as ne,e$ as me,r as $,G as re,E as ge,o as ye,K as _e,d as U,b as l,c as i,w as r,u as e,aq as g,eD as k,ex as S,ev as h,bq as b,eC as C,bg as se,eL as ve,cC as F,bO as z,bH as he,ad as N,cB as E,a as be,co as ke,dq as X,e as V,cK as we,ck as Se,v as Ce}from"./outputWidgets.8bdd00aa.js";import{a as j}from"./asyncComputed.9c48c21f.js";import{L as Oe,a as Ae}from"./log.1aef8f24.js";import"./authorManager.5d8a5b68.js";import"./index.ac65f668.js";import{s as xe}from"./metadata.54400fb9.js";import{r as De,f as Ie}from"./index.3b661999.js";import{T as Te}from"./index.a768d308.js";import{A as le}from"./index.cf4deab7.js";import{A as oe}from"./index.1bee9c69.js";import{A as Y,a as Z}from"./Title.ab87480a.js";import{D as Pe,a as Re,C as B,A as M}from"./index.31bcb551.js";import{A as ue}from"./index.5c5534c4.js";import{_ as Fe}from"./SaveButton.vue_vue_type_script_setup_true_lang.6be3f1ae.js";import{A as Ne}from"./Text.202b5bf4.js";import{F as ie}from"./Form.3cf45e89.js";import{A as q}from"./FormItem.daf8c7b1.js";import{W as Ee}from"./workspaces.78f0e95c.js";import{F as $e}from"./index.2285b07e.js";import{C as je}from"./Card.12b3fa6b.js";import{E as qe}from"./ExpandOutlined.91865b9a.js";import"./index.d775c3b4.js";import"./gateway.ca29089a.js";import"./index.cf4c23b9.js";import"./record.12d277b6.js";import"./pubsub.26e2c848.js";import"./icons.155f7531.js";import"./isNumeric.75337b1e.js";import"./hasIn.e5dbda2f.js";import"./url.55bb8ced.js";import"./index.757a24ca.js";import"./index.5f51ce04.js";import"./TabPane.5d21b6ef.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="6b9d37af-c29a-4d89-87b3-4e84b6da1abe",n._sentryDebugIdIdentifier="sentry-dbid-6b9d37af-c29a-4d89-87b3-4e84b6da1abe")}catch{}})();var Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM641.7 520.8L442.3 677.6c-7.4 5.8-18.3.6-18.3-8.8V355.3c0-9.4 10.9-14.7 18.3-8.8l199.4 156.7a11.2 11.2 0 010 17.6z"}}]},name:"play-square",theme:"filled"};const Ve=Le;function ze(n,t){return De(1,arguments),Ie(n,Date.now(),t)}function ee(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),s.forEach(function(d){Ue(n,d,a[d])})}return n}function Ue(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var W=function(t,a){var s=ee({},t,a.attrs);return u(ne,ee({},s,{icon:me}),null)};W.displayName="EyeOutlined";W.inheritAttrs=!1;const Be=W;function te(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),s.forEach(function(d){Me(n,d,a[d])})}return n}function Me(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var J=function(t,a){var s=te({},t,a.attrs);return u(ne,te({},s,{icon:Ve}),null)};J.displayName="PlaySquareFilled";J.inheritAttrs=!1;const We=J;function Je(n){switch(n.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"};case"abandoned":return{color:"warning",text:"Abandoned"}}}function Ke(){const n=$({state:"closed"});function t(){n.value={state:"closed"}}function a(){n.value={state:"visualizations"}}function s(o,c){n.value={state:"stage-run",stageRun:c}}const d=re(()=>"stageRun"in n.value?n.value.stageRun:null);return{closeDrawer:t,openVisualizationEditor:a,inspectStageRun:s,drawerState:n,selectedStageRunForDrawer:d}}function Ge({getKanbanData:n,storage:t,getWorkspace:a}){const s=t!=null?t:localStorage;function d(){const p=s.getItem("kanban-selected-stage-ids");if(p)try{return JSON.parse(p)}catch{return[]}else return[]}const o=ge(d()),c=j(async()=>{try{const p=await n(o.value);return s.setItem("kanban-selected-stage-ids",JSON.stringify(o.value)),p}catch{return s.setItem("kanban-selected-stage-ids",JSON.stringify([])),{columns:[],next_stage_options:[]}}finally{o.value=d()}}),w=j(()=>a());async function D(p,f){p?o.value=[...o.value.slice(0,f),p]:o.value=o.value.slice(0,f),await c.refetch()}function I(p,f){var y;const A=(y=p.stages)==null?void 0:y.find(T=>T.id===p.selected_stage.id);if((A==null?void 0:A.type)==="form"){const T=(f==null?void 0:f.status)==="waiting"?{"abstra-run-id":f.id}:{};return{path:`/${A.path}`,query:T}}else return null}let v=null;function O(){ye(()=>{v=setInterval(()=>{c.refetch()},1e3)}),_e(()=>{v&&clearInterval(v)})}const x=re(()=>{var f,A,y;const p=(A=(f=c.result.value)==null?void 0:f.columns)!=null?A:[];return(y=p[p.length-1])==null?void 0:y.selected_stage});return{kanbanAsyncComputed:c,selectedStageIds:o,setNewSelectedStageId:D,workspaceAsyncComputed:w,launchLink:I,lastSelectedStage:x,init:O}}async function He(n){return(await fetch("/_editor/api/kanban",{method:"POST",body:JSON.stringify({selected_stages_ids:n}),headers:{"Content-Type":"application/json"}})).json()}async function Qe(n){return(await fetch(`/_editor/api/kanban/logs/${n}`)).json()}const Xe={key:1},Ye=U({__name:"StageRunInspector",props:{stageRun:{}},setup(n){const t=n,{result:a,loading:s}=j(()=>{var o;return Qe((o=t.stageRun)==null?void 0:o.id)}),d=o=>Ae.fromDTO({executionId:o.executionId,runtimeType:o.runtimeType,runtimeName:o.runtimeName,payload:o.payload,event:o.event,createdAt:new Date(o.createdAt*1e3),buildId:""});return(o,c)=>(l(),i(e(le),{open:"",title:"Stage Run Inspector",size:"large"},{extra:r(()=>[u(e(Y),null,{default:r(()=>[u(e(oe),{style:{"font-weight":"600"}},{default:r(()=>{var w;return[g(k((w=o.stageRun)==null?void 0:w.status),1)]}),_:1}),g(" "+k(e(ze)(new Date(o.stageRun.created_at),{addSuffix:!0})),1)]),_:1})]),default:r(()=>{var w,D,I;return[(w=o.stageRun)!=null&&w.assignee?(l(),i(e(Y),{key:0},{default:r(()=>{var v;return[g(" Assignee: "+k((v=o.stageRun)==null?void 0:v.assignee),1)]}),_:1})):S("",!0),((D=o.stageRun)==null?void 0:D.content)&&((I=o.stageRun)==null?void 0:I.content.length)>0?(l(),h("div",Xe,[u(e(Z),{level:4},{default:r(()=>[g("Thread data")]),_:1}),u(e(Re),{size:"small",layout:"vertical",column:1},{default:r(()=>{var v;return[(l(!0),h(b,null,C((v=o.stageRun)==null?void 0:v.content,O=>(l(),i(e(Pe),{key:O.key,label:O.key},{default:r(()=>{var x;return[g(k((x=O.value)!=null?x:"null"),1)]}),_:2},1032,["label"]))),128))]}),_:1})])):S("",!0),u(e(Z),{level:4},{default:r(()=>[g("Thread history")]),_:1}),e(s)?(l(),i(e(se),{key:2})):e(a)?(l(),i(e(B),{key:3,ghost:""},{default:r(()=>[(l(!0),h(b,null,C(e(a),({stage:v,stage_run:O,logs:x})=>(l(),i(e(M),{key:O.id},{header:r(()=>[u(e(ue),{align:"center",gap:15},{default:r(()=>[u(ve,{path:e(xe)(v.type)},null,8,["path"]),g(" "+k(v.title),1)]),_:2},1024)]),default:r(()=>[u(e(Te),null,{default:r(()=>[(l(!0),h(b,null,C(x,p=>(l(),i(Oe,{key:p.executionId,log:d(p)},null,8,["log"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):S("",!0)]}),_:1}))}}),Ze=[{value:"text",label:"Text"},{value:"image",label:"Image"},{value:"table",label:"Table"},{value:"progress-bar",label:"Progress Bar"}];class ae{static async get(){return(await fetch("/_editor/api/visualizations")).json()}static async put(t){const a=await fetch("/_editor/api/visualizations",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return Object.freeze(a.json())}}function et(n,t){const a=n.length;if(a!==t.length)return!1;for(let s=0;s<a;s++)if(n[s].name!==t[s].name||n[s].type!==t[s].type)return!1;return!0}function R(n,t){var a;return{...n,id:(a=t==null?void 0:t.toString())!=null?a:Math.random().toString(36).slice(2)}}class K{constructor(t){L(this,"initialItems");L(this,"_items");this.initialItems=t.map((a,s)=>R(a,s)),this._items=$(t.map((a,s)=>R(a,s)))}get items(){return this._items.value}hasChanges(){return!et(this.initialItems,this.items)}async save(){const t=await ae.put(this.items);this.initialItems=t.map((a,s)=>R(a,s)),this._items.value=t.map((a,s)=>R(a,s))}static async get(){const t=await ae.get();return new K(t)}add(){this.items.push(R({name:"New var",type:"text"}))}remove(t){const a=this.items.findIndex(s=>s.id===t);a!==-1&&this.items.splice(a,1)}}const tt=U({__name:"VisualizationEditor",setup(n){const{result:t,loading:a}=j(()=>K.get());return(s,d)=>(l(),i(e(le),{open:"",title:"Visualization settings"},{extra:r(()=>[e(t)?(l(),i(Fe,{key:0,model:e(t),disabled:!e(t).hasChanges()},null,8,["model","disabled"])):S("",!0)]),default:r(()=>[e(a)||!e(t)?(l(),i(e(se),{key:0})):(l(),i(e(F),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>[u(e(z),{onClick:d[0]||(d[0]=o=>e(t).add())},{default:r(()=>[g("Add")]),_:1}),u(e(B),{bordered:!1},{default:r(()=>[(l(!0),h(b,null,C(e(t).items,o=>(l(),i(e(M),{key:o.id},{header:r(()=>[o.name?(l(),i(e(Ne),{key:0,strong:!0},{default:r(()=>[g(k(o.name),1)]),_:2},1024)):S("",!0)]),extra:r(()=>[u(e(z),{danger:"",onClick:c=>e(t).remove(o.id)},{default:r(()=>[g(" Remove ")]),_:2},1032,["onClick"])]),default:r(()=>[u(e(ie),{layout:"vertical"},{default:r(()=>[u(e(q),{label:"Property name"},{default:r(()=>[u(e(he),{value:o.name,"onUpdate:value":c=>o.name=c},null,8,["value","onUpdate:value"])]),_:2},1024),u(e(q),null,{default:r(()=>[u(e(N),{value:o.type,"onUpdate:value":c=>o.type=c,label:"Visualization type"},{default:r(()=>[(l(!0),h(b,null,C(e(Ze),c=>(l(),i(e(E),{key:c.value,value:c.value},{default:r(()=>[g(k(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1}))}}),de=["waiting","running","finished","failed"];function at(){const n=$([...de]),t=$("");return{filterStatus:n,filterSearch:t}}const nt={class:"stages-container"},rt={class:"stages-content"},st={style:{"max-height":"200px","overflow-y":"hidden"}},lt=U({__name:"WorkflowKanban",setup(n){const{kanbanAsyncComputed:t,launchLink:a,setNewSelectedStageId:s,lastSelectedStage:d,init:o}=Ge({getKanbanData:He,getWorkspace:()=>Ee.get()}),{filterSearch:c,filterStatus:w}=at(),{closeDrawer:D,inspectStageRun:I,openVisualizationEditor:v,drawerState:O,selectedStageRunForDrawer:x}=Ke();return o(),(p,f)=>{const A=be("router-link");return l(),h(b,null,[u(e(ue),{vertical:"",style:{height:"100%"}},{default:r(()=>[u(e(B),{ghost:""},{default:r(()=>[u(e(M),{header:"Filters"},{default:r(()=>[u(e(ie),null,{default:r(()=>[u(e(q),{label:"Search"},{default:r(()=>[u(e(ke),{value:e(c),"onUpdate:value":f[0]||(f[0]=y=>X(c)?c.value=y:null),placeholder:"Search",style:{width:"400px"}},null,8,["value"])]),_:1}),u(e(q),{label:"Status"},{default:r(()=>[u(e(N),{value:e(w),"onUpdate:value":f[1]||(f[1]=y=>X(w)?w.value=y:null),mode:"multiple",style:{width:"400px"}},{default:r(()=>[(l(!0),h(b,null,C(e(de),y=>(l(),i(e(E),{key:y,value:y},{default:r(()=>[g(k(e(Je)({status:y}).text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),V("div",nt,[V("div",rt,[u(e(F),{align:"start"},{default:r(()=>{var y,T,G;return[(l(!0),h(b,null,C((T=(y=e(t).result.value)==null?void 0:y.columns)!=null?T:[],(m,H)=>(l(),i(e(F),{key:H,direction:"vertical"},{default:r(()=>[u(e(N),{style:{width:"100%","min-width":"200px"},"allow-clear":"",value:m.selected_stage.id,"onUpdate:value":_=>e(s)(_,H)},{default:r(()=>[(l(!0),h(b,null,C(m.stages,_=>(l(),i(e(E),{key:_.id,value:_.id},{default:r(()=>[g(k(_.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),m.selected_stage.id?(l(),i(e(F),{key:0,direction:"vertical",style:{width:"100%"}},{default:r(()=>[(l(!0),h(b,null,C(m.stage_run_cards,_=>{var Q;return l(),i(e(je),{key:_.id,size:"small",style:{"max-width":"250px",cursor:"pointer"},"body-style":{display:((Q=_.content)==null?void 0:Q.length)>0?"block":"none"},onClick:P=>e(I)(m,_)},{title:r(()=>[u(e(oe),null,{default:r(()=>[g(k(_.status),1)]),_:2},1024)]),default:r(()=>[V("div",st,[(l(!0),h(b,null,C(_.content,P=>(l(),i(e(we),{key:P.key,"tree-data":e(pe)(P.value)},null,8,["tree-data"]))),128))]),g(" "+k(_.assignee),1)]),actions:r(()=>[e(a)(m,_)?(l(),i(A,{key:0,to:e(a)(m,_),target:"_blank",onClick:f[2]||(f[2]=P=>P.stopPropagation())},{default:r(()=>[u(e(We))]),_:2},1032,["to"])):S("",!0)]),extra:r(()=>[u(e(qe),{onClick:P=>e(I)(m,_)},null,8,["onClick"])]),_:2},1032,["body-style","onClick"])}),128)),m.stage_run_cards.length===0?(l(),i(e(Se),{key:0})):S("",!0),m.selected_stage.can_be_started&&e(a)(m)!==null?(l(),i(A,{key:1,target:"_blank",to:e(a)(m)},{default:r(()=>[u(e(z),{style:{width:"100%"}},{default:r(()=>[g(" Start ")]),_:1})]),_:2},1032,["to"])):S("",!0)]),_:2},1024)):S("",!0)]),_:2},1024))),128)),e(t).result.value&&e(t).result.value.next_stage_options.length>0?(l(),i(e(N),{key:(G=e(d))==null?void 0:G.id,style:{width:"100%","min-width":"200px"},"allow-clear":"","onUpdate:value":f[3]||(f[3]=m=>e(s)(m,e(t).result.value.columns.length))},{default:r(()=>[(l(!0),h(b,null,C(e(t).result.value.next_stage_options,m=>(l(),i(e(E),{key:m.id,value:m.id},{default:r(()=>[g(k(m.title),1)]),_:2},1032,["value"]))),128))]),_:1})):S("",!0)]}),_:1})])])]),_:1}),e(O).state==="stage-run"&&e(x)?(l(),i(Ye,{key:0,"stage-run":e(x),onClose:e(D)},null,8,["stage-run","onClose"])):e(O).state==="visualizations"?(l(),i(tt,{key:1,onClose:e(D)},null,8,["onClose"])):S("",!0),u(e($e),{onClick:e(v)},{icon:r(()=>[u(e(Be))]),_:1},8,["onClick"])],64)}}});const Ut=Ce(lt,[["__scopeId","data-v-8cc79f02"]]);export{Ut as default};
//# sourceMappingURL=WorkflowKanban.fe050c1a.js.map

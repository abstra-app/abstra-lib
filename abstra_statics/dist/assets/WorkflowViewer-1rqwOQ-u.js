import{_ as Q}from"./AbstraButton.vue_vue_type_script_setup_true_lang-BuagfHOG.js";import{F as It,I as $t,O as At}from"./os-Hmqy-LGl.js";import{a as q,i as R,c as A,b as Z,e as p,f as Lt,g as N,h,m as jt,M as yt,j as s,p as j,u as t,w as a,S as z,U as m,ak as O,K as Ct,aN as gt,v as B,W as xt,bh as ft,aQ as tt,ae as S,bc as _t,c2 as zt,ac as bt,ad as kt,bG as Tt,cn as Pt,E as pt,R as ot,be as Zt,bf as it,bd as Bt,bq as Et,d as Nt,r as P,H as mt,Y as Dt,D as Ht,b6 as Vt,aj as lt,b2 as Wt,q as Ft,t as Yt}from"./jwt-decode.esm-CHR5-9q8.js";import{F as Gt}from"./PhArrowSquareOut.vue-D91Klwl_.js";import{I as vt}from"./PhCopy.vue-BumD3NOi.js";import{G as Xt}from"./PhPencilSimple.vue-CeV8DAEx.js";import{_ as Ot}from"./vue-flow-background-Dv0RPZdu.js";import{d as nt,e as qt,h as Jt,u as Ut,M as Kt,f as Qt}from"./vue-flow-core-XPJPvSAb.js";import{C as rt}from"./router-Damv2vwi.js";import{a as wt,B as Rt,b as te}from"./build-BG57wQwP.js";import{P as ee,a as ae}from"./project-OcfeSRvY.js";import"./tables-CCVMWUOx.js";import{G as se}from"./PhArrowCounterClockwise.vue-DOWXFbqw.js";import{I as oe}from"./PhCopySimple.vue-LtloyHs-.js";import{G as ie}from"./PhDotsThreeVertical.vue-CuSmgB3x.js";import{a as le,I as ne,G as re,F as de}from"./PhWebhooksLogo.vue-5gjYa3fR.js";import{g as ce}from"./datetime-9To4L6jR.js";import{_ as ue}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang-CyPK4VeW.js";import{u as pe}from"./polling-wE-P8uQh.js";import{C as dt}from"./index-I8dXBqKE.js";import"./ts.worker-NlaQ6exm.js";import"./record-QTSLThjC.js";import"./string-B_VjbkxH.js";import"./LoadingOutlined-BsRfoD9E.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="e3e26706-cc9f-4e3f-aec8-3184f1dd99c9",r._sentryDebugIdIdentifier="sentry-dbid-e3e26706-cc9f-4e3f-aec8-3184f1dd99c9")}catch{}})();const ge=["width","height","fill","transform"],fe={key:0},me=h("path",{d:"M227.85,46.89a20,20,0,0,0-18.74-18.74c-13.13-.77-46.65.42-74.48,28.24L131,60H74.36a19.83,19.83,0,0,0-14.14,5.86L25.87,100.19a20,20,0,0,0,11.35,33.95l37.14,5.18,42.32,42.32,5.19,37.18A19.88,19.88,0,0,0,135.34,235a20.13,20.13,0,0,0,6.37,1,19.9,19.9,0,0,0,14.1-5.87l34.34-34.35A19.85,19.85,0,0,0,196,181.64V125l3.6-3.59C227.43,93.54,228.62,60,227.85,46.89ZM76,84h31L75.75,115.28l-27.23-3.8ZM151.6,73.37A72.27,72.27,0,0,1,204,52a72.17,72.17,0,0,1-21.38,52.41L128,159,97,128ZM172,180l-27.49,27.49-3.8-27.23L172,149Zm-72,22c-8.71,11.85-26.19,26-60,26a12,12,0,0,1-12-12c0-33.84,14.12-51.32,26-60A12,12,0,1,1,68.18,175.3C62.3,179.63,55.51,187.8,53,203c15.21-2.51,23.37-9.3,27.7-15.18A12,12,0,1,1,100,202Z"},null,-1),ve=[me],we={key:1},he=h("path",{d:"M184,120v61.65a8,8,0,0,1-2.34,5.65l-34.35,34.35a8,8,0,0,1-13.57-4.53L128,176ZM136,72H74.35a8,8,0,0,0-5.65,2.34L34.35,108.69a8,8,0,0,0,4.53,13.57L80,128ZM40,216c37.65,0,50.69-19.69,54.56-28.18L68.18,161.44C59.69,165.31,40,178.35,40,216Z",opacity:"0.2"},null,-1),ye=h("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),_e=[he,ye],be={key:2},ke=h("path",{d:"M101.85,191.14C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Zm122-144a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.4,27.07h0L88,108.7A8,8,0,0,1,76.67,97.39l26.56-26.57A4,4,0,0,0,100.41,64H74.35A15.9,15.9,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A16,16,0,0,0,192,181.65V155.59a4,4,0,0,0-6.83-2.82l-26.57,26.56a8,8,0,0,1-11.71-.42,8.2,8.2,0,0,1,.6-11.1l49.27-49.27h0C223.45,91.86,224.6,59.71,223.85,47.12Z"},null,-1),Se=[ke],Me={key:3},Ie=h("path",{d:"M221.86,47.24a14,14,0,0,0-13.11-13.1c-12.31-.73-43.77.39-69.88,26.5L133.52,66H74.35a13.9,13.9,0,0,0-9.89,4.1L30.11,104.44a14,14,0,0,0,7.94,23.76l39.13,5.46,45.16,45.16L127.8,218a14,14,0,0,0,23.76,7.92l34.35-34.35a13.91,13.91,0,0,0,4.1-9.89V122.48l5.35-5.35h0C221.46,91,222.59,59.56,221.86,47.24ZM38.11,115a2,2,0,0,1,.49-2L72.94,78.58A2,2,0,0,1,74.35,78h47.17L77.87,121.64l-38.14-5.32A1.93,1.93,0,0,1,38.11,115ZM178,181.65a2,2,0,0,1-.59,1.41L143.08,217.4a2,2,0,0,1-3.4-1.11l-5.32-38.16L178,134.48Zm8.87-73h0L128,167.51,88.49,128l58.87-58.88a78.47,78.47,0,0,1,60.69-23A2,2,0,0,1,209.88,48,78.47,78.47,0,0,1,186.88,108.64ZM100,190.31C95.68,199.84,81.13,222,40,222a6,6,0,0,1-6-6c0-41.13,22.16-55.68,31.69-60a6,6,0,1,1,5,10.92c-7,3.17-22.53,13.52-24.47,42.91,29.39-1.94,39.74-17.52,42.91-24.47a6,6,0,1,1,10.92,5Z"},null,-1),$e=[Ie],Ae={key:4},Le=h("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),je=[Le],Ce={key:5},xe=h("path",{d:"M219.86,47.36a12,12,0,0,0-11.22-11.22c-12-.71-42.82.38-68.35,25.91L134.35,68h-60a11.9,11.9,0,0,0-8.48,3.52L31.52,105.85a12,12,0,0,0,6.81,20.37l39.79,5.55,46.11,46.11,5.55,39.81a12,12,0,0,0,20.37,6.79l34.34-34.35a11.9,11.9,0,0,0,3.52-8.48v-60l5.94-5.94C219.48,90.18,220.57,59.41,219.86,47.36ZM36.21,115.6a3.94,3.94,0,0,1,1-4.09L71.53,77.17A4,4,0,0,1,74.35,76h52L78.58,123.76,39.44,118.3A3.94,3.94,0,0,1,36.21,115.6ZM180,181.65a4,4,0,0,1-1.17,2.83l-34.35,34.34a4,4,0,0,1-6.79-2.25l-5.46-39.15L180,129.65Zm-52-11.31L85.66,128l60.28-60.29c23.24-23.24,51.25-24.23,62.22-23.58a3.93,3.93,0,0,1,3.71,3.71c.65,11-.35,39-23.58,62.22ZM98.21,189.48C94,198.66,80,220,40,220a4,4,0,0,1-4-4c0-40,21.34-54,30.52-58.21a4,4,0,0,1,3.32,7.28c-7.46,3.41-24.43,14.66-25.76,46.85,32.19-1.33,43.44-18.3,46.85-25.76a4,4,0,1,1,7.28,3.32Z"},null,-1),ze=[xe],Te={name:"PhRocketLaunch"},Pe=q({...Te,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const e=r,n=R("weight","regular"),y=R("size","1em"),_=R("color","currentColor"),i=R("mirrored",!1),l=A(()=>e.weight??n),c=A(()=>e.size??y),w=A(()=>e.color??_),u=A(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:i?"scale(-1, 1)":void 0);return(M,b)=>(p(),Z("svg",jt({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:c.value,height:c.value,fill:w.value,transform:u.value},M.$attrs),[Lt(M.$slots,"default"),l.value==="bold"?(p(),Z("g",fe,ve)):l.value==="duotone"?(p(),Z("g",we,_e)):l.value==="fill"?(p(),Z("g",be,Se)):l.value==="light"?(p(),Z("g",Me,$e)):l.value==="regular"?(p(),Z("g",Ae,je)):l.value==="thin"?(p(),Z("g",Ce,ze)):N("",!0)],16,ge))}}),Ze=q({__name:"WorkflowEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(r){const e=r;function n(i,l,c=0){const w=l.center.x-i.center.x,u=l.center.y-i.center.y,M=Math.sqrt(w*w+u*u);if(M===0)return{sourceX:i.center.x,sourceY:i.center.y,targetX:l.center.x,targetY:l.center.y};const b=w/M,I=u/M,L=i.width/2,v=i.height/2;let $=i.center.x,C=i.center.y;Math.abs(b)*v>Math.abs(I)*L?($=i.center.x+(b>0?L:-L),C=i.center.y+I*L/Math.abs(b)):($=i.center.x+b*v/Math.abs(I),C=i.center.y+(I>0?v:-v));const g=l.width/2,x=l.height/2;let T=l.center.x,E=l.center.y;return Math.abs(b)*x>Math.abs(I)*g?(T=l.center.x-(b>0?g:-g),E=l.center.y-I*g/Math.abs(b)):(T=l.center.x-b*x/Math.abs(I),E=l.center.y-(I>0?x:-x)),$+=b*c,C+=I*c,T-=b*c,E-=I*c,{sourceX:$,sourceY:C,targetX:T,targetY:E}}function y(i,l){const w={center:{x:i.computedPosition.x+i.dimensions.width/2,y:i.computedPosition.y+i.dimensions.height/2},width:i.dimensions.width,height:i.dimensions.height},M={center:{x:l.computedPosition.x+l.dimensions.width/2,y:l.computedPosition.y+l.dimensions.height/2},width:l.dimensions.width,height:l.dimensions.height};return n(w,M,10)}const _=A(()=>{if(!e.sourceNode||!e.targetNode)return nt({sourceX:0,sourceY:0,targetX:0,targetY:0});if(!e.sourceNode.dimensions.width||!e.targetNode.dimensions.width||!e.sourceNode.dimensions.height||!e.targetNode.dimensions.height)return nt({sourceX:0,sourceY:0,targetX:0,targetY:0});const i=y(e.sourceNode,e.targetNode);return nt(i)});return(i,l)=>(p(),Z(yt,null,[s(t(qt),{path:_.value[0],"marker-end":e.markerEnd},null,8,["path","marker-end"]),e.data?.props?.taskType?(p(),j(t(Jt),{key:0},{default:a(()=>[h("div",{style:Ct({transform:`translate(-50%, -50%) translate(${_.value[1]}px,${_.value[2]}px)`}),class:"nodrag nopan edge-label"},[s(t(O),null,{default:a(()=>[z(m(e.data.props.taskType),1)]),_:1})],4)]),_:1})):N("",!0)],64))}}),Be=gt(Ze,[["__scopeId","data-v-8f1859d4"]]),Ee=q({__name:"WorkflowStageExecutions",props:{stageId:{},projectId:{},statistics:{}},setup(r){const e=r,n=c=>{if(!c.createdAt||!c.updatedAt)return 0;const w=new Date(c.createdAt).getTime(),u=new Date(c.updatedAt).getTime();return Math.round((u-w)/1e3)},y=A(()=>e.statistics?Math.round(e.statistics.completedTasks/e.statistics.totalTasks*100):0),_=A(()=>{const c=y.value;return c===100?"#52c41a":c>=50?"#1890ff":"#faad14"}),i=c=>ce(c,{weekday:void 0}),l=c=>{if(c<60)return`${Math.round(c)}s`;const w=Math.floor(c/60);if(w<60)return`${w}m`;const u=Math.floor(w/60);return u<24?`${u}h`:`${Math.floor(u/24)}d`};return(c,w)=>(p(),j(t(B),{vertical:"",size:4,style:{width:"100%"}},{default:a(()=>[r.statistics.lastExecutions&&r.statistics.lastExecutions.length>0?(p(),j(t(B),{key:0,size:4,gap:4},{default:a(()=>[(p(!0),Z(yt,null,xt(r.statistics.lastExecutions,u=>(p(),j(t(ft),{key:u.id,to:{name:"logs",params:{projectId:r.projectId},query:{executionId:u.id}}},{default:a(()=>[s(t(_t),{title:i(new Date(u.createdAt))},{content:a(()=>[s(t(B),{vertical:"",size:4},{default:a(()=>[s(t(tt),null,{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_status"))+": "+m(u.status),1)]),_:2},1024),u.updatedAt&&u.updatedAt!==u.createdAt?(p(),j(t(tt),{key:0},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_duration"))+": "+m(n(u))+"s ",1)]),_:2},1024)):N("",!0),s(t(tt),null,{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_version"))+": "+m(u.buildId.slice(0,6)),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[s(ue,{status:u.status},null,8,["status"])]),_:2},1032,["title"])]),_:2},1032,["to"]))),128))]),_:1})):N("",!0),r.statistics.totalTasks>0?(p(),j(t(ft),{key:1,to:{name:"tasks",params:{projectId:r.projectId},query:{stage:r.stageId,status:"pending"}}},{default:a(()=>[s(t(B),{vertical:"",size:2},{default:a(()=>[s(t(zt),{"show-info":!1,percent:y.value,"stroke-color":_.value,size:"small"},null,8,["percent","stroke-color"]),s(t(B),{vertical:"",size:0},{default:a(()=>[r.statistics.pendingTasks>0&&r.statistics.averageCompletionSeconds?(p(),j(t(tt),{key:0,type:"secondary",style:{fontSize:"11px"}},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_pending_tasks").replace("{count}",r.statistics.pendingTasks.toString()))+" ("+m(l(r.statistics.averageCompletionSeconds))+" "+m(t(S).translate("i18n_workflowviewer_average"))+") ",1)]),_:1})):N("",!0)]),_:1})]),_:1})]),_:1},8,["to"])):N("",!0)]),_:1}))}}),Ne={class:"stage-content"},De={class:"stage-title"},He={class:"action-item"},Ve={class:"action-item"},We={class:"action-warning"},Fe={key:1,class:"action-item"},ht="3.18.0",Ye=q({__name:"WorkflowStageNode",props:{stage:{},statistics:{},isDisabled:{type:Boolean},project:{},buildSpec:{}},emits:["toggle-stage-enabled-state"],setup(r,{emit:e}){const n=r,y=bt(),_=kt(),i=y.params.projectId,l=A(()=>({forms:de,hooks:re,scripts:ne,jobs:le})[n.stage.type]),c=()=>{_.push({name:"logs",params:{projectId:i},query:{stageId:n.stage.id}})},w=A(()=>n.stage.type==="forms"||n.stage.type==="hooks"),u=()=>{if(!n.stage.path)return;const g=n.stage.type==="forms"?`/${n.stage.path}`:`/_hooks/${n.stage.path}`,x=n.project?.getUrl(g);x&&(navigator.clipboard.writeText(x),Et.success(S.translate("i18n_workflowviewer_copied_url")))},M=(g,x)=>{const[T,E,J]=g.split(".").map(Number),[Y,W,at]=x.split(".").map(Number);return T>Y?!0:T<Y?!1:E>W?!0:E<W?!1:J>=at},b=A(()=>n.isDisabled?Tt:Pt),I=A(()=>n.isDisabled?S.translate("i18n_workflowviewer_enable_stage"):S.translate("i18n_workflowviewer_disable_stage")),L=A(()=>!M(n.buildSpec?.abstraVersion||"0.0.0",ht)),v=A(()=>L.value?S.translate("i18n_workflowviewer_disable_stages_warning").replace("{version}",ht):""),$=e,C=async()=>{L.value||await $("toggle-stage-enabled-state",n.stage.id)};return(g,x)=>(p(),Z("div",{class:pt(["stage-node",{disabled:r.isDisabled}])},[h("div",Ne,[(p(),j(ot(l.value),{size:18,class:"stage-icon"})),h("div",De,m(r.stage.title),1),s(t(Bt),{trigger:["click"]},{overlay:a(()=>[s(t(Zt),null,{default:a(()=>[s(t(it),{onClick:c},{default:a(()=>[h("div",He,[s(t(se),{size:16}),h("span",null,m(t(S).translate("i18n_workflowviewer_view_logs")),1)])]),_:1}),w.value?(p(),j(t(it),{key:0,onClick:u},{default:a(()=>[h("div",Ve,[s(t(oe),{size:16}),h("span",null,m(t(S).translate("i18n_workflowviewer_copy_url")),1)])]),_:1})):N("",!0),s(t(it),{onClick:C},{default:a(()=>[L.value?(p(),j(t(_t),{key:0,placement:"left"},{content:a(()=>[h("div",We,[s(t(O),null,{default:a(()=>[z(m(v.value),1)]),_:1})])]),default:a(()=>[h("div",{class:pt(["action-item",{disabled:L.value}])},[(p(),j(ot(b.value),{size:16})),h("span",null,m(I.value),1)],2)]),_:1})):(p(),Z("div",Fe,[(p(),j(ot(b.value),{size:16})),h("span",null,m(I.value),1)]))]),_:1})]),_:1})]),default:a(()=>[s(t(ie),{style:{cursor:"pointer"},size:20,class:"actions-menu"})]),_:1})]),r.statistics?(p(),j(Ee,{key:0,"stage-id":r.stage.id,"project-id":t(i),statistics:r.statistics,style:{"margin-top":"8px"}},null,8,["stage-id","project-id","statistics"])):N("",!0)],2))}}),et=gt(Ye,[["__scopeId","data-v-72a65f73"]]);class Ge{async list(e){return rt.get(`projects/${e}/disabled-stages`)}async disableStage({projectId:e,stageId:n}){return rt.patch(`projects/${e}/disabled-stages/${n}`,{enable:!1})}async enableStage({projectId:e,stageId:n}){return rt.patch(`projects/${e}/disabled-stages/${n}`,{enable:!0})}}const ct=new Ge;class F{constructor(e){this.dto=e,this.id=e}id;static async list(e){return(await ct.list(e)).map(y=>new F(y))}static async disableStage({projectId:e,stageId:n}){return ct.disableStage({projectId:e,stageId:n})}static async enableStage({projectId:e,stageId:n}){return ct.enableStage({projectId:e,stageId:n})}}const Xe=Nt("workflow",()=>{const r=P([]),e=P(null),n=P(!1);let y=null,_=null,i=null,l=[];async function c(){if(!_||!i){console.warn("Cannot load data: no project context set");return}n.value=!0;try{const v=await i.getWorkflowStatistics(_),$=new Set(l),C=new Map(v.filter(g=>$.has(g.stageId)).map(g=>[g.stageId,g]));r.value=l.map(g=>C.has(g)?C.get(g):{stageId:g,lastExecutions:[],pendingTasks:0,lockedTasks:0,completedTasks:0,averageCompletionSeconds:void 0,totalTasks:0}),await b()}catch(v){console.error("Failed to load workflow data:",v)}finally{n.value=!1}}function w(v,$,C){if(y&&y.endPolling(),i=v,_=$,l=C,C.length>0){const g=pe({task:c,interval:15e3});y=g,c(),g.startPolling()}}function u(){y&&(y.endPolling(),y=null)}function M(){u(),r.value=[],e.value=null,n.value=!1,_=null,i=null,l=[]}async function b(){if(!_){console.warn("Cannot refetch disabled stages: no project context set");return}e.value=await F.list(_)}async function I(v){e.value?.some($=>$.id===v)?(e.value=e.value.filter($=>$.id!==v),await F.enableStage({projectId:_,stageId:v})):(e.value=[...e.value||[],new F(v)],await F.disableStage({projectId:_,stageId:v})),await b()}const L=A(()=>v=>r.value.find($=>$.stageId===v)||null);return{statistics:r,disabledStages:e,loading:n,getStatisticsForStage:L,initializePolling:w,stopPolling:u,resetStore:M,refetch:c,toggleStageEnabledState:I}}),Oe={class:"flow-container"},qe={class:"code-container"},Je={class:"code-container"},Ue={key:0,class:"edit-button-text"},ut="#ea576a",Ke=q({__name:"WorkflowViewer",setup(r){const{onInit:e}=Ut(),n=new Rt,y=bt(),_=kt(),i=y.params.projectId,l=y.query.buildId,c=P(!0),w=P(null),u=P(!0),M=P(!1),b=()=>{_.push({name:"web-editor",params:{projectId:i}})},I=async f=>{try{await navigator.clipboard.writeText(f)}catch(o){console.error("Failed to copy:",o)}};e(f=>{u.value&&(f.fitView(),u.value=!1)});const L=P([]),v=P([]),$=A(()=>L.value.map(f=>f.id)),C=new ae,g=Xe(),x=A(()=>g.statistics),T=P();mt($,f=>{g.initializePolling(C,i,f)},{immediate:!0}),Dt(()=>{g.stopPolling()});const E=P(!1),J=A(()=>L.value.length>0&&E.value),Y=f=>L.value.map(o=>({id:o.id,type:o.type,data:{stage:o,statistics:f.find(d=>d.stageId===o.id)||null},position:{x:o.position.x,y:o.position.y*1.5}})),W=P(Y(x.value));mt(()=>x.value,()=>{W.value=Y(x.value)});const at=A(()=>{const f=new Set(W.value.map(o=>o.id));return v.value.filter(o=>{const d=f.has(o.sourceStageId),k=f.has(o.targetStageId);return d&&k}).map(o=>({id:o.id,source:o.sourceStageId,target:o.targetStageId,type:"task",data:{id:o.id,props:{taskType:o.taskType}},markerEnd:{type:Kt.Arrow,width:24,height:24}}))});function St(f){const o=[],d=[],k=["jobs","hooks","forms","scripts"];for(const V of k){const Mt=f[V]||[];for(const D of Mt){o.push({id:D.id,type:V,title:D.title,position:{x:D.workflow_position[0],y:D.workflow_position[1]},file:D.file,path:D.path,schedule:D.schedule});for(const st of D.transitions||[])d.push({id:st.id,sourceStageId:D.id,targetStageId:st.target_id,taskType:st.task_type})}}const H=new Set(o.map(V=>V.id)),X=d.filter(V=>H.has(V.sourceStageId)&&H.has(V.targetStageId));L.value=o,v.value=X,E.value=!0}const G=P();Ht(async()=>{try{c.value=!0,T.value=await ee.get(i);let f;if(l){const H=(await wt.list(i)).find(X=>X.id===l);if(!H){w.value="Build not found";return}f=H}else{const H=(await wt.list(i)).find(X=>X.latest);if(!H){w.value="No builds found for this project";return}f=H}const o=await n.get(f.id);if(!o||!o.abstraJson){w.value="No workflow data available for this build";return}const d=JSON.parse(o.abstraJson);St(d),G.value=te.fromDTO(i,f.id,d.version,{forms:d.forms?.map(k=>({id:k.id,path:k.path,title:k.title}))||[],hooks:d.hooks?.map(k=>({id:k.id,path:k.path,title:k.title}))||[],jobs:d.jobs?.map(k=>({id:k.id,schedule:k.schedule,title:k.title}))||[],scripts:d.scripts?.map(k=>({id:k.id,title:k.title}))||[]})}catch(f){w.value=f instanceof Error?f.message:"Failed to load workflow",console.error(f)}finally{c.value=!1}});const U=f=>g.disabledStages?.some(o=>o.id===f)??!1,K=f=>{g.toggleStageEnabledState(f)};return(f,o)=>(p(),Z("div",Oe,[c.value?(p(),j(t(Vt),{key:0,style:{width:"100%"}})):J.value?(p(),j(t(Qt),{key:`workflow-${L.value.length}-${v.value.length}`,nodes:W.value,edges:at.value,"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.1,"max-zoom":1.25,"pan-on-scroll":t(At).isMac,"snap-to-grid":""},{"edge-task":a(d=>[s(Be,Ft(Yt(d)),null,16)]),"node-forms":a(d=>[s(et,{stage:d.data.stage,statistics:d.data.statistics,project:T.value,"build-spec":G.value,"is-disabled":U(d.data.stage.id),onToggleStageEnabledState:K},null,8,["stage","statistics","project","build-spec","is-disabled"])]),"node-hooks":a(d=>[s(et,{stage:d.data.stage,statistics:d.data.statistics,project:T.value,"build-spec":G.value,"is-disabled":U(d.data.stage.id),onToggleStageEnabledState:K},null,8,["stage","statistics","project","build-spec","is-disabled"])]),"node-scripts":a(d=>[s(et,{stage:d.data.stage,statistics:d.data.statistics,project:T.value,"build-spec":G.value,"is-disabled":U(d.data.stage.id),onToggleStageEnabledState:K},null,8,["stage","statistics","project","build-spec","is-disabled"])]),"node-jobs":a(d=>[s(et,{stage:d.data.stage,statistics:d.data.statistics,project:T.value,"build-spec":G.value,"is-disabled":U(d.data.stage.id),onToggleStageEnabledState:K},null,8,["stage","statistics","project","build-spec","is-disabled"])]),default:a(()=>[s(t(Ot),{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","pan-on-scroll"])):(p(),j(t(dt),{key:1,class:"empty-state-card"},{default:a(()=>[s(t(B),{vertical:"",gap:24,align:"center"},{default:a(()=>[s(t(Pe),{size:64,color:ut}),s(t(B),{vertical:"",gap:8,align:"center"},{default:a(()=>[s(t(lt),{level:3},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_getting_started")),1)]),_:1}),s(t(O),{type:"secondary",style:{"text-align":"center"}},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_no_workflow_description")),1)]),_:1})]),_:1}),s(t(B),{gap:16,wrap:"wrap",justify:"center"},{default:a(()=>[s(t(dt),{class:"option-card"},{default:a(()=>[s(t(B),{vertical:"",gap:12},{default:a(()=>[s(t(It),{size:32,color:ut}),s(t(lt),{level:5},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_option_cli")),1)]),_:1}),s(t(O),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_cli_description")),1)]),_:1}),s(t(B),{vertical:"",gap:8},{default:a(()=>[h("div",qe,[o[4]||(o[4]=h("code",{class:"install-code"},"pip install abstra",-1)),s(Q,{type:"text",size:"small",onClick:o[0]||(o[0]=d=>I("pip install abstra"))},{default:a(()=>[s(t(vt),{size:16})]),_:1})]),h("div",Je,[o[5]||(o[5]=h("code",{class:"install-code"},"abstra editor .",-1)),s(Q,{type:"text",size:"small",onClick:o[1]||(o[1]=d=>I("abstra editor ."))},{default:a(()=>[s(t(vt),{size:16})]),_:1})])]),_:1})]),_:1})]),_:1}),s(t(dt),{class:"option-card"},{default:a(()=>[s(t(B),{vertical:"",gap:12},{default:a(()=>[s(t($t),{size:32,color:ut}),s(t(lt),{level:5},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_option_online")),1)]),_:1}),s(t(O),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_online_description")),1)]),_:1}),s(Q,{type:"primary",onClick:b},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_open_editor")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(t(Wt),{href:"https://www.abstra.io/docs",target:"_blank"},{default:a(()=>[z(m(t(S).translate("i18n_workflowviewer_view_docs"))+" ",1),s(t(Gt),{size:14,style:{"margin-left":"4px"}})]),_:1})]),_:1})]),_:1})),!c.value&&J.value?(p(),j(Q,{key:3,class:pt(["edit-button",{expanded:M.value}]),type:"primary",size:"large",onClick:b,onMouseenter:o[2]||(o[2]=d=>M.value=!0),onMouseleave:o[3]||(o[3]=d=>M.value=!1)},{default:a(()=>[s(t(Xt),{size:24}),M.value?(p(),Z("span",Ue,m(t(S).translate("i18n_workflowviewer_edit_online")),1)):N("",!0)]),_:1},8,["class"])):N("",!0)]))}}),ka=gt(Ke,[["__scopeId","data-v-c605f2d3"]]);export{ka as default};
//# sourceMappingURL=WorkflowViewer-1rqwOQ-u.js.map

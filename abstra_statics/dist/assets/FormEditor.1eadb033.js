import{F as se,r as J,R as ue}from"./FormRunner.e96732c6.js";import{f as t,eG as ie,d as U,r as A,G as C,b as p,c as g,w as r,aq as m,eD as de,u as e,bO as R,cy as q,ev as j,eC as ce,cC as pe,bH as w,bq as X,F as me,H as Z,eA as ee,a as fe,ex as x,bg as ve,v as ge,bI as G,eB as ye,eK as be,e as H}from"./outputWidgets.2e02c315.js";import{R as he,S as _e,a as ke,L as we}from"./SourceCode.71e60ef6.js";import{B as Se}from"./BaseLayout.493d62bd.js";import{a as te}from"./asyncComputed.4a119ad0.js";import{F as xe}from"./forms.19ff84cd.js";import{W as ae}from"./workspaces.90510fdd.js";import{l as W,N as Pe}from"./NavbarControls.60904c25.js";import{r as Ce,d as Re,p as Ae}from"./icons.c9ffa0e2.js";import{a as Te}from"./Text.a8774948.js";import{A as _}from"./FormItem.3c08c651.js";import{A as L}from"./index.4c7601a1.js";import{M as Fe,a as D}from"./Title.cbf7e97b.js";import{A as Le}from"./index.44763224.js";import{F as re}from"./Form.c3ceca07.js";import{_ as $e}from"./SaveButton.vue_vue_type_script_setup_true_lang.0b5fbbd9.js";import{A as Y,T as Be}from"./TabPane.192061b7.js";import"./index.36d6a26a.js";import{A as Oe}from"./index.7c46b46a.js";import{E as De}from"./ExpandOutlined.fe5b033f.js";import{c as Ue}from"./index.77286e9e.js";import"./url.e412517c.js";import"./index.3a55644d.js";import"./pubsub.572a1ca9.js";import"./CircularLoading.01edc43e.js";import"./PlayerNavbar.c613dba6.js";import"./ActionButton.b2b65f9f.js";import"./WidgetsFrame.d64da2db.js";import"./uuid.743f28a9.js";import"./validations.b170419b.js";import"./record.abea3cf4.js";import"./string.6f12f860.js";import"./scripts.52852bd5.js";import"./toggleHighContrast.813ce27a.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.4a30f44f.js";import"./index.095590e1.js";import"./Link.b91c0d85.js";import"./popupNotifcation.e090e1e3.js";import"./hasIn.77fd7b18.js";import"./ant-design.bfb1cb17.js";import"./index.8bee1f92.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new Error().stack;u&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[u]="e93d70e6-9174-4533-a483-48559daab3ac",i._sentryDebugIdIdentifier="sentry-dbid-e93d70e6-9174-4533-a483-48559daab3ac")}catch{}})();var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const Me=Ie;function K(i){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?Object(arguments[u]):{},n=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),n.forEach(function(o){Ee(i,o,a[o])})}return i}function Ee(i,u,a){return u in i?Object.defineProperty(i,u,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[u]=a,i}var V=function(u,a){var n=K({},u,a.attrs);return t(ie,K({},n,{icon:Me}),null)};V.displayName="LinkOutlined";V.inheritAttrs=!1;const qe=V,Ne=U({__name:"LaunchButton",props:{path:{}},setup(i){const u=i,a=A({state:"loading"}),n=C(()=>a.value.state!=="found"),o=C(()=>a.value.state==="loading"),l=C(()=>a.value.state==="found"?a.value.url:void 0),d=C(()=>{switch(a.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${a.value}`)}}),$=C(()=>{switch(a.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${a.value}`)}});async function B(k){const y=`https://${k}.abstra.app/_version`;return(await fetch(y)).ok}async function c(k){const y=`https://${k}.abstra.app/_pages/${u.path}`;return(await fetch(y)).ok}async function O(){if(!(await W.get()).logged){a.value={state:"not-logged"};return}const y=await W.getProjectInfo().catch(()=>null);if(!y){a.value={state:"error"};return}if(!await B(y.subdomain).catch(()=>null)){a.value={state:"not-deployed"};return}if(!await c(y.subdomain).catch(()=>null)){a.value={state:"not-found"};return}const f=`https://${y.subdomain}.abstra.app/${u.path}`;a.value={state:"found",url:f}}return O(),(k,y)=>(p(),g(e(q),{title:d.value},{content:r(()=>[m(de($.value),1)]),default:r(()=>[t(e(R),{href:l.value,target:"_blank",disabled:n.value,loading:o.value,size:"small",type:"link"},{icon:r(()=>[t(e(qe))]),default:r(()=>[m(" Open Deployed ")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Qe="abstra-run-id",je=U({__name:"QueryParamsModal",props:{open:{type:Boolean},close:{type:Function},state:{},addQueryParam:{type:Function},removeQueryParam:{type:Function}},setup(i){return(u,a)=>(p(),g(e(Fe),{open:u.open,onCancel:u.close},{footer:r(()=>[t(e(R),{type:"primary",onClick:u.close},{default:r(()=>[m("OK")]),_:1},8,["onClick"])]),default:r(()=>[t(e(L),{vertical:"",gap:"20"},{default:r(()=>[t(e(Te),null,{default:r(()=>[m("Query params")]),_:1}),(p(!0),j(X,null,ce(u.state.queryParams,(n,o)=>(p(),g(e(_),{key:o},{default:r(()=>[t(e(pe),null,{default:r(()=>[t(e(w),{value:n.name,"onUpdate:value":l=>n.name=l,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(w),{value:n.value,"onUpdate:value":l=>n.value=l,type:"text",placeholder:"value",disabled:n.name===Qe},null,8,["value","onUpdate:value","disabled"]),t(e(R),{danger:"",onClick:l=>u.removeQueryParam(o)},{default:r(()=>[m("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(_),null,{default:r(()=>[t(e(R),{type:"dashed",style:{width:"100%"},onClick:u.addQueryParam},{default:r(()=>[m(" Add Query Param ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["open","onCancel"]))}}),Ve={key:2,class:"form-preview-container"},Q="abstra-run-id",ze=U({__name:"FormTester",props:{form:{},logService:{},broker:{}},emits:["redirect","exit"],setup(i,{expose:u,emit:a}){const n=i,o=()=>{a("exit")},l=A(!1),d=()=>{l.value=!0},$=()=>{l.value=!1},B=C(()=>`/${n.form.path}?${le.value.query}`),c=me({queryParams:[{name:"foo",value:"bar"}],url:`${n.form.path}`,stageRunId:null}),O=s=>{c.stageRunId=s},{result:k,loading:y}=te(()=>ae.get()),T=()=>{c.queryParams.push({name:"",value:""})},I=s=>{c.queryParams=c.queryParams.filter((F,v)=>v!==s)};Z([()=>c.stageRunId,()=>c.queryParams],([s,F])=>{const v=F.find(h=>h.name===Q);if(s&&!v){c.queryParams.push({name:Q,value:s});return}if(!s&&v){c.queryParams=c.queryParams.filter(h=>h.name!==Q);return}s&&v&&s!==v.value&&(v.value=s)}),n.broker.on("stdout",s=>{n.logService.log({type:"stdout",log:s.log})}),n.broker.on("stderr",s=>{n.logService.log({type:"stderr",log:s.log})}),n.broker.onClose(()=>{n.logService.log({type:"stderr",log:"Program closed"})}),n.broker.on("files:changed",()=>{n.logService.log({type:"files-changed",log:"Files changed"})});const f=ee(),P=({path:s})=>{J("editor",f,s)};function S(s,F){a("redirect",s,F)}const b=A(null);async function N(){var s;return n.logService.log({type:"restart"}),(s=b.value)==null?void 0:s.run()}async function oe(){var s;return(s=b.value)==null?void 0:s.run()}async function ne(){var s;return n.logService.log({type:"restart"}),(s=b.value)==null?void 0:s.exit()}const le=C(()=>{const s=new URLSearchParams(c.queryParams.filter(v=>v.name.trim()).reduce((v,h)=>({...v,[h.name]:h.value}),{})).toString();return{subdomain:"[your-subdomain]",path:n.form.path,query:s}});return u({restart:N,runner:b}),(s,F)=>{const v=fe("icon");return p(),j(X,null,[t(e(re),{layout:"vertical"},{default:r(()=>[x("",!0),t(e(L),{gap:"small"},{default:r(()=>{var h,M,E,z;return[((h=b.value)==null?void 0:h.formState)==="over"||((M=b.value)==null?void 0:M.formState)==="error"?(p(),g(e(q),{key:0,placement:"bottom"},{content:r(()=>[m("Restart form")]),default:r(()=>[t(e(R),{onClick:N},{default:r(()=>[t(v,{path:e(Ce),width:"20"},null,8,["path"])]),_:1})]),_:1})):x("",!0),((E=b.value)==null?void 0:E.formState)==="running"?(p(),g(e(q),{key:1,placement:"bottom"},{content:r(()=>[m("Stop form")]),default:r(()=>[t(e(R),{onClick:ne},{default:r(()=>[t(v,{path:e(Re),width:"20"},null,8,["path"])]),_:1})]),_:1})):x("",!0),((z=b.value)==null?void 0:z.formState)==="idle"?(p(),g(e(q),{key:2,placement:"bottom"},{content:r(()=>[m("Start form")]),default:r(()=>[t(e(R),{onClick:oe},{default:r(()=>[t(v,{path:e(Ae),width:"20"},null,8,["path"])]),_:1})]),_:1})):x("",!0),t(e(w),{value:B.value,onClick:d},null,8,["value"])]}),_:1}),e(y)||!e(k)?(p(),g(e(ve),{key:1})):c.stageRunId||n.form.isInitial?(p(),j("div",Ve,[t(se,{ref_key:"runner",ref:b,form:s.form.makeRunnerData(e(k)),params:{...c.queryParams.reduce((h,{name:M,value:E})=>({...h,[M]:E}),{})},"is-preview":"","enable-auto-focus":"",broker:s.broker,onNavigate:P,onRedirect:S,onLogout:N,onExit:o},null,8,["form","params","broker"])])):(p(),g(e(Le),{key:3,message:"This form is an intermediate task within the workflow. Please select a thread to initiate the form.",type:"warning","show-icon":""}))]),_:1}),t(je,{open:l.value,close:$,state:c,"add-query-param":T,"remove-query-param":I},null,8,["open","state"])],64)}}});const Ge=ge(ze,[["__scopeId","data-v-bb8b7f30"]]),He=U({__name:"FormSettings",props:{form:{}},setup(i){const a=A(i.form);return(n,o)=>(p(),g(e(re),{layout:"vertical"},{default:r(()=>[t(he,{runtime:a.value},null,8,["runtime"]),t(e(_),{label:"Form name"},{default:r(()=>[t(e(w),{value:a.value.title,"onUpdate:value":o[0]||(o[0]=l=>a.value.title=l),type:"text",onChange:o[1]||(o[1]=l=>{var d;return a.value.title=(d=l.target.value)!=null?d:""})},null,8,["value"])]),_:1}),t(e(D),{level:3},{default:r(()=>[m(" Texts ")]),_:1}),t(e(D),{level:4},{default:r(()=>[m(" Welcome Screen ")]),_:1}),t(e(_),{label:"Title"},{default:r(()=>[t(e(w),{value:a.value.welcomeTitle,"onUpdate:value":o[2]||(o[2]=l=>a.value.welcomeTitle=l),type:"text",placeholder:a.value.title,disabled:a.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),t(e(_),{label:"Description"},{default:r(()=>[t(e(w),{value:a.value.startMessage,"onUpdate:value":o[3]||(o[3]=l=>a.value.startMessage=l),type:"text",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(_),{label:"Start button label"},{default:r(()=>[t(e(w),{value:a.value.startButtonText,"onUpdate:value":o[4]||(o[4]=l=>a.value.startButtonText=l),type:"text",placeholder:"Start",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(_),null,{default:r(()=>[t(e(G),{checked:a.value.autoStart,"onUpdate:checked":o[5]||(o[5]=l=>a.value.autoStart=l)},{default:r(()=>[m("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),t(e(D),{level:4},{default:r(()=>[m(" End Screen ")]),_:1}),t(e(_),{label:"End text"},{default:r(()=>[t(e(w),{value:a.value.endMessage,"onUpdate:value":o[6]||(o[6]=l=>a.value.endMessage=l),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),t(e(_),{label:"Restart button label"},{default:r(()=>[t(e(w),{value:a.value.restartButtonText,"onUpdate:value":o[7]||(o[7]=l=>a.value.restartButtonText=l),placeholder:"Restart",type:"text",disabled:!a.value.allowRestart},null,8,["value","disabled"])]),_:1}),t(e(_),null,{default:r(()=>[t(e(G),{checked:a.value.allowRestart,"onUpdate:checked":o[8]||(o[8]=l=>a.value.allowRestart=l)},{default:r(()=>[m("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),t(e(D),{level:4},{default:r(()=>[m(" Alert Messages ")]),_:1}),t(e(_),{label:"Error message"},{default:r(()=>[t(e(w),{value:a.value.errorMessage,"onUpdate:value":o[9]||(o[9]=l=>a.value.errorMessage=l),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),We={style:{width:"50%"}},Ye={style:{width:"50%"}},It=U({__name:"FormEditor",setup(i){const u=ee(),a=ye(),n=A(null),o=A("source-code");function l(){u.push({name:"home"})}const{result:d,refetch:$}=te(()=>Promise.all([ae.get(),xe.get(a.params.id)]).then(([f,P])=>be({workspace:f,form:P}))),B=f=>{!d.value||(d.value.form.file=f)},c=we.create(),O=C(()=>ue.create(a.params.id));function k(f,P){J("editor",u,f,P)}const y=A(null),T=()=>{var f;(f=y.value)==null||f.restartEditor()},I=()=>{var f;u.push({name:"formPreview",query:a.query,params:{id:(f=d.value)==null?void 0:f.form.id}})};return Z(()=>a.params.id,()=>{$()}),(f,P)=>(p(),g(Se,null,{navbar:r(()=>[e(d)?(p(),g(e(Ue),{key:0,title:e(d).form.title,style:{padding:"5px 25px"},onBack:l},{extra:r(()=>[t(Pe,{"docs-path":"forms/overview","show-v-s-code-button":"","show-save-button":!1,"editing-model":e(d).form},null,8,["editing-model"])]),_:1},8,["title"])):x("",!0)]),content:r(()=>[e(d)?(p(),g(e(L),{key:0,gap:"40",style:{width:"calc(100% - 80px)"}},{default:r(()=>[H("div",We,[t(e(Be),{"active-key":o.value,"onUpdate:activeKey":P[0]||(P[0]=S=>o.value=S)},{rightExtra:r(()=>[t($e,{model:e(d).form},null,8,["model"])]),default:r(()=>[t(e(Y),{key:"source-code",tab:"Source code"}),t(e(Y),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"]),o.value==="source-code"?(p(),g(_e,{key:0,ref_key:"code",ref:y,script:e(d).form,workspace:e(d).workspace,broker:O.value,onUpdateFile:B},null,8,["script","workspace","broker"])):x("",!0),o.value==="settings"?(p(),g(He,{key:1,form:e(d).form},null,8,["form"])):x("",!0)]),H("div",Ye,[t(e(L),{justify:"space-between"},{default:r(()=>[t(e(L),{align:"center",gap:"large",style:{margin:"10px 0 24px 0"}},{default:r(()=>{var S,b;return[t(e(D),{level:4,style:{margin:"0"}},{default:r(()=>[m("Form preview")]),_:1}),((b=(S=n.value)==null?void 0:S.runner)==null?void 0:b.formState)==="running"?(p(),g(e(Oe),{key:0,color:"green"},{default:r(()=>[m(" Running ")]),_:1})):x("",!0)]}),_:1}),t(e(L),{gap:"8",align:"center",style:{height:"fit-content","margin-top":"10px"}},{default:r(()=>[t(Ne,{path:e(d).form.path},null,8,["path"]),t(e(R),{target:"_blank",onClick:I},{icon:r(()=>[t(e(De))]),default:r(()=>[m(" Preview ")]),_:1})]),_:1})]),_:1}),t(Ge,{ref_key:"tester",ref:n,form:e(d).form,"log-service":e(c),broker:O.value,onRedirect:k,onExit:T},null,8,["form","log-service","broker"])])]),_:1})):x("",!0)]),footer:r(()=>{var S;return[t(ke,{runtime:"forms","log-service":e(c),onRestart:(S=n.value)==null?void 0:S.restart},null,8,["log-service","onRestart"])]}),_:1}))}});export{It as default};
//# sourceMappingURL=FormEditor.1eadb033.js.map

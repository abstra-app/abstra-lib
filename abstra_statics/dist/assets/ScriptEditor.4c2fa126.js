import{L as C}from"./tasksController.dca0b287.js";import{d as _,af as y,g,o as u,K as f,O as M,F as $,e5 as x,a as v,f as k,c as V,w as d,b as l,u as s,bE as T,cs as H,cr as S,J as B,da as A,au as I,bM as N,Q as P,e4 as R,er as D}from"./index.49275017.js";import{a as W}from"./asyncComputed.a51bf974.js";import"./linters.c5d6ec1b.js";import{S as z}from"./scripts.69b5a6c7.js";import{W as E}from"./workspaces.224a346a.js";import{R as F,_ as O}from"./RuntimeCommonSettings.93483baa.js";import{_ as j}from"./RunButton.vue_vue_type_script_setup_true_lang.88c4316a.js";import"./gateway.9b96d4d6.js";import"./popupNotifcation.3657e2c7.js";import"./polling.a8fab692.js";import"./string.d132476b.js";import"./record.c21db489.js";import"./runnerData.e55185aa.js";import"./url.6addbd8d.js";import"./colorHelpers.3639a500.js";import"./BaseLayout.abaf6f96.js";import"./SaveButton.41e854e9.js";import"./UnsavedChangesHandler.05dbb608.js";import"./ExclamationCircleOutlined.7530a509.js";import"./omniChatStore.81f6980b.js";import"./OmniChat.a7739bb4.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.c260489e.js";import"./Logo.4c9ee58e.js";import"./uuid.ef9a892e.js";import"./PhClockCounterClockwise.vue.b9be1e85.js";import"./LoadingOutlined.70c6b4de.js";import"./columns.6053e21e.js";import"./controller.213ffa35.js";import"./index.04a5e019.js";import"./validations.9287690c.js";import"./metadata.1cc8f64c.js";import"./PhWebhooksLogo.vue.3c3ac317.js";import"./controller.6a99cd52.js";import"./fetch.89ed327f.js";import"./PhPencil.vue.c30063a2.js";import"./project.b13f0f28.js";import"./requirements.1bd4f0ac.js";import"./object.e31e9e24.js";import"./PhCopySimple.vue.bfc69784.js";import"./index.2b076a73.js";import"./CollapsePanel.44b0a2c7.js";import"./Avatar.950481b5.js";import"./Navbar.57baeb30.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.549625b5.js";import"./PhArrowCounterClockwise.vue.6475c51b.js";import"./PhFilePy.vue.243db404.js";import"./PhChats.vue.26ca5f52.js";import"./PhRocket.vue.0c474cd0.js";import"./PhPackage.vue.3ba68ecc.js";import"./userStore.761f0709.js";import"./PhArrowSquareOut.vue.7ed18bc8.js";import"./PhDotsThree.vue.41cee5e0.js";import"./PhSignOut.vue.08c07ebd.js";import"./PhSparkle.vue.9336089e.js";import"./editor.85fba5a0.js";import"./workspaceStore.c4d9319b.js";import"./index.557de3ce.js";import"./CloseCircleOutlined.1ad7a0fa.js";import"./CheckCircleFilled.47672cc2.js";import"./index.193baac0.js";import"./SourceCode.f13660de.js";import"./PhFolder.vue.5a90b21d.js";import"./toggleHighContrast.0c2c4e44.js";import"./Card.66d56924.js";import"./TabPane.988273c8.js";import"./TasksManager.ee15ac9f.js";import"./ant-design.7f6f3779.js";import"./index.24bcee7a.js";import"./PhCaretRight.vue.8d089638.js";import"./Badge.78fc29b9.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new Error().stack;r&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[r]="43c493d8-000b-4e47-8053-c3256b40952b",m._sentryDebugIdIdentifier="sentry-dbid-43c493d8-000b-4e47-8053-c3256b40952b")}catch{}})();const q=["width","height","fill","transform"],J={key:0},U=v("path",{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},null,-1),G=[U],K={key:1},Q=v("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),X=v("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V76.69L62.63,62.06A95.43,95.43,0,0,1,130,33.94h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.56,79.56,0,0,0,73.94,73.37L59.31,88H88a8,8,0,0,1,0,16Zm128,48H168a8,8,0,0,0,0,16h28.69l-14.63,14.63a79.56,79.56,0,0,1-56.13,23.43h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.43,95.43,0,0,0,67.36-28.12L208,179.31V208a8,8,0,0,0,16,0V160A8,8,0,0,0,216,152Z"},null,-1),Y=[Q,X],t0={key:2},e0=v("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,13.66-5.66L64,60.7a95.42,95.42,0,0,1,66-26.76h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.48,79.48,0,0,0,75.35,72L93.66,90.34A8,8,0,0,1,88,104Zm128,48H168a8,8,0,0,0-5.66,13.66L180.65,184a79.48,79.48,0,0,1-54.72,22.09h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.42,95.42,0,0,0,66-26.76l18.36,18.36A8,8,0,0,0,224,208V160A8,8,0,0,0,216,152Z"},null,-1),a0=[e0],r0={key:3},s0=v("path",{d:"M88,102H40a6,6,0,0,1-6-6V48a6,6,0,0,1,12,0V81.52l18-18a93.45,93.45,0,0,1,66-27.53h.52A93.39,93.39,0,0,1,196.19,62.7a6,6,0,0,1-8.38,8.58A82,82,0,0,0,72.53,72L54.48,90H88a6,6,0,0,1,0,12Zm128,52H168a6,6,0,0,0,0,12h33.52l-18.05,18a81.51,81.51,0,0,1-57.53,24h-.46a81.5,81.5,0,0,1-57.29-23.34,6,6,0,0,0-8.38,8.58,93.39,93.39,0,0,0,65.67,26.76H126a93.45,93.45,0,0,0,66-27.53l18-18.05V208a6,6,0,0,0,12,0V160A6,6,0,0,0,216,154Z"},null,-1),o0=[s0],i0={key:4},l0=v("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V76.69L62.63,62.06A95.43,95.43,0,0,1,130,33.94h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.56,79.56,0,0,0,73.94,73.37L59.31,88H88a8,8,0,0,1,0,16Zm128,48H168a8,8,0,0,0,0,16h28.69l-14.63,14.63a79.56,79.56,0,0,1-56.13,23.43h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.43,95.43,0,0,0,67.36-28.12L208,179.31V208a8,8,0,0,0,16,0V160A8,8,0,0,0,216,152Z"},null,-1),n0=[l0],p0={key:5},m0=v("path",{d:"M88,100H40a4,4,0,0,1-4-4V48a4,4,0,0,1,8,0V86.34L65.46,64.89A91.39,91.39,0,0,1,130,37.94h.51A91.43,91.43,0,0,1,194.8,64.13a4,4,0,0,1-5.6,5.72,83.44,83.44,0,0,0-58.68-23.91h-.47a83.52,83.52,0,0,0-58.94,24.6L49.66,92H88a4,4,0,0,1,0,8Zm128,56H168a4,4,0,0,0,0,8h38.34l-21.45,21.46A83.52,83.52,0,0,1,126,210.06h-.47A83.44,83.44,0,0,1,66.8,186.15a4,4,0,0,0-5.6,5.72,91.43,91.43,0,0,0,64.28,26.19H126a91.39,91.39,0,0,0,64.55-26.95L212,169.66V208a4,4,0,0,0,8,0V160A4,4,0,0,0,216,156Z"},null,-1),u0=[m0],c0={name:"PhArrowsCounterClockwise"},d0=_({...c0,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(m){const r=m,o=y("weight","regular"),h=y("size","1em"),n=y("color","currentColor"),c=y("mirrored",!1),a=g(()=>{var e;return(e=r.weight)!=null?e:o}),p=g(()=>{var e;return(e=r.size)!=null?e:h}),t=g(()=>{var e;return(e=r.color)!=null?e:n}),i=g(()=>r.mirrored!==void 0?r.mirrored?"scale(-1, 1)":void 0:c?"scale(-1, 1)":void 0);return(e,b)=>(u(),f("svg",x({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:p.value,height:p.value,fill:t.value,transform:i.value},e.$attrs),[M(e.$slots,"default"),a.value==="bold"?(u(),f("g",J,G)):a.value==="duotone"?(u(),f("g",K,Y)):a.value==="fill"?(u(),f("g",t0,a0)):a.value==="light"?(u(),f("g",r0,o0)):a.value==="regular"?(u(),f("g",i0,n0)):a.value==="thin"?(u(),f("g",p0,u0)):$("",!0)],16,q))}}),f0=_({__name:"ScriptSettings",props:{script:{}},setup(m){const o=k(m.script);return(h,n)=>(u(),V(s(S),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:d(()=>[l(s(H),{label:"Name",required:""},{default:d(()=>[l(s(T),{value:o.value.title,"onUpdate:value":n[0]||(n[0]=c=>o.value.title=c)},null,8,["value"])]),_:1}),l(F,{runtime:o.value},null,8,["runtime"])]),_:1}))}}),g0={style:{width:"100%",display:"flex","flex-direction":"column"}},v0=_({__name:"ScriptTester",props:{script:{},disabledWarning:{},tasks:{}},emits:["refetch-tasks"],setup(m,{emit:r}){const o=m,h=g(()=>{var t,i;return(i=(t=o.tasks)==null?void 0:t.map(e=>{const b=e.payload,w=JSON.stringify(b,null,2),L=w.length>80?w.slice(0,80)+"...":w,Z=new Date(e.created.at).toLocaleString();return{label:`${L} - ${Z}`,value:e.id}}))!=null?i:[]}),n=k(void 0),c=g(()=>n.value?null:{title:"No trigger task selected",message:"Please select the task that will trigger the script"}),a=k(!1),p=async()=>{var t;a.value=!0;try{await o.script.run((t=n.value)!=null?t:null)}finally{a.value=!1,n.value=void 0,r("refetch-tasks",o.script.id)}};return B(()=>{r("refetch-tasks",o.script.id)}),(t,i)=>(u(),f("div",g0,[l(s(S),{layout:"vertical",style:{overflow:"auto"}},{default:d(()=>[l(s(H),{label:"Trigger task"},{default:d(()=>[l(s(A),{gap:"small",class:"container"},{default:d(()=>[l(s(I),{options:h.value,value:n.value,onSelect:i[0]||(i[0]=e=>n.value=e)},null,8,["options","value"]),l(s(N),{onClick:i[1]||(i[1]=e=>r("refetch-tasks",t.script.id))},{default:d(()=>[l(s(A),null,{default:d(()=>[l(s(d0),{size:16})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(j,{loading:a.value,disabled:t.disabledWarning||c.value,onClick:p,onSave:i[2]||(i[2]=e=>t.script.save())},null,8,["loading","disabled"])]))}});const h0=P(v0,[["__scopeId","data-v-f14e4635"]]),Nt=_({__name:"ScriptEditor",setup(m){const r=R(),o=k(null),h=new C,n=g(()=>{var p;return(p=a.value)!=null&&p.script.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),c=async p=>{const t=await h.getStageTasks(p);o.value=t.tasks.filter(i=>i.status==="pending")},{result:a}=W(async()=>{const[p,t]=await Promise.all([E.get(),z.get(r.params.id)]);return c(t.id),D({workspace:p,script:t})});return(p,t)=>(u(),V(O,{stage:s(a).script,workspace:s(a).workspace,"stage-type":"scripts",onRefetchTasks:t[0]||(t[0]=i=>c(s(a).script.id))},{settings:d(()=>[l(f0,{script:s(a).script},null,8,["script"])]),test:d(()=>[l(h0,{ref:"tester",script:s(a).script,"disabled-warning":n.value,tasks:o.value,onRefetchTasks:c},null,8,["script","disabled-warning","tasks"])]),_:1},8,["stage","workspace"]))}});export{Nt as default};
//# sourceMappingURL=ScriptEditor.4c2fa126.js.map

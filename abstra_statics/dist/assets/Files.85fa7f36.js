import{_ as ie}from"./DocsButton.vue_vue_type_script_setup_true_lang.c0751fca.js";import{C as se}from"./ContentLayout.fd58a72b.js";import{f as c,e6 as $,f5 as ue,f6 as ce,d as re,c as B,r as Q,o as f,a4 as z,u as s,cA as de,b as p,a as m,e as E,g,ea as J,h as y,d6 as ae,bQ as U,cq as fe,db as pe,ee as me,bO as he,eg as ye,bw as ve,bv as C,a6 as oe,d0 as ge,cu as be,H as N,_ as le,ec as Oe,A as we,eu as _e,ev as Pe}from"./jwt-decode.esm.ea959866.js";import{j as k,p as Fe}from"./router.1aba945d.js";import{a as je}from"./ant-design.f70d2cff.js";import{a as Ce,D as ke,G as $e,I as De,_ as Ae,f as V,s as Ie}from"./ScrollArea.vue_vue_type_script_setup_true_lang.9146e977.js";import{f as W}from"./string.07f8f578.js";import{G as Se}from"./PhFolder.vue.91c2446b.js";import{a as ze}from"./asyncComputed.51381bdd.js";import"./tables.7de2b283.js";import"./constants.6ec7c497.js";import"./record.c2cb775d.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="f3d07195-4573-4770-8352-e77ffa1a02db",a._sentryDebugIdIdentifier="sentry-dbid-f3d07195-4573-4770-8352-e77ffa1a02db")}catch{}})();var Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"};const Ee=Ne;var Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"};const Ue=Me;var Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const Be=Ve;function X(a){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){Re(a,u,n[u])})}return a}function Re(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}var R=function(e,n){var l=X({},e,n.attrs);return c($,X({},l,{icon:ue}),null)};R.displayName="DeleteOutlined";R.inheritAttrs=!1;const He=R;function Y(a){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){Ge(a,u,n[u])})}return a}function Ge(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}var H=function(e,n){var l=Y({},e,n.attrs);return c($,Y({},l,{icon:ce}),null)};H.displayName="EditOutlined";H.inheritAttrs=!1;const Le=H;function Z(a){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){Te(a,u,n[u])})}return a}function Te(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}var G=function(e,n){var l=Z({},e,n.attrs);return c($,Z({},l,{icon:Ee}),null)};G.displayName="FileAddOutlined";G.inheritAttrs=!1;const K=G;function ee(a){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){xe(a,u,n[u])})}return a}function xe(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}var L=function(e,n){var l=ee({},e,n.attrs);return c($,ee({},l,{icon:Ue}),null)};L.displayName="FolderAddOutlined";L.inheritAttrs=!1;const qe=L;function te(a){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){Qe(a,u,n[u])})}return a}function Qe(a,e,n){return e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}var T=function(e,n){var l=te({},e,n.attrs);return c($,te({},l,{icon:Be}),null)};T.displayName="UploadOutlined";T.inheritAttrs=!1;const ne=T;class x{constructor(e){this.projectId=e}static fromProjectId(e){return new x(e)}async list(){return k.get(`projects/${this.projectId}/files`)}async upload(e,n){const l={"Content-Type":"multipart/form-data"},u=new File([new Blob(n?[n]:[])],Ce(e));return k.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e)}`,u,l)}async download(e){return k.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return k.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,n){return k.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(n)}`,{})}}const Je={class:"files-navigator"},We={key:0},Xe={key:1},Ye={key:0,class:"file-size"},Ze=re({__name:"FilesNavigator",props:{files:{},loading:{type:Boolean},onCreate:{type:Function},onDownload:{type:Function},onDelete:{type:Function},onRefetch:{type:Function},onRename:{type:Function},onOpen:{type:Function},onMkdir:{type:Function},separator:{}},setup(a){const e=a,n=t=>r=>{var o,i;return{key:r.pathParts.join(e.separator),title:t.keepFullPath?r.pathParts.join(e.separator):V(r.pathParts),isLeaf:r.type==="file",file:r,children:t.keepFullPath?void 0:(i=(o=r.children)==null?void 0:o.map(d=>{var j;const F=(j=e.files)==null?void 0:j.find(S=>S.pathParts.join(e.separator)===d.join(e.separator));if(!F)throw new Error("Child node not found");return n({keepFullPath:t.keepFullPath})(F)}))!=null?i:[]}},l=t=>{if(!w.value.trim())return N("span",t);const r=W(w.value,t);return r?N("span",t.split("").map((o,i)=>r.includes(i)?N("span",{class:"char-match"},o):o)):N("span",t)},u=t=>{if(t.type==="directory")return"";const r=t.size;if(r<1024)return`${r} B`;const o=r/1024;if(o<1024)return`${o.toFixed(2)} KB`;const i=o/1024;return i<1024?`${i.toFixed(2)} MB`:`${(i/1024).toFixed(2)} GB`},O=B(()=>{var t,r;return w.value.trim()?(t=e.files)==null?void 0:t.filter(o=>o.pathParts.length===1&&W(w.value,o.pathParts.join(e.separator))).map(n({keepFullPath:!0})):(r=e.files)==null?void 0:r.filter(o=>o.pathParts.length===1).map(n({keepFullPath:!1}))}),P=t=>{var r,o;return t.isLeaf?1:(o=(r=t.children)==null?void 0:r.reduce((i,d)=>i+P(d),0))!=null?o:0},_=B(()=>O.value?O==null?void 0:O.value.reduce((t,r)=>t+P(r),0):0),D=Q(!1);function A(t){if(t&&t.type==="file")return;const r=document.createElement("input");r.type="file",r.onchange=async()=>{var d,F,j,S,q;const o=(d=r.files)==null?void 0:d[0],i=await(o==null?void 0:o.arrayBuffer());if(!!o)try{D.value=!0,await((S=e.onCreate)==null?void 0:S.call(e,[...(F=t==null?void 0:t.pathParts)!=null?F:[],(j=o.name)!=null?j:"Untitled file"],i?new Uint8Array(i):void 0)),await((q=e.onRefetch)==null?void 0:q.call(e))}catch{Fe("Failed to upload file","File already exists")}finally{D.value=!1}},r.click()}function I(t){var i;if(t&&t.type==="file")return;const r=prompt("Enter the name of the new file");if(!r)return;const o=t?[...t.pathParts,r]:[r];(i=e.onCreate)==null||i.call(e,o)}async function M(t){if(!t||!e.onDownload)return;const r=await e.onDownload(t.pathParts),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=V(t.pathParts),o.click()}async function b(t){var o,i;if(!t)return;const r="Are you sure you want to delete this "+(t.type==="file"?"file":"directory and all its contents")+"?";await je(r)&&(await((o=e.onDelete)==null?void 0:o.call(e,t.pathParts)),await((i=e.onRefetch)==null?void 0:i.call(e)))}async function v(t){var i,d;if(!t)return;const r=prompt("Enter the new name of the file",V(t.pathParts));if(!r)return;const o=[...t.pathParts.slice(0,-1),r];await((i=e.onRename)==null?void 0:i.call(e,t.pathParts,o)),await((d=e.onRefetch)==null?void 0:d.call(e))}async function h(t){var i;if(t&&t.type==="file")return;const r=prompt("Enter the name of the new folder");if(!r)return;const o=t?[...t.pathParts,r]:[r];(i=e.onMkdir)==null||i.call(e,o)}const w=Q("");return(t,r)=>(f(),z("div",Je,[c(s(de),{value:w.value,"onUpdate:value":r[0]||(r[0]=o=>w.value=o),loading:e.loading,placeholder:"Search files"},null,8,["value","loading"]),c(s(pe),{justify:"space-between"},{default:p(()=>[_.value>0?(f(),m(s(ae),{key:0},{default:p(()=>[E("b",null,[g(J(_.value)+" File",1),_.value!==1?(f(),z("span",We,"s")):y("",!0),w.value?(f(),z("span",Xe," found ")):y("",!0)])]),_:1})):y("",!0),t.loading?y("",!0):(f(),m(s(fe),{key:1},{default:p(()=>[t.onCreate?(f(),m(s(U),{key:0,onClick:r[1]||(r[1]=()=>I())},{default:p(()=>[c(s(K)),g(" New File ")]),_:1})):y("",!0),t.onCreate?(f(),m(s(U),{key:1,onClick:r[2]||(r[2]=()=>A())},{default:p(()=>[c(s(ne)),g(" Upload ")]),_:1})):y("",!0),t.onMkdir?(f(),m(s(U),{key:2,onClick:r[3]||(r[3]=()=>h())},{default:p(()=>[c(s(qe)),g(" New Folder ")]),_:1})):y("",!0)]),_:1}))]),_:1}),c(Ae,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:p(()=>[O.value&&O.value.length>0?(f(),m(s(ge),{key:0,class:"files-tree","tree-data":O.value,selectable:"",onSelect:r[5]||(r[5]=(o,{node:{file:i}})=>{var d;return(d=e.onOpen)==null?void 0:d.call(e,i.pathParts)})},{title:p(({title:o,isLeaf:i,file:d})=>[E("span",null,[(f(),m(me(l(o)))),i?(f(),z("span",Ye,"("+J(u(d))+")",1)):y("",!0)]),c(s(he),{onClick:r[4]||(r[4]=ye(()=>{},["stop"]))},{overlay:p(()=>[c(s(ve),{disabled:t.loading},{default:p(()=>[i&&t.onDownload?(f(),m(s(C),{key:0,onClick:()=>M(d)},{default:p(()=>[c(s(ke)),g(" Download ")]),_:2},1032,["onClick"])):y("",!0),t.onRename?(f(),m(s(C),{key:1,onClick:()=>v(d)},{default:p(()=>[c(s(Le)),g(" Rename ")]),_:2},1032,["onClick"])):y("",!0),!i&&t.onCreate?(f(),m(s(C),{key:2,onClick:()=>I(d)},{default:p(()=>[c(s(K)),g(" New File ")]),_:2},1032,["onClick"])):y("",!0),t.onCreate?(f(),m(s(C),{key:3,loading:t.loading,onClick:()=>A(d)},{default:p(()=>[c(s(ne)),g(" Upload ")]),_:2},1032,["loading","onClick"])):y("",!0),t.onDelete?(f(),m(s(C),{key:4,danger:"",onClick:()=>b(d)},{default:p(()=>[c(s(He)),g(" Delete ")]),_:2},1032,["onClick"])):y("",!0)]),_:2},1032,["disabled"])]),default:p(()=>[c(s($e),{style:{cursor:"pointer",float:"inline-end"},size:"25px"})]),_:2},1024)]),icon:p(({file:o})=>[oe(t.$slots,"icon",{file:o},()=>[o.type==="directory"?(f(),m(s(Se),{key:0})):(f(),m(s(De),{key:1}))],!0)]),_:3},8,["tree-data"])):(f(),m(s(be),{key:1,description:t.loading?"Loading...":"No files"},null,8,["description"]))]),_:3})]))}});const Ke=le(Ze,[["__scopeId","data-v-e1f4fc13"]]),et=a=>(_e("data-v-4b0cf5fc"),a=a(),Pe(),a),tt={class:"files-layout"},nt=et(()=>E("br",null,null,-1)),rt=re({__name:"Files",setup(a){const n=Oe().params.projectId,l=x.fromProjectId(n),{loading:u,result:O,refetch:P}=ze(()=>l.list()),_=b=>b.reduce((v,h)=>{var r,o;const w=h.type==="file"?[]:(o=(r=h.children)==null?void 0:r.map(i=>i.path.split("/")))!=null?o:[],t={pathParts:h.path.split("/"),size:h.type==="file"?Ie(h.size):0,lastModified:h.date,type:h.type,children:w};if(v.push(t),h.type==="directory"&&h.children&&h.children.length>0){const i=_(h.children);v.push(...i)}return v},[]),D=B(()=>O.value?_(O.value):[]);async function A(b,v){const h=b.join("/");await l.upload(h,v),await P()}function I(b){const v=b.join("/");return l.download(v)}function M(b){const v=b.join("/");return l.delete(v)}return(b,v)=>(f(),m(se,null,{default:p(()=>[E("div",tt,[c(s(we),null,{default:p(()=>[g("Files")]),_:1}),c(s(ae),null,{default:p(()=>[g(" Here you can upload, download and delete files in your persistent dir."),nt,g(" Files can be used in your scripts. "),c(ie,{path:"tools/files"}),oe(b.$slots,"description",{},void 0,!0)]),_:3}),c(Ke,{files:D.value,loading:s(u),separator:"/",onCreate:A,onDownload:I,onDelete:M,onRefetch:s(P)},null,8,["files","loading","onRefetch"])])]),_:3}))}});const vt=le(rt,[["__scopeId","data-v-4b0cf5fc"]]);export{vt as default};
//# sourceMappingURL=Files.85fa7f36.js.map

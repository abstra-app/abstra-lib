import{f as o,eG as w,d as J,b as f,c as m,w as i,eS as Z,ar as F,eD as y,u as l,b3 as K,ev as A,cN as ee,ez as te,v as ae,r as j,J as L,H as T,eB as re,G as ne,eL as le,a as oe,f7 as se,eK as ie,ae as z,cr as ue,bv as ce,cF as E,eC as de,a$ as fe,bS as pe,cn as me}from"./outputWidgets.c849273f.js";import{t as ve}from"./ant-design.b086c804.js";import{S as ge}from"./StarFilled.fad29e50.js";import{A as be,T as ye}from"./Timeline.c30585cb.js";import{C as he}from"./CheckCircleFilled.3ded642b.js";import{C as R,a as M,A as _}from"./router.26178a94.js";import{B as Oe}from"./build.e6f6361c.js";import"./index.310e3dd2.js";import{a as we}from"./asyncComputed.53ec0023.js";import{A as _e}from"./Title.c7ac8182.js";import{A as Ae}from"./index.df190dd4.js";import{A as h}from"./FormItem.8767aead.js";import{R as Se}from"./dayjs.7ab3d6ca.js";import{F as Pe}from"./Form.5ae0aee9.js";import"./index.b316b415.js";import"./Modal.37c66109.js";import"./index.cf4c23b9.js";import"./record.7386625d.js";import"./pubsub.4b8cd066.js";import"./Base.f58dc0d7.js";import"./Typography.69f3ca41.js";import"./hasIn.a09870a7.js";import"./index.a37256cb.js";import"./index.9b701101.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="53c7de43-cb90-495a-822a-af6a263056c5",a._sentryDebugIdIdentifier="sentry-dbid-53c7de43-cb90-495a-822a-af6a263056c5")}catch{}})();var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 244c176.18 0 319 142.82 319 319v233a32 32 0 01-32 32H225a32 32 0 01-32-32V563c0-176.18 142.82-319 319-319zM484 68h56a8 8 0 018 8v96a8 8 0 01-8 8h-56a8 8 0 01-8-8V76a8 8 0 018-8zM177.25 191.66a8 8 0 0111.32 0l67.88 67.88a8 8 0 010 11.31l-39.6 39.6a8 8 0 01-11.31 0l-67.88-67.88a8 8 0 010-11.31l39.6-39.6zm669.6 0l39.6 39.6a8 8 0 010 11.3l-67.88 67.9a8 8 0 01-11.32 0l-39.6-39.6a8 8 0 010-11.32l67.89-67.88a8 8 0 0111.31 0zM192 892h640a32 32 0 0132 32v24a8 8 0 01-8 8H168a8 8 0 01-8-8v-24a32 32 0 0132-32zm148-317v253h64V575h-64z"}}]},name:"alert",theme:"filled"};const $e=Ce;var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM513.1 518.1l-192 161c-5.2 4.4-13.1.7-13.1-6.1v-62.7c0-2.3 1.1-4.6 2.9-6.1L420.7 512l-109.8-92.2a7.63 7.63 0 01-2.9-6.1V351c0-6.8 7.9-10.5 13.1-6.1l192 160.9c3.9 3.2 3.9 9.1 0 12.3zM716 673c0 4.4-3.4 8-7.5 8h-185c-4.1 0-7.5-3.6-7.5-8v-48c0-4.4 3.4-8 7.5-8h185c4.1 0 7.5 3.6 7.5 8v48z"}}]},name:"code",theme:"filled"};const ze=je;var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}},{tag:"path",attrs:{d:"M894 345a343.92 343.92 0 00-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4a31.95 31.95 0 0040.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10 1 104-98-33-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1A367.31 367.31 0 00729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62 72.6 99.6 68.5 235.2-8 330z"}},{tag:"path",attrs:{d:"M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}}]},name:"comment",theme:"outlined"};const Ie=Fe;var De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M705.6 124.9a8 8 0 00-11.6 7.2v64.2c0 5.5 2.9 10.6 7.5 13.6a352.2 352.2 0 0162.2 49.8c32.7 32.8 58.4 70.9 76.3 113.3a355 355 0 0127.9 138.7c0 48.1-9.4 94.8-27.9 138.7a355.92 355.92 0 01-76.3 113.3 353.06 353.06 0 01-113.2 76.4c-43.8 18.6-90.5 28-138.5 28s-94.7-9.4-138.5-28a353.06 353.06 0 01-113.2-76.4A355.92 355.92 0 01184 650.4a355 355 0 01-27.9-138.7c0-48.1 9.4-94.8 27.9-138.7 17.9-42.4 43.6-80.5 76.3-113.3 19-19 39.8-35.6 62.2-49.8 4.7-2.9 7.5-8.1 7.5-13.6V132c0-6-6.3-9.8-11.6-7.2C178.5 195.2 82 339.3 80 506.3 77.2 745.1 272.5 943.5 511.2 944c239 .5 432.8-193.3 432.8-432.4 0-169.2-97-315.7-238.4-386.7zM480 560h64c4.4 0 8-3.6 8-8V88c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v464c0 4.4 3.6 8 8 8z"}}]},name:"poweroff",theme:"outlined"};const xe=De;function V(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(n){Be(a,n,t[n])})}return a}function Be(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var I=function(e,t){var r=V({},e,t.attrs);return o(w,V({},r,{icon:$e}),null)};I.displayName="AlertFilled";I.inheritAttrs=!1;const Ne=I;function k(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(n){Le(a,n,t[n])})}return a}function Le(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var D=function(e,t){var r=k({},e,t.attrs);return o(w,k({},r,{icon:ze}),null)};D.displayName="CodeFilled";D.inheritAttrs=!1;const Te=D;function U(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(n){Ee(a,n,t[n])})}return a}function Ee(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var x=function(e,t){var r=U({},e,t.attrs);return o(w,U({},r,{icon:Ie}),null)};x.displayName="CommentOutlined";x.inheritAttrs=!1;const Re=x;function q(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(n){Me(a,n,t[n])})}return a}function Me(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var B=function(e,t){var r=q({},e,t.attrs);return o(w,q({},r,{icon:xe}),null)};B.displayName="PoweroffOutlined";B.inheritAttrs=!1;const Ve=B;function G(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.forEach(function(n){ke(a,n,t[n])})}return a}function ke(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var N=function(e,t){var r=G({},e,t.attrs);return o(w,G({},r,{icon:ge}),null)};N.displayName="StarFilled";N.inheritAttrs=!1;const Ue=N;class qe{list({projectId:e,buildId:t,...r}){return R.post(`projects/${e}/builds/${t}/logs`,r)}filters(e){return R.get(`projects/${e}/log-filters`)}}const H=new qe;class O{constructor(e,t,r,n,b,S,u){this.executionId=e,this.runtimeType=t,this.runtimeName=r,this.payload=n,this.event=b,this.buildId=S,this.createdAt=u}static fromDTO(e){return new O(e.executionId,e.runtimeType,e.runtimeName,e.payload,e.event,e.buildId,new Date(e.createdAt))}static async list(e){const t=await H.list(e);return{total:t.total,logs:t.logs.map(O.fromDTO)}}static async filters(e){return H.filters(e)}get displayPayload(){return this.event==="start"?"Start":this.event==="end"?"End":this.event==="stdout"?this.payload.log:this.event==="stderr"?this.payload.log:JSON.stringify(this.payload)}get execId(){return this.executionId.slice(0,8)}}const Ge=["textContent"],He=["textContent"],Je=["textContent"],Ye=J({__name:"LegacyLogEntry",props:{log:{}},setup(a){const e=a;function t(){switch(e.log.event){case"stdout":case"stderr":return Te;case"success":return he;case"start":case"started":return Ue;case"form-response":return Re;case"program:end":case"failed":case"connection-closed":case"error":return Ve;default:return Ne}}return(r,n)=>(f(),m(l(be),{class:te(["log",r.log.event])},{dot:i(()=>[o(l(K),null,{default:i(()=>[(f(),m(Z(t())))]),title:i(()=>[F("["+y(r.log.event)+"] "+y(r.log.createdAt),1)]),_:1})]),default:i(()=>[r.log.event==="stdout"?(f(),A("pre",{key:0,class:"stdio-log",textContent:y(r.log.payload.text)},null,8,Ge)):r.log.event==="stderr"?(f(),A("pre",{key:1,class:"stdio-log",textContent:y(r.log.payload.text)},null,8,He)):r.log.event==="unhandled-exception"?(f(),A("pre",{key:2,class:"stdio-log",textContent:y(r.log.payload.text)},null,8,Je)):(f(),m(l(ee),{key:3,"tree-data":l(ve)(r.log.payload)},null,8,["tree-data"]))]),_:1},8,["class"]))}});const Qe=ae(Ye,[["__scopeId","data-v-b5c4b3ed"]]),Ot=J({__name:"LegacyLogs",setup(a){const e=j(1),t=j(10);L([e,t],([c,s])=>{e.value=c,t.value=s,C()});const r=T(()=>{var c,s;return{runtimes:(c=v.value)==null?void 0:c.filters.runtimes.map(({runtimeName:p,runtimeType:g})=>({label:`[${g}] ${p}`,value:p})),events:(s=v.value)==null?void 0:s.filters.events.map(p=>({label:`[${p.runtimeType}] ${p.event}`,value:p.event}))}}),n=re(),b=n.params.projectId;function S(){const c=[];return typeof n.query.runtimeId=="string"&&c.push(n.query.runtimeId),typeof n.query.runtimeTitle=="string"&&c.push(n.query.runtimeTitle),c}const u=ne({selectedBuild:n.query.buildId||"latest",dateRange:void 0,search:"",runtimeNames:S(),events:[]}),Y=le.exports.debounce(async()=>{await C(),P.value=!1},500),P=j(!1);L(u,()=>{P.value=!0,e.value=1,Y()});const Q=T(()=>v.value?[{label:"Latest",value:"latest"},{label:"All",value:"all"},...v.value.builds.map(c=>({label:`${se(c.createdAt)} (${c.id.slice(0,8)})`,value:c.id}))]:[{label:"Latest",value:"latest"},{label:"All",value:"all"}]),W=c=>{u.selectedBuild=c,C()},{loading:X,result:v,refetch:C}=we(()=>{var c,s;return Promise.all([O.list({projectId:b,limit:t.value,offset:(e.value-1)*t.value,buildId:u.selectedBuild,from:(c=u.dateRange)==null?void 0:c[0].toDate(),to:(s=u.dateRange)==null?void 0:s[1].toDate(),search:u.search,executionIds:[],runtimeNames:u.runtimeNames,events:u.events}),Oe.list(b),O.filters(b)]).then(([{total:p,logs:g},d,$])=>ie({total:p,logs:g,builds:d,filters:$}))});return(c,s)=>{const p=oe("router-link");return f(),m(l(E),{direction:"vertical"},{default:i(()=>{var g;return[o(l(_e),null,{default:i(()=>[F("Logs")]),_:1}),o(l(Ae),{message:"You're viewing logs from abstra versions prior to 1.27.0. Please upgrade to use the improved experience.",type:"warning","show-icon":""},{action:i(()=>[o(p,{to:{name:"logs"}},{default:i(()=>[F("Go back to new logs")]),_:1})]),_:1}),o(l(Pe),{layout:"vertical"},{default:i(()=>[o(l(M),{gutter:10},{default:i(()=>[o(l(_),{span:12},{default:i(()=>[o(l(h),{label:"Build"},{default:i(()=>[o(l(z),{value:u.selectedBuild,"onUpdate:value":s[0]||(s[0]=d=>u.selectedBuild=d),options:Q.value,"option-label":"label","option-value":"value",filter:!1,onChange:W},null,8,["value","options"])]),_:1})]),_:1}),o(l(_),{span:12},{default:i(()=>[o(l(h),{label:"Date"},{default:i(()=>[o(l(Se),{value:u.dateRange,"onUpdate:value":s[1]||(s[1]=d=>u.dateRange=d),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(l(M),{gutter:10},{default:i(()=>[o(l(_),{span:12},{default:i(()=>[o(l(h),{label:"Runtimes"},{default:i(()=>[o(l(z),{value:u.runtimeNames,"onUpdate:value":s[2]||(s[2]=d=>u.runtimeNames=d),options:r.value.runtimes,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1}),o(l(_),{span:12},{default:i(()=>[o(l(h),{label:"Events"},{default:i(()=>[o(l(z),{value:u.events,"onUpdate:value":s[3]||(s[3]=d=>u.events=d),options:r.value.events,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),o(l(h),{label:"Search"},{default:i(()=>[o(l(ue),{value:u.search,"onUpdate:value":s[4]||(s[4]=d=>u.search=d),type:"search"},null,8,["value"])]),_:1})]),_:1}),l(X)||P.value?(f(),m(l(ce),{key:0,style:{width:"100%"}})):(g=l(v))!=null&&g.logs.length?(f(),m(l(E),{key:1,direction:"vertical",style:{width:"100%"}},{default:i(()=>[o(l(ye),null,{default:i(()=>[(f(!0),A(fe,null,de(l(v).logs,(d,$)=>(f(),m(Qe,{key:$,log:d},null,8,["log"]))),128))]),_:1}),o(l(pe),{current:e.value,"onUpdate:current":s[5]||(s[5]=d=>e.value=d),"page-size":t.value,"onUpdate:pageSize":s[6]||(s[6]=d=>t.value=d),"show-size-changer":"",total:l(v).total},null,8,["current","page-size","total"])]),_:1})):(f(),m(l(me),{key:2}))]}),_:1})}}});export{Ot as default};
//# sourceMappingURL=LegacyLogs.abad3ac4.js.map

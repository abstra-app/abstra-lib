var fe=Object.defineProperty;var ge=(i,t,n)=>t in i?fe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n;var R=(i,t,n)=>(ge(i,typeof t!="symbol"?t+"":t,n),n);import{a as Y}from"./asyncComputed.59dba809.js";import{d as x,r as O,a as g,b as o,u as e,o as m,f as r,cU as K,g as h,t as v,i as a,aI as Z,cW as he,bY as k,dj as ve,al as S,cE as P,bQ as V,cD as N,c as H,ac as X,eB as be,d9 as we,aY as ee,eL as te,cJ as le,U as Ce,h as T,eA as ke,A as Pe,de as xe}from"./jwt-decode.esm.5fdd9ab8.js";import{b as $}from"./index.496095e7.js";import{_ as Ue}from"./DocsButton.vue_vue_type_script_setup_true_lang.aa961e05.js";import{d as L,k as I,p as U}from"./router.2629d009.js";import{C as ae}from"./CrudView.7c45482c.js";import{G as ne}from"./PhPencil.vue.d48640d8.js";import{C as Re}from"./repository.ff56e11c.js";import{E as re}from"./record.46a8b982.js";import{a as M}from"./ant-design.e3897409.js";import{A as Q,T as Ie}from"./Card.96c1b24d.js";import"./constants.874c73ce.js";import"./index.b04050c9.js";import"./url.f5073fe4.js";import"./PhDotsThreeVertical.vue.bd6f36a4.js";import"./fetch.9787ca07.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[t]="ad2d9ede-70b3-4892-9619-add44d999007",i._sentryDebugIdIdentifier="sentry-dbid-ad2d9ede-70b3-4892-9619-add44d999007")}catch{}})();const $e=x({__name:"View",props:{signupPolicy:{}},emits:["updated","save"],setup(i,{emit:t}){const n=t,l=i,s=O(l.signupPolicy.strategy),c=O(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns:[]),y=O(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns.map(u=>({label:u})):[]),b=u=>{const w=u;if(c.value=w,w.length===0){s.value="inviteOnly",f("inviteOnly");return}y.value=w.map(q=>({label:q})),l.signupPolicy.emailPatterns=u,n("updated",l.signupPolicy)},_=()=>{n("save")},f=u=>{s.value=u,u!=="patternOnly"&&(u==="inviteOnly"&&l.signupPolicy.allowOnlyInvited(),n("updated",l.signupPolicy))};return(u,w)=>(m(),g(e(ve),{style:{"padding-top":"8px",width:"100%"},justify:"space-between",align:"flex-end"},{default:o(()=>[r(e(he),{value:s.value,"onUpdate:value":f},{default:o(()=>[r(e($),{direction:"vertical"},{default:o(()=>[r(e(K),{value:"inviteOnly"},{default:o(()=>[h(v(e(a).translate("i18n_signup_policy_invite_only",null)),1)]),_:1}),r(e($),null,{default:o(()=>[r(e(K),{value:"patternOnly"},{default:o(()=>[h(v(e(a).translate("i18n_signup_policy_pattern_only",null)),1)]),_:1}),r(e(Z),{mode:"tags",value:i.signupPolicy.emailPatterns,style:{"min-width":"300px"},placeholder:e(a).translate("i18n_signup_policy_domain_placeholder",null),disabled:s.value!=="patternOnly",options:y.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":b},null,8,["value","placeholder","disabled","options"])]),_:1})]),_:1})]),_:1},8,["value"]),r(e(k),{disabled:!i.signupPolicy.hasChanges,type:"primary",onClick:_},{default:o(()=>[h(v(e(a).translate("i18n_signup_policy_save_changes",null)),1)]),_:1},8,["disabled"])]),_:1}))}}),Oe=x({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(i,{emit:t}){const l=i.roleOptions.map(_=>({label:_.name,value:_.name})),s=t,c=S({email:"",roles:[]});function y(){s("cancel")}function b(){!c.email||s("created",c)}return(_,f)=>(m(),g(e(L),{open:"",title:e(a).translate("i18n_user_editor_new_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:y},{extra:o(()=>[r(e($),null,{default:o(()=>[r(e(k),{onClick:y},{default:o(()=>[h(v(e(a).translate("i18n_user_editor_cancel",null)),1)]),_:1}),r(e(k),{type:"primary",onClick:b},{default:o(()=>[h(v(e(a).translate("i18n_user_editor_submit",null)),1)]),_:1})]),_:1})]),default:o(()=>[r(e(N),{model:c,layout:"vertical"},{default:o(()=>[r(e(P),{key:"email",label:e(a).translate("i18n_user_editor_email_label",null),required:!0},{default:o(()=>[r(e(V),{value:c.email,"onUpdate:value":f[0]||(f[0]=u=>c.email=u)},null,8,["value"])]),_:1},8,["label"]),r(e(P),{key:"role",label:e(a).translate("i18n_user_editor_role_label",null)},{default:o(()=>[r(e(Z),{value:c.roles,"onUpdate:value":f[1]||(f[1]=u=>c.roles=u),mode:"multiple",options:e(l)},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Ae=x({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(i,{emit:t}){const n=t,l=i,s=l.roleOptions.map(_=>({label:_.name,value:_.name})),c=S({email:l.email,roles:l.roles});function y(){n("cancel")}function b(){n("updated",c)}return(_,f)=>(m(),g(e(L),{open:"",title:e(a).translate("i18n_user_editor_update_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:y},{extra:o(()=>[r(e($),null,{default:o(()=>[r(e(k),{onClick:y},{default:o(()=>[h(v(e(a).translate("i18n_user_editor_cancel",null)),1)]),_:1}),r(e(k),{type:"primary",onClick:b},{default:o(()=>[h(v(e(a).translate("i18n_user_editor_submit",null)),1)]),_:1})]),_:1})]),default:o(()=>[r(e(N),{model:c,layout:"vertical"},{default:o(()=>[r(e(P),{key:"email",label:e(a).translate("i18n_user_editor_email_label",null)},{default:o(()=>[r(e(V),{value:c.email,"onUpdate:value":f[0]||(f[0]=u=>c.email=u)},null,8,["value"])]),_:1},8,["label"]),r(e(P),{key:"role",label:e(a).translate("i18n_user_editor_role_label",null)},{default:o(()=>[r(e(Z),{value:c.roles,"onUpdate:value":f[1]||(f[1]=u=>c.roles=u),mode:"multiple",options:e(s)},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),je=x({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const t=i,n=H(()=>{var l;return{columns:[{title:a.translate("i18n_user_editor_email_label",null)},{title:a.translate("i18n_user_editor_roles_column",null)},{title:"",align:"right"}],rows:(l=t.users.map(s=>({key:s.email,cells:[{type:"text",text:s.email},{type:"slot",key:"roles",payload:{roles:s.roles}},{type:"actions",actions:[{icon:ne,label:a.translate("i18n_user_editor_edit",null),onClick:()=>t.onEdit(s)},{icon:te,label:a.translate("i18n_user_editor_delete",null),onClick:()=>t.onDelete(s)}]}]})))!=null?l:[]}});return(l,s)=>(m(),g(ae,{"entity-name":"users",title:"",loading:i.loading,description:e(a).translate("i18n_user_editor_view_description",null),"empty-title":e(a).translate("i18n_user_editor_empty_title",null),table:n.value,"create-button-text":e(a).translate("i18n_user_editor_add_button",null),create:i.onCreate},{roles:o(({payload:c})=>[(m(!0),X(ee,null,be(c.roles,y=>(m(),g(e(we),{key:y,bordered:""},{default:o(()=>[h(v(y),1)]),_:2},1024))),128))]),_:1},8,["loading","description","empty-title","table","create-button-text","create"]))}}),Ee=x({__name:"NewRole",emits:["created","cancel"],setup(i,{emit:t}){const n=t,l=S({name:"",description:""});function s(){n("cancel")}function c(){!l.name||n("created",l)}return(y,b)=>(m(),g(e(L),{open:"",title:e(a).translate("i18n_role_editor_new_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:s},{extra:o(()=>[r(e($),null,{default:o(()=>[r(e(k),{onClick:s},{default:o(()=>[h(v(e(a).translate("i18n_role_editor_cancel",null)),1)]),_:1}),r(e(k),{type:"primary",onClick:c},{default:o(()=>[h(v(e(a).translate("i18n_role_editor_submit",null)),1)]),_:1})]),_:1})]),default:o(()=>[r(e(N),{model:l,layout:"vertical"},{default:o(()=>[r(e(P),{key:"name",label:e(a).translate("i18n_role_editor_name_label",null),required:!0},{default:o(()=>[r(e(V),{value:l.name,"onUpdate:value":b[0]||(b[0]=_=>l.name=_)},null,8,["value"])]),_:1},8,["label"]),r(e(P),{key:"description",label:e(a).translate("i18n_role_editor_description_label",null)},{default:o(()=>[r(e(le),{value:l.description,"onUpdate:value":b[1]||(b[1]=_=>l.description=_),placeholder:e(a).translate("i18n_role_editor_description_placeholder",null),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),De=x({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(i,{emit:t}){const n=t,l=i,s=S({description:l.description});function c(){n("cancel")}function y(){n("updated",s)}return(b,_)=>(m(),g(e(L),{open:"",title:e(a).translate("i18n_role_editor_update_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:c},{extra:o(()=>[r(e($),null,{default:o(()=>[r(e(k),{onClick:c},{default:o(()=>[h(v(e(a).translate("i18n_role_editor_cancel",null)),1)]),_:1}),r(e(k),{type:"primary",onClick:y},{default:o(()=>[h(v(e(a).translate("i18n_role_editor_submit",null)),1)]),_:1})]),_:1})]),default:o(()=>[r(e(N),{model:s,layout:"vertical"},{default:o(()=>[r(e(P),{key:"name",label:e(a).translate("i18n_role_editor_name_label",null)},{default:o(()=>[r(e(V),{value:l.name,disabled:""},null,8,["value"])]),_:1},8,["label"]),r(e(P),{key:"role",label:e(a).translate("i18n_role_editor_description_label",null)},{default:o(()=>[r(e(le),{value:s.description,"onUpdate:value":_[0]||(_[0]=f=>s.description=f),placeholder:e(a).translate("i18n_role_editor_description_placeholder",null),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Te=x({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const t=i,n=H(()=>{var l;return{columns:[{title:a.translate("i18n_role_editor_name_label",null)},{title:a.translate("i18n_role_editor_description_label",null)},{title:"",align:"right"}],rows:(l=t.roles.map(s=>({key:s.id,cells:[{type:"text",text:s.name},{type:"text",text:s.description},{type:"actions",actions:[{icon:ne,label:a.translate("i18n_role_editor_edit",null),onClick:()=>t.onEdit(s)},{icon:te,label:a.translate("i18n_role_editor_delete",null),onClick:()=>t.onDelete(s)}]}]})))!=null?l:[]}});return(l,s)=>(m(),g(ae,{"entity-name":"roles",loading:i.loading,title:"",description:e(a).translate("i18n_role_editor_view_description",null),"empty-title":e(a).translate("i18n_role_editor_empty_title",null),table:n.value,"create-button-text":e(a).translate("i18n_role_editor_add_button",null),create:i.onCreate},null,8,["loading","description","empty-title","table","create-button-text","create"]))}}),F=class{constructor(t){R(this,"record");this.dto=t,this.record=re.from(t)}static from(t){return new F(t)}toDTO(){return this.record.toDTO()}get id(){return this.record.get("id")}get projectId(){return this.record.get("projectId")}get emailPatterns(){return this.record.get("emailPatterns")}set emailPatterns(t){this.record.set("emailPatterns",t)}get hasChanges(){return this.record.hasChangesDeep("emailPatterns")}get strategy(){return this.dto.emailPatterns.length===0?"inviteOnly":"patternOnly"}get changes(){return this.record.changes}allowOnlyInvited(){this.record.set("emailPatterns",[])}static validate(t){return F.pattern.test(t)}};let A=F;R(A,"pattern",new RegExp("^@?(?!-)[A-Za-z0-9-]{1,}(?<!-)(\\.[A-Za-z]{2,})+$"));class Be{constructor(){R(this,"urlPath","signup-policy")}async update(t,n){return I.patch(`projects/${t}/${this.urlPath}`,n)}async get(t){return I.get(`projects/${t}/${this.urlPath}`)}}const W=new Be;class Fe{constructor(t){this.projectId=t}async update(t){const{emailPatterns:n}=t.changes;if(!n)return t;const l=await W.update(this.projectId,{emailPatterns:n});return A.from(l)}async get(){const t=await W.get(this.projectId);return A.from(t)}}class J{constructor(t){R(this,"record");this.dto=t,this.record=re.from(t)}static from(t){return new J(t)}toDTO(){return this.record.toDTO()}get changes(){return this.record.changes}get id(){return this.record.get("id")}get email(){return this.record.get("email")}set email(t){this.record.set("email",t)}get projectId(){return this.record.get("projectId")}get roles(){return this.record.get("roles")}set roles(t){this.record.set("roles",t)}update(t){this.record.update(t)}resetChanges(){this.record.resetChanges()}}class Se{constructor(){R(this,"urlPath","users")}async create(t,n){return I.post(`projects/${t}/${this.urlPath}`,n)}async delete(t,n){await I.delete(`projects/${t}/${this.urlPath}/${n}`)}async list(t,{limit:n,offset:l}){const s={};n&&(s.limit=n.toString()),l&&(s.offset=l.toString());const c=new URLSearchParams(s);return I.get(`projects/${t}/${this.urlPath}?${c.toString()}`)}async update(t,n,l){return I.patch(`projects/${t}/${this.urlPath}/${n}`,l)}}const B=new Se;class Ve{constructor(t){this.projectId=t}async create(t){await B.create(this.projectId,t)}async update(t,n){await B.update(this.projectId,t,n)}async delete(t){await B.delete(this.projectId,t)}async list(t,n){return(await B.list(this.projectId,{limit:t,offset:n})).map(J.from)}}const at=x({__name:"View",setup(i){const n=ke().params.projectId,l=O({type:"initial"}),s=O("users");Ce(()=>{const p=new URLSearchParams(location.search).get("selected-panel")||"users",C=["roles","users"].includes(p)?p:"users";p&&(s.value=C)});const c=()=>{l.value.type="initial"},y=()=>{l.value.type="creatingUser"},b=d=>{l.value={type:"editingUser",payload:d}},_=()=>{l.value.type="creatingRole"},f=d=>{l.value={type:"editingRole",payload:d}},u=new Fe(n),{result:w,refetch:q}=Y(()=>u.get()),oe=async()=>{if(!!w.value)try{await u.update(w.value),q()}catch(d){d instanceof Error&&U(a.translate("i18n_access_control_update_error",null),d.message)}},j=new Ve(n),{loading:se,result:ie,refetch:E}=Y(()=>j.list(100,0)),D=new Re(n),{loading:ce,result:G,refetch:z}=Y(()=>D.list(100,0)),ue=async d=>{try{if(l.value.type!=="creatingUser")return;await j.create(d),c(),E()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_create_error",null),p.message)}},de=async d=>{try{if(l.value.type!=="editingUser")return;await j.update(l.value.payload.id,d),c(),E()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_update_error",null),p.message)}},pe=async d=>{if(!!await M(a.translate("i18n_access_control_delete_user_confirm",null)))try{await j.delete(d.id),E()}catch(C){C instanceof Error&&U(a.translate("i18n_access_control_delete_error",null),C.message)}},_e=async d=>{try{if(l.value.type!=="creatingRole")return;await D.create(d),c(),z()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_create_error",null),p.message)}},me=async d=>{try{if(l.value.type!=="editingRole")return;await D.update(l.value.payload.id,d),c(),z()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_update_error",null),p.message)}},ye=async d=>{if(!!await M(a.translate("i18n_access_control_delete_role_confirm",null)))try{await D.delete(d.id),z(),E()}catch(C){C instanceof Error&&U(a.translate("i18n_access_control_delete_error",null),C.message)}};return(d,p)=>(m(),X(ee,null,[r(e(Pe),null,{default:o(()=>[h(v(e(a).translate("i18n_access_control_title",null)),1)]),_:1}),r(e(xe),null,{default:o(()=>[h(v(e(a).translate("i18n_access_control_description",null))+" ",1),r(Ue,{path:"tools/access-control"})]),_:1}),r(e(Ie),{"active-key":s.value,"onUpdate:activeKey":p[0]||(p[0]=C=>s.value=C)},{default:o(()=>[r(e(Q),{key:"users",tab:e(a).translate("i18n_access_control_users_tab",null)},null,8,["tab"]),r(e(Q),{key:"roles",tab:e(a).translate("i18n_access_control_roles_tab",null)},null,8,["tab"])]),_:1},8,["active-key"]),s.value==="users"&&e(w)?(m(),g($e,{key:0,"signup-policy":e(w),onSave:oe},null,8,["signup-policy"])):T("",!0),s.value==="users"?(m(),g(je,{key:1,loading:e(se),users:e(ie)||[],onCreate:y,onEdit:b,onDelete:pe},null,8,["loading","users"])):T("",!0),s.value==="roles"?(m(),g(Te,{key:2,loading:e(ce),roles:e(G)||[],onCreate:_,onEdit:f,onDelete:ye},null,8,["loading","roles"])):T("",!0),l.value.type==="creatingUser"?(m(),g(Oe,{key:3,"role-options":e(G)||[],onCancel:c,onCreated:ue},null,8,["role-options"])):l.value.type==="editingUser"?(m(),g(Ae,{key:4,email:l.value.payload.email,roles:l.value.payload.roles||[],"role-options":e(G)||[],onUpdated:de,onCancel:c},null,8,["email","roles","role-options"])):l.value.type==="creatingRole"?(m(),g(Ee,{key:5,onCancel:c,onCreated:_e})):l.value.type==="editingRole"?(m(),g(De,{key:6,name:l.value.payload.name,description:l.value.payload.description,onUpdated:me,onCancel:c},null,8,["name","description"])):T("",!0)],64))}});export{at as default};
//# sourceMappingURL=View.dffdc400.js.map

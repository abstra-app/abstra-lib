var fs=Object.defineProperty;var ms=(r,e,t)=>e in r?fs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var S=(r,e,t)=>(ms(r,typeof e!="symbol"?e+"":e,t),t);import{r as ge,G as ie,t as ys,cN as vs,eF as Me,d as Be,b as I,c as M,w,f as b,u as x,c6 as _s,et as qe,b2 as $,cd as gs,eC as ce,c_ as xs,J as He,ez as ws,o as bs,e as Q,bw as ks,eB as Ss,ew as Z,I as At,cP as Ns,x as Ts}from"./outputWidgets.541a6a3f.js";import{W as Is}from"./workspaces.d27d9f39.js";import{C as qt,f as Yt,j as Xt,h as Qt,D as Es,E as Cs,a as Ps,p as Os,e as Ms}from"./icons.fbbc5318.js";import{a as Rs,_ as Ds}from"./FormTester.vue_vue_type_script_setup_true_lang.5ffd06da.js";import{d as G,r as de,t as ye,e as Zs,i as es,f as js,g as Ls,h as Ye,j as zt,p as As,k as zs}from"./geometryUtils.2e28a652.js";import{a as Vt,s as $t,c as Gt,m as Ut}from"./keyboard.77b17bb3.js";import{P as ts}from"./pubsub.8482a29f.js";import{a as Vs,t as $s}from"./ant-design.e75c36c7.js";import{F as Gs}from"./forms.4ff36d50.js";import{H as Us}from"./hooks.c3613214.js";import{J as ss}from"./jobs.8963c228.js";import{A as Bs}from"./activeRecord.867c40fa.js";import{u as Ws,r as Fe}from"./uuid.25354c68.js";import{L as Hs,R as Fs,S as Ks}from"./SmartConsole.e1c7bfc3.js";import{M as Js,A as qs}from"./Title.3011141f.js";import{a as rs}from"./asyncComputed.6496ca6b.js";import{_ as Ys}from"./DocsButton.vue_vue_type_script_setup_true_lang.3e45b890.js";import{_ as Xs}from"./SaveButton.vue_vue_type_script_setup_true_lang.af310abc.js";import{a as Qs,_ as er}from"./HookSettings.vue_vue_type_script_setup_true_lang.f8aa130b.js";import{a as tr,_ as sr}from"./JobSettings.vue_vue_type_script_setup_true_lang.ca02b8dd.js";import{F as rr}from"./Form.2a9acb85.js";import{a as ee}from"./index.07910c0e.js";import{a as Bt,A as nr}from"./index.68ffc7e6.js";import{A as ar}from"./index.f20ad580.js";import{L as ir}from"./LoginBlock.9946ff89.js";import{A as or,c as Wt}from"./index.7fb7f882.js";import{A as cr}from"./index.5d5870f2.js";import{A as dr}from"./index.33fb7a48.js";import{A as Ke,T as lr}from"./TabPane.40396dd5.js";import"./broker.7dc50939.js";import"./index.669ed6e9.js";import"./executeJs.16417bf7.js";import"./CircularLoading.46b3501d.js";import"./PlayerNavbar.f92ecc26.js";import"./index.1b1480b6.js";import"./Steps.554db205.js";import"./Modal.e29b464d.js";import"./WidgetsFrame.2d6f15b2.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.a70d3ffa.js";import"./dashes.438c0418.js";import"./index.3cff0676.js";import"./index.dda022dd.js";import"./index.1797b918.js";import"./dayjs.03d6e1d3.js";import"./popupNotifcation.b07ed784.js";import"./index.ef35da09.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="e90d1970-216a-4a77-9d99-06475b6eaf51",r._sentryDebugIdIdentifier="sentry-dbid-e90d1970-216a-4a77-9d99-06475b6eaf51")}catch{}})();class ur{async list(){return await(await fetch("/_editor/api/scripts")).json()}async create(){return await(await fetch("/_editor/api/scripts",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}async get(e){return await(await fetch(`/_editor/api/scripts/${e}`)).json()}async update(e,t){return await(await fetch(`/_editor/api/scripts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async delete(e){await fetch(`/_editor/api/scripts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async test(e){return(await fetch(`/_editor/api/scripts/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()}}const ae=new ur;class ve{constructor(e){S(this,"record");S(this,"isInitial",!0);this.record=Bs.create(ae,e,"path")}static async list(){return(await ae.list()).map(t=>new ve(t))}static async create(){const e=await ae.create();return new ve(e)}static async get(e){const t=await ae.get(e);return new ve(t)}async delete(){await ae.delete(this.path)}async duplicate(){return this}async save(){await this.record.save()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(){return this.record.hasChanges()}get schedule(){return this.record.get("schedule")}set schedule(e){this.record.set("schedule",e)}get title(){return this.record.get("title")}set title(e){this.record.set("title",e)}get file(){return this.record.get("file")}set file(e){this.record.set("file",e)}get path(){return this.record.get("path")}set path(e){this.record.set("path",e)}async test(){return ae.test(this.path)}get routeName(){return"script"}get position(){const[e,t]=this.record.get("workflow_position");return{x:e,y:t,referential:"world"}}}const Re={left:100,right:100,top:100,bottom:100},Ht={width:600,height:600};class st{constructor(e){S(this,"_state");S(this,"projectedElement");this._state=ge({x:0,y:0,zoom:1}),this.projectedElement=e}get x(){return this._state.value.x}set x(e){if(Number.isNaN(e))throw new Error("x is NaN");this._state.value.x=e}get y(){return this._state.value.y}set y(e){if(Number.isNaN(e))throw new Error("y is NaN");this._state.value.y=e}static create(e){return new st(e)}get zoom(){return this._state.value.zoom}set zoom(e){if(e<=0)throw new Error("Zoom must be positive");this._state.value.zoom=e}fit(e){const t={x:e.x+e.width/2,y:e.y+e.height/2,referential:"world"},s=this.screenRect2world(this.canvasRect);this.x=t.x-s.width/2,this.y=t.y-s.height/2,this.zoomIn(Math.min((this.canvasRect.width-Re.left-Re.right)/Math.max(Ht.width,e.width),(this.canvasRect.height-Re.top-Re.bottom)/Math.max(Ht.height,e.height))/this.zoom,this.worldPoint2screen(t))}screenPoint2world(e){return{x:e.x/this.zoom+this.x,y:e.y/this.zoom+this.y,referential:"world"}}worldPoint2screen(e){return{x:(e.x-this.x)*this.zoom,y:(e.y-this.y)*this.zoom,referential:"screen"}}screenDelta2world(e){return{dx:e.dx/this.zoom,dy:e.dy/this.zoom,referential:"world"}}worldDelta2screen(e){return{dx:e.dx*this.zoom,dy:e.dy*this.zoom,referential:"screen"}}screenRect2world(e){const t=this.screenPoint2world({x:e.x,y:e.y,referential:e.referential}),s=this.screenPoint2world({x:e.x+e.width,y:e.y+e.height,referential:e.referential});return{x:t.x,y:t.y,width:s.x-t.x,height:s.y-t.y,referential:t.referential}}worldRect2screen(e){const t=this.worldPoint2screen({x:e.x,y:e.y,referential:e.referential}),s=this.worldPoint2screen({x:e.x+e.width,y:e.y+e.height,referential:e.referential});return{x:t.x,y:t.y,width:s.x-t.x,height:s.y-t.y,referential:t.referential}}zoomIn(e,t){const s=this.screenPoint2world(t);this.zoom*=e;const n=this.worldPoint2screen(s),a=G(t,n),i=this.screenDelta2world({dx:a.dx,dy:a.dy,referential:"screen"});this.x+=i.dx,this.y+=i.dy}translate(e){this.x+=e.dx,this.y+=e.dy}get canvasRect(){if(!this.projectedElement)throw new Error("No canvas element");const e=this.projectedElement.getBoundingClientRect();return{x:e.x,y:e.y,width:e.width,height:e.height,referential:"screen"}}}const hr="#e55b70";class rt{constructor(){}static create(){return new rt}render(e){const t=de(e.selectedNodes.map(s=>s.projectedRect(e)));!t||(e.ctx.strokeStyle=hr,e.ctx.lineWidth=2,e.ctx.strokeRect(t.x,t.y,t.width,t.height))}}class nt{constructor(e){S(this,"_nodes");S(this,"_links");S(this,"_selectedNodes");S(this,"_selectedLinks");S(this,"_mouseState");S(this,"floatingMenu");S(this,"selectionHull");S(this,"pubsub");S(this,"canvas");S(this,"ctx");S(this,"camera");this.canvas=e,this.camera=st.create(e),this._mouseState=ie({state:"IDLE",mousePos:{x:0,y:0,referential:"screen"}}),this.pubsub=new ts,this.floatingMenu=null;const t=e.getContext("2d");if(!t)throw new Error("Unable to get canvas context");this.ctx=t,this._nodes=ie([]),this._links=ie([]),this._selectedNodes=ie([]),this._selectedLinks=ie([]),this.selectionHull=rt.create()}static create(e){return new nt(e)}addTransition(){this.mouseState={state:"LINKING",mousePos:this.mouseState.mousePos,initialMousePos:this.mouseState.mousePos,snappedTarget:null}}duplicateSelection(){const e=this.selectedNodes,t=this.selectedNodes.map(i=>i.clone()),s=this.links.filter(i=>{const o=this.nodes.find(d=>d.id===i.sourceNodeId),c=this.nodes.find(d=>d.id===i.targetNodeId);if(!o||!c)throw new Error("Invalid state");return this.selectedNodes.includes(o)&&this.selectedNodes.includes(c)}).map(i=>{const o=this.nodes.find(C=>C.id===i.sourceNodeId),c=this.nodes.find(C=>C.id===i.targetNodeId);if(!o||!c)throw new Error("Invalid state");const d=this.selectedNodes.indexOf(o),l=t[d],E=this.selectedNodes.indexOf(c),T=t[E];return i.clone(l.id,T.id)});this.nodes.push(...t),this.links.push(...s),this.selectedNodes=t;const n=de(t.map(i=>i.projectedRect(this)));if(!n)throw new Error("Invalid state");const a={x:n.x+n.width/2,y:n.y+n.height/2,referential:"screen"};this.pubsub.publish("nodes:duplicated",ys.exports.zip(e,t).map(([i,o])=>({original:i,duplicate:o}))),this.mouseState={state:"MOVING",duplicating:!1,initialMousePos:a,mousePos:this.mouseState.mousePos}}async deleteSelection(){if(await Vs("Are you sure? This operation can't be undone")){const e={nodes:this.selectedNodes,links:this.selectedLinks};this.selectedNodes.forEach(t=>this.deleteNode(t)),this.selectedLinks.forEach(t=>this.deleteLink(t)),this.pubsub.publish("deleted",e)}}setupFixSize(){const e=()=>{const{width:t,height:s}=this.canvas.getBoundingClientRect();this.canvas.width=t*devicePixelRatio,this.canvas.height=s*devicePixelRatio,this.ctx.scale(devicePixelRatio,devicePixelRatio)};addEventListener("resize",e),e()}computeCursor(){switch(this.mouseState.state){case"HOVERING_NODE":case"HOVERING_MENU_ITEM":case"HOVERING_LINK":this.canvas.style.cursor="pointer";break;case"JUST_CLICKED_NODE":this.canvas.style.cursor="default";break;case"MOVING":this.canvas.style.cursor="move";break;case"PANNING":this.canvas.style.cursor="grabbing";break;case"LINKING":this.canvas.style.cursor="crosshair";break;case"IDLE":default:this.canvas.style.cursor="grab"}}computePan(e){if(this.mouseState.state!=="PANNING")throw new Error("Invalid state");const t=G(e,this.mouseState.mousePos),s=this.camera.screenDelta2world(t);this.camera.translate(s),this.mouseState={state:"PANNING",initialMousePos:this.mouseState.initialMousePos,mousePos:e}}computeStartMoving(e,t){if(this.mouseState.state!=="JUST_CLICKED_NODE")throw new Error("Invalid state");this.mouseState={state:"MOVING",duplicating:t,initialMousePos:this.mouseState.mousePos,mousePos:e}}get mouseState(){return this._mouseState.value}set mouseState(e){this._mouseState.value=e}get nodes(){return this._nodes.value}set nodes(e){this._nodes.value=e}get links(){return this._links.value}set links(e){this._links.value=e}get selectedNodes(){return this._selectedNodes.value}set selectedNodes(e){this._selectedNodes.value=e}get selectedLinks(){return this._selectedLinks.value}set selectedLinks(e){this._selectedLinks.value=e}computeKeepMoving(e,t){if(this.mouseState.state!=="MOVING")throw new Error("Invalid state");this.mouseState={state:"MOVING",duplicating:t,initialMousePos:this.mouseState.initialMousePos,mousePos:e}}computeKeepLinking(e){if(this.mouseState.state!=="LINKING")throw new Error("Invalid state");const t=this.nodes.find(s=>s.isHovering(this,e));t?this.mouseState={state:"LINKING",initialMousePos:this.mouseState.initialMousePos,mousePos:e,snappedTarget:t}:this.mouseState={state:"LINKING",initialMousePos:this.mouseState.initialMousePos,mousePos:e,snappedTarget:null}}computeHover(e){var a;const t=(a=this.floatingMenu)==null?void 0:a.hoverItem(this,e);if(t){this.mouseState={state:"HOVERING_MENU_ITEM",mousePos:e,menuItem:t};return}const s=this.links.find(i=>i.isHovering(this,e));if(s){this.mouseState={state:"HOVERING_LINK",link:s,mousePos:e};return}const n=this.nodes.find(i=>i.isHovering(this,e));if(n){this.mouseState={state:"HOVERING_NODE",node:n,mousePos:e};return}this.mouseState={state:"IDLE",mousePos:e}}fitCameraToContent(){const e=de(this.nodes.map(t=>t.projectedRect(this)));!e||this.camera.fit(this.camera.screenRect2world(e))}computeFinishMoving(){if(this.mouseState.state!=="MOVING")throw new Error("Invalid state");const e=this.camera.screenPoint2world(this.mouseState.initialMousePos),t=this.camera.screenPoint2world(this.mouseState.mousePos),s=G(e,t);this.pubsub.publish("nodes:moved",this.selectedNodes.map(n=>{const a=n.position;n.translate(s);const i=n.position;return{node:n,from:a,to:i}}))}computeFinishDuplicating(){if(this.mouseState.state!=="MOVING"||!this.mouseState.duplicating)throw new Error("Invalid state");const e=this.camera.screenPoint2world(this.mouseState.initialMousePos),t=this.camera.screenPoint2world(this.mouseState.mousePos),s=G(e,t);this.pubsub.publish("nodes:duplicated",this.selectedNodes.map(n=>{const a=n.clone();return a.translate(s),this.nodes.push(a),{original:n,duplicate:a}})),this.selectedNodes=this.selectedNodes.map(n=>{const a=n.clone();return a.translate(s),a})}computeFinishLinking(e){if(this.mouseState.state!=="LINKING"||!this.mouseState.snappedTarget)throw new Error("Invalid state");const t=this.mouseState.snappedTarget,s=this.selectedNodes.map(n=>n.addLinkTo(this,t));this.pubsub.publish("transition:added",{links:s}),this.selectedNodes=[this.mouseState.snappedTarget],this.mouseState={state:"IDLE",mousePos:e}}computeMouseRelease(e){this.mouseState.state==="MOVING"&&!this.mouseState.duplicating?this.computeFinishMoving():this.mouseState.state==="MOVING"&&this.mouseState.duplicating?this.computeFinishDuplicating():this.mouseState.state==="LINKING"&&this.mouseState.snappedTarget&&this.computeFinishLinking(e),this.mouseState={state:"IDLE",mousePos:e}}setupMousemove(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.mouseState.state==="PANNING"?this.computePan(s):this.mouseState.state==="JUST_CLICKED_NODE"?this.computeStartMoving(s,Vt(t)):this.mouseState.state==="MOVING"?this.computeKeepMoving(s,Vt(t)):this.mouseState.state==="LINKING"?this.computeKeepLinking(s):this.mouseState.state==="ADDING_NEW_NODES"?this.computeKeepAdding(s):this.computeHover(s),this.computeCursor()};addEventListener("mousemove",e)}computeKeepAdding(e){if(this.mouseState.state!=="ADDING_NEW_NODES")throw new Error("Invalid state");this.mouseState.nodes.forEach(t=>t.position=this.camera.screenPoint2world(t.projectedCenter(this))),this.mouseState={state:"ADDING_NEW_NODES",mousePos:e,nodes:this.mouseState.nodes}}setupDragover(){const e=t=>{if(t.preventDefault(),this.mouseState.state!=="ADDING_NEW_NODES")return;const s=this.getScreenPointerFromEvent(t);this.computeKeepAdding(s)};this.canvas.addEventListener("dragover",e)}computeFinishAdding(e){if(this.mouseState.state!=="ADDING_NEW_NODES")return;this.computeKeepAdding(e),this.nodes.push(...this.mouseState.nodes),this.selectedNodes=this.mouseState.nodes;const t=de(this.mouseState.nodes.map(o=>o.projectedRect(this)));if(!t)throw new Error("Invalid state");const s={x:t.x+t.width/2,y:t.y+t.height/2,referential:"screen"},n=this.camera.screenPoint2world(s),a=this.camera.screenPoint2world(e),i=G(n,a);this.mouseState.nodes.forEach(o=>o.translate(i)),this.mouseState={state:"IDLE",mousePos:e},this.pubsub.publish("nodes:added",{nodes:this.selectedNodes})}setupDrop(){const e=t=>{t.stopPropagation();const s=this.getScreenPointerFromEvent(t);this.computeFinishAdding(s)};this.canvas.addEventListener("drop",e)}getScreenPointerFromEvent(e){return{x:e.offsetX,y:e.offsetY,referential:"screen"}}computeStartClicking(e,t){if(this.mouseState.state==="ADDING_NEW_NODES")this.computeFinishAdding(e);else if(this.mouseState.state==="HOVERING_LINK"){const s=this.mouseState.link;t?this.selectedLinks=[...this.selectedLinks,s]:this.selectedLinks.includes(s)||(this.selectedLinks=[s],this.selectedNodes=[]),this.mouseState={state:"JUST_CLICKED_NODE",mousePos:e,node:this.nodes.find(n=>n.id===s.sourceNodeId)}}else if(this.mouseState.state==="HOVERING_NODE"){const s=this.mouseState.node;t?this.selectedNodes=[...this.selectedNodes,s]:this.selectedNodes.includes(s)||(this.selectedNodes=[s],this.selectedLinks=[]),this.mouseState={state:"JUST_CLICKED_NODE",mousePos:e,node:s}}else this.mouseState.state==="HOVERING_MENU_ITEM"?this.mouseState.menuItem.click():this.mouseState.state==="LINKING"?this.computeFinishLinking(e):(this.clearSelection(),this.mouseState={state:"PANNING",initialMousePos:e,mousePos:e})}setupDoubleClick(){const e=()=>{if(this.mouseState.state!=="HOVERING_NODE")return;const t=this.mouseState.node;this.pubsub.publish("node:dblclick",{node:t})};this.canvas.addEventListener("dblclick",e)}setupMousedown(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.computeStartClicking(s,$t(t))};this.canvas.addEventListener("mousedown",e)}setupMouseup(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.computeMouseRelease(s),this.computeHover(s),this.computeCursor()};this.canvas.addEventListener("mouseup",e)}computeZoomIn(e,t){this.camera.zoomIn(t,e)}setupWheel(){const e=t=>{if(!this.camera)return;const s={x:t.pageX,y:t.pageY,referential:"screen"};if(Gt(t)||Ut(t))this.computeZoomIn(s,t.deltaY>0?.9:1.1),t.preventDefault();else{const n=$t(t)?{dx:t.deltaY,dy:0}:{dx:t.deltaX,dy:t.deltaY},a=this.camera.screenDelta2world({dx:n.dx,dy:n.dy,referential:"screen"});this.camera.translate(a)}t.stopPropagation()};this.canvas.addEventListener("wheel",e)}deleteNode(e){this.nodes=this.nodes.filter(t=>t!==e),this.links=this.links.filter(t=>t.sourceNodeId!==e.id&&t.targetNodeId!==e.id),this.selectedNodes=this.selectedNodes.filter(t=>t!==e)}deleteLink(e){this.links=this.links.filter(t=>t!==e),this.selectedLinks=[]}setupKeydown(){const e=t=>{t.key==="Delete"||t.key==="Backspace"?this.deleteSelection():t.key==="a"&&(Gt(t)||Ut(t))?(this.selectedNodes=this.nodes,t.preventDefault()):t.key==="Escape"?(this.clearSelection(),this.mouseState={state:"IDLE",mousePos:this.mouseState.mousePos}):t.key==="t"?this.addTransition():t.key==="Enter"&&this.pubsub.publish("node:dblclick",{node:this.selectedNodes[0]})};this.canvas.parentElement.addEventListener("keydown",e)}renderMouseState(){switch(this.mouseState.state){case"ADDING_NEW_NODES":this.mouseState.nodes.forEach(e=>e.render(this));break}}setFloatingMenu(e){this.floatingMenu=e}render(){var e;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.links.forEach(t=>{t.render(this)}),this.nodes.forEach(t=>{t.render(this)}),(e=this.floatingMenu)==null||e.render(this),this.selectionHull.render(this),this.renderMouseState(),requestAnimationFrame(()=>this.render())}init(){this.setupFixSize(),this.setupMousemove(),this.setupDragover(),this.setupDoubleClick(),this.setupMousedown(),this.setupDrop(),this.setupMouseup(),this.setupWheel(),this.setupKeydown(),this.fitCameraToContent(),this.render()}clear(){this.nodes=[],this.links=[]}addNode(e){this.nodes.push(e)}addLink(e){this.links.push(e)}clearSelection(){this.selectedNodes=[],this.selectedLinks=[]}dragstart(e,t){const s=this.getScreenPointerFromEvent(t);this.clearSelection(),this.mouseState={state:"ADDING_NEW_NODES",mousePos:s,nodes:[e]}}}const pr="rgba(0, 0, 0, 1)",fr="rgba(0, 0, 0, 0.5)";class at{constructor(e){S(this,"rawItems");this.rawItems=e}static create(e){return new at(e)}getMenuItems(e){const t=e.selectedNodes,s=de(t.map(E=>E.projectedRect(e)));if(!s)return[];const n={x:s.x+s.width,y:s.y,referential:"screen"},a=10,i=16,o=10,c={dx:i+a,dy:i,referential:"screen"},d={dx:0,dy:2*i+o,referential:"screen"},l=ye(n,c);return this.rawItems.map((E,T)=>{const C=ye(l,Zs(d,T));return{label:E.label,icon:E.icon,circle:{...C,radius:i},click:E.click}})}isVisible(e){return e.selectedNodes.length>0&&e.mouseState.state!=="LINKING"&&e.mouseState.state!=="MOVING"}itemHover(e,t){return e.mouseState.state==="HOVERING_MENU_ITEM"&&e.mouseState.menuItem.label===t.label}renderItem(e,t){const s=this.itemHover(e,t),n=s?pr:fr;if(e.ctx.strokeStyle=n,e.ctx.lineWidth=2,s){e.ctx.font="12px sans-serif";const o=e.ctx.measureText(t.label).width;e.ctx.beginPath(),e.ctx.arc(t.circle.x,t.circle.y,t.circle.radius,Math.PI/2,-Math.PI/2),e.ctx.lineTo(t.circle.x+o+t.circle.radius,t.circle.y-t.circle.radius),e.ctx.arc(t.circle.x+o+t.circle.radius,t.circle.y,t.circle.radius,-Math.PI/2,Math.PI/2),e.ctx.lineTo(t.circle.x,t.circle.y+t.circle.radius),e.ctx.fillStyle="white",e.ctx.fill(),e.ctx.stroke(),e.ctx.textBaseline="middle",e.ctx.textAlign="left",e.ctx.font="12px sans-serif",e.ctx.fillStyle=n,e.ctx.fillText(t.label,t.circle.x+t.circle.radius,t.circle.y)}else e.ctx.beginPath(),e.ctx.arc(t.circle.x,t.circle.y,t.circle.radius,0,2*Math.PI),e.ctx.fillStyle="white",e.ctx.fill(),e.ctx.stroke();const a=new Path2D(t.icon);e.ctx.save();const i=12;e.ctx.translate(t.circle.x-i,t.circle.y-i),e.ctx.fillStyle=n,e.ctx.fill(a),e.ctx.restore()}render(e){!this.isVisible(e)||this.getMenuItems(e).forEach(t=>{this.renderItem(e,t)})}hoverItem(e,t){if(!!this.isVisible(e))return this.getMenuItems(e).find(s=>{if(this.itemHover(e,s)){const n=e.ctx.measureText(s.label).width,a={x:s.circle.x-s.circle.radius,y:s.circle.y-s.circle.radius,width:n+3*s.circle.radius,height:2*s.circle.radius,referential:"screen"};return es(t,a)}else return js(t,s.circle)})}}var g;(function(r){r.assertEqual=n=>n;function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{const a={};for(const i of n)a[i]=i;return a},r.getValidEnumValues=n=>{const a=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),i={};for(const o of a)i[o]=n[o];return r.objectValues(i)},r.objectValues=n=>r.objectKeys(n).map(function(a){return n[a]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const a=[];for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&a.push(i);return a},r.find=(n,a)=>{for(const i of n)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,a=" | "){return n.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=s,r.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(g||(g={}));var Xe;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Xe||(Xe={}));const h=g.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),J=r=>{switch(typeof r){case"undefined":return h.undefined;case"string":return h.string;case"number":return isNaN(r)?h.nan:h.number;case"boolean":return h.boolean;case"function":return h.function;case"bigint":return h.bigint;case"symbol":return h.symbol;case"object":return Array.isArray(r)?h.array:r===null?h.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?h.promise:typeof Map<"u"&&r instanceof Map?h.map:typeof Set<"u"&&r instanceof Set?h.set:typeof Date<"u"&&r instanceof Date?h.date:h.object;default:return h.unknown}},u=g.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),mr=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class A extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(a){return a.message},s={_errors:[]},n=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(n);else if(i.code==="invalid_return_type")n(i.returnTypeError);else if(i.code==="invalid_arguments")n(i.argumentsError);else if(i.path.length===0)s._errors.push(t(i));else{let o=s,c=0;for(;c<i.path.length;){const d=i.path[c];c===i.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(t(i))):o[d]=o[d]||{_errors:[]},o=o[d],c++}}};return n(this),s}toString(){return this.message}get message(){return JSON.stringify(this.issues,g.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}A.create=r=>new A(r);const xe=(r,e)=>{let t;switch(r.code){case u.invalid_type:r.received===h.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case u.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,g.jsonStringifyReplacer)}`;break;case u.unrecognized_keys:t=`Unrecognized key(s) in object: ${g.joinValues(r.keys,", ")}`;break;case u.invalid_union:t="Invalid input";break;case u.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${g.joinValues(r.options)}`;break;case u.invalid_enum_value:t=`Invalid enum value. Expected ${g.joinValues(r.options)}, received '${r.received}'`;break;case u.invalid_arguments:t="Invalid function arguments";break;case u.invalid_return_type:t="Invalid function return type";break;case u.invalid_date:t="Invalid date";break;case u.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:g.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case u.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case u.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case u.custom:t="Invalid input";break;case u.invalid_intersection_types:t="Intersection results could not be merged";break;case u.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case u.not_finite:t="Number must be finite";break;default:t=e.defaultError,g.assertNever(r)}return{message:t}};let ns=xe;function yr(r){ns=r}function Ze(){return ns}const je=r=>{const{data:e,path:t,errorMaps:s,issueData:n}=r,a=[...t,...n.path||[]],i={...n,path:a};let o="";const c=s.filter(d=>!!d).slice().reverse();for(const d of c)o=d(i,{data:e,defaultError:o}).message;return{...n,path:a,message:n.message||o}},vr=[];function p(r,e){const t=je({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ze(),xe].filter(s=>!!s)});r.common.issues.push(t)}class P{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if(n.status==="aborted")return y;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const n of t)s.push({key:await n.key,value:await n.value});return P.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:a,value:i}=n;if(a.status==="aborted"||i.status==="aborted")return y;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),(typeof i.value<"u"||n.alwaysSet)&&(s[a.value]=i.value)}return{status:e.value,value:s}}}const y=Object.freeze({status:"aborted"}),as=r=>({status:"dirty",value:r}),R=r=>({status:"valid",value:r}),Qe=r=>r.status==="aborted",et=r=>r.status==="dirty",Le=r=>r.status==="valid",Ae=r=>typeof Promise<"u"&&r instanceof Promise;var f;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(f||(f={}));class U{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ft=(r,e)=>{if(Le(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new A(r.common.issues);return this._error=t,this._error}}};function v(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(i,o)=>i.code!=="invalid_type"?{message:o.defaultError}:typeof o.data>"u"?{message:s!=null?s:o.defaultError}:{message:t!=null?t:o.defaultError},description:n}}class _{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return J(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:J(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new P,ctx:{common:e.parent.common,data:e.data,parsedType:J(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ae(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const n={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:J(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Ft(n,a)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:J(e)},n=this._parse({data:e,path:s.path,parent:s}),a=await(Ae(n)?n:Promise.resolve(n));return Ft(s,a)}refine(e,t){const s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,a)=>{const i=e(n),o=()=>a.addIssue({code:u.custom,...s(n)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new V({schema:this,typeName:m.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return W.create(this,this._def)}nullable(){return ne.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return z.create(this,this._def)}promise(){return he.create(this,this._def)}or(e){return Se.create([this,e],this._def)}and(e){return Ne.create(this,e,this._def)}transform(e){return new V({...v(this._def),schema:this,typeName:m.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Pe({...v(this._def),innerType:this,defaultValue:t,typeName:m.ZodDefault})}brand(){return new os({typeName:m.ZodBranded,type:this,...v(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Ge({...v(this._def),innerType:this,catchValue:t,typeName:m.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Oe.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const _r=/^c[^\s-]{8,}$/i,gr=/^[a-z][a-z0-9]*$/,xr=/[0-9A-HJKMNP-TV-Z]{26}/,wr=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,br=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,kr=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,Sr=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Nr=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Tr=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Ir(r,e){return!!((e==="v4"||!e)&&Sr.test(r)||(e==="v6"||!e)&&Nr.test(r))}class L extends _{constructor(){super(...arguments),this._regex=(e,t,s)=>this.refinement(n=>e.test(n),{validation:t,code:u.invalid_string,...f.errToObj(s)}),this.nonempty=e=>this.min(1,f.errToObj(e)),this.trim=()=>new L({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new L({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new L({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==h.string){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.string,received:a.parsedType}),y}const s=new P;let n;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(n=this._getOrReturnCtx(e,n),i?p(n,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&p(n,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),s.dirty())}else if(a.kind==="email")br.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"email",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="emoji")kr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"emoji",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="uuid")wr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"uuid",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid")_r.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"cuid",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid2")gr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"cuid2",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="ulid")xr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"ulid",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),p(n,{validation:"url",code:u.invalid_string,message:a.message}),s.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"regex",code:u.invalid_string,message:a.message}),s.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),s.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:{startsWith:a.value},message:a.message}),s.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:{endsWith:a.value},message:a.message}),s.dirty()):a.kind==="datetime"?Tr(a).test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:"datetime",message:a.message}),s.dirty()):a.kind==="ip"?Ir(e.data,a.version)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"ip",code:u.invalid_string,message:a.message}),s.dirty()):g.assertNever(a);return{status:s.value,value:e.data}}_addCheck(e){return new L({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...f.errToObj(e)})}url(e){return this._addCheck({kind:"url",...f.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...f.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...f.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...f.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...f.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...f.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...f.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...f.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...f.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...f.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...f.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...f.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...f.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...f.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...f.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}L.create=r=>{var e;return new L({checks:[],typeName:m.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...v(r)})};function Er(r,e){const t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,a=parseInt(r.toFixed(n).replace(".","")),i=parseInt(e.toFixed(n).replace(".",""));return a%i/Math.pow(10,n)}class q extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==h.number){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.number,received:a.parsedType}),y}let s;const n=new P;for(const a of this._def.checks)a.kind==="int"?g.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),p(s,{code:u.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?Er(e.data,a.value)!==0&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),p(s,{code:u.not_finite,message:a.message}),n.dirty()):g.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,s,n){return new q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:f.toString(n)}]})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:f.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:f.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:f.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:f.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&g.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}q.create=r=>new q({checks:[],typeName:m.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...v(r)});class Y extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==h.bigint){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.bigint,received:a.parsedType}),y}let s;const n=new P;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):g.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,s,n){return new Y({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:f.toString(n)}]})}_addCheck(e){return new Y({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Y.create=r=>{var e;return new Y({checks:[],typeName:m.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...v(r)})};class we extends _{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==h.boolean){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.boolean,received:s.parsedType}),y}return R(e.data)}}we.create=r=>new we({typeName:m.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...v(r)});class se extends _{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==h.date){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.date,received:a.parsedType}),y}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_date}),y}const s=new P;let n;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):g.assertNever(a);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new se({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:f.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:f.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}se.create=r=>new se({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:m.ZodDate,...v(r)});class ze extends _{_parse(e){if(this._getType(e)!==h.symbol){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.symbol,received:s.parsedType}),y}return R(e.data)}}ze.create=r=>new ze({typeName:m.ZodSymbol,...v(r)});class be extends _{_parse(e){if(this._getType(e)!==h.undefined){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.undefined,received:s.parsedType}),y}return R(e.data)}}be.create=r=>new be({typeName:m.ZodUndefined,...v(r)});class ke extends _{_parse(e){if(this._getType(e)!==h.null){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.null,received:s.parsedType}),y}return R(e.data)}}ke.create=r=>new ke({typeName:m.ZodNull,...v(r)});class ue extends _{constructor(){super(...arguments),this._any=!0}_parse(e){return R(e.data)}}ue.create=r=>new ue({typeName:m.ZodAny,...v(r)});class te extends _{constructor(){super(...arguments),this._unknown=!0}_parse(e){return R(e.data)}}te.create=r=>new te({typeName:m.ZodUnknown,...v(r)});class H extends _{_parse(e){const t=this._getOrReturnCtx(e);return p(t,{code:u.invalid_type,expected:h.never,received:t.parsedType}),y}}H.create=r=>new H({typeName:m.ZodNever,...v(r)});class Ve extends _{_parse(e){if(this._getType(e)!==h.undefined){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.void,received:s.parsedType}),y}return R(e.data)}}Ve.create=r=>new Ve({typeName:m.ZodVoid,...v(r)});class z extends _{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==h.array)return p(t,{code:u.invalid_type,expected:h.array,received:t.parsedType}),y;if(n.exactLength!==null){const i=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(i||o)&&(p(t,{code:i?u.too_big:u.too_small,minimum:o?n.exactLength.value:void 0,maximum:i?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(p(t,{code:u.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(p(t,{code:u.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>n.type._parseAsync(new U(t,i,t.path,o)))).then(i=>P.mergeArray(s,i));const a=[...t.data].map((i,o)=>n.type._parseSync(new U(t,i,t.path,o)));return P.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new z({...this._def,minLength:{value:e,message:f.toString(t)}})}max(e,t){return new z({...this._def,maxLength:{value:e,message:f.toString(t)}})}length(e,t){return new z({...this._def,exactLength:{value:e,message:f.toString(t)}})}nonempty(e){return this.min(1,e)}}z.create=(r,e)=>new z({type:r,minLength:null,maxLength:null,exactLength:null,typeName:m.ZodArray,...v(e)});function oe(r){if(r instanceof N){const e={};for(const t in r.shape){const s=r.shape[t];e[t]=W.create(oe(s))}return new N({...r._def,shape:()=>e})}else return r instanceof z?new z({...r._def,type:oe(r.element)}):r instanceof W?W.create(oe(r.unwrap())):r instanceof ne?ne.create(oe(r.unwrap())):r instanceof B?B.create(r.items.map(e=>oe(e))):r}class N extends _{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=g.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==h.object){const d=this._getOrReturnCtx(e);return p(d,{code:u.invalid_type,expected:h.object,received:d.parsedType}),y}const{status:s,ctx:n}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof H&&this._def.unknownKeys==="strip"))for(const d in n.data)i.includes(d)||o.push(d);const c=[];for(const d of i){const l=a[d],E=n.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new U(n,E,n.path,d)),alwaysSet:d in n.data})}if(this._def.catchall instanceof H){const d=this._def.unknownKeys;if(d==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(d==="strict")o.length>0&&(p(n,{code:u.unrecognized_keys,keys:o}),s.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const l of o){const E=n.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new U(n,E,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const d=[];for(const l of c){const E=await l.key;d.push({key:E,value:await l.value,alwaysSet:l.alwaysSet})}return d}).then(d=>P.mergeObjectSync(s,d)):P.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return f.errToObj,new N({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var n,a,i,o;const c=(i=(a=(n=this._def).errorMap)===null||a===void 0?void 0:a.call(n,t,s).message)!==null&&i!==void 0?i:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=f.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new N({...this._def,unknownKeys:"strip"})}passthrough(){return new N({...this._def,unknownKeys:"passthrough"})}extend(e){return new N({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new N({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:m.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new N({...this._def,catchall:e})}pick(e){const t={};return g.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new N({...this._def,shape:()=>t})}omit(e){const t={};return g.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new N({...this._def,shape:()=>t})}deepPartial(){return oe(this)}partial(e){const t={};return g.objectKeys(this.shape).forEach(s=>{const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}),new N({...this._def,shape:()=>t})}required(e){const t={};return g.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let a=this.shape[s];for(;a instanceof W;)a=a._def.innerType;t[s]=a}}),new N({...this._def,shape:()=>t})}keyof(){return is(g.objectKeys(this.shape))}}N.create=(r,e)=>new N({shape:()=>r,unknownKeys:"strip",catchall:H.create(),typeName:m.ZodObject,...v(e)});N.strictCreate=(r,e)=>new N({shape:()=>r,unknownKeys:"strict",catchall:H.create(),typeName:m.ZodObject,...v(e)});N.lazycreate=(r,e)=>new N({shape:r,unknownKeys:"strip",catchall:H.create(),typeName:m.ZodObject,...v(e)});class Se extends _{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function n(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new A(o.ctx.common.issues));return p(t,{code:u.invalid_union,unionErrors:i}),y}if(t.common.async)return Promise.all(s.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(n);{let a;const i=[];for(const c of s){const d={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:d});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:d}),d.common.issues.length&&i.push(d.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new A(c));return p(t,{code:u.invalid_union,unionErrors:o}),y}}get options(){return this._def.options}}Se.create=(r,e)=>new Se({options:r,typeName:m.ZodUnion,...v(e)});const De=r=>r instanceof Ie?De(r.schema):r instanceof V?De(r.innerType()):r instanceof Ee?[r.value]:r instanceof X?r.options:r instanceof Ce?Object.keys(r.enum):r instanceof Pe?De(r._def.innerType):r instanceof be?[void 0]:r instanceof ke?[null]:null;class We extends _{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.object)return p(t,{code:u.invalid_type,expected:h.object,received:t.parsedType}),y;const s=this.discriminator,n=t.data[s],a=this.optionsMap.get(n);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(p(t,{code:u.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const n=new Map;for(const a of t){const i=De(a.shape[e]);if(!i)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,a)}}return new We({typeName:m.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...v(s)})}}function tt(r,e){const t=J(r),s=J(e);if(r===e)return{valid:!0,data:r};if(t===h.object&&s===h.object){const n=g.objectKeys(e),a=g.objectKeys(r).filter(o=>n.indexOf(o)!==-1),i={...r,...e};for(const o of a){const c=tt(r[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===h.array&&s===h.array){if(r.length!==e.length)return{valid:!1};const n=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],c=tt(i,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===h.date&&s===h.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Ne extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(a,i)=>{if(Qe(a)||Qe(i))return y;const o=tt(a.value,i.value);return o.valid?((et(a)||et(i))&&t.dirty(),{status:t.value,value:o.data}):(p(s,{code:u.invalid_intersection_types}),y)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([a,i])=>n(a,i)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Ne.create=(r,e,t)=>new Ne({left:r,right:e,typeName:m.ZodIntersection,...v(t)});class B extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.array)return p(s,{code:u.invalid_type,expected:h.array,received:s.parsedType}),y;if(s.data.length<this._def.items.length)return p(s,{code:u.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y;!this._def.rest&&s.data.length>this._def.items.length&&(p(s,{code:u.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new U(s,i,s.path,o)):null}).filter(i=>!!i);return s.common.async?Promise.all(a).then(i=>P.mergeArray(t,i)):P.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new B({...this._def,rest:e})}}B.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new B({items:r,typeName:m.ZodTuple,rest:null,...v(e)})};class Te extends _{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.object)return p(s,{code:u.invalid_type,expected:h.object,received:s.parsedType}),y;const n=[],a=this._def.keyType,i=this._def.valueType;for(const o in s.data)n.push({key:a._parse(new U(s,o,s.path,o)),value:i._parse(new U(s,s.data[o],s.path,o))});return s.common.async?P.mergeObjectAsync(t,n):P.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof _?new Te({keyType:e,valueType:t,typeName:m.ZodRecord,...v(s)}):new Te({keyType:L.create(),valueType:e,typeName:m.ZodRecord,...v(t)})}}class $e extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.map)return p(s,{code:u.invalid_type,expected:h.map,received:s.parsedType}),y;const n=this._def.keyType,a=this._def.valueType,i=[...s.data.entries()].map(([o,c],d)=>({key:n._parse(new U(s,o,s.path,[d,"key"])),value:a._parse(new U(s,c,s.path,[d,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const d=await c.key,l=await c.value;if(d.status==="aborted"||l.status==="aborted")return y;(d.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(d.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const d=c.key,l=c.value;if(d.status==="aborted"||l.status==="aborted")return y;(d.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(d.value,l.value)}return{status:t.value,value:o}}}}$e.create=(r,e,t)=>new $e({valueType:e,keyType:r,typeName:m.ZodMap,...v(t)});class re extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.set)return p(s,{code:u.invalid_type,expected:h.set,received:s.parsedType}),y;const n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(p(s,{code:u.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(p(s,{code:u.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const d=new Set;for(const l of c){if(l.status==="aborted")return y;l.status==="dirty"&&t.dirty(),d.add(l.value)}return{status:t.value,value:d}}const o=[...s.data.values()].map((c,d)=>a._parse(new U(s,c,s.path,d)));return s.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new re({...this._def,minSize:{value:e,message:f.toString(t)}})}max(e,t){return new re({...this._def,maxSize:{value:e,message:f.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}re.create=(r,e)=>new re({valueType:r,minSize:null,maxSize:null,typeName:m.ZodSet,...v(e)});class le extends _{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.function)return p(t,{code:u.invalid_type,expected:h.function,received:t.parsedType}),y;function s(o,c){return je({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ze(),xe].filter(d=>!!d),issueData:{code:u.invalid_arguments,argumentsError:c}})}function n(o,c){return je({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ze(),xe].filter(d=>!!d),issueData:{code:u.invalid_return_type,returnTypeError:c}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof he?R(async(...o)=>{const c=new A([]),d=await this._def.args.parseAsync(o,a).catch(T=>{throw c.addIssue(s(o,T)),c}),l=await i(...d);return await this._def.returns._def.type.parseAsync(l,a).catch(T=>{throw c.addIssue(n(l,T)),c})}):R((...o)=>{const c=this._def.args.safeParse(o,a);if(!c.success)throw new A([s(o,c.error)]);const d=i(...c.data),l=this._def.returns.safeParse(d,a);if(!l.success)throw new A([n(d,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new le({...this._def,args:B.create(e).rest(te.create())})}returns(e){return new le({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new le({args:e||B.create([]).rest(te.create()),returns:t||te.create(),typeName:m.ZodFunction,...v(s)})}}class Ie extends _{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ie.create=(r,e)=>new Ie({getter:r,typeName:m.ZodLazy,...v(e)});class Ee extends _{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return p(t,{received:t.data,code:u.invalid_literal,expected:this._def.value}),y}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ee.create=(r,e)=>new Ee({value:r,typeName:m.ZodLiteral,...v(e)});function is(r,e){return new X({values:r,typeName:m.ZodEnum,...v(e)})}class X extends _{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return p(t,{expected:g.joinValues(s),received:t.parsedType,code:u.invalid_type}),y}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),s=this._def.values;return p(t,{received:t.data,code:u.invalid_enum_value,options:s}),y}return R(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return X.create(e)}exclude(e){return X.create(this.options.filter(t=>!e.includes(t)))}}X.create=is;class Ce extends _{_parse(e){const t=g.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==h.string&&s.parsedType!==h.number){const n=g.objectValues(t);return p(s,{expected:g.joinValues(n),received:s.parsedType,code:u.invalid_type}),y}if(t.indexOf(e.data)===-1){const n=g.objectValues(t);return p(s,{received:s.data,code:u.invalid_enum_value,options:n}),y}return R(e.data)}get enum(){return this._def.values}}Ce.create=(r,e)=>new Ce({values:r,typeName:m.ZodNativeEnum,...v(e)});class he extends _{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.promise&&t.common.async===!1)return p(t,{code:u.invalid_type,expected:h.promise,received:t.parsedType}),y;const s=t.parsedType===h.promise?t.data:Promise.resolve(t.data);return R(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}he.create=(r,e)=>new he({type:r,typeName:m.ZodPromise,...v(e)});class V extends _{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===m.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null;if(n.type==="preprocess"){const i=n.transform(s.data);return s.common.async?Promise.resolve(i).then(o=>this._def.schema._parseAsync({data:o,path:s.path,parent:s})):this._def.schema._parseSync({data:i,path:s.path,parent:s})}const a={addIssue:i=>{p(s,i),i.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),n.type==="refinement"){const i=o=>{const c=n.refinement(o,a);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){const i=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Le(i))return i;const o=n.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(i=>Le(i)?Promise.resolve(n.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);g.assertNever(n)}}V.create=(r,e,t)=>new V({schema:r,typeName:m.ZodEffects,effect:e,...v(t)});V.createWithPreprocess=(r,e,t)=>new V({schema:e,effect:{type:"preprocess",transform:r},typeName:m.ZodEffects,...v(t)});class W extends _{_parse(e){return this._getType(e)===h.undefined?R(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}W.create=(r,e)=>new W({innerType:r,typeName:m.ZodOptional,...v(e)});class ne extends _{_parse(e){return this._getType(e)===h.null?R(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ne.create=(r,e)=>new ne({innerType:r,typeName:m.ZodNullable,...v(e)});class Pe extends _{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===h.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Pe.create=(r,e)=>new Pe({innerType:r,typeName:m.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...v(e)});class Ge extends _{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Ae(n)?n.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new A(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new A(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Ge.create=(r,e)=>new Ge({innerType:r,typeName:m.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...v(e)});class Ue extends _{_parse(e){if(this._getType(e)!==h.nan){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.nan,received:s.parsedType}),y}return{status:"valid",value:e.data}}}Ue.create=r=>new Ue({typeName:m.ZodNaN,...v(r)});const Cr=Symbol("zod_brand");class os extends _{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Oe extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?y:a.status==="dirty"?(t.dirty(),as(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})})();{const n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?y:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new Oe({in:e,out:t,typeName:m.ZodPipeline})}}const cs=(r,e={},t)=>r?ue.create().superRefine((s,n)=>{var a,i;if(!r(s)){const o=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,c=(i=(a=o.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0,d=typeof o=="string"?{message:o}:o;n.addIssue({code:"custom",...d,fatal:c})}}):ue.create(),Pr={object:N.lazycreate};var m;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline"})(m||(m={}));const Or=(r,e={message:`Input not instance of ${r.name}`})=>cs(t=>t instanceof r,e),ds=L.create,ls=q.create,Mr=Ue.create,Rr=Y.create,us=we.create,Dr=se.create,Zr=ze.create,jr=be.create,Lr=ke.create,Ar=ue.create,zr=te.create,Vr=H.create,$r=Ve.create,Gr=z.create,Ur=N.create,Br=N.strictCreate,Wr=Se.create,Hr=We.create,Fr=Ne.create,Kr=B.create,Jr=Te.create,qr=$e.create,Yr=re.create,Xr=le.create,Qr=Ie.create,en=Ee.create,tn=X.create,sn=Ce.create,rn=he.create,Kt=V.create,nn=W.create,an=ne.create,on=V.createWithPreprocess,cn=Oe.create,dn=()=>ds().optional(),ln=()=>ls().optional(),un=()=>us().optional(),hn={string:r=>L.create({...r,coerce:!0}),number:r=>q.create({...r,coerce:!0}),boolean:r=>we.create({...r,coerce:!0}),bigint:r=>Y.create({...r,coerce:!0}),date:r=>se.create({...r,coerce:!0})},pn=y;var D=Object.freeze({__proto__:null,defaultErrorMap:xe,setErrorMap:yr,getErrorMap:Ze,makeIssue:je,EMPTY_PATH:vr,addIssueToContext:p,ParseStatus:P,INVALID:y,DIRTY:as,OK:R,isAborted:Qe,isDirty:et,isValid:Le,isAsync:Ae,get util(){return g},get objectUtil(){return Xe},ZodParsedType:h,getParsedType:J,ZodType:_,ZodString:L,ZodNumber:q,ZodBigInt:Y,ZodBoolean:we,ZodDate:se,ZodSymbol:ze,ZodUndefined:be,ZodNull:ke,ZodAny:ue,ZodUnknown:te,ZodNever:H,ZodVoid:Ve,ZodArray:z,ZodObject:N,ZodUnion:Se,ZodDiscriminatedUnion:We,ZodIntersection:Ne,ZodTuple:B,ZodRecord:Te,ZodMap:$e,ZodSet:re,ZodFunction:le,ZodLazy:Ie,ZodLiteral:Ee,ZodEnum:X,ZodNativeEnum:Ce,ZodPromise:he,ZodEffects:V,ZodTransformer:V,ZodOptional:W,ZodNullable:ne,ZodDefault:Pe,ZodCatch:Ge,ZodNaN:Ue,BRAND:Cr,ZodBranded:os,ZodPipeline:Oe,custom:cs,Schema:_,ZodSchema:_,late:Pr,get ZodFirstPartyTypeKind(){return m},coerce:hn,any:Ar,array:Gr,bigint:Rr,boolean:us,date:Dr,discriminatedUnion:Hr,effect:Kt,enum:tn,function:Xr,instanceof:Or,intersection:Fr,lazy:Qr,literal:en,map:qr,nan:Mr,nativeEnum:sn,never:Vr,null:Lr,nullable:an,number:ls,object:Ur,oboolean:un,onumber:ln,optional:nn,ostring:dn,pipeline:cn,preprocess:on,promise:rn,record:Jr,set:Yr,strictObject:Br,string:ds,symbol:Zr,transformer:Kt,tuple:Kr,undefined:jr,union:Wr,unknown:zr,void:$r,NEVER:pn,ZodIssueCode:u,quotelessJson:mr,ZodError:A});const fn=D.object({id:D.string(),label:D.string().nullable(),targetPath:D.string(),targetType:D.enum(["forms","hooks","jobs","scripts"])}),mn=D.object({type:D.enum(["forms","hooks","jobs","scripts"]),position:D.tuple([D.number(),D.number()]),label:D.string(),id:D.string(),transitions:D.array(fn)}),yn=D.array(mn),me={"Content-Type":"application/json"};class vn{constructor(){S(this,"pubsub");this.pubsub=new ts}async getInitialData(){const e=await fetch("/_editor/api/workflow-editor/initial-data");if(e.ok){const t=await e.json();return yn.parse(t)}else throw this.pubsub.publish("error",{message:await e.text(),action:"getInitialData"}),new Error("Failed to fetch initial data")}async move(e){const t=await fetch("/_editor/api/workflow-editor/move",{method:"POST",headers:me,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"move"}),new Error("Failed to move nodes")}async delete(e){const t=await fetch("/_editor/api/workflow-editor/delete",{method:"POST",headers:me,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"delete"}),new Error("Failed to delete nodes")}async addNodes(e){const t=await fetch("/_editor/api/workflow-editor/add-nodes",{method:"POST",headers:me,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"addNodes"}),new Error("Failed to add nodes")}async duplicateNodes(e){const t=await fetch("/_editor/api/workflow-editor/duplicate-nodes",{method:"POST",headers:me,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"duplicateNodes"}),new Error("Failed to duplicate nodes")}async addTransition(e){const t=await fetch("/_editor/api/workflow-editor/add-transition",{method:"POST",headers:me,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"duplicateNodes"}),new Error("Failed to duplicate nodes")}}const K=new vn,_n="#ababab",gn="#e55b70";function hs(r,e,t){const s=e.projectedCenter(r);let n;if(t instanceof j){const i=t.projectedRect(r),o=Ye(i);n=zt(s,G(s,o),t.projectedRect(r))}else n=r.mouseState.mousePos;return{p1:zt(n,G(n,s),e.projectedRect(r)),p2:n}}function ps(r,e,t,s=!1){const{p1:n,p2:a}=hs(r,e,t),i=20,o=10;if(As(n,a)<2*i)return;const c=Math.atan2(a.y-n.y,a.x-n.x);r.ctx.strokeStyle=s?gn:_n,r.ctx.lineWidth=4,r.ctx.lineJoin="round",r.ctx.lineCap="round",r.ctx.beginPath(),r.ctx.moveTo(n.x+i*Math.cos(c),n.y+i*Math.sin(c)),r.ctx.lineTo(a.x-i*Math.cos(c),a.y-i*Math.sin(c)),r.ctx.moveTo(a.x-i*Math.cos(c)-o*Math.cos(c-Math.PI/6),a.y-i*Math.sin(c)-o*Math.sin(c-Math.PI/6)),r.ctx.lineTo(a.x-i*Math.cos(c),a.y-i*Math.sin(c)),r.ctx.lineTo(a.x-i*Math.cos(c)-o*Math.cos(c+Math.PI/6),a.y-i*Math.sin(c)-o*Math.sin(c+Math.PI/6)),r.ctx.stroke()}class pe{constructor(e,t,s){S(this,"sourceType");S(this,"sourceId");S(this,"dto");if(!s.targetPath)throw new Error(`Link ${s.id} has no target`);this.sourceType=e,this.sourceId=t,this.dto=s}get sourceNodeId(){return this.sourceId}get sourceNodeType(){return this.sourceType}get targetNodeId(){return this.dto.targetPath}get targetNodeType(){return this.dto.targetType}get id(){return this.dto.id}clone(e,t){return new pe(this.sourceType,e,{...this.dto,id:Ws(),targetPath:t})}isHovering(e,t){const s=e.nodes.find(i=>i.id===this.sourceNodeId),n=e.nodes.find(i=>i.id===this.targetNodeId);if(!s)throw new Error(`Source node ${this.sourceId} not found`);if(!n)throw new Error(`Target node ${this.targetNodeId} not found`);const a={radius:10,segment:hs(e,s,n)};return Ls(t,a)}static from(e,t,s){return new pe(e,t,s)}render(e){const t=e.nodes.find(a=>a.id===this.sourceNodeId),s=e.nodes.find(a=>a.id===this.targetNodeId);if(!t)throw new Error(`Source node ${this.sourceId} not found`);if(!s)throw new Error(`Target node ${this.targetNodeId} not found`);const n=e.selectedLinks.includes(this);ps(e,t,s,n)}}const xn="#5b5b5b",Je=18;class j{constructor(e){S(this,"dto");this.dto=e}addLinkTo(e,t){const s=pe.from(this.type,this.id,{id:Fe(),label:"",targetPath:t.id,targetType:t.type});return e.addLink(s),s}get id(){return this.dto.id}get type(){return this.dto.type}get title(){return this.dto.label}static from(e){return new j(e)}static new(e){return new j({type:e,id:Fe(),position:[0,0],label:`New ${e.slice(0,-1)}`,transitions:[]})}static async getSavedState(){const e=await K.getInitialData(),t=e.map(n=>j.from(n)),s=e.flatMap(n=>n.transitions.map(a=>pe.from(n.type,n.id,a)));return{nodes:t,links:s}}get position(){return{x:this.dto.position[0],y:this.dto.position[1],referential:"world"}}set position(e){this.dto.position=[e.x,e.y]}projectedCenter(e){const t=e.camera.worldPoint2screen(this.position);if(e.mouseState.state==="MOVING"&&e.selectedNodes.includes(this))return ye(t,G(e.mouseState.initialMousePos,e.mouseState.mousePos));if(e.mouseState.state==="ADDING_NEW_NODES"&&e.mouseState.nodes.includes(this)){const s=de(e.mouseState.nodes.map(a=>a.screenRect(e)));if(!s)throw new Error("No hull found");const n=Ye(s);return ye(t,G(n,e.mouseState.mousePos))}else return t}get icon(){return{scripts:qt,forms:Yt,jobs:Xt,hooks:Qt}[this.dto.type]}screenRect(e){const t=e.camera.worldPoint2screen(this.position),n=this.getTextSize(e).width+50*e.camera.zoom,a=e.camera.zoom*(Je+22);return{x:t.x-n/2,y:t.y-a/2,width:n,height:a,referential:"screen"}}projectedRect(e){const t=this.projectedCenter(e),n=this.getTextSize(e).width+50*e.camera.zoom,a=e.camera.zoom*(Je+22);return{x:t.x-n/2,y:t.y-a/2,width:n,height:a,referential:"screen"}}renderIcon(e,t){e.ctx.fillStyle=xn,e.ctx.save(),e.ctx.translate(t.x+8*e.camera.zoom,t.y+8*e.camera.zoom),e.ctx.scale(e.camera.zoom,e.camera.zoom),e.ctx.fill(new Path2D(this.icon)),e.ctx.restore()}setTextRenderingCtx(e){e.ctx.textAlign="left",e.ctx.textBaseline="middle",e.ctx.fillStyle="black";const t=(Je*e.camera.zoom).toFixed(0);e.ctx.font=`${t}px sans-serif`}getTextSize(e){return this.setTextRenderingCtx(e),e.ctx.measureText(this.dto.label)}renderLabel(e,t){const s=Ye(t),n=t.x;this.setTextRenderingCtx(e),!(e.ctx.measureText(this.dto.label).width>t.width)&&e.ctx.fillText(this.dto.label,n+40*e.camera.zoom,s.y)}renderCard(e,t){e.ctx.save(),e.ctx.fillStyle="white",e.ctx.shadowBlur=15,e.ctx.shadowColor="rgba(0,0,0,0.1)",e.ctx.fillRect(t.x,t.y,t.width,t.height),e.ctx.restore(),e.ctx.strokeStyle="gray",this.renderIcon(e,t),this.renderLabel(e,t)}renderSelf(e){const t=this.projectedRect(e);this.renderCard(e,t)}renderDuplicating(e){if(e.mouseState.state==="MOVING"&&e.mouseState.duplicating&&e.selectedNodes.includes(this)){const t=this.projectedRect(e),s=G(e.mouseState.mousePos,e.mouseState.initialMousePos),n=zs(t,s);this.renderCard(e,n)}}renderLinking(e){var t;e.mouseState.state!=="LINKING"||!e.selectedNodes.includes(this)||ps(e,this,(t=e.mouseState.snappedTarget)!=null?t:e.mouseState.mousePos)}render(e){this.renderLinking(e),this.renderSelf(e),this.renderDuplicating(e)}isHovering(e,t){return es(t,this.projectedRect(e))}translate(e){const t=ye(this.position,e);this.dto.position=[t.x,t.y]}clone(){return j.from({...this.dto,label:`${this.dto.label} (copy)`,id:Fe()})}}async function Jt(r,e,t){const s=e.selectedNodes[0];if(s.type==="forms")r.inspector={runtimeType:"forms",model:Me(await Gs.get(s.id)),inspectorMode:t};else if(s.type==="jobs")r.inspector={runtimeType:"jobs",model:Me(await ss.get(s.id)),inspectorMode:t};else if(s.type==="hooks")r.inspector={runtimeType:"hooks",model:Me(await Us.get(s.id)),inspectorMode:t};else if(s.type==="scripts")r.inspector={runtimeType:"scripts",model:Me(await ve.get(s.id)),inspectorMode:t};else throw new Error(`Unknown type ${s.type}`)}class _e{constructor(e){S(this,"canvasGui");S(this,"_inspector");S(this,"logService");this.canvasGui=e,window.__canvasGui=e,this._inspector=ge(null),this.logService=Hs.create()}static async init(e){const t=nt.create(e),s=new _e(t),a=navigator.userAgent.indexOf("Mac OS X")?"Option":"Alt";t.pubsub.subscribe("node:dblclick",()=>{Jt(s,t,"edit")});const i=at.create([{icon:Es,label:"Options (Double click/Enter)",click:async()=>{Jt(s,t,"edit")}},{icon:Cs,label:"Add transition (T)",click:()=>{t.addTransition()}},{icon:Ps,label:`Duplicate (${a} + Drag)`,click:()=>{t.duplicateSelection()}},{icon:Os,label:"Delete (Delete/Backspace)",click:()=>{t.deleteSelection()}}]);t.setFloatingMenu(i);let o=null;return addEventListener("mousemove",c=>o=c),e.parentElement.addEventListener("keydown",c=>{!o||(c.key==="f"?t.dragstart(j.new("forms"),o):c.key==="h"?t.dragstart(j.new("hooks"),o):c.key==="j"?t.dragstart(j.new("jobs"),o):c.key==="s"&&t.dragstart(j.new("scripts"),o))}),await this.reload(t),t.init(),K.pubsub.subscribe("error",({message:c})=>{vs.error({message:c}),this.reload(t)}),t.pubsub.subscribe("nodes:moved",c=>K.move(c.map(d=>({type:d.node.type,id:d.node.id,position:[d.to.x,d.to.y]})))),t.pubsub.subscribe("deleted",c=>K.delete([...c.nodes.map(d=>({id:d.id,type:d.type})),...c.links.map(d=>({id:d.id,type:"transitions"}))])),t.pubsub.subscribe("nodes:added",c=>K.addNodes(c.nodes.map(d=>({position:[d.position.x,d.position.y],type:d.type,id:d.id,title:d.title})))),t.pubsub.subscribe("nodes:duplicated",c=>K.duplicateNodes(c.map(({duplicate:d,original:l})=>({original_id:l.id,new_id:d.id,type:l.type,position:[d.position.x,d.position.y],title:d.title})))),t.pubsub.subscribe("transition:added",c=>K.addTransition(c.links.map(d=>({source:{type:d.sourceNodeType,id:d.sourceNodeId},target:{id:d.targetNodeId,type:d.targetNodeType},id:d.id})))),s}static async reload(e){const t=await K.getInitialData();e.clear(),t.forEach(s=>{e.addNode(j.from(s)),s.transitions.forEach(n=>{e.addLink(pe.from(s.type,s.id,n))})})}get inspector(){return this._inspector.value}set inspector(e){this._inspector.value=e}async closeInspector(){var t;const e=async()=>new Promise(s=>Js.confirm({title:"You have unsaved changes. Do you ",okText:"Save",cancelText:"Continue without saving",okButtonProps:{type:"primary"},cancelButtonProps:{danger:!0},onOk:async()=>{var n;await((n=this._inspector.value)==null?void 0:n.model.save()),await _e.reload(this.canvasGui),s()},onCancel:()=>s()}));(t=this._inspector.value)!=null&&t.model.hasChanges()&&await e(),this._inspector.value=null,_e.reload(this.canvasGui)}async dragstart(e,t){this.canvasGui.dragstart(j.new(e),t)}}const wn=Be({__name:"ScriptSettings",props:{script:{}},setup(r){return(e,t)=>(I(),M(x(rr),{layout:"vertical"},{default:w(()=>[b(x(qs),{label:"Name",required:""},{default:w(()=>[b(x(_s),{value:e.script.title,"onUpdate:value":t[0]||(t[0]=s=>e.script.title=s)},null,8,["value"])]),_:1}),b(Fs,{runtime:e.script},null,8,["runtime"])]),_:1}))}}),bn=Be({__name:"ScriptTester",props:{script:{},logService:{}},setup(r,{expose:e}){const t=r,s=ge(!1);async function n(){s.value=!0;try{const{stdout:a,stderr:i}=await t.script.test();t.logService.log({type:"stdout",log:a}),t.logService.log({type:"stderr",log:i})}finally{s.value=!1}}return e({test:n}),(a,i)=>(I(),qe("div",null,[b(x(gs),{loading:s.value,onClick:n},{default:w(()=>[$("run")]),_:1},8,["loading"])]))}});class kn{async list(e){const t=new URLSearchParams({stage:e});return await(await fetch(`/_editor/api/stage_runs?${t}`)).json()}}const Sn=new kn;class it{constructor(e){this.dto=e}static async list(e){return(await Sn.list(e)).map(s=>new it(s))}get id(){return this.dto.id}get data(){return this.dto.data}get assignee(){return this.dto.assignee}get stage(){return this.dto.stage}get status(){return this.dto.status}}const Nn=Be({__name:"StageInspector",props:{runtime:{}},setup(r){const e=r;function t(a){switch(a.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"}}}const{result:s,loading:n}=rs(()=>it.list(e.runtime instanceof ss?e.runtime.identifier:e.runtime.path));return(a,i)=>{var o;return I(),M(x(nr),{loading:x(n),"data-source":(o=x(s))!=null?o:[]},{header:w(()=>[b(x(Bt),null,{default:w(()=>[b(x(ee),null,{default:w(()=>[$("Status")]),_:1}),b(x(ee),null,{default:w(()=>[$("Assignee")]),_:1}),b(x(ee),null,{default:w(()=>[$("Data")]),_:1})]),_:1})]),renderItem:w(({item:c})=>[b(x(Bt),null,{default:w(()=>[b(x(ar),{color:t(c).color},{default:w(()=>[$(ce(t(c).text),1)]),_:2},1032,["color"]),b(x(ee),null,{default:w(()=>{var d;return[$(ce((d=c.assignee)!=null?d:"Anyone"),1)]}),_:2},1024),b(x(xs),{"tree-data":x($s)(c.data)},null,8,["tree-data"])]),_:2},1024)]),_:1},8,["loading","data-source"])}}}),Tn={class:"workflow-editor"},In={class:"title"},En={href:"/_editor/style"},Cn={class:"workflow-editor-content"},Pn={class:"workflow-toolbar"},On=["onDragstart"],Mn={class:"canvas-container",tabindex:"0"},Rn=Be({__name:"WorkflowEditor",setup(r){const e=ge(null),t=He(()=>{var C,F,k;const T=(k=(F=(C=l.value)==null?void 0:C.inspector)==null?void 0:F.model.title)!=null?k:"";return T.length>30?T.slice(0,30)+"...":T}),{result:s}=rs(()=>Is.get()),n=He(()=>{var T;return(T=s.value)==null?void 0:T.makeRunnerData().logoUrl}),a=He(()=>{var T;return(T=s.value)==null?void 0:T.makeRunnerData().brandName}),i=ws();function o(){i.push({name:"workspace"})}const c=[{icon:Yt,title:"Forms",type:"forms",description:"Wait for a user input",key:"F"},{icon:Qt,title:"Hooks",type:"hooks",description:"Wait for an external API call",key:"H"},{icon:Xt,title:"Jobs",type:"jobs",description:"Scheduled tasks",key:"J"},{icon:qt,title:"Scripts",type:"scripts",description:"Run a script",key:"S"}],d=ge(null),l=ie(null),E=(T,C)=>{var F,k;(F=C.dataTransfer)==null||F.setData("type",T),(k=l.value)==null||k.dragstart(T,C)};return bs(async()=>{if(!d.value)throw new Error("Canvas not found");l.value=await _e.init(d.value)}),(T,C)=>{var F;return I(),qe("div",Tn,[b(x(Wt),{style:{padding:"5px 10px"},onBack:o},{extra:w(()=>[b(Ys),b(ir)]),avatar:w(()=>[n.value?(I(),M(x(or),{key:0,src:n.value},null,8,["src"])):Z("",!0),Q("span",In,[b(x(ee),null,{default:w(()=>[$(ce(a.value||"New Workflow"),1)]),_:1}),Q("a",En,[b(At,{path:x(Ms),class:"edit-icon"},null,8,["path"])])])]),_:1}),Q("div",Cn,[Q("div",Pn,[(I(),qe(ks,null,Ss(c,k=>b(x(Ns),{key:k.type,placement:"right"},{title:w(()=>[b(x(dr),null,{default:w(()=>[b(x(ee),null,{default:w(()=>[$(ce(k.title),1)]),_:2},1024),b(x(ee),{keyboard:""},{default:w(()=>[$(ce(k.key),1)]),_:2},1024)]),_:2},1024)]),content:w(()=>[$(ce(k.description),1)]),default:w(()=>[Q("span",{draggable:"true",onDragstart:O=>E(k.type,O)},[b(At,{class:"toolbar-item",path:k.icon},null,8,["path"])],40,On)]),_:2},1024)),64))]),Q("div",Mn,[Q("canvas",{ref_key:"canvas",ref:d,class:"workflow-canvas"},null,512)])]),b(x(cr),{class:"workflow-inspector",open:!!((F=l.value)!=null&&F.inspector),width:640,"footer-style":{padding:0},onClose:C[1]||(C[1]=k=>{var O;return(O=l.value)==null?void 0:O.closeInspector()})},{title:w(()=>[b(x(Wt),{title:t.value},{footer:w(()=>{var k;return[(k=l.value)!=null&&k.inspector?(I(),M(x(lr),{key:0,"active-key":l.value.inspector.inspectorMode,"onUpdate:activeKey":C[0]||(C[0]=O=>l.value.inspector.inspectorMode=O)},{default:w(()=>[b(x(Ke),{key:"edit",tab:"Settings"}),b(x(Ke),{key:"list-stage-runs",tab:"Stage runs"}),b(x(Ke),{key:"start-abuble",tab:"Test"})]),_:1},8,["active-key"])):Z("",!0)]}),extra:w(()=>{var k,O;return[((O=(k=l.value)==null?void 0:k.inspector)==null?void 0:O.inspectorMode)==="edit"?(I(),M(Xs,{key:0,model:l.value.inspector.model},null,8,["model"])):Z("",!0)]}),_:1},8,["title"])]),default:w(()=>{var k,O,fe,ot,ct,dt,lt,ut,ht,pt,ft,mt,yt,vt,_t,gt,xt,wt,bt,kt,St,Nt,Tt,It,Et,Ct,Pt,Ot,Mt,Rt,Dt,Zt,jt,Lt;return[((O=(k=l.value)==null?void 0:k.inspector)==null?void 0:O.inspectorMode)==="list-stage-runs"?(I(),M(Nn,{key:0,runtime:l.value.inspector.model},null,8,["runtime"])):Z("",!0),((ot=(fe=l.value)==null?void 0:fe.inspector)==null?void 0:ot.runtimeType)==="forms"&&((dt=(ct=l.value)==null?void 0:ct.inspector)==null?void 0:dt.inspectorMode)==="edit"?(I(),M(Rs,{key:1,form:l.value.inspector.model},null,8,["form"])):Z("",!0),((ut=(lt=l.value)==null?void 0:lt.inspector)==null?void 0:ut.runtimeType)==="jobs"&&((pt=(ht=l.value)==null?void 0:ht.inspector)==null?void 0:pt.inspectorMode)==="edit"?(I(),M(tr,{key:2,job:l.value.inspector.model},null,8,["job"])):Z("",!0),((mt=(ft=l.value)==null?void 0:ft.inspector)==null?void 0:mt.runtimeType)==="hooks"&&((vt=(yt=l.value)==null?void 0:yt.inspector)==null?void 0:vt.inspectorMode)==="edit"?(I(),M(Qs,{key:3,hook:l.value.inspector.model},null,8,["hook"])):Z("",!0),((gt=(_t=l.value)==null?void 0:_t.inspector)==null?void 0:gt.runtimeType)==="scripts"&&((wt=(xt=l.value)==null?void 0:xt.inspector)==null?void 0:wt.inspectorMode)==="edit"?(I(),M(wn,{key:4,script:l.value.inspector.model},null,8,["script"])):Z("",!0),((kt=(bt=l.value)==null?void 0:bt.inspector)==null?void 0:kt.runtimeType)==="hooks"&&((Nt=(St=l.value)==null?void 0:St.inspector)==null?void 0:Nt.inspectorMode)==="start-abuble"?(I(),M(er,{key:5,hook:l.value.inspector.model,"log-service":l.value.logService},null,8,["hook","log-service"])):Z("",!0),((It=(Tt=l.value)==null?void 0:Tt.inspector)==null?void 0:It.runtimeType)==="forms"&&((Ct=(Et=l.value)==null?void 0:Et.inspector)==null?void 0:Ct.inspectorMode)==="start-abuble"?(I(),M(Ds,{key:6,ref_key:"formTester",ref:e,form:l.value.inspector.model,"log-service":l.value.logService},null,8,["form","log-service"])):Z("",!0),((Ot=(Pt=l.value)==null?void 0:Pt.inspector)==null?void 0:Ot.runtimeType)==="jobs"&&((Rt=(Mt=l.value)==null?void 0:Mt.inspector)==null?void 0:Rt.inspectorMode)==="start-abuble"?(I(),M(sr,{key:7,job:l.value.inspector.model,"log-service":l.value.logService},null,8,["job","log-service"])):Z("",!0),((Zt=(Dt=l.value)==null?void 0:Dt.inspector)==null?void 0:Zt.runtimeType)==="scripts"&&((Lt=(jt=l.value)==null?void 0:jt.inspector)==null?void 0:Lt.inspectorMode)==="start-abuble"?(I(),M(bn,{key:8,script:l.value.inspector.model,"log-service":l.value.logService},null,8,["script","log-service"])):Z("",!0)]}),footer:w(()=>{var k,O,fe;return[((O=(k=l.value)==null?void 0:k.inspector)==null?void 0:O.inspectorMode)==="start-abuble"?(I(),M(Ks,{key:0,runtime:l.value.inspector.runtimeType,"log-service":l.value.logService,onRestart:(fe=e.value)==null?void 0:fe.restart},null,8,["runtime","log-service","onRestart"])):Z("",!0)]}),_:1},8,["open"])])}}});const Ia=Ts(Rn,[["__scopeId","data-v-b6d02a33"]]);export{Ia as default};
//# sourceMappingURL=WorkflowEditor.ef027446.js.map

var _=Object.defineProperty;var m=(e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var i=(e,t,n)=>(m(e,typeof t!="symbol"?t+"":t,n),n);import{d as g,J as v,I as y,a as c,b as s,o as d,f as o,u as r,de as h,cO as w,A as I,g as p,da as u,_ as b,r as P,eb as x}from"./jwt-decode.esm.99ab6811.js";import{_ as W}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.641a1cad.js";import{B as j}from"./BaseLayout.94d4f34d.js";import{l as f}from"./fetch.cf8fcf75.js";import"./router.522cc320.js";import{a as A}from"./project.3b3ae17e.js";import"./tables.39de072e.js";import"./Logo.dfb4218c.js";import"./index.278122dc.js";import"./record.b2d1cb6c.js";import"./string.c22b55bc.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ba77dd05-08a0-4f9d-ab47-4064b9cf0ada",e._sentryDebugIdIdentifier="sentry-dbid-ba77dd05-08a0-4f9d-ab47-4064b9cf0ada")}catch{}})();const E=g({__name:"View",props:{controller:{}},setup(e){const t=e,n=t.controller.loadingPercentage();return v(()=>{t.controller.start()}),y(()=>{t.controller.cleanUp()}),(a,l)=>(d(),c(j,null,{content:s(()=>[o(r(h),{align:"center",justify:"center",style:{width:"100vw",height:"100dvh"}},{default:s(()=>[o(r(h),{gap:"large",align:"center",justify:"space-evenly",vertical:"",style:{width:"45%","min-width":"600px",height:"100%"}},{default:s(()=>[o(W,{size:"large"}),o(r(w),{size:[10,10],"show-info":!1,percent:r(n),"stroke-color":"#EA576A"},null,8,["percent"]),o(r(I),{level:3},{default:s(()=>[p("Preparing your environment")]),_:1}),r(n)<100?(d(),c(r(u),{key:0},{default:s(()=>[p("We are setting things up... This may take up to 1 minute.")]),_:1})):(d(),c(r(u),{key:1},{default:s(()=>[p("You will be redirected soon")]),_:1}))]),_:1})]),_:1})]),_:1}))}});const T=b(E,[["__scopeId","data-v-0794e790"]]);function k(e,t){if(!e)return"";const n=t.toString();if(!n)return e;const l=e.includes("?")?"&":"?";return`${e}${l}${n}`}class R{constructor(t,n,a=f){i(this,"projectId");i(this,"loading");i(this,"fetch",f);i(this,"interval",null);i(this,"urls",null);i(this,"totalWaitTime");i(this,"poolingInterval");i(this,"pingResponded",!1);i(this,"redirectPath");this.projectId=t,this.loading=P(0),this.fetch=a,this.totalWaitTime=6e4,this.poolingInterval=2500,this.redirectPath=n}increment(){this.loading.value+=100/(this.totalWaitTime/this.poolingInterval)}speedUp(){this.totalWaitTime=5e3,this.poolingInterval=500,this.interval&&clearInterval(this.interval),this.interval=setInterval(async()=>{this.increment(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}navigate(){if(this.urls){const t=new URLSearchParams;this.redirectPath&&t.set("redirect",this.redirectPath);const n=k(this.urls.redirect,t);window.location.replace(n)}this.cleanUp()}async ping(){if(!this.urls)return!1;if(this.pingResponded)return!0;const t=await this.fetch(this.urls.ping,{signal:AbortSignal.timeout(500)});return this.pingResponded=t.status===200,this.pingResponded}async start(){const t=await A.startWebEditor(this.projectId);this.urls=t,this.interval=setInterval(async()=>{this.increment(),this.pingResponded||await this.ping()&&this.speedUp(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}cleanUp(){this.interval&&clearInterval(this.interval)}loadingPercentage(){return this.loading}}const O=g({__name:"WebEditor",setup(e){const t=x(),n=t.params.projectId,a=t.query.redirect,l=new R(n,a);return(U,V)=>(d(),c(T,{controller:r(l)},null,8,["controller"]))}});export{O as default};
//# sourceMappingURL=WebEditor.c265b48f.js.map

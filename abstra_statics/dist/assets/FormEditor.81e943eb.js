import{d as N,r as R,G as $,u as D,b as c,c as m,v as e,F as B,J as L,H as x,V as M,Y as I,B as U,y as t,e as u,T as G,N as J,O,q as W,t as F,w as y,K as Y,L as Q,a as X,R as V,E as Z}from"./registerWidgets.fff064a1.js";import{a as q,L as ee}from"./CircularLoading.59d7fd3d.js";import{E as te}from"./Error.de2ae46c.js";import{R as ae,F as oe}from"./broker.b9a40809.js";import{R as se,T as re,B as le,a as A}from"./BackButton.467d93ce.js";import{j as ne,i as ie}from"./icons.b8ff2c28.js";import{l as H}from"./WidgetsFrame.7e48c68b.js";import{F as ce}from"./forms.7bc6baea.js";import{W as ue}from"./workspaces.32af92db.js";import{S as de}from"./SmartConsole.03445c4c.js";import"./dashes.f5f65b41.js";import"./utils.3371dfe5.js";import"./runnerData.81f4c073.js";import"./hooks.039c0cd9.js";import"./jobs.af366134.js";import"./index.314cf40a.js";import"./Modal.2ceba592.js";const pe="forms_workspace_id_path_key",C=h=>(J("data-v-83062094"),h=h(),O(),h),me={class:"form-settings"},he={class:"content"},fe={class:"subsection-label"},ve={class:"property-label"},_e=["value","placeholder","onChange"],ye={class:"content"},be={class:"property"},ge=C(()=>e("div",{class:"property-label"},"Start smart form automatically",-1)),ke={class:"property"},we=C(()=>e("div",{class:"property-label"}," Allow the user to restart the smart form after it is over ",-1)),Se={class:"property column"},xe=C(()=>e("div",{class:"property-label"},"Smart Form Path",-1)),Ce={key:0,class:"error"},Ee={class:"path-input"},Fe=["value","disabled"],Re=C(()=>e("div",{class:"home-label"},"Home Form",-1)),Pe=["checked"],Ke=N({__name:"FormSettings",props:{form:null},setup(h){const i=h,o=R(i.form),f=[{label:"Welcome Screen",props:[{label:"Title",fallbackKey:"title",valueKey:"welcomeTitle"},{label:"Subtitle",valueKey:"startMessage"},{label:"Start button text",valueKey:"startButtonText"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"endMessage"},{label:"Restart button text",valueKey:"restartButtonText"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"errorMessage"}]}],b=r=>{const s=r.value;if(s===""){G.error("Path must not be empty"),r.value=i.form.path;return}_(s)},g=$(()=>i.form.path===""),n=r=>{_(r?"":i.form.path)},_=async r=>{if(!i.form)return;d.pathError=null,(i.form.path=r)||(d.pathError=w)},d=D({pathError:null,sectionsShown:[!0,!1,!1]}),k=r=>{r.detail.includes(pe)&&(d.pathError=w)},w="This path is already being used by another form or dash on your workspace";return addEventListener("hasura-error",k),(r,s)=>(c(),m("div",me,[e("div",he,[(c(),m(B,null,L(f,l=>e("div",{key:l.label,class:"subsection"},[e("div",fe,x(l.label),1),(c(!0),m(B,null,L(l.props,p=>{var v;return c(),m("div",{key:p.label,class:"property column"},[e("div",ve,x(p.label),1),e("input",{class:"property-input",type:"text",value:o.value[p.valueKey],placeholder:(v=p.fallbackKey?o.value[p.fallbackKey]:null)!=null?v:"Enter message",onChange:E=>o.value[p.valueKey]=E.target.value},null,40,_e)])}),128))])),64))]),e("div",ye,[e("div",be,[M(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>o.value.autoStart=l),class:"checkbox-input",type:"checkbox"},null,512),[[I,o.value.autoStart]]),ge]),e("div",ke,[M(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>o.value.allowRestart=l),class:"checkbox-input",type:"checkbox"},null,512),[[I,o.value.allowRestart]]),we]),e("div",Se,[xe,d.pathError?(c(),m("div",Ce,x(d.pathError),1)):U("",!0),e("div",Ee,[e("input",{value:o.value.path,class:"property-input",type:"text",disabled:t(g),onChange:s[2]||(s[2]=l=>b(l.target))},null,40,Fe),Re,e("input",{type:"checkbox",checked:t(g),onChange:s[3]||(s[3]=l=>n(l.target.checked))},null,40,Pe)])])]),u(se,{runtime:o.value},null,8,["runtime"])]))}});const Te=W(Ke,[["__scopeId","data-v-83062094"]]),Be={class:"page"},Le={key:1,class:"error"},Me=N({__name:"FormEditor",setup(h){const i=Y(),o=Q(),f=D({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});addEventListener("keydown",a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),s())});const b=R(null),{loading:g,result:n,error:_,refetch:d}=q(async()=>{const a=await ce.get(o.params.formPath);return v(),a}),{result:k}=q(()=>ue.get()),w=()=>{n.value&&i.push(`/_editor/form/${encodeURIComponent(n.value.path)}/preview`)},r=R(!1);async function s(){var a;r.value=!0;try{await((a=n.value)==null?void 0:a.save())}finally{r.value=!1}}const l=$(()=>ae.create({isLocal:!1,formPath:o.params.formPath,isPreview:!0})),p=()=>{H.clear()},v=async()=>{var a;if(!f.started){(a=b.value)==null||a.run();return}H.log({type:"restart"}),f.started=!1},E=({path:a,type:S})=>{S==="dash"?i.push({name:"dashEditor",params:{dashPath:a},query:o.query}):(i.push({name:"editor",params:{formPath:a},query:o.query}),d())},j=()=>{f.started=!0},z=()=>{f.started=!1};return(a,S)=>{const P=X("icon");return c(),m("div",Be,[t(g)||!t(n)||!t(k)?(c(),F(ee,{key:0})):t(_)?(c(),m("div",Le,[u(te,{error:t(_),onReload:t(d)},null,8,["error","onReload"])])):(c(),F(re,{key:2},{left:y(()=>[u(le,{link:"/_editor/forms"})]),right:y(()=>{var K,T;return[e("button",{class:"preview-button",onClick:w},[u(P,{class:"icon",path:t(ne),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),V(" Preview ")]),e("button",{class:Z(["save-button",{changes:(K=t(n))==null?void 0:K.hasChanges()}]),onClick:S[0]||(S[0]=Ie=>s())},[u(P,{class:"icon",path:t(ie),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),V(" "+x(r.value?"Saving ...":(T=t(n))!=null&&T.hasChanges()?"Save":"Saved"),1)],2)]}),default:y(()=>[u(A,{title:"Preview"},{default:y(()=>[u(oe,{ref_key:"runner",ref:b,form:t(n).makeRunnerData(t(k)),params:t(o).query,"is-preview":!0,"enable-auto-focus":!1,broker:t(l),style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:E,onLogout:v,onExit:z,onStart:j},null,8,["form","params","broker"])]),_:1}),u(A,{title:"Settings"},{default:y(()=>[u(Te,{form:t(n)},null,8,["form"])]),_:1})]),_:1})),t(n)?(c(),F(de,{key:3,runtime:"forms",onRestart:v,onClearTerminal:p})):U("",!0)])}}});const Ze=W(Me,[["__scopeId","data-v-fe8d4409"]]);export{Ze as default};
//# sourceMappingURL=FormEditor.81e943eb.js.map

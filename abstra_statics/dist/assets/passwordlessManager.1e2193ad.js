var w=Object.defineProperty;var y=(r,t,e)=>t in r?w(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var u=(r,t,e)=>(y(r,typeof t!="symbol"?t+"":t,e),e);import{ep as f}from"./registerWidgets.6f5be576.js";import{P as g}from"./pubsub.1dc45978.js";import{S as d}from"./storage.d8b26e7f.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[t]="39d4f4cd-14b5-44b4-8d8b-1e18a9a9eb09",r._sentryDebugIdIdentifier="sentry-dbid-39d4f4cd-14b5-44b4-8d8b-1e18a9a9eb09")}catch{}})();const m=()=>window.location.host.includes(".abstra.io"),v={authn:"/api/authn","cloud-api":"/api/cloud-api"},E={authn:"https://authn.abstra.cloud","cloud-api":"https://cloud-api.abstra.cloud"},l=r=>{const t="VITE_"+f.toUpper(f.snakeCase(r)),e={VITE_SENTRY_RELEASE:"b63608ec4da46385eae1a766eab9a96b6a0bbab8",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}[t];return e||(m()?v[r]:E[r])};function p(r){this.message=r}p.prototype=new Error,p.prototype.name="InvalidCharacterError";var b=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,"");if(t.length%4==1)throw new p("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,n,o=0,a=0,h="";n=t.charAt(a++);~n&&(e=o%4?64*e+n:n,o++%4)?h+=String.fromCharCode(255&e>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return h};function k(r){var t=r.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(b(e).replace(/(.)/g,function(n,o){var a=o.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}(t)}catch{return b(t)}}function c(r){this.message=r}function I(r,t){if(typeof r!="string")throw new c("Invalid token specified");var e=(t=t||{}).header===!0?0:1;try{return JSON.parse(k(r.split(".")[e]))}catch(n){throw new c("Invalid token specified: "+n.message)}}c.prototype=new Error,c.prototype.name="InvalidTokenError";const s=class{constructor(){u(this,"pubsub");this.pubsub=new g}async authenticate(t){try{const e=await fetch(`${l("authn")}/authenticate`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:t})});if(!e.ok)throw new Error(await e.text());return null}catch(e){return e.message}}async verify(t,e){const n=await fetch(`${l("authn")}/verify`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:t,token:e})});if(!n.ok)throw new Error(await n.text());const o=await n.json();this.saveJWT(o.jwt);const a=this.getUser();return this.pubsub.publish("authenticated",a),a}saveJWT(t){d.set(s.key,t)}getJWT(){return d.get(s.key)}getUser(){const t=this.getJWT();if(t)try{const e=I(t);if(e.exp&&e.exp>Date.now()/1e3)return{jwt:t,claims:e}}catch{console.warn("Invalid JWT")}return null}removeUser(){d.remove(s.key)}getUserHeaders(t="User-Authorization"){const e=this.getJWT();return e?{[t]:`Bearer ${e}`}:{}}};let i=s;u(i,"key","hackerforms:auth:jwt");const R=new i;export{R as p,l as t};
//# sourceMappingURL=passwordlessManager.1e2193ad.js.map

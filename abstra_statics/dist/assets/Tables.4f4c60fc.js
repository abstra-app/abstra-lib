import{_ as O}from"./AbstraButton.vue_vue_type_script_setup_true_lang.834284b3.js";import{o as De}from"./omniChatStore.fa3dfb06.js";import{a as J}from"./string.1f191132.js";import{d as ye,at as Q,c as E,o as u,ac as b,ae as $e,h as ae,ew as Ze,e as x,dg as Je,r as Z,i,f as s,b as n,u as e,aY as me,df as q,g as _,t as g,dj as te,S as Te,eB as je,a as j,eJ as Me,bT as Se,ad as ue,cD as Ue,cE as pe,bQ as fe,d0 as Ae,aI as Qe,M as he,cW as Xe,cU as Ce,cM as ee,al as et,X as tt,ax as at,ec as lt,eA as nt,j as st,A as rt,cC as Ie}from"./jwt-decode.esm.44a21b56.js";import{C as ot,A as it,k as dt,a as ut,g as ct}from"./router.17c334fa.js";import{p as pt,T as mt}from"./tables.8ed5c8f8.js";import{T as ft}from"./TableCard.ed074328.js";import{_ as yt}from"./TablesTabs.vue_vue_type_script_setup_true_lang.5c883a0b.js";import{u as ce}from"./uuid.3efdc2d0.js";import{read as Ve,utils as ve}from"./xlsx.89ea120e.js";import{A as _t}from"./index.81cf48bf.js";import{u as gt}from"./useTables.117b101b.js";import"./record.298f8971.js";import"./PhCopySimple.vue.4c5334d9.js";import"./ts.worker.c0de3b32.js";import"./PhKey.vue.cbd4b2bc.js";import"./PhPencil.vue.87bbb665.js";import"./vue-flow-core.bb42970c.js";import"./Card.c0b56e3b.js";(function(){try{var B=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},D=new Error().stack;D&&(B._sentryDebugIds=B._sentryDebugIds||{},B._sentryDebugIds[D]="9ce28a7e-dc34-4f8c-99e3-39d1addb4a9e",B._sentryDebugIdIdentifier="sentry-dbid-9ce28a7e-dc34-4f8c-99e3-39d1addb4a9e")}catch{}})();const bt=["width","height","fill","transform"],vt={key:0},ht=x("path",{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM183,80H160V57ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm100.49-72.49a12,12,0,0,1-17,17L140,153v31a12,12,0,0,1-24,0V153l-3.51,3.52a12,12,0,0,1-17-17l24-24a12,12,0,0,1,17,0Z"},null,-1),wt=[ht],kt={key:1},xt=x("path",{d:"M208,88H152V32Z",opacity:"0.2"},null,-1),Nt=x("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Zm-42.34-77.66a8,8,0,0,1-11.32,11.32L136,139.31V184a8,8,0,0,1-16,0V139.31l-10.34,10.35a8,8,0,0,1-11.32-11.32l24-24a8,8,0,0,1,11.32,0Z"},null,-1),Dt=[xt,Nt],Mt={key:2},St=x("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34Zm-56,67.32a8,8,0,0,1-11.32,0L136,139.31V184a8,8,0,0,1-16,0V139.31l-10.34,10.35a8,8,0,0,1-11.32-11.32l24-24a8,8,0,0,1,11.32,0l24,24A8,8,0,0,1,157.66,149.66ZM152,88V44l44,44Z"},null,-1),At=[St],Ct={key:3},It=x("path",{d:"M212.24,83.76l-56-56A6,6,0,0,0,152,26H56A14,14,0,0,0,42,40V216a14,14,0,0,0,14,14H200a14,14,0,0,0,14-14V88A6,6,0,0,0,212.24,83.76ZM158,46.48,193.52,82H158ZM200,218H56a2,2,0,0,1-2-2V40a2,2,0,0,1,2-2h90V88a6,6,0,0,0,6,6h50V216A2,2,0,0,1,200,218Zm-43.76-78.24a6,6,0,1,1-8.48,8.48L134,134.49V184a6,6,0,0,1-12,0V134.49l-13.76,13.75a6,6,0,0,1-8.48-8.48l24-24a6,6,0,0,1,8.48,0Z"},null,-1),Vt=[It],$t={key:4},Zt=x("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Zm-42.34-77.66a8,8,0,0,1-11.32,11.32L136,139.31V184a8,8,0,0,1-16,0V139.31l-10.34,10.35a8,8,0,0,1-11.32-11.32l24-24a8,8,0,0,1,11.32,0Z"},null,-1),Tt=[Zt],jt={key:5},Ut=x("path",{d:"M210.83,85.17l-56-56A4,4,0,0,0,152,28H56A12,12,0,0,0,44,40V216a12,12,0,0,0,12,12H200a12,12,0,0,0,12-12V88A4,4,0,0,0,210.83,85.17ZM156,41.65,198.34,84H156ZM200,220H56a4,4,0,0,1-4-4V40a4,4,0,0,1,4-4h92V88a4,4,0,0,0,4,4h52V216A4,4,0,0,1,200,220Zm-45.17-78.83a4,4,0,0,1-5.66,5.66L132,129.66V184a4,4,0,0,1-8,0V129.66l-17.17,17.17a4,4,0,0,1-5.66-5.66l24-24a4,4,0,0,1,5.66,0Z"},null,-1),Bt=[Ut],Ft={name:"PhFileArrowUp"},zt=ye({...Ft,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(B){const D=B,X=Q("weight","regular"),T=Q("size","1em"),$=Q("color","currentColor"),R=Q("mirrored",!1),v=E(()=>{var c;return(c=D.weight)!=null?c:X}),S=E(()=>{var c;return(c=D.size)!=null?c:T}),I=E(()=>{var c;return(c=D.color)!=null?c:$}),h=E(()=>D.mirrored!==void 0?D.mirrored?"scale(-1, 1)":void 0:R?"scale(-1, 1)":void 0);return(c,f)=>(u(),b("svg",Ze({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:S.value,height:S.value,fill:I.value,transform:h.value},c.$attrs),[$e(c.$slots,"default"),v.value==="bold"?(u(),b("g",vt,wt)):v.value==="duotone"?(u(),b("g",kt,Dt)):v.value==="fill"?(u(),b("g",Mt,At)):v.value==="light"?(u(),b("g",Ct,Vt)):v.value==="regular"?(u(),b("g",$t,Tt)):v.value==="thin"?(u(),b("g",jt,Bt)):ae("",!0)],16,bt))}}),Et=["width","height","fill","transform"],Ht={key:0},Pt=x("path",{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},null,-1),Lt=[Pt],Ot={key:1},Rt=x("path",{d:"M192,112a80,80,0,1,1-80-80A80,80,0,0,1,192,112Z",opacity:"0.2"},null,-1),Wt=x("path",{d:"M229.66,218.34,179.6,168.28a88.21,88.21,0,1,0-11.32,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"},null,-1),Gt=[Rt,Wt],Kt={key:2},Yt=x("path",{d:"M168,112a56,56,0,1,1-56-56A56,56,0,0,1,168,112Zm61.66,117.66a8,8,0,0,1-11.32,0l-50.06-50.07a88,88,0,1,1,11.32-11.31l50.06,50.06A8,8,0,0,1,229.66,229.66ZM112,184a72,72,0,1,0-72-72A72.08,72.08,0,0,0,112,184Z"},null,-1),qt=[Yt],Jt={key:3},Qt=x("path",{d:"M228.24,219.76l-51.38-51.38a86.15,86.15,0,1,0-8.48,8.48l51.38,51.38a6,6,0,0,0,8.48-8.48ZM38,112a74,74,0,1,1,74,74A74.09,74.09,0,0,1,38,112Z"},null,-1),Xt=[Qt],ea={key:4},ta=x("path",{d:"M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"},null,-1),aa=[ta],la={key:5},na=x("path",{d:"M226.83,221.17l-52.7-52.7a84.1,84.1,0,1,0-5.66,5.66l52.7,52.7a4,4,0,0,0,5.66-5.66ZM36,112a76,76,0,1,1,76,76A76.08,76.08,0,0,1,36,112Z"},null,-1),sa=[na],ra={name:"PhMagnifyingGlass"},oa=ye({...ra,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(B){const D=B,X=Q("weight","regular"),T=Q("size","1em"),$=Q("color","currentColor"),R=Q("mirrored",!1),v=E(()=>{var c;return(c=D.weight)!=null?c:X}),S=E(()=>{var c;return(c=D.size)!=null?c:T}),I=E(()=>{var c;return(c=D.color)!=null?c:$}),h=E(()=>D.mirrored!==void 0?D.mirrored?"scale(-1, 1)":void 0:R?"scale(-1, 1)":void 0);return(c,f)=>(u(),b("svg",Ze({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:S.value,height:S.value,fill:I.value,transform:h.value},c.$attrs),[$e(c.$slots,"default"),v.value==="bold"?(u(),b("g",Ht,Lt)):v.value==="duotone"?(u(),b("g",Ot,Gt)):v.value==="fill"?(u(),b("g",Kt,qt)):v.value==="light"?(u(),b("g",Jt,Xt)):v.value==="regular"?(u(),b("g",ea,aa)):v.value==="thin"?(u(),b("g",la,sa)):ae("",!0)],16,Et))}}),ia={key:0},da={class:"ant-upload-drag-icon"},ua={class:"ant-upload-text"},ca={class:"ant-upload-hint"},pa={key:1},ma={style:{"margin-top":"1rem","max-height":"60vh","overflow-y":"auto"}},fa=ye({__name:"ImportSpreadsheetsModal",props:{open:{type:Boolean},projectId:{}},emits:["update:open","success"],setup(B,{emit:D}){const X=Je.Dragger,T=B,$=D,R=E({get:()=>T.open,set:t=>$("update:open",t)}),v=()=>{const l=(typeof navigator<"u"?navigator.language:"en").split(/[-_]/)[0];return["pt","es","fr","de","it","nl","pl","ru","hi","zh"].includes(l)?"dd/MM/yyyy":"MM/dd/yyyy"},S=Z(1),I=Z([]),h=Z([]),c=Z([]),f=Z(!1),le=Z(!1),G=Z(v()),H=Z(!1),ne=Z("01/02/2025"),se=Z([]),_e=pt.map(t=>({label:t,value:t})),U=[{title:"",dataIndex:"selected",key:"selected",width:50},{title:i.translate("i18n_tables_original_column"),dataIndex:"originalName",key:"originalName",width:150},{title:i.translate("i18n_tables_mapped_column"),dataIndex:"mappedName",key:"mappedName",width:200},{title:i.translate("i18n_tables_column_type"),dataIndex:"type",key:"type",width:120},{title:i.translate("i18n_tables_sample_value"),dataIndex:"sample",key:"sample",width:150}],y=t=>J(t,!0),ie=t=>J(t,!1),M=t=>{const a=t.replace(/\.(csv|xlsx|xls)$/i,"").replace(/\s*-\s*/g," ").replace(/_-_/g,"_").replace(/-_/g,"_").replace(/_-/g,"_");return J(a,!1,!1,!0,!1,!1)},Be=t=>{if(t==null)return"(empty)";if(t instanceof Date)return t.toLocaleDateString("pt-BR");if(typeof t=="string"){const l=/^(\d{2})\/(\d{2})\/(\d{4})$/,a=t.match(l);if(a){const[,p,d,o]=a,m=new Date(parseInt(o),parseInt(d)-1,parseInt(p));if(m.getFullYear()===parseInt(o)&&m.getMonth()===parseInt(d)-1&&m.getDate()===parseInt(p))return m.toLocaleDateString("pt-BR")}}return typeof t=="object"?JSON.stringify(t).substring(0,50):String(t).substring(0,50)},Fe=(t,l)=>{if(t==null||t==="")return null;if(l==="date"){if(t instanceof Date)return t.toISOString();if(typeof t=="number"&&t>100&&t<1e5){const d=new Date(Date.UTC(1899,11,31)),o=24*60*60*1e3,m=t>60?t-1:t;return new Date(d.getTime()+m*o).toISOString()}const a=/^(\d{2})\/(\d{2})\/(\d{4})$/,p=String(t).trim().match(a);if(p){const[,d,o,m]=p,r=new Date(Date.UTC(parseInt(m),parseInt(o)-1,parseInt(d)));if(!isNaN(r.getTime()))return r.toISOString()}if(typeof t=="string"||typeof t=="number"){const d=new Date(t);if(!isNaN(d.getTime()))return d.toISOString()}}return t},ze=t=>{const l=String(t).trim(),a=/^(\d{2})\/(\d{2})\/(\d{4})$/,p=l.match(a);if(!p)return!1;const[,d,o,m]=p,r=parseInt(d),w=parseInt(o);return r>=1&&r<=12&&w>=1&&w<=12},we=t=>{for(const l of t)for(const[,a]of Object.entries(l))if(typeof a=="string"&&ze(a))return a;return null},Ee=t=>{if(t>=100&&t<=1e5){const l=new Date(1899,11,31),a=24*60*60*1e3,p=t>60?t-1:t;return new Date(l.getTime()+p*a)}return null},ge=(t,l)=>{const a=String(t).trim(),p=Number(a);if(!isNaN(p)&&a===String(p)){const C=Ee(p);if(C)return C}const d=/^(\d{2})\/(\d{2})\/(\d{4})$/,o=a.match(d);if(!o)return null;const[,m,r,w]=o,K=parseInt(l==="dd/MM/yyyy"?m:r),V=parseInt(l==="dd/MM/yyyy"?r:m),A=new Date(parseInt(w),V-1,K);return A.getFullYear()===parseInt(w)&&A.getMonth()===V-1&&A.getDate()===K?A:null},ke=t=>{const l=t.filter(r=>r!=null&&r!=="");return l.length===0?"text":l.every(r=>r instanceof Date)||l.every(r=>{const w=String(r),K=/^(\d{2})\/(\d{2})\/(\d{4})$/,V=w.match(K);if(V){const[,A,C,P]=V,re=new Date(parseInt(P),parseInt(C)-1,parseInt(A));return re.getFullYear()===parseInt(P)&&re.getMonth()===parseInt(C)-1&&re.getDate()===parseInt(A)}return!1})||l.every(r=>ge(String(r),G.value)!==null||!isNaN(Date.parse(String(r))))?"date":l.every(r=>r===!0||r===!1||r==="true"||r==="false"||r===1||r===0)?"boolean":l.every(r=>String(r).match(/^\d{2}\/\d{2}\/\d{4}$/)?!1:typeof r=="number"||!isNaN(Number(r)))?"numeric":"text"},He=t=>(t.type==="text/csv"||t.type==="application/vnd.ms-excel"||t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||ee.error(i.translate("i18n_tables_invalid_file_type")),!1),Pe=t=>{const l=I.value.indexOf(t);l>-1&&I.value.splice(l,1)},xe=async(t,l=!1)=>new Promise((a,p)=>{const d=new FileReader;d.onload=o=>{var m;try{const r=(m=o.target)==null?void 0:m.result,w=Ve(r,{type:"string",cellDates:!1}),K=w.SheetNames[0],V=w.Sheets[K],A=ve.sheet_to_json(V,{defval:null,raw:!0});if(A.length===0){p(new Error("Empty file"));return}if(!l){const F=we(A);if(F){se.value=A,ne.value=F,H.value=!0,a([]);return}}const C=A.map(F=>{const Y={};for(const[z,N]of Object.entries(F))if(typeof N=="string"){const L=ge(N,G.value);Y[z]=L||N}else Y[z]=N;return Y}),re=Object.keys(A[0]).map(F=>{const Y=C.map(k=>k[F]),z=ke(Y),N=Y.find(k=>k!=null&&k!=="")||null;let L=N;if(z==="date"&&typeof N=="number"&&N>=100&&N<=1e5){const k=new Date(1899,11,31),oe=24*60*60*1e3,W=N>60?N-1:N;L=new Date(k.getTime()+W*oe)}return{id:ce(),selected:!0,originalName:F,mappedName:J(F,!1),type:z,sample:L}}),be={selected:!0,fileName:t.name,sheetName:null,tableName:M(t.name),columns:re,previewData:C.slice(0,5),rawData:C};a([be])}catch(r){p(r)}},d.onerror=p,d.readAsText(t.originFileObj)}),Ne=async(t,l=!1)=>new Promise((a,p)=>{const d=new FileReader;d.onload=o=>{var m;try{const r=new Uint8Array((m=o.target)==null?void 0:m.result),w=Ve(r,{type:"array",cellDates:!1});if(!l)for(const V of w.SheetNames){const A=w.Sheets[V],C=ve.sheet_to_json(A,{defval:null,raw:!0}),P=we(C);if(P){se.value=C,ne.value=P,H.value=!0,a([]);return}}const K=w.SheetNames.map(V=>{const A=w.Sheets[V],C=ve.sheet_to_json(A,{defval:null,raw:!0});if(C.length===0)return null;const P=C.map(z=>{const N={};for(const[L,k]of Object.entries(z))if(typeof k=="string"){const oe=ge(k,G.value);N[L]=oe||k}else N[L]=k;return N}),be=Object.keys(C[0]).map(z=>{const N=P.map(W=>W[z]),L=ke(N),k=N.find(W=>W!=null&&W!=="")||null;let oe=k;if(L==="date"&&typeof k=="number"&&k>=100&&k<=1e5){const W=new Date(1899,11,31),Ye=24*60*60*1e3,qe=k>60?k-1:k;oe=new Date(W.getTime()+qe*Ye)}return{id:ce(),selected:!0,originalName:z,mappedName:J(z,!1),type:L,sample:oe}}),F=M(t.name),Y=w.SheetNames.length===1?F:`${F}_${J(V,!1)}`;return{selected:!0,fileName:t.name,sheetName:V,tableName:Y,columns:be,previewData:P.slice(0,5),rawData:P}}).filter(V=>V!==null);a(K)}catch(r){p(r)}},d.onerror=p,d.readAsArrayBuffer(t.originFileObj)}),Le=async()=>{f.value=!0,h.value=[];try{for(const t of I.value){const l=t.name.toLowerCase();let a=[];l.endsWith(".csv")?a=await xe(t):(l.endsWith(".xlsx")||l.endsWith(".xls"))&&(a=await Ne(t)),h.value.push(...a)}h.value.length>0?(c.value=[0],S.value=2):ee.error(i.translate("i18n_tables_no_valid_sheets"))}catch(t){console.error("Error processing files:",t),ee.error(i.translate("i18n_tables_import_error"))}finally{f.value=!1}},Oe=t=>t.columns.map(l=>({title:l.mappedName,dataIndex:l.originalName,key:l.originalName,width:150,ellipsis:!0})),Re=E(()=>{const t=h.value.filter(l=>l.selected);return t.length>0&&t.every(l=>{const a=l.columns.filter(p=>p.selected);return l.tableName.trim()!==""&&a.length>0&&a.every(p=>p.mappedName.trim()!=="")})}),We=async()=>{le.value=!0;try{const l={tables:h.value.filter(a=>a.selected).map(a=>{const p={id:ce(),name:"id",type:"uuid",primaryKey:!0,nullable:!1,unique:!0,default:"gen_random_uuid()"},d=a.columns.filter(o=>o.selected);return{id:ce(),name:a.tableName,columns:[p,...d.map(o=>({id:o.id,name:o.mappedName,type:o.type,primaryKey:!1,nullable:!0,unique:!1,default:""}))],data:a.rawData.map(o=>{const m={};return d.forEach(r=>{const w=o[r.originalName];m[r.mappedName]=Fe(w,r.type)}),m})}})};await dt.post(`projects/${T.projectId}/tables/restore`,{tables:l.tables}),ee.success(i.translate("i18n_tables_import_success")),de(),$("success")}catch(t){console.error("Error importing tables:",t),ee.error(i.translate("i18n_tables_import_error"))}finally{le.value=!1}},Ge=async()=>{H.value=!1,f.value=!0;try{h.value=[];for(const t of I.value){const l=t.name.toLowerCase();let a=[];l.endsWith(".csv")?a=await xe(t,!0):(l.endsWith(".xlsx")||l.endsWith(".xls"))&&(a=await Ne(t,!0)),h.value.push(...a)}h.value.length>0?(c.value=[0],S.value=2):ee.error(i.translate("i18n_tables_no_valid_sheets"))}catch(t){console.error("Error reprocessing files:",t),ee.error(i.translate("i18n_tables_import_error"))}finally{f.value=!1,se.value=[]}},Ke=()=>{S.value=1},de=()=>{R.value=!1,S.value=1,I.value=[],h.value=[],c.value=[],f.value=!1,le.value=!1,G.value=v(),H.value=!1,se.value=[]};return(t,l)=>(u(),b(me,null,[s(e(he),{open:R.value,"onUpdate:open":l[4]||(l[4]=a=>R.value=a),title:e(i).translate("i18n_tables_import_spreadsheets"),width:800,footer:null,onCancel:de},{default:n(()=>[S.value===1?(u(),b("div",ia,[s(e(q),{type:"secondary"},{default:n(()=>[_(g(e(i).translate("i18n_tables_import_description")),1)]),_:1}),s(e(X),{"file-list":I.value,"onUpdate:fileList":l[0]||(l[0]=a=>I.value=a),"before-upload":He,remove:Pe,accept:".csv,.xlsx,.xls",multiple:"",style:{"margin-top":"1rem"}},{default:n(()=>[x("p",da,[s(e(zt),{size:48})]),x("p",ua,g(e(i).translate("i18n_tables_upload_click_or_drag")),1),x("p",ca,g(e(i).translate("i18n_tables_upload_supported_formats")),1)]),_:1},8,["file-list"]),s(e(te),{justify:"flex-end",gap:"small",style:{"margin-top":"1rem"}},{default:n(()=>[s(O,{onClick:de},{default:n(()=>[...l[7]||(l[7]=[_(" Cancel ",-1)])]),_:1}),s(O,{type:"primary",disabled:I.value.length===0,loading:f.value,onClick:Le},{default:n(()=>[...l[8]||(l[8]=[_(" Next ",-1)])]),_:1},8,["disabled","loading"])]),_:1})])):ae("",!0),S.value===2?(u(),b("div",pa,[s(e(q),{type:"secondary"},{default:n(()=>[_(g(e(i).translate("i18n_tables_import_mapping_description")),1)]),_:1}),s(e(Te),{spinning:f.value},{default:n(()=>[x("div",ma,[s(e(ot),{"active-key":c.value,"onUpdate:activeKey":l[3]||(l[3]=a=>c.value=a),accordion:""},{default:n(()=>[(u(!0),b(me,null,je(h.value,(a,p)=>(u(),j(e(it),{key:p,disabled:!a.selected,style:ue({opacity:a.selected?1:.6})},{header:n(()=>[s(e(te),{align:"center",gap:"small",onClick:l[2]||(l[2]=Me(()=>{},["stop"]))},{default:n(()=>[s(e(Se),{checked:a.selected,"onUpdate:checked":d=>a.selected=d,onClick:l[1]||(l[1]=Me(()=>{},["stop"]))},null,8,["checked","onUpdate:checked"]),x("span",{style:ue({textDecoration:a.selected?"none":"line-through",color:a.selected?"inherit":"#999"})},g(a.fileName)+" "+g(a.sheetName?`- ${a.sheetName}`:""),5)]),_:2},1024)]),default:n(()=>[a.selected?(u(),j(e(Ue),{key:0,layout:"vertical"},{default:n(()=>[s(e(pe),{label:e(i).translate("i18n_tables_table_name")},{default:n(()=>[s(e(fe),{value:a.tableName,"onUpdate:value":d=>a.tableName=d,placeholder:e(i).translate("i18n_tables_enter_table_name"),onBlur:d=>a.tableName=ie(a.tableName),onInput:d=>a.tableName=y(a.tableName)},null,8,["value","onUpdate:value","placeholder","onBlur","onInput"])]),_:2},1032,["label"]),s(e(pe),{label:e(i).translate("i18n_tables_columns")},{default:n(()=>[s(e(Ae),{columns:U,"data-source":a.columns,pagination:!1,size:"small"},{bodyCell:n(({column:d,record:o})=>[d.key==="selected"?(u(),j(e(Se),{key:0,checked:o.selected,"onUpdate:checked":m=>o.selected=m},null,8,["checked","onUpdate:checked"])):d.key==="originalName"?(u(),j(e(q),{key:1,code:"",style:ue({textDecoration:o.selected?"none":"line-through",opacity:o.selected?1:.5})},{default:n(()=>[_(g(o.originalName),1)]),_:2},1032,["style"])):d.key==="mappedName"?(u(),j(e(fe),{key:2,value:o.mappedName,"onUpdate:value":m=>o.mappedName=m,size:"small",disabled:!o.selected,onBlur:m=>o.mappedName=ie(o.mappedName),onInput:m=>o.mappedName=y(o.mappedName)},null,8,["value","onUpdate:value","disabled","onBlur","onInput"])):d.key==="type"?(u(),j(e(Qe),{key:3,value:o.type,"onUpdate:value":m=>o.type=m,size:"small",style:{width:"100%"},disabled:!o.selected,options:e(_e)},null,8,["value","onUpdate:value","disabled","options"])):d.key==="sample"?(u(),j(e(q),{key:4,type:"secondary",style:ue([{"font-size":"12px"},{opacity:o.selected?1:.5}])},{default:n(()=>[_(g(Be(o.sample)),1)]),_:2},1032,["style"])):ae("",!0)]),_:1},8,["data-source"])]),_:2},1032,["label"]),s(e(pe),{label:e(i).translate("i18n_tables_preview")},{default:n(()=>[s(e(Ae),{columns:Oe(a),"data-source":a.previewData,pagination:!1,scroll:{x:"max-content",y:200},size:"small"},null,8,["columns","data-source"])]),_:2},1032,["label"])]),_:2},1024)):ae("",!0)]),_:2},1032,["disabled","style"]))),128))]),_:1},8,["active-key"])])]),_:1},8,["spinning"]),s(e(te),{justify:"space-between",style:{"margin-top":"1rem"}},{default:n(()=>[s(O,{onClick:Ke},{default:n(()=>[...l[9]||(l[9]=[_(" Back ",-1)])]),_:1}),s(e(te),{gap:"small"},{default:n(()=>[s(O,{onClick:de},{default:n(()=>[...l[10]||(l[10]=[_(" Cancel ",-1)])]),_:1}),s(O,{type:"primary",disabled:!Re.value,loading:le.value,onClick:We},{default:n(()=>[_(g(e(i).translate("i18n_tables_import")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})])):ae("",!0)]),_:1},8,["open","title"]),s(e(he),{open:H.value,"onUpdate:open":l[6]||(l[6]=a=>H.value=a),title:e(i).translate("i18n_tables_date_format"),width:600,closable:!1,"mask-closable":!1},{footer:n(()=>[s(e(te),{justify:"flex-end"},{default:n(()=>[s(O,{type:"primary",onClick:Ge},{default:n(()=>[_(g(e(i).translate("i18n_tables_confirm_and_continue")),1)]),_:1})]),_:1})]),default:n(()=>[s(e(_t),{type:"warning","show-icon":"",style:{"margin-bottom":"1rem"},message:e(i).translate("i18n_tables_ambiguous_dates_detected"),description:e(i).translate("i18n_tables_ambiguous_dates_description")},null,8,["message","description"]),s(e(q),{strong:"",style:{display:"block","margin-bottom":"0.5rem"}},{default:n(()=>[_(g(e(i).translate("i18n_tables_date_format_description")),1)]),_:1}),s(e(Xe),{value:G.value,"onUpdate:value":l[5]||(l[5]=a=>G.value=a),style:{display:"flex","flex-direction":"column",gap:"0.5rem"}},{default:n(()=>[s(e(Ce),{value:"dd/MM/yyyy"},{default:n(()=>[_(g(e(i).translate("i18n_tables_date_format_ddmmyyyy"))+" ",1),s(e(q),{type:"secondary",style:{display:"block","margin-left":"24px"}},{default:n(()=>[_(g(e(i).translate("i18n_tables_date_format_example",null,"dd/MM/yyyy",ne.value)),1)]),_:1})]),_:1}),s(e(Ce),{value:"MM/dd/yyyy"},{default:n(()=>[_(g(e(i).translate("i18n_tables_date_format_mmddyyyy"))+" ",1),s(e(q),{type:"secondary",style:{display:"block","margin-left":"24px"}},{default:n(()=>[_(g(e(i).translate("i18n_tables_date_format_example",null,"MM/dd/yyyy",ne.value)),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["open","title"])],64))}}),ya={key:1,style:{padding:"1rem"}},_a={style:{flex:"1"}},Ua=ye({__name:"Tables",setup(B){const D=lt(),T=nt().params.projectId,{tables:$,loading:R,fetchTables:v}=gt(T),S=Z(""),I=E(()=>{if(!$.value)return[];if(!S.value)return $.value;const U=S.value.toLowerCase();return $.value.filter(y=>y.name.toLowerCase().includes(U))}),h=Z(!1),c=Z(!1),f=et({name:""}),le=U=>J(U,!0),G=U=>J(U,!1),H=Z(!1),ne=async()=>{H.value=!0;const U=await mt.create(T,f.name);await v(!0),H.value=!1,h.value=!1,f.name="",D.push({name:"tableEditor",params:{tableId:U.id,projectId:T}})},se=()=>{h.value=!1,f.name=""},_e=()=>{v(!0)};return tt(()=>{const U=De.subscribe("tableCreated",()=>{v(!0)});at(()=>{De.unsubscribe(U)})}),(U,y)=>{const ie=st("RouterLink");return u(),b(me,null,[s(yt),e(R)?(u(),j(e(Te),{key:0,style:{width:"100%","margin-top":"2rem"}})):(u(),b("div",ya,[s(e(te),{justify:"space-between",align:"center",style:{"margin-bottom":"1rem"}},{default:n(()=>[x("div",_a,[s(e(rt),{level:3},{default:n(()=>[_(g(e(i).translate("i18n_tables_tables")),1)]),_:1}),s(e(q),{type:"secondary"},{default:n(()=>[_(g(e(i).translate("i18n_tables_description")),1)]),_:1})]),s(e(te),{gap:"small"},{default:n(()=>[s(O,{onClick:y[0]||(y[0]=M=>c.value=!0)},{default:n(()=>[_(g(e(i).translate("i18n_tables_import_spreadsheets")),1)]),_:1}),s(O,{type:"primary",onClick:y[1]||(y[1]=M=>h.value=!0)},{default:n(()=>[_(g(e(i).translate("i18n_tables_create_table")),1)]),_:1})]),_:1})]),_:1}),e($)&&e($).length>0?(u(),j(e(fe),{key:0,value:S.value,"onUpdate:value":y[2]||(y[2]=M=>S.value=M),placeholder:e(i).translate("i18n_tables_search_placeholder"),"allow-clear":"",style:{"margin-bottom":"1rem","max-width":"400px"}},{prefix:n(()=>[s(e(oa),{size:16})]),_:1},8,["value","placeholder"])):ae("",!0),!e($)||e($).length===0?(u(),j(e(Ie),{key:1,description:e(i).translate("i18n_tables_empty_title")},null,8,["description"])):I.value.length===0?(u(),j(e(Ie),{key:2,description:e(i).translate("i18n_tables_no_match")},null,8,["description"])):(u(),j(e(ct),{key:3,gutter:[16,16]},{default:n(()=>[(u(!0),b(me,null,je(I.value,M=>(u(),j(e(ut),{key:M.id,xs:24,sm:24,md:12,lg:12,xl:8,xxl:8},{default:n(()=>[s(ie,{to:`/projects/${e(T)}/tables/${M.id}`,style:{"text-decoration":"none",color:"inherit"}},{default:n(()=>[s(ft,{table:M,"project-id":e(T),"show-edit-button":!1},null,8,["table","project-id"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1}))])),s(e(he),{open:h.value,"onUpdate:open":y[6]||(y[6]=M=>h.value=M),title:e(i).translate("i18n_tables_create_table")},{footer:n(()=>[s(O,{onClick:se},{default:n(()=>[_(g(e(i).translate("i18n_tables_cancel")),1)]),_:1}),s(O,{type:"primary",loading:H.value,disabled:!f.name.trim(),onClick:ne},{default:n(()=>[_(g(e(i).translate("i18n_tables_create")),1)]),_:1},8,["loading","disabled"])]),default:n(()=>[s(e(Ue),{model:f,layout:"vertical"},{default:n(()=>[s(e(pe),{label:e(i).translate("i18n_tables_table_name"),name:"name"},{default:n(()=>[s(e(fe),{value:f.name,"onUpdate:value":y[3]||(y[3]=M=>f.name=M),placeholder:e(i).translate("i18n_tables_enter_table_name"),onBlur:y[4]||(y[4]=M=>f.name=G(f.name)),onInput:y[5]||(y[5]=M=>f.name=le(f.name))},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"]),s(fa,{open:c.value,"onUpdate:open":y[7]||(y[7]=M=>c.value=M),"project-id":e(T),onSuccess:_e},null,8,["open","project-id"])],64)}}});export{Ua as default};
//# sourceMappingURL=Tables.4f4c60fc.js.map

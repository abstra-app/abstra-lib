import{L as R}from"./CircularLoading.b05ef6fd.js";import{d as x,e as B,o as d,X as h,a as v,b as n,e9 as r,u as a,c as b,w as u,R as $,eV as t,bK as I,eU as A,cy as T,aF as m,bS as p,cx as L,$ as C,eo as q,ea as D,f as K,dF as V}from"./vue-router.34686300.js";import{_ as N}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.af6a2569.js";import{T as S,b as F}from"./router.a31e402b.js";import{i as U}from"./string.82273a0d.js";import{a as y,E as M}from"./gateway.96d5ac0f.js";import"./Logo.8be1e4e5.js";import"./popupNotifcation.a070b3ba.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[s]="92004c0b-3c8c-44ba-a3e6-08899182a1d5",l._sentryDebugIdIdentifier="sentry-dbid-92004c0b-3c8c-44ba-a3e6-08899182a1d5")}catch{}})();const j={class:"form"},z={class:"header"},O={class:"description"},X={class:"description"},G={class:"footer"},H={key:2,class:"loading"},J=x({__name:"Passwordless",emits:["done"],setup(l,{emit:s}){const e=B({stage:"collect-info",info:{email:""},token:"",invalid:!1,secsToAllowResend:0});function _(){const i=e.value.info.email,o=U(i);return e.value.invalid=!o,o}let c;const f=async()=>{if(!!_()){e.value.stage="loading";try{await y.authenticate(e.value.info.email),e.value.stage="collect-token",e.value.secsToAllowResend=120,clearInterval(c),c=setInterval(()=>{e.value.secsToAllowResend-=1,e.value.secsToAllowResend<=0&&clearInterval(c)},1e3)}catch{e.value.invalid=!0,e.value.stage="collect-info"}}},k=i=>{if(!i){e.value.info.email="";return}e.value.info.email=i.toLowerCase()},w=async()=>{var i;if(!!((i=e.value.info)!=null&&i.email)){e.value.stage="loading";try{const o=await y.verify(e.value.info.email,e.value.token);if(!o)throw new Error("[Passwordless] Login did not return an user");S.trackSession(),s("done",o),e.value.stage="done"}catch{e.value.invalid=!0,e.value.stage="collect-token"}}},E=()=>{e.value.info&&f()},P=()=>{e.value.stage="collect-info",e.value.info={email:""},e.value.token="",e.value.invalid=!1};return(i,o)=>(d(),h("div",j,[v("div",z,[n(N,{"hide-text":"",size:"large"}),v("h2",null,r(a(t).translate("i18n_auth_validate_your_email_login",null,{brandName:"Abstra"})),1)]),e.value.stage==="collect-info"?(d(),b(a(L),{key:0,class:"section"},{default:u(()=>[v("div",O,r(a(t).translate("i18n_auth_info_description")),1),n(a(T),{"has-feedback":"","validate-status":e.value.invalid?"error":"",help:e.value.invalid?a(t).translate("i18n_auth_info_invalid_email"):""},{default:u(()=>[n(a(I),{type:"email",value:e.value.info.email,placeholder:a(t).translate("i18n_auth_enter_your_work_email"),onBlur:_,onKeyup:A(f,["enter"]),onChange:o[0]||(o[0]=g=>k(g.target.value))},null,8,["value","placeholder","onKeyup"])]),_:1},8,["validate-status","help"]),n(a(p),{type:"primary",onClick:f},{default:u(()=>[m(r(a(t).translate("i18n_auth_info_send_code")),1)]),_:1})]),_:1})):e.value.stage==="collect-token"?(d(),b(a(L),{key:1,class:"section"},{default:u(()=>[v("div",X,r(a(t).translate("i18n_auth_token_label",null,e.value.info)),1),n(a(T),{"has-feedback":"","validate-status":e.value.invalid?"error":"",help:e.value.invalid?a(t).translate("i18n_auth_token_invalid"):""},{default:u(()=>[n(a(I),{value:e.value.token,"onUpdate:value":o[1]||(o[1]=g=>e.value.token=g),type:"number",placeholder:a(t).translate("i18n_auth_enter_your_token"),onKeyup:A(w,["enter"])},null,8,["value","placeholder","onKeyup"])]),_:1},8,["validate-status","help"]),n(a(p),{type:"primary",onClick:w},{default:u(()=>[m(r(a(t).translate("i18n_auth_token_verify_email")),1)]),_:1}),n(a(p),{onClick:P},{default:u(()=>[m(r(a(t).translate("i18n_auth_edit_email")),1)]),_:1}),n(a(p),{disabled:!!e.value.secsToAllowResend,onClick:E},{default:u(()=>[m(r(a(t).translate("i18n_auth_token_resend_email"))+" ("+r(e.value.secsToAllowResend)+" s) ",1)]),_:1},8,["disabled"]),v("div",G,r(a(t).translate("i18n_auth_token_footer_alternative_email")),1)]),_:1})):e.value.stage==="loading"?(d(),h("div",H,[n(R)])):$("",!0)]))}});const Q=C(J,[["__scopeId","data-v-b9707eaf"]]),W=async()=>{const l=y.getAuthor();if(!l)return;const{status:s}=await F.getInfo();if(s==="active")return;const e=new URLSearchParams({token:l.jwt,status:s});window.location.replace(`${M.onboarding}/setup?${e}`)},Y={key:0,class:"login"},Z={key:1,class:"loading"},ee=x({__name:"Login",setup(l){const s=q(),e=D();async function _(){await W(),e.query.redirect?await s.push({path:e.query.redirect,query:{...e.query,redirect:e.query["prev-redirect"],"prev-redirect":void 0}}):s.push({name:"home"})}const c=K(()=>!y.getAuthor());return V(()=>{c.value||_()}),(f,k)=>c.value?(d(),h("div",Y,[n(Q,{onDone:_})])):(d(),h("div",Z,[n(R)]))}});const ue=C(ee,[["__scopeId","data-v-e4e9b925"]]);export{ue as default};
//# sourceMappingURL=Login.d9620b89.js.map

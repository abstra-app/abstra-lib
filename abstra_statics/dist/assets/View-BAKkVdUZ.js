import{a as G}from"./asyncComputed-CZ6DC1Cs.js";import{a as x,r as $,p as g,e as m,u as e,v as me,w as r,j as n,bq as ye,br as M,S as h,U as b,ae as a,b8 as z,B as P,P as S,aJ as B,aK as k,aL as F,c as W,aP as H,b as X,M as Y,W as fe,bm as ge,bj as ee,ac as he,D as be,g as A,aj as ve,aQ as we}from"./jwt-decode.esm-X_JHyrHe.js";import{S as j}from"./index-D_wdY2um.js";import{_ as Ce}from"./DocsButton.vue_vue_type_script_setup_true_lang-DoAQCamW.js";import{j as V,C as R,p as U}from"./router-BfX34XLs.js";import{C as te}from"./CrudView-omtinu6s.js";import{G as le}from"./PhPencil.vue-DSr0MYkS.js";import{C as Pe}from"./repository-BoGLJ13j.js";import{E as ae}from"./record-BoeAoZE0.js";import{a as Z}from"./ant-design-BcHu_TfS.js";import{A as J,T as ke}from"./index-DP71ioDC.js";import"./constants-BpBRrK-g.js";import"./ts.worker-BwKuk5mh.js";import"./url-D2MDCvfR.js";import"./PhDotsThreeVertical.vue-CMiDmYDS.js";import"./fetch-D6FxMlNo.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[t]="2171e178-b391-43cc-9af1-b35ed4e9c1be",c._sentryDebugIdIdentifier="sentry-dbid-2171e178-b391-43cc-9af1-b35ed4e9c1be")}catch{}})();const xe=x({__name:"View",props:{signupPolicy:{}},emits:["updated","save"],setup(c,{emit:t}){const o=t,l=c,i=$(l.signupPolicy.strategy),s=$(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns:[]),y=$(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns.map(u=>({label:u})):[]),v=u=>{const w=u;if(s.value=w,w.length===0){i.value="inviteOnly",f("inviteOnly");return}y.value=w.map(N=>({label:N})),l.signupPolicy.emailPatterns=u,o("updated",l.signupPolicy)},_=()=>{o("save")},f=u=>{i.value=u,u!=="patternOnly"&&(u==="inviteOnly"&&l.signupPolicy.allowOnlyInvited(),o("updated",l.signupPolicy))};return(u,w)=>(m(),g(e(me),{style:{"padding-top":"8px",width:"100%"},justify:"space-between",align:"flex-end"},{default:r(()=>[n(e(ye),{value:i.value,"onUpdate:value":f},{default:r(()=>[n(e(j),{direction:"vertical"},{default:r(()=>[n(e(M),{value:"inviteOnly"},{default:r(()=>[h(b(e(a).translate("i18n_signup_policy_invite_only",null)),1)]),_:1}),n(e(j),null,{default:r(()=>[n(e(M),{value:"patternOnly"},{default:r(()=>[h(b(e(a).translate("i18n_signup_policy_pattern_only",null)),1)]),_:1}),n(e(z),{mode:"tags",value:c.signupPolicy.emailPatterns,style:{"min-width":"300px"},placeholder:e(a).translate("i18n_signup_policy_domain_placeholder",null),disabled:i.value!=="patternOnly",options:y.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":v},null,8,["value","placeholder","disabled","options"])]),_:1})]),_:1})]),_:1},8,["value"]),n(e(P),{disabled:!c.signupPolicy.hasChanges,type:"primary",onClick:_},{default:r(()=>[h(b(e(a).translate("i18n_signup_policy_save_changes",null)),1)]),_:1},8,["disabled"])]),_:1}))}}),Ue=x({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(c,{emit:t}){const l=c.roleOptions.map(_=>({label:_.name,value:_.name})),i=t,s=S({email:"",roles:[]});function y(){i("cancel")}function v(){s.email&&i("created",s)}return(_,f)=>(m(),g(e(V),{open:"",title:e(a).translate("i18n_user_editor_new_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:y},{extra:r(()=>[n(e(j),null,{default:r(()=>[n(e(P),{onClick:y},{default:r(()=>[h(b(e(a).translate("i18n_user_editor_cancel",null)),1)]),_:1}),n(e(P),{type:"primary",onClick:v},{default:r(()=>[h(b(e(a).translate("i18n_user_editor_submit",null)),1)]),_:1})]),_:1})]),default:r(()=>[n(e(B),{model:s,layout:"vertical"},{default:r(()=>[n(e(k),{key:"email",label:e(a).translate("i18n_user_editor_email_label",null),required:!0},{default:r(()=>[n(e(F),{value:s.email,"onUpdate:value":f[0]||(f[0]=u=>s.email=u)},null,8,["value"])]),_:1},8,["label"]),n(e(k),{key:"role",label:e(a).translate("i18n_user_editor_role_label",null)},{default:r(()=>[n(e(z),{value:s.roles,"onUpdate:value":f[1]||(f[1]=u=>s.roles=u),mode:"multiple",options:e(l)},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Re=x({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(c,{emit:t}){const o=t,l=c,i=l.roleOptions.map(_=>({label:_.name,value:_.name})),s=S({email:l.email,roles:l.roles});function y(){o("cancel")}function v(){o("updated",s)}return(_,f)=>(m(),g(e(V),{open:"",title:e(a).translate("i18n_user_editor_update_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:y},{extra:r(()=>[n(e(j),null,{default:r(()=>[n(e(P),{onClick:y},{default:r(()=>[h(b(e(a).translate("i18n_user_editor_cancel",null)),1)]),_:1}),n(e(P),{type:"primary",onClick:v},{default:r(()=>[h(b(e(a).translate("i18n_user_editor_submit",null)),1)]),_:1})]),_:1})]),default:r(()=>[n(e(B),{model:s,layout:"vertical"},{default:r(()=>[n(e(k),{key:"email",label:e(a).translate("i18n_user_editor_email_label",null)},{default:r(()=>[n(e(F),{value:s.email,"onUpdate:value":f[0]||(f[0]=u=>s.email=u)},null,8,["value"])]),_:1},8,["label"]),n(e(k),{key:"role",label:e(a).translate("i18n_user_editor_role_label",null)},{default:r(()=>[n(e(z),{value:s.roles,"onUpdate:value":f[1]||(f[1]=u=>s.roles=u),mode:"multiple",options:e(i)},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),je=x({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(c){const t=c,o=W(()=>({columns:[{title:a.translate("i18n_user_editor_email_label",null)},{title:a.translate("i18n_user_editor_roles_column",null)},{title:"",align:"right"}],rows:t.users.map(l=>({key:l.email,cells:[{type:"text",text:l.email},{type:"slot",key:"roles",payload:{roles:l.roles}},{type:"actions",actions:[{icon:le,label:a.translate("i18n_user_editor_edit",null),onClick:()=>t.onEdit(l)},{icon:H,label:a.translate("i18n_user_editor_delete",null),onClick:()=>t.onDelete(l)}]}]}))??[]}));return(l,i)=>(m(),g(te,{"entity-name":"users",title:"",loading:c.loading,description:e(a).translate("i18n_user_editor_view_description",null),"empty-title":e(a).translate("i18n_user_editor_empty_title",null),table:o.value,"create-button-text":e(a).translate("i18n_user_editor_add_button",null),create:c.onCreate},{roles:r(({payload:s})=>[(m(!0),X(Y,null,fe(s.roles,y=>(m(),g(e(ge),{key:y,bordered:""},{default:r(()=>[h(b(y),1)]),_:2},1024))),128))]),_:1},8,["loading","description","empty-title","table","create-button-text","create"]))}}),$e=x({__name:"NewRole",emits:["created","cancel"],setup(c,{emit:t}){const o=t,l=S({name:"",description:""});function i(){o("cancel")}function s(){l.name&&o("created",l)}return(y,v)=>(m(),g(e(V),{open:"",title:e(a).translate("i18n_role_editor_new_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:r(()=>[n(e(j),null,{default:r(()=>[n(e(P),{onClick:i},{default:r(()=>[h(b(e(a).translate("i18n_role_editor_cancel",null)),1)]),_:1}),n(e(P),{type:"primary",onClick:s},{default:r(()=>[h(b(e(a).translate("i18n_role_editor_submit",null)),1)]),_:1})]),_:1})]),default:r(()=>[n(e(B),{model:l,layout:"vertical"},{default:r(()=>[n(e(k),{key:"name",label:e(a).translate("i18n_role_editor_name_label",null),required:!0},{default:r(()=>[n(e(F),{value:l.name,"onUpdate:value":v[0]||(v[0]=_=>l.name=_)},null,8,["value"])]),_:1},8,["label"]),n(e(k),{key:"description",label:e(a).translate("i18n_role_editor_description_label",null)},{default:r(()=>[n(e(ee),{value:l.description,"onUpdate:value":v[1]||(v[1]=_=>l.description=_),placeholder:e(a).translate("i18n_role_editor_description_placeholder",null),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Ie=x({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(c,{emit:t}){const o=t,l=c,i=S({description:l.description});function s(){o("cancel")}function y(){o("updated",i)}return(v,_)=>(m(),g(e(V),{open:"",title:e(a).translate("i18n_role_editor_update_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:s},{extra:r(()=>[n(e(j),null,{default:r(()=>[n(e(P),{onClick:s},{default:r(()=>[h(b(e(a).translate("i18n_role_editor_cancel",null)),1)]),_:1}),n(e(P),{type:"primary",onClick:y},{default:r(()=>[h(b(e(a).translate("i18n_role_editor_submit",null)),1)]),_:1})]),_:1})]),default:r(()=>[n(e(B),{model:i,layout:"vertical"},{default:r(()=>[n(e(k),{key:"name",label:e(a).translate("i18n_role_editor_name_label",null)},{default:r(()=>[n(e(F),{value:l.name,disabled:""},null,8,["value"])]),_:1},8,["label"]),n(e(k),{key:"role",label:e(a).translate("i18n_role_editor_description_label",null)},{default:r(()=>[n(e(ee),{value:i.description,"onUpdate:value":_[0]||(_[0]=f=>i.description=f),placeholder:e(a).translate("i18n_role_editor_description_placeholder",null),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Oe=x({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(c){const t=c,o=W(()=>({columns:[{title:a.translate("i18n_role_editor_name_label",null)},{title:a.translate("i18n_role_editor_description_label",null)},{title:"",align:"right"}],rows:t.roles.map(l=>({key:l.id,cells:[{type:"text",text:l.name},{type:"text",text:l.description},{type:"actions",actions:[{icon:le,label:a.translate("i18n_role_editor_edit",null),onClick:()=>t.onEdit(l)},{icon:H,label:a.translate("i18n_role_editor_delete",null),onClick:()=>t.onDelete(l)}]}]}))??[]}));return(l,i)=>(m(),g(te,{"entity-name":"roles",loading:c.loading,title:"",description:e(a).translate("i18n_role_editor_view_description",null),"empty-title":e(a).translate("i18n_role_editor_empty_title",null),table:o.value,"create-button-text":e(a).translate("i18n_role_editor_add_button",null),create:c.onCreate},null,8,["loading","description","empty-title","table","create-button-text","create"]))}});class I{constructor(t){this.dto=t,this.record=ae.from(t)}static pattern=new RegExp("^@?(?!-)[A-Za-z0-9-]{1,}(?<!-)(\\.[A-Za-z]{2,})+$");record;static from(t){return new I(t)}toDTO(){return this.record.toDTO()}get id(){return this.record.get("id")}get projectId(){return this.record.get("projectId")}get emailPatterns(){return this.record.get("emailPatterns")}set emailPatterns(t){this.record.set("emailPatterns",t)}get hasChanges(){return this.record.hasChangesDeep("emailPatterns")}get strategy(){return this.dto.emailPatterns.length===0?"inviteOnly":"patternOnly"}get changes(){return this.record.changes}allowOnlyInvited(){this.record.set("emailPatterns",[])}static validate(t){return I.pattern.test(t)}}class Ee{urlPath="signup-policy";async update(t,o){return R.patch(`projects/${t}/${this.urlPath}`,o)}async get(t){return R.get(`projects/${t}/${this.urlPath}`)}}const Q=new Ee;class De{constructor(t){this.projectId=t}async update(t){const{emailPatterns:o}=t.changes;if(!o)return t;const l=await Q.update(this.projectId,{emailPatterns:o});return I.from(l)}async get(){const t=await Q.get(this.projectId);return I.from(t)}}class K{constructor(t){this.dto=t,this.record=ae.from(t)}record;static from(t){return new K(t)}toDTO(){return this.record.toDTO()}get changes(){return this.record.changes}get id(){return this.record.get("id")}get email(){return this.record.get("email")}set email(t){this.record.set("email",t)}get projectId(){return this.record.get("projectId")}get roles(){return this.record.get("roles")}set roles(t){this.record.set("roles",t)}update(t){this.record.update(t)}resetChanges(){this.record.resetChanges()}}class Ae{urlPath="users";async create(t,o){return R.post(`projects/${t}/${this.urlPath}`,o)}async delete(t,o){await R.delete(`projects/${t}/${this.urlPath}/${o}`)}async list(t,{limit:o,offset:l}){const i={};o&&(i.limit=o.toString()),l&&(i.offset=l.toString());const s=new URLSearchParams(i);return R.get(`projects/${t}/${this.urlPath}?${s.toString()}`)}async update(t,o,l){return R.patch(`projects/${t}/${this.urlPath}/${o}`,l)}}const T=new Ae;class Te{constructor(t){this.projectId=t}async create(t){await T.create(this.projectId,t)}async update(t,o){await T.update(this.projectId,t,o)}async delete(t){await T.delete(this.projectId,t)}async list(t,o){return(await T.list(this.projectId,{limit:t,offset:o})).map(K.from)}}const Xe=x({__name:"View",setup(c){const o=he().params.projectId,l=$({type:"initial"}),i=$("users");be(()=>{const p=new URLSearchParams(location.search).get("selected-panel")||"users",C=["roles","users"].includes(p)?p:"users";i.value=C});const s=()=>{l.value.type="initial"},y=()=>{l.value.type="creatingUser"},v=d=>{l.value={type:"editingUser",payload:d}},_=()=>{l.value.type="creatingRole"},f=d=>{l.value={type:"editingRole",payload:d}},u=new De(o),{result:w,refetch:N}=G(()=>u.get()),ne=async()=>{if(w.value)try{await u.update(w.value),N()}catch(d){d instanceof Error&&U(a.translate("i18n_access_control_update_error",null),d.message)}},O=new Te(o),{loading:re,result:oe,refetch:E}=G(()=>O.list(100,0)),D=new Pe(o),{loading:se,result:L,refetch:q}=G(()=>D.list(100,0)),ie=async d=>{try{if(l.value.type!=="creatingUser")return;await O.create(d),s(),E()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_create_error",null),p.message)}},ce=async d=>{try{if(l.value.type!=="editingUser")return;await O.update(l.value.payload.id,d),s(),E()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_update_error",null),p.message)}},ue=async d=>{if(await Z(a.translate("i18n_access_control_delete_user_confirm",null)))try{await O.delete(d.id),E()}catch(C){C instanceof Error&&U(a.translate("i18n_access_control_delete_error",null),C.message)}},de=async d=>{try{if(l.value.type!=="creatingRole")return;await D.create(d),s(),q()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_create_error",null),p.message)}},pe=async d=>{try{if(l.value.type!=="editingRole")return;await D.update(l.value.payload.id,d),s(),q()}catch(p){p instanceof Error&&U(a.translate("i18n_access_control_update_error",null),p.message)}},_e=async d=>{if(await Z(a.translate("i18n_access_control_delete_role_confirm",null)))try{await D.delete(d.id),q(),E()}catch(C){C instanceof Error&&U(a.translate("i18n_access_control_delete_error",null),C.message)}};return(d,p)=>(m(),X(Y,null,[n(e(ve),null,{default:r(()=>[h(b(e(a).translate("i18n_access_control_title",null)),1)]),_:1}),n(e(we),null,{default:r(()=>[h(b(e(a).translate("i18n_access_control_description",null))+" ",1),n(Ce,{path:"tools/access-control"})]),_:1}),n(e(ke),{"active-key":i.value,"onUpdate:activeKey":p[0]||(p[0]=C=>i.value=C)},{default:r(()=>[n(e(J),{key:"users",tab:e(a).translate("i18n_access_control_users_tab",null)},null,8,["tab"]),n(e(J),{key:"roles",tab:e(a).translate("i18n_access_control_roles_tab",null)},null,8,["tab"])]),_:1},8,["active-key"]),i.value==="users"&&e(w)?(m(),g(xe,{key:0,"signup-policy":e(w),onSave:ne},null,8,["signup-policy"])):A("",!0),i.value==="users"?(m(),g(je,{key:1,loading:e(re),users:e(oe)||[],onCreate:y,onEdit:v,onDelete:ue},null,8,["loading","users"])):A("",!0),i.value==="roles"?(m(),g(Oe,{key:2,loading:e(se),roles:e(L)||[],onCreate:_,onEdit:f,onDelete:_e},null,8,["loading","roles"])):A("",!0),l.value.type==="creatingUser"?(m(),g(Ue,{key:3,"role-options":e(L)||[],onCancel:s,onCreated:ie},null,8,["role-options"])):l.value.type==="editingUser"?(m(),g(Re,{key:4,email:l.value.payload.email,roles:l.value.payload.roles||[],"role-options":e(L)||[],onUpdated:ce,onCancel:s},null,8,["email","roles","role-options"])):l.value.type==="creatingRole"?(m(),g($e,{key:5,onCancel:s,onCreated:de})):l.value.type==="editingRole"?(m(),g(Ie,{key:6,name:l.value.payload.name,description:l.value.payload.description,onUpdated:pe,onCancel:s},null,8,["name","description"])):A("",!0)],64))}});export{Xe as default};
//# sourceMappingURL=View-BAKkVdUZ.js.map

var is=Object.defineProperty;var os=(r,e,t)=>e in r?is(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var N=(r,e,t)=>(os(r,typeof e!="symbol"?e+"":e,t),t);import{d as G,r as oe,t as fe,e as cs,i as Vt,f as ds,g as ls,h as We,j as Et,p as us,k as hs}from"./geometryUtils.46a01de5.js";import{r as de,F as ne,q as ps,cL as fs,eD as Ge,d as Ve,b as C,c as R,w as k,f as S,u as w,b0 as $,eA as ie,cY as ms,H as Ce,ex as $t,bP as ys,d2 as Fe,cb as vs,o as gs,e as X,bu as _s,ez as xs,eu as Z,I as Ct,cN as bs,v as ws}from"./registerWidgets.e46eca28.js";import{a as Pt,s as Ot,c as Mt,m as Rt}from"./keyboard.bd634176.js";import{P as Gt}from"./pubsub.8f2ecd1e.js";import{M as Ut,a as Ue,T as ks,A as Ss}from"./index.b04d1068.js";import{f as Bt,j as Ht,h as Wt,B as Ns,C as Is,b as Ts,q as Es,e as Cs}from"./icons.db549bc5.js";import{F as Ps}from"./forms.e1efaa71.js";import{H as Os}from"./hooks.a12c1aa6.js";import{J as Ft}from"./jobs.08d5f9ac.js";import{u as Ms,r as Be}from"./uuid.241470e3.js";import{L as Rs,S as Ds}from"./SmartConsole.13554642.js";import{_ as Zs}from"./FormSettings.vue_vue_type_script_setup_true_lang.92ffe82c.js";import{_ as Ls}from"./JobSettings.vue_vue_type_script_setup_true_lang.f1dc0d1b.js";import{a as js,_ as As}from"./HookTester.vue_vue_type_script_setup_true_lang.b64d484b.js";import{a as Xe}from"./asyncComputed.15fd30e0.js";import{A as Q}from"./index.6c00fcdd.js";import{a as Dt,A as zs}from"./index.216a47b9.js";import{A as Vs}from"./index.3579f3be.js";import{W as Kt}from"./workspaces.5c5c851b.js";import{_ as $s}from"./SaveButton.vue_vue_type_script_setup_true_lang.0cecc98a.js";import{R as Gs,F as Us}from"./broker.59f9a113.js";import{r as Bs}from"./index.2ced575c.js";import{L as Hs}from"./LoginBlock.5751a1e2.js";import{_ as Ws}from"./DocsButton.vue_vue_type_script_setup_true_lang.b60f35ac.js";import{A as Fs,c as Zt}from"./index.32337da8.js";import{A as Ks}from"./index.aba1cab9.js";import"./Title.6ee361e2.js";import"./transButton.6834f8a3.js";import"./Form.6fcc3ee8.js";import"./activeRecord.d83b1b14.js";import"./dashes.668993c6.js";import"./index.00020abd.js";import"./storage.f303ee10.js";import"./dayjs.860058b8.js";import"./index.5eb2b06c.js";import"./index.43b1476f.js";import"./passwordlessManager.f4cc4f94.js";import"./Passwordless.5a77ee63.js";import"./CircularLoading.484aa2f6.js";import"./lottie.2b81658b.js";import"./executeJs.a5a141fd.js";import"./PlayerNavbar.6a57e760.js";import"./Steps.deb305bb.js";import"./Modal.47e24ea4.js";import"./WidgetsFrame.71d81391.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.114e5eb7.js";import"./popupNotifcation.51171d15.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="ff7b7b2a-5b1e-4ed4-8fcf-7d60d53ebea2",r._sentryDebugIdIdentifier="sentry-dbid-ff7b7b2a-5b1e-4ed4-8fcf-7d60d53ebea2")}catch{}})();const Ee={left:100,right:100,top:100,bottom:100},Lt={width:600,height:600};class Qe{constructor(e){N(this,"_state");N(this,"projectedElement");this._state=de({x:0,y:0,zoom:1}),this.projectedElement=e}get x(){return this._state.value.x}set x(e){if(Number.isNaN(e))throw new Error("x is NaN");this._state.value.x=e}get y(){return this._state.value.y}set y(e){if(Number.isNaN(e))throw new Error("y is NaN");this._state.value.y=e}static create(e){return new Qe(e)}get zoom(){return this._state.value.zoom}set zoom(e){if(e<=0)throw new Error("Zoom must be positive");this._state.value.zoom=e}fit(e){const t={x:e.x+e.width/2,y:e.y+e.height/2,referential:"world"},s=this.screenRect2world(this.canvasRect);this.x=t.x-s.width/2,this.y=t.y-s.height/2,this.zoomIn(Math.min((this.canvasRect.width-Ee.left-Ee.right)/Math.max(Lt.width,e.width),(this.canvasRect.height-Ee.top-Ee.bottom)/Math.max(Lt.height,e.height))/this.zoom,this.worldPoint2screen(t))}screenPoint2world(e){return{x:e.x/this.zoom+this.x,y:e.y/this.zoom+this.y,referential:"world"}}worldPoint2screen(e){return{x:(e.x-this.x)*this.zoom,y:(e.y-this.y)*this.zoom,referential:"screen"}}screenDelta2world(e){return{dx:e.dx/this.zoom,dy:e.dy/this.zoom,referential:"world"}}worldDelta2screen(e){return{dx:e.dx*this.zoom,dy:e.dy*this.zoom,referential:"screen"}}screenRect2world(e){const t=this.screenPoint2world({x:e.x,y:e.y,referential:e.referential}),s=this.screenPoint2world({x:e.x+e.width,y:e.y+e.height,referential:e.referential});return{x:t.x,y:t.y,width:s.x-t.x,height:s.y-t.y,referential:t.referential}}worldRect2screen(e){const t=this.worldPoint2screen({x:e.x,y:e.y,referential:e.referential}),s=this.worldPoint2screen({x:e.x+e.width,y:e.y+e.height,referential:e.referential});return{x:t.x,y:t.y,width:s.x-t.x,height:s.y-t.y,referential:t.referential}}zoomIn(e,t){const s=this.screenPoint2world(t);this.zoom*=e;const n=this.worldPoint2screen(s),a=G(t,n),i=this.screenDelta2world({dx:a.dx,dy:a.dy,referential:"screen"});this.x+=i.dx,this.y+=i.dy}translate(e){this.x+=e.dx,this.y+=e.dy}get canvasRect(){if(!this.projectedElement)throw new Error("No canvas element");const e=this.projectedElement.getBoundingClientRect();return{x:e.x,y:e.y,width:e.width,height:e.height,referential:"screen"}}}const Js="#e55b70";class et{constructor(){}static create(){return new et}render(e){const t=oe(e.selectedNodes.map(s=>s.projectedRect(e)));!t||(e.ctx.strokeStyle=Js,e.ctx.lineWidth=2,e.ctx.strokeRect(t.x,t.y,t.width,t.height))}}class tt{constructor(e){N(this,"_nodes");N(this,"_links");N(this,"_selectedNodes");N(this,"_selectedLinks");N(this,"_mouseState");N(this,"floatingMenu");N(this,"selectionHull");N(this,"pubsub");N(this,"canvas");N(this,"ctx");N(this,"camera");this.canvas=e,this.camera=Qe.create(e),this._mouseState=ne({state:"IDLE",mousePos:{x:0,y:0,referential:"screen"}}),this.pubsub=new Gt,this.floatingMenu=null;const t=e.getContext("2d");if(!t)throw new Error("Unable to get canvas context");this.ctx=t,this._nodes=ne([]),this._links=ne([]),this._selectedNodes=ne([]),this._selectedLinks=ne([]),this.selectionHull=et.create()}static create(e){return new tt(e)}addTransition(){this.mouseState={state:"LINKING",mousePos:this.mouseState.mousePos,initialMousePos:this.mouseState.mousePos,snappedTarget:null}}duplicateSelection(){const e=this.selectedNodes,t=this.selectedNodes.map(i=>i.clone()),s=this.links.filter(i=>{const o=this.nodes.find(c=>c.id===i.sourceNodeId),d=this.nodes.find(c=>c.id===i.targetNodeId);if(!o||!d)throw new Error("Invalid state");return this.selectedNodes.includes(o)&&this.selectedNodes.includes(d)}).map(i=>{const o=this.nodes.find(E=>E.id===i.sourceNodeId),d=this.nodes.find(E=>E.id===i.targetNodeId);if(!o||!d)throw new Error("Invalid state");const c=this.selectedNodes.indexOf(o),f=t[c],b=this.selectedNodes.indexOf(d),T=t[b];return i.clone(f.id,T.id)});this.nodes.push(...t),this.links.push(...s),this.selectedNodes=t;const n=oe(t.map(i=>i.projectedRect(this)));if(!n)throw new Error("Invalid state");const a={x:n.x+n.width/2,y:n.y+n.height/2,referential:"screen"};this.pubsub.publish("nodes:duplicated",ps.exports.zip(e,t).map(([i,o])=>({original:i,duplicate:o}))),this.mouseState={state:"MOVING",duplicating:!1,initialMousePos:a,mousePos:this.mouseState.mousePos}}async deleteSelection(){Ut.confirm({title:"Are you sure? This operation can't be undone",onOk:()=>{const e={nodes:this.selectedNodes,links:this.selectedLinks};this.selectedNodes.forEach(t=>this.deleteNode(t)),this.selectedLinks.forEach(t=>this.deleteLink(t)),this.pubsub.publish("deleted",e)}})}setupFixSize(){const e=()=>{const{width:t,height:s}=this.canvas.getBoundingClientRect();this.canvas.width=t*devicePixelRatio,this.canvas.height=s*devicePixelRatio,this.ctx.scale(devicePixelRatio,devicePixelRatio)};addEventListener("resize",e),e()}computeCursor(){switch(this.mouseState.state){case"HOVERING_NODE":case"HOVERING_MENU_ITEM":case"HOVERING_LINK":this.canvas.style.cursor="pointer";break;case"JUST_CLICKED_NODE":this.canvas.style.cursor="default";break;case"MOVING":this.canvas.style.cursor="move";break;case"PANNING":this.canvas.style.cursor="grabbing";break;case"LINKING":this.canvas.style.cursor="crosshair";break;case"IDLE":default:this.canvas.style.cursor="grab"}}computePan(e){if(this.mouseState.state!=="PANNING")throw new Error("Invalid state");const t=G(e,this.mouseState.mousePos),s=this.camera.screenDelta2world(t);this.camera.translate(s),this.mouseState={state:"PANNING",initialMousePos:this.mouseState.initialMousePos,mousePos:e}}computeStartMoving(e,t){if(this.mouseState.state!=="JUST_CLICKED_NODE")throw new Error("Invalid state");this.mouseState={state:"MOVING",duplicating:t,initialMousePos:this.mouseState.mousePos,mousePos:e}}get mouseState(){return this._mouseState.value}set mouseState(e){this._mouseState.value=e}get nodes(){return this._nodes.value}set nodes(e){this._nodes.value=e}get links(){return this._links.value}set links(e){this._links.value=e}get selectedNodes(){return this._selectedNodes.value}set selectedNodes(e){this._selectedNodes.value=e}get selectedLinks(){return this._selectedLinks.value}set selectedLinks(e){this._selectedLinks.value=e}computeKeepMoving(e,t){if(this.mouseState.state!=="MOVING")throw new Error("Invalid state");this.mouseState={state:"MOVING",duplicating:t,initialMousePos:this.mouseState.initialMousePos,mousePos:e}}computeKeepLinking(e){if(this.mouseState.state!=="LINKING")throw new Error("Invalid state");const t=this.nodes.find(s=>s.isHovering(this,e));t?this.mouseState={state:"LINKING",initialMousePos:this.mouseState.initialMousePos,mousePos:e,snappedTarget:t}:this.mouseState={state:"LINKING",initialMousePos:this.mouseState.initialMousePos,mousePos:e,snappedTarget:null}}computeHover(e){var a;const t=(a=this.floatingMenu)==null?void 0:a.hoverItem(this,e);if(t){this.mouseState={state:"HOVERING_MENU_ITEM",mousePos:e,menuItem:t};return}const s=this.links.find(i=>i.isHovering(this,e));if(s){this.mouseState={state:"HOVERING_LINK",link:s,mousePos:e};return}const n=this.nodes.find(i=>i.isHovering(this,e));if(n){this.mouseState={state:"HOVERING_NODE",node:n,mousePos:e};return}this.mouseState={state:"IDLE",mousePos:e}}fitCameraToContent(){const e=oe(this.nodes.map(t=>t.projectedRect(this)));!e||this.camera.fit(this.camera.screenRect2world(e))}computeFinishMoving(){if(this.mouseState.state!=="MOVING")throw new Error("Invalid state");const e=this.camera.screenPoint2world(this.mouseState.initialMousePos),t=this.camera.screenPoint2world(this.mouseState.mousePos),s=G(e,t);this.pubsub.publish("nodes:moved",this.selectedNodes.map(n=>{const a=n.position;n.translate(s);const i=n.position;return{node:n,from:a,to:i}}))}computeFinishDuplicating(){if(this.mouseState.state!=="MOVING"||!this.mouseState.duplicating)throw new Error("Invalid state");const e=this.camera.screenPoint2world(this.mouseState.initialMousePos),t=this.camera.screenPoint2world(this.mouseState.mousePos),s=G(e,t);this.pubsub.publish("nodes:duplicated",this.selectedNodes.map(n=>{const a=n.clone();return a.translate(s),this.nodes.push(a),{original:n,duplicate:a}})),this.selectedNodes=this.selectedNodes.map(n=>{const a=n.clone();return a.translate(s),a})}computeFinishLinking(e){if(this.mouseState.state!=="LINKING"||!this.mouseState.snappedTarget)throw new Error("Invalid state");const t=this.mouseState.snappedTarget;this.selectedNodes.forEach(s=>s.addLinkTo(this,t)),this.pubsub.publish("transition:added",{links:[{source:this.selectedNodes[0],target:this.mouseState.snappedTarget}]}),this.selectedNodes=[this.mouseState.snappedTarget],this.mouseState={state:"IDLE",mousePos:e}}computeMouseRelease(e){this.mouseState.state==="MOVING"&&!this.mouseState.duplicating?this.computeFinishMoving():this.mouseState.state==="MOVING"&&this.mouseState.duplicating?this.computeFinishDuplicating():this.mouseState.state==="LINKING"&&this.mouseState.snappedTarget&&this.computeFinishLinking(e),this.mouseState={state:"IDLE",mousePos:e}}setupMousemove(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.mouseState.state==="PANNING"?this.computePan(s):this.mouseState.state==="JUST_CLICKED_NODE"?this.computeStartMoving(s,Pt(t)):this.mouseState.state==="MOVING"?this.computeKeepMoving(s,Pt(t)):this.mouseState.state==="LINKING"?this.computeKeepLinking(s):this.mouseState.state==="ADDING_NEW_NODES"?this.computeKeepAdding(s):this.computeHover(s),this.computeCursor()};addEventListener("mousemove",e)}computeKeepAdding(e){if(this.mouseState.state!=="ADDING_NEW_NODES")throw new Error("Invalid state");this.mouseState.nodes.forEach(t=>t.position=this.camera.screenPoint2world(t.projectedCenter(this))),this.mouseState={state:"ADDING_NEW_NODES",mousePos:e,nodes:this.mouseState.nodes}}setupDragover(){const e=t=>{if(t.preventDefault(),this.mouseState.state!=="ADDING_NEW_NODES")return;const s=this.getScreenPointerFromEvent(t);this.computeKeepAdding(s)};this.canvas.addEventListener("dragover",e)}computeFinishAdding(e){if(this.mouseState.state!=="ADDING_NEW_NODES")return;this.computeKeepAdding(e),this.nodes.push(...this.mouseState.nodes),this.selectedNodes=this.mouseState.nodes;const t=oe(this.mouseState.nodes.map(o=>o.projectedRect(this)));if(!t)throw new Error("Invalid state");const s={x:t.x+t.width/2,y:t.y+t.height/2,referential:"screen"},n=this.camera.screenPoint2world(s),a=this.camera.screenPoint2world(e),i=G(n,a);this.mouseState.nodes.forEach(o=>o.translate(i)),this.mouseState={state:"IDLE",mousePos:e},this.pubsub.publish("nodes:added",{nodes:this.selectedNodes})}setupDrop(){const e=t=>{t.stopPropagation();const s=this.getScreenPointerFromEvent(t);this.computeFinishAdding(s)};this.canvas.addEventListener("drop",e)}getScreenPointerFromEvent(e){return{x:e.offsetX,y:e.offsetY,referential:"screen"}}computeStartClicking(e,t){if(this.mouseState.state==="ADDING_NEW_NODES")this.computeFinishAdding(e);else if(this.mouseState.state==="HOVERING_LINK"){const s=this.mouseState.link;t?this.selectedLinks=[...this.selectedLinks,s]:this.selectedLinks.includes(s)||(this.selectedLinks=[s],this.selectedNodes=[]),this.mouseState={state:"JUST_CLICKED_NODE",mousePos:e,node:this.nodes.find(n=>n.id===s.sourceNodeId)}}else if(this.mouseState.state==="HOVERING_NODE"){const s=this.mouseState.node;t?this.selectedNodes=[...this.selectedNodes,s]:this.selectedNodes.includes(s)||(this.selectedNodes=[s],this.selectedLinks=[]),this.mouseState={state:"JUST_CLICKED_NODE",mousePos:e,node:s}}else this.mouseState.state==="HOVERING_MENU_ITEM"?this.mouseState.menuItem.click():this.mouseState.state==="LINKING"?this.computeFinishLinking(e):(this.clearSelection(),this.mouseState={state:"PANNING",initialMousePos:e,mousePos:e})}setupDoubleClick(){const e=()=>{if(this.mouseState.state!=="HOVERING_NODE")return;const t=this.mouseState.node;this.pubsub.publish("node:dblclick",{node:t})};this.canvas.addEventListener("dblclick",e)}setupMousedown(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.computeStartClicking(s,Ot(t))};this.canvas.addEventListener("mousedown",e)}setupMouseup(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.computeMouseRelease(s),this.computeHover(s),this.computeCursor()};this.canvas.addEventListener("mouseup",e)}computeZoomIn(e,t){this.camera.zoomIn(t,e)}setupWheel(){const e=t=>{if(!this.camera)return;const s={x:t.pageX,y:t.pageY,referential:"screen"};if(Mt(t)||Rt(t))this.computeZoomIn(s,t.deltaY>0?.9:1.1),t.preventDefault();else{const n=Ot(t)?{dx:t.deltaY,dy:0}:{dx:t.deltaX,dy:t.deltaY},a=this.camera.screenDelta2world({dx:n.dx,dy:n.dy,referential:"screen"});this.camera.translate(a)}t.stopPropagation()};this.canvas.addEventListener("wheel",e)}deleteNode(e){this.nodes=this.nodes.filter(t=>t!==e),this.links=this.links.filter(t=>t.sourceNodeId!==e.id&&t.targetNodeId!==e.id),this.selectedNodes=this.selectedNodes.filter(t=>t!==e)}deleteLink(e){this.links=this.links.filter(t=>t!==e),this.selectedLinks=[]}setupKeydown(){const e=t=>{t.key==="Delete"||t.key==="Backspace"?this.deleteSelection():t.key==="a"&&(Mt(t)||Rt(t))?(this.selectedNodes=this.nodes,t.preventDefault()):t.key==="Escape"?(this.clearSelection(),this.mouseState={state:"IDLE",mousePos:this.mouseState.mousePos}):t.key==="t"?this.addTransition():t.key==="Enter"&&this.pubsub.publish("node:dblclick",{node:this.selectedNodes[0]})};this.canvas.parentElement.addEventListener("keydown",e)}renderMouseState(){switch(this.mouseState.state){case"ADDING_NEW_NODES":this.mouseState.nodes.forEach(e=>e.render(this));break}}setFloatingMenu(e){this.floatingMenu=e}render(){var e;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.links.forEach(t=>{t.render(this)}),this.nodes.forEach(t=>{t.render(this)}),(e=this.floatingMenu)==null||e.render(this),this.selectionHull.render(this),this.renderMouseState(),requestAnimationFrame(()=>this.render())}init(){this.setupFixSize(),this.setupMousemove(),this.setupDragover(),this.setupDoubleClick(),this.setupMousedown(),this.setupDrop(),this.setupMouseup(),this.setupWheel(),this.setupKeydown(),this.fitCameraToContent(),this.render()}clear(){this.nodes=[],this.links=[]}addNode(e){this.nodes.push(e)}addLink(e){this.links.push(e)}clearSelection(){this.selectedNodes=[],this.selectedLinks=[]}dragstart(e,t){const s=this.getScreenPointerFromEvent(t);this.clearSelection(),this.mouseState={state:"ADDING_NEW_NODES",mousePos:s,nodes:[e]}}}const qs="rgba(0, 0, 0, 1)",Ys="rgba(0, 0, 0, 0.5)";class st{constructor(e){N(this,"rawItems");this.rawItems=e}static create(e){return new st(e)}getMenuItems(e){const t=e.selectedNodes,s=oe(t.map(b=>b.projectedRect(e)));if(!s)return[];const n={x:s.x+s.width,y:s.y,referential:"screen"},a=10,i=16,o=10,d={dx:i+a,dy:i,referential:"screen"},c={dx:0,dy:2*i+o,referential:"screen"},f=fe(n,d);return this.rawItems.map((b,T)=>{const E=fe(f,cs(c,T));return{label:b.label,icon:b.icon,circle:{...E,radius:i},click:b.click}})}isVisible(e){return e.selectedNodes.length>0&&e.mouseState.state!=="LINKING"&&e.mouseState.state!=="MOVING"}itemHover(e,t){return e.mouseState.state==="HOVERING_MENU_ITEM"&&e.mouseState.menuItem.label===t.label}renderItem(e,t){const s=this.itemHover(e,t),n=s?qs:Ys;if(e.ctx.strokeStyle=n,e.ctx.lineWidth=2,s){e.ctx.font="12px sans-serif";const o=e.ctx.measureText(t.label).width;e.ctx.beginPath(),e.ctx.arc(t.circle.x,t.circle.y,t.circle.radius,Math.PI/2,-Math.PI/2),e.ctx.lineTo(t.circle.x+o+t.circle.radius,t.circle.y-t.circle.radius),e.ctx.arc(t.circle.x+o+t.circle.radius,t.circle.y,t.circle.radius,-Math.PI/2,Math.PI/2),e.ctx.lineTo(t.circle.x,t.circle.y+t.circle.radius),e.ctx.fillStyle="white",e.ctx.fill(),e.ctx.stroke(),e.ctx.textBaseline="middle",e.ctx.textAlign="left",e.ctx.font="12px sans-serif",e.ctx.fillStyle=n,e.ctx.fillText(t.label,t.circle.x+t.circle.radius,t.circle.y)}else e.ctx.beginPath(),e.ctx.arc(t.circle.x,t.circle.y,t.circle.radius,0,2*Math.PI),e.ctx.fillStyle="white",e.ctx.fill(),e.ctx.stroke();const a=new Path2D(t.icon);e.ctx.save();const i=12;e.ctx.translate(t.circle.x-i,t.circle.y-i),e.ctx.fillStyle=n,e.ctx.fill(a),e.ctx.restore()}render(e){!this.isVisible(e)||this.getMenuItems(e).forEach(t=>{this.renderItem(e,t)})}hoverItem(e,t){if(!!this.isVisible(e))return this.getMenuItems(e).find(s=>{if(this.itemHover(e,s)){const n=e.ctx.measureText(s.label).width,a={x:s.circle.x-s.circle.radius,y:s.circle.y-s.circle.radius,width:n+3*s.circle.radius,height:2*s.circle.radius,referential:"screen"};return Vt(t,a)}else return ds(t,s.circle)})}}var x;(function(r){r.assertEqual=n=>n;function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{const a={};for(const i of n)a[i]=i;return a},r.getValidEnumValues=n=>{const a=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),i={};for(const o of a)i[o]=n[o];return r.objectValues(i)},r.objectValues=n=>r.objectKeys(n).map(function(a){return n[a]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const a=[];for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&a.push(i);return a},r.find=(n,a)=>{for(const i of n)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,a=" | "){return n.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=s,r.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(x||(x={}));var Ke;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Ke||(Ke={}));const u=x.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),K=r=>{switch(typeof r){case"undefined":return u.undefined;case"string":return u.string;case"number":return isNaN(r)?u.nan:u.number;case"boolean":return u.boolean;case"function":return u.function;case"bigint":return u.bigint;case"symbol":return u.symbol;case"object":return Array.isArray(r)?u.array:r===null?u.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?u.promise:typeof Map<"u"&&r instanceof Map?u.map:typeof Set<"u"&&r instanceof Set?u.set:typeof Date<"u"&&r instanceof Date?u.date:u.object;default:return u.unknown}},l=x.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Xs=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class A extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(a){return a.message},s={_errors:[]},n=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(n);else if(i.code==="invalid_return_type")n(i.returnTypeError);else if(i.code==="invalid_arguments")n(i.argumentsError);else if(i.path.length===0)s._errors.push(t(i));else{let o=s,d=0;for(;d<i.path.length;){const c=i.path[d];d===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(i))):o[c]=o[c]||{_errors:[]},o=o[c],d++}}};return n(this),s}toString(){return this.message}get message(){return JSON.stringify(this.issues,x.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}A.create=r=>new A(r);const ye=(r,e)=>{let t;switch(r.code){case l.invalid_type:r.received===u.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case l.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,x.jsonStringifyReplacer)}`;break;case l.unrecognized_keys:t=`Unrecognized key(s) in object: ${x.joinValues(r.keys,", ")}`;break;case l.invalid_union:t="Invalid input";break;case l.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${x.joinValues(r.options)}`;break;case l.invalid_enum_value:t=`Invalid enum value. Expected ${x.joinValues(r.options)}, received '${r.received}'`;break;case l.invalid_arguments:t="Invalid function arguments";break;case l.invalid_return_type:t="Invalid function return type";break;case l.invalid_date:t="Invalid date";break;case l.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:x.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case l.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case l.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case l.custom:t="Invalid input";break;case l.invalid_intersection_types:t="Intersection results could not be merged";break;case l.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case l.not_finite:t="Number must be finite";break;default:t=e.defaultError,x.assertNever(r)}return{message:t}};let Jt=ye;function Qs(r){Jt=r}function Oe(){return Jt}const Me=r=>{const{data:e,path:t,errorMaps:s,issueData:n}=r,a=[...t,...n.path||[]],i={...n,path:a};let o="";const d=s.filter(c=>!!c).slice().reverse();for(const c of d)o=c(i,{data:e,defaultError:o}).message;return{...n,path:a,message:n.message||o}},er=[];function h(r,e){const t=Me({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Oe(),ye].filter(s=>!!s)});r.common.issues.push(t)}class O{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if(n.status==="aborted")return y;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const n of t)s.push({key:await n.key,value:await n.value});return O.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:a,value:i}=n;if(a.status==="aborted"||i.status==="aborted")return y;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),(typeof i.value<"u"||n.alwaysSet)&&(s[a.value]=i.value)}return{status:e.value,value:s}}}const y=Object.freeze({status:"aborted"}),qt=r=>({status:"dirty",value:r}),M=r=>({status:"valid",value:r}),Je=r=>r.status==="aborted",qe=r=>r.status==="dirty",Re=r=>r.status==="valid",De=r=>typeof Promise<"u"&&r instanceof Promise;var p;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(p||(p={}));class U{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const jt=(r,e)=>{if(Re(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new A(r.common.issues);return this._error=t,this._error}}};function v(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(i,o)=>i.code!=="invalid_type"?{message:o.defaultError}:typeof o.data>"u"?{message:s!=null?s:o.defaultError}:{message:t!=null?t:o.defaultError},description:n}}class g{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return K(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:K(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new O,ctx:{common:e.parent.common,data:e.data,parsedType:K(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(De(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const n={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:K(e)},a=this._parseSync({data:e,path:n.path,parent:n});return jt(n,a)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:K(e)},n=this._parse({data:e,path:s.path,parent:s}),a=await(De(n)?n:Promise.resolve(n));return jt(s,a)}refine(e,t){const s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,a)=>{const i=e(n),o=()=>a.addIssue({code:l.custom,...s(n)});return typeof Promise<"u"&&i instanceof Promise?i.then(d=>d?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new V({schema:this,typeName:m.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return H.create(this,this._def)}nullable(){return re.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return z.create(this,this._def)}promise(){return ue.create(this,this._def)}or(e){return xe.create([this,e],this._def)}and(e){return be.create(this,e,this._def)}transform(e){return new V({...v(this._def),schema:this,typeName:m.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ie({...v(this._def),innerType:this,defaultValue:t,typeName:m.ZodDefault})}brand(){return new Xt({typeName:m.ZodBranded,type:this,...v(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Ae({...v(this._def),innerType:this,catchValue:t,typeName:m.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Te.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const tr=/^c[^\s-]{8,}$/i,sr=/^[a-z][a-z0-9]*$/,rr=/[0-9A-HJKMNP-TV-Z]{26}/,nr=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,ar=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,ir=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,or=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,cr=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,dr=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function lr(r,e){return!!((e==="v4"||!e)&&or.test(r)||(e==="v6"||!e)&&cr.test(r))}class j extends g{constructor(){super(...arguments),this._regex=(e,t,s)=>this.refinement(n=>e.test(n),{validation:t,code:l.invalid_string,...p.errToObj(s)}),this.nonempty=e=>this.min(1,p.errToObj(e)),this.trim=()=>new j({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new j({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new j({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==u.string){const a=this._getOrReturnCtx(e);return h(a,{code:l.invalid_type,expected:u.string,received:a.parsedType}),y}const s=new O;let n;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),h(n,{code:l.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),h(n,{code:l.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(n=this._getOrReturnCtx(e,n),i?h(n,{code:l.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&h(n,{code:l.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),s.dirty())}else if(a.kind==="email")ar.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"email",code:l.invalid_string,message:a.message}),s.dirty());else if(a.kind==="emoji")ir.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"emoji",code:l.invalid_string,message:a.message}),s.dirty());else if(a.kind==="uuid")nr.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"uuid",code:l.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid")tr.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"cuid",code:l.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid2")sr.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"cuid2",code:l.invalid_string,message:a.message}),s.dirty());else if(a.kind==="ulid")rr.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"ulid",code:l.invalid_string,message:a.message}),s.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),h(n,{validation:"url",code:l.invalid_string,message:a.message}),s.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"regex",code:l.invalid_string,message:a.message}),s.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),h(n,{code:l.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),s.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),h(n,{code:l.invalid_string,validation:{startsWith:a.value},message:a.message}),s.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),h(n,{code:l.invalid_string,validation:{endsWith:a.value},message:a.message}),s.dirty()):a.kind==="datetime"?dr(a).test(e.data)||(n=this._getOrReturnCtx(e,n),h(n,{code:l.invalid_string,validation:"datetime",message:a.message}),s.dirty()):a.kind==="ip"?lr(e.data,a.version)||(n=this._getOrReturnCtx(e,n),h(n,{validation:"ip",code:l.invalid_string,message:a.message}),s.dirty()):x.assertNever(a);return{status:s.value,value:e.data}}_addCheck(e){return new j({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...p.errToObj(e)})}url(e){return this._addCheck({kind:"url",...p.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...p.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...p.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...p.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...p.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...p.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...p.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...p.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...p.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...p.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...p.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...p.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...p.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...p.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...p.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}j.create=r=>{var e;return new j({checks:[],typeName:m.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...v(r)})};function ur(r,e){const t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,a=parseInt(r.toFixed(n).replace(".","")),i=parseInt(e.toFixed(n).replace(".",""));return a%i/Math.pow(10,n)}class J extends g{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==u.number){const a=this._getOrReturnCtx(e);return h(a,{code:l.invalid_type,expected:u.number,received:a.parsedType}),y}let s;const n=new O;for(const a of this._def.checks)a.kind==="int"?x.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:l.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:l.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:l.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?ur(e.data,a.value)!==0&&(s=this._getOrReturnCtx(e,s),h(s,{code:l.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:l.not_finite,message:a.message}),n.dirty()):x.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,p.toString(t))}gt(e,t){return this.setLimit("min",e,!1,p.toString(t))}lte(e,t){return this.setLimit("max",e,!0,p.toString(t))}lt(e,t){return this.setLimit("max",e,!1,p.toString(t))}setLimit(e,t,s,n){return new J({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:p.toString(n)}]})}_addCheck(e){return new J({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:p.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:p.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:p.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:p.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:p.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:p.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:p.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:p.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:p.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&x.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}J.create=r=>new J({checks:[],typeName:m.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...v(r)});class q extends g{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==u.bigint){const a=this._getOrReturnCtx(e);return h(a,{code:l.invalid_type,expected:u.bigint,received:a.parsedType}),y}let s;const n=new O;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:l.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:l.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),h(s,{code:l.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):x.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,p.toString(t))}gt(e,t){return this.setLimit("min",e,!1,p.toString(t))}lte(e,t){return this.setLimit("max",e,!0,p.toString(t))}lt(e,t){return this.setLimit("max",e,!1,p.toString(t))}setLimit(e,t,s,n){return new q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:p.toString(n)}]})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:p.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:p.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:p.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:p.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:p.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}q.create=r=>{var e;return new q({checks:[],typeName:m.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...v(r)})};class ve extends g{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==u.boolean){const s=this._getOrReturnCtx(e);return h(s,{code:l.invalid_type,expected:u.boolean,received:s.parsedType}),y}return M(e.data)}}ve.create=r=>new ve({typeName:m.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...v(r)});class te extends g{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==u.date){const a=this._getOrReturnCtx(e);return h(a,{code:l.invalid_type,expected:u.date,received:a.parsedType}),y}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return h(a,{code:l.invalid_date}),y}const s=new O;let n;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),h(n,{code:l.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),h(n,{code:l.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):x.assertNever(a);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new te({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:p.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:p.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}te.create=r=>new te({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:m.ZodDate,...v(r)});class Ze extends g{_parse(e){if(this._getType(e)!==u.symbol){const s=this._getOrReturnCtx(e);return h(s,{code:l.invalid_type,expected:u.symbol,received:s.parsedType}),y}return M(e.data)}}Ze.create=r=>new Ze({typeName:m.ZodSymbol,...v(r)});class ge extends g{_parse(e){if(this._getType(e)!==u.undefined){const s=this._getOrReturnCtx(e);return h(s,{code:l.invalid_type,expected:u.undefined,received:s.parsedType}),y}return M(e.data)}}ge.create=r=>new ge({typeName:m.ZodUndefined,...v(r)});class _e extends g{_parse(e){if(this._getType(e)!==u.null){const s=this._getOrReturnCtx(e);return h(s,{code:l.invalid_type,expected:u.null,received:s.parsedType}),y}return M(e.data)}}_e.create=r=>new _e({typeName:m.ZodNull,...v(r)});class le extends g{constructor(){super(...arguments),this._any=!0}_parse(e){return M(e.data)}}le.create=r=>new le({typeName:m.ZodAny,...v(r)});class ee extends g{constructor(){super(...arguments),this._unknown=!0}_parse(e){return M(e.data)}}ee.create=r=>new ee({typeName:m.ZodUnknown,...v(r)});class W extends g{_parse(e){const t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:u.never,received:t.parsedType}),y}}W.create=r=>new W({typeName:m.ZodNever,...v(r)});class Le extends g{_parse(e){if(this._getType(e)!==u.undefined){const s=this._getOrReturnCtx(e);return h(s,{code:l.invalid_type,expected:u.void,received:s.parsedType}),y}return M(e.data)}}Le.create=r=>new Le({typeName:m.ZodVoid,...v(r)});class z extends g{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==u.array)return h(t,{code:l.invalid_type,expected:u.array,received:t.parsedType}),y;if(n.exactLength!==null){const i=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(i||o)&&(h(t,{code:i?l.too_big:l.too_small,minimum:o?n.exactLength.value:void 0,maximum:i?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(h(t,{code:l.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(h(t,{code:l.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>n.type._parseAsync(new U(t,i,t.path,o)))).then(i=>O.mergeArray(s,i));const a=[...t.data].map((i,o)=>n.type._parseSync(new U(t,i,t.path,o)));return O.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new z({...this._def,minLength:{value:e,message:p.toString(t)}})}max(e,t){return new z({...this._def,maxLength:{value:e,message:p.toString(t)}})}length(e,t){return new z({...this._def,exactLength:{value:e,message:p.toString(t)}})}nonempty(e){return this.min(1,e)}}z.create=(r,e)=>new z({type:r,minLength:null,maxLength:null,exactLength:null,typeName:m.ZodArray,...v(e)});function ae(r){if(r instanceof I){const e={};for(const t in r.shape){const s=r.shape[t];e[t]=H.create(ae(s))}return new I({...r._def,shape:()=>e})}else return r instanceof z?new z({...r._def,type:ae(r.element)}):r instanceof H?H.create(ae(r.unwrap())):r instanceof re?re.create(ae(r.unwrap())):r instanceof B?B.create(r.items.map(e=>ae(e))):r}class I extends g{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=x.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==u.object){const c=this._getOrReturnCtx(e);return h(c,{code:l.invalid_type,expected:u.object,received:c.parsedType}),y}const{status:s,ctx:n}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof W&&this._def.unknownKeys==="strip"))for(const c in n.data)i.includes(c)||o.push(c);const d=[];for(const c of i){const f=a[c],b=n.data[c];d.push({key:{status:"valid",value:c},value:f._parse(new U(n,b,n.path,c)),alwaysSet:c in n.data})}if(this._def.catchall instanceof W){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of o)d.push({key:{status:"valid",value:f},value:{status:"valid",value:n.data[f]}});else if(c==="strict")o.length>0&&(h(n,{code:l.unrecognized_keys,keys:o}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of o){const b=n.data[f];d.push({key:{status:"valid",value:f},value:c._parse(new U(n,b,n.path,f)),alwaysSet:f in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of d){const b=await f.key;c.push({key:b,value:await f.value,alwaysSet:f.alwaysSet})}return c}).then(c=>O.mergeObjectSync(s,c)):O.mergeObjectSync(s,d)}get shape(){return this._def.shape()}strict(e){return p.errToObj,new I({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var n,a,i,o;const d=(i=(a=(n=this._def).errorMap)===null||a===void 0?void 0:a.call(n,t,s).message)!==null&&i!==void 0?i:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=p.errToObj(e).message)!==null&&o!==void 0?o:d}:{message:d}}}:{}})}strip(){return new I({...this._def,unknownKeys:"strip"})}passthrough(){return new I({...this._def,unknownKeys:"passthrough"})}extend(e){return new I({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new I({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:m.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new I({...this._def,catchall:e})}pick(e){const t={};return x.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new I({...this._def,shape:()=>t})}omit(e){const t={};return x.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new I({...this._def,shape:()=>t})}deepPartial(){return ae(this)}partial(e){const t={};return x.objectKeys(this.shape).forEach(s=>{const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}),new I({...this._def,shape:()=>t})}required(e){const t={};return x.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let a=this.shape[s];for(;a instanceof H;)a=a._def.innerType;t[s]=a}}),new I({...this._def,shape:()=>t})}keyof(){return Yt(x.objectKeys(this.shape))}}I.create=(r,e)=>new I({shape:()=>r,unknownKeys:"strip",catchall:W.create(),typeName:m.ZodObject,...v(e)});I.strictCreate=(r,e)=>new I({shape:()=>r,unknownKeys:"strict",catchall:W.create(),typeName:m.ZodObject,...v(e)});I.lazycreate=(r,e)=>new I({shape:r,unknownKeys:"strip",catchall:W.create(),typeName:m.ZodObject,...v(e)});class xe extends g{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function n(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new A(o.ctx.common.issues));return h(t,{code:l.invalid_union,unionErrors:i}),y}if(t.common.async)return Promise.all(s.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(n);{let a;const i=[];for(const d of s){const c={...t,common:{...t.common,issues:[]},parent:null},f=d._parseSync({data:t.data,path:t.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!a&&(a={result:f,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(d=>new A(d));return h(t,{code:l.invalid_union,unionErrors:o}),y}}get options(){return this._def.options}}xe.create=(r,e)=>new xe({options:r,typeName:m.ZodUnion,...v(e)});const Pe=r=>r instanceof ke?Pe(r.schema):r instanceof V?Pe(r.innerType()):r instanceof Se?[r.value]:r instanceof Y?r.options:r instanceof Ne?Object.keys(r.enum):r instanceof Ie?Pe(r._def.innerType):r instanceof ge?[void 0]:r instanceof _e?[null]:null;class $e extends g{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.object)return h(t,{code:l.invalid_type,expected:u.object,received:t.parsedType}),y;const s=this.discriminator,n=t.data[s],a=this.optionsMap.get(n);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:l.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const n=new Map;for(const a of t){const i=Pe(a.shape[e]);if(!i)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,a)}}return new $e({typeName:m.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...v(s)})}}function Ye(r,e){const t=K(r),s=K(e);if(r===e)return{valid:!0,data:r};if(t===u.object&&s===u.object){const n=x.objectKeys(e),a=x.objectKeys(r).filter(o=>n.indexOf(o)!==-1),i={...r,...e};for(const o of a){const d=Ye(r[o],e[o]);if(!d.valid)return{valid:!1};i[o]=d.data}return{valid:!0,data:i}}else if(t===u.array&&s===u.array){if(r.length!==e.length)return{valid:!1};const n=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],d=Ye(i,o);if(!d.valid)return{valid:!1};n.push(d.data)}return{valid:!0,data:n}}else return t===u.date&&s===u.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class be extends g{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(a,i)=>{if(Je(a)||Je(i))return y;const o=Ye(a.value,i.value);return o.valid?((qe(a)||qe(i))&&t.dirty(),{status:t.value,value:o.data}):(h(s,{code:l.invalid_intersection_types}),y)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([a,i])=>n(a,i)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}be.create=(r,e,t)=>new be({left:r,right:e,typeName:m.ZodIntersection,...v(t)});class B extends g{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==u.array)return h(s,{code:l.invalid_type,expected:u.array,received:s.parsedType}),y;if(s.data.length<this._def.items.length)return h(s,{code:l.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y;!this._def.rest&&s.data.length>this._def.items.length&&(h(s,{code:l.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map((i,o)=>{const d=this._def.items[o]||this._def.rest;return d?d._parse(new U(s,i,s.path,o)):null}).filter(i=>!!i);return s.common.async?Promise.all(a).then(i=>O.mergeArray(t,i)):O.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new B({...this._def,rest:e})}}B.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new B({items:r,typeName:m.ZodTuple,rest:null,...v(e)})};class we extends g{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==u.object)return h(s,{code:l.invalid_type,expected:u.object,received:s.parsedType}),y;const n=[],a=this._def.keyType,i=this._def.valueType;for(const o in s.data)n.push({key:a._parse(new U(s,o,s.path,o)),value:i._parse(new U(s,s.data[o],s.path,o))});return s.common.async?O.mergeObjectAsync(t,n):O.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof g?new we({keyType:e,valueType:t,typeName:m.ZodRecord,...v(s)}):new we({keyType:j.create(),valueType:e,typeName:m.ZodRecord,...v(t)})}}class je extends g{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==u.map)return h(s,{code:l.invalid_type,expected:u.map,received:s.parsedType}),y;const n=this._def.keyType,a=this._def.valueType,i=[...s.data.entries()].map(([o,d],c)=>({key:n._parse(new U(s,o,s.path,[c,"key"])),value:a._parse(new U(s,d,s.path,[c,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const d of i){const c=await d.key,f=await d.value;if(c.status==="aborted"||f.status==="aborted")return y;(c.status==="dirty"||f.status==="dirty")&&t.dirty(),o.set(c.value,f.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const d of i){const c=d.key,f=d.value;if(c.status==="aborted"||f.status==="aborted")return y;(c.status==="dirty"||f.status==="dirty")&&t.dirty(),o.set(c.value,f.value)}return{status:t.value,value:o}}}}je.create=(r,e,t)=>new je({valueType:e,keyType:r,typeName:m.ZodMap,...v(t)});class se extends g{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==u.set)return h(s,{code:l.invalid_type,expected:u.set,received:s.parsedType}),y;const n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(h(s,{code:l.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(h(s,{code:l.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function i(d){const c=new Set;for(const f of d){if(f.status==="aborted")return y;f.status==="dirty"&&t.dirty(),c.add(f.value)}return{status:t.value,value:c}}const o=[...s.data.values()].map((d,c)=>a._parse(new U(s,d,s.path,c)));return s.common.async?Promise.all(o).then(d=>i(d)):i(o)}min(e,t){return new se({...this._def,minSize:{value:e,message:p.toString(t)}})}max(e,t){return new se({...this._def,maxSize:{value:e,message:p.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}se.create=(r,e)=>new se({valueType:r,minSize:null,maxSize:null,typeName:m.ZodSet,...v(e)});class ce extends g{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.function)return h(t,{code:l.invalid_type,expected:u.function,received:t.parsedType}),y;function s(o,d){return Me({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Oe(),ye].filter(c=>!!c),issueData:{code:l.invalid_arguments,argumentsError:d}})}function n(o,d){return Me({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Oe(),ye].filter(c=>!!c),issueData:{code:l.invalid_return_type,returnTypeError:d}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof ue?M(async(...o)=>{const d=new A([]),c=await this._def.args.parseAsync(o,a).catch(T=>{throw d.addIssue(s(o,T)),d}),f=await i(...c);return await this._def.returns._def.type.parseAsync(f,a).catch(T=>{throw d.addIssue(n(f,T)),d})}):M((...o)=>{const d=this._def.args.safeParse(o,a);if(!d.success)throw new A([s(o,d.error)]);const c=i(...d.data),f=this._def.returns.safeParse(c,a);if(!f.success)throw new A([n(c,f.error)]);return f.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ce({...this._def,args:B.create(e).rest(ee.create())})}returns(e){return new ce({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new ce({args:e||B.create([]).rest(ee.create()),returns:t||ee.create(),typeName:m.ZodFunction,...v(s)})}}class ke extends g{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ke.create=(r,e)=>new ke({getter:r,typeName:m.ZodLazy,...v(e)});class Se extends g{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:l.invalid_literal,expected:this._def.value}),y}return{status:"valid",value:e.data}}get value(){return this._def.value}}Se.create=(r,e)=>new Se({value:r,typeName:m.ZodLiteral,...v(e)});function Yt(r,e){return new Y({values:r,typeName:m.ZodEnum,...v(e)})}class Y extends g{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return h(t,{expected:x.joinValues(s),received:t.parsedType,code:l.invalid_type}),y}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),s=this._def.values;return h(t,{received:t.data,code:l.invalid_enum_value,options:s}),y}return M(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Y.create(e)}exclude(e){return Y.create(this.options.filter(t=>!e.includes(t)))}}Y.create=Yt;class Ne extends g{_parse(e){const t=x.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==u.string&&s.parsedType!==u.number){const n=x.objectValues(t);return h(s,{expected:x.joinValues(n),received:s.parsedType,code:l.invalid_type}),y}if(t.indexOf(e.data)===-1){const n=x.objectValues(t);return h(s,{received:s.data,code:l.invalid_enum_value,options:n}),y}return M(e.data)}get enum(){return this._def.values}}Ne.create=(r,e)=>new Ne({values:r,typeName:m.ZodNativeEnum,...v(e)});class ue extends g{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.promise&&t.common.async===!1)return h(t,{code:l.invalid_type,expected:u.promise,received:t.parsedType}),y;const s=t.parsedType===u.promise?t.data:Promise.resolve(t.data);return M(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ue.create=(r,e)=>new ue({type:r,typeName:m.ZodPromise,...v(e)});class V extends g{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===m.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null;if(n.type==="preprocess"){const i=n.transform(s.data);return s.common.async?Promise.resolve(i).then(o=>this._def.schema._parseAsync({data:o,path:s.path,parent:s})):this._def.schema._parseSync({data:i,path:s.path,parent:s})}const a={addIssue:i=>{h(s,i),i.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),n.type==="refinement"){const i=o=>{const d=n.refinement(o,a);if(s.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){const i=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Re(i))return i;const o=n.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(i=>Re(i)?Promise.resolve(n.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);x.assertNever(n)}}V.create=(r,e,t)=>new V({schema:r,typeName:m.ZodEffects,effect:e,...v(t)});V.createWithPreprocess=(r,e,t)=>new V({schema:e,effect:{type:"preprocess",transform:r},typeName:m.ZodEffects,...v(t)});class H extends g{_parse(e){return this._getType(e)===u.undefined?M(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}H.create=(r,e)=>new H({innerType:r,typeName:m.ZodOptional,...v(e)});class re extends g{_parse(e){return this._getType(e)===u.null?M(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}re.create=(r,e)=>new re({innerType:r,typeName:m.ZodNullable,...v(e)});class Ie extends g{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===u.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ie.create=(r,e)=>new Ie({innerType:r,typeName:m.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...v(e)});class Ae extends g{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return De(n)?n.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new A(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new A(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Ae.create=(r,e)=>new Ae({innerType:r,typeName:m.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...v(e)});class ze extends g{_parse(e){if(this._getType(e)!==u.nan){const s=this._getOrReturnCtx(e);return h(s,{code:l.invalid_type,expected:u.nan,received:s.parsedType}),y}return{status:"valid",value:e.data}}}ze.create=r=>new ze({typeName:m.ZodNaN,...v(r)});const hr=Symbol("zod_brand");class Xt extends g{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Te extends g{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?y:a.status==="dirty"?(t.dirty(),qt(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})})();{const n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?y:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new Te({in:e,out:t,typeName:m.ZodPipeline})}}const Qt=(r,e={},t)=>r?le.create().superRefine((s,n)=>{var a,i;if(!r(s)){const o=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,d=(i=(a=o.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0,c=typeof o=="string"?{message:o}:o;n.addIssue({code:"custom",...c,fatal:d})}}):le.create(),pr={object:I.lazycreate};var m;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline"})(m||(m={}));const fr=(r,e={message:`Input not instance of ${r.name}`})=>Qt(t=>t instanceof r,e),es=j.create,ts=J.create,mr=ze.create,yr=q.create,ss=ve.create,vr=te.create,gr=Ze.create,_r=ge.create,xr=_e.create,br=le.create,wr=ee.create,kr=W.create,Sr=Le.create,Nr=z.create,Ir=I.create,Tr=I.strictCreate,Er=xe.create,Cr=$e.create,Pr=be.create,Or=B.create,Mr=we.create,Rr=je.create,Dr=se.create,Zr=ce.create,Lr=ke.create,jr=Se.create,Ar=Y.create,zr=Ne.create,Vr=ue.create,At=V.create,$r=H.create,Gr=re.create,Ur=V.createWithPreprocess,Br=Te.create,Hr=()=>es().optional(),Wr=()=>ts().optional(),Fr=()=>ss().optional(),Kr={string:r=>j.create({...r,coerce:!0}),number:r=>J.create({...r,coerce:!0}),boolean:r=>ve.create({...r,coerce:!0}),bigint:r=>q.create({...r,coerce:!0}),date:r=>te.create({...r,coerce:!0})},Jr=y;var D=Object.freeze({__proto__:null,defaultErrorMap:ye,setErrorMap:Qs,getErrorMap:Oe,makeIssue:Me,EMPTY_PATH:er,addIssueToContext:h,ParseStatus:O,INVALID:y,DIRTY:qt,OK:M,isAborted:Je,isDirty:qe,isValid:Re,isAsync:De,get util(){return x},get objectUtil(){return Ke},ZodParsedType:u,getParsedType:K,ZodType:g,ZodString:j,ZodNumber:J,ZodBigInt:q,ZodBoolean:ve,ZodDate:te,ZodSymbol:Ze,ZodUndefined:ge,ZodNull:_e,ZodAny:le,ZodUnknown:ee,ZodNever:W,ZodVoid:Le,ZodArray:z,ZodObject:I,ZodUnion:xe,ZodDiscriminatedUnion:$e,ZodIntersection:be,ZodTuple:B,ZodRecord:we,ZodMap:je,ZodSet:se,ZodFunction:ce,ZodLazy:ke,ZodLiteral:Se,ZodEnum:Y,ZodNativeEnum:Ne,ZodPromise:ue,ZodEffects:V,ZodTransformer:V,ZodOptional:H,ZodNullable:re,ZodDefault:Ie,ZodCatch:Ae,ZodNaN:ze,BRAND:hr,ZodBranded:Xt,ZodPipeline:Te,custom:Qt,Schema:g,ZodSchema:g,late:pr,get ZodFirstPartyTypeKind(){return m},coerce:Kr,any:br,array:Nr,bigint:yr,boolean:ss,date:vr,discriminatedUnion:Cr,effect:At,enum:Ar,function:Zr,instanceof:fr,intersection:Pr,lazy:Lr,literal:jr,map:Rr,nan:mr,nativeEnum:zr,never:kr,null:xr,nullable:Gr,number:ts,object:Ir,oboolean:Fr,onumber:Wr,optional:$r,ostring:Hr,pipeline:Br,preprocess:Ur,promise:Vr,record:Mr,set:Dr,strictObject:Tr,string:es,symbol:gr,transformer:At,tuple:Or,undefined:_r,union:Er,unknown:wr,void:Sr,NEVER:Jr,ZodIssueCode:l,quotelessJson:Xs,ZodError:A});const qr=D.object({id:D.string(),label:D.string().nullable(),targetPath:D.string(),targetType:D.enum(["forms","hooks","jobs"])}),Yr=D.object({type:D.enum(["forms","hooks","jobs"]),position:D.tuple([D.number(),D.number()]),label:D.string(),id:D.string(),transitions:D.array(qr)}),Xr=D.array(Yr),pe={"Content-Type":"application/json"};class Qr{constructor(){N(this,"pubsub");this.pubsub=new Gt}async getInitialData(){const e=await fetch("/_editor/api/workflow-editor/initial-data");if(e.ok){const t=await e.json();return Xr.parse(t)}else throw this.pubsub.publish("error",{message:await e.text(),action:"getInitialData"}),new Error("Failed to fetch initial data")}async move(e){const t=await fetch("/_editor/api/workflow-editor/move",{method:"POST",headers:pe,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"move"}),new Error("Failed to move nodes")}async delete(e){const t=await fetch("/_editor/api/workflow-editor/delete",{method:"POST",headers:pe,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"delete"}),new Error("Failed to delete nodes")}async addNodes(e){const t=await fetch("/_editor/api/workflow-editor/add-nodes",{method:"POST",headers:pe,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"addNodes"}),new Error("Failed to add nodes")}async duplicateNodes(e){const t=await fetch("/_editor/api/workflow-editor/duplicate-nodes",{method:"POST",headers:pe,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"duplicateNodes"}),new Error("Failed to duplicate nodes")}async addTransition(e){const t=await fetch("/_editor/api/workflow-editor/add-transition",{method:"POST",headers:pe,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"duplicateNodes"}),new Error("Failed to duplicate nodes")}}const F=new Qr,en="#ababab",tn="#e55b70";function rs(r,e,t){const s=e.projectedCenter(r);let n;if(t instanceof L){const i=t.projectedRect(r),o=We(i);n=Et(s,G(s,o),t.projectedRect(r))}else n=r.mouseState.mousePos;return{p1:Et(n,G(n,s),e.projectedRect(r)),p2:n}}function ns(r,e,t,s=!1){const{p1:n,p2:a}=rs(r,e,t),i=20,o=10;if(us(n,a)<2*i)return;const d=Math.atan2(a.y-n.y,a.x-n.x);r.ctx.strokeStyle=s?tn:en,r.ctx.lineWidth=4,r.ctx.lineJoin="round",r.ctx.lineCap="round",r.ctx.beginPath(),r.ctx.moveTo(n.x+i*Math.cos(d),n.y+i*Math.sin(d)),r.ctx.lineTo(a.x-i*Math.cos(d),a.y-i*Math.sin(d)),r.ctx.moveTo(a.x-i*Math.cos(d)-o*Math.cos(d-Math.PI/6),a.y-i*Math.sin(d)-o*Math.sin(d-Math.PI/6)),r.ctx.lineTo(a.x-i*Math.cos(d),a.y-i*Math.sin(d)),r.ctx.lineTo(a.x-i*Math.cos(d)-o*Math.cos(d+Math.PI/6),a.y-i*Math.sin(d)-o*Math.sin(d+Math.PI/6)),r.ctx.stroke()}class he{constructor(e,t,s){N(this,"sourceType");N(this,"sourceId");N(this,"dto");if(!s.targetPath)throw new Error(`Link ${s.id} has no target`);this.sourceType=e,this.sourceId=t,this.dto=s}get sourceNodeId(){return this.sourceId}get targetNodeId(){return this.dto.targetPath}get id(){return this.dto.id}clone(e,t){return new he(this.sourceType,e,{...this.dto,id:Ms(),targetPath:t})}isHovering(e,t){const s=e.nodes.find(i=>i.id===this.sourceNodeId),n=e.nodes.find(i=>i.id===this.targetNodeId);if(!s)throw new Error(`Source node ${this.sourceId} not found`);if(!n)throw new Error(`Target node ${this.targetNodeId} not found`);const a={radius:10,segment:rs(e,s,n)};return ls(t,a)}static from(e,t,s){return new he(e,t,s)}render(e){const t=e.nodes.find(a=>a.id===this.sourceNodeId),s=e.nodes.find(a=>a.id===this.targetNodeId);if(!t)throw new Error(`Source node ${this.sourceId} not found`);if(!s)throw new Error(`Target node ${this.targetNodeId} not found`);const n=e.selectedLinks.includes(this);ns(e,t,s,n)}}const sn="#5b5b5b",He=18;class L{constructor(e){N(this,"dto");this.dto=e}addLinkTo(e,t){e.addLink(he.from(this.type,this.id,{id:Be(),label:"",targetPath:t.id,targetType:t.type}))}get id(){return this.dto.id}get type(){return this.dto.type}get title(){return this.dto.label}static from(e){return new L(e)}static new(e){return new L({type:e,id:Be(),position:[0,0],label:`New ${e.slice(0,-1)}`,transitions:[]})}static async getSavedState(){const e=await F.getInitialData(),t=e.map(n=>L.from(n)),s=e.flatMap(n=>n.transitions.map(a=>he.from(n.type,n.id,a)));return{nodes:t,links:s}}get position(){return{x:this.dto.position[0],y:this.dto.position[1],referential:"world"}}set position(e){this.dto.position=[e.x,e.y]}projectedCenter(e){const t=e.camera.worldPoint2screen(this.position);if(e.mouseState.state==="MOVING"&&e.selectedNodes.includes(this))return fe(t,G(e.mouseState.initialMousePos,e.mouseState.mousePos));if(e.mouseState.state==="ADDING_NEW_NODES"&&e.mouseState.nodes.includes(this)){const s=oe(e.mouseState.nodes.map(a=>a.screenRect(e)));if(!s)throw new Error("No hull found");const n=We(s);return fe(t,G(n,e.mouseState.mousePos))}else return t}get icon(){return this.dto.type==="forms"?Bt:this.dto.type==="jobs"?Ht:Wt}screenRect(e){const t=e.camera.worldPoint2screen(this.position),n=this.getTextSize(e).width+50*e.camera.zoom,a=e.camera.zoom*(He+22);return{x:t.x-n/2,y:t.y-a/2,width:n,height:a,referential:"screen"}}projectedRect(e){const t=this.projectedCenter(e),n=this.getTextSize(e).width+50*e.camera.zoom,a=e.camera.zoom*(He+22);return{x:t.x-n/2,y:t.y-a/2,width:n,height:a,referential:"screen"}}renderIcon(e,t){e.ctx.fillStyle=sn,e.ctx.save(),e.ctx.translate(t.x+8*e.camera.zoom,t.y+8*e.camera.zoom),e.ctx.scale(e.camera.zoom,e.camera.zoom),e.ctx.fill(new Path2D(this.icon)),e.ctx.restore()}setTextRenderingCtx(e){e.ctx.textAlign="left",e.ctx.textBaseline="middle",e.ctx.fillStyle="black";const t=(He*e.camera.zoom).toFixed(0);e.ctx.font=`${t}px sans-serif`}getTextSize(e){return this.setTextRenderingCtx(e),e.ctx.measureText(this.dto.label)}renderLabel(e,t){const s=We(t),n=t.x;this.setTextRenderingCtx(e),!(e.ctx.measureText(this.dto.label).width>t.width)&&e.ctx.fillText(this.dto.label,n+40*e.camera.zoom,s.y)}renderCard(e,t){e.ctx.save(),e.ctx.fillStyle="white",e.ctx.shadowBlur=15,e.ctx.shadowColor="rgba(0,0,0,0.1)",e.ctx.fillRect(t.x,t.y,t.width,t.height),e.ctx.restore(),e.ctx.strokeStyle="gray",this.renderIcon(e,t),this.renderLabel(e,t)}renderSelf(e){const t=this.projectedRect(e);this.renderCard(e,t)}renderDuplicating(e){if(e.mouseState.state==="MOVING"&&e.mouseState.duplicating&&e.selectedNodes.includes(this)){const t=this.projectedRect(e),s=G(e.mouseState.mousePos,e.mouseState.initialMousePos),n=hs(t,s);this.renderCard(e,n)}}renderLinking(e){var t;e.mouseState.state!=="LINKING"||!e.selectedNodes.includes(this)||ns(e,this,(t=e.mouseState.snappedTarget)!=null?t:e.mouseState.mousePos)}render(e){this.renderLinking(e),this.renderSelf(e),this.renderDuplicating(e)}isHovering(e,t){return Vt(t,this.projectedRect(e))}translate(e){const t=fe(this.position,e);this.dto.position=[t.x,t.y]}clone(){return L.from({...this.dto,label:`${this.dto.label} (copy)`,id:Be()})}}async function zt(r,e,t){const s=e.selectedNodes[0];if(s.type==="forms")r.inspector={runtimeType:"forms",model:Ge(await Ps.get(s.id)),inspectorMode:t};else if(s.type==="jobs")r.inspector={runtimeType:"jobs",model:Ge(await Ft.get(s.id)),inspectorMode:t};else if(s.type==="hooks")r.inspector={runtimeType:"hooks",model:Ge(await Os.get(s.id)),inspectorMode:t};else throw new Error(`Unknown type ${s.type}`)}class me{constructor(e){N(this,"canvasGui");N(this,"_inspector");N(this,"logService");this.canvasGui=e,window.__canvasGui=e,this._inspector=de(null),this.logService=Rs.create()}static async init(e){const t=tt.create(e),s=new me(t),a=navigator.userAgent.indexOf("Mac OS X")?"Option":"Alt";t.pubsub.subscribe("node:dblclick",()=>{zt(s,t,"edit")});const i=st.create([{icon:Ns,label:"Options (Double click/Enter)",click:async()=>{zt(s,t,"edit")}},{icon:Is,label:"Add transition (T)",click:()=>{t.addTransition()}},{icon:Ts,label:`Duplicate (${a} + Drag)`,click:()=>{t.duplicateSelection()}},{icon:Es,label:"Delete (Delete/Backspace)",click:()=>{t.deleteSelection()}}]);t.setFloatingMenu(i);let o=null;return addEventListener("mousemove",d=>o=d),e.parentElement.addEventListener("keydown",d=>{!o||(d.key==="f"?t.dragstart(L.new("forms"),o):d.key==="h"?t.dragstart(L.new("hooks"),o):d.key==="j"&&t.dragstart(L.new("jobs"),o))}),await this.reload(t),t.init(),F.pubsub.subscribe("error",({message:d})=>{fs.error({message:d}),this.reload(t)}),t.pubsub.subscribe("nodes:moved",d=>F.move(d.map(c=>({type:c.node.type,id:c.node.id,position:[c.to.x,c.to.y]})))),t.pubsub.subscribe("deleted",d=>F.delete([...d.nodes.map(c=>({id:c.id,type:c.type})),...d.links.map(c=>({id:c.id,type:"transitions"}))])),t.pubsub.subscribe("nodes:added",d=>F.addNodes(d.nodes.map(c=>({position:[c.position.x,c.position.y],type:c.type,id:c.id,title:c.title})))),t.pubsub.subscribe("nodes:duplicated",d=>F.duplicateNodes(d.map(({duplicate:c,original:f})=>({original_id:f.id,new_id:c.id,type:f.type,position:[c.position.x,c.position.y],title:c.title})))),t.pubsub.subscribe("transition:added",d=>F.addTransition(d.links.map(c=>({source:{type:c.source.type,id:c.source.id},target:{id:c.target.id,type:c.target.type}})))),s}static async reload(e){const t=await F.getInitialData();e.clear(),t.forEach(s=>{e.addNode(L.from(s)),s.transitions.forEach(n=>{e.addLink(he.from(s.type,s.id,n))})})}get inspector(){return this._inspector.value}set inspector(e){this._inspector.value=e}async closeInspector(){var t;const e=async()=>new Promise(s=>Ut.confirm({title:"You have unsaved changes. Do you ",okText:"Save",cancelText:"Continue without saving",okButtonProps:{type:"primary"},cancelButtonProps:{danger:!0},onOk:async()=>{var n;await((n=this._inspector.value)==null?void 0:n.model.save()),await me.reload(this.canvasGui),s()},onCancel:()=>s()}));(t=this._inspector.value)!=null&&t.model.hasChanges()&&await e(),this._inspector.value=null,me.reload(this.canvasGui)}async dragstart(e,t){this.canvasGui.dragstart(L.new(e),t)}}class rn{async list(e){const t=new URLSearchParams({stage:e});return await(await fetch(`/_editor/api/stage_runs?${t}`)).json()}}const nn=new rn;class rt{constructor(e){this.dto=e}static async list(e){return(await nn.list(e)).map(s=>new rt(s))}get id(){return this.dto.id}get data(){return this.dto.data}get assignee(){return this.dto.assignee}get stage(){return this.dto.stage}get status(){return this.dto.status}}function as(r){switch(typeof r){case"object":return Object.entries(r).map(([e,t])=>({title:e,key:e,children:as(t)}));default:return[{title:r,key:r}]}}const an=Ve({__name:"StageInspector",props:{runtime:{}},setup(r){const e=r;function t(a){switch(a.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"}}}const{result:s,loading:n}=Xe(()=>rt.list(e.runtime instanceof Ft?e.runtime.identifier:e.runtime.path));return(a,i)=>{var o;return C(),R(w(zs),{loading:w(n),"data-source":(o=w(s))!=null?o:[]},{header:k(()=>[S(w(Dt),null,{default:k(()=>[S(w(Q),null,{default:k(()=>[$("Status")]),_:1}),S(w(Q),null,{default:k(()=>[$("Assignee")]),_:1}),S(w(Q),null,{default:k(()=>[$("Data")]),_:1})]),_:1})]),renderItem:k(({item:d})=>[S(w(Dt),null,{default:k(()=>[S(w(Vs),{color:t(d).color},{default:k(()=>[$(ie(t(d).text),1)]),_:2},1032,["color"]),S(w(Q),null,{default:k(()=>{var c;return[$(ie((c=d.assignee)!=null?c:"Anyone"),1)]}),_:2},1024),S(w(ms),{"tree-data":w(as)(d.data)},null,8,["tree-data"])]),_:2},1024)]),_:1},8,["loading","data-source"])}}}),on=Ve({__name:"FormTester",props:{form:{},logService:{}},setup(r){var f,b,T,E;const e=r,{result:t,loading:s}=Xe(()=>Kt.get()),n=de({}),a=Ce(()=>Gs.create({formPath:e.form.path}));(f=a.value)==null||f.on("stdout",_=>{e.logService.log({type:"stdout",log:_.log})}),(b=a.value)==null||b.on("stderr",_=>{e.logService.log({type:"stderr",log:_.log})}),(T=a.value)==null||T.onClose(()=>{e.logService.log({type:"stderr",log:"Program closed"})}),(E=a.value)==null||E.on("files:changed",()=>{e.logService.log({type:"files-changed",log:"Files changed"})});const i=$t(),o=({path:_})=>{Bs("editor",i,_)},d=de(null);async function c(){var _;return e.logService.log({type:"restart"}),(_=d.value)==null?void 0:_.run()}return(_,P)=>w(s)||!w(t)?(C(),R(w(ys),{key:0})):(C(),R(Us,{key:1,ref_key:"runner",ref:d,form:_.form.makeRunnerData(w(t)),params:n.value,"is-preview":"","enable-auto-focus":"",broker:a.value,onNavigate:o,onLogout:c},null,8,["form","params","broker"]))}}),cn=Ve({__name:"JobTester",props:{job:{},logService:{}},setup(r){const e=r,t=de(!1);async function s(){t.value=!0;try{const{stdout:n,stderr:a}=await e.job.test();e.logService.log({type:"stdout",log:n}),e.logService.log({type:"stderr",log:a})}finally{t.value=!1}}return(n,a)=>(C(),Fe("div",null,[S(w(vs),{loading:t.value,onClick:s},{default:k(()=>[$("run")]),_:1},8,["loading"])]))}}),dn={class:"workflow-editor"},ln={class:"title"},un={href:"/_editor/style"},hn={class:"workflow-editor-content"},pn={class:"workflow-toolbar"},fn=["onDragstart"],mn={class:"canvas-container",tabindex:"0"},yn=Ve({__name:"WorkflowEditor",setup(r){const e=Ce(()=>{var T,E,_;const b=(_=(E=(T=c.value)==null?void 0:T.inspector)==null?void 0:E.model.title)!=null?_:"";return b.length>30?b.slice(0,30)+"...":b}),{result:t}=Xe(()=>Kt.get()),s=Ce(()=>{var b;return(b=t.value)==null?void 0:b.makeRunnerData().logoUrl}),n=Ce(()=>{var b;return(b=t.value)==null?void 0:b.makeRunnerData().brandName}),a=$t();function i(){a.push({name:"workspace"})}const o=[{icon:Bt,title:"Forms",type:"forms",description:"Wait for a user input",key:"F"},{icon:Wt,title:"Hooks",type:"hooks",description:"Wait for an external API call",key:"H"},{icon:Ht,title:"Jobs",type:"jobs",description:"Scheduled tasks",key:"J"}],d=de(null),c=ne(null),f=(b,T)=>{var E,_;(E=T.dataTransfer)==null||E.setData("type",b),(_=c.value)==null||_.dragstart(b,T)};return gs(async()=>{if(!d.value)throw new Error("Canvas not found");c.value=await me.init(d.value)}),(b,T)=>{var E;return C(),Fe("div",dn,[S(w(Zt),{style:{padding:"5px 10px"},onBack:i},{extra:k(()=>[S(Ws),S(Hs)]),avatar:k(()=>[s.value?(C(),R(w(Fs),{key:0,src:s.value},null,8,["src"])):Z("",!0),X("span",ln,[S(w(Q),null,{default:k(()=>[$(ie(n.value||"New Workflow"),1)]),_:1}),X("a",un,[S(Ct,{path:w(Cs),class:"edit-icon"},null,8,["path"])])])]),_:1}),X("div",hn,[X("div",pn,[(C(),Fe(_s,null,xs(o,_=>S(w(bs),{key:_.type,placement:"right"},{title:k(()=>[S(w(Ks),null,{default:k(()=>[S(w(Q),null,{default:k(()=>[$(ie(_.title),1)]),_:2},1024),S(w(Q),{keyboard:""},{default:k(()=>[$(ie(_.key),1)]),_:2},1024)]),_:2},1024)]),content:k(()=>[$(ie(_.description),1)]),default:k(()=>[X("span",{draggable:"true",onDragstart:P=>f(_.type,P)},[S(Ct,{class:"toolbar-item",path:_.icon},null,8,["path"])],40,fn)]),_:2},1024)),64))]),X("div",mn,[X("canvas",{ref_key:"canvas",ref:d,class:"workflow-canvas"},null,512)])]),S(w(Ss),{class:"workflow-inspector",open:!!((E=c.value)!=null&&E.inspector),width:640,"footer-style":{padding:0},onClose:T[1]||(T[1]=_=>{var P;return(P=c.value)==null?void 0:P.closeInspector()})},{title:k(()=>[S(w(Zt),{title:e.value},{footer:k(()=>{var _;return[(_=c.value)!=null&&_.inspector?(C(),R(w(ks),{key:0,"active-key":c.value.inspector.inspectorMode,"onUpdate:activeKey":T[0]||(T[0]=P=>c.value.inspector.inspectorMode=P)},{default:k(()=>[S(w(Ue),{key:"edit",tab:"Settings"}),S(w(Ue),{key:"list-stage-runs",tab:"Stage runs"}),S(w(Ue),{key:"start-abuble",tab:"Test"})]),_:1},8,["active-key"])):Z("",!0)]}),extra:k(()=>{var _,P;return[((P=(_=c.value)==null?void 0:_.inspector)==null?void 0:P.inspectorMode)==="edit"?(C(),R($s,{key:0,model:c.value.inspector.model},null,8,["model"])):Z("",!0)]}),_:1},8,["title"])]),default:k(()=>{var _,P,nt,at,it,ot,ct,dt,lt,ut,ht,pt,ft,mt,yt,vt,gt,_t,xt,bt,wt,kt,St,Nt,It,Tt;return[((P=(_=c.value)==null?void 0:_.inspector)==null?void 0:P.inspectorMode)==="list-stage-runs"?(C(),R(an,{key:0,runtime:c.value.inspector.model},null,8,["runtime"])):Z("",!0),((at=(nt=c.value)==null?void 0:nt.inspector)==null?void 0:at.runtimeType)==="forms"&&((ot=(it=c.value)==null?void 0:it.inspector)==null?void 0:ot.inspectorMode)==="edit"?(C(),R(Zs,{key:1,form:c.value.inspector.model},null,8,["form"])):Z("",!0),((dt=(ct=c.value)==null?void 0:ct.inspector)==null?void 0:dt.runtimeType)==="jobs"&&((ut=(lt=c.value)==null?void 0:lt.inspector)==null?void 0:ut.inspectorMode)==="edit"?(C(),R(Ls,{key:2,job:c.value.inspector.model},null,8,["job"])):Z("",!0),((pt=(ht=c.value)==null?void 0:ht.inspector)==null?void 0:pt.runtimeType)==="hooks"&&((mt=(ft=c.value)==null?void 0:ft.inspector)==null?void 0:mt.inspectorMode)==="edit"?(C(),R(js,{key:3,hook:c.value.inspector.model},null,8,["hook"])):Z("",!0),((vt=(yt=c.value)==null?void 0:yt.inspector)==null?void 0:vt.runtimeType)==="hooks"&&((_t=(gt=c.value)==null?void 0:gt.inspector)==null?void 0:_t.inspectorMode)==="start-abuble"?(C(),R(As,{key:4,hook:c.value.inspector.model,"log-service":c.value.logService},null,8,["hook","log-service"])):Z("",!0),((bt=(xt=c.value)==null?void 0:xt.inspector)==null?void 0:bt.runtimeType)==="forms"&&((kt=(wt=c.value)==null?void 0:wt.inspector)==null?void 0:kt.inspectorMode)==="start-abuble"?(C(),R(on,{key:5,form:c.value.inspector.model,"log-service":c.value.logService},null,8,["form","log-service"])):Z("",!0),((Nt=(St=c.value)==null?void 0:St.inspector)==null?void 0:Nt.runtimeType)==="jobs"&&((Tt=(It=c.value)==null?void 0:It.inspector)==null?void 0:Tt.inspectorMode)==="start-abuble"?(C(),R(cn,{key:6,job:c.value.inspector.model,"log-service":c.value.logService},null,8,["job","log-service"])):Z("",!0)]}),footer:k(()=>{var _,P;return[((P=(_=c.value)==null?void 0:_.inspector)==null?void 0:P.inspectorMode)==="start-abuble"?(C(),R(Ds,{key:0,runtime:c.value.inspector.runtimeType,"log-service":c.value.logService},null,8,["runtime","log-service"])):Z("",!0)]}),_:1},8,["open"])])}}});const ua=ws(yn,[["__scopeId","data-v-66c8deb6"]]);export{ua as default};
//# sourceMappingURL=WorkflowEditor.37028d15.js.map

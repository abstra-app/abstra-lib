var B=Object.defineProperty;var z=(s,t,e)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>(z(s,typeof t!="symbol"?t+"":t,e),e);import{R as V,ao as U,q as k,b as p,c as b,O as q,Q as J,x as C,d as M,K as y,r as W,a as Y,F as K,L as Q,A as I,e as P,z as m,D as H,t as S,am as X,an as Z,a8 as tt,G as L,y as et,w as x,B as G,ap as st,aq as it}from"./registerWidgets.c5dd482d.js";import{w as O,l as w}from"./runnerData.dbeb802a.js";import{e as ot,R as nt}from"./executeJs.f7c6d11e.js";import{p as at}from"./passwordlessManager.52cc41e1.js";import{P as rt}from"./pubsub.c4034e7f.js";import{P as lt}from"./Passwordless.3b840492.js";import{W as ht}from"./WidgetsFrame.6bd33770.js";import{e as dt}from"./icons.7e192558.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="d0f11d83-aa6b-410f-b428-a648ed1f4088",s._sentryDebugIdIdentifier="sentry-dbid-d0f11d83-aa6b-410f-b428-a648ed1f4088")}catch{}})();function ee(s,t){return{dx:t.x-s.x,dy:t.y-s.y,referential:s.referential}}function ct(s,t){return s.rowEnd<t.rowStart||s.colEnd<t.colStart&&s.rowStart<t.rowEnd?-1:1}function se(s,t){const e=t.margin+s.colStart*(t.gap+t.cellWidth),i=t.margin+t.navbarLength+s.rowStart*(t.gap+t.cellHeight),o=t.margin-t.gap+(t.gap+t.cellWidth)*(s.colEnd+1),n=t.margin+t.navbarLength-t.gap+(t.gap+t.cellHeight)*(s.rowEnd+1);return{x:e,y:i,width:o-e,height:n-i,referential:"world"}}function ut(s,t){return{...s,position:{colStart:s.position.colStart+t.deltaI,colEnd:s.position.colEnd+t.deltaI,rowStart:s.position.rowStart+t.deltaJ,rowEnd:s.position.rowEnd+t.deltaJ}}}function ie(s,t,e=!1){return e?t.x<=s.x&&t.x+t.width>=s.x&&t.y<=s.y&&t.y+t.height>=s.y:t.x<s.x&&t.x+t.width>s.x&&t.y<s.y&&t.y+t.height>s.y}function oe(s,t){return!(s.x>t.x+t.width||t.x>s.x+s.width||s.y>t.y+t.height||t.y>s.y+s.height)}function ne(s,t){return!(s.colStart>t.colEnd||t.colStart>s.colEnd||s.rowStart>t.rowEnd||t.rowStart>s.rowEnd)}function ae(s,t,e){const i=s.y===t.y,o=s.x===t.x,n=s.x+s.width===t.x+t.width,a=s.y+s.height===t.y+t.height;switch(e){case"left":return o;case"right":return n;case"top":return i;case"bottom":return a;case"top-left":return i&&o;case"top-right":return i&&n;case"bottom-left":return a&&o;case"bottom-right":return a&&n}}const re=s=>s.reduce((t,e)=>{const i=t?Math.min(t.x,e.x):e.x,o=t?Math.min(t.y,e.y):e.y,n=t?Math.max(t.x+t.width,e.x+e.width):e.x+e.width,a=t?Math.max(t.y+t.height,e.y+e.height):e.y+e.height;return{x:i,y:o,width:n-i,height:a-o,referential:e.referential}},null);function le(s,t){return Math.sqrt((s.x-t.x)**2+(s.y-t.y)**2)}function gt(s){const t=[];let e=0;for(const i in s){const[o,n]=s[i];e+=s.filter(([d,c,f],l)=>!(n.position.colStart>c.position.colEnd||c.position.colStart>n.position.colEnd)&&c.position.rowEnd+f>n.position.rowStart&&l<+i).reduce((d,c)=>d+Math.max(c[2],0),0);const a=ut(n,{deltaJ:e,deltaI:0});t.push([o,a])}return t}function pt(s,t){const e=Object.entries(s).sort((n,a)=>ct(n[1].position,a[1].position)),i=n=>document.querySelector(`[widget-id='${n}']`);return gt(e.map(([n,a])=>[n,a,i(n)?t.height2rows(i(n).offsetHeight)-(a.position.rowEnd-a.position.rowStart):0])).reduce((n,[a,d])=>({...n,[a]:{...d,position:{...d.position,rowEnd:O[d.type].autoHeight&&i(a)?d.position.rowStart+t.height2rows(i(a).offsetHeight):d.position.rowEnd}}}),{})}const wt=(s,t,e)=>t&&!t.condition?{computedElement:{...s,position:{...s.position,row:s.position.row+e,height:0}},updateOffset:0,addOffset:0,slot:{}}:{computedElement:{...s,position:{...s.position,row:s.position.row+e}},updateOffset:s.position.height,addOffset:s.position.row,slot:s.slot},yt={"if-block":wt},mt=(s,t,e)=>ft(T(Object.values(s),{widgets:[],slottables:[]},0,t),e),ft=(s,t)=>({widgets:pt(s.widgets.reduce((e,i)=>({...e,[i.id]:i}),{}),t),slottables:s.slottables.reduce((e,i)=>({...e,[i.id]:i}),{})}),vt=(s,t)=>{if(w(s)&&w(t))return t.position.rowStart-s.position.rowStart;if(w(s)&&!w(t))return t.position.row-s.position.rowStart===0?-1:t.position.row-s.position.rowStart;if(!w(s)&&w(t))return t.position.rowStart-s.position.row===0?1:t.position.rowStart-s.position.row;if(!w(s)&&!w(t)){if(t.position.row-s.position.row===0){if(t.position.order===s.position.order)throw new Error("Two slottables with the same order in the same row");return t.position.order-s.position.order}return t.position.row-s.position.row}return 0},T=(s,t,e,i)=>s.sort(vt).reduce((o,n)=>bt(n,e,o,i),t),bt=(s,t,e,i)=>w(s)?St(s,t,e):Ct(s,t,e,i),St=(s,t,e)=>(e.widgets.push({...s,position:j(s.position,t)}),e),Ct=(s,t,e,i)=>{const{computedElement:o,slot:n,updateOffset:a,addOffset:d}=yt[s.type](s,i[s.id],t),c=Pt(e,a);return c.slottables.push(o),T(Object.values(n),c,t+d,i)},Pt=(s,t)=>({widgets:xt(s.widgets,t),slottables:Et(s.slottables,t)}),xt=(s,t)=>s.map(e=>({...e,position:j(e.position,t)})),Et=(s,t)=>s.map(e=>({...e,position:{...e.position,row:e.position.row+t}})),j=(s,t)=>({...s,rowStart:s.rowStart+t,rowEnd:s.rowEnd+t}),kt=960,$=12,Nt=0,Rt=24,Wt=32,It=8;class D{constructor(t,e){r(this,"width");r(this,"columns");r(this,"gap");r(this,"margin");r(this,"padding");r(this,"calculatePositions");r(this,"_cellHeight");r(this,"dashPlayerService");this.dashPlayerService=t,this.width=kt,this.columns=$,this.gap=Nt,this.margin=Rt,this.padding=It,this._cellHeight=Wt,this.calculatePositions=e}static create(t,e){return new D(t,e)}static get columns(){return $}get cellHeight(){return this._cellHeight}get navbarLength(){return this.dashPlayerService.navbarVisible?48:0}get cellWidth(){const t=this.columns-1;return(this.width-2*this.margin-t*this.gap)/this.columns}get rows(){const{widgets:t,slottables:e}=this.calculatePositions();return Math.max(Object.values(t!=null?t:{}).map(i=>i.position.rowEnd).reduce((i,o)=>Math.max(i,o),0)+4,Object.values(e!=null?e:{}).map(i=>i.position.row+i.position.height).reduce((i,o)=>Math.max(i,o),0)+4,20)}get sidebarWidth(){return this.dashPlayerService.hasSidebar?240:0}getCell(t,e){return{x:this.margin+t*(this.cellWidth+(t>0?this.gap:0)),y:this.margin+this.navbarLength+e*(this._cellHeight+(e>0?this.gap:0)),width:this.cellWidth,height:this._cellHeight,referential:"world"}}getCellFrom(t,e){const i=this.getCell(t.i,t.j);return this.cellAt(i.x+e.dx,i.y+e.dy)}areaFromRect(t){const e=this.cellAt(t.x,t.y),i={dx:t.width-1,dy:t.height-1,referential:"world"},o=this.getCellFrom(e,i);return{colStart:e.i,rowStart:e.j,colEnd:o.i,rowEnd:o.j}}rectFromArea(t){const e=this.getCell(t.colStart,t.rowStart),i=this.getCell(t.colEnd,t.rowEnd);return{x:e.x,y:e.y,width:i.x+i.width-e.x,height:i.y+i.height-e.y,referential:"world"}}get height(){return this.rows*(this._cellHeight+this.gap)-this.gap+2*this.margin}cellAt(t,e){return{i:Math.floor((t-this.margin)/(this.cellWidth+this.gap)),j:Math.floor((e-this.margin-this.navbarLength)/(this._cellHeight+this.gap))}}snap(t,e){const i=e==="bottom-right"||e==="top-right"?1:0,o=e==="bottom-left"||e==="bottom-right"?1:0,n=this.cellWidth+this.gap,a=this._cellHeight+this.gap,d=this.margin+this.cellWidth*i,c=this.margin+this.navbarLength+this.cellHeight*o,f=t.x-d,l=t.y-c;return{x:d+n*Math.round(f/n),y:c+a*Math.round(l/a),referential:"world"}}snapDelta(t){const e=this.cellWidth+this.gap,i=this._cellHeight+this.gap;return{dx:e*Math.round(t.dx/e),dy:i*Math.round(t.dy/i),referential:"world"}}height2rows(t){return Math.ceil((t+this.gap)/(this.cellHeight+this.gap))}}class _{constructor(t,e,i){r(this,"_stateTimestamp",Date.now());r(this,"_state");r(this,"runnerData");r(this,"passwordlessManager");r(this,"websocketClient");r(this,"_autocompleteState");r(this,"layoutGrid");r(this,"stateChangeCallbacks",[]);r(this,"updateUserCallbacks",[]);r(this,"onWidgetsComputedCallbacks",[]);r(this,"onCloseCallbacks",[]);r(this,"onNoCreditsMessageCallbacks",[]);r(this,"onRedirectCallback",null);this._state=V({type:"IDLE"}),this._autocompleteState={suggestionsFor:null,suggestions:[]},this.runnerData=t,this.passwordlessManager=e,this.websocketClient=i,this.layoutGrid=D.create(this,()=>this.calculatePositions()),window.__playerService=()=>this}notifyStateChange(t){this.stateChangeCallbacks.forEach(e=>e(t))}onStateChange(t){this.stateChangeCallbacks.push(t)}setState(t){this._state.value=t,this.notifyStateChange(t)}get state(){return this._state.value}static create(t,e,i){return new _(t,e,i)}updateRunnerData(t){this.runnerData=t}get brokerIsClosed(){var t;return(t=this.websocketClient.isClosed)!=null?t:!0}calculatePositions(t,e){const i=t||(this.state.type==="RUNNING"?this.state.props:{}),o=e!=null?e:this.runnerData.layout.slot;return mt(o,i,this.layoutGrid)}updateDashData(t){if(!t)throw new Error("dash is null");if(!t.layout)throw new Error("dash.layout is null");switch(this.state.type){case"RUNNING":{this.runnerData=t;const{widgets:e}=this.calculatePositions();this.setState({...this.state,widgets:e});break}default:throw new Error(`Invalid state ${this.state.type} for updateDashData`)}}start(t={}){this.clearSuggestions(),this.websocketClient.isClosed||this.websocketClient.reset(),this.websocketClient.onClose(e=>{this.closeCallback(e)}),this.websocketClient.on("execution-id",()=>{this.websocketClient.send({type:"client-start",state:this.apiPageState,params:t}),this.setState({type:"READY"})}),this.websocketClient.on("program-start-failed",e=>{this.setState({...e,type:"ERROR",cause:"PROGRAM_START_FAILED"})}),this.websocketClient.on("widgets-computed",e=>{const{widgets:i,slottables:o}=this.calculatePositions(e.props);if(this.state.type==="READY"){const n={};if(e.variables)for(const a in e.variables){if(!(a in e.variables)){console.warn(`widget ${a} not found in layout`);continue}n[a]=new U(e.props[a]),n[a].setValue(e.variables[a])}this.setState({...e,type:"RUNNING",eventProcessing:!1,alerts:[],widgets:i,responses:n,slottables:o,authenticatedUser:this.passwordlessManager.getUser()})}if(this.passwordlessManager.pubsub.subscribe("authenticated",()=>this.endAuth()),this.state.type==="RUNNING"){const n={...this.state.responses};for(const a in e.variables)if(!n[a]){if(!(a in e.variables)){console.warn(`widget ${a} not found in layout`);continue}n[a]=new U(e.props[a]),n[a].setValue(e.variables[a])}this.setState({...this.state,eventProcessing:!1,widgets:i,props:e.props})}this.widgetsComputedMessage(e)}),this.websocketClient.on("not-enough-credits",()=>{this.noCreditsMessage()}),this.websocketClient.on("redirect",e=>{this.redirect(e)}),this.websocketClient.on("auth:require-info",()=>{this.passwordlessManager.getUser()?this.endAuth():this.startAuth()}),this.websocketClient.on("auth:valid-jwt",()=>{this.setState({type:"READY"})}),this.websocketClient.on("auth:invalid-jwt",()=>{console.warn("invalid jwt"),this.badAuth()}),this.websocketClient.on("autocomplete:suggestions",({suggestionsFor:e,suggestions:i})=>{this._autocompleteState={suggestionsFor:e,suggestions:i}}),this.websocketClient.on("alert",e=>{this.state.type==="RUNNING"&&this.setState({...this.state,alerts:[...this.state.alerts,{message:e.message,severity:e.severity,id:this.state.alerts.length}]})}),this.websocketClient.on("execute-js:request",async e=>{this.websocketClient.send({type:"execute-js:response",value:await ot(e)})}),this.websocketClient.connect()}sendWidgetsChanged(t){this.websocketClient.send({type:"widgets-changed",state:this.apiPageState,dashDefinition:{slot:t}})}sendEvalRequest(t){this.websocketClient.send({type:"eval",expression:t,state:this.apiPageState})}sendVariableCreated(t){this.websocketClient.send({name:t,value:null,type:"variable-created",state:this.apiPageState})}makeWidgetsError(t){return{widgets:Object.keys(this.runnerData.layout.slot).reduce((i,o)=>(i[o]={repr:t},i),{}),props:{},variables:{}}}onUpdateUser(t){this.updateUserCallbacks.push(t)}onWidgetsComputedMessage(t){this.onWidgetsComputedCallbacks.push(t)}widgetsComputedMessage(t){this.onWidgetsComputedCallbacks.forEach(e=>e(t))}onClose(t){this.onCloseCallbacks.push(t)}closeCallback(t){this.onCloseCallbacks.forEach(e=>e(t))}onNoCreditsMessage(t){this.onNoCreditsMessageCallbacks.push(t)}noCreditsMessage(){this.onNoCreditsMessageCallbacks.forEach(t=>t())}onRedirect(t){this.onRedirectCallback=t}redirect(t){!this.onRedirectCallback||this.onRedirectCallback(t)}wait(t){return this.websocketClient.wait(t)}on(t,e){this.websocketClient.on(t,e)}onMany(t,e){t.forEach(i=>this.on(i,e))}get apiPageState(){const t=this.state.type==="RUNNING"?this.state.responses:{},e=Object.keys(this.runnerData.layout.slot).reduce((i,o)=>{var n,a;return{...i,[o]:{value:(a=(n=t[o])==null?void 0:n.value)!=null?a:null}}},{});return{timestamp:this._stateTimestamp,widgets:e}}getUserEmail(){var t,e;switch(this.state.type){case"RUNNING":return(e=(t=this.state.authenticatedUser)==null?void 0:t.claims.email)!=null?e:null;default:return null}}startAuth(){switch(this.state.type){case"RUNNING":if(this.state.authenticatedUser)return;this.setState({type:"AUTHENTICATING",previousState:this.state});break;case"READY":this.setState({type:"AUTHENTICATING",previousState:this.state});break;default:throw new Error(`Invalid state ${this.state.type} for startAuth`)}}endAuth(){this.websocketClient.send({type:"auth:saved-jwt",jwt:this.passwordlessManager.getUser().jwt})}badAuth(){if(this.state.type!=="AUTHENTICATING")throw new Error(`Invalid state ${this.state.type} for badAuth`);this.state.previousState.type==="RUNNING"?this.setState({...this.state.previousState,authenticatedUser:null}):this.state.previousState.type==="READY"&&this.setState({...this.state.previousState})}logout(){this.passwordlessManager.removeUser(),this.start()}isAuthenticating(){return this.state.type==="AUTHENTICATING"}get suggestionsFor(){return this._autocompleteState.suggestionsFor}get suggestions(){return this._autocompleteState.suggestions}clearSuggestions(){this._autocompleteState={suggestionsFor:null,suggestions:[]}}getAutocompleteSuggestions(t,e){t!==this.suggestionsFor&&this.clearSuggestions(),this.websocketClient.send({type:"autocomplete:load",suggestionsFor:t,code:e})}get navbarVisible(){const{logoUrl:t,brandName:e}=this.runnerData,i=this.getUserEmail();return!!(this.hasSidebar||t||e||i)}get hasSidebar(){const t=this.runnerData.sidebar;return!t||t.length==0?!1:t.some(e=>e.visible)}getWidgetsListeners(){switch(this.state.type){case"RUNNING":return Object.entries(this.state.widgets).reduce((t,[e,i])=>({...t,[e]:this.listenersFromWidget(e,i.type)}),{});default:return{}}}listenersFromWidget(t,e){return O[e].events.reduce((i,o)=>({...i,[o.key]:n=>{this.sendWidgetInputMessage(t),this.sendWidgetEventMessage(t,o.key,n)}}),{})}sendWidgetInputMessage(t){!this.websocketClient||this.websocketClient.send({type:"widget-input",widgetId:t,state:this.apiPageState})}sendWidgetEventMessage(t,e,i){if(!this.websocketClient||this.state.type!=="RUNNING")return;const o=this.apiPageState;this.websocketClient.send({type:"widget-event",event:{type:e,payload:i},widgetId:t,state:o}),this.setState({...this.state,eventProcessing:!0})}}class A{constructor(t){r(this,"ws");r(this,"pubsub");r(this,"dash");this.pubsub=new rt,this.ws=null,this.dash=t,this.pubsub.wait("close")}static create(t){return new A(t)}get url(){return`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/_socket?dashPath=${encodeURIComponent(this.dash.path)}`}get isClosed(){return this.ws?this.ws.readyState!==WebSocket.OPEN:!0}on(t,e){this.pubsub.subscribe(t,e)}wait(t){return this.pubsub.wait(t)}reset(){if(!this.ws)throw new Error("no websocket to clear");this.pubsub.reset(),this.ws.close()}async connect(t=1){t>3||await new Promise((e,i)=>{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{e()},this.ws.onerror=o=>{i(o)},this.ws.onclose=()=>{this.pubsub.publish("close")},this.ws.onmessage=o=>{const n=JSON.parse(o.data);this.pubsub.publish(n.type,n)}}).catch(e=>{console.error(e),this.connect(t+1)})}onClose(t){this.pubsub.subscribe("close",t)}close(){if(!this.ws)throw new Error("no websocket to close");this.ws.close()}async send(t){if(!this.ws)throw new Error("no websocket to send");if(this.isClosed)throw new Error("websocket is closed");this.ws.send(JSON.stringify(t))}}function he(s){const t=A.create(s);return _.create(s,at,t)}const Mt={},Dt=s=>(q("data-v-5d7ea65b"),s=s(),J(),s),_t={class:"dash-loading"},At=Dt(()=>C("div",{class:"dash-loading-container"},[C("div",{class:"loading-bar-background"}),C("div",{class:"loading-bar"})],-1)),Ut=[At];function Gt(s,t){return p(),b("div",_t,Ut)}const $t=k(Mt,[["render",Gt],["__scopeId","data-v-5d7ea65b"]]);function E(){return window.matchMedia("(min-width: 1200px)").matches}const Ht={key:0,class:"error-widget"},Lt={key:0},Ot={key:2,class:"loading"},Tt=M({__name:"WidgetsGrid",props:{camera:null,isPreview:{type:Boolean},widgetsWithErrors:null,grid:null,widgetsListeners:null,widgetsProps:null,widgetsResponses:null,widgets:null,forceResponsivity:null},setup(s){const t=s,e=y(()=>({...i.value,padding:`${t.grid.margin}px`,gap:`${t.grid.gap}px`,maxWidth:`${t.grid.width}px`,height:`${t.grid.height}px`,gridTemplateColumns:`repeat(${t.grid.columns}, ${t.grid.cellWidth}px)`,gridTemplateRows:`repeat(auto-fill, ${t.grid.cellHeight}px)`})),i=y(()=>{const l=E()?t.grid.sidebarWidth+(o.value-t.grid.sidebarWidth-960)/2:(o.value-960)/2;return{"--dash-right-margin":`${E()?(o.value-t.grid.sidebarWidth-960)/2:(o.value-960)/2}px`,"--dash-left-margin":`${l}px`}}),o=W(window.innerWidth);window.addEventListener("resize",()=>{o.value=window.innerWidth});const n=l=>{const u=l.target;u.scrollHeight>u.clientHeight&&l.stopPropagation()};function a(l){return{gridColumnStart:`${l.position.colStart+1}`,gridColumnEnd:`${l.position.colEnd+2}`,gridRowStart:`${l.position.rowStart+1}`,gridRowEnd:`${l.position.rowEnd+2}`,padding:`${t.grid.padding}px`}}const d=l=>{const u=l.position.rowEnd-l.position.rowStart+1;return u*t.grid.cellHeight+(u-1)*t.grid.gap-2*t.grid.padding},c=l=>{const u=l.position.colEnd-l.position.colStart+1;return u*t.grid.cellWidth+(u-1)*t.grid.gap-2*t.grid.padding},f=l=>{var u;return l in((u=t.widgetsProps)!=null?u:{})};return(l,u)=>{const N=Y("icon");return p(),b("div",{class:L(["dash",s.forceResponsivity]),style:I(m(e))},[(p(!0),b(K,null,Q(s.widgets,(h,g)=>{var v,R;return p(),b("div",{key:g,class:"widget",style:I(a(h)),onWheel:n},[((v=s.widgetsWithErrors)==null?void 0:v.find(F=>F==g))&&s.isPreview?(p(),b("div",Ht,[P(N,{width:"20",height:"20",path:m(dt),fill:"#D35249"},null,8,["path"]),c(h)>=160&&d(h)>=120?(p(),b("p",Lt," Ops! There is an error in this widget's properties ")):H("",!0)])):f(g)?(p(),S(tt(h.type),X({key:1,data:s.widgetsProps[g],response:s.widgetsResponses[g],runtime:"dash","container-width":c(h),"container-height":d(h),zoom:(R=s.camera)==null?void 0:R.zoom,"widget-id":g},Z(s.widgetsListeners[g])),null,16,["data","response","container-width","container-height","zoom","widget-id"])):(p(),b("div",Ot))],36)}),128))],6)}}});const jt=k(Tt,[["__scopeId","data-v-4d2eaf45"]]),Ft=M({__name:"LayoutPresenter",props:{widgets:null,props:null,responses:null,widgetsListeners:null,camera:null,forceResponsivity:null,grid:null,widgetsWithErrors:null,runnerData:null,isPreview:{type:Boolean}},setup(s){const t=et();return(e,i)=>(p(),S(ht,{class:"dash-player","main-color":s.runnerData.mainColor,"font-family":s.runnerData.fontFamily,theme:s.runnerData.theme,runtime:"dash"},{default:x(()=>[G(e.$slots,"header",{},void 0,!0),m(t).overrideMain?G(e.$slots,"overrideMain",{key:1},void 0,!0):(p(),S(jt,{key:0,camera:s.camera,"is-preview":s.isPreview,"widgets-with-errors":s.widgetsWithErrors,grid:s.grid,"widgets-listeners":s.widgetsListeners,"widgets-props":s.props,"widgets-responses":s.responses,widgets:s.widgets,"force-responsivity":s.forceResponsivity},null,8,["camera","is-preview","widgets-with-errors","grid","widgets-listeners","widgets-props","widgets-responses","widgets","force-responsivity"]))]),_:3},8,["main-color","font-family","theme"]))}});const Bt=k(Ft,[["__scopeId","data-v-4c9ad021"]]),zt=M({__name:"DashPlayer",props:{isPreview:{type:Boolean},dashPlayerService:null,forceResponsivity:null,camera:null,widgetsWithErrors:null,editingMode:{type:Boolean},params:null},emits:["navigate","logout"],setup(s,{emit:t}){const e=s,i=W(null),o=W(window.innerWidth);window.addEventListener("resize",()=>{o.value=window.innerWidth});const n=h=>t("navigate",h),a=y(()=>{var h;return(h=e.dashPlayerService.getUserEmail())!=null?h:void 0}),d=y(()=>e.dashPlayerService.state.type==="RUNNING"?e.dashPlayerService.state.widgets:Object.entries(e.dashPlayerService.runnerData.layout.slot).reduce((h,[g,v])=>Object.assign(h,{[g]:v}),{})),c=y(()=>e.dashPlayerService.state.type==="RUNNING"?e.dashPlayerService.state.responses:{}),f=y(()=>e.dashPlayerService.state.type==="RUNNING"?e.dashPlayerService.state.alerts:[]),l=y(()=>e.dashPlayerService.state.type==="RUNNING"?e.dashPlayerService.state.props:{}),u=y(()=>{const h=E()?e.dashPlayerService.layoutGrid.sidebarWidth+(o.value-e.dashPlayerService.layoutGrid.sidebarWidth-960)/2:(o.value-960)/2;return{"--dash-right-margin":`${E()?(o.value-e.dashPlayerService.layoutGrid.sidebarWidth-960)/2:(o.value-960)/2}px`,"--dash-left-margin":`${h}px`}}),N=y(()=>({...u.value,padding:`${e.dashPlayerService.layoutGrid.margin}px`,width:`${e.dashPlayerService.layoutGrid.width}px`,gap:`${e.dashPlayerService.layoutGrid.gap}px`,height:"100%",boxSizing:"border-box"}));return e.dashPlayerService.start(e.params),e.dashPlayerService.onNoCreditsMessage(()=>{var h;(h=i.value)==null||h.open()}),(h,g)=>{var v;return p(),S(Bt,{widgets:m(d),props:m(l),responses:m(c),"widgets-listeners":s.dashPlayerService.getWidgetsListeners(),camera:s.camera,"force-responsivity":s.forceResponsivity,grid:s.dashPlayerService.layoutGrid,"widgets-with-errors":(v=s.widgetsWithErrors)!=null?v:[],"runner-data":s.dashPlayerService.runnerData,"is-preview":s.isPreview},st({header:x(()=>[P(nt,{ref_key:"runtimeCommonsRef",ref:i,type:"dashes",runtime:s.dashPlayerService.runnerData,"full-width":!0,"is-preview":s.isPreview,"user-email":m(a),"force-responsivity":s.forceResponsivity,alerts:m(f),onNavigate:n,onLogout:g[0]||(g[0]=R=>s.dashPlayerService.logout())},null,8,["runtime","is-preview","user-email","force-responsivity","alerts"]),P(it,null,{default:x(()=>[s.dashPlayerService.state.type==="RUNNING"&&s.dashPlayerService.state.eventProcessing?(p(),S($t,{key:0})):H("",!0)]),_:1})]),_:2},[s.dashPlayerService.isAuthenticating()?{name:"overrideMain",fn:x(()=>[C("div",{class:L(["auth-form",s.forceResponsivity]),style:I(m(N))},[P(lt,{class:"form-auth"})],6)]),key:"0"}:void 0]),1032,["widgets","props","responses","widgets-listeners","camera","force-responsivity","grid","widgets-with-errors","runner-data","is-preview"])}}});const de=k(zt,[["__scopeId","data-v-541764d8"]]);export{de as D,ae as a,ne as b,oe as c,ee as d,ie as i,he as m,le as p,re as r,ct as v,se as w};
//# sourceMappingURL=DashPlayer.8655e0d9.js.map

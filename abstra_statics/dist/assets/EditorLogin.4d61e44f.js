import{N as pe}from"./Navbar.0cf9e650.js";import{a as P}from"./asyncComputed.92146382.js";import{m as fe}from"./url.84e62ca8.js";import{d as ge,c as _,r as x,eb as _e,a5 as E,f as u,e as ve,u as a,a as s,b as l,o,S as Z,g as f,ed as g,eG as i,A as ye,aB as F,cS as y,cT as m,aR as M,ec as K,h as c,cz as v,bJ as C,eg as me,bR as we,cy as ze,_ as Ie}from"./jwt-decode.esm.1b301f74.js";import{A as je}from"./apiKey.49b8decf.js";import{j as Q}from"./router.99a53337.js";import{M as be}from"./member.3c3a769a.js";import{O as he}from"./organization.c92a9190.js";import{P as Ne}from"./project.48a235c1.js";import"./tables.13d62f0c.js";import{F as ke}from"./folder.934b13ce.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.e74c1d9b.js";import"./constants.f352d89b.js";import"./PhChats.vue.870bbba9.js";import"./PhSignOut.vue.6be07f90.js";import"./index.e189c6ed.js";import"./index.2efe5ae2.js";import"./omniChatStore.8902e4de.js";import"./record.b96b0275.js";import"./uuid.58d26ff2.js";import"./PhCopySimple.vue.f5246c24.js";import"./PhBookBookmark.vue.4a6ba053.js";import"./PhSparkle.vue.ca8d1014.js";import"./index.ded0f9ab.js";import"./Breadcrumb.21c760be.js";import"./index.8ea8b90b.js";import"./string.4796d44a.js";(function(){try{var w=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new Error().stack;p&&(w._sentryDebugIds=w._sentryDebugIds||{},w._sentryDebugIds[p]="3efce464-d022-4173-a59a-27a511a20990",w._sentryDebugIdIdentifier="sentry-dbid-3efce464-d022-4173-a59a-27a511a20990")}catch{}})();const Ee={class:"container"},Se={class:"content"},S="NEW_ORGANIZATION_KEY",R="NEW_FOLDER_KEY",D="NEW_PROJECT_KEY",Ae=ge({__name:"EditorLogin",setup(w){var q;const p=new ke,A=new he,z=new Ne,L=new be,H=(q=Q.getAuthor())==null?void 0:q.claims.email,{result:U,loading:X}=P(async()=>{const t=await A.list();return G(t.length>0?t[0].id:S),t}),{result:I,loading:j,refetch:J}=P(async()=>e.value.type==="loading-organizations"||e.value.type==="new-organization"?[]:z.list(e.value.organizationId)),{result:T,loading:V,refetch:ee}=P(async()=>e.value.type==="loading-organizations"||e.value.type==="new-organization"?[]:p.list(e.value.organizationId)),B=_(()=>{var t,n;return(n=(t=U.value)==null?void 0:t.map(r=>({key:r.id,label:r.name})))!=null?n:[]}),W=_(()=>I.value?I.value.filter(t=>{switch(e.value.type){case"new-project":return t.folderId===e.value.folderId;case"selected-project":return t.folderId===e.value.folderId;case"loading-folder":return t.folderId===e.value.folderId;default:return!1}}).map(t=>({key:t.id,label:t.name})):[]),Y=_(()=>{var t,n;return(n=(t=T.value)==null?void 0:t.map(r=>({value:r.id,label:r.name})))!=null?n:[]}),ae=_(()=>{switch(e.value.type){case"new-organization":return!e.value.organizationName;case"new-folder":return!e.value.folderName;case"new-project":return!e.value.projectName||!e.value.folderId;case"selected-project":return!1;case"loading-organization":case"loading-folder":return!0;default:throw new Error(`Invalid state ${JSON.stringify(e.value)}`)}}),b=async t=>await je.create({projectId:t,name:"default"}),e=x({type:"loading-organizations"}),te=_(()=>e.value.type==="new-organization"||e.value.type==="loading-organizations"?S:e.value.organizationId),re=_(()=>{if(e.value.type==="new-organization"||e.value.type==="new-folder"||e.value.type==="new-project"||e.value.type==="loading-organization"||e.value.type==="loading-folder"||e.value.type==="loading-organizations")return D;if(e.value.type==="selected-project")return e.value.projectId;throw new Error(`Invalid state ${JSON.stringify(e.value)}`)}),ne=_(()=>e.value.type==="new-project"||e.value.type==="selected-project"?e.value.folderId:R);function le(t){return t.split("@")[1].split(".")[0]}async function G(t){var n,r;if(t===S)e.value={type:"new-organization",organizationName:le(Q.getAuthor().claims.email),folderName:"My team folder",projectName:"My project"};else{e.value={type:"loading-organization",organizationId:String(t)},await Promise.all([J(),ee()]);const d=(n=T.value)==null?void 0:n.find(O=>O.organizationId===String(t)),k=(r=I.value)==null?void 0:r.find(O=>O.folderId===(d==null?void 0:d.id));d?k?e.value={type:"selected-project",organizationId:String(t),folderId:d.id,projectId:k.id}:e.value={type:"new-project",organizationId:String(t),folderId:d.id,projectName:"My project"}:e.value={type:"new-folder",organizationId:String(t),folderName:"My team folder",projectName:"My project"}}}function oe(t){if(e.value.type==="new-organization"||e.value.type==="new-folder"||e.value.type==="loading-organization"||e.value.type==="loading-folder"||e.value.type==="loading-organizations")throw new Error(`Invalid state ${JSON.stringify(e.value)}`);t===D?e.value={type:"new-project",organizationId:e.value.organizationId,folderId:e.value.folderId,projectName:"New project"}:e.value={type:"selected-project",organizationId:e.value.organizationId,folderId:e.value.folderId,projectId:String(t)}}async function ie(t){var n;if(e.value.type==="new-organization"||e.value.type==="loading-organizations")throw new Error(`Invalid state ${JSON.stringify(e.value)}`);if(t===R)e.value={type:"new-folder",organizationId:e.value.organizationId,folderName:"New folder",projectName:"New project"};else{e.value={type:"loading-folder",organizationId:e.value.organizationId,folderId:String(t)},await J();const r=(n=I.value)==null?void 0:n.find(d=>d.folderId===String(t));r?e.value={type:"selected-project",organizationId:e.value.organizationId,folderId:String(t),projectId:r.id}:e.value={type:"new-project",organizationId:e.value.organizationId,folderId:String(t),projectName:"New project"}}}async function de(t){const r=(await L.list(t)).find(d=>d.email===H);if(!r)throw new Error("Member not found");return r.id}async function se(t){const n=await L.list(t);return(await p.list(t)).length===0&&await p.create({name:"Default Folder",organizationId:t,memberIds:[...n.map(k=>k.id)]}),(await p.list(t))[0]}const h=x(!1);async function ue(){if(!h.value){h.value=!0;try{if(e.value.type==="new-organization"){const t=await A.create({name:e.value.organizationName}),n=await se(t.id),r=await z.create({name:e.value.projectName,organizationId:t.id,folderId:n.id}),d=await b(r.id);d.value&&N(d.value)}else if(e.value.type==="new-folder"){const t=await de(e.value.organizationId),n=await p.create({name:e.value.folderName,organizationId:e.value.organizationId,memberIds:[t]}),r=await z.create({name:e.value.projectName,organizationId:e.value.organizationId,folderId:n.id}),d=await b(r.id);d.value&&N(d.value)}else if(e.value.type==="new-project"){const t=await z.create({name:e.value.projectName,organizationId:e.value.organizationId,folderId:e.value.folderId}),n=await b(t.id);n.value&&N(n.value)}else if(e.value.type==="selected-project"){const t=await b(e.value.projectId);t.value&&N(t.value)}}finally{h.value=!1}}}const $=_e(),ce=x(null);async function N(t){if($.query.redirect){const n=$.query.redirect;if(!n.match(/http:\/\/localhost:\d+/))throw new Error("Invalid redirect");const r=decodeURIComponent(n);location.href=fe(r,{"api-key":t})}else ce.value=t}return(t,n)=>(o(),E("div",Ee,[u(pe),ve("div",Se,[a(X)||!a(U)?(o(),s(a(Z),{key:0})):(o(),s(a(ze),{key:1,layout:"vertical",class:"card"},{default:l(()=>[u(a(ye),{level:3,style:{padding:"0px",margin:"0px","margin-bottom":"30px"}},{default:l(()=>[f(g(a(i).translate("i18n_create_or_choose_project")),1)]),_:1}),u(a(v),{label:a(i).translate("i18n_get_api_key_organization")},{default:l(()=>[u(a(F),{style:{width:"100%"},placeholder:a(i).translate("i18n_get_api_key_choose_organization"),size:"large",value:te.value,"onUpdate:value":G},{default:l(()=>[u(a(y),{label:a(i).translate("i18n_get_api_key_new_organization")},{default:l(()=>[(o(),s(a(m),{key:S},{default:l(()=>[f(g(a(i).translate("i18n_get_api_key_create_new_organization")),1)]),_:1}))]),_:1},8,["label"]),B.value.length>0?(o(),s(a(y),{key:0,label:a(i).translate("i18n_get_api_key_existing_organizations")},{default:l(()=>[(o(!0),E(M,null,K(B.value,r=>(o(),s(a(m),{key:r.key},{default:l(()=>[f(g(r.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):c("",!0)]),_:1},8,["placeholder","value"])]),_:1},8,["label"]),e.value.type=="new-organization"?(o(),s(a(v),{key:0,label:a(i).translate("i18n_get_api_key_organization_name")},{default:l(()=>[u(a(C),{value:e.value.organizationName,"onUpdate:value":n[0]||(n[0]=r=>e.value.organizationName=r),placeholder:a(i).translate("i18n_get_api_key_choose_organization_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):c("",!0),e.value.type!=="new-organization"?(o(),s(a(v),{key:1,label:a(i).translate("i18n_get_api_key_folder")},{default:l(()=>[u(a(F),{disabled:a(V),value:ne.value,loading:a(V),size:"large","onUpdate:value":ie},{default:l(()=>[u(a(y),{label:a(i).translate("i18n_get_api_key_new_folder")},{default:l(()=>[(o(),s(a(m),{key:R},{default:l(()=>[f(g(a(i).translate("i18n_get_api_key_create_new_folder")),1)]),_:1}))]),_:1},8,["label"]),Y.value.length>0?(o(),s(a(y),{key:0,label:a(i).translate("i18n_get_api_key_existing_folders")},{default:l(()=>[(o(!0),E(M,null,K(Y.value,r=>(o(),s(a(m),{key:r.value},{default:l(()=>[f(g(r.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):c("",!0)]),_:1},8,["disabled","value","loading"])]),_:1},8,["label"])):c("",!0),e.value.type==="new-organization"||e.value.type==="new-folder"?(o(),s(a(v),{key:2,label:a(i).translate("i18n_get_api_key_folder_name")},{default:l(()=>[u(a(C),{value:e.value.folderName,"onUpdate:value":n[1]||(n[1]=r=>e.value.folderName=r),placeholder:a(i).translate("i18n_get_api_key_choose_folder_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):c("",!0),e.value.type!=="new-organization"&&e.value.type!=="new-folder"?(o(),s(a(v),{key:3,label:a(i).translate("i18n_get_api_key_project")},{default:l(()=>[u(a(F),{style:{width:"100%"},disabled:a(j),placeholder:a(i).translate("i18n_get_api_key_choose_project"),size:"large",value:re.value,"onUpdate:value":oe},me({default:l(()=>[a(j)?c("",!0):(o(),s(a(y),{key:0,label:a(i).translate("i18n_get_api_key_new_project")},{default:l(()=>[(o(),s(a(m),{key:D},{default:l(()=>[f(g(a(i).translate("i18n_get_api_key_create_new_project")),1)]),_:1}))]),_:1},8,["label"])),W.value.length>0&&!a(j)?(o(),s(a(y),{key:1,label:a(i).translate("i18n_get_api_key_existing_projects")},{default:l(()=>[(o(!0),E(M,null,K(W.value,r=>(o(),s(a(m),{key:r.key},{default:l(()=>[f(g(r.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):c("",!0)]),_:2},[a(j)?{name:"notFoundContent",fn:l(()=>[u(a(Z),{size:"small"})]),key:"0"}:void 0]),1032,["disabled","placeholder","value"])]),_:1},8,["label"])):c("",!0),e.value.type==="new-organization"||e.value.type==="new-folder"||e.value.type==="new-project"?(o(),s(a(v),{key:4,label:"Project name"},{default:l(()=>[u(a(C),{value:e.value.projectName,"onUpdate:value":n[2]||(n[2]=r=>e.value.projectName=r),placeholder:a(i).translate("i18n_get_api_key_choose_project_name"),size:"large"},null,8,["value","placeholder"])]),_:1})):c("",!0),u(a(v),{style:{"margin-top":"40px"}},{default:l(()=>[u(a(we),{type:"primary",disabled:ae.value,loading:h.value,style:{width:"100%"},onClick:ue},{default:l(()=>[f(g(a(i).translate("i18n_login_with_this_project")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))])]))}});const ra=Ie(Ae,[["__scopeId","data-v-cafd5a5e"]]);export{ra as default};
//# sourceMappingURL=EditorLogin.4d61e44f.js.map

var rt=Object.defineProperty;var ut=(t,e,a)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var X=(t,e,a)=>(ut(t,typeof e!="symbol"?e+"":e,a),a);import{h as dt}from"./linters.3b3b6ddd.js";import{d as L,af as P,g as V,o as i,K as g,O as F,F as x,e5 as ce,a as b,z as Ze,f as E,a8 as be,J as pe,eE as me,b as v,w as f,u as l,aL as K,ea as fe,c as C,da as Q,d5 as se,az as N,eb as O,ei as R,cH as ct,Q as re,h as ke,bu as xe,am as Ye,aP as Xe,ec as Ee,N as J,bM as _e,bE as Se,cs as We,cr as je,cE as Ue,eA as pt,e3 as ft,ej as ht,d2 as vt,bH as gt,eP as mt,eQ as yt,eo as wt,aj as kt,ep as _t,eq as bt}from"./index.c22aa062.js";import{g as $t,W as Ht,w as Ct}from"./controller.2e43238c.js";import{o as q,u as At}from"./omniChatStore.3e7d9b2f.js";import{a as Vt}from"./asyncComputed.19c1aa02.js";import{u as W,P as xt,_ as Et,g as Re,a as St,b as Mt,c as ue,N as It,e as Tt,M as Dt,f as zt}from"./index.67c88e5a.js";import{W as de}from"./workspaces.f3d06c99.js";import{U as Ft}from"./UnsavedChangesHandler.c31de4ec.js";import{w as Me,s as Lt}from"./metadata.bfcfd33c.js";import{_ as Bt,a as Nt}from"./vue-flow-minimap.d02d2ba2.js";import{G as Zt}from"./PhArrowCounterClockwise.vue.aae6029d.js";import{F as Pt,C as Ot}from"./filesController.fdad977b.js";import{T as Yt}from"./TasksManager.b3d39df4.js";import{n as Xt}from"./string.f4a33c37.js";import{a as Wt,b as jt,n as Ut}from"./validations.0c91e990.js";import"./index.5dd8248d.js";import{A as Rt}from"./index.6eedd7e0.js";import{t as Ke}from"./index.91a94cb7.js";import{B as Kt}from"./Badge.c46ea0e6.js";import{G as Pe}from"./PhArrowDown.vue.b824c982.js";import"./uuid.9cc35ba2.js";import"./record.7e41ad8b.js";import"./runnerData.1c198f68.js";import"./url.758142aa.js";import"./colorHelpers.87f2087b.js";import"./ExclamationCircleOutlined.078c3c03.js";import"./PhWebhooksLogo.vue.5e4e5ce5.js";import"./tasksController.7de8d1c7.js";import"./gateway.09e38840.js";import"./popupNotifcation.412082a1.js";import"./scripts.678c004d.js";import"./polling.3ca2c6b4.js";import"./ant-design.5be624db.js";import"./PhArrowSquareOut.vue.806c11e8.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.5ab1fdc6.js";import"./index.43bc6d23.js";import"./Card.29a2dac6.js";import"./TabPane.706d9cdf.js";import"./CollapsePanel.2612d3cc.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="98aa50f5-1612-4ecc-ba86-eb8308afc456",t._sentryDebugIdIdentifier="sentry-dbid-98aa50f5-1612-4ecc-ba86-eb8308afc456")}catch{}})();const Gt=["width","height","fill","transform"],qt={key:0},Jt=b("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Qt=[Jt],ea={key:1},ta=b("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),aa=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),oa=[ta,aa],sa={key:2},na=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),la=[na],ia={key:3},ra=b("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),ua=[ra],da={key:4},ca=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),pa=[ca],fa={key:5},ha=b("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),va=[ha],ga={name:"PhArrowClockwise"},ma=L({...ga,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=P("weight","regular"),o=P("size","1em"),s=P("color","currentColor"),u=P("mirrored",!1),d=V(()=>{var n;return(n=e.weight)!=null?n:a}),_=V(()=>{var n;return(n=e.size)!=null?n:o}),y=V(()=>{var n;return(n=e.color)!=null?n:s}),h=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(n,k)=>(i(),g("svg",ce({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:y.value,transform:h.value},n.$attrs),[F(n.$slots,"default"),d.value==="bold"?(i(),g("g",qt,Qt)):d.value==="duotone"?(i(),g("g",ea,oa)):d.value==="fill"?(i(),g("g",sa,la)):d.value==="light"?(i(),g("g",ia,ua)):d.value==="regular"?(i(),g("g",da,pa)):d.value==="thin"?(i(),g("g",fa,va)):x("",!0)],16,Gt))}}),ya=["width","height","fill","transform"],wa={key:0},ka=b("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),_a=[ka],ba={key:1},$a=b("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),Ha=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ca=[$a,Ha],Aa={key:2},Va=b("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),xa=[Va],Ea={key:3},Sa=b("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Ma=[Sa],Ia={key:4},Ta=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Da=[Ta],za={key:5},Fa=b("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),La=[Fa],Ba={name:"PhFunnel"},Na=L({...Ba,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=P("weight","regular"),o=P("size","1em"),s=P("color","currentColor"),u=P("mirrored",!1),d=V(()=>{var n;return(n=e.weight)!=null?n:a}),_=V(()=>{var n;return(n=e.size)!=null?n:o}),y=V(()=>{var n;return(n=e.color)!=null?n:s}),h=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(n,k)=>(i(),g("svg",ce({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:y.value,transform:h.value},n.$attrs),[F(n.$slots,"default"),d.value==="bold"?(i(),g("g",wa,_a)):d.value==="duotone"?(i(),g("g",ba,Ca)):d.value==="fill"?(i(),g("g",Aa,xa)):d.value==="light"?(i(),g("g",Ea,Ma)):d.value==="regular"?(i(),g("g",Ia,Da)):d.value==="thin"?(i(),g("g",za,La)):x("",!0)],16,ya))}}),Za=["width","height","fill","transform"],Pa={key:0},Oa=b("path",{d:"M160,116h48a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20V60H128a28,28,0,0,0-28,28v28H76v-4A20,20,0,0,0,56,92H24A20,20,0,0,0,4,112v32a20,20,0,0,0,20,20H56a20,20,0,0,0,20-20v-4h24v28a28,28,0,0,0,28,28h12v12a20,20,0,0,0,20,20h48a20,20,0,0,0,20-20V160a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20v12H128a4,4,0,0,1-4-4V88a4,4,0,0,1,4-4h12V96A20,20,0,0,0,160,116ZM52,140H28V116H52Zm112,24h40v40H164Zm0-112h40V92H164Z"},null,-1),Ya=[Oa],Xa={key:1},Wa=b("path",{d:"M64,112v32a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V112a8,8,0,0,1,8-8H56A8,8,0,0,1,64,112ZM208,40H160a8,8,0,0,0-8,8V96a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V48A8,8,0,0,0,208,40Zm0,112H160a8,8,0,0,0-8,8v48a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152Z",opacity:"0.2"},null,-1),ja=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),Ua=[Wa,ja],Ra={key:2},Ka=b("path",{d:"M144,96V80H128a8,8,0,0,0-8,8v80a8,8,0,0,0,8,8h16V160a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16v48a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V192H128a24,24,0,0,1-24-24V136H72v8a16,16,0,0,1-16,16H24A16,16,0,0,1,8,144V112A16,16,0,0,1,24,96H56a16,16,0,0,1,16,16v8h32V88a24,24,0,0,1,24-24h16V48a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16V96a16,16,0,0,1-16,16H160A16,16,0,0,1,144,96Z"},null,-1),Ga=[Ka],qa={key:3},Ja=b("path",{d:"M160,110h48a14,14,0,0,0,14-14V48a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14V66H128a22,22,0,0,0-22,22v34H70V112A14,14,0,0,0,56,98H24a14,14,0,0,0-14,14v32a14,14,0,0,0,14,14H56a14,14,0,0,0,14-14V134h36v34a22,22,0,0,0,22,22h18v18a14,14,0,0,0,14,14h48a14,14,0,0,0,14-14V160a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14v18H128a10,10,0,0,1-10-10V88a10,10,0,0,1,10-10h18V96A14,14,0,0,0,160,110ZM58,144a2,2,0,0,1-2,2H24a2,2,0,0,1-2-2V112a2,2,0,0,1,2-2H56a2,2,0,0,1,2,2Zm100,16a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2v48a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Zm0-112a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2V96a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Z"},null,-1),Qa=[Ja],eo={key:4},to=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),ao=[to],oo={key:5},so=b("path",{d:"M160,108h48a12,12,0,0,0,12-12V48a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12V68H128a20,20,0,0,0-20,20v36H68V112a12,12,0,0,0-12-12H24a12,12,0,0,0-12,12v32a12,12,0,0,0,12,12H56a12,12,0,0,0,12-12V132h40v36a20,20,0,0,0,20,20h20v20a12,12,0,0,0,12,12h48a12,12,0,0,0,12-12V160a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12v20H128a12,12,0,0,1-12-12V88a12,12,0,0,1,12-12h20V96A12,12,0,0,0,160,108ZM60,144a4,4,0,0,1-4,4H24a4,4,0,0,1-4-4V112a4,4,0,0,1,4-4H56a4,4,0,0,1,4,4Zm96,16a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4v48a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Zm0-112a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V96a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Z"},null,-1),no=[so],lo={name:"PhTreeStructure"},io=L({...lo,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=P("weight","regular"),o=P("size","1em"),s=P("color","currentColor"),u=P("mirrored",!1),d=V(()=>{var n;return(n=e.weight)!=null?n:a}),_=V(()=>{var n;return(n=e.size)!=null?n:o}),y=V(()=>{var n;return(n=e.color)!=null?n:s}),h=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(n,k)=>(i(),g("svg",ce({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:y.value,transform:h.value},n.$attrs),[F(n.$slots,"default"),d.value==="bold"?(i(),g("g",Pa,Ya)):d.value==="duotone"?(i(),g("g",Xa,Ua)):d.value==="fill"?(i(),g("g",Ra,Ga)):d.value==="light"?(i(),g("g",qa,Qa)):d.value==="regular"?(i(),g("g",eo,ao)):d.value==="thin"?(i(),g("g",oo,no)):x("",!0)],16,Za))}}),ie=class{constructor(){X(this,"ws",null);X(this,"reconnectTimer");X(this,"keepaliveInterval");X(this,"messageHandlers",new Set);X(this,"KEEPALIVE_INTERVAL",3e4);X(this,"RECONNECT_DELAY",1e3);this.connect()}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}get url(){return"/_editor/api/codebase/events"}handleMessage(e){try{const a=JSON.parse(e.data),o=dt.parse(a);this.messageHandlers.forEach(s=>{try{s(o)}catch(u){Ze(u)}})}catch(a){Ze(a)}}handleClose(){this.clearTimers(),this.scheduleReconnect()}handleError(){this.clearTimers(),this.scheduleReconnect()}clearTimers(){this.keepaliveInterval&&(clearInterval(this.keepaliveInterval),this.keepaliveInterval=void 0),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0)}scheduleReconnect(){this.reconnectTimer||(this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=void 0,this.connect()},this.RECONNECT_DELAY))}startKeepalive(){this.keepaliveInterval=setInterval(()=>{this.sendKeepalive()},this.KEEPALIVE_INTERVAL)}sendKeepalive(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){this.handleError();return}try{this.ws.send(JSON.stringify({type:"keepalive"}))}catch(e){console.error("CodebaseEventsService: Failed to send keepalive:",e),this.handleError()}}async connect(){var e;if(((e=this.ws)==null?void 0:e.readyState)!==WebSocket.OPEN)try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>this.startKeepalive(),this.ws.onclose=()=>this.handleClose(),this.ws.onerror=()=>this.handleError(),this.ws.onmessage=a=>this.handleMessage(a)}catch(a){console.error("CodebaseEventsService: Failed to create WebSocket:",a),this.scheduleReconnect()}}subscribe(e){return this.messageHandlers.add(e),()=>this.messageHandlers.delete(e)}isConnected(){var e;return((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN}};let we=ie;X(we,"instance",null);function ro(){const t=E(!1),e=E(null),a=E(null),o=we.getInstance(),s=()=>{t.value=o.isConnected()},u=y=>{e.value=y};let d;const _=setInterval(s,1e3);return be(()=>{d(),clearInterval(_)}),pe(()=>{d=o.subscribe(u),s()}),{isConnected:me(t),lastEvent:me(e),error:me(a),service:me(o)}}class Ge{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const j=t=>Ge.isMac?t.metaKey:t.ctrlKey,uo=t=>t.shiftKey,co=["onDragstart"],po={style:{display:"flex","flex-direction":"column","max-width":"250px"}},fo=L({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){return(a,o)=>(i(),g(K,null,[v(l(Q),{class:"toolbar",align:"center"},{default:f(()=>[(i(!0),g(K,null,fe(l(Me).stages,s=>(i(),C(l(ct),{key:s.key,placement:"top"},{title:f(()=>[v(l(Q),{gap:"small"},{default:f(()=>[v(l(se),null,{default:f(()=>[N(O(s.title),1)]),_:2},1024),v(l(se),{keyboard:""},{default:f(()=>[N(O(s.key),1)]),_:2},1024)]),_:2},1024)]),content:f(()=>[b("div",po,[v(l(se),null,{default:f(()=>[N(O(s.description),1)]),_:2},1024)])]),default:f(()=>[b("div",{draggable:!0,class:"toolbar__item",onDragstart:u=>e("drag-start",u.dataTransfer,s.typeName)},[(i(),C(R(s.icon),{size:18}))],40,co)]),_:2},1024))),128))]),_:1}),v(Ft,{"has-changes":a.controller.hasChanges()},null,8,["has-changes"])],64))}});const ho=re(fo,[["__scopeId","data-v-376981bb"]]);function qe(){let t;const e={draggedType:E(null),isDragOver:E(!1),isAdding:E(!1),isDragging:E(!1),mousePosition:E(null)},{draggedType:a,isDragOver:o,isDragging:s,isAdding:u}=e,d=A=>{t=A,document.addEventListener("mousemove",c)},{screenToFlowCoordinate:_}=W();ke(u,A=>{document.body.style.userSelect=A?"none":""});function y(A,I){u.value=!0,A?(A.setData("application/vueflow",I),A.effectAllowed="move",a.value=I,s.value=!0,document.addEventListener("drop",k)):(a.value=I,document.addEventListener("click",H))}function h(A){A.preventDefault(),a.value&&(o.value=!0,A.dataTransfer&&(A.dataTransfer.dropEffect="move"))}function n(){o.value=!1}function k(){u.value=!1,s.value=!1,o.value=!1,a.value=null,document.removeEventListener("drop",k)}function c(A){const I={x:A.pageX-200,y:A.pageY-80};e.mousePosition.value=I}function p(A){if(!a.value)throw new Error("No dragged type");return _({x:A.clientX-70,y:A.clientY-25})}function H(A){if(!t)return;if(!a.value)throw new Error("No dragged type");const I=p(A);t.addStages([{type:a.value,position:I}]),k()}function B(){document.removeEventListener("mousemove",c)}return{init:d,tearDown:B,draggedType:a,isDragOver:o,isAdding:u,isDragging:s,mousePosition:e.mousePosition,onDragStart:y,onDragLeave:n,onDragOver:h,onDrop:H}}const vo={name:"ControlButton",compatConfig:{MODE:3}},go=(t,e)=>{const a=t.__vccOpts||t;for(const[o,s]of e)a[o]=s;return a},mo={class:"vue-flow__controls-button"};function yo(t,e,a,o,s,u){return i(),g("button",mo,[F(t.$slots,"default")])}const oe=go(vo,[["render",yo]]),wo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},ko=b("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),_o=[ko];function bo(t,e){return i(),g("svg",wo,_o)}const $o={render:bo},Ho={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Co=b("path",{d:"M0 0h32v4.2H0z"},null,-1),Ao=[Co];function Vo(t,e){return i(),g("svg",Ho,Ao)}const xo={render:Vo},Eo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},So=b("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Mo=[So];function Io(t,e){return i(),g("svg",Eo,Mo)}const To={render:Io},Do={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},zo=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Fo=[zo];function Lo(t,e){return i(),g("svg",Do,Fo)}const Bo={render:Lo},No={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Zo=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),Po=[Zo];function Oo(t,e){return i(),g("svg",No,Po)}const Yo={render:Oo},Xo={name:"Controls",compatConfig:{MODE:3}},Wo=L({...Xo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>xt.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:a,nodesConnectable:o,elementsSelectable:s,setInteractive:u,zoomIn:d,zoomOut:_,fitView:y,viewport:h,minZoom:n,maxZoom:k}=W(),c=xe(()=>a.value||o.value||s.value),p=xe(()=>h.value.zoom<=n.value),H=xe(()=>h.value.zoom>=k.value);function B(){d(),e("zoomIn")}function A(){_(),e("zoomOut")}function I(){y(t.fitViewParams),e("fitView")}function D(){u(!c.value),e("interactionChange",!c.value)}return($,z)=>(i(),C(l(Et),{class:"vue-flow__controls",position:$.position},{default:f(()=>[F($.$slots,"top"),$.showZoom?(i(),g(K,{key:0},[F($.$slots,"control-zoom-in",{},()=>[v(oe,{class:"vue-flow__controls-zoomin",disabled:H.value,onClick:B},{default:f(()=>[F($.$slots,"icon-zoom-in",{},()=>[(i(),C(R(l($o))))])]),_:3},8,["disabled"])]),F($.$slots,"control-zoom-out",{},()=>[v(oe,{class:"vue-flow__controls-zoomout",disabled:p.value,onClick:A},{default:f(()=>[F($.$slots,"icon-zoom-out",{},()=>[(i(),C(R(l(xo))))])]),_:3},8,["disabled"])])],64)):x("",!0),$.showFitView?F($.$slots,"control-fit-view",{key:1},()=>[v(oe,{class:"vue-flow__controls-fitview",onClick:I},{default:f(()=>[F($.$slots,"icon-fit-view",{},()=>[(i(),C(R(l(To))))])]),_:3})]):x("",!0),$.showInteractive?F($.$slots,"control-interactive",{key:2},()=>[$.showInteractive?(i(),C(oe,{key:0,class:"vue-flow__controls-interactive",onClick:D},{default:f(()=>[c.value?F($.$slots,"icon-unlock",{key:0},()=>[(i(),C(R(l(Yo))))]):x("",!0),c.value?x("",!0):F($.$slots,"icon-lock",{key:1},()=>[(i(),C(R(l(Bo))))])]),_:3})):x("",!0)]):x("",!0),F($.$slots,"default")]),_:3},8,["position"]))}}),jo=L({__name:"ControlButtons",props:{workflow:{}},setup(t){const e=t,{fitView:a}=W(),o=()=>{e.workflow.autoLayout(),Ye(()=>{a()})};return(s,u)=>(i(),C(l(Wo),{position:"top-left","show-interactive":!1},{default:f(()=>[v(l(oe),{title:"Auto layout",onClick:u[0]||(u[0]=d=>o())},{default:f(()=>[v(l(io))]),_:1}),v(l(oe),{title:"Undo",disabled:!s.workflow.history.canUndo(),onClick:u[1]||(u[1]=d=>s.workflow.history.undo())},{default:f(()=>[v(l(Zt))]),_:1},8,["disabled"]),v(l(oe),{title:"Redo",disabled:!s.workflow.history.canRedo(),onClick:u[2]||(u[2]=d=>s.workflow.history.redo())},{default:f(()=>[v(l(ma))]),_:1},8,["disabled"])]),_:1}))}});class Z{constructor(e){X(this,"angle");e=Z.normalize(e),this.angle=e}static normalize(e){const a=Math.PI;return((e+a)%(2*a)+2*a)%(2*a)-a}static fromRadians(e){return new Z(Z.normalize(e))}static fromDegrees(e){const a=e*Math.PI/180;return new Z(a)}static fromPoints(e,a){const o=a.x-e.x,s=a.y-e.y,u=Math.atan2(s,o);return new Z(u)}get degrees(){return this.angle*180/Math.PI}get radians(){return this.angle}get isZero(){return this.angle===0}get isPositive(){return this.angle>0}get complementary(){return new Z(Math.PI/2-this.angle)}get perpendicular(){return new Z(Math.PI/2+this.angle)}get sin(){return Math.sin(this.angle)}get cos(){return Math.cos(this.angle)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new Z(this.angle/e)}multiply(e){return new Z(this.angle*e)}}class U{constructor(e,a){X(this,"dx");X(this,"dy");this.dx=e,this.dy=a}static fromPoints(e,a){const o=a.x-e.x,s=a.y-e.y;return new U(o,s)}static fromAngleAndLength(e,a){const o=a*e.cos,s=a*e.sin;return new U(o,s)}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}get opposite(){return new U(-this.dx,-this.dy)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new U(this.dx/e,this.dy/e)}add(e){return new U(this.dx+e.dx,this.dy+e.dy)}subtract(e){return new U(this.dx-e.dx,this.dy-e.dy)}}function Uo(t,e,a=1e-10){const o=e.center.x-e.width/2,s=e.center.x+e.width/2,u=e.center.y-e.height/2,d=e.center.y+e.height/2;return t.x>=o-a&&t.x<=s+a&&t.y>=u-a&&t.y<=d+a}function Oe(t,e,a,o=1e-10){const s=a.center.x-a.width/2,u=a.center.x+a.width/2,d=a.center.y-a.height/2,_=a.center.y+a.height/2,y=e.x-t.x,h=e.y-t.y;let n=1/0,k=null;if(Uo(t,a,o))return null;if(Math.abs(y)>o){const c=(s-t.x)/y;if(c>0&&c<n){const p=t.y+c*h;p>=d-o&&p<=_+o&&(n=c,k={x:s,y:p})}}if(Math.abs(y)>o){const c=(u-t.x)/y;if(c>0&&c<n){const p=t.y+c*h;p>=d-o&&p<=_+o&&(n=c,k={x:u,y:p})}}if(Math.abs(h)>o){const c=(d-t.y)/h;if(c>0&&c<n){const p=t.x+c*y;p>=s-o&&p<=u+o&&(n=c,k={x:p,y:d})}}if(Math.abs(h)>o){const c=(_-t.y)/h;if(c>0&&c<n){const p=t.x+c*y;p>=s-o&&p<=u+o&&(n=c,k={x:p,y:_})}}return k}function Ro(t,e,a=0,o=0){a=Math.abs(a),t.height+=a*2,t.width+=a*2,e.height+=a*2,e.width+=a*2;const s=Z.fromPoints(t.center,e.center),u=o*s.perpendicular.cos,d=o*s.perpendicular.sin,_={x:t.center.x+u,y:t.center.y+d},y={x:e.center.x+u,y:e.center.y+d};let h=Oe(_,y,e);h||(h=e.center);let n=Oe(y,_,t);return n||(n=t.center),{sourceX:n.x,sourceY:n.y,targetX:h.x,targetY:h.y}}function Ko(t,e=0){const a=Z.fromPoints({x:t.sourceX,y:t.sourceY},{x:t.targetX,y:t.targetY}),o=Math.sqrt(Math.pow(t.targetX-t.sourceX,2)+Math.pow(t.targetY-t.sourceY,2)),s=Z.fromRadians(Math.atan(2*e/o)).multiply(4),u=o/2/s.divide(2).sin,d=new U(t.sourceX+t.targetX,t.sourceY+t.targetY).divide(2),_=u*(1+(s.isPositive?-1:1)*s.divide(2).cos),y=U.fromAngleAndLength(a.perpendicular,_),h=e>0===s.isPositive?d.add(y):d.subtract(y);return{sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,labelX:h.x,labelY:h.y,radius:u,largeArcFlag:s.isPositive?0:1,sweepFlag:0}}function Je(t,e,a=0,o=0){const u={center:{x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},width:t.dimensions.width,height:t.dimensions.height},_={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return Ro(u,_,a,o)}function Qe(t,e,a=0){return Je(t,e,10,a)}function Go(t,e,a=0){a=Math.abs(a);const o=Qe(t,e,a/2);if(a===0)return Re(o);const s=Ko(o,a);return[`M${s.sourceX},${s.sourceY} A${s.radius},${s.radius} 0 ${s.largeArcFlag},${s.sweepFlag} ${s.targetX},${s.targetY}`,s.labelX,s.labelY,0,0]}const qo=L({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(i(),C(l(Q),{vertical:"",gap:"small",style:J({marginBottom:`-${16*e.menuOptions.length}%`})},{default:f(()=>[(i(!0),g(K,null,fe(e.menuOptions,o=>(i(),C(l(Xe),{key:o.label,title:o.tooltip,placement:"right"},{default:f(()=>[v(l(_e),{class:Ee([{"warning-button":o.warning}]),disabled:o.disabled,style:J({backgroundColor:o.disabled?"#f5f5f5":void 0}),onClick:s=>o.click(s)},{default:f(()=>[v(l(Q),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:f(()=>[N(O(o.label)+" ",1),o.key?(i(),C(l(se),{key:0,keyboard:"",disabled:o.disabled},{default:f(()=>[N(O(o.key),1)]),_:2},1032,["disabled"])):x("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const Jo=L({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,a=[{label:"Edit task type",key:"E",click:()=>s.value="editing"},{label:"Delete",key:"Del",click:()=>c(e.data.id)}],o=E(e.data.props.taskType||""),s=E("idle"),u=()=>{s.value!=="idle"&&(o.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:o.value}),s.value="idle")},{onEdgeClick:d,onPaneClick:_,getSelectedEdges:y}=W();d(p=>{p.edge.id===e.id&&s.value==="idle"&&(s.value="selected")}),_(()=>u());const h=V(()=>e.controller.edgeIsLonely(e.id)?0:20),n=V(()=>Go(e.sourceNode,e.targetNode,h.value)),k=p=>{if(!!y.value.map(H=>H.id).includes(e.data.id)&&(p.key==="Enter"&&u(),(p.key==="e"||p.key==="E")&&(s.value="editing"),p.key==="Backspace"||p.key==="Delete")){if(s.value==="editing")return;c(e.data.id)}},{removeEdges:c}=W();return pe(()=>window.addEventListener("keydown",k)),be(()=>window.removeEventListener("keydown",k)),(p,H)=>(i(),g(K,null,[v(l(St),{path:n.value[0],"marker-end":p.markerEnd},null,8,["path","marker-end"]),v(l(Mt),null,{default:f(()=>[s.value==="idle"?(i(),g("div",{key:0,style:J({transform:`translate(-50%, -50%) translate(${n.value[1]}px,${n.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(i(),C(l(se),{key:1},{default:f(()=>[N(O(e.data.props.taskType),1)]),_:1})):(i(),C(l(Na),{key:0,size:16}))],4)):s.value==="selected"?(i(),g("div",{key:1,style:J({transform:`translate(-50%, -120%) translate(${n.value[1]}px,${n.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[v(qo,{"is-connecting":!0,"is-editing":!0,"menu-options":a})],4)):s.value==="editing"?(i(),g("div",{key:2,style:J({transform:`translate(-50%, -50%) translate(${n.value[1]}px,${n.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[v(l(Se),{value:o.value,"onUpdate:value":H[0]||(H[0]=B=>o.value=B),placeholder:"Task type"},null,8,["value"])],4)):x("",!0)]),_:1})],64))}});const Qo=re(Jo,[["__scopeId","data-v-dd919c09"]]),es={key:0},ts=b("defs",null,[b("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[b("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),as=["d"],os=L({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,a=E(!0),{onNodeMouseEnter:o,onNodeMouseLeave:s}=W();o(y=>{y.node.id===e.sourceNode.id&&(a.value=!1)}),s(y=>{y.node.id===e.sourceNode.id&&(a.value=!0)});const u=V(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),d=V(()=>Qe(e.sourceNode,u.value)),_=V(()=>Re(d.value));return(y,h)=>a.value?(i(),g("g",es,[ts,b("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:_.value[0],"marker-end":"url(#arrowhead)"},null,8,as)])):x("",!0)}}),ss=L({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const a=t,o=V(()=>{const s=Wt(a.filename);return s.valid?a.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:s});return(s,u)=>(i(),C(l(Ue),{open:s.creatingFileStatus==="prompting"||s.creatingFileStatus==="creating",closable:!1,"confirm-loading":s.creatingFileStatus==="creating",onOk:u[1]||(u[1]=d=>e("create-file",s.filename)),onCancel:u[2]||(u[2]=d=>e("cancel"))},{default:f(()=>[v(l(je),{layout:"vertical",disabled:s.creatingFileStatus=="creating"},{default:f(()=>[v(l(We),{label:"You're creating a new file. What should it be called?","validate-status":o.value.valid?"success":"error",help:o.value.valid?o.value.help:o.value.reason},{default:f(()=>[v(l(Se),{value:s.filename,onChange:u[0]||(u[0]=d=>e("update-filename",d.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),ns={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},ls=L({...ns,props:{nodeId:null,isVisible:{type:Boolean},position:{default:ue.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,a=P(It,null),{viewportRef:o,viewport:s,getSelectedNodes:u,findNode:d}=W();function _(p,H,B,A,I){let D=.5;I==="start"?D=0:I==="end"&&(D=1);let $=[(p.x+p.width*D)*H.zoom+H.x,p.y*H.zoom+H.y-A],z=[-100*D,-100];switch(B){case ue.Right:$=[(p.x+p.width)*H.zoom+H.x+A,(p.y+p.height*D)*H.zoom+H.y],z=[0,-100*D];break;case ue.Bottom:$[1]=(p.y+p.height)*H.zoom+H.y+A,z[1]=0;break;case ue.Left:$=[p.x*H.zoom+H.x-A,(p.y+p.height*D)*H.zoom+H.y],z=[-100,-100*D];break}return`translate(${$[0]}px, ${$[1]}px) translate(${z[0]}%, ${z[1]}%)`}const y=V(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||a||""]).reduce((p,H)=>{const B=d(H);return B&&p.push(B),p},[])),h=V(()=>typeof e.isVisible=="boolean"?e.isVisible:y.value.length===1&&y.value[0].selected&&u.value.length===1),n=V(()=>Tt(y.value)),k=V(()=>Math.max(...y.value.map(p=>(p.computedPosition.z||1)+1))),c=V(()=>({position:"absolute",transform:_(n.value,s.value,e.position,e.offset,e.align),zIndex:k.value}));return(p,H)=>(i(),C(pt,{to:l(o),disabled:!l(o)},[l(h)&&l(y).length?(i(),g("div",ce({key:0},p.$attrs,{style:l(c),class:"vue-flow__node-toolbar"}),[F(p.$slots,"default")],16)):x("",!0)],8,["to","disabled"]))}}),is=L({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(i(),C(l(ls),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:l(ue).Right},{default:f(()=>[v(l(Q),{vertical:"",gap:"small",style:J({marginBottom:`-${16*e.menuOptions.length}%`})},{default:f(()=>[(i(!0),g(K,null,fe(e.menuOptions,o=>(i(),C(l(Xe),{key:o.label,title:o.tooltip,placement:"right"},{default:f(()=>[v(l(_e),{class:Ee([{"warning-button":o.warning}]),disabled:o.disabled,style:J({backgroundColor:o.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:s=>o.click(s)},{default:f(()=>[v(l(Q),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:f(()=>[N(O(o.label)+" ",1),o.key?(i(),C(l(se),{key:0,keyboard:"",disabled:o.disabled},{default:f(()=>[N(O(o.key),1)]),_:2},1032,["disabled"])):x("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const rs=L({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Ne;const e=t,{useToken:a}=Ke,o=ft(),{token:s}=a(),u=s.value.colorText,d=[{label:"Add transition",key:"C",click:r=>De(r)},{label:"Rename",key:"R",click:()=>Y.value=!0},{label:"Go to editor",key:"Enter",click:()=>Te()},{label:"Tasks",key:"M",click:()=>y.value=!0},{label:"Delete",key:"Del",click:()=>n.value=!0}],_=V(()=>{let r=[...d];return h.value||r.unshift({label:"Create missing file",warning:!0,click:()=>he()}),e.controller.hasChanges()&&(r=r.map(w=>w.label==="Go to editor"?{...w,disabled:!0,tooltip:"Save it to allow editing"}:w.label==="Tasks"?{...w,disabled:!0,tooltip:"Save it to allow managing tasks"}:w)),r}),y=E(!1),h=E(!0);ke(()=>e.initialFileCheck,r=>{I.value||(h.value=r)});const n=E(!1),k=()=>{n.value=!1,ne(e.stage)},c=new Ot,p=new Pt(c,{separator:"/"}),H=async()=>{if(n.value=!1,"filename"in e.stage.props&&e.stage.props.filename){const r=e.stage.props.filename;(await de.checkFile(r)).exists&&await p.deleteFile([r])}ne(e.stage)},B=r=>{$.value=r,D()},A=()=>{var r;z.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&($.value=(r=e.stage.props.filename)!=null?r:"",D())},I=V(()=>e.controller.getUnsavedFilenameStages().some(r=>r.id===e.stage.id)),D=ht.exports.debounce(async()=>{if(I.value){h.value=!0;return}const r=$.value;if(!r){h.value=!0;return}de.checkFile(r).then(w=>{h.value=w.exists})},500),$=E((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Ne=e.stage.props.filename)!=null?Ne:""),z=E("idle"),$e=async()=>{z.value="creating",await de.initFile($.value,e.stage.type),h.value=!0;const r=await de.checkFile($.value);if(h.value=r.exists,z.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:$.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:$.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},He=V(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!h.value:!1),he=()=>{z.value="prompting"},{startConnection:m,updateConnection:S,onNodeClick:M,addEdges:ee,endConnection:G,removeNodes:ne,onPaneClick:ve,getSelectedNodes:tt,flowToScreenCoordinate:Ie,onNodeMouseEnter:at,onNodeMouseLeave:ot,getNodes:st,onNodesChange:nt,applyNodeChanges:lt}=W(),te=E(!1),Y=E(!1),ae=E(e.stage.title),Ce=E(!0),ge=V(()=>{const w=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Xt(ae.value,!1,!0)}.py`;return w!==$.value?w:null}),Ae=E(!1),Ve=E(!1);nt(async r=>{var T;const w=[];for(const le of r)le.type==="remove"?Y.value||((T=e.controller)==null||T.delete([le.id]),w.push(le)):w.push(le);lt(w)});const Te=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Ve.value?window.open(`/_editor/${r}/${e.stage.id}`,"_blank"):o.push({path:`/_editor/${r}/${e.stage.id}`})},De=(r,w=!0)=>{m({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:w?r.pageX:r.pageX-90,y:w?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",ze),te.value=!0},ze=r=>{te.value&&!Ae.value&&S({x:r.pageX,y:r.pageY-52})};M(r=>{if(r.node.id===e.stage.id&&D(),te.value&&r.node.id!==e.stage.id){const w={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:$t(),props:{taskType:null}};try{e.controller.connect([w]),document.removeEventListener("mousemove",ze),ee({id:w.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:Dt.Arrow,width:24,height:24},data:w}),G(),te.value=!1}catch(T){console.error(T)}}}),at(r=>{if(te.value&&r.node.id!==e.stage.id){Ae.value=!0;const w=st.value.find(le=>le.id===e.stage.id);if(!w)return;const T=Je(w,r.node,10);S(Ie({x:T.targetX,y:T.targetY-52}))}}),ot(()=>{Ae.value=!1});const it=()=>{if(!h.value){const r=jt(ae.value+".py");$.value=r;let w={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const T=Ut(ae.value);w={...w,path:T}}e.controller.updateStageProps(e.stage.id,w)}},Fe=async()=>{e.stage.title!==ae.value&&(e.controller.updateStageTitle(e.stage.id,ae.value),Ce.value&&ge.value&&($.value=ge.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:$.value})),it()),D()};ve(()=>{Y.value&&Fe(),Y.value=!1,te.value=!1,G()});const Le=r=>{if(Ve.value=j(r),!!tt.value.map(w=>w.id).includes(e.stage.id)&&z.value==="idle"){if(r.key==="Enter")if(Y.value)Y.value=!1,Fe();else{if(e.controller.hasChanges())return;Te()}if(!Y.value){if(r.key==="c"||r.key==="C"){const w=Ie(e.stage.position);De({pageX:w.x,pageY:w.y},!1)}if((r.key==="r"||r.key==="R")&&(Y.value=!0),r.key==="m"||r.key==="M"){if(e.controller.hasChanges())return;y.value=!0}(r.key==="Backspace"||r.key==="Delete")&&("filename"in e.stage.props&&e.stage.props.filename?n.value=!0:ne(e.stage))}}},Be=r=>{Ve.value=j(r)};return pe(()=>{I.value||(h.value=e.initialFileCheck),window.addEventListener("keydown",Le),window.addEventListener("keyup",Be)}),be(()=>{window.removeEventListener("keydown",Le),window.removeEventListener("keyup",Be)}),(r,w)=>(i(),g(K,null,[v(is,{"is-connecting":te.value,"is-editing":Y.value,"menu-options":_.value},null,8,["is-connecting","is-editing","menu-options"]),v(l(Ue),{open:n.value,title:"Delete file",onCancel:w[0]||(w[0]=T=>n.value=!1)},{footer:f(()=>[v(l(Q),{justify:"space-between",gap:"small"},{default:f(()=>[v(l(_e),{onClick:k},{default:f(()=>[N("Delete only stage")]),_:1}),v(l(_e),{type:"primary",danger:"",onClick:H},{default:f(()=>[N("Yes, delete file")]),_:1})]),_:1})]),default:f(()=>[N(" Do you also want to delete the file associated with the stage "+O(r.stage.title)+"? ",1)]),_:1},8,["open"]),b("div",{class:"stage",onDblclick:w[3]||(w[3]=T=>Y.value=!0)},[v(l(Q),{vertical:Y.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:f(()=>[(i(),C(R(l(Lt)(r.stage.type)),{size:18,color:l(u)},null,8,["color"])),Y.value?(i(),C(l(je),{key:1,layout:"vertical"},{default:f(()=>[v(l(We),{label:"Title"},{default:f(()=>[v(l(Se),{value:ae.value,"onUpdate:value":w[1]||(w[1]=T=>ae.value=T),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),ge.value?(i(),C(l(gt),{key:0,checked:Ce.value,"onUpdate:checked":w[2]||(w[2]=T=>Ce.value=T),style:{"margin-bottom":"12px"}},{default:f(()=>[N(" Update filename to "),v(l(se),{code:""},{default:f(()=>[N(O(ge.value),1)]),_:1})]),_:1},8,["checked"])):x("",!0)]),_:1})):(i(),C(l(vt),{key:0,class:"title"},{default:f(()=>[N(O(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),He.value?(i(),C(l(Kt),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):x("",!0),z.value==="prompting"||z.value==="creating"?(i(),C(ss,{key:1,filename:$.value,"file-exists":h.value,"creating-file-status":z.value,onCreateFile:$e,onCancel:A,onUpdateFilename:B},null,8,["filename","file-exists","creating-file-status"])):x("",!0),v(l(Rt),{visible:y.value,"onUpdate:visible":w[4]||(w[4]=T=>y.value=T),title:"Tasks",width:"500",onClose:w[5]||(w[5]=T=>y.value=!1)},{default:f(()=>[v(Yt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const ye=re(rs,[["__scopeId","data-v-b6e56379"]]),et=t=>(mt("data-v-f4278104"),t=t(),yt(),t),us={class:"empty-hint"},ds={key:0,class:"drag-hint"},cs=et(()=>b("div",{class:"title"},"Start here",-1)),ps={key:1,class:"drop-hint"},fs=et(()=>b("div",{class:"title"},"Drop here",-1)),hs={key:2,class:"stages-hint"},vs={class:"header"},gs={class:"title"},ms={class:"description"},ys=L({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,a)=>(i(),g("div",us,[e.showDragHint?(i(),g("div",ds,[cs,v(l(Pe),{size:32,class:"arrow"})])):x("",!0),e.showDragHint?x("",!0):(i(),g("div",ps,[fs,v(l(Pe),{size:32,class:"arrow"})])),e.showDragHint?(i(),g("div",hs,[(i(!0),g(K,null,fe(l(Me).stages,o=>(i(),g("div",{key:o.key,class:"stage-hint"},[b("div",vs,[(i(),C(R(o.icon))),b("span",gs,O(o.title),1)]),b("div",ms,O(o.description),1)]))),128))])):x("",!0)]))}});const ws=re(ys,[["__scopeId","data-v-f4278104"]]),ks=L({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;wt(n=>({"78afe136":l(d),"924fbe90":l(u)}));const a=qe(),{useToken:o}=Ke,{token:s}=o(),u=s.value.colorPrimaryBorder,d=s.value.colorBgElevated,{onInit:_,fitView:y}=W();_(n=>{n.fitView()});const h=n=>{var k;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:n&&(k=e.initialFileCheckStatus[n])!=null?k:!1};return pe(()=>{const n=q.subscribe("stageCreated",async()=>{await e.workflow.forceServerState(),e.workflow.autoLayout()}),k=q.subscribe("stageEdited",async()=>{await e.workflow.forceServerState(),e.workflow.autoLayout()}),c=q.subscribe("transitionCreated",async()=>{await e.workflow.forceServerState(),e.workflow.autoLayout()}),p=q.subscribe("finishActions",async()=>{Ye(()=>{y()})});kt(()=>{q.unsubscribe(n),q.unsubscribe(c),q.unsubscribe(k),q.unsubscribe(p)})}),(n,k)=>n.workflow?(i(),C(l(zt),{key:0,nodes:n.workflow.vueFlowNodes.value,edges:n.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":n.editable,"pan-on-scroll":l(Ge).isMac,"elements-selectable":n.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":[],onDragover:l(a).onDragOver,onDragleave:l(a).onDragLeave},{"connection-line":f(c=>[v(os,_t(bt(c)),null,16)]),"edge-task":f(c=>[v(Qo,ce(c,{controller:n.workflow}),null,16,["controller"])]),"node-forms":f(c=>[v(ye,{stage:c.data,node:c,controller:n.workflow,"initial-file-check":h(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":f(c=>[v(ye,{stage:c.data,node:c,controller:n.workflow,"initial-file-check":h(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":f(c=>[v(ye,{stage:c.data,node:c,controller:n.workflow,"initial-file-check":h(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":f(c=>[v(ye,{stage:c.data,node:c,controller:n.workflow,"initial-file-check":h(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),default:f(()=>[v(l(Bt)),n.editable&&!n.workflow.vueFlowNodes.value.length?(i(),C(ws,{key:0,"show-drag-hint":n.showDragHint},null,8,["show-drag-hint"])):x("",!0),v(l(Nt),{pannable:"",zoomable:""}),n.editable?(i(),C(jo,{key:1,workflow:n.workflow},null,8,["workflow"])):x("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):x("",!0)}});const _s=re(ks,[["__scopeId","data-v-f251c860"]]),bs=L({__name:"WorkflowEditor",setup(t){const e=At(),{init:a,tearDown:o,onDragStart:s,onDrop:u,isDragging:d,isAdding:_,draggedType:y,mousePosition:h}=qe(),n=ro();ke(n.lastEvent,async()=>{var m;await((m=k.value)==null?void 0:m.syncState())});const{result:k}=Vt(async()=>await Ht.init(Ct)),c=E(null),p=async()=>{if(!k.value)return;const m=k.value.vueFlowNodes.value.map(S=>{var M,ee,G,ne,ve;return((M=S.data)==null?void 0:M.type)==="forms"||((ee=S.data)==null?void 0:ee.type)==="hooks"||((G=S.data)==null?void 0:G.type)==="scripts"||((ne=S.data)==null?void 0:ne.type)==="jobs"?(ve=S.data)==null?void 0:ve.props.filename:null});c.value=await de.checkFiles(m.filter(S=>typeof S=="string"))};ke(()=>k.value,()=>{k.value&&(a(k.value),p())});const{onNodeDragStop:H,onEdgesChange:B,getSelectedElements:A,getNodes:I,addSelectedNodes:D,zoomIn:$,fitView:z,zoomOut:$e,applyEdgeChanges:He}=W();H(m=>{var S;(S=k.value)==null||S.move(m.nodes.map(M=>({id:M.id,position:M.position})))}),B(m=>{var S;for(const M of m)M.type==="remove"&&((S=k.value)==null||S.delete([M.id]));He(m)});const he=m=>{var S,M;e.isInputFocused||!k.value||((m.key==="z"||m.key==="Z")&&j(m)&&(uo(m)?k.value.history.redo():(S=k.value)==null||S.history.undo(),m.preventDefault()),j(m)&&(m.key==="s"||m.key==="S")&&((M=k.value)==null||M.save(),m.preventDefault()),!(j(m)&&(m.key==="f"||m.key==="F"))&&(A.value.length||(m.key==="f"||m.key==="F"?s(null,"forms"):m.key==="h"||m.key==="H"?s(null,"hooks"):m.key==="j"||m.key==="J"?s(null,"jobs"):m.key==="t"||m.key==="T"?s(null,"scripts"):(m.key==="a"||m.key==="A")&&j(m)?(D(I.value),m.preventDefault()):m.key==="0"&&j(m)?(z(),m.preventDefault()):(m.key==="="||m.key==="+")&&j(m)?(m.preventDefault(),$()):m.key==="-"&&j(m)&&(m.preventDefault(),$e()))))};return pe(()=>{window.addEventListener("keydown",he)}),be(()=>{window.removeEventListener("keydown",he),o()}),(m,S)=>l(k)?(i(),g("div",{key:0,class:Ee(["workflow-container",{dragging:l(_)}]),onDrop:S[0]||(S[0]=(...M)=>l(u)&&l(u)(...M))},[v(_s,{workflow:l(k),editable:"","show-drag-hint":!l(_),"check-file-status":!0,"initial-file-check-status":c.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),v(ho,{controller:l(k),onDragStart:l(s)},null,8,["controller","onDragStart"]),(i(!0),g(K,null,fe(l(Me).stages,M=>{var ee,G;return i(),g("div",{key:M.key},[l(_)&&!l(d)&&M.typeName===l(y)?(i(),g("div",{key:0,class:"dragging-node",style:J({left:`${(ee=l(h))==null?void 0:ee.x}px`,top:`${(G=l(h))==null?void 0:G.y}px`,position:"absolute",cursor:l(_)?"grabbing":"grab"})},[(i(),C(R(M.icon),{size:18}))],4)):x("",!0)])}),128))],34)):x("",!0)}});const dn=re(bs,[["__scopeId","data-v-34ca454c"]]);export{dn as default};
//# sourceMappingURL=WorkflowEditor.c4f87355.js.map

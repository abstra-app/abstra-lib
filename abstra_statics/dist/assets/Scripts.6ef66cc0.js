import{d as F,H as w,a as te,b as u,c as d,w as t,f as a,u as e,ar as c,eD as N,bw as ge,bu as W,ey as be,bT as we,ex as S,v as V,e as g,eE as Y,eF as q,ev as U,aj as ke,cB as D,ai as j,eH as H,bO as X,b3 as Se,bV as G,ae as Ce,eC as ae,cE as Ie,a$ as L,eM as Fe,eA as Te,r as K,c8 as Ae}from"./outputWidgets.5c52fa87.js";import{F as x}from"./forms.3a97229b.js";import{H as $,J as E}from"./jobs.958fe26f.js";import{W as se}from"./workspaces.b84f9d3d.js";import{S as M}from"./scripts.7d1352d2.js";import{a as O}from"./asyncComputed.26d9bcc1.js";import{a as Q}from"./ant-design.5e093646.js";import{f as oe,a as le,b as ie,j as ne,m as xe,c as $e}from"./icons.03282d1d.js";import{A as C}from"./Text.c9a398d0.js";import{A as I}from"./index.0be66a31.js";import{C as re}from"./Card.f3624547.js";import{_ as Z}from"./DocsButton.vue_vue_type_script_setup_true_lang.fa56e270.js";import{a as Ne}from"./Base.6d1a6939.js";import{A as P}from"./Paragraph.cff93cf2.js";import{v as pe,b as Ue}from"./validations.c445dea2.js";import{A as B}from"./FormItem.eb04c2fc.js";import{A as Ee}from"./index.1c2a8b66.js";import{F as ce}from"./Form.17a01b6e.js";import{M as Me}from"./Modal.2c05a20d.js";import{A as De}from"./Title.91b6cec6.js";import"./record.eec0c608.js";import"./pubsub.5093c187.js";import"./runnerData.82f622be.js";import"./url.8bc1ece1.js";import"./index.076f710c.js";import"./TabPane.78291069.js";import"./hasIn.f2c6482d.js";import"./string.a1010cd3.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[i]="c9b9fd92-bc04-44a5-8c01-657ab55a0d5c",l._sentryDebugIdIdentifier="sentry-dbid-c9b9fd92-bc04-44a5-8c01-657ab55a0d5c")}catch{}})();const je=F({__name:"ScriptCard",props:{script:{},workspace:{}},emits:["delete","go-to-script"],setup(l,{emit:i}){const o=l,r=async()=>{if(await Q("Are you sure you want to delete this script?")){const _=await Q("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});i("delete",o.script.id,_)}},y=()=>{o.script instanceof x&&i("go-to-script",o.script.id,"form"),o.script instanceof $&&i("go-to-script",o.script.id,"hook"),o.script instanceof M&&i("go-to-script",o.script.id,"script"),o.script instanceof E&&i("go-to-script",o.script.id,"job")},b=w(()=>{if(o.script instanceof x)return oe;if(o.script instanceof $)return le;if(o.script instanceof M)return ie;if(o.script instanceof E)return ne;throw new Error("Invalid script type")}),f=()=>{!o.script.file||!o.workspace||o.workspace.openFile(o.script.file)};return(_,h)=>{const s=te("icon");return u(),d(e(re),{key:_.script.title,class:"script-card",onClick:y},{title:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(s,{path:b.value},null,8,["path"]),a(e(C),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[c(N(_.script.title),1)]),_:1})]),_:1})]),extra:t(()=>[a(e(we),{trigger:["click"],onClick:h[0]||(h[0]=be(()=>{},["stop"]))},{overlay:t(()=>[a(e(ge),null,{default:t(()=>[a(e(W),{onClick:f},{default:t(()=>[c("Open .py file")]),_:1}),a(e(W),{danger:"",onClick:r},{default:t(()=>[c("Delete")]),_:1})]),_:1})]),default:t(()=>[a(s,{path:e(xe),style:{cursor:"pointer"}},null,8,["path"])]),_:1})]),default:t(()=>[_.script instanceof e(x)||_.script instanceof e($)?(u(),d(e(I),{key:0,gap:"small"},{default:t(()=>[a(e(C),{type:"secondary"},{default:t(()=>[c("URL path:")]),_:1}),a(e(C),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[c("/"+N(_.script.path),1)]),_:1})]),_:1})):S("",!0),a(e(I),{gap:"12"},{default:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(e(C),{type:"secondary"},{default:t(()=>[c("Code:")]),_:1}),a(e(C),{ellipsis:!0,style:{"max-width":"125px"}},{default:t(()=>[c(N(_.script.file),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const He=V(je,[["__scopeId","data-v-0e55c24b"]]),Pe=l=>(Y("data-v-14680ef5"),l=l(),q(),l),Be={class:"card-content"},Oe=Pe(()=>g("span",null,"New",-1)),Ve=F({__name:"NewScriptCard",setup(l){return(i,o)=>{const r=te("icon");return u(),d(e(re),{class:"new-script-card"},{default:t(()=>[g("div",Be,[a(r,{path:e($e)},null,8,["path"]),Oe])]),_:1})}}});const Je=V(Ve,[["__scopeId","data-v-14680ef5"]]),J=l=>(Y("data-v-94df32a7"),l=l(),q(),l),Re={key:0,class:"choose-type"},Ge={class:"option-content"},Le=J(()=>g("span",null,"Forms",-1)),Ye={class:"option-content"},qe=J(()=>g("span",null,"Hooks",-1)),ze={class:"option-content"},We=J(()=>g("span",null,"Scripts",-1)),Xe={class:"option-content"},Ke=J(()=>g("span",null,"Jobs",-1)),Qe=F({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(l,{emit:i}){const o=l,r=w(()=>o.state.type==="form"?"#fff":void 0),y=w(()=>o.state.type==="hook"?"#fff":void 0),b=w(()=>o.state.type==="script"?"#fff":void 0),f=w(()=>o.state.type==="job"?"#fff":void 0),_=h=>i("choose-type",h);return(h,s)=>h.state.state==="choosing-type"?(u(),U("div",Re,[a(e(I),{vertical:"",gap:"30"},{default:t(()=>[a(e(Ne),null,{default:t(()=>[c("Choose your script type")]),_:1}),a(e(ke),{value:h.state.type,"onUpdate:value":[s[0]||(s[0]=v=>h.state.type=v),_],size:"large","button-style":"solid"},{default:t(()=>[a(e(I),{gap:"24",vertical:""},{default:t(()=>[a(e(I),{gap:"24"},{default:t(()=>[a(e(D),{placement:"left",title:"Forms"},{content:t(()=>[a(e(P),null,{default:t(()=>[c(" Use to collect user input via interaction with a form interface ")]),_:1}),a(Z,{path:"forms/overview"})]),default:t(()=>[a(e(j),{value:"form",class:"option"},{default:t(()=>[g("div",Ge,[(u(),d(H,{key:r.value,path:e(oe),fill:r.value},null,8,["path","fill"])),Le])]),_:1})]),_:1}),a(e(D),{placement:"right",title:"Hooks"},{content:t(()=>[a(e(P),null,{default:t(()=>[c("Use to build endpoints triggered by HTTP requests")]),_:1}),a(Z,{path:"forms/overview"})]),default:t(()=>[a(e(j),{value:"hook",class:"option"},{default:t(()=>[g("div",Ye,[(u(),d(H,{key:y.value,path:e(le),fill:y.value},null,8,["path","fill"])),qe])]),_:1})]),_:1})]),_:1}),a(e(I),{gap:"24"},{default:t(()=>[a(e(D),{placement:"left",title:"Scripts"},{content:t(()=>[a(e(P),null,{default:t(()=>[c(" Use to write plain Python scripts ")]),_:1})]),default:t(()=>[a(e(j),{value:"script",class:"option"},{default:t(()=>[g("div",ze,[(u(),d(H,{key:b.value,path:e(ie),fill:b.value},null,8,["path","fill"])),We])]),_:1})]),_:1}),a(e(D),{placement:"right",title:"Jobs"},{content:t(()=>[a(e(P),null,{default:t(()=>[c(" Use to schedule your script execution periodically ")]),_:1})]),default:t(()=>[a(e(j),{value:"job",class:"option"},{default:t(()=>[g("div",Xe,[(u(),d(H,{key:f.value,path:e(ne),fill:f.value},null,8,["path","fill"])),Ke])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):S("",!0)}});const Ze=V(Qe,[["__scopeId","data-v-94df32a7"]]),et=g("br",null,null,-1),tt=F({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(l,{emit:i}){const o=l,{result:r}=O(()=>fetch("/_editor/api/workspace/root").then(v=>v.text())),y=w(()=>o.state.state!=="creating"?"":`${r.value}/${o.state.stage.filename}`),b=w(()=>o.state.state!=="creating"?"":`${o.state.stage.type[0].toUpperCase()+o.state.stage.type.slice(1)} title`),f=v=>{i("update-name",v);const p=Ue(v);i("update-file",p),h()},{result:_,refetch:h}=O(()=>se.checkFile(o.state.stage.filename)),s=w(()=>pe(o.state.stage.filename));return(v,p)=>(u(),d(e(ce),{layout:"vertical"},{default:t(()=>{var T;return[a(e(B),{label:b.value,required:!0},{default:t(()=>[a(e(X),{value:v.state.stage.title,"onUpdate:value":f},null,8,["value"])]),_:1},8,["label"]),a(e(B),{label:"Generated file",required:!0,"validate-status":s.value.valid?"success":"error",help:s.value.valid?void 0:s.value.reason},{default:t(()=>[a(e(Se),{placement:"right"},{title:t(()=>[c(" You can change this later ")]),default:t(()=>[a(e(X),{value:v.state.stage.filename,"onUpdate:value":p[0]||(p[0]=R=>v.state.stage.filename=R),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["validate-status","help"]),a(e(B),null,{default:t(()=>[a(e(C),null,{default:t(()=>[c(" Your script will be generated at: ")]),_:1}),et,a(e(C),{code:""},{default:t(()=>[c(N(y.value),1)]),_:1})]),_:1}),(T=e(_))!=null&&T.exists?(u(),d(e(Ee),{key:0,type:"warning"},{message:t(()=>[a(e(C),null,{default:t(()=>[a(e(C),{strong:""},{default:t(()=>[c("Warning:")]),_:1}),c(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):S("",!0)]}),_:1}))}}),at=F({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(l,{emit:i}){const o=l,r=p=>i("update-name",p),y=p=>i("update-file",p),b=()=>i("close"),f=p=>i("choose-type",p),_=()=>i("next-step"),h=()=>i("previous-step"),s=()=>i("create-script"),v=w(()=>!(o.state.state!=="creating"||!pe(o.state.stage.filename).valid||!o.state.stage.title));return(p,T)=>(u(),d(e(Me),{open:p.open,title:"Create a new script",onCancel:b},{footer:t(()=>[p.state.state==="creating"?(u(),d(e(G),{key:0,onClick:h},{default:t(()=>[c("Previous")]),_:1})):S("",!0),p.state.state==="creating"?(u(),d(e(G),{key:1,type:"primary",disabled:!v.value,onClick:s},{default:t(()=>[c(" Create ")]),_:1},8,["disabled"])):S("",!0),p.state.state==="choosing-type"?(u(),d(e(G),{key:2,type:"primary",disabled:!p.state.type,onClick:_},{default:t(()=>[c(" Next ")]),_:1},8,["disabled"])):S("",!0)]),default:t(()=>[p.state.state==="choosing-type"?(u(),d(Ze,{key:0,state:p.state,onChooseType:f},null,8,["state"])):S("",!0),p.state.state==="creating"?(u(),d(tt,{key:1,state:p.state,onUpdateName:r,onUpdateFile:y},null,8,["state"])):S("",!0)]),_:1},8,["open"]))}}),st=F({__name:"FilterScripts",emits:["update-filter"],setup(l,{emit:i}){const o=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],r=y=>i("update-filter",y);return(y,b)=>(u(),d(e(ce),null,{default:t(()=>[a(e(B),{label:"Filter"},{default:t(()=>[a(e(Ce),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":r},{default:t(()=>[(u(),U(L,null,ae(o,f=>a(e(Ie),{key:f.value,value:f.value},{default:t(()=>[c(N(f.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),ot=200,lt=l=>{if(!l)return[0,0];if(l.length===0)return[0,0];let i=-1/0,o=0;for(const r of l)r.position.x>i&&(i=r.position.x),o+=r.position.y/l.length;return[i+ot,o]},it=l=>{if(l instanceof x)return"form";if(l instanceof $)return"hook";if(l instanceof E)return"job";if(l instanceof M)return"script";throw new Error("Invalid script type")},nt=l=>(Y("data-v-ee3da5e1"),l=l(),q(),l),rt={key:0},pt=nt(()=>g("span",null,"loading",-1)),ct=[pt],ee=100,ut=F({__name:"Scripts",setup(l){Fe(n=>({"40b4c63a":ve()}));const i=Te(),{loading:o,result:r,refetch:y}=O(async()=>Promise.all([x.list(),$.list(),E.list(),M.list()]).then(([n,m,k,A])=>[...n,...m,...k,...A])),{result:b}=O(()=>se.get()),f=K([]),_=n=>{f.value=n},h=w(()=>r.value?f.value.length===0?r.value:r.value.filter(n=>f.value.includes(it(n))):[]),s=K({state:"idle"}),v=w(()=>s.value.state==="choosing-type"||s.value.state==="creating"),p=()=>{s.value={state:"choosing-type",type:null}},T=()=>{s.value={state:"idle"}},R=n=>{s.value.state==="choosing-type"&&(s.value={state:"choosing-type",type:n})},ue=()=>{s.value.state==="choosing-type"&&s.value.type!==null&&(s.value={state:"creating",stage:{type:s.value.type,title:`Untitled ${s.value.type}`,filename:`untitled_${s.value.type}.py`}})},de=()=>{s.value.state==="creating"&&(s.value={state:"choosing-type",type:s.value.stage.type})},fe=n=>{s.value.state==="creating"&&(s.value.stage.title=n)},_e=n=>{s.value.state==="creating"&&(s.value.stage.filename=n)},me=async(n,m)=>{var k,A;await((A=(k=r.value)==null?void 0:k.find(he=>he.id===n))==null?void 0:A.delete(m)),await y()},ve=()=>(ee/1e3).toString()+"s",ye=async()=>{if(s.value.state!=="creating")return;const n=lt(r.value||[]);let m;if(s.value.stage.type==="form"?m=await x.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="hook"?m=await $.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="job"?m=await E.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="script"&&(m=await M.create(s.value.stage.title,s.value.stage.filename,n)),!m)throw new Error("Failed to create script");const k=m.id,A=s.value.stage.type;T(),await y(),setTimeout(()=>{z(k,A)},ee)},z=(n,m)=>{m==="form"&&i.push({name:"formEditor",params:{id:n}}),m==="hook"&&i.push({name:"hookEditor",params:{id:n}}),m==="script"&&i.push({name:"scriptEditor",params:{id:n}}),m==="job"&&i.push({name:"jobEditor",params:{id:n}})};return(n,m)=>(u(),U(L,null,[e(o)?(u(),U("span",rt,ct)):S("",!0),a(e(De),null,{default:t(()=>[c("Home")]),_:1}),a(st,{onUpdateFilter:_}),a(e(I),{wrap:"wrap",gap:"large",class:"scripts-container"},{default:t(()=>[a(Ae,null,{default:t(()=>[(u(!0),U(L,null,ae(h.value,k=>(u(),d(He,{key:k.title,script:k,workspace:e(b),onDelete:me,onGoToScript:z},null,8,["script","workspace"]))),128))]),_:1}),a(Je,{onClick:p})]),_:1}),a(at,{open:v.value,state:s.value,onClose:T,onChooseType:R,onNextStep:ue,onPreviousStep:de,onCreateScript:ye,onUpdateName:fe,onUpdateFile:_e},null,8,["open","state"])],64))}});const Ot=V(ut,[["__scopeId","data-v-ee3da5e1"]]);export{Ot as default};
//# sourceMappingURL=Scripts.6ef66cc0.js.map

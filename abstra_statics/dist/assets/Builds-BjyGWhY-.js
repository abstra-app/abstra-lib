import{C as H}from"./CrudView-KbvFMCy5.js";import{a as j,i as S,c as A,b as y,e as o,f as q,g as h,h as k,m as U,j as s,I as $,c9 as Q,ae as W,p as m,u as t,w as i,ak as v,S as g,U as b,be as J,bf as X,bg as Y,af as f,bt as tt,ac as et,D as at,k as lt,r as nt,aO as rt,bd as it,bm as st,K as ot,aQ as ut,A as ct,b7 as dt,a8 as pt,M as mt,aN as ft}from"./jwt-decode.esm-qFrVYqMT.js";import{a as N}from"./asyncComputed-Cps52Xdo.js";import{g as gt}from"./datetime-BsteZFjI.js";import{u as bt}from"./polling-DIuRo6oa.js";import{G as _t}from"./PhArrowCounterClockwise.vue-CqmjpbWA.js";import{H as yt}from"./PhCube.vue-WEbrZArg.js";import{G as ht}from"./PhDownloadSimple.vue-BvsJbNhD.js";import{G as vt}from"./PhRobot.vue-K14CdMGi.js";import{L as kt,g as Ct,r as wt}from"./router-Dlrr4bcq.js";import{B as At,a as Ot}from"./build-DWZF_pB_.js";import{P as St}from"./project-VDIi5bve.js";import"./tables-BI33YzWj.js";import{G as xt}from"./PhClockCounterClockwise.vue-DKiq4mt3.js";import{F as Pt,a as Zt,G as It,I as Mt}from"./PhWebhooksLogo.vue-CgTUa6_v.js";import{S as x}from"./index-EXE47iFI.js";import{u as jt}from"./omniChatStore-BZXy6W1K.js";import{E as $t}from"./ExclamationCircleOutlined-CEtXB-t7.js";import{C as zt}from"./CloseCircleOutlined-C-53CMPw.js";import{L as M}from"./LoadingOutlined-BctNYAzB.js";import"./DocsButton.vue_vue_type_script_setup_true_lang-CAmZ-lkx.js";import"./constants-5xR_c7Wc.js";import"./url-Bapccg1_.js";import"./PhDotsThreeVertical.vue-Df_5H2Em.js";import"./ts.worker-HMz_Z6NX.js";import"./record-Ay76brxS.js";import"./string-WA5sdeHh.js";import"./uuid-B64tsUMR.js";import"./PhCopySimple.vue-u2hWarSy.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="436e1246-7487-418a-a58e-9281d492e103",n._sentryDebugIdIdentifier="sentry-dbid-436e1246-7487-418a-a58e-9281d492e103")}catch{}})();var Bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},Dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};const Gt=["width","height","fill","transform"],Nt={key:0},Vt=k("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-16-84a16,16,0,1,1-16-16A16,16,0,0,1,112,128Zm64,0a16,16,0,1,1-16-16A16,16,0,0,1,176,128Z"},null,-1),Et=[Vt],Lt={key:1},Tt=k("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),Kt=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm56-88a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Ft=[Tt,Kt],Rt={key:2},Ht=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.13,104.13,0,0,0,128,24ZM84,140a12,12,0,1,1,12-12A12,12,0,0,1,84,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,172,140Z"},null,-1),qt=[Ht],Ut={key:3},Qt=k("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm10-90a10,10,0,1,1-10-10A10,10,0,0,1,138,128Zm-44,0a10,10,0,1,1-10-10A10,10,0,0,1,94,128Zm88,0a10,10,0,1,1-10-10A10,10,0,0,1,182,128Z"},null,-1),Wt=[Qt],Jt={key:4},Xt=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm12-88a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-88,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Yt=[Xt],te={key:5},ee=k("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm8-92a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-44,0a8,8,0,1,1-8-8A8,8,0,0,1,92,128Zm88,0a8,8,0,1,1-8-8A8,8,0,0,1,180,128Z"},null,-1),ae=[ee],le={name:"PhDotsThreeCircle"},ne=j({...le,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(n){const e=n,l=S("weight","regular"),u=S("size","1em"),p=S("color","currentColor"),O=S("mirrored",!1),d=A(()=>e.weight??l),w=A(()=>e.size??u),P=A(()=>e.color??p),Z=A(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:O?"scale(-1, 1)":void 0);return(_,C)=>(o(),y("svg",U({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:P.value,transform:Z.value},_.$attrs),[q(_.$slots,"default"),d.value==="bold"?(o(),y("g",Nt,Et)):d.value==="duotone"?(o(),y("g",Lt,Ft)):d.value==="fill"?(o(),y("g",Rt,qt)):d.value==="light"?(o(),y("g",Ut,Wt)):d.value==="regular"?(o(),y("g",Jt,Yt)):d.value==="thin"?(o(),y("g",te,ae)):h("",!0)],16,Gt))}});function V(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?Object(arguments[e]):{},u=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(l).filter(function(p){return Object.getOwnPropertyDescriptor(l,p).enumerable}))),u.forEach(function(p){re(n,p,l[p])})}return n}function re(n,e,l){return e in n?Object.defineProperty(n,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[e]=l,n}var z=function(e,l){var u=V({},e,l.attrs);return s($,V({},u,{icon:Q}),null)};z.displayName="CheckCircleOutlined";z.inheritAttrs=!1;function E(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?Object(arguments[e]):{},u=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(l).filter(function(p){return Object.getOwnPropertyDescriptor(l,p).enumerable}))),u.forEach(function(p){ie(n,p,l[p])})}return n}function ie(n,e,l){return e in n?Object.defineProperty(n,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[e]=l,n}var B=function(e,l){var u=E({},e,l.attrs);return s($,E({},u,{icon:Bt}),null)};B.displayName="MinusCircleOutlined";B.inheritAttrs=!1;function L(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?Object(arguments[e]):{},u=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(l).filter(function(p){return Object.getOwnPropertyDescriptor(l,p).enumerable}))),u.forEach(function(p){se(n,p,l[p])})}return n}function se(n,e,l){return e in n?Object.defineProperty(n,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[e]=l,n}var D=function(e,l){var u=L({},e,l.attrs);return s($,L({},u,{icon:Dt}),null)};D.displayName="PauseCircleOutlined";D.inheritAttrs=!1;const oe={style:{display:"flex","align-items":"center",gap:"5px"}},ue={key:1},ce=j({__name:"BuildInspector",props:{buildSpec:{}},setup(n){const e=W(),l=n,u=p=>{e.push({name:"logs",params:{projectId:l.buildSpec.projectId},query:p.logQuery})};return(p,O)=>n.buildSpec.runtimes.length>0?(o(),m(t(kt),{key:0,"item-layout":"horizontal","data-source":n.buildSpec.runtimes},{renderItem:i(({item:d})=>[s(t(Ct),null,{actions:i(()=>[s(t(J),null,{overlay:i(()=>[s(t(X),null,{default:i(()=>[s(t(Y),{onClick:w=>u(d)},{default:i(()=>[k("div",oe,[s(t(xt)),s(t(v),null,{default:i(()=>[g(b(t(f).translate("i18n_build_inspector_view_logs",null)),1)]),_:1})])]),_:1},8,["onClick"])]),_:2},1024)]),default:i(()=>[s(t(ne),{style:{cursor:"pointer"}})]),_:2},1024)]),default:i(()=>[d.type=="form"?(o(),m(t(x),{key:0,size:"large"},{default:i(()=>[s(t(Pt)),s(t(v),{strong:""},{default:i(()=>[g(b(d.title),1)]),_:2},1024),s(t(v),{type:"secondary",code:""},{default:i(()=>[g("/"+b(d.path),1)]),_:2},1024)]),_:2},1024)):h("",!0),d.type=="job"?(o(),m(t(x),{key:1,size:"large"},{default:i(()=>[s(t(Zt)),s(t(v),{strong:""},{default:i(()=>[g(b(d.title),1)]),_:2},1024),s(t(v),{type:"secondary",code:""},{default:i(()=>[g(b(d.schedule),1)]),_:2},1024)]),_:2},1024)):h("",!0),d.type=="hook"?(o(),m(t(x),{key:2,size:"large"},{default:i(()=>[s(t(It)),s(t(v),{strong:""},{default:i(()=>[g(b(d.title),1)]),_:2},1024),s(t(v),{type:"secondary",code:""},{default:i(()=>[g("/_hooks/"+b(d.path),1)]),_:2},1024)]),_:2},1024)):h("",!0),d.type=="script"?(o(),m(t(x),{key:3,size:"large"},{default:i(()=>[s(t(Mt)),s(t(v),{strong:""},{default:i(()=>[g(b(d.title),1)]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(o(),y("div",ue,[s(t(tt),{description:t(f).translate("i18n_build_inspector_no_runtimes",null)},null,8,["description"])]))}}),de=j({__name:"Builds",setup(n){const l=et().params.projectId,u=jt();u.init("console",l);const p=async a=>{if(!a.log)return;u.open();const r=u.controller;r&&(r.setInput([f.translate("i18n_builds_fix_with_ai_prompt"),a.log].join(`
`)),await r.send())},{loading:O,result:d,refetch:w}=N(async()=>{const[a,r]=await Promise.all([At.list(l),St.getStatus(l)]);return{b:a.map(G=>({build:G,status:r.filter(I=>I.buildId==G.id).map(I=>I.status)})),status:r}}),{startPolling:P,endPolling:Z}=bt({task:w,interval:1e4});at(()=>P()),lt(()=>Z());const _=nt(null),C=N(async()=>_.value?await Ot.get(_.value):null),T=()=>{const a=d.value?.b.find(c=>c.build.id===_.value);return`Version ${a?.build.id.slice(0,8)} - ${a?.build.createdAt.toLocaleString()}`},K=[{translationKey:"i18n_builds_deploying",tagColor:"blue",check:a=>(a.build.latest&&a.status.some(r=>r=="Running")&&d.value?.status.some(r=>r.buildId!==a.build.id))??!1,loading:!0},{translationKey:"i18n_builds_deactivating",tagColor:"orange",check:a=>a.build.status==="success"&&!a.build.latest&&a.status.some(r=>r=="Running"),loading:!0},{translationKey:"i18n_builds_live",tagColor:"green",check:a=>a.build.latest&&a.status.some(r=>r=="Running")},{translationKey:"i18n_builds_sleeping",tagColor:"cyan",check:a=>a.build.latest&&a.status.length===0},{translationKey:"i18n_builds_failed",tagColor:"red",check:a=>a.build.latest&&a.status.some(r=>r=="Failed")},{translationKey:"i18n_builds_inactive",tagColor:"default",check:a=>a.build.status==="success"},{translationKey:"i18n_builds_aborted",tagColor:"default",check:a=>a.build.status==="aborted"||a.build.status==="aborted-by-user"},{translationKey:"i18n_builds_failed",tagColor:"orange",check:a=>a.build.status==="failure"},{translationKey:"i18n_builds_deploying",tagColor:"blue",check:a=>a.build.status==="in-progress",loading:!0},{translationKey:"i18n_builds_uploading",tagColor:"yellow",check:a=>a.build.status==="pending"}];function F(a){const r=K.find(c=>c.check(a));return{text:r?f.translate(r.translationKey):"unknown",tagColor:r?.tagColor??"default",hover:a.build.log??void 0}}const R=A(()=>{const a=[{title:f.translate("i18n_builds_id")},{title:f.translate("i18n_builds_date")},{title:f.translate("i18n_builds_abstra_version")},{title:f.translate("i18n_builds_status")},{title:"",align:"right"}];return d.value?{columns:a,rows:d.value.b.map((r,c)=>({key:r.build.id,cells:[{type:"text",text:r.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:gt(r.build.createdAt,{weekday:void 0}),distance:rt(r.build.createdAt)}},{type:"text",text:r.build.abstraVersion??"-"},{key:"status",type:"slot",payload:F(r)},{type:"actions",actions:[{icon:yt,label:f.translate("i18n_builds_inspect_version"),onClick:async()=>{_.value=r.build.id,C.refetch()}},{icon:_t,label:f.translate("i18n_builds_view_application_logs"),onClick:()=>{wt.push({name:"logs",params:{projectId:l},query:{buildId:r.build.id}})}},{icon:ht,label:f.translate("i18n_builds_download_files"),onClick:()=>r.build.download()},{icon:vt,label:f.translate("i18n_builds_fix_with_ai"),onClick:()=>p(r.build),hide:r.build.status!=="failure"||!r.build.log,badge:c===0}]}]}))}:{columns:a,rows:[]}});return(a,r)=>(o(),y(mt,null,[s(H,{"entity-name":"build",loading:t(O),title:t(f).translate("i18n_builds_version_history"),description:t(f).translate("i18n_builds_description"),"empty-title":t(f).translate("i18n_builds_empty_title"),table:R.value,live:""},{date:i(({payload:c})=>[s(t(ct),null,{title:i(()=>[g(b(c.distance),1)]),default:i(()=>[g(b(c.date)+" ",1)]),_:2},1024)]),status:i(({payload:c})=>[s(t(it),{open:c.hover?void 0:!1},{content:i(()=>[s(t(ut),{style:{width:"300px",overflow:"auto","font-family":"monospace"},content:c.hover,copyable:""},null,8,["content"])]),default:i(()=>[c.text!=="unknown"?(o(),m(t(st),{key:0,color:c.tagColor,style:ot({cursor:c.hover?"pointer":"default"})},{default:i(()=>[c.text==="Live"?(o(),m(t(z),{key:0})):c.text==="Inactive"?(o(),m(t(B),{key:1})):c.text==="Failed"?(o(),m(t($t),{key:2})):c.text==="Aborted"?(o(),m(t(zt),{key:3})):c.text==="Sleeping"?(o(),m(t(D),{key:4})):c.text==="Uploading"?(o(),m(t(M),{key:5})):c.text==="Deploying"?(o(),m(t(M),{key:6})):c.text==="Deactivating"?(o(),m(t(M),{key:7})):h("",!0),g(" "+b(c.text),1)]),_:2},1032,["color","style"])):h("",!0)]),_:2},1032,["open"])]),_:1},8,["loading","title","description","empty-title","table"]),_.value?(o(),m(t(pt),{key:0,footer:null,open:!!_.value,size:"large",width:"80%",title:T(),onCancel:r[0]||(r[0]=c=>_.value=null)},{default:i(()=>[!t(C).result.value||t(C).loading.value?(o(),m(t(dt),{key:0})):t(C).result.value?(o(),m(ce,{key:1,"build-spec":t(C).result.value},null,8,["build-spec"])):h("",!0)]),_:1},8,["open","title"])):h("",!0)],64))}}),Le=ft(de,[["__scopeId","data-v-14bc60df"]]);export{Le as default};
//# sourceMappingURL=Builds-BjyGWhY-.js.map

import{d as q,ex as A,ey as j,G as z,r as _,H as J,b as n,d2 as I,e as O,u as r,c as p,f as t,w as l,eu as P,bu as Q,cy as U,eD as X,v as Y}from"./registerWidgets.d6e66474.js";import{L as Z}from"./CircularLoading.2744e4b0.js";import{E as ee}from"./Error.ca4d4213.js";import{R as re,F as oe}from"./broker.76347aac.js";import{_ as te}from"./FormSettings.vue_vue_type_script_setup_true_lang.98511f6b.js";import{T as ae,_ as se,a as L}from"./UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.7699558a.js";import{S as ne,L as le}from"./SmartConsole.85b38544.js";import{a as me}from"./asyncComputed.5c362931.js";import{F as ie}from"./forms.2e38c299.js";import{W as fe}from"./workspaces.5e4a741d.js";import{B as ce}from"./BackButton.000dfb31.js";import{_ as de}from"./SaveButton.vue_vue_type_script_setup_true_lang.ed344e02.js";import{_ as ue}from"./DocsButton.vue_vue_type_script_setup_true_lang.3de0e9fb.js";import{_ as pe}from"./PreviewButton.vue_vue_type_script_setup_true_lang.4845dbf5.js";import{r as S}from"./index.977cda87.js";import"./lottie.b059da2e.js";import"./passwordlessManager.a2051844.js";import"./pubsub.9e806cff.js";import"./storage.d7eb729a.js";import"./Passwordless.83f13a8c.js";import"./icons.4be6cb33.js";import"./executeJs.45861195.js";import"./PlayerNavbar.6876b287.js";import"./Steps.28b1fe2b.js";import"./Modal.87772a38.js";import"./WidgetsFrame.b0e7227e.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.c85f9eb3.js";import"./Title.dd14f24f.js";import"./transButton.63ba82b1.js";import"./Form.fafe4307.js";import"./dashes.811e4dd5.js";import"./activeRecord.1009e596.js";import"./hooks.a4b6e8df.js";import"./jobs.b7c93ebe.js";import"./index.55d44a5a.js";import"./uuid.baa8712a.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[i]="713c60b9-f9d6-4f31-b47d-81db866f31f2",m._sentryDebugIdIdentifier="sentry-dbid-713c60b9-f9d6-4f31-b47d-81db866f31f2")}catch{}})();const _e={class:"page"},ge={key:1,class:"error"},ye=q({__name:"FormEditor",setup(m){var b,w,C,R;const i=A(),d=j(),g=z({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});function $(e,u){S("editor",i,e,u)}addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),V())});const N=_(null),y=_(null),{loading:T,result:o,error:v,refetch:M}=me(()=>Promise.all([fe.get(),ie.get(d.params.formPath)]).then(([e,u])=>X({workspace:e,form:u}))),h=_(!1);async function V(){var e;h.value=!0;try{await((e=o.value)==null?void 0:e.form.save())}finally{h.value=!1}}const s=le.create(),f=J(()=>re.create({formPath:d.params.formPath}));(b=f.value)==null||b.on("stdout",e=>{s.log({type:"stdout",log:e.log})}),(w=f.value)==null||w.on("stderr",e=>{s.log({type:"stderr",log:e.log})}),(C=f.value)==null||C.onClose(()=>{s.log({type:"stderr",log:"Program closed"})}),(R=f.value)==null||R.on("files:changed",()=>{s.log({type:"files-changed",log:"Files changed"})});const G=()=>{s.clear()},k=async()=>{var e;return s.log({type:"restart"}),(e=y.value)==null?void 0:e.run()},H=({path:e})=>{S("editor",i,e)},K=()=>{g.started=!0},W=()=>{g.started=!1};return(e,u)=>{var F,x,B,E,D;return n(),I(Q,null,[O("div",_e,[r(T)||!((F=r(o))!=null&&F.form)||!((x=r(o))!=null&&x.workspace)?(n(),p(Z,{key:0})):r(v)?(n(),I("div",ge,[t(ee,{error:r(v),onReload:r(M)},null,8,["error","onReload"])])):(n(),p(ae,{key:2},{left:l(()=>[t(ce,{link:"/_editor/forms"})]),right:l(()=>[t(r(U),null,{default:l(()=>{var a,c;return[t(ue),t(pe,{model:(a=r(o))==null?void 0:a.form},null,8,["model"]),t(de,{model:(c=r(o))==null?void 0:c.form},null,8,["model"])]}),_:1})]),default:l(()=>[t(L,{title:"Preview"},{default:l(()=>{var a,c;return[t(oe,{ref_key:"runner",ref:y,form:(c=r(o))==null?void 0:c.form.makeRunnerData((a=r(o))==null?void 0:a.workspace),params:r(d).query,"is-preview":!0,"enable-auto-focus":!1,broker:f.value,style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:H,onLogout:k,onExit:W,onStart:K,onRedirect:$},null,8,["form","params","broker"])]}),_:1}),t(L,{title:"Settings"},{default:l(()=>{var a;return[(a=r(o))!=null&&a.form?(n(),p(te,{key:0,class:"settings",form:r(o).form},null,8,["form"])):P("",!0)]}),_:1})]),_:1})),(B=r(o))!=null&&B.form?(n(),p(ne,{key:3,ref_key:"smartConsole",ref:N,runtime:"forms","log-service":r(s),onRestart:k,onClearTerminal:G},null,8,["log-service"])):P("",!0)]),t(se,{"has-changes":(D=(E=r(o))==null?void 0:E.form)==null?void 0:D.hasChanges()},null,8,["has-changes"])],64)}}});const er=Y(ye,[["__scopeId","data-v-a0fb63f1"]]);export{er as default};
//# sourceMappingURL=FormEditor.c5f1b5a7.js.map

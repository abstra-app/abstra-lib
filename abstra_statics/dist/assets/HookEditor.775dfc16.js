import{a as L}from"./asyncComputed.b0c737fe.js";import{d as x,c as S,o as i,a as g,b as a,f as o,u as t,bI as P,cw as v,d6 as Y,g as p,ec as R,d7 as $,h as w,cv as H,N as n,L as X,ad as Z,r as O,k as K,j as ee,aU as te,bQ as q,eM as oe,Y as B,f4 as ae,db as E,W as C,eb as D,aQ as T,cB as I,aA as re,e as se,d1 as le,M as ne,cE as ue,e4 as ie,e5 as de,es as pe}from"./jwt-decode.esm.2b3ab6d6.js";import"./linters.09efd437.js";import{H as me}from"./scripts.d90c3527.js";import{W as fe}from"./workspaces.09d98801.js";import{R as ce,_ as ye}from"./RuntimeCommonSettings.3f905802.js";import{u as he}from"./editor.cd90ef24.js";import{_ as ve}from"./RunButton.vue_vue_type_script_setup_true_lang.6dc66f1e.js";import{A as ge,D as ke}from"./index.b27d55cc.js";import{C as be,A as U}from"./CollapsePanel.2d6639cc.js";import{A as J}from"./index.22e8155b.js";import{A as _e}from"./index.b135788e.js";import"./record.864b7f18.js";import"./runnerData.2b93c62c.js";import"./url.babf8e92.js";import"./colorHelpers.356d8d7c.js";import"./BaseLayout.5b42aa84.js";import"./SaveButton.af91bc25.js";import"./UnsavedChangesHandler.b38b3984.js";import"./ExclamationCircleOutlined.e5e02981.js";import"./omniChatStore.b27e0474.js";import"./OmniChat.ff2274a6.js";import"./gateway.90d6f0fb.js";import"./popupNotifcation.252d2391.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.6855e4c4.js";import"./Logo.74e38667.js";import"./uuid.c15f930f.js";import"./PhCopy.vue.b629902c.js";import"./PhClockCounterClockwise.vue.a76ab766.js";import"./LoadingOutlined.e8bd1faf.js";import"./project.8e37df51.js";import"./tables.247e68a1.js";import"./string.073a4a91.js";import"./controller.e2f9f153.js";import"./index.15965463.js";import"./validations.0e9ecc27.js";import"./metadata.e698c159.js";import"./PhWebhooksLogo.vue.bb82de9c.js";import"./controller.8ac1f433.js";import"./fetch.f2b6c9a8.js";import"./PhPencil.vue.2f1f7c69.js";import"./requirements.bb9c661f.js";import"./object.6c732746.js";import"./PhCopySimple.vue.49237e95.js";import"./index.25328053.js";import"./Avatar.fee817c8.js";import"./Navbar.ededf5c2.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.26da4f3d.js";import"./constants.4985cecc.js";import"./PhArrowCounterClockwise.vue.385b66cb.js";import"./PhFilePy.vue.2892f892.js";import"./PhChats.vue.0a9f69c1.js";import"./PhRocket.vue.67f0b584.js";import"./PhPackage.vue.807c569a.js";import"./userStore.2821fe61.js";import"./polling.7bdd5cbe.js";import"./PhArrowSquareOut.vue.27c78ecb.js";import"./PhDotsThree.vue.6547850d.js";import"./PhSignOut.vue.fc084e08.js";import"./PhSparkle.vue.e8d7cc9d.js";import"./CloseCircleOutlined.d6172cd5.js";import"./CheckCircleFilled.f3b32686.js";import"./index.49ca2a25.js";import"./SourceCode.3b9707b9.js";import"./PhFolder.vue.60b2391d.js";import"./toggleHighContrast.3480e3dd.js";import"./Card.23447a1c.js";import"./TabPane.898a313c.js";import"./TasksManager.0acc5b25.js";import"./tasksController.009fc98e.js";import"./ant-design.d498a7a8.js";import"./PhCaretRight.vue.e9037d8b.js";import"./Badge.70c28a92.js";import"./workspaceStore.5f6d04cf.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[c]="b21d94d2-8c32-47bd-a1d0-4ae4261b98c5",f._sentryDebugIdIdentifier="sentry-dbid-b21d94d2-8c32-47bd-a1d0-4ae4261b98c5")}catch{}})();const qe=x({__name:"HookSettings",props:{hook:{}},setup(f){const c=f,{publicUrl:y}=he(),b=S(()=>!y||!c.hook.path?"":`${y}/_hooks/${c.hook.path}`);return(k,m)=>(i(),g(t(H),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:a(()=>[o(t(v),{label:"Name",required:""},{default:a(()=>[o(t(P),{value:k.hook.title,"onUpdate:value":m[0]||(m[0]=d=>k.hook.title=d)},null,8,["value"])]),_:1}),o(ce,{runtime:k.hook},null,8,["runtime"]),b.value?(i(),g(t(Y),{key:0},{default:a(()=>[p(" You can test this hook locally while the server is running sending a request to "),o(t($),{code:"",copyable:""},{default:a(()=>[p(R(b.value),1)]),_:1})]),_:1})):w("",!0)]),_:1}))}}),Pe={style:{display:"flex","flex-direction":"column",gap:"10px"}},we={key:0},Ce=x({__name:"HookTester",props:{hook:{},disabledWarning:{}},setup(f,{expose:c}){const y=f,b=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],k=S(()=>{var l;if((l=e.response)!=null&&l.status)return e.response.status>=500?"red":e.response.status>=400?"orange":e.response.status>=200?"green":"blue"}),m=n.object({method:n.string(),body:n.string(),queryParams:n.record(n.string()),headers:n.record(n.string())}),d=new X(n.record(n.object({body:n.string(),headers:n.array(n.object({key:n.string(),value:n.string()})),method:n.string(),queryParams:n.array(n.object({name:n.string(),value:n.string()}))})),"abstra:hookTestConfig"),e=Z({queryParams:[],headers:[{key:"Content-Type",value:"application/json"}],method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4),requestDataInput:JSON.stringify({method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4),queryParams:{},headers:{"Content-Type":"application/json"}},null,4)}),_=O(!1),N=async()=>{_.value=!0;try{const l={method:e.method,query:e.queryParams.reduce((r,{name:s,value:u})=>(s&&u&&(r[s]=u),r),{}),body:e.body,headers:e.headers.reduce((r,{key:s,value:u})=>(s&&u&&(r[s]=u),r),{})};e.response=await y.hook.run(l)}finally{_.value=!1}},A=O(!1),Q=()=>{A.value=!0},j=()=>{A.value=!1},M=S(()=>{if(typeof e.requestDataInput!="string")return!1;try{const l=JSON.parse(e.requestDataInput);return m.parse(l),!0}catch{return!1}}),W=()=>{const l=JSON.parse(e.requestDataInput);e.method=l.method||e.method,e.body=l.body||e.body,e.queryParams=Object.entries(l.queryParams||e.queryParams).map(([r,s])=>({name:r,value:String(s)})),e.headers=Object.entries(l.headers||e.headers).map(([r,s])=>({key:r,value:String(s)})),j(),ue.success("Request data imported successfully")},V=()=>{e.queryParams.push({name:"",value:""})},F=l=>{e.queryParams=e.queryParams.filter((r,s)=>s!==l)},G=()=>{e.headers.push({key:"",value:""})},z=l=>{e.headers=e.headers.filter((r,s)=>s!==l)};return K(()=>{const r=(d.get()||{})[y.hook.id];r&&(e.body=r.body,e.headers=r.headers,e.method=r.method,e.queryParams=r.queryParams)}),ee(()=>{const l={body:e.body,headers:e.headers,method:e.method,queryParams:e.queryParams},r=d.get()||{};r[y.hook.id]=l,d.set(r)}),c({runHook:N}),(l,r)=>(i(),g(t(E),{vertical:"",gap:"small",class:"hook-tester"},{default:a(()=>[o(t(E),{justify:"end",align:"center"},{default:a(()=>[o(t(te),{title:"Import Request from logs"},{default:a(()=>[o(t(q),{type:"link",style:{display:"flex","align-items":"center",gap:"5px"},onClick:r[0]||(r[0]=oe(s=>Q(),["stop"]))},{icon:a(()=>[B(l.$slots,"icon",{},()=>[o(t(ae),{size:"16"})])]),default:a(()=>[B(l.$slots,"icon-text",{},()=>[p(" Import Request Data ")])]),_:3})]),_:3})]),_:3}),o(t(H),{layout:"vertical",style:{overflow:"auto"}},{default:a(()=>[o(t(v),null,{default:a(()=>[o(t(be),{ghost:""},{default:a(()=>[o(t(U),{header:`Query Params (${e.queryParams.length})`},{default:a(()=>[(i(!0),C(T,null,D(e.queryParams,(s,u)=>(i(),g(t(v),{key:u},{default:a(()=>[o(t(J),null,{default:a(()=>[o(t(P),{value:s.name,"onUpdate:value":h=>s.name=h,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(t(P),{value:s.value,"onUpdate:value":h=>s.value=h,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(t(q),{danger:"",onClick:h=>F(u)},{default:a(()=>[p("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(t(v),null,{default:a(()=>[o(t(q),{type:"dashed",style:{width:"100%"},onClick:V},{default:a(()=>[p(" Add Query Param ")]),_:1})]),_:1})]),_:1},8,["header"]),o(t(U),{header:`Headers (${e.headers.length})`},{default:a(()=>[(i(!0),C(T,null,D(e.headers,(s,u)=>(i(),g(t(v),{key:u,label:u===0?"Headers":void 0},{default:a(()=>[o(t(J),null,{default:a(()=>[o(t(P),{value:s.key,"onUpdate:value":h=>s.key=h,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(t(P),{value:s.value,"onUpdate:value":h=>s.value=h,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(t(q),{danger:"",onClick:h=>z(u)},{default:a(()=>[p("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["label"]))),128)),o(t(v),null,{default:a(()=>[o(t(q),{type:"dashed",style:{width:"100%"},onClick:G},{default:a(()=>[p("Add Header")]),_:1})]),_:1})]),_:1},8,["header"]),o(t(U),{header:"Body"},{default:a(()=>[e.method!=="GET"?(i(),g(t(v),{key:0},{default:a(()=>[o(t(I),{value:e.body,"onUpdate:value":r[1]||(r[1]=s=>e.body=s)},null,8,["value"])]),_:1})):w("",!0)]),_:1})]),_:1})]),_:1}),o(t(v),{label:"Method"},{default:a(()=>[o(t(re),{value:e.method,options:b,onSelect:r[2]||(r[2]=s=>e.method=s)},null,8,["value"])]),_:1}),o(t(v),null,{default:a(()=>[se("div",Pe,[o(ve,{loading:_.value,disabled:l.disabledWarning,onClick:N,onSave:r[3]||(r[3]=s=>l.hook.save())},null,8,["loading","disabled"])])]),_:1}),o(t(_e),{orientation:"left"},{default:a(()=>[p("Response")]),_:1}),e.response?(i(),C("div",we,[o(t(le),{color:k.value},{default:a(()=>[p(R(e.response.status),1)]),_:1},8,["color"]),o(t(ge),null,{default:a(()=>[(i(!0),C(T,null,D(e.response.headers,(s,u)=>(i(),g(t(ke),{key:u,label:u},{default:a(()=>[p(R(s),1)]),_:2},1032,["label"]))),128))]),_:1}),o(t(I),{value:e.response.body},null,8,["value"])])):w("",!0)]),_:1}),o(t(ne),{open:A.value,"ok-button-props":{disabled:!M.value},onCancel:r[5]||(r[5]=s=>j()),onOk:r[6]||(r[6]=s=>W())},{title:a(()=>[o(t($),null,{default:a(()=>[p("Import Request Data")]),_:1})]),default:a(()=>[o(t(H),{layout:"vertical"},{default:a(()=>[o(t(I),{value:e.requestDataInput,"onUpdate:value":r[4]||(r[4]=s=>e.requestDataInput=s),"auto-size":{minRows:4,maxRows:16}},null,8,["value"])]),_:1}),M.value?w("",!0):(i(),g(t($),{key:0,type:"danger"},{default:a(()=>[p("Invalid JSON")]),_:1}))]),_:1},8,["open","ok-button-props"])]),_:3}))}}),Ft=x({__name:"HookEditor",setup(f){const c=ie(),y=de(),b=O(null),k=S(()=>{var d;return(d=m.value)!=null&&d.hook.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),{result:m}=L(async()=>{const d=y.params.id;if(!d)return await c.push({name:"workflowEditor"}),null;const[e,_]=await Promise.all([fe.get(),me.get(d)]);return _?pe({workspace:e,hook:_}):null});return(d,e)=>t(m)?(i(),g(ye,{key:0,stage:t(m).hook,workspace:t(m).workspace,"stage-type":"hooks"},{settings:a(()=>[o(qe,{hook:t(m).hook},null,8,["hook"])]),test:a(()=>[o(Ce,{ref_key:"tester",ref:b,hook:t(m).hook,"disabled-warning":k.value,style:{overflow:"auto"}},null,8,["hook","disabled-warning"])]),_:1},8,["stage","workspace"])):w("",!0)}});export{Ft as default};
//# sourceMappingURL=HookEditor.775dfc16.js.map

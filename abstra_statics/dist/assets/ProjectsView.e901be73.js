var b=Object.defineProperty;var I=(r,e,t)=>e in r?b(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>(I(r,typeof e!="symbol"?e+"":e,t),t);import{C}from"./CrudView.fda89567.js";import{e as u,f as j,cM as k,ep as T,d as z,ea as E,eo as _,o as g,Y as O,u as a,c as v,S as w,b as c,w as m,aS as S,cz as P,bL as N,aB as A,cy as D,cL as R}from"./index.45f399db.js";import"./gateway.76fd6d35.js";import{M as V}from"./member.6deef377.js";import{P as y,a as x}from"./project.ca5018e6.js";import"./tables.5fa81fef.js";import{a as F}from"./ant-design.4984eb48.js";import{T as M,G as U}from"./tagColorProvider.26e73073.js";import{I as B}from"./PhCopy.vue.7aa8c5df.js";import{O as L}from"./organization.142f7058.js";import"./router.0f359eef.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.77360114.js";import"./BookOutlined.ec5c1af7.js";import"./url.952fd42c.js";import"./PhDotsThreeVertical.vue.09f3cedd.js";import"./Badge.f92e52c2.js";import"./index.55c013cb.js";import"./popupNotifcation.c87fec07.js";import"./record.38eca5ab.js";import"./string.821ef3c1.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="d32683ae-c152-423c-843c-09c72578d2ed",r._sentryDebugIdIdentifier="sentry-dbid-d32683ae-c152-423c-843c-09c72578d2ed")}catch{}})();const $=[{key:"name",label:"Project Name"}];class G{constructor(e,t,n){o(this,"projects",u(null));o(this,"organization",u(null));o(this,"editingProject",u(null));o(this,"teamColorProvider",new M);o(this,"teamOptions",u([]));o(this,"table",j(()=>this.makeCrudViewTable()));o(this,"loading",j(()=>!this.projects.value||!this.organization.value));o(this,"createProject",async e=>{const t=await y.create({organizationId:this.organizationId,name:e.name});this.handlers.navigateToProject(t.id)});o(this,"deleteProject",async({key:e})=>{var n,s;if(!!await F("Are you sure you want to delete this project?")){try{await((s=(n=this.projects.value)==null?void 0:n.find(l=>l.id===e))==null?void 0:s.delete())}catch(l){k.error({message:"Error deleting project",description:String(l)})}await this.fetchInitialState()}});o(this,"duplicateProject",async({key:e})=>{var n;const t=(n=this.projects.value)==null?void 0:n.find(s=>s.id===e);if(t){const s=await t.duplicate();this.handlers.navigateToProject(s.id)}});o(this,"saveEdit",async()=>{if(!this.editingProject.value)return;const{projectId:e,newName:t,newTeam:n}=this.editingProject.value;await this.apis.project.update(e,{name:t,team:n!=null?n:null}),await this.fetchInitialState(),this.editingProject.value=null});o(this,"cancelEdit",()=>{this.editingProject.value=null});o(this,"getActions",e=>{var t;return[{icon:U,label:"Edit project",onClick:()=>this.startEditingProject(e)},{icon:B,label:"Duplicate",onClick:()=>this.duplicateProject({key:e.id}),hide:!!((t=this.organization.value)!=null&&t.featureFlags.DUPLICATE_PROJECTS)},{icon:T,label:"Delete",onClick:()=>this.deleteProject({key:e.id}),dangerous:!0}]});o(this,"getRows",()=>this.projects.value?this.projects.value.map(e=>({key:e.id,cells:[{type:"link",text:e.name,to:`/projects/${encodeURIComponent(e.id)}`},{type:"tag",text:e.team||"No team",tagColor:e.team?this.teamColorProvider.getColor(e.team):"default"},{type:"actions",actions:this.getActions(e)}]})):[]);this.organizationId=e,this.handlers=t,this.apis=n}async fetchInitialState(){this.projects.value=await y.list(this.organizationId),this.organization.value=await L.get(this.organizationId),this.teamOptions.value=await this.fetchTeamOptions()}async fetchTeamOptions(){return(await this.apis.member.fetchTeamOptions(this.organizationId)).map(t=>({label:t,value:t}))}startEditingProject(e){var t;this.editingProject.value={projectId:e.id,newName:e.name,newTeam:(t=e.team)!=null?t:""}}makeCrudViewTable(){return{columns:[{title:"Project",align:"left"},{title:"Team",align:"center"},{title:"",align:"right"}],rows:this.getRows()}}}const me=z({__name:"ProjectsView",setup(r){const t=E().params.organizationId,n=_(),s={navigateToProject:h=>n.push({name:"project",params:{organizationId:t,projectId:h}})},l={member:new V,project:new x},i=new G(t,s,l);return i.fetchInitialState(),(h,d)=>{var f;return g(),O(S,null,[a(i).table.value?(g(),v(C,{key:0,"entity-name":"project",loading:a(i).loading.value,title:`${(f=a(i).organization.value)==null?void 0:f.name}'s Projects`,description:"Organize your team\u2019s work into different Projects, each with it\u2019s own environment settings and authorized users.","create-button-text":"Create Project","empty-title":"No projects here yet",table:a(i).table.value,fields:a($),create:a(i).createProject},null,8,["loading","title","table","fields","create"])):w("",!0),c(a(R),{open:!!a(i).editingProject.value,title:"Edit project",onCancel:a(i).cancelEdit,onOk:a(i).saveEdit},{default:m(()=>[a(i).editingProject.value?(g(),v(a(D),{key:0,layout:"vertical"},{default:m(()=>[c(a(P),{label:"Name"},{default:m(()=>[c(a(N),{value:a(i).editingProject.value.newName,"onUpdate:value":d[0]||(d[0]=p=>a(i).editingProject.value.newName=p)},null,8,["value"])]),_:1}),c(a(P),{label:"Team",tooltip:"Create Teams by adding them on the Editors page",help:a(i).editingProject.value.newTeam?`Only editors within '${a(i).editingProject.value.newTeam}' or organization Admins can view the project`:"Project will be visible to all editors"},{default:m(()=>[c(a(A),{value:a(i).editingProject.value.newTeam,"onUpdate:value":d[1]||(d[1]=p=>a(i).editingProject.value.newTeam=p),"allow-clear":"",options:a(i).teamOptions.value,placeholder:"Select or type new team name","not-found-content":"Create a team first on the Editors page"},null,8,["value","options"])]),_:1},8,["help"])]),_:1})):w("",!0)]),_:1},8,["open","onCancel","onOk"])],64)}}});export{me as default};
//# sourceMappingURL=ProjectsView.e901be73.js.map

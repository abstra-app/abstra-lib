import{L as $}from"./tasksController.53d4ecf2.js";import{d as _,al as k,c as v,o as u,W as d,Y as x,h as V,e6 as M,e as h,r as y,a as H,b as c,f as l,u as r,bI as T,cw as S,cv as L,k as I,db as A,aA as B,bQ as N,_ as R,e4 as P,e5 as W,es as D}from"./jwt-decode.esm.f0e7c156.js";import{a as z}from"./asyncComputed.96287c0e.js";import"./linters.107d49c7.js";import{S as E}from"./scripts.fae788ab.js";import{W as F}from"./workspaces.04e49905.js";import{R as j,_ as q}from"./RuntimeCommonSettings.c016ba67.js";import{_ as O}from"./RunButton.vue_vue_type_script_setup_true_lang.36f70ede.js";import"./gateway.d13f2aab.js";import"./popupNotifcation.299c313a.js";import"./polling.49fca932.js";import"./string.d14b3078.js";import"./record.c58778b3.js";import"./runnerData.834b5952.js";import"./url.6cf2a27a.js";import"./colorHelpers.60da5a96.js";import"./BaseLayout.d0c9ee8b.js";import"./SaveButton.14919a3a.js";import"./UnsavedChangesHandler.fc313616.js";import"./ExclamationCircleOutlined.089ac3c1.js";import"./omniChatStore.a9893f58.js";import"./OmniChat.1000922e.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.c143e993.js";import"./Logo.ef8ca4e1.js";import"./uuid.bfc36f31.js";import"./PhCopy.vue.73d17d98.js";import"./PhClockCounterClockwise.vue.e5eb75a1.js";import"./LoadingOutlined.5eb48601.js";import"./project.43d6e67c.js";import"./tables.138888b9.js";import"./controller.9e6eaf81.js";import"./index.3a8315ec.js";import"./validations.cddcf8f2.js";import"./metadata.3ab031da.js";import"./PhWebhooksLogo.vue.0fae4c4f.js";import"./controller.467772b6.js";import"./fetch.a1630489.js";import"./PhPencil.vue.37d30c5b.js";import"./requirements.f5e06e1a.js";import"./object.63d6e0bc.js";import"./PhCopySimple.vue.29192c8b.js";import"./index.bfb3900a.js";import"./CollapsePanel.e1f3b9d1.js";import"./Avatar.4f0b4697.js";import"./Navbar.8f580f8b.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.63e284e5.js";import"./constants.7d73741d.js";import"./PhArrowCounterClockwise.vue.f2ffa9b3.js";import"./PhFilePy.vue.29302b5f.js";import"./PhChats.vue.0123b670.js";import"./PhRocket.vue.7cd1d812.js";import"./PhPackage.vue.02754183.js";import"./userStore.6d551f19.js";import"./PhArrowSquareOut.vue.5c0b9dc5.js";import"./PhDotsThree.vue.00562335.js";import"./PhSignOut.vue.2796cd26.js";import"./PhSparkle.vue.3768eeb0.js";import"./editor.c715d636.js";import"./workspaceStore.675aad31.js";import"./index.3762587c.js";import"./CloseCircleOutlined.d94c7c7b.js";import"./CheckCircleFilled.8501853f.js";import"./index.7169de4e.js";import"./SourceCode.dc0f1138.js";import"./PhFolder.vue.e50e12a8.js";import"./toggleHighContrast.2b67ea0c.js";import"./Card.7ced52f7.js";import"./TabPane.9278d8ed.js";import"./TasksManager.b4afff3c.js";import"./ant-design.e4fd1b0b.js";import"./index.4b8c7e8c.js";import"./PhCaretRight.vue.3ee68126.js";import"./Badge.4abaed8d.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[o]="e57c6c28-9bf4-4ea9-b323-0131d57292a9",m._sentryDebugIdIdentifier="sentry-dbid-e57c6c28-9bf4-4ea9-b323-0131d57292a9")}catch{}})();const U=["width","height","fill","transform"],G={key:0},J=h("path",{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},null,-1),Q=[J],Y={key:1},K=h("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),X=h("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V76.69L62.63,62.06A95.43,95.43,0,0,1,130,33.94h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.56,79.56,0,0,0,73.94,73.37L59.31,88H88a8,8,0,0,1,0,16Zm128,48H168a8,8,0,0,0,0,16h28.69l-14.63,14.63a79.56,79.56,0,0,1-56.13,23.43h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.43,95.43,0,0,0,67.36-28.12L208,179.31V208a8,8,0,0,0,16,0V160A8,8,0,0,0,216,152Z"},null,-1),tt=[K,X],et={key:2},at=h("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,13.66-5.66L64,60.7a95.42,95.42,0,0,1,66-26.76h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.48,79.48,0,0,0,75.35,72L93.66,90.34A8,8,0,0,1,88,104Zm128,48H168a8,8,0,0,0-5.66,13.66L180.65,184a79.48,79.48,0,0,1-54.72,22.09h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.42,95.42,0,0,0,66-26.76l18.36,18.36A8,8,0,0,0,224,208V160A8,8,0,0,0,216,152Z"},null,-1),rt=[at],ot={key:3},st=h("path",{d:"M88,102H40a6,6,0,0,1-6-6V48a6,6,0,0,1,12,0V81.52l18-18a93.45,93.45,0,0,1,66-27.53h.52A93.39,93.39,0,0,1,196.19,62.7a6,6,0,0,1-8.38,8.58A82,82,0,0,0,72.53,72L54.48,90H88a6,6,0,0,1,0,12Zm128,52H168a6,6,0,0,0,0,12h33.52l-18.05,18a81.51,81.51,0,0,1-57.53,24h-.46a81.5,81.5,0,0,1-57.29-23.34,6,6,0,0,0-8.38,8.58,93.39,93.39,0,0,0,65.67,26.76H126a93.45,93.45,0,0,0,66-27.53l18-18.05V208a6,6,0,0,0,12,0V160A6,6,0,0,0,216,154Z"},null,-1),it=[st],lt={key:4},nt=h("path",{d:"M88,104H40a8,8,0,0,1-8-8V48a8,8,0,0,1,16,0V76.69L62.63,62.06A95.43,95.43,0,0,1,130,33.94h.53a95.36,95.36,0,0,1,67.07,27.33,8,8,0,0,1-11.18,11.44,79.52,79.52,0,0,0-55.89-22.77h-.45A79.56,79.56,0,0,0,73.94,73.37L59.31,88H88a8,8,0,0,1,0,16Zm128,48H168a8,8,0,0,0,0,16h28.69l-14.63,14.63a79.56,79.56,0,0,1-56.13,23.43h-.45a79.52,79.52,0,0,1-55.89-22.77,8,8,0,1,0-11.18,11.44,95.36,95.36,0,0,0,67.07,27.33H126a95.43,95.43,0,0,0,67.36-28.12L208,179.31V208a8,8,0,0,0,16,0V160A8,8,0,0,0,216,152Z"},null,-1),pt=[nt],mt={key:5},ut=h("path",{d:"M88,100H40a4,4,0,0,1-4-4V48a4,4,0,0,1,8,0V86.34L65.46,64.89A91.39,91.39,0,0,1,130,37.94h.51A91.43,91.43,0,0,1,194.8,64.13a4,4,0,0,1-5.6,5.72,83.44,83.44,0,0,0-58.68-23.91h-.47a83.52,83.52,0,0,0-58.94,24.6L49.66,92H88a4,4,0,0,1,0,8Zm128,56H168a4,4,0,0,0,0,8h38.34l-21.45,21.46A83.52,83.52,0,0,1,126,210.06h-.47A83.44,83.44,0,0,1,66.8,186.15a4,4,0,0,0-5.6,5.72,91.43,91.43,0,0,0,64.28,26.19H126a91.39,91.39,0,0,0,64.55-26.95L212,169.66V208a4,4,0,0,0,8,0V160A4,4,0,0,0,216,156Z"},null,-1),ct=[ut],dt={name:"PhArrowsCounterClockwise"},ft=_({...dt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(m){const o=m,i=k("weight","regular"),f=k("size","1em"),n=k("color","currentColor"),g=k("mirrored",!1),s=v(()=>{var t;return(t=o.weight)!=null?t:i}),p=v(()=>{var t;return(t=o.size)!=null?t:f}),e=v(()=>{var t;return(t=o.color)!=null?t:n}),a=v(()=>o.mirrored!==void 0?o.mirrored?"scale(-1, 1)":void 0:g?"scale(-1, 1)":void 0);return(t,b)=>(u(),d("svg",M({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:p.value,height:p.value,fill:e.value,transform:a.value},t.$attrs),[x(t.$slots,"default"),s.value==="bold"?(u(),d("g",G,Q)):s.value==="duotone"?(u(),d("g",Y,tt)):s.value==="fill"?(u(),d("g",et,rt)):s.value==="light"?(u(),d("g",ot,it)):s.value==="regular"?(u(),d("g",lt,pt)):s.value==="thin"?(u(),d("g",mt,ct)):V("",!0)],16,U))}}),gt=_({__name:"ScriptSettings",props:{script:{}},setup(m){const i=y(m.script);return(f,n)=>(u(),H(r(L),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:c(()=>[l(r(S),{label:"Name",required:""},{default:c(()=>[l(r(T),{value:i.value.title,"onUpdate:value":n[0]||(n[0]=g=>i.value.title=g)},null,8,["value"])]),_:1}),l(j,{runtime:i.value},null,8,["runtime"])]),_:1}))}}),vt={style:{width:"100%",display:"flex","flex-direction":"column"}},ht=_({__name:"ScriptTester",props:{script:{},disabledWarning:{},tasks:{}},emits:["refetch-tasks"],setup(m,{emit:o}){const i=m,f=v(()=>{var e,a;return(a=(e=i.tasks)==null?void 0:e.map(t=>{const b=t.payload,w=JSON.stringify(b,null,2),Z=w.length>80?w.slice(0,80)+"...":w,C=new Date(t.created.at).toLocaleString();return{label:`${Z} - ${C}`,value:t.id}}))!=null?a:[]}),n=y(void 0),g=v(()=>n.value?null:{title:"No trigger task selected",message:"Please select the task that will trigger the script"}),s=y(!1),p=async()=>{var e;s.value=!0;try{await i.script.run((e=n.value)!=null?e:null)}finally{s.value=!1,n.value=void 0,o("refetch-tasks",i.script.id)}};return I(()=>{o("refetch-tasks",i.script.id)}),(e,a)=>(u(),d("div",vt,[l(r(L),{layout:"vertical",style:{overflow:"auto"}},{default:c(()=>[l(r(S),{label:"Trigger task"},{default:c(()=>[l(r(A),{gap:"small",class:"container"},{default:c(()=>[l(r(B),{options:f.value,value:n.value,onSelect:a[0]||(a[0]=t=>n.value=t)},null,8,["options","value"]),l(r(N),{onClick:a[1]||(a[1]=t=>o("refetch-tasks",e.script.id))},{default:c(()=>[l(r(A),null,{default:c(()=>[l(r(ft),{size:16})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{loading:s.value,disabled:e.disabledWarning||g.value,onClick:p,onSave:a[2]||(a[2]=t=>e.script.save())},null,8,["loading","disabled"])]))}});const kt=R(ht,[["__scopeId","data-v-f14e4635"]]),W0=_({__name:"ScriptEditor",setup(m){const o=P(),i=W(),f=y(null),n=new $,g=v(()=>{var e;return(e=p.value)!=null&&e.script.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),s=async e=>{const a=await n.getStageTasks(e);f.value=a.tasks.filter(t=>t.status==="pending")},{result:p}=z(async()=>{const e=i.params.id;if(!e)return await o.push({name:"workflowEditor"}),null;const[a,t]=await Promise.all([F.get(),E.get(e)]);return t?(s(t.id),D({workspace:a,script:t})):null});return(e,a)=>r(p)?(u(),H(q,{key:0,stage:r(p).script,workspace:r(p).workspace,"stage-type":"scripts",onRefetchTasks:a[0]||(a[0]=t=>s(r(p).script.id))},{settings:c(()=>[l(gt,{script:r(p).script},null,8,["script"])]),test:c(()=>[l(kt,{ref:"tester",script:r(p).script,"disabled-warning":g.value,tasks:f.value,onRefetchTasks:s},null,8,["script","disabled-warning","tasks"])]),_:1},8,["stage","workspace"])):V("",!0)}});export{W0 as default};
//# sourceMappingURL=ScriptEditor.21647e2d.js.map

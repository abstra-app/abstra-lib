import{_ as z}from"./DocsButton.vue_vue_type_script_setup_true_lang.95e6cfad.js";import{C as M}from"./ContentLayout.71db1b1d.js";import{p as S}from"./popupNotifcation.55b3af61.js";import{a as L}from"./ant-design.c5f399fe.js";import{a as V}from"./asyncComputed.87c0613c.js";import{b as G,U,D as H,a as R,G as q}from"./files.ae5589e3.js";import{d as K,e3 as Q,g as x,f as Z,o as c,c as y,w as n,b as s,az as f,u as t,d6 as J,O as W,d4 as A,bM as k,a as h,ea as v,K as T,F as _,cZ as X,bK as Y,bs as ee,bq as N,d5 as B,cq as te,eF as ae,eG as oe,Q as ne}from"./index.92768f2c.js";import{C as b}from"./gateway.8a37f403.js";import"./columns.f304264d.js";import{C as se}from"./Card.5754c6fa.js";import"./record.6c8e0977.js";import"./string.68e7c9e5.js";import"./TabPane.ab94d0f3.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[a]="a41ad358-edf6-4f22-a6ae-ab395d8b0edd",r._sentryDebugIdIdentifier="sentry-dbid-a41ad358-edf6-4f22-a6ae-ab395d8b0edd")}catch{}})();class g{constructor(a){this.projectId=a}static fromProjectId(a){return new g(a)}async list(){return b.get(`projects/${this.projectId}/files`)}async DEPRECATED_upload(a,i=""){const u={"Content-Type":"multipart/form-data"};return b.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(i+"/"+a.name)}`,a,u)}async upload(a,i){const u={"Content-Type":"multipart/form-data"},C=new File([new Blob(i?[i]:[])],G(a));return b.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(a)}`,C,u)}async download(a){return b.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(a)}`)}async delete(a){return b.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(a)}`)}async move(a,i){return b.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(a)}&newPath=${encodeURIComponent(i)}`,{})}}const le=r=>(ae("data-v-c7bfa309"),r=r(),oe(),r),re=le(()=>h("br",null,null,-1)),ie={key:0},de={key:0,class:"file-size"},ce={class:"action-item"},ue={class:"action-item"},pe=K({__name:"Files",setup(r){const i=Q().params.projectId,u=g.fromProjectId(i),{loading:C,result:O,refetch:j}=V(()=>u.list());function F(e){var o,l;return{key:e.path,title:e.name,isLeaf:e.type==="file",file:e,children:e.type==="file"?[]:(l=(o=e.children)==null?void 0:o.map(F))!=null?l:[]}}const m=x(()=>{var e;return(e=O.value)==null?void 0:e.map(F)}),D=e=>{var o,l;return e.isLeaf?1:(l=(o=e.children)==null?void 0:o.reduce((d,p)=>d+D(p),0))!=null?l:0},w=x(()=>m.value?m==null?void 0:m.value.reduce((e,o)=>e+D(o),0):0),I=Z(!1);function $(e){if(e&&e.type==="file")return;const o=document.createElement("input");o.type="file",o.onchange=async()=>{var d;const l=(d=o.files)==null?void 0:d[0];if(!!l)try{I.value=!0,await u.DEPRECATED_upload(l,e==null?void 0:e.path),await j()}catch{S("Failed to upload file","File already exists")}finally{I.value=!1}},o.click()}async function P(e){if(!e)return;const o=await u.download(e.path),l=document.createElement("a");l.href=URL.createObjectURL(o),l.download=e.name,l.click()}async function E(e){if(!e)return;const o="Are you sure you want to delete this "+(e.type==="file"?"file":"directory and all its contents")+"?";await L(o)&&(await u.delete(e.path),await j())}return(e,o)=>(c(),y(M,null,{default:n(()=>[s(t(J),null,{default:n(()=>[f("Files")]),_:1}),s(t(A),null,{default:n(()=>[f(" Here you can upload, download and delete files in your persistent dir."),re,f(" Files can be used in your scripts. "),s(z,{path:"cloud/files"}),W(e.$slots,"description",{},void 0,!0)]),_:3}),s(t(k),{type:"primary",loading:I.value,onClick:o[0]||(o[0]=l=>$())},{default:n(()=>[s(t(U)),f(" Upload ")]),_:1},8,["loading"]),s(t(se),{class:"files"},{default:n(()=>[w.value>0?(c(),y(t(A),{key:0},{default:n(()=>[h("b",null,[f(v(w.value)+" file",1),w.value!==1?(c(),T("span",ie,"s")):_("",!0)])]),_:1})):_("",!0),m.value&&m.value.length>0?(c(),y(t(X),{key:1,"tree-data":m.value,selectable:!1},{title:n(({title:l,isLeaf:d,file:p})=>[h("span",null,[f(v(l)+" ",1),d?(c(),T("span",de,"("+v(p.size)+")",1)):_("",!0)]),d?(c(),y(t(k),{key:0,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>P(p)},{default:n(()=>[s(t(H))]),_:2},1032,["onClick"])):_("",!0),d?(c(),y(t(k),{key:1,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>E(p)},{default:n(()=>[s(t(R))]),_:2},1032,["onClick"])):_("",!0),d?_("",!0):(c(),y(t(Y),{key:2},{overlay:n(()=>[s(t(ee),{disabled:t(C)},{default:n(()=>[s(t(N),{danger:!1,onClick:()=>$(p)},{default:n(()=>[h("div",ce,[s(t(U)),s(t(B),null,{default:n(()=>[f(" Upload ")]),_:1})])]),_:2},1032,["onClick"]),s(t(N),{danger:!1,onClick:()=>E(p)},{default:n(()=>[h("div",ue,[s(t(R)),s(t(B),null,{default:n(()=>[f(" Delete ")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1032,["disabled"])]),default:n(()=>[s(t(q),{style:{cursor:"pointer",float:"inline-end"},size:"25px"})]),_:2},1024))]),_:1},8,["tree-data"])):(c(),y(t(te),{key:2,description:t(C)?"Loading...":"No files"},null,8,["description"]))]),_:1})]),_:3}))}});const Fe=ne(pe,[["__scopeId","data-v-c7bfa309"]]);export{Fe as default};
//# sourceMappingURL=Files.13650529.js.map

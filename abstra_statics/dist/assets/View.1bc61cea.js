var re=Object.defineProperty;var le=(i,e,a)=>e in i?re(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a;var F=(i,e,a)=>(le(i,typeof e!="symbol"?e+"":e,a),a);import{d as C,G as R,b as p,c as f,w as r,u as o,f as l,bF as w,aq as g,cD as D,by as j,ad as q,H as G,eP as H,eu as K,eC as se,eE as ie,aC as z,cq as J,eB as ce,r as O,ew as B}from"./outputWidgets.225dd371.js";import{a as T}from"./asyncComputed.8a54909a.js";import{A as _,F as I}from"./Form.12e2d16e.js";import{A as P}from"./index.d8b778bd.js";import{C as Q}from"./CrudView.72bd6d5e.js";import{G as W}from"./PhPencil.vue.bd1d8b41.js";import{A as de}from"./index.42c8bfb7.js";import{C as v}from"./router.8e23138d.js";import{p as k}from"./popupNotifcation.6873325b.js";import"./index.2924e62a.js";import{a as L}from"./ant-design.a00feaec.js";import{A as ue}from"./Title.bbb77099.js";import{A as V,T as pe}from"./TabPane.3fb3cd2e.js";import"./hasIn.1e38e049.js";import"./isNumeric.75337b1e.js";import"./Paragraph.253f2b2e.js";import"./Text.a0f2d781.js";import"./Modal.0a797886.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.c28d2d29.js";import"./url.29c1f37b.js";import"./index.8e2737d3.js";import"./index.cf4c23b9.js";import"./record.b805ac15.js";import"./pubsub.3bce7ea8.js";import"./index.86c302fc.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[e]="e7062f5e-6b54-421c-9cec-d5a9595881c7",i._sentryDebugIdIdentifier="sentry-dbid-e7062f5e-6b54-421c-9cec-d5a9595881c7")}catch{}})();class me{constructor(){F(this,"urlPath","users")}async create(e,a){return v.post(`projects/${e}/${this.urlPath}`,a)}async delete(e,a){await v.delete(`projects/${e}/${this.urlPath}/${a}`)}async list(e,{limit:a,offset:t}){const n={};a&&(n.limit=a.toString()),t&&(n.offset=t.toString());const s=new URLSearchParams(n);return v.get(`projects/${e}/${this.urlPath}?${s.toString()}`)}async update(e,a,t){return v.patch(`projects/${e}/${this.urlPath}/${a}`,t)}}const x=new me;class U{constructor(e){this.dto=e}static async list(e,a,t){return(await x.list(e,{limit:a,offset:t})).map(s=>new U(s))}static async create(e,a){const t=await x.create(e,a);return new U(t)}async delete(){await x.delete(this.projectId,this.id)}async change(e){await x.update(this.projectId,this.id,e),e.roles&&(this.roles=e.roles),e.email&&(this.email=e.email)}get id(){return this.dto.id}get email(){return this.dto.email}set email(e){this.dto.email=e}get projectId(){return this.dto.projectId}get roles(){return this.dto.roles}set roles(e){this.dto.roles=e}}class ye{constructor(){F(this,"urlPath","roles")}async create(e,a){return v.post(`projects/${e}/${this.urlPath}`,a)}async delete(e,a){await v.delete(`projects/${e}/${this.urlPath}/${a}`)}async list(e,{limit:a,offset:t}){const n={};a&&(n.limit=a.toString()),t&&(n.offset=t.toString());const s=new URLSearchParams(n);return v.get(`projects/${e}/${this.urlPath}?${s.toString()}`)}async update(e,a,t){return v.patch(`projects/${e}/${this.urlPath}/${a}`,t)}}const A=new ye;class ${constructor(e){this.dto=e}static async list(e,a,t){return(await A.list(e,{limit:a,offset:t})).map(s=>new $(s))}static async create(e,a){const t=await A.create(e,a);return new $(t)}async delete(){await A.delete(this.projectId,this.id)}async change(e){await A.update(this.projectId,this.id,e),e.description&&(this.description=e.description)}get id(){return this.dto.id}get name(){return this.dto.name}get description(){return this.dto.description||""}set description(e){this.dto.description=e}get projectId(){return this.dto.projectId}}const fe=C({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(i,{emit:e}){const t=i.roleOptions.map(c=>({label:c.name,value:c.name})),n=R({email:"",roles:[]});function s(){e("cancel")}function m(){!n.email||e("created",n)}return(c,y)=>(p(),f(o(P),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:s},{extra:r(()=>[l(o(D),null,{default:r(()=>[l(o(w),{onClick:s},{default:r(()=>[g("Cancel")]),_:1}),l(o(w),{type:"primary",onClick:m},{default:r(()=>[g("Submit")]),_:1})]),_:1})]),default:r(()=>[l(o(I),{model:n,layout:"vertical"},{default:r(()=>[l(o(_),{key:"email",label:"Email",required:!0},{default:r(()=>[l(o(j),{value:n.email,"onUpdate:value":y[0]||(y[0]=h=>n.email=h)},null,8,["value"])]),_:1}),l(o(_),{key:"role",label:"Role"},{default:r(()=>[l(o(q),{value:n.roles,"onUpdate:value":y[1]||(y[1]=h=>n.roles=h),mode:"multiple",options:o(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),ge=C({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(i,{emit:e}){const a=i,t=a.roleOptions.map(c=>({label:c.name,value:c.name})),n=R({email:a.email,roles:a.roles});function s(){e("cancel")}function m(){e("updated",n)}return(c,y)=>(p(),f(o(P),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:s},{extra:r(()=>[l(o(D),null,{default:r(()=>[l(o(w),{onClick:s},{default:r(()=>[g("Cancel")]),_:1}),l(o(w),{type:"primary",onClick:m},{default:r(()=>[g("Submit")]),_:1})]),_:1})]),default:r(()=>[l(o(I),{model:n,layout:"vertical"},{default:r(()=>[l(o(_),{key:"email",label:"Email"},{default:r(()=>[l(o(j),{value:n.email,"onUpdate:value":y[0]||(y[0]=h=>n.email=h)},null,8,["value"])]),_:1}),l(o(_),{key:"role",label:"Role"},{default:r(()=>[l(o(q),{value:n.roles,"onUpdate:value":y[1]||(y[1]=h=>n.roles=h),mode:"multiple",options:o(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),he=C({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const e=i,a=G(()=>{var t;return{columns:[{name:"Email"},{name:"Roles"},{name:"",align:"right"}],rows:(t=e.users.map(n=>({key:n.email,cells:[{type:"text",text:n.email},{type:"slot",key:"roles",payload:{roles:n.roles}},{type:"actions",actions:[{icon:W,label:"Edit",onClick:()=>e.onEdit(n)},{icon:H,label:"Delete",onClick:()=>e.onDelete(n)}]}]})))!=null?t:[]}});return(t,n)=>(p(),f(Q,{"entity-name":"users",title:"",loading:t.loading,description:"List all app users.","empty-title":"No users yet",table:a.value,"create-button-text":"Add users",onCreate:t.onCreate},{roles:r(({payload:s})=>[(p(!0),K(z,null,se(s.roles,m=>(p(),f(o(de),{key:m,bordered:""},{default:r(()=>[g(ie(m),1)]),_:2},1024))),128))]),_:1},8,["loading","table","onCreate"]))}}),ve=C({__name:"NewRole",emits:["created","cancel"],setup(i,{emit:e}){const a=R({name:"",description:""});function t(){e("cancel")}function n(){!a.name||e("created",a)}return(s,m)=>(p(),f(o(P),{open:"",title:"New role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:t},{extra:r(()=>[l(o(D),null,{default:r(()=>[l(o(w),{onClick:t},{default:r(()=>[g("Cancel")]),_:1}),l(o(w),{type:"primary",onClick:n},{default:r(()=>[g("Submit")]),_:1})]),_:1})]),default:r(()=>[l(o(I),{model:a,layout:"vertical"},{default:r(()=>[l(o(_),{key:"name",label:"Name",required:!0},{default:r(()=>[l(o(j),{value:a.name,"onUpdate:value":m[0]||(m[0]=c=>a.name=c)},null,8,["value"])]),_:1}),l(o(_),{key:"description",label:"Description"},{default:r(()=>[l(o(J),{value:a.description,"onUpdate:value":m[1]||(m[1]=c=>a.description=c),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),we=C({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(i,{emit:e}){const a=i,t=R({description:a.description});function n(){e("cancel")}function s(){e("updated",t)}return(m,c)=>(p(),f(o(P),{open:"",title:"Update role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:n},{extra:r(()=>[l(o(D),null,{default:r(()=>[l(o(w),{onClick:n},{default:r(()=>[g("Cancel")]),_:1}),l(o(w),{type:"primary",onClick:s},{default:r(()=>[g("Submit")]),_:1})]),_:1})]),default:r(()=>[l(o(I),{model:t,layout:"vertical"},{default:r(()=>[l(o(_),{key:"name",label:"Name"},{default:r(()=>[l(o(j),{value:a.name,disabled:""},null,8,["value"])]),_:1}),l(o(_),{key:"role",label:"Role"},{default:r(()=>[l(o(J),{value:t.description,"onUpdate:value":c[0]||(c[0]=y=>t.description=y),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),_e=C({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const e=i,a=G(()=>{var t;return{columns:[{name:"Name"},{name:"Description"},{name:"",align:"right"}],rows:(t=e.roles.map(n=>({key:n.id,cells:[{type:"text",text:n.name},{type:"text",text:n.description},{type:"actions",actions:[{icon:W,label:"Edit",onClick:()=>e.onEdit(n)},{icon:H,label:"Delete",onClick:()=>e.onDelete(n)}]}]})))!=null?t:[]}});return(t,n)=>(p(),f(Q,{"entity-name":"roles",loading:t.loading,title:"",description:"List all app roles.","empty-title":"No roles yet",table:a.value,"create-button-text":"Add roles",onCreate:t.onCreate},null,8,["loading","table","onCreate"]))}}),Je=C({__name:"View",setup(i){const a=ce().params.projectId,t=O({type:"initial"}),n=O("users"),s=()=>{t.value.type="initial"},m=()=>{t.value.type="creatingUser"},c=d=>{t.value={type:"editingUser",payload:d}},y=()=>{t.value.type="creatingRole"},h=d=>{t.value={type:"editingRole",payload:d}},{loading:X,result:Y,refetch:E}=T(()=>U.list(a,100,0)),{loading:Z,result:S,refetch:N}=T(()=>$.list(a,100,0)),M=async d=>{try{if(t.value.type!=="creatingUser")return;await U.create(a,d),s(),E()}catch(u){u instanceof Error&&k("Create Error",u.message)}},ee=async d=>{try{if(t.value.type!=="editingUser")return;await t.value.payload.change(d),s(),E()}catch(u){u instanceof Error&&k("Update Error",u.message)}},te=async d=>{if(!!await L("Deleteing users revoke their access to your application in case they aren't allowed to self sign-up. Are you sure you want to continue?"))try{await d.delete(),E()}catch(b){b instanceof Error&&k("Delete Error",b.message)}},ae=async d=>{try{if(t.value.type!=="creatingRole")return;await $.create(a,d),s(),N()}catch(u){u instanceof Error&&k("Create Error",u.message)}},oe=async d=>{try{if(t.value.type!=="editingRole")return;await t.value.payload.change(d),s(),N()}catch(u){u instanceof Error&&k("Update Error",u.message)}},ne=async d=>{if(!!await L("Deleteing roles may revoke access to some features in your application. Are you sure you want to continue?"))try{await d.delete(),N(),E()}catch(b){b instanceof Error&&k("Delete Error",b.message)}};return(d,u)=>(p(),K(z,null,[l(o(ue),null,{default:r(()=>[g("Access Control")]),_:1}),l(o(pe),{"active-key":n.value,"onUpdate:activeKey":u[0]||(u[0]=b=>n.value=b)},{default:r(()=>[l(o(V),{key:"users",tab:"Users"}),l(o(V),{key:"roles",tab:"Roles"})]),_:1},8,["active-key"]),n.value==="users"?(p(),f(he,{key:0,loading:o(X),users:o(Y)||[],onCreate:m,onEdit:c,onDelete:te},null,8,["loading","users"])):B("",!0),n.value==="roles"?(p(),f(_e,{key:1,loading:o(Z),roles:o(S)||[],onCreate:y,onEdit:h,onDelete:ne},null,8,["loading","roles"])):B("",!0),t.value.type==="creatingUser"?(p(),f(fe,{key:2,"role-options":o(S)||[],onCancel:s,onCreated:M},null,8,["role-options"])):t.value.type==="editingUser"?(p(),f(ge,{key:3,email:t.value.payload.email,roles:t.value.payload.roles||[],"role-options":o(S)||[],onUpdated:ee,onCancel:s},null,8,["email","roles","role-options"])):t.value.type==="creatingRole"?(p(),f(ve,{key:4,onCancel:s,onCreated:ae})):t.value.type==="editingRole"?(p(),f(we,{key:5,name:t.value.payload.name,description:t.value.payload.description,onUpdated:oe,onCancel:s},null,8,["name","description"])):B("",!0)],64))}});export{Je as default};
//# sourceMappingURL=View.1bc61cea.js.map

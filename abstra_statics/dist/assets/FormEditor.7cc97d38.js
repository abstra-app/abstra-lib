import{d as U,r as P,b as m,c as y,w as r,f as t,u as e,bU as _,aA as p,bV as j,eB as O,eA as M,b$ as q,G as x,eD as B,cG as X,F as oe,H as Z,eu as H,eC as le,cK as ne,b8 as se,bD as ue,e as ie,eG as de,ew as T}from"./outputWidgets.4bfd26d4.js";import{R as pe,_ as me,S as ce,L as fe}from"./Debugger.vue_vue_type_script_setup_true_lang.d896d885.js";import{A as v,F as ee}from"./Base.e0f0653c.js";import{A as C}from"./Title.7be9864d.js";import{a as te}from"./asyncComputed.962039e2.js";import{F as ve}from"./forms.f6e9d7b1.js";import{W as ae}from"./workspaces.f2ae2a6c.js";import{_ as ge}from"./SaveButton.vue_vue_type_script_setup_true_lang.097c24a0.js";import{l as Y,_ as ye}from"./DocsButton.vue_vue_type_script_setup_true_lang.d4afc797.js";import{B as he}from"./BaseLayout.3b577997.js";import{R as be,F as _e,r as re}from"./FormRunner.d6ab908b.js";import{_ as we}from"./StageRunSelector.vue_vue_type_script_setup_true_lang.70ccc20b.js";import{A as z}from"./index.003bc4e1.js";import{C as ke,A as xe}from"./CollapsePanel.7b2be95e.js";import{a as I}from"./Text.451ebbbf.js";import{A as Se}from"./index.a83ac764.js";import{A as Pe}from"./index.b2e57df4.js";import{A as J,T as Ae}from"./TabPane.2536022a.js";import{c as Re}from"./index.166e3079.js";import"./hooks.ef71cbb4.js";import"./activeRecord.063a729a.js";import"./pubsub.1fff0dea.js";import"./jobs.0efca792.js";import"./icons.a2f3d017.js";import"./uuid.46c04ed0.js";import"./transButton.4fa41b3f.js";import"./url.8e2f7e6d.js";import"./ant-design.de44008f.js";import"./index.10e49733.js";import"./CircularLoading.9723796f.js";import"./PlayerNavbar.667b5ecc.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.e9e0d2f3.js";import"./WidgetsFrame.987df201.js";(function(){try{var g=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(g._sentryDebugIds=g._sentryDebugIds||{},g._sentryDebugIds[c]="d70a8424-f748-4de7-abff-5bf2bc4f21b7",g._sentryDebugIdIdentifier="sentry-dbid-d70a8424-f748-4de7-abff-5bf2bc4f21b7")}catch{}})();const Te=U({__name:"FormSettings",props:{form:{}},setup(g){const a=P(g.form);return(d,o)=>(m(),y(e(ee),{layout:"vertical"},{default:r(()=>[t(pe,{runtime:a.value},null,8,["runtime"]),t(e(v),{label:"Form name"},{default:r(()=>[t(e(_),{type:"text",onChange:o[0]||(o[0]=n=>{var l;return a.value.title=(l=n.target.value)!=null?l:""})})]),_:1}),t(e(C),{level:3},{default:r(()=>[p(" Texts ")]),_:1}),t(e(C),{level:4},{default:r(()=>[p(" Welcome Screen ")]),_:1}),t(e(v),{label:"Title"},{default:r(()=>[t(e(_),{value:a.value.welcomeTitle,"onUpdate:value":o[1]||(o[1]=n=>a.value.welcomeTitle=n),type:"text",placeholder:a.value.title,disabled:a.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),t(e(v),{label:"Description"},{default:r(()=>[t(e(_),{value:a.value.startMessage,"onUpdate:value":o[2]||(o[2]=n=>a.value.startMessage=n),type:"text",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(v),{label:"Start button label"},{default:r(()=>[t(e(_),{value:a.value.startButtonText,"onUpdate:value":o[3]||(o[3]=n=>a.value.startButtonText=n),type:"text",placeholder:"Start",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(v),null,{default:r(()=>[t(e(j),{checked:a.value.autoStart,"onUpdate:checked":o[4]||(o[4]=n=>a.value.autoStart=n)},{default:r(()=>[p("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),t(e(C),{level:4},{default:r(()=>[p(" End Screen ")]),_:1}),t(e(v),{label:"End text"},{default:r(()=>[t(e(_),{value:a.value.endMessage,"onUpdate:value":o[5]||(o[5]=n=>a.value.endMessage=n),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),t(e(v),{label:"Restart button label"},{default:r(()=>[t(e(_),{value:a.value.restartButtonText,"onUpdate:value":o[6]||(o[6]=n=>a.value.restartButtonText=n),placeholder:"Restart",type:"text",disabled:!a.value.allowRestart},null,8,["value","disabled"])]),_:1}),t(e(v),null,{default:r(()=>[t(e(j),{checked:a.value.allowRestart,"onUpdate:checked":o[7]||(o[7]=n=>a.value.allowRestart=n)},{default:r(()=>[p("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),t(e(C),{level:4},{default:r(()=>[p(" Alert Messages ")]),_:1}),t(e(v),{label:"Error message"},{default:r(()=>[t(e(_),{value:a.value.errorMessage,"onUpdate:value":o[8]||(o[8]=n=>a.value.errorMessage=n),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),Ue=U({__name:"PreviewButton",props:{model:{}},setup(g){const c=g,a=O(),d=M(),o=()=>{const n=a.query;d.push({path:`/_editor/${c.model.routeName}/${encodeURIComponent(c.model.path)}/preview`,query:n})};return(n,l)=>(m(),y(e(q),{class:"preview-button",onClick:o},{default:r(()=>[p(" Preview ")]),_:1}))}}),$e=U({__name:"LaunchButton",props:{path:{}},setup(g){const c=g,a=P({state:"loading"}),d=x(()=>a.value.state!=="found"),o=x(()=>a.value.state==="loading"),n=x(()=>a.value.state==="found"?a.value.url:void 0),l=x(()=>{switch(a.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${a.value}`)}}),A=x(()=>{switch(a.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${a.value}`)}});async function k(f){const i=`https://${f}.abstra.app/_version`;return(await fetch(i)).ok}async function R(f){const i=`https://${f}.abstra.app/_pages/${c.path}`;return(await fetch(i)).ok}async function w(){if(!(await Y.get()).logged){a.value={state:"not-logged"};return}const i=await Y.getProjectInfo().catch(()=>null);if(!i){a.value={state:"error"};return}if(!await k(i.subdomain).catch(()=>null)){a.value={state:"not-deployed"};return}if(!await R(i.subdomain).catch(()=>null)){a.value={state:"not-found"};return}const F=`https://${i.subdomain}.abstra.app/${c.path}`;a.value={state:"found",url:F}}return w(),(f,i)=>(m(),y(e(X),{title:l.value},{content:r(()=>[p(B(A.value),1)]),default:r(()=>[t(e(q),{href:n.value,target:"_blank",disabled:d.value,loading:o.value},{default:r(()=>[p("Launch last deploy")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Ce=ie("p",{style:{width:"200px"}}," Add query params to simulate someone using your forms with specific data in the URL. ",-1),De={key:1,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},D="abstra-run-id",Be=U({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(g,{expose:c,emit:a}){var V,G,K,W;const d=g,o=P(void 0);function n(){o.value=o.value?void 0:"query-params"}const l=oe({queryParams:[],url:`${d.form.path}`,stageRunId:null}),A=s=>{l.stageRunId=s},{result:k,loading:R}=te(()=>ae.get()),w=()=>{l.queryParams.push({name:"",value:""})},f=s=>{l.queryParams=l.queryParams.filter((b,u)=>u!==s)};Z([()=>l.stageRunId,()=>l.queryParams],([s,b])=>{const u=b.find(h=>h.name===D);if(console.log(s,u),s&&!u){l.queryParams.push({name:D,value:s});return}if(!s&&u){l.queryParams=l.queryParams.filter(h=>h.name!==D);return}s&&u&&s!==u.value&&(u.value=s)});const i=x(()=>be.create({formPath:d.form.path}));(V=i.value)==null||V.on("stdout",s=>{d.logService.log({type:"stdout",log:s.log})}),(G=i.value)==null||G.on("stderr",s=>{d.logService.log({type:"stderr",log:s.log})}),(K=i.value)==null||K.onClose(()=>{d.logService.log({type:"stderr",log:"Program closed"})}),(W=i.value)==null||W.on("files:changed",()=>{d.logService.log({type:"files-changed",log:"Files changed"})});const $=M(),E=({path:s})=>{re("editor",$,s)};function F(s,b){a("redirect",s,b)}const N=P(null);async function Q(){var s;return d.logService.log({type:"restart"}),(s=N.value)==null?void 0:s.run()}const L=x(()=>{const s=new URLSearchParams(l.queryParams.filter(u=>u.name.trim()).reduce((u,h)=>({...u,[h.name]:h.value}),{})).toString();return{subdomain:"[your-subdomain]",path:d.form.path,query:s}});return c({restart:Q}),(s,b)=>(m(),y(e(ee),{layout:"vertical"},{default:r(()=>[t(e(v),{label:"Select a thread"},{default:r(()=>[t(we,{disabled:d.form.isInitial,path:d.form.path,optional:!0,onSelect:b[0]||(b[0]=u=>A(u))},null,8,["disabled","path"])]),_:1}),t(e(v),{label:"Testing URL"},{default:r(()=>[t(e(z),{gap:0,style:{overflow:"hidden"}},{default:r(()=>[p(" https:// "),t(e(I),{style:{"margin-right":"0"}},{default:r(()=>[p(B(L.value.subdomain),1)]),_:1}),p(" .abstra.app/ "),t(e(I),{style:{"margin-right":"0","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis"}},{default:r(()=>[p(B(L.value.path),1)]),_:1}),t(e(z),null,{default:r(()=>[p(" ? "),t(e(X),{title:"Query params"},{content:r(()=>[Ce]),default:r(()=>[t(e(I),{style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer"},onClick:n},{default:r(()=>[p(B(L.value.query||"[ ... ]"),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(v),null,{default:r(()=>[t(e(ke),{ghost:"","active-key":o.value,"onUpdate:activeKey":b[1]||(b[1]=u=>o.value=u)},{default:r(()=>[t(e(xe),{header:`Query Params (${l.queryParams.length})`,key:"query-params"},{default:r(()=>[(m(!0),H(se,null,le(l.queryParams,(u,h)=>(m(),y(e(v),{key:h},{default:r(()=>[t(e(ne),null,{default:r(()=>[t(e(_),{value:u.name,"onUpdate:value":S=>u.name=S,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(_),{value:u.value,"onUpdate:value":S=>u.value=S,type:"text",placeholder:"value",disabled:u.name===D},null,8,["value","onUpdate:value","disabled"]),t(e(q),{danger:"",onClick:S=>f(h)},{default:r(()=>[p("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(v),null,{default:r(()=>[t(e(q),{type:"dashed",style:{width:"100%"},onClick:w},{default:r(()=>[p("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1},8,["active-key"])]),_:1})]),_:1}),t(e(Se),{orientation:"left"},{default:r(()=>[p("Quick Preview")]),_:1}),e(R)||!e(k)?(m(),y(e(ue),{key:0})):l.stageRunId||d.form.isInitial?(m(),H("div",De,[t(_e,{ref_key:"runner",ref:N,form:s.form.makeRunnerData(e(k)),params:{...l.queryParams.reduce((u,{name:h,value:S})=>({...u,[h]:S}),{})},"is-preview":"","enable-auto-focus":"",broker:i.value,onNavigate:E,onRedirect:F,onLogout:Q},null,8,["form","params","broker"])])):(m(),y(e(Pe),{key:2,message:"This form is an intermediate task within the workflow. Please select a task instance to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}}),ct=U({__name:"FormEditor",setup(g){const c=M(),a=O(),d=P(null),o=P("test");function n(){c.push({name:"forms"})}const{result:l,refetch:A}=te(()=>Promise.all([ae.get(),ve.get(a.params.formPath)]).then(([w,f])=>de({workspace:w,form:f}))),k=fe.create();function R(w,f){re("editor",c,w,f)}return Z(()=>a.params.formPath,()=>{A()}),(w,f)=>(m(),y(he,null,{navbar:r(()=>[e(l)?(m(),y(e(Re),{key:0,title:e(l).form.title,style:{padding:"5px 10px"},onBack:n},{footer:r(()=>[t(e(Ae),{"active-key":o.value,"onUpdate:activeKey":f[0]||(f[0]=i=>o.value=i)},{default:r(()=>[t(e(J),{key:"test",tab:"Test"}),t(e(J),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:r(()=>[t(me),t($e,{path:e(l).form.path},null,8,["path"]),t(ye,{path:"forms/overview"}),t(Ue,{model:e(l).form},null,8,["model"]),o.value==="settings"?(m(),y(ge,{key:0,model:e(l).form},null,8,["model"])):T("",!0)]),_:1},8,["title"])):T("",!0)]),content:r(()=>[e(l)&&o.value==="test"?(m(),y(Be,{key:0,ref_key:"tester",ref:d,form:e(l).form,"log-service":e(k),onRedirect:R},null,8,["form","log-service"])):T("",!0),e(l)&&o.value==="settings"?(m(),y(Te,{key:1,form:e(l).form},null,8,["form"])):T("",!0)]),footer:r(()=>{var i;return[e(l)&&o.value==="test"?(m(),y(ce,{key:0,runtime:"forms","log-service":e(k),onRestart:(i=d.value)==null?void 0:i.restart},null,8,["log-service","onRestart"])):T("",!0)]}),_:1}))}});export{ct as default};
//# sourceMappingURL=FormEditor.7cc97d38.js.map

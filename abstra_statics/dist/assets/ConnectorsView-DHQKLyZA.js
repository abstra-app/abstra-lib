import{_ as le}from"./DocsButton.vue_vue_type_script_setup_true_lang-BQudeAaP.js";import{_ as W}from"./AbstraButton.vue_vue_type_script_setup_true_lang-BNrsT9md.js";import{a as M,i as z,c as K,b as T,e as p,f as se,g as F,h as j,m as re,a8 as H,r as $,H as Y,p as k,u as o,aJ as ce,w as s,M as N,W as B,aG as ue,aH as de,aK as pe,cH as Q,bq as he,br as ge,S as w,U as C,cF as me,bo as ve,b8 as fe,bj as ye,bn as ke,j as u,af as y,ak as V,v as x,aQ as D,cI as we,aL as te,bm as X,E as be,aN as ne,ac as Ce,aj as O,be as _e,bf as Ee,bg as Z,bB as Ae,z as ee,bs as G}from"./jwt-decode.esm-DCAoywrA.js";import{G as Se}from"./PhDotsThreeVertical.vue-DEs2DWEB.js";import{C as Te}from"./connectors-B_IiVqZN.js";import{a as Ie}from"./router-7YEByzEa.js";import{U as Ue}from"./UploadOutlined-D0n9Tu9h.js";import{_ as xe}from"./AbstraLogo.vue_vue_type_script_setup_true_lang-gouMBgiE.js";import{L as Le}from"./Logo-ssylEZD1.js";import{A as ae}from"./index-BFl-GvTe.js";import{C as oe}from"./index-Al2IVr2V.js";import{S as Ne}from"./index-CT-wna9n.js";import"./constants-DM_w0DUy.js";import"./ts.worker-DrfknIMF.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[n]="eb490f19-1799-4db1-8a78-a0a0095bb7c8",l._sentryDebugIdIdentifier="sentry-dbid-eb490f19-1799-4db1-8a78-a0a0095bb7c8")}catch{}})();const Fe=["width","height","fill","transform"],Pe={key:0},Ve=j("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),He=[Ve],Ke={key:1},je=j("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),$e=j("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Be=[je,$e],Me={key:2},Re=j("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),ze=[Re],De={key:3},qe=j("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),Oe=[qe],Ze={key:4},Ge=j("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Je=[Ge],We={key:5},Ye=j("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),Qe=[Ye],Xe={name:"PhArrowsLeftRight"},et=M({...Xe,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const n=l,i=z("weight","regular"),a=z("size","1em"),r=z("color","currentColor"),_=z("mirrored",!1),E=K(()=>n.weight??i),I=K(()=>n.size??a),f=K(()=>n.color??r),b=K(()=>n.mirrored!==void 0?n.mirrored?"scale(-1, 1)":void 0:_?"scale(-1, 1)":void 0);return(L,m)=>(p(),T("svg",re({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:I.value,height:I.value,fill:f.value,transform:b.value},L.$attrs),[se(L.$slots,"default"),E.value==="bold"?(p(),T("g",Pe,He)):E.value==="duotone"?(p(),T("g",Ke,Be)):E.value==="fill"?(p(),T("g",Me,ze)):E.value==="light"?(p(),T("g",De,Oe)):E.value==="regular"?(p(),T("g",Ze,Je)):E.value==="thin"?(p(),T("g",We,Qe)):F("",!0)],16,Fe))}});(()=>{var l="https://apis.google.com/js/api.js",n="https://accounts.google.com/gsi/client";async function i(e="client:picker"){return window.gapi||await r(l),await new Promise(t=>{window.gapi.load(e,t)}),window.google}async function a(e){return window.google?.accounts?.oauth2||await r(n),new Promise((t,c)=>{window.google.accounts.oauth2.initTokenClient({...e,callback:t,error_callback:c}).requestAccessToken()})}async function r(e){return new Promise((t,c)=>{let A=document.createElement("script");A.src=e,A.onload=()=>t(),A.onerror=g=>c(g);let h=document.querySelector(`script[src="${e}"]`);h&&(console.log(`drive-picker: appending a copy of an existing script ${e}`),Array.from(h.attributes).forEach(g=>{["id","src","onload","onerror"].includes(g.name)||A.setAttribute(g.name,g.value)}),h.nonce&&(A.nonce=h.nonce)),document.head.appendChild(A)})}function _(e,t){let c=e.getAttribute(t);return c?Number(c):null}var E=(e=>(e[e.FALSE=0]="FALSE",e[e.TRUE=1]="TRUE",e[e.DEFAULT=2]="DEFAULT",e))(E||{});function I(e,t){return e.hasAttribute(t)}function f(e,t){let c=e.getAttribute(t)?.toUpperCase();if(!c)return 2;let A=E[c];if(A!==void 0)return A;throw new Error(`Invalid value, "${c}", for attribute ${t}. Must be one of ${Object.keys(E).filter(Number.isNaN).join(", ")}`)}function b(e,t,c,A){let h=f(t,e);return h===2?A:c.call(A,h===1)}var L=class extends HTMLElement{static get observedAttributes(){return["enable-drives","file-ids","include-folders","mime-types","mode","owned-by-me","parent","query","select-folder-enabled","starred","view-id"]}get view(){let e=new window.google.picker.DocsView(this.viewId);b("enable-drives",this,e.setEnableDrives,e),b("include-folders",this,e.setIncludeFolders,e),b("owned-by-me",this,e.setOwnedByMe,e),b("select-folder-enabled",this,e.setSelectFolderEnabled,e),b("starred",this,e.setStarred,e);let t=this.getAttribute("mime-types");t!==null&&e.setMimeTypes(t);let c=this.getAttribute("file-ids");c!==null&&e.setFileIds(c);let A=this.getAttribute("mode");A&&e.setMode(google.picker.DocsViewMode[A]);let h=this.getAttribute("parent");h!==null&&e.setParent(h);let g=this.getAttribute("query");return g!==null&&e.setQuery(g),e}get viewId(){let e=this.getAttribute("view-id");return e?window.google.picker.ViewId[e]:void 0}},m=class extends HTMLElement{static get observedAttributes(){return["app-id","client-id","debounce-delay","developer-key","hide-title-bar","locale","max-items","mine-only","multiselect","nav-hidden","oauth-token","origin","relay-url","scope","title"]}picker;observer;google;loading;debounceTimer;get visible(){return!!this.picker?.isVisible()}set visible(e){this.picker?.setVisible(e)}get tokenClientConfig(){let e=this.getAttribute("client-id"),t=this.getAttribute("scope")??"https://www.googleapis.com/auth/drive.file";if(!e||!t)throw new Error("client-id and scope are required attributes");return{client_id:e,hd:this.getAttribute("hd")??void 0,include_granted_scopes:!!this.getAttribute("include-granted-scope"),login_hint:this.getAttribute("login-hint")??void 0,prompt:this.getAttribute("prompt")??"",scope:t}}attributeChangedCallback(){this.isConnected&&this.scheduleBuild()}scheduleBuild(){clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.build()},_(this,"debounce-delay")??0)}async build(){if(this.picker?.dispose(),await this.loading,!this.google)return;let e=new this.google.picker.PickerBuilder().setCallback(q=>{this.callbackToDispatchEvent(q)}),t=this.getAttribute("app-id");t?e=e.setAppId(t):console.warn("drive-picker: app-id attribute is missing. This may cause issues with backend API integration.");let c=this.getAttribute("developer-key");c!==null&&(e=e.setDeveloperKey(c));let A=this.getAttribute("locale");A!==null&&(e=e.setLocale(A));let h=_(this,"max-items");h!==null&&(e=e.setMaxItems(h));let g=this.getAttribute("origin");g!==null&&(e=e.setOrigin(g));let v=this.getAttribute("relay-url");v!==null&&(e=e.setRelayUrl(v));let S=this.getAttribute("title");S!==null&&(e=e.setTitle(S)),b("hide-title-bar",this,e.hideTitleBar,e);let R=this.getAttribute("oauth-token")??await this.requestAccessToken();if(R){e=e.setOAuthToken(R),I(this,"multiselect")&&(e=e.enableFeature(this.google.picker.Feature.MULTISELECT_ENABLED)),I(this,"mine-only")&&(e=e.enableFeature(this.google.picker.Feature.MINE_ONLY)),I(this,"nav-hidden")&&(e=e.enableFeature(this.google.picker.Feature.NAV_HIDDEN));for(let q of this.views)e=e.addView(q);this.picker=e.build(),this.picker.setVisible(!0)}}get views(){let e=d(this);return e.length?e:["all"]}async connectedCallback(){this.loading=i().then(e=>{this.google=e}),this.observer=new MutationObserver(e=>{e.filter(t=>t.type==="childList"||t.type==="attributes"&&t.target!==this).length&&this.scheduleBuild()}),this.observer?.observe(this,{childList:!0,subtree:!0,attributes:!0}),this.scheduleBuild()}callbackToDispatchEvent(e){let t;switch(e.action){case google.picker.Action.CANCEL:t=["picker:canceled","picker-canceled"];break;case google.picker.Action.PICKED:t=["picker:picked","picker-picked"];break;case google.picker.Action.ERROR:t=["picker:error","picker-error"];break;default:return}for(let c of t)this.dispatchEvent(new CustomEvent(c,{detail:e}))}async requestAccessToken(){return a(this.tokenClientConfig).then(e=>{let{access_token:t}=e;if(!t){this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}));return}return this.dispatchEvent(new CustomEvent("picker:authenticated",{detail:{token:t}})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),this.dispatchEvent(new CustomEvent("picker:oauth:response",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),t}).catch(e=>{this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}))})}disconnectedCallback(){this.picker?.dispose()}};function U(e){return"view"in e&&e.view instanceof window.google.picker.View}function P(e){return e.filter(t=>U(t)).map(t=>t.view)}function d(e,t="*"){return P(Array.from(e.querySelectorAll(t)))}customElements.define("drive-picker",m),customElements.define("drive-picker-docs-view",L)})();class tt{async showPicker(n){return new Promise((i,a)=>{try{const{accessToken:r,clientId:_,apiKey:E,appId:I,title:f="Select files",views:b=["DOCS","FOLDERS","SPREADSHEETS","PRESENTATIONS"],multiSelect:L=!0}=n;if(!r||!_||!E)throw new Error("Tokens are required but not provided");const m=document.createElement("drive-picker");m.setAttribute("client-id",_),m.setAttribute("app-id",I),m.setAttribute("developer-key",E),m.setAttribute("oauth-token",r),m.setAttribute("origin",window.location.origin||"http://localhost:8004"),m.setAttribute("multiselect",L.toString()),f&&m.setAttribute("title",f),b.forEach(e=>{const t=document.createElement("drive-picker-docs-view");t.setAttribute("view-id",e),t.setAttribute("select-folder-enabled","true"),m.appendChild(t)}),m.oauthToken=r,m.clientId=_,m.appId=I,m.developerKey=E;const U=e=>{const{action:t,docs:c}=e.detail;t==="picked"?i({action:"picked",documents:c||[]}):(t==="cancelled"||t==="cancel")&&i({action:"cancelled",documents:[]}),document.body.contains(m)&&document.body.removeChild(m)},P=e=>{a(new Error(`Google Picker error: ${e.detail.error||"Unknown error"}`)),document.body.contains(m)&&document.body.removeChild(m)},d=e=>{a(new Error(`Google Picker OAuth error: ${e.detail.error||"OAuth failed"}`)),document.body.contains(m)&&document.body.removeChild(m)};m.addEventListener("picker-picked",U),m.addEventListener("picker-canceled",U),m.addEventListener("picker-error",P),m.addEventListener("picker-oauth-error",d),m.style.display="none",document.body.appendChild(m),setTimeout(()=>{m.visible=!0},100)}catch(r){console.error("Error in showPicker:",r),a(new Error(`Failed to create picker: ${r instanceof Error?r.message:"Unknown error"}`))}})}}const nt=new tt;class at{handleError(n,i="An unexpected error occurred"){console.error(`${i}:`,n),H.error({title:i,content:`An unexpected error occurred: ${n instanceof Error?n.message:"Unknown error"}. Please try again.`})}showWarning(n,i){H.warning({title:n,content:i})}showSuccess(n,i){H.success({title:n,content:i})}}class ot{handlers=[];registerHandler(n){this.handlers.push(n)}getHandler(n){return this.handlers.find(i=>i.canHandle(n))||null}}class it extends at{canHandle(n){return n==="picker"}async execute(n){try{if(!n.setupItem)throw new Error("Setup item is required");const i=await n.api.getPostConnectionSetup(n.projectId,n.connection.connectorType,n.connection.name,n.setupItem.type),a=await this.showGooglePicker(i);await this.handlePickerResult(a,n)}catch(i){this.handleError(i,"Error executing picker post connection setup")}}async showGooglePicker(n){return await nt.showPicker({accessToken:n.access_token,clientId:n.clientId,apiKey:n.apiKey,appId:n.appId,title:"Select files and folders",views:n.views,multiSelect:!0})}async handlePickerResult(n,i){n.action==="picked"&&n.documents.length>0?await this.saveSelectedFiles(n,i):n.action==="cancelled"?console.log("User cancelled item selection"):n.documents.length===0&&this.showWarning("No Items Selected","Please select at least one file or folder to save to the connection.")}async saveSelectedFiles(n,i){const a={selectedFiles:n.documents.map(r=>({id:r.id,name:r.name,url:r.url,mimeType:r.mimeType,iconUrl:r.iconUrl,lastEditedUtc:r.lastEditedUtc,parents:r.parents||[],type:r.type,sizeBytes:r.sizeBytes})),lastUpdated:new Date().toISOString(),totalFiles:n.documents.length};await i.api.updateConnectionConfig({projectId:i.projectId,connectorType:i.connection.connectorType,connectionName:i.connection.name,config:a}),this.showSuccess("Items Saved",`Successfully saved ${n.documents.length} item(s) to your connection.`)}}const ie=new ot;ie.registerHandler(new it);async function lt(l){if(!l.setupItem){H.warning({title:"Setup Item Missing",content:"No setup item was provided for this connection."});return}const n=ie.getHandler(l.setupItem.type);if(!n){H.warning({title:"Setup Not Supported",content:`The setup type "${l.setupItem.type}" is not currently supported.`});return}await n.execute(l)}class st{constructor(n,i){this.projectId=n,this.api=i,this.state=$({connectors:[],connections:[],addingConnection:null,editingConnection:null,betaStatus:{}})}state;hasChanges=K(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName);async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchBetaStatus(){this.state.value.betaStatus=await this.api.getConnectorsBetaStatus()}async fetchInitialState(){await this.fetchConnectors(),await Promise.all([this.fetchBetaStatus(),this.refetchConnections()])}async refetchConnections(){const n=await this.api.listConnections(this.projectId);this.state.value.connections=n.map(i=>{const a=this.state.value.connectors.find(r=>r.metadata.key===i.connectionType);return a?{name:i.name,connectorTitle:a.metadata.label,connectorType:i.connectionType,icon:a.metadata.logoUrl}:null}).filter(i=>i!==null)}handleDeletionClick=async n=>{H.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(n)})};handleDeleteConnection=async n=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:n.name,connectorType:n.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()};handleEditConnectionClick(n){this.state.value.editingConnection={...n,newName:n.name}}async getLoginUrl(n,i,a,r){return this.api.getLoginUrl(this.projectId,i,n,a,r)}slugify(n){return n.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(n){const i=new Set(this.state.value.connections.filter(r=>r.connectorType===n).map(r=>r.name));if(!i.has(n))return n;let a=1;for(;i.has(`${n}-${a}`);)a++;return`${n}-${a}`}handleAddConnectionSubmit=async()=>{const n=this.state.value.addingConnection?.connector.metadata.key,i=this.state.value.addingConnection?.selectedScopeIds,a=this.state.value.addingConnection?.tokenValues??{};if(!n||!i)throw new Error("No connector or scope selected");const{url:r}=await this.getLoginUrl(n,this.getUniqueName(n),i,a);window.location.href=r};handleAddTokenConnectionSubmit=async()=>{const n=this.state.value.addingConnection;if(!n)throw new Error("No connection is being added");const i=n.connector.metadata.key,a=this.getUniqueName(i);await this.api.createTokenConnection({projectId:this.projectId,connectionName:a,connectorType:i,tokens:n.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()};async generateEcdsaKey(){const n=this.state.value.addingConnection;if(!n)throw new Error("No connection is being added");const i=n.connector.metadata.key,a=this.getUniqueName(i),_=i==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:a,connectorType:i}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:a,connectorType:i});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=a,this.state.value.addingConnection.ecdsaKeys=_),_.publicKey}handleAddEcdsaConnectionSubmit=async(n,i)=>{const a=this.state.value.addingConnection;if(!a||!n)throw new Error("No connection is being added or public key is missing");if(!a.connectionName||!a.ecdsaKeys)throw new Error("Keys or connection name not found");const r=a.connector.metadata.key;if(r==="iugu"){if(!i)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:a.connectionName,connectorType:r,publicKey:a.ecdsaKeys.publicKey,privateKey:a.ecdsaKeys.privateKey,apiToken:i})}else{if(!i)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:a.connectionName,connectorType:r,publicKey:a.ecdsaKeys.publicKey,privateKey:a.ecdsaKeys.privateKey,accessId:i})}this.state.value.addingConnection=null,await this.refetchConnections()};renameConnection=async()=>{const{editingConnection:n}=this.state.value;if(!n)throw new Error("No connection is being edited");const i=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:n.name,connectorType:n.connectorType,newConnectionName:n.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};H.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:i})};showAddConfirmationModal=n=>{this.state.value.addingConnection={selectedScopeIds:n.auth.type==="oauth2"?n.auth.scopes.map(i=>i.key):[],connector:n,tokenValues:{}}};handleScopeToggle=(n,i)=>{i?this.state.value.addingConnection.selectedScopeIds.push(n):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(a=>a!==n)};handlePostConnectionSetup=async(n,i)=>{try{await lt({connection:n,projectId:this.projectId,api:this.api,setupItem:i})}catch(a){console.error("Error executing personalized option:",a),H.error({title:"Configuration Error",content:"An error occurred while loading the personalized option. Please try again."})}}}function rt(l){return new Promise((n,i)=>{const a=new FileReader;a.onload=()=>{const _=a.result.split(",")[1];n(_)},a.onerror=()=>i(a.error),a.readAsDataURL(l)})}const ct={key:6,style:{"margin-top":"16px"}},J=M({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(l,{emit:n}){const i=l,a=n,r=$(i.uploadedFiles||{});function _(d){const e=f.value[d];return e?e.split(",").map(t=>t.trim()):[]}function E(d){if(!d.condition)return!0;const e=Object.keys(d.condition);for(const t of e){const c=d.condition[t].equals;if(f.value[t]!==c)return!1}return!0}function I(d,e){Array.isArray(e)?b(d,e.join(",")):console.error("Expected array for checkbox/select value")}const f=$({...i.tokenValues});Y(()=>i.tokenValues,d=>{f.value={...d}},{deep:!0}),Y(()=>i.uploadedFiles,d=>{r.value=d||{}},{deep:!0});function b(d,e){f.value[d]=e;const t={...f.value};a("update:tokenValues",t),a("tokenChange")}function L(d){const e=[];return d.key&&e.push({required:!0,message:y.translate("i18n_auth_form_field_required",null,d.label||d.key)}),d.input?.minSize&&e.push({min:d.input.minSize,message:y.translate("i18n_auth_form_field_min_length",null,d.input.minSize)}),d.input?.maxSize&&e.push({max:d.input.maxSize,message:y.translate("i18n_auth_form_field_max_length",null,d.input.maxSize)}),e}async function m(d,e){try{const t=await rt(d),c={...r.value,[e]:{file:d,base64:t}};r.value=c,a("update:uploadedFiles",c),f.value[e]=t;const A={...f.value};a("update:tokenValues",A),a("tokenChange")}catch(t){console.error("Error converting file to base64:",t)}return!1}function U(d){const e={...r.value};delete e[d],r.value=e,a("update:uploadedFiles",e),f.value[d]="";const t={...f.value};a("update:tokenValues",t),a("tokenChange")}function P(d){const e=r.value[d];return e?[{uid:d,name:e.file.name,status:"done",size:e.file.size}]:[]}return(d,e)=>(p(),k(o(ce),{model:f.value,layout:"vertical"},{default:s(()=>[(p(!0),T(N,null,B(l.tokens,t=>ue((p(),k(o(pe),{key:t.key,required:E(t),label:t.label,name:t.key,rules:L(t)},{default:s(()=>[t.input?.type==="small-string"?(p(),k(o(Q),{key:0,value:f.value[t.key],"onUpdate:value":c=>f.value[t.key]=c,placeholder:t.description,maxlength:t.input?.maxSize,minlength:t.input?.minSize,onInput:()=>b(t.key,f.value[t.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):t.input?.type==="radiobox"?(p(),k(o(he),{key:1,value:f.value[t.key],"onUpdate:value":c=>f.value[t.key]=c,onChange:()=>b(t.key,f.value[t.key]||"")},{default:s(()=>[(p(!0),T(N,null,B(t.input.options,c=>(p(),k(o(ge),{key:c.value,value:c.value},{default:s(()=>[w(C(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):t.input?.type==="checkbox"?(p(),T(N,{key:2},[(t.input?.options?.length??0)<=10?(p(),k(o(me),{key:0,value:_(t.key),onChange:c=>I(t.key,c)},{default:s(()=>[(p(!0),T(N,null,B(t.input.options,c=>(p(),k(o(ve),{key:c.value,value:c.value},{default:s(()=>[w(C(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(p(),k(o(fe),{key:1,mode:"multiple",style:{width:"100%"},value:_(t.key),options:t.input.options??[],onChange:c=>I(t.key,c)},null,8,["value","options","onChange"]))],64)):t.input?.type==="large-text"?(p(),k(o(ye),{key:3,value:f.value[t.key],"onUpdate:value":c=>f.value[t.key]=c,placeholder:t.description,maxlength:t.input?.maxSize,minlength:t.input?.minSize,rows:4,onInput:()=>b(t.key,f.value[t.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):t.input?.type==="file"?(p(),k(o(ke),{key:4,"file-list":P(t.key),"before-upload":c=>m(c,t.key),"max-count":1,"show-upload-list":!0,onRemove:()=>U(t.key)},{default:s(()=>[u(W,null,{default:s(()=>[u(o(Ue)),w(" "+C(o(y).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:1},8,["file-list","before-upload","onRemove"])):(p(),k(o(Q),{key:5,value:f.value[t.key],"onUpdate:value":c=>f.value[t.key]=c,placeholder:t.description,onInput:()=>b(t.key,f.value[t.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),t.instructions?(p(),T("div",ct,[u(o(V),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:s(()=>[w(C(t.instructions),1)]),_:2},1024)])):F("",!0),t.description&&!t.instructions?(p(),k(o(V),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:s(()=>[w(C(t.description),1)]),_:2},1024)):F("",!0)]),_:2},1032,["required","label","name","rules"])),[[de,E(t)]])),128))]),_:1},8,["model"]))}}),ut=M({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(l){return(n,i)=>(p(),k(o(x),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:s(()=>[u(xe,{"hide-text":"",size:"large"}),u(o(et),{size:24}),u(Le,{"image-url":l.connectorLogoUrl,"brand-name":l.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),dt=M({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(l,{emit:n}){const i=l,a=n,r=K(()=>{switch(i.addingConnection?.connector.auth.type){case"oauth2":return y.translate("i18n_connection_modal_button_authorize",null);case"tokens":return y.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!i.ecdsaPublicKey)return y.translate("i18n_connection_modal_button_ok",null);const P=i.addingConnection?.connector.auth.params||[],d=i.addingConnection?.tokenValues||{};return P.every(t=>d[t.key]&&d[t.key].trim().length>0)?y.translate("i18n_connection_modal_button_create",null):y.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return y.translate("i18n_connection_modal_button_ok",null)}});function _(){a("cancel")}function E(){a("submit")}function I(U,P){a("scope-toggle",U,P)}function f(){a("generate-ecdsa-key")}function b(U){a("update:token-values",U)}function L(U){a("update:uploaded-files",U)}function m(){a("token-change")}return(U,P)=>(p(),k(o(H),{open:!!l.addingConnection,title:l.addingConnection?o(y).translate("i18n_connection_modal_title_add",null,l.addingConnection.connector.metadata.label):"","ok-text":r.value,"ok-button-props":{disabled:r.value.includes("Required")},"confirm-loading":l.loading,"wrap-class-name":"full-modal",onCancel:_,onOk:E},{default:s(()=>[l.addingConnection?(p(),T(N,{key:0},[u(ut,{"connector-logo-url":l.addingConnection.connector.metadata.logoUrl,"connector-label":l.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),l.addingConnection.connector.auth.type==="oauth2"?(p(),T(N,{key:0},[u(o(D),null,{default:s(()=>[w(C(o(y).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),u(o(x),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:s(()=>[(p(!0),T(N,null,B(l.addingConnection.connector.auth.scopes,d=>(p(),k(o(x),{key:d.key,justify:"space-between",align:"center"},{default:s(()=>[u(o(x),{vertical:""},{default:s(()=>[u(o(V),null,{default:s(()=>[w(C(d.description),1)]),_:2},1024),u(o(V),{type:"secondary"},{default:s(()=>[w(C(d.key),1)]),_:2},1024)]),_:2},1024),u(o(we),{checked:l.addingConnection.selectedScopeIds.includes(d.key),onChange:e=>I(d.key,e)},null,8,["checked","onChange"])]),_:2},1024))),128)),l.addingConnection.connector.auth.params?.length?(p(),k(J,{key:0,tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":b,"onUpdate:uploadedFiles":L,onTokenChange:m},null,8,["tokens","token-values","uploaded-files"])):F("",!0)]),_:1})],64)):F("",!0),l.addingConnection.connector.auth.type==="tokens"?(p(),T(N,{key:1},[u(o(D),null,{default:s(()=>[w(C(o(y).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),u(J,{tokens:l.addingConnection.connector.auth.tokens,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":b,"onUpdate:uploadedFiles":L,onTokenChange:m},null,8,["tokens","token-values","uploaded-files"])],64)):F("",!0),l.addingConnection.connector.auth.type==="ecdsa"?(p(),T(N,{key:2},[l.ecdsaPublicKey?(p(),k(o(x),{key:1,vertical:"",gap:"16"},{default:s(()=>[u(o(V),{strong:""},{default:s(()=>[w(C(o(y).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),u(o(V),{strong:""},{default:s(()=>[w(C(o(y).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),u(o(te),{value:l.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),u(J,{tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":b,"onUpdate:uploadedFiles":L,onTokenChange:m},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(p(),T(N,{key:0},[u(o(D),null,{default:s(()=>[w(C(o(y).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),u(o(x),{vertical:"",gap:"16"},{default:s(()=>[u(W,{loading:l.ecdsaKeyLoading,onClick:f},{default:s(()=>[w(C(o(y).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):F("",!0)],64)):F("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),pt=M({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{},isBeta:{type:Boolean}},setup(l){return(n,i)=>(p(),k(o(oe),{class:be({"connector-card":!0,unavailable:l.unavailable})},{default:s(()=>[u(o(x),{style:{width:"100%"},vertical:"",gap:12},{default:s(()=>[u(o(x),{justify:"space-between"},{default:s(()=>[u(o(ae),{src:l.logoUrl,shape:"square",size:"large"},null,8,["src"]),u(o(x),{gap:8},{default:s(()=>[l.isBeta?(p(),k(o(X),{key:0,color:"orange",style:{height:"fit-content"}},{default:s(()=>[...i[0]||(i[0]=[w("BETA",-1)])]),_:1})):F("",!0),l.unavailable?(p(),k(o(X),{key:1,style:{height:"fit-content"}},{default:s(()=>[w(C(o(y).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):F("",!0)]),_:1})]),_:1}),u(o(x),{vertical:""},{default:s(()=>[u(o(V),{strong:""},{default:s(()=>[w(C(l.title),1)]),_:1}),u(o(V),{type:"secondary"},{default:s(()=>[w(C(l.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}}),ht=ne(pt,[["__scopeId","data-v-86187920"]]),gt={class:"connectors-grid"},mt=M({__name:"ConnectorsView",setup(l){const i=Ce().params.projectId,a=new st(i,new Te),r=$(null),_=$(!1),E=$({}),I=$(!1),f=K(()=>[...a.state.value.connectors.filter(h=>h.auth.type==="oauth2"),...a.state.value.connectors.filter(h=>h.auth.type==="tokens"),...a.state.value.connectors.filter(h=>h.auth.type==="ecdsa"),...a.state.value.connectors.filter(h=>h.auth.type==="manual")]),b=$(""),L=K(()=>{if(!b.value.trim())return f.value;const h=b.value.trim().toLowerCase();return f.value.filter(g=>{const v=g.metadata.label?.toLowerCase()||"",S=g.metadata.key?.toLowerCase()||"";return v.includes(h)||S.includes(h)})}),m=K(()=>a.state.value.connections.filter(h=>h&&h.name&&h.connectorTitle&&h.connectorType));a.fetchInitialState();function U(h){return a.state.value.connectors.find(g=>g.metadata.key===h.connectorType)}function P(h){a.state.value.addingConnection&&(a.state.value.addingConnection.tokenValues=h)}function d(h){E.value=h}function e(){r.value=null,_.value=!1,E.value={}}async function t(){_.value=!0;try{const g=(await a.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");r.value=g}finally{_.value=!1}}async function c(){const h=a.state.value.addingConnection?.connector.auth.type;I.value=!0;try{switch(h){case"oauth2":return await a.handleAddConnectionSubmit();case"tokens":return await a.handleAddTokenConnectionSubmit();case"ecdsa":{const g=a.state.value.addingConnection?.tokenValues||{},v=a.state.value.addingConnection?.connector.metadata.key;let S="";v==="starkbank"?S=g.projectId||"":v==="iugu"&&(S=g.apiToken||"");const R=await a.handleAddEcdsaConnectionSubmit(r.value,S);return e(),R}default:break}}catch(g){const v=S=>{try{return JSON.parse(S),!0}catch{return!1}};if(g instanceof Error&&v(g.message)){const S=ee.object({error:ee.string()}).safeParse(JSON.parse(g.message));if(S.success){G.error(S.data.error);return}else{G.error(y.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:g instanceof Error?g.message:"Unknown error"}));return}}else G.error(y.translate("i18n_connectorsview_failed_to_create"))}finally{I.value=!1}}function A(h){h.auth.type==="manual"?Ie.showNewMessage(y.translate("i18n_connectors_ask_for_access",null,h.metadata.label)):a.showAddConfirmationModal(h)}return(h,g)=>(p(),T(N,null,[u(o(Ne),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:s(()=>[u(o(x),{align:"center",justify:"space-between"},{default:s(()=>[u(o(O),null,{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),u(o(D),null,{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_description"))+" ",1),u(le)]),_:1}),m.value.length?(p(),k(o(x),{key:0,vertical:""},{default:s(()=>[u(o(O),{level:2},{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_installed")),1)]),_:1}),u(o(x),{vertical:"",gap:10},{default:s(()=>[(p(!0),T(N,null,B(m.value,v=>(p(),k(o(oe),{key:v.name},{default:s(()=>[u(o(x),{align:"center",gap:20},{default:s(()=>[u(o(ae),{src:v.icon,height:"40px",shape:"square"},null,8,["src"]),u(o(V),{strong:""},{default:s(()=>[w(C(v.connectorTitle),1)]),_:2},1024),g[6]||(g[6]=j("div",{style:{"flex-grow":"1"}},null,-1)),u(o(V),{content:v.name,copyable:"",code:""},null,8,["content"]),u(o(_e),null,{overlay:s(()=>[u(o(Ee),null,{default:s(()=>[(p(!0),T(N,null,B(U(v)?.metadata?.postConnectionSetup||[],S=>(p(),k(o(Z),{key:S.type,onClick:R=>o(a).handlePostConnectionSetup(v,S)},{default:s(()=>[w(C(S.title),1)]),_:2},1032,["onClick"]))),128)),u(o(Z),{onClick:S=>o(a).handleEditConnectionClick(v)},{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_rename")),1)]),_:1},8,["onClick"]),u(o(Z),{danger:"",onClick:S=>o(a).handleDeletionClick(v)},{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[u(o(Se))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):F("",!0),u(o(x),{vertical:""},{default:s(()=>[m.value.length?(p(),k(o(O),{key:0,level:2},{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_available")),1)]),_:1})):F("",!0),u(o(Ae),{value:b.value,"onUpdate:value":g[0]||(g[0]=v=>b.value=v),placeholder:o(y).translate("i18n_connectorsview_search_placeholder"),style:{width:"300px","margin-bottom":"40px"}},null,8,["value","placeholder"]),j("div",gt,[(p(!0),T(N,null,B(L.value,v=>(p(),k(ht,{key:v.metadata.key,title:v.metadata.label,"logo-url":v.metadata.logoUrl,description:v.metadata.description,unavailable:v.auth.type==="manual",connector:v,"is-beta":o(a).state.value.betaStatus[v.metadata.key]??!1,onClick:S=>A(v)},null,8,["title","logo-url","description","unavailable","connector","is-beta","onClick"]))),128))])]),_:1})]),_:1}),u(o(H),{open:!!o(a).state.value.editingConnection,title:o(a).state.value.editingConnection?o(y).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:o(a).state.value.editingConnection.connectorTitle}):"",onCancel:g[3]||(g[3]=v=>o(a).state.value.editingConnection=null)},{footer:s(()=>[u(o(x),{justify:"end"},{default:s(()=>[u(W,{disabled:!o(a).hasChanges.value,onClick:g[2]||(g[2]=v=>o(a).renameConnection())},{default:s(()=>[w(C(o(y).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:s(()=>[o(a).state.value.editingConnection?(p(),k(o(te),{key:0,value:o(a).state.value.editingConnection.newName,"onUpdate:value":g[1]||(g[1]=v=>o(a).state.value.editingConnection.newName=v)},null,8,["value"])):F("",!0)]),_:1},8,["open","title"]),u(dt,{"adding-connection":o(a).state.value.addingConnection,"ecdsa-public-key":r.value,"ecdsa-key-loading":_.value,"uploaded-files":E.value,loading:I.value,onCancel:g[4]||(g[4]=()=>{o(a).state.value.addingConnection=null,e()}),onSubmit:c,onScopeToggle:g[5]||(g[5]=(v,S)=>o(a).handleScopeToggle(v,S)),onGenerateEcdsaKey:t,"onUpdate:tokenValues":P,"onUpdate:uploadedFiles":d},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}}),xt=ne(mt,[["__scopeId","data-v-e4dc393a"]]);export{xt as default};
//# sourceMappingURL=ConnectorsView-DHQKLyZA.js.map

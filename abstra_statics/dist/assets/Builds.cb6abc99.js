import{r as N}from"./router.4c31abb0.js";import{d as j,eA as R,b as d,c as m,w as o,f as l,u as t,bE as T,bh as P,bf as $,e as F,I as v,ar as u,cE as x,eD as p,ex as I,ev as M,cm as q,eB as H,o as Y,L as Q,r as U,H as G,aD as J,eP as K,aH as O,bg as W,v as X}from"./outputWidgets.763535ec.js";import{a as D}from"./asyncComputed.c1b5752d.js";import{B as Z,a as ee}from"./build.bbf295c3.js";import"./index.e272e65d.js";import{P as te}from"./project.e03fe7eb.js";import{C as ae}from"./CrudView.0261ff81.js";import{V,l as oe,f as le,j as se,h as ne,R as re,Y as ie}from"./icons.39d7577b.js";import{A as f}from"./Text.1de1f1d2.js";import{a as ue,A as de}from"./index.19e9c099.js";import{g as ce}from"./datetime.6fc2aad4.js";import{M as pe}from"./Modal.33014e22.js";import"./Form.93c1d68a.js";import"./hasIn.c3ad9d17.js";import"./popupNotifcation.59a7179b.js";import"./index.cf4c23b9.js";import"./record.ae98c277.js";import"./pubsub.e128dec2.js";import"./Paragraph.1d14da40.js";import"./Base.0423a633.js";import"./Typography.3b9809ab.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.0d674672.js";import"./url.0280fc81.js";import"./index.5c5eefcc.js";import"./Title.b6a28a5f.js";import"./index.351b265c.js";import"./SyncOutlined.cf45cade.js";(function(){try{var g=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h=new Error().stack;h&&(g._sentryDebugIds=g._sentryDebugIds||{},g._sentryDebugIds[h]="0a42696a-82f8-474d-9e67-0f9a868f50ae",g._sentryDebugIdIdentifier="sentry-dbid-0a42696a-82f8-474d-9e67-0f9a868f50ae")}catch{}})();const ge={style:{display:"flex","align-items":"center",gap:"5px"}},fe={key:1},me=j({__name:"BuildInspector",props:{buildSpec:{}},setup(g){const h=g,y=R(),C=i=>{y.push({name:"logs",params:{projectId:h.buildSpec.projectId},query:i.logQuery})};return(i,B)=>i.buildSpec.runtimes.length>0?(d(),m(t(de),{key:0,"item-layout":"horizontal","data-source":i.buildSpec.runtimes},{renderItem:o(({item:n})=>[l(t(ue),null,{actions:o(()=>[l(t(T),null,{overlay:o(()=>[l(t(P),null,{default:o(()=>[l(t($),{onClick:c=>C(n)},{default:o(()=>[F("div",ge,[l(v,{path:t(V)},null,8,["path"]),l(t(f),null,{default:o(()=>[u(" View Logs")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[l(v,{path:t(oe),style:{cursor:"pointer"}},null,8,["path"])]),_:2},1024)]),default:o(()=>[n.type=="form"?(d(),m(t(x),{key:0,size:"large"},{default:o(()=>[l(v,{path:t(le)},null,8,["path"]),l(t(f),{strong:""},{default:o(()=>[u(p(n.title),1)]),_:2},1024),l(t(f),{type:"secondary",code:""},{default:o(()=>[u("/"+p(n.path),1)]),_:2},1024)]),_:2},1024)):I("",!0),n.type=="job"?(d(),m(t(x),{key:1,size:"large"},{default:o(()=>[l(v,{path:t(se)},null,8,["path"]),l(t(f),{strong:""},{default:o(()=>[u(p(n.title),1)]),_:2},1024),l(t(f),{type:"secondary",code:""},{default:o(()=>[u(p(n.schedule),1)]),_:2},1024)]),_:2},1024)):I("",!0),n.type=="hook"?(d(),m(t(x),{key:2,size:"large"},{default:o(()=>[l(v,{path:t(ne)},null,8,["path"]),l(t(f),{strong:""},{default:o(()=>[u(p(n.title),1)]),_:2},1024),l(t(f),{type:"secondary",code:""},{default:o(()=>[u("/_hooks/"+p(n.path),1)]),_:2},1024)]),_:2},1024)):I("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(d(),M("div",fe,[l(t(q),{description:"No runtimes found. Make sure your project has forms, hooks or jobs before deploying it"})]))}}),ye=j({__name:"Builds",setup(g){const y=H().params.projectId,{loading:C,result:i,refetch:B}=D(async()=>{const[e,a]=await Promise.all([Z.list(y),te.getStatus(y)]);return{b:e.map(r=>({build:r,status:a.filter(b=>b.buildId==r.id).map(b=>b.status)})),status:a}});let n;Y(()=>{n=setInterval(B,1e4)}),Q(()=>{clearInterval(n)});const c=U(null),_=D(async()=>c.value?await ee.get(c.value):null),L=()=>{var s;const e=(s=i.value)==null?void 0:s.b.find(r=>r.build.id===c.value);return`Build ${e==null?void 0:e.build.id.slice(0,8)} - ${e==null?void 0:e.build.createdAt.toLocaleString()}`},w=[{text:"Deploying",tagColor:"blue",check:e=>{var a,s;return(s=e.build.latest&&e.status.some(r=>r=="Running")&&((a=i.value)==null?void 0:a.status.some(r=>r.buildId!==e.build.id)))!=null?s:!1},loading:!0},{text:"Deactivating",tagColor:"orange",check:e=>e.build.status==="success"&&!e.build.latest&&e.status.some(a=>a=="Running"),loading:!0},{text:"LIVE",tagColor:"green",check:e=>e.build.latest&&e.status.some(a=>a=="Running")},{text:"Sleeping",tagColor:"blue",check:e=>e.build.latest&&e.status.length===0},{text:"Failed",tagColor:"orange",check:e=>e.build.latest&&e.status.some(a=>a=="Failed")},{text:"Inactive",tagColor:"lightgray",check:e=>e.build.status==="success"},{text:"Aborted",tagColor:"orange",check:e=>e.build.status==="aborted"||e.build.status==="aborted-by-user"},{text:"Failed",tagColor:"orange",check:e=>e.build.status==="failure"},{text:"In progress",tagColor:"red",check:e=>e.build.status==="in-progress",loading:!0},{text:"Pending",tagColor:"yellow",check:e=>e.build.status==="pending"}];function E(e){var a,s,r,b,S,A;return{text:(s=(a=w.find(k=>k.check(e)))==null?void 0:a.text)!=null?s:"unknown",tagColor:(b=(r=w.find(k=>k.check(e)))==null?void 0:r.tagColor)!=null?b:"lightgray",loading:(A=(S=w.find(k=>k.check(e)))==null?void 0:S.loading)!=null?A:!1}}const z=G(()=>{const e=[{name:"Id"},{name:"Date"},{name:"Status"},{name:"",align:"right"}];return i.value?{columns:e,rows:i.value.b.map(a=>{var s;return{key:a.build.id,cells:[{type:"text",text:a.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:ce(a.build.createdAt,{weekday:void 0}),distance:K(a.build.createdAt)}},{type:"tag",...E(a),hover:(s=a.build.log)!=null?s:void 0},{type:"actions",actions:[{icon:re,label:"Inspect build",onClick:async()=>{c.value=a.build.id,_.refetch()}},{icon:V,label:"View application logs",onClick:()=>N.push({name:"logs",params:{projectId:y},query:{buildId:a.build.id}})},{icon:ie,label:"Download files",onClick:()=>a.build.download()}]}]}})}:{columns:e,rows:[]}});return(e,a)=>(d(),M(J,null,[l(ae,{"entity-name":"build",loading:t(C),title:"Builds",description:"Each build is a version of your app. You can create a new build by deploying your app from the local editor.","empty-title":"No builds here yet",table:z.value,live:""},{date:o(({payload:s})=>[l(t(O),null,{title:o(()=>[u(p(s.distance),1)]),default:o(()=>[u(p(s.date)+" ",1)]),_:2},1024)]),_:1},8,["loading","table"]),c.value?(d(),m(t(pe),{key:0,footer:null,open:!!c.value,size:"large",width:"80%",title:L(),onCancel:a[0]||(a[0]=s=>c.value=null)},{default:o(()=>[!t(_).result.value||t(_).loading.value?(d(),m(t(W),{key:0})):t(_).result.value?(d(),m(me,{key:1,"build-spec":t(_).result.value},null,8,["build-spec"])):I("",!0)]),_:1},8,["open","title"])):I("",!0)],64))}});const Ye=X(ye,[["__scopeId","data-v-f384bc75"]]);export{Ye as default};
//# sourceMappingURL=Builds.cb6abc99.js.map

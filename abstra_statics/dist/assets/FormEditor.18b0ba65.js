import{R as re,F as oe,r as z}from"./FormRunner.7015d146.js";import{d as q,r as A,G as S,b as c,c as g,w as r,aq as d,eD as $,f as t,u as e,bU as D,cA as J,F as le,H as X,eA as Z,ew as P,eu as j,eC as ne,cE as se,bN as _,a_ as ue,bu as ie,e as de,bO as H,eB as pe,eG as me}from"./outputWidgets.e4740a46.js";import{R as ce,_ as fe,S as ve,L as ge}from"./RuntimeCommonSettings.8a3bae3c.js";import{B as ye}from"./BaseLayout.227f899b.js";import{a as ee}from"./asyncComputed.d2f778f6.js";import{F as he}from"./forms.a5e4c16b.js";import{W as te}from"./workspaces.1725ced2.js";import{_ as be}from"./SaveButton.vue_vue_type_script_setup_true_lang.4e96967f.js";import{l as K,_ as _e}from"./DocsButton.vue_vue_type_script_setup_true_lang.1fbece15.js";import{A as Y}from"./index.33455d5e.js";import{C as we,A as ke}from"./CollapsePanel.4be1dab4.js";import{a as I}from"./Text.27a734ce.js";import{A as f,F as ae}from"./Base.242f9d87.js";import{A as Se}from"./index.c445bb3f.js";import{A as xe}from"./index.4f0fd1e2.js";import{A as C}from"./Title.8b2b3cfc.js";import{A as O,T as Pe}from"./TabPane.e64e881a.js";import"./index.bb244717.js";import{c as Ae}from"./index.de07fc0e.js";import"./url.13324fb6.js";import"./index.6dd80dd4.js";import"./pubsub.5fca0d09.js";import"./icons.1f2085e1.js";import"./CircularLoading.b9799d00.js";import"./PlayerNavbar.8b3747b5.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.daa991a8.js";import"./WidgetsFrame.3bc15b0d.js";import"./uuid.dc045fd8.js";import"./jobs.3b2a3955.js";import"./record.69f74dba.js";import"./ant-design.6e7474f5.js";import"./transButton.237bb9ef.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[v]="e1415de8-1e34-4b0a-ab98-eb34b49326d9",y._sentryDebugIdIdentifier="sentry-dbid-e1415de8-1e34-4b0a-ab98-eb34b49326d9")}catch{}})();const Re=q({__name:"LaunchButton",props:{path:{}},setup(y){const v=y,a=A({state:"loading"}),p=S(()=>a.value.state!=="found"),o=S(()=>a.value.state==="loading"),s=S(()=>a.value.state==="found"?a.value.url:void 0),l=S(()=>{switch(a.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${a.value}`)}}),U=S(()=>{switch(a.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${a.value}`)}});async function k(m){const i=`https://${m}.abstra.app/_version`;return(await fetch(i)).ok}async function R(m){const i=`https://${m}.abstra.app/_pages/${v.path}`;return(await fetch(i)).ok}async function T(){if(!(await K.get()).logged){a.value={state:"not-logged"};return}const i=await K.getProjectInfo().catch(()=>null);if(!i){a.value={state:"error"};return}if(!await k(i.subdomain).catch(()=>null)){a.value={state:"not-deployed"};return}if(!await R(i.subdomain).catch(()=>null)){a.value={state:"not-found"};return}const F=`https://${i.subdomain}.abstra.app/${v.path}`;a.value={state:"found",url:F}}return T(),(m,i)=>(c(),g(e(J),{title:l.value},{content:r(()=>[d($(U.value),1)]),default:r(()=>[t(e(D),{href:s.value,target:"_blank",disabled:p.value,loading:o.value},{default:r(()=>[d("Launch last deploy")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Te=de("p",{style:{width:"200px"}}," Add query params to simulate someone using your forms with specific data in the URL. ",-1),Ue={key:2,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},B="abstra-run-id",Ce=q({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(y,{expose:v,emit:a}){var Q,V,G,W;const p=y,o=A(void 0);function s(){o.value=o.value?void 0:"query-params"}const l=le({queryParams:[],url:`${p.form.path}`,stageRunId:null}),U=n=>{l.stageRunId=n},{result:k,loading:R}=ee(()=>te.get()),T=()=>{l.queryParams.push({name:"",value:""})},m=n=>{l.queryParams=l.queryParams.filter((w,u)=>u!==n)};X([()=>l.stageRunId,()=>l.queryParams],([n,w])=>{const u=w.find(h=>h.name===B);if(console.log(n,u),n&&!u){l.queryParams.push({name:B,value:n});return}if(!n&&u){l.queryParams=l.queryParams.filter(h=>h.name!==B);return}n&&u&&n!==u.value&&(u.value=n)});const i=S(()=>re.create(p.form.id));(Q=i.value)==null||Q.on("stdout",n=>{p.logService.log({type:"stdout",log:n.log})}),(V=i.value)==null||V.on("stderr",n=>{p.logService.log({type:"stderr",log:n.log})}),(G=i.value)==null||G.onClose(()=>{p.logService.log({type:"stderr",log:"Program closed"})}),(W=i.value)==null||W.on("files:changed",()=>{p.logService.log({type:"files-changed",log:"Files changed"})});const b=Z(),E=({path:n})=>{z("editor",b,n)};function F(n,w){a("redirect",n,w)}const M=A(null);async function N(){var n;return p.logService.log({type:"restart"}),(n=M.value)==null?void 0:n.run()}const L=S(()=>{const n=new URLSearchParams(l.queryParams.filter(u=>u.name.trim()).reduce((u,h)=>({...u,[h.name]:h.value}),{})).toString();return{subdomain:"[your-subdomain]",path:p.form.path,query:n}});return v({restart:N}),(n,w)=>(c(),g(e(ae),{layout:"vertical"},{default:r(()=>[P("",!0),t(e(f),{label:"Testing URL"},{default:r(()=>[t(e(Y),{gap:0,style:{overflow:"hidden"}},{default:r(()=>[d(" https:// "),t(e(I),{style:{"margin-right":"0"}},{default:r(()=>[d($(L.value.subdomain),1)]),_:1}),d(" .abstra.app/ "),t(e(I),{style:{"margin-right":"0","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis"}},{default:r(()=>[d($(L.value.path),1)]),_:1}),t(e(Y),null,{default:r(()=>[d(" ? "),t(e(J),{title:"Query params"},{content:r(()=>[Te]),default:r(()=>[t(e(I),{style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer"},onClick:s},{default:r(()=>[d($(L.value.query||"[ ... ]"),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(f),null,{default:r(()=>[t(e(we),{"active-key":o.value,"onUpdate:activeKey":w[1]||(w[1]=u=>o.value=u),ghost:""},{default:r(()=>[t(e(ke),{key:"query-params",header:`Query Params (${l.queryParams.length})`},{default:r(()=>[(c(!0),j(ue,null,ne(l.queryParams,(u,h)=>(c(),g(e(f),{key:h},{default:r(()=>[t(e(se),null,{default:r(()=>[t(e(_),{value:u.name,"onUpdate:value":x=>u.name=x,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(_),{value:u.value,"onUpdate:value":x=>u.value=x,type:"text",placeholder:"value",disabled:u.name===B},null,8,["value","onUpdate:value","disabled"]),t(e(D),{danger:"",onClick:x=>m(h)},{default:r(()=>[d("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(f),null,{default:r(()=>[t(e(D),{type:"dashed",style:{width:"100%"},onClick:T},{default:r(()=>[d("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1},8,["active-key"])]),_:1})]),_:1}),t(e(Se),{orientation:"left"},{default:r(()=>[d("Quick Preview")]),_:1}),e(R)||!e(k)?(c(),g(e(ie),{key:1})):l.stageRunId||p.form.isInitial?(c(),j("div",Ue,[t(oe,{ref_key:"runner",ref:M,form:n.form.makeRunnerData(e(k)),params:{...l.queryParams.reduce((u,{name:h,value:x})=>({...u,[h]:x}),{})},"is-preview":"","enable-auto-focus":"",broker:i.value,onNavigate:E,onRedirect:F,onLogout:N},null,8,["form","params","broker"])])):(c(),g(e(xe),{key:3,message:"This form is an intermediate task within the workflow. Please select a task instance to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}}),Be=q({__name:"FormSettings",props:{form:{}},setup(y){const a=A(y.form);return(p,o)=>(c(),g(e(ae),{layout:"vertical"},{default:r(()=>[t(ce,{runtime:a.value},null,8,["runtime"]),t(e(f),{label:"Form name"},{default:r(()=>[t(e(_),{type:"text",onChange:o[0]||(o[0]=s=>{var l;return a.value.title=(l=s.target.value)!=null?l:""})})]),_:1}),t(e(C),{level:3},{default:r(()=>[d(" Texts ")]),_:1}),t(e(C),{level:4},{default:r(()=>[d(" Welcome Screen ")]),_:1}),t(e(f),{label:"Title"},{default:r(()=>[t(e(_),{value:a.value.welcomeTitle,"onUpdate:value":o[1]||(o[1]=s=>a.value.welcomeTitle=s),type:"text",placeholder:a.value.title,disabled:a.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),t(e(f),{label:"Description"},{default:r(()=>[t(e(_),{value:a.value.startMessage,"onUpdate:value":o[2]||(o[2]=s=>a.value.startMessage=s),type:"text",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(f),{label:"Start button label"},{default:r(()=>[t(e(_),{value:a.value.startButtonText,"onUpdate:value":o[3]||(o[3]=s=>a.value.startButtonText=s),type:"text",placeholder:"Start",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(f),null,{default:r(()=>[t(e(H),{checked:a.value.autoStart,"onUpdate:checked":o[4]||(o[4]=s=>a.value.autoStart=s)},{default:r(()=>[d("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),t(e(C),{level:4},{default:r(()=>[d(" End Screen ")]),_:1}),t(e(f),{label:"End text"},{default:r(()=>[t(e(_),{value:a.value.endMessage,"onUpdate:value":o[5]||(o[5]=s=>a.value.endMessage=s),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),t(e(f),{label:"Restart button label"},{default:r(()=>[t(e(_),{value:a.value.restartButtonText,"onUpdate:value":o[6]||(o[6]=s=>a.value.restartButtonText=s),placeholder:"Restart",type:"text",disabled:!a.value.allowRestart},null,8,["value","disabled"])]),_:1}),t(e(f),null,{default:r(()=>[t(e(H),{checked:a.value.allowRestart,"onUpdate:checked":o[7]||(o[7]=s=>a.value.allowRestart=s)},{default:r(()=>[d("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),t(e(C),{level:4},{default:r(()=>[d(" Alert Messages ")]),_:1}),t(e(f),{label:"Error message"},{default:r(()=>[t(e(_),{value:a.value.errorMessage,"onUpdate:value":o[8]||(o[8]=s=>a.value.errorMessage=s),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),dt=q({__name:"FormEditor",setup(y){const v=Z(),a=pe(),p=A(null),o=A("test");function s(){v.push({name:"forms"})}const{result:l,refetch:U}=ee(()=>Promise.all([te.get(),he.get(a.params.id)]).then(([m,i])=>me({workspace:m,form:i}))),k=ge.create();function R(m,i){z("editor",v,m,i)}const T=()=>{var m;v.push({name:"formPreview",query:a.query,params:{id:(m=l.value)==null?void 0:m.form.id}})};return X(()=>a.params.id,()=>{U()}),(m,i)=>(c(),g(ye,null,{navbar:r(()=>[e(l)?(c(),g(e(Ae),{key:0,title:e(l).form.title,style:{padding:"5px 10px"},onBack:s},{footer:r(()=>[t(e(Pe),{"active-key":o.value,"onUpdate:activeKey":i[0]||(i[0]=b=>o.value=b)},{default:r(()=>[t(e(O),{key:"test",tab:"Test"}),t(e(O),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:r(()=>[t(fe),t(Re,{path:e(l).form.path},null,8,["path"]),t(_e,{path:"forms/overview"}),t(e(D),{onClick:T},{default:r(()=>[d("Preview")]),_:1}),o.value==="settings"?(c(),g(be,{key:0,model:e(l).form},null,8,["model"])):P("",!0)]),_:1},8,["title"])):P("",!0)]),content:r(()=>[e(l)&&o.value==="test"?(c(),g(Ce,{key:0,ref_key:"tester",ref:p,form:e(l).form,"log-service":e(k),onRedirect:R},null,8,["form","log-service"])):P("",!0),e(l)&&o.value==="settings"?(c(),g(Be,{key:1,form:e(l).form},null,8,["form"])):P("",!0)]),footer:r(()=>{var b;return[e(l)&&o.value==="test"?(c(),g(ve,{key:0,runtime:"forms","log-service":e(k),onRestart:(b=p.value)==null?void 0:b.restart},null,8,["log-service","onRestart"])):P("",!0)]}),_:1}))}});export{dt as default};
//# sourceMappingURL=FormEditor.18b0ba65.js.map

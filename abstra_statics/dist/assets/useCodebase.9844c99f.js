var S=Object.defineProperty;var R=(a,e,t)=>e in a?S(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var g=(a,e,t)=>(R(a,typeof e!="symbol"?e+"":e,t),t);import{A as _,a as L,b as T,c as I,d as P,e as U,f as $,g as D}from"./linters.5b6fa69e.js";import{f as l,g as p}from"./index.4ef30962.js";import{i as z}from"./files.b84db56d.js";import{W as M}from"./workspaces.e2e213cb.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="202055a8-b1bb-48a3-9a0e-53bef6fe067e",a._sentryDebugIdIdentifier="sentry-dbid-202055a8-b1bb-48a3-9a0e-53bef6fe067e")}catch{}})();class K{async list(){const t=await(await fetch("/_editor/api/codebase/files")).json();return _.parse(t)}async create(e,t){const s=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"POST",body:t})).json();return L.parse(s)}async delete(e){const n=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();return T.parse(n)}async update(e,t){const s=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"PUT",body:t})).json();return I.parse(s)}async retrieve(e){const n=await(await fetch(`/_editor/api/codebase/files/${e}`)).arrayBuffer();return new Uint8Array(n)}async rename(e,t){const n=P.parse({pathParts:e,newPathParts:t}),c=await(await fetch("/_editor/api/codebase/files/rename",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();return U.parse(c)}async mkdir(e){const n=await(await fetch(`/_editor/api/codebase/dir/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();return $.parse(n)}async settings(){const t=await(await fetch("/_editor/api/codebase/settings")).json();return D.parse(t)}}const N=a=>{switch(a){case"abap":return"abap";case"apex":return"apex";case"azcli":return"azcli";case"bat":return"bat";case"bicep":return"bicep";case"c":return"c";case"cameligo":return"cameligo";case"clojure":return"clojure";case"coffeescript":return"coffeescript";case"cpp":return"cpp";case"csharp":return"csharp";case"csp":return"csp";case"css":return"css";case"cypher":return"cypher";case"dart":return"dart";case"dockerfile":return"dockerfile";case"ecl":return"ecl";case"elixir":return"elixir";case"flow9":return"flow9";case"freemarker2":return"freemarker2";case"freemarker2.tag-angle.interpolation-bracket":return"freemarker2.tag-angle.interpolation-bracket";case"freemarker2.tag-angle.interpolation-dollar":return"freemarker2.tag-angle.interpolation-dollar";case"freemarker2.tag-auto.interpolation-bracket":return"freemarker2.tag-auto.interpolation-bracket";case"freemarker2.tag-auto.interpolation-dollar":return"freemarker2.tag-auto.interpolation-dollar";case"freemarker2.tag-bracket.interpolation-bracket":return"freemarker2.tag-bracket.interpolation-bracket";case"freemarker2.tag-bracket.interpolation-dollar":return"freemarker2.tag-bracket.interpolation-dollar";case"fsharp":return"fsharp";case"go":return"go";case"graphql":return"graphql";case"handlebars":return"handlebars";case"hcl":return"hcl";case"html":return"html";case"ini":return"ini";case"java":return"java";case"javascript":return"javascript";case"json":return"json";case"julia":return"julia";case"kotlin":return"kotlin";case"less":return"less";case"lexon":return"lexon";case"liquid":return"liquid";case"lua":return"lua";case"m3":return"m3";case"markdown":return"markdown";case"mdx":return"mdx";case"mips":return"mips";case"msdax":return"msdax";case"mysql":return"mysql";case"objective-c":return"objective-c";case"pascal":return"pascal";case"pascaligo":return"pascaligo";case"perl":return"perl";case"pgsql":return"pgsql";case"php":return"php";case"pla":return"pla";case"plaintext":return"plaintext";case"postiats":return"postiats";case"powerquery":return"powerquery";case"powershell":return"powershell";case"proto":return"proto";case"pug":return"pug";case"python":return"python";case"qsharp":return"qsharp";case"r":return"r";case"razor":return"razor";case"redis":return"redis";case"redshift":return"redshift";case"restructuredtext":return"restructuredtext";case"ruby":return"ruby";case"rust":return"rust";case"sb":return"sb";case"scala":return"scala";case"scheme":return"scheme";case"scss":return"scss";case"shell":return"shell";case"sol":return"sol";case"sparql":return"sparql";case"sql":return"sql";case"st":return"st";case"swift":return"swift";case"systemverilog":return"systemverilog";case"tcl":return"tcl";case"twig":return"twig";case"typescript":return"typescript";case"typespec":return"typespec";case"vb":return"vb";case"verilog":return"verilog";case"xml":return"xml";case"yaml":return"yaml";default:return"plaintext"}};class O{constructor(e,t,n,s){g(this,"initialContent");this.fileNode=e,this.content=t,this.sep=n,this.onSave=s,this.initialContent=new Uint8Array(t)}get file(){return this.fileNode.pathParts.join(this.sep)}get codeContent(){return this.text}set codeContent(e){this.text=e}updateInitialState(e,t){this.initialContent=new TextEncoder().encode(t)}get text(){return new TextDecoder().decode(this.content)}set text(e){const t=new TextEncoder;this.content=t.encode(e)}get url(){return`/_editor/api/codebase/files/${this.file}`}hasChanges(){return this.content.length!==this.initialContent.length||!this.content.every((e,t)=>e===this.initialContent[t])}async save(){await this.onSave(this),this.initialContent=new Uint8Array(this.content)}isImage(){return z(this.file)}isText(){return!this.isImage()}}const Q=a=>{const e=l([]),t=l(!1),n=l(null),s=l({separator:"/"}),c=async()=>{t.value=!0;try{e.value=await a.api.list()}finally{t.value=!1}},y=async()=>{s.value=await a.api.settings()},d=a.router.currentRoute.value.query.f,w=async(r,i)=>{const o=r.join(s.value.separator);await a.api.create(o,i),await c()},v=async r=>{const i=r.join(s.value.separator);await a.api.delete(i),await c()},k=async(r,i)=>{await a.api.rename(r,i),await c()},f=async(r,i)=>{const o=r.join(s.value.separator);await a.api.update(o,i)},j=async r=>{const i=r.join(s.value.separator);return a.api.retrieve(i)},x=async r=>{const i=r.join(s.value.separator);await a.api.mkdir(i),await c()},E=r=>{switch(r.type){case"form":return{name:"formEditor",params:{id:r.id}};case"hook":return{name:"hookEditor",params:{id:r.id}};case"job":return{name:"jobEditor",params:{id:r.id}};case"script":return{name:"scriptEditor",params:{id:r.id}};default:throw new Error(`Unknown stage type: ${r.type}`)}},h=async r=>{var b;const i=r.join(s.value.separator),o=e.value.find(u=>u.file.pathParts.join(s.value.separator)===i);if(!o)throw new Error(`File not found: ${i}`);if(o.file.type==="directory")n.value=null;else if(o.file.pathParts.length===1&&o.file.pathParts[0]==="requirements.txt")a.router.push({name:"settingsRequirements"});else if(o.file.pathParts.length===1&&o.file.pathParts[0]===".env")a.router.push({name:"env-vars"});else if(!o.stages||o.stages.length===0)n.value=new O(o.file,await j(r),(b=s.value.separator)!=null?b:"/",({content:F})=>f(r,F)),new URL(window.location.href).searchParams.set("f",r.join(s.value.separator)),a.router.replace({query:{...a.router.currentRoute.value.query,f:r}});else if(o.stages.length===1){const u=o.stages[0];a.router.push(E(u))}},q=p(()=>e.value.map(({file:r})=>r)),A=p(()=>{var i;const r=(i=n.value)==null?void 0:i.file.split(".").pop();return r?N(r):"plaintext"}),C=p(()=>n.value?n.value:null),m=l(null);return M.get().then(r=>{m.value=r}),Promise.all([c(),y()]).then(()=>{typeof d=="string"&&h(d.split(s.value.separator))}),{files:q,loading:t,editing:n,language:A,settings:s,mkdir:x,fetchFiles:c,uploadFile:w,deleteFile:v,renameFile:k,editFile:f,open:h,sourceCodeEditable:C,workspaceModel:m,filesListResponse:e}};export{K as C,Q as u};
//# sourceMappingURL=useCodebase.9844c99f.js.map

import{d as D,v as le,K as O,H as ie,b as f,c as _,z as c,V as F,W as V,x as e,D as U,N as L,e as I,ab as ue,S as W,O as Y,Q as q,q as j,r as k,R as G,X as ce,o as Q,U as X,I as R,G as M,A as de,F as pe,L as me,a2 as he,J as ve,a as fe,t as ge,ac as ye}from"./registerWidgets.bb4c7eff.js";import{p as _e,q as z,r as H,t as N,v as we}from"./icons.e3de8035.js";import{a as K}from"./asyncComputed.0adffaf6.js";import{F as ke}from"./forms.f3239392.js";import{D as Ce}from"./dashes.04d6b828.js";import{H as be}from"./hooks.911e43af.js";import{J}from"./jobs.cb7d0efd.js";import{W as Se}from"./workspaces.4c177a35.js";import{l as r,u as $e}from"./log.6e68571d.js";import{L as Ie}from"./login.29b4c1f1.js";import{c as xe}from"./sentry.2692e5c6.js";const Z=o=>(Y("data-v-7d69f0ed"),o=o(),q(),o),Ee={class:"runtime-settings"},Re={key:0,class:"field"},Le=Z(()=>e("div",{class:"label"},"Path",-1)),Pe={class:"field"},Me=Z(()=>e("div",{class:"label"},"Code",-1)),Ue={class:"input-row"},De={key:1,class:"root-path loading"},Te={class:"path-feedback"},Ae={key:1,class:"error"},Be=D({__name:"RuntimeCommonSettings",props:{runtime:null},setup(o){const t=o,n=le({pathError:null}),{result:a}=K(()=>Se.get()),m=()=>{!a.value||!t.runtime.file||a.value.openFile(t.runtime.file)},w=O(()=>{var v;return(v=t.runtime.file)!=null&&v.endsWith(".py")?null:"It should be a .py file"}),h=()=>{!a.value||!C.value||a.value.openFile(".")},u=ie(),{result:C}=K(()=>fetch("/_editor/api/workspace/root-path").then(v=>v.text()));return t.runtime.onUpdate(()=>{if(!(t.runtime instanceof J))if(console.log("runtime updated",t.runtime.path),t.runtime instanceof ke)u.push({path:`/_editor/form/${encodeURIComponent(t.runtime.path)}`});else if(t.runtime instanceof be)u.push({path:`/_editor/hook/${encodeURIComponent(t.runtime.path)}`});else if(t.runtime instanceof Ce)u.push({path:`/_editor/dash/${encodeURIComponent(t.runtime.path)}`});else throw new Error(`Unknown runtime type ${t.runtime}`)}),(v,g)=>(f(),_("div",Ee,[o.runtime instanceof c(J)?U("",!0):(f(),_("div",Re,[Le,F(e("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.runtime.path=y),class:"path-input",type:"text"},null,512),[[V,o.runtime.path]])])),e("div",Pe,[Me,e("div",Ue,[c(C)?(f(),_("button",{key:0,class:"root-path",onClick:g[1]||(g[1]=y=>h())},L(c(C)),1)):(f(),_("span",De," Loading... ")),F(e("input",{"onUpdate:modelValue":g[2]||(g[2]=y=>o.runtime.file=y),type:"text"},null,512),[[V,o.runtime.file]]),e("button",{class:"open-file-icon",onClick:g[3]||(g[3]=y=>m())},[I(ue,{path:c(_e)},null,8,["path"]),W(" Open in editor ")])]),e("div",Te,L(c(w)),1)]),n.pathError?(f(),_("div",Ae,L(n.pathError),1)):U("",!0)]))}});const ct=j(Be,[["__scopeId","data-v-7d69f0ed"]]);class Fe{static async*sendMessage(t,n){var w;const m=(w=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,runtime:n})})).body)==null?void 0:w.getReader();if(!m)throw new Error("No response body");for(;;){const h=await m.read();if(h.done)break;yield new TextDecoder().decode(h.value)}}}const Ve=o=>(Y("data-v-3bda3e11"),o=o(),q(),o),ze={class:"smart-console"},He={class:"header"},Ne={class:"left"},Ke={class:"right"},Je={class:"cli"},Oe={class:"left"},We=Ve(()=>e("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Ye={key:1,class:"local-entry"},qe={class:"input"},je=["pointer-events","onKeydown"],Ge={class:"right"},Qe=D({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},dashPlayerState:null,formCode:null,runtime:null},emits:["clear-terminal","restart","enter"],setup(o,{emit:t}){const n=o,a=k(""),m=k(null),w=ve(),h=k(!1),u=k(!1),C=()=>{r.clear(),t("restart")},v=()=>{x.value=x.value==="assistant"?"debugger":"assistant"};function g(s){switch(s.type){case"ai-input":return{role:"user",content:s.log};case"ai-output":return{role:"assistant",content:s.log};case"stderr":case"stdout":return{role:"user",content:s.log};case"restart":return{role:"user",content:"-- new session --"};default:throw new Error(`Unknown log type: ${s.type}`)}}G(w,()=>{r.clear(),t("clear-terminal")});const y=k(null),x=k("assistant"),ee=async s=>{var l;if(s.preventDefault(),a.value=((l=y.value)==null?void 0:l.innerText)||"",s.shiftKey){document.execCommand("insertLineBreak");return}y.value&&(y.value.innerText=""),x.value==="assistant"?await te():await se()},te=async()=>{var l;if(t("enter",a.value),r.log({type:"ai-input",log:a.value}),a.value="",!u.value){r.log({type:"stderr",log:"Please login to use the AI assistant."});return}h.value=!0;const s={role:"user",content:(l=n.formCode)!=null?l:""};try{const p=$e();let i="";const S=Fe.sendMessage([s,...r.logs.map($=>g($)),{role:"user",content:a.value}],n.runtime);for await(const $ of S)i+=$,r.log({type:"ai-output",log:i},p)}catch(p){r.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(p),xe(p)}finally{h.value=!1}},se=async()=>{a.value&&(r.log({type:"eval-input",log:`>>> ${a.value}`}),oe(a.value),a.value="")},oe=s=>{var l,p,i;(i=(l=n.dashPlayerState)==null?void 0:l.broker)==null||i.send({type:"eval",expression:s,state:(p=n.dashPlayerState)==null?void 0:p.apiPageState})};(()=>{var s,l,p,i,S,$;(s=n.dashPlayerState)==null||s.on("eval-return",d=>{d.repr&&r.log({type:"eval-output",log:d.repr})}),(l=n.dashPlayerState)==null||l.on("eval-error",d=>{r.log({type:"eval-output",log:d.repr})}),(p=n.dashPlayerState)==null||p.on("stderr",d=>{r.log({type:"stderr",log:d.log})}),(i=n.dashPlayerState)==null||i.on("stdout",d=>{r.log({type:"stdout",log:d.log})}),(S=n.dashPlayerState)==null||S.on("widgets-computed",d=>{var E;(E=d.errors)!=null&&E.general&&r.log({type:"stderr",log:d.errors.general.repr})}),($=n.dashPlayerState)==null||$.on("program-start-failed",d=>{var E;r.log({type:"stderr",log:(E=d.error)!=null?E:""})})})();const ne=()=>{r.clear()};r.listen(async s=>{s.type!=="restart"&&(b.value=!0,await ce(),m.value&&(m.value.scrollTop=m.value.scrollHeight))});const b=k(!1),T=k(400),ae=O(()=>({height:`${T.value}px`})),P=k(!1),re=()=>P.value=!0,A=s=>{!P.value||(T.value=document.body.clientHeight-s.clientY)},B=()=>P.value=!1;return Q(()=>{document.addEventListener("mousemove",A),document.addEventListener("mouseup",B),Ie.get().then(s=>u.value=!!s)}),X(()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",B)}),(s,l)=>{const p=fe("Markdown");return f(),_("div",ze,[e("div",He,[e("div",Ne,[I(R,{path:x.value==="assistant"?c(z):c(H)},null,8,["path"]),W(" Smart Console ")]),e("div",Ke,[e("div",{class:"changes-container"},[e("button",{class:"header-button",onClick:C},"Restart")]),e("div",{class:"toggle-button",onClick:l[0]||(l[0]=i=>b.value=!b.value)},[I(R,{class:M(["icon",{open:b.value}]),path:c(N),fill:"#fff"},null,8,["class","path"])])])]),b.value?(f(),_("div",{key:0,class:"terminal",style:de(c(ae))},[e("div",{class:"resize-handler",onMousedown:re},null,32),e("div",Je,[e("div",Oe,[e("div",{ref_key:"entriesContainer",ref:m,class:"entries"},[We,(f(!0),_(pe,null,me(c(r).logs,(i,S)=>(f(),_("div",{key:S,class:M([i.type,"entry"])},[i.type==="ai-output"?(f(),ge(p,{key:0,source:i.log},null,8,["source"])):(f(),_("div",Ye,L(i.type==="restart"?"-- restarted --":i.log),1))],2))),128))],512),e("div",qe,[I(R,{class:M(["icon",{open:b.value}]),path:c(N)},null,8,["class","path"]),e("div",{ref_key:"inputRef",ref:y,class:"input-text",contenteditable:"","pointer-events":h.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:he(ee,["enter"])},null,40,je)])]),e("div",Ge,[e("div",{class:"icons",onClick:ne},[I(R,{class:"icon",path:c(we)},null,8,["path"])]),e("div",null,[I(R,{class:"icon clickable",path:x.value==="assistant"?c(z):c(H),onClick:l[1]||(l[1]=i=>v())},null,8,["path"])])])])],4)):U("",!0)])}}});const dt=j(Qe,[["__scopeId","data-v-3bda3e11"]]),pt=D({__name:"UnsavedChangesHandler",props:{hasChanges:{type:Boolean}},setup(o){const t=o,n="You have unsaved changes. Are you sure you want to leave?",a=u=>(u=u||window.event,u&&(u.returnValue=n),n),m=()=>{window.addEventListener("beforeunload",a)};ye((u,C,v)=>{if(!t.hasChanges)return v();confirm(n)?v():v(!1)});const w=()=>window.removeEventListener("beforeunload",a),h=u=>u?m():w();return G(()=>t.hasChanges,h),Q(()=>h(t.hasChanges)),X(w),()=>{}}});export{ct as R,dt as S,pt as _};
//# sourceMappingURL=UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.5326febc.js.map

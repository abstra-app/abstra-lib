import{f as s,ee as J,d as L,c as N,U as H,R as Y,ac as U,b as n,u as e,aY as E,o as p,cE as C,i as c,aI as P,cD as G,a as g,df as D,g as y,t as f,d9 as $,h as j,dj as k,el as Q,dd as W,d6 as X,eq as Z,S as K,d0 as ee,cM as te,ei as ae,A as ne}from"./jwt-decode.esm.3965808e.js";import{_ as le}from"./AbstraButton.vue_vue_type_script_setup_true_lang.5d04e1df.js";import{I as se}from"./PhCopy.vue.45625935.js";import{T as re}from"./tasksController.01e72ba0.js";import{s as oe}from"./metadata.d03cb929.js";import{t as ie}from"./ant-design.73947a21.js";import{R as ue}from"./dayjs.436c8cdc.js";import{g as R,a as A}from"./router.cbcd4656.js";import{R as de}from"./repository.3c6100cd.js";import{a as ce,B as pe}from"./build.e3bde3dd.js";import{a as ge}from"./project.1cd70ba6.js";import"./tables.5b629236.js";import{a as fe}from"./asyncComputed.7b08c937.js";import"./contracts.generated.8e023a30.js";import"./record.c96f06c3.js";import"./linters.77d47f5a.js";import"./polling.fc7307e2.js";import"./PhUserList.vue.a4b9621d.js";import"./PhWebhooksLogo.vue.31ff558e.js";import"./index.c8d65864.js";import"./string.3814c733.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[i]="99eb6481-1998-4f2e-aa02-b561a1e7a34e",d._sentryDebugIdIdentifier="sentry-dbid-99eb6481-1998-4f2e-aa02-b561a1e7a34e")}catch{}})();var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const _e=me;function B(d){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?Object(arguments[i]):{},b=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(o).filter(function(v){return Object.getOwnPropertyDescriptor(o,v).enumerable}))),b.forEach(function(v){ye(d,v,o[v])})}return d}function ye(d,i,o){return i in d?Object.defineProperty(d,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[i]=o,d}var z=function(i,o){var b=B({},i,o.attrs);return s(J,B({},b,{icon:_e}),null)};z.displayName="SyncOutlined";z.inheritAttrs=!1;const be=z,ve=L({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean},stageId:{},status:{}},setup(d,{expose:i}){const o=d,{setup:b,tearDown:v,state:u,getColumns:T,fetchTasks:I,clearAllTasks:w}=re({api:o.api,poll:!0,stages:o.stages,stageId:o.stageId,status:o.status}),S=t=>{var a,m;if(!((a=t.completed)!=null&&a.at)||!((m=t.created)!=null&&m.at))return null;const l=new Date(t.created.at).getTime(),r=new Date(t.completed.at).getTime();return Math.round((r-l)/1e3)},h=t=>{var a;if(!((a=t.created)!=null&&a.at))return null;const l=new Date(t.created.at).getTime(),r=Date.now();return Math.round((r-l)/1e3)},x=t=>{if(t<60)return`${t}s`;const l=Math.floor(t/60);if(l<60){const _=t%60;return _>0?`${l}m ${_}s`:`${l}m`}const r=Math.floor(l/60);if(r<24){const _=l%60;return _>0?`${r}h ${_}m`:`${r}h`}const a=Math.floor(r/24),m=r%24;return m>0?`${a}d ${m}h`:`${a}d`},O=N(()=>o.stages?u.tasks.map(t=>{var r,a,m;const l=(r=o.stages)==null?void 0:r.find(_=>_.id===t.targetStageId);return l?{...t,targetStageTitle:l.stageTitle,targetStageType:l.stageType,completedAt:(m=t.completed)!=null&&m.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1,duration:S(t),pendingDuration:h(t)}:{...t,targetStageTitle:null,targetStageType:null,completedAt:(a=t.completed)!=null&&a.at?new Date(t.completed.at).toLocaleString():c.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),deleted:!0,duration:S(t),pendingDuration:h(t)}}):u.tasks.map(t=>{var l;return{...t,deleted:!1,completedAt:(l=t.completed)!=null&&l.at?new Date(t.completed.at).toLocaleString():c.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),duration:S(t),pendingDuration:h(t)}})),F=(t,l,r)=>{var _,M;const a=(_=t.current)!=null?_:1,m=(M=t.pageSize)!=null?M:10;u.pagination.currentIndex=a-1,u.pagination.pageSize=m,I()},V=(t,l)=>`/_editor/${t}/${l}`,q=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),te.success({content:c.translate("i18n_tasksview_copied_to_clipboard")})};return i({clearAllTasks:w}),H(()=>b()),Y(()=>v()),(t,l)=>(p(),U(E,null,[s(e(G),{layout:"vertical"},{default:n(()=>[s(e(R),{gutter:10},{default:n(()=>[s(e(A),{span:10},{default:n(()=>[s(e(C),{label:e(c).translate("i18n_tasksview_stage_label")},{default:n(()=>[s(e(P),{value:e(u).filters.stage,"onUpdate:value":l[0]||(l[0]=r=>e(u).filters.stage=r),options:e(u).filterOptions.stages,placeholder:e(c).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(e(A),{span:6},{default:n(()=>[s(e(C),{label:e(c).translate("i18n_tasksview_status_label")},{default:n(()=>[s(e(P),{value:e(u).filters.status,"onUpdate:value":l[1]||(l[1]=r=>e(u).filters.status=r),options:e(u).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(c).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(e(A),{span:8},{default:n(()=>[s(e(C),{label:e(c).translate("i18n_tasksview_created_at_date_label")},{default:n(()=>[s(e(ue),{value:e(u).filters.dateRange,"onUpdate:value":l[2]||(l[2]=r=>e(u).filters.dateRange=r),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),s(e(ee),{columns:e(T)(),"data-source":O.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(u).pagination.currentIndex+1,pageSize:e(u).pagination.pageSize,total:e(u).pagination.totalCount},onChange:F},{bodyCell:n(({column:r,record:a})=>[r.key==="timeInfo"?(p(),g(e(k),{key:0,vertical:"",gap:4},{default:n(()=>[s(e(D),null,{default:n(()=>[y(f(a.createdAt),1)]),_:2},1024),a.status==="pending"&&a.pendingDuration?(p(),g(e($),{key:0,color:"orange"},{default:n(()=>[y(f(e(c).translate("i18n_tasksview_pending_for"))+" "+f(x(a.pendingDuration)),1)]),_:2},1024)):a.status==="started"?(p(),g(e($),{key:1,color:"blue"},{default:n(()=>[y(f(e(c).translate("i18n_tasksview_status_running"))+" ",1),s(e(be),{spin:!0,style:{"margin-left":"4px"}})]),_:1})):a.duration?(p(),g(e($),{key:2,color:"green"},{default:n(()=>[y(f(e(c).translate("i18n_tasksview_completed_in"))+" "+f(x(a.duration)),1)]),_:2},1024)):j("",!0)]),_:2},1024)):r.key==="stageInfo"?(p(),g(e(k),{key:1,vertical:"",gap:4},{default:n(()=>[a.deleted?(p(),g(e(D),{key:0},{default:n(()=>[y(f(e(c).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),g(e(k),{key:1,gap:8,align:"center"},{default:n(()=>[(p(),g(Q(e(oe)(a.targetStageType)),{size:20})),s(e(k),{vertical:"",gap:0},{default:n(()=>[t.editor?(p(),g(e(W),{key:0,href:V(a.targetStageType,a.targetStageId)},{default:n(()=>[y(f(a.targetStageTitle),1)]),_:2},1032,["href"])):(p(),g(e(D),{key:1},{default:n(()=>[y(f(a.targetStageTitle),1)]),_:2},1024)),s(e(D),{type:"secondary",style:{fontSize:"12px"}},{default:n(()=>[y(f(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024)):r.key==="payloadInfo"?(p(),g(e(k),{key:2,gap:8,align:"start",justify:"space-between"},{default:n(()=>[s(e(X),{"tree-data":e(ie)(a.payload),selectable:!1,style:{flex:"1"}},null,8,["tree-data"]),s(le,{type:"text",size:"small",tooltip:e(c).translate("i18n_tasksview_copy_payload_tooltip"),onClick:Z(m=>q(a.payload),["stop"])},{default:n(()=>[s(e(se))]),_:2},1032,["tooltip","onClick"])]),_:2},1024)):j("",!0)]),footer:n(()=>[s(e(R),{justify:"end",gutter:10},{default:n(()=>[s(e(A),null,{default:n(()=>[s(e(K),{size:"small"})]),_:1}),s(e(A),null,{default:n(()=>[s(e(D),null,{default:n(()=>[y(f(e(c).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Ee=L({__name:"Tasks",setup(d){const i=ae(),o=i.params.projectId,b=i.query.stage,v=i.query.status,u=new de(o),{result:T}=fe(async()=>{const S=(await ce.list(o)).find(O=>O.latest);if(!S)return null;const[h,x]=await Promise.all([pe.get(S.id),ge.get(o)]);return{buildSpec:h,project:x}}),I=N(()=>!T.value||!T.value.buildSpec?null:T.value.buildSpec.runtimes.map(w=>({id:w.id,stageTitle:w.title,stageType:w.type})));return(w,S)=>(p(),U(E,null,[s(e(ne),null,{default:n(()=>[y(f(e(c).translate("i18n_tasksview_title")),1)]),_:1}),I.value?(p(),g(ve,{key:0,class:"tasks",api:e(u),stages:I.value,"stage-id":e(b),status:e(v)},null,8,["api","stages","stage-id","status"])):j("",!0)],64))}});export{Ee as default};
//# sourceMappingURL=Tasks.5603516c.js.map

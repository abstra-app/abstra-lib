var me=Object.defineProperty;var ye=(n,e,t)=>e in n?me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var B=(n,e,t)=>(ye(n,typeof e!="symbol"?e+"":e,t),t);import{u as z}from"./uuid.6f8859df.js";import{F as te,d as $,r as f,S as K,G as P,b as p,eu as _,e as l,ey as O,eE as se,eF as ne,t as U,eB as we,H as be,a3 as Ce,o as ae,K as oe,a as re,f as u,u as a,I as T,aq as v,eD as R,ew as x,ev as ke,a_ as ie,eC as Se,c as C,eQ as Ie,eV as Ee,w as d,bU as L,cF as H,cB as Te,bN as le}from"./outputWidgets.6c6bbcfd.js";import{s as q,n as G,o as Y,g as xe,q as Ae,e as Re}from"./icons.89c226d3.js";import{l as $e}from"./DocsButton.vue_vue_type_script_setup_true_lang.63179e5b.js";import{b as je,c as Q,A as De}from"./Text.51d0b007.js";import{a as X}from"./asyncComputed.77186ed9.js";import{J as Be}from"./jobs.e4a66544.js";import{W as Le}from"./workspaces.fc773211.js";import{A as Oe}from"./record.5aef9f17.js";import{A as Z}from"./Base.d198dcc9.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="9023299e-acf3-46bd-adfd-2481d08eaf7d",n._sentryDebugIdIdentifier="sentry-dbid-9023299e-acf3-46bd-adfd-2481d08eaf7d")}catch{}})();class Pe{async list(){return await(await fetch("/_editor/api/scripts")).json()}async create(){return await(await fetch("/_editor/api/scripts",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}async get(e){return await(await fetch(`/_editor/api/scripts/${e}`)).json()}async update(e,t){return await(await fetch(`/_editor/api/scripts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async delete(e,t){const s=t?"?remove_file=true":"",o=`/_editor/api/scripts/${e}`+s;await fetch(o,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async test(e){return(await fetch(`/_editor/api/scripts/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()}}const S=new Pe;class A{constructor(e){B(this,"record");this.record=Oe.create(S,e)}static async list(){return(await S.list()).map(t=>new A(t))}static async create(){const e=await S.create();return new A(e)}static async get(e){const t=await S.get(e);return new A(t)}async delete(e){await S.delete(this.id,e)}async duplicate(){return this}async save(){await this.record.save()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(e){return this.record.hasChanges(e)}get id(){return this.record.get("id")}get schedule(){return this.record.get("schedule")}set schedule(e){this.record.set("schedule",e)}get title(){return this.record.get("title")}set title(e){this.record.set("title",e)}get file(){return this.record.get("file")}set file(e){this.record.set("file",e)}get path(){return this.record.get("path")}set path(e){this.record.set("path",e)}async test(){return S.test(this.id)}get position(){const[e,t]=this.record.get("workflow_position");return{x:e,y:t,referential:"world"}}get isInitial(){return!1}}class ce{constructor(){B(this,"logState",te({log:[]}));B(this,"_listeners",{})}static create(){return new ce}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const s=t?this.logs.find(o=>o.id===t):null;return s?Object.assign(s,e):this.logs.push({...e,id:t||z()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=z();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class Ne{static async*sendMessage(e,t){var r;const o=(r=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:r.getReader();if(!o)throw new Error("No response body");for(;;){const c=await o.read();if(c.done)break;yield new TextDecoder().decode(c.value)}}}const Fe=n=>(se("data-v-59ca7295"),n=n(),ne(),n),Ve=Fe(()=>l("div",{class:"text"}," Changes were made in your code. Click Restart to refresh the preview window. ",-1)),ee="ignoreCodeChangesWarning",ze=$({__name:"ChangesWarning",props:{hasChanges:{type:Boolean}},setup(n){var r;const e=n,t=f((r=K.get(ee))!=null?r:!1),s=P(()=>e.hasChanges&&!t.value),o=()=>{K.set(ee,!0),t.value=!0};return(c,g)=>(p(),_("div",{class:O(["changes-warning",{visible:s.value}])},[Ve,l("div",{class:"no-more-alert",onClick:o},"Do not show again")],2))}});const Ue=U(ze,[["__scopeId","data-v-59ca7295"]]),Me=n=>(se("data-v-fa74f10a"),n=n(),ne(),n),We={class:"smart-console"},Je={class:"header"},Ke={class:"left"},He={class:"right"},qe={class:"changes-container"},Ge=["unseen-severity"],Ye={class:"cli"},Qe={class:"left"},Xe=Me(()=>l("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Ze={key:1,class:"local-entry"},et={class:"input"},tt=["pointer-events","onKeydown"],st={class:"right"},nt=$({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(n,{emit:e}){const t=n,s=f(""),o=f(null),r=we(),c=f({type:"seen"}),g=f(!1),h=f(!1),y=()=>{t.logService.clear(),e("restart")},j=()=>{E.value=E.value==="assistant"?"debugger":"assistant"};function I(i){switch(i.type){case"ai-input":return{role:"user",content:i.log};case"ai-output":return{role:"assistant",content:i.log};case"stderr":case"stdout":return{role:"user",content:i.log};case"restart":return{role:"user",content:"-- new session --"};case"files-changed":return{role:"user",content:"-- files changed --"};default:throw new Error(`Unknown log type: ${i.type}`)}}const ue=P(()=>t.logService.logs.some(i=>i.type==="files-changed"));function de(){b.value=!b.value,b.value&&(c.value={type:"seen"})}be(r,()=>{t.logService.clear(),e("clear-terminal")});const D=f(null),E=f("assistant"),pe=async i=>{var w;if(i.preventDefault(),s.value=((w=D.value)==null?void 0:w.innerText)||"",i.shiftKey){document.execCommand("insertLineBreak");return}D.value&&(D.value.innerText=""),E.value==="assistant"?await he():await fe()},he=async()=>{var w;if(e("enter",s.value),t.logService.log({type:"ai-input",log:s.value}),s.value="",!h.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}g.value=!0;const i={role:"user",content:(w=t.formCode)!=null?w:""};try{const k=z();let m="";const F=Ne.sendMessage([i,...t.logService.logs.map(V=>I(V)),{role:"user",content:s.value}],t.runtime);for await(const V of F)m+=V,t.logService.log({type:"ai-output",log:m},k)}catch(k){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(k),Ee(k)}finally{g.value=!1}},fe=async()=>{s.value&&(t.logService.log({type:"eval-input",log:`>>> ${s.value}`}),e("eval-request",s.value),s.value="")},ge=()=>{t.logService.clear()};t.logService.listen(async i=>{b.value||(c.value={type:"unseen",count:c.value.type==="unseen"?c.value.count+1:1,severity:i.type==="stderr"?"error":"info"}),i.type!=="restart"&&(await Ce(),o.value&&(o.value.scrollTop=o.value.scrollHeight))});const b=f(!1),M=f(400),ve=P(()=>({height:`${M.value}px`})),N=f(!1),_e=()=>N.value=!0,W=i=>{!N.value||(M.value=document.body.clientHeight-i.clientY)},J=()=>N.value=!1;return ae(()=>{document.addEventListener("mousemove",W),document.addEventListener("mouseup",J),$e.get().then(i=>{h.value=!!i.logged})}),oe(()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",J)}),(i,w)=>{const k=re("Markdown");return p(),_("div",We,[l("div",Je,[l("div",Ke,[u(T,{path:E.value==="assistant"?a(q):a(G)},null,8,["path"]),v(" Smart Console ")]),l("div",He,[l("div",qe,[u(Ue,{"has-changes":ue.value},null,8,["has-changes"]),l("button",{class:"header-button",onClick:y},"Restart")]),l("div",{class:"toggle-button",onClick:de},[u(T,{class:O(["icon",{open:b.value}]),path:a(Y),fill:"#fff"},null,8,["class","path"]),c.value.type==="unseen"?(p(),_("div",{key:0,class:"unseen-count","unseen-severity":c.value.severity},R(c.value.count),9,Ge)):x("",!0)])])]),b.value?(p(),_("div",{key:0,class:"terminal",style:ke(ve.value)},[l("div",{class:"resize-handler",onMousedown:_e},null,32),l("div",Ye,[l("div",Qe,[l("div",{ref_key:"entriesContainer",ref:o,class:"entries"},[Xe,(p(!0),_(ie,null,Se(t.logService.logs,(m,F)=>(p(),_("div",{key:F,class:O([m.type,"entry"])},[m.type==="ai-output"?(p(),C(k,{key:0,source:m.log},null,8,["source"])):(p(),_("div",Ze,R(m.type==="restart"?"-- restarted --":m.log),1))],2))),128))],512),l("div",et,[u(T,{class:O(["icon",{open:b.value}]),path:a(Y)},null,8,["class","path"]),l("div",{ref_key:"inputRef",ref:D,class:"input-text",contenteditable:"","pointer-events":g.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:Ie(pe,["enter"])},null,40,tt)])]),l("div",st,[l("div",{class:"icons",onClick:ge},[u(T,{class:"icon",path:a(xe)},null,8,["path"])]),l("div",null,[u(T,{class:"icon clickable",path:E.value==="assistant"?a(q):a(G),onClick:w[0]||(w[0]=m=>j())},null,8,["path"])])])])],4)):x("",!0)])}}});const yt=U(nt,[["__scopeId","data-v-fa74f10a"]]),wt=$({__name:"Debugger",setup(n){async function e(){const c=await fetch("/_editor/api/debugger",{method:"GET"});if(!c.ok)throw new Error("Failed to check debugger connection");return await c.json()}async function t(){await fetch("/_editor/api/debugger/vscode-launch",{method:"POST"}),o()}const s=f({connected:!1,port:0,is_launch_json_configured:!1});async function o(){s.value=await e()}let r=null;return ae(()=>{r=setInterval(o,1e3)}),oe(()=>{r&&clearInterval(r)}),(c,g)=>s.value.connected?(p(),C(a(L),{key:0,disabled:""},{default:d(()=>[v("VSCode connected")]),_:1})):(p(),C(a(Te),{key:1},{content:d(()=>[u(a(H),{direction:"vertical"},{default:d(()=>[u(a(je),null,{default:d(()=>[v(" Abstra allows you to connect to your VSCode debugger ")]),_:1}),u(a(Q),null,{default:d(()=>[v(" You're not connected ")]),_:1}),s.value.is_launch_json_configured?(p(),C(a(H),{key:0,direction:"vertical"},{default:d(()=>[u(a(Q),{style:{"font-size":"24px"},copyable:"",code:""},{default:d(()=>[v(R(s.value.port),1)]),_:1}),u(a(L),{href:"https://docs.abstra.io/debug/vscode",target:"_blank"},{default:d(()=>[v(" Learn how to connect to vscode ")]),_:1})]),_:1})):(p(),C(a(L),{key:1,onClick:t},{default:d(()=>[v("Configure launch.json")]),_:1}))]),_:1})]),default:d(()=>[u(a(L),null,{default:d(()=>[v("Connect to VSCode")]),_:1})]),_:1}))}}),at=$({__name:"PathInput",props:{runtime:{}},setup(n){const e=n,t=f(!1),s=async()=>{t.value=!0;const r=await(await fetch("/_editor/api/utils/normalize_path",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e.runtime.path})})).text();r&&r!==e.runtime.path&&(e.runtime.path=r),t.value=!1};return(o,r)=>(p(),C(a(le),{value:o.runtime.path,"onUpdate:value":r[0]||(r[0]=c=>o.runtime.path=c),type:"text",disabled:t.value,onBlur:s},{addonBefore:d(()=>[v(" https://[your-subdomain].abstra.app/ ")]),_:1},8,["value","disabled"]))}}),ot={class:"file-path"},rt={key:1},it=$({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(n){const e=n,t=te({pathError:null}),{result:s}=X(()=>Le.get()),o=()=>{!s.value||!e.runtime.file||s.value.openFile(e.runtime.file)},r=P(()=>{var h;return(h=e.runtime.file)!=null&&h.endsWith(".py")?e.runtime.hasChanges("file")?"The original file will be renamed after saving":null:"It should be a .py file"}),c=()=>{!s.value||!g.value||s.value.openFile(".")},{result:g}=X(()=>fetch("/_editor/api/workspace/root").then(h=>h.text()));return(h,y)=>{const j=re("icon");return p(),_(ie,null,[u(a(De),null,{default:d(()=>[u(a(Z),{label:"Source code",help:r.value},{default:d(()=>[u(a(le),{value:h.runtime.file,"onUpdate:value":y[2]||(y[2]=I=>h.runtime.file=I),type:"text"},{addonBefore:d(()=>[a(g)?(p(),_("span",{key:0,class:"clickable",onClick:y[0]||(y[0]=I=>c())},[u(j,{class:"clickable",path:a(Ae)},null,8,["path"]),l("p",ot,R(a(g)),1)])):x("",!0)]),addonAfter:d(()=>[l("span",{class:"clickable",onClick:y[1]||(y[1]=I=>o())},[u(j,{class:"clickable",path:a(Re)},null,8,["path"]),v(" Open file ")])]),_:1},8,["value"])]),_:1},8,["help"])]),_:1}),h.runtime instanceof a(Be)||h.runtime instanceof a(A)?x("",!0):(p(),C(a(Z),{key:0,label:"URL path"},{default:d(()=>[u(at,{runtime:h.runtime},null,8,["runtime"])]),_:1})),t.pathError?(p(),_("div",rt,R(t.pathError),1)):x("",!0)],64)}}});const bt=U(it,[["__scopeId","data-v-2ed86fc9"]]);export{ce as L,bt as R,yt as S,wt as _};
//# sourceMappingURL=RuntimeCommonSettings.4f9503d5.js.map

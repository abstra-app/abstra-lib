import{h as s,I as ot,a as Q,ag as H,af as it,c2 as w,bp as F,i as d,c as G,H as rt,p as dt,k as X,f as p,Q as Y,w as l,u as t,b5 as T,b6 as N,b3 as ut,m as U,J as V,ba as ct,b4 as pt,T as C,g as _,t as g,b as m,e as Z,E as I,b9 as ft,bl as gt,X as mt,a$ as _t,bB as yt,bm as bt,be as vt,aK as wt,ak as ht}from"./jwt-decode.esm-BRRA-bKi.js";import{_ as A}from"./AbstraButton.vue_vue_type_script_setup_true_lang-BpoWn2sZ.js";import{G as St}from"./PhBroom.vue-BtkXXd0o.js";import{I as kt}from"./PhCopy.vue-DgCitwRx.js";import{F as Dt,D as Tt}from"./PhTextAa.vue-BCvB0A2O.js";import{T as Ct,R as It}from"./tasksController-DFU1kwoS.js";import{s as xt}from"./metadata-CRr3PmMT.js";import{t as At}from"./ant-design-DPnaazIl.js";import{R as $t}from"./dayjs-CdA6bzAG.js";import{c as q,d as h}from"./router-Bh5EUIsF.js";import{A as E}from"./index-C6w1GxtU.js";import{B as Ot,a as zt}from"./build-DGO78UwG.js";import{P as jt}from"./project-BTgwRZj3.js";import"./tables-Cb0rOdcm.js";import{a as Rt}from"./asyncComputed-EIAhe39c.js";import"./contracts.generated-CcwXwzfb.js";import"./record-B_JjtlWo.js";import"./linters-CElNuqXo.js";import"./polling-D7gWgnWW.js";import"./taskCreator-DYP6TgxP.js";import"./PhMagnifyingGlass.vue-D1Yu2q_4.js";import"./PhWebhooksLogo.vue-R-v6vObl.js";import"./ts.worker-D9N1lSIu.js";import"./string-BUHbcr79.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new Error().stack;u&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[u]="23ebc1e1-6944-4e77-8b25-bf0c04e1c84d",c._sentryDebugIdIdentifier="sentry-dbid-23ebc1e1-6944-4e77-8b25-bf0c04e1c84d")}catch{}})();var Wt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function J(c){for(var u=1;u<arguments.length;u++){var r=arguments[u]!=null?Object(arguments[u]):{},y=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(y=y.concat(Object.getOwnPropertySymbols(r).filter(function(b){return Object.getOwnPropertyDescriptor(r,b).enumerable}))),y.forEach(function(b){Mt(c,b,r[b])})}return c}function Mt(c,u,r){return u in c?Object.defineProperty(c,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):c[u]=r,c}var M=function(u,r){var y=J({},u,r.attrs);return s(ot,J({},y,{icon:Wt}),null)};M.displayName="SyncOutlined";M.inheritAttrs=!1;const Pt=Q({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean},stageId:{},status:{}},setup(c,{expose:u}){const r=c,y=H(),b=it();function $(){const{stage:e,status:a,startDate:i,endDate:o,payload:f,payloadMatchCase:v,payloadMatchWholeWord:nt}=y.query,D={};return e&&(D.stage=e),a&&(D.status=a),D.payload={value:f,matchCase:v==="true",matchWholeWord:nt==="true"},i&&o&&(D.dateRange=[w(i),w(o)]),D}const{setup:S,tearDown:x,state:n,getColumns:k,fetchTasks:O,clearAllTasks:z,updateStatus:j}=Ct({api:r.api,poll:!0,stages:r.stages,stageId:r.stageId,status:r.status,initialFilters:r.editor?void 0:$(),onFilterChange:r.editor?void 0:P});function P(){if(r.editor)return;tt();const e={},{stage:a,status:i,dateRange:o,payload:f}=n.filters;e.stage=a,e.status=i,e.payload=f.value,f.matchCase&&(e.payloadMatchCase="true"),f.matchWholeWord&&(e.payloadMatchWholeWord="true"),o&&o[0]&&o[1]&&w.isDayjs(o[0])&&w.isDayjs(o[1])?(e.startDate=o[0].toISOString().slice(0,10),e.endDate=o[1].toISOString().slice(0,10)):(e.startDate=void 0,e.endDate=void 0),b.replace({query:e})}function K(){n.filters.dateRange=void 0,n.filters.stage=void 0,n.filters.status=void 0,n.filters.payload={value:void 0,matchCase:!1,matchWholeWord:!1}}function tt(){const e=n.filters.dateRange,a=w();!e||!e[1]?n.filters.dateRange=[a.subtract(90,"day"),a]:w.isDayjs(e[0])&&w.isDayjs(e[1])&&e[1].diff(e[0],"day")>90&&(n.filters.dateRange=[e[1].subtract(90,"day"),e[1]],F.warning({content:d.translate("i18n_tasksview_date_range_limit_warning",null,90)}))}const B=(e,a)=>!a?.label||typeof a.label!="string"?!1:a.label.toLowerCase().includes(e.toLowerCase()),R=e=>{if(!e.completed?.at||!e.created?.at)return null;const a=new Date(e.created.at).getTime(),i=new Date(e.completed.at).getTime();return Math.round((i-a)/1e3)},W=e=>{if(!e.created?.at)return null;const a=new Date(e.created.at).getTime(),i=Date.now();return Math.round((i-a)/1e3)},L=e=>{if(e<60)return`${e}s`;const a=Math.floor(e/60);if(a<60){const v=e%60;return v>0?`${a}m ${v}s`:`${a}m`}const i=Math.floor(a/60);if(i<24){const v=a%60;return v>0?`${i}h ${v}m`:`${i}h`}const o=Math.floor(i/24),f=i%24;return f>0?`${o}d ${f}h`:`${o}d`},et=G(()=>r.stages?n.tasks.map(e=>{const a=r.stages?.find(i=>i.id===e.targetStageId);return a?{...e,targetStageTitle:a.stageTitle,targetStageType:a.stageType,completedAt:e.completed?.at?new Date(e.completed.at).toLocaleString():"Not completed",createdAt:new Date(e.created.at).toLocaleString(),deleted:!1,duration:R(e),pendingDuration:W(e)}:{...e,targetStageTitle:null,targetStageType:null,completedAt:e.completed?.at?new Date(e.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(e.created.at).toLocaleString(),deleted:!0,duration:R(e),pendingDuration:W(e)}}):n.tasks.map(e=>({...e,deleted:!1,completedAt:e.completed?.at?new Date(e.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(e.created.at).toLocaleString(),duration:R(e),pendingDuration:W(e)}))),at=(e,a,i)=>{const o=e.current??1,f=e.pageSize??10;n.pagination.currentIndex=o-1,n.pagination.pageSize=f,O()},lt=(e,a)=>`/_editor/${e}/${a}`,st=e=>{typeof e=="object"?navigator.clipboard.writeText(JSON.stringify(e)):navigator.clipboard.writeText(String(e)),F.success({content:d.translate("i18n_tasksview_copied_to_clipboard")})};return u({clearAllTasks:z}),P(),rt(()=>S()),dt(()=>x()),(e,a)=>(p(),X(Y,null,[s(t(ct),{layout:"vertical"},{default:l(()=>[s(t(q),{gutter:10,align:"bottom"},{default:l(()=>[s(t(h),{span:5},{default:l(()=>[s(t(T),{label:t(d).translate("i18n_tasksview_status_label")},{default:l(()=>[s(t(N),{value:t(n).filters.status,"onUpdate:value":a[0]||(a[0]=i=>t(n).filters.status=i),options:t(n).filterOptions.statuses,"option-label":"label","option-value":"value","show-search":"","filter-option":B,filter:!1,placeholder:t(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(t(h),{span:6},{default:l(()=>[s(t(T),{label:t(d).translate("i18n_tasksview_payload_label")},{default:l(()=>[s(t(ut),{value:t(n).filters.payload.value,"onUpdate:value":a[3]||(a[3]=i=>t(n).filters.payload.value=i),placeholder:t(d).translate("i18n_tasksview_search_by_payload_placeholder"),style:{width:"100%"},"allow-clear":""},{suffix:l(()=>[U("span",{class:V({"toggle-btn-active":t(n).filters.payload.matchCase})},[s(A,{type:"text",size:"small",tooltip:t(d).translate("i18n_tasksview_match_case_tooltip"),onClick:a[1]||(a[1]=i=>t(n).filters.payload.matchCase=!t(n).filters.payload.matchCase)},{default:l(()=>[s(t(Dt))]),_:1},8,["tooltip"])],2),U("span",{class:V({"toggle-btn-active":t(n).filters.payload.matchWholeWord})},[s(A,{type:"text",size:"small",tooltip:t(d).translate("i18n_tasksview_match_whole_word_tooltip"),onClick:a[2]||(a[2]=i=>t(n).filters.payload.matchWholeWord=!t(n).filters.payload.matchWholeWord)},{default:l(()=>[s(t(Tt))]),_:1},8,["tooltip"])],2)]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),s(t(h),{span:6},{default:l(()=>[s(t(T),{label:t(d).translate("i18n_tasksview_stage_label")},{default:l(()=>[s(t(N),{value:t(n).filters.stage,"onUpdate:value":a[4]||(a[4]=i=>t(n).filters.stage=i),"show-search":"","filter-option":B,options:t(n).filterOptions.stages,placeholder:t(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(t(h),{span:6},{default:l(()=>[s(t(T),{label:t(d).translate("i18n_tasksview_created_at_date_label")},{default:l(()=>[s(t($t),{value:t(n).filters.dateRange,"onUpdate:value":a[5]||(a[5]=i=>t(n).filters.dateRange=i),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),s(t(h),{span:1},{default:l(()=>[s(t(T),null,{default:l(()=>[s(A,{type:"text",size:"middle",tooltip:t(d).translate("i18n_tasksview_clear_filters_tooltip"),onClick:K},{default:l(()=>[s(t(St))]),_:1},8,["tooltip"])]),_:1})]),_:1})]),_:1})]),_:1}),s(t(vt),{columns:t(k)(),"data-source":et.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:t(n).pagination.currentIndex+1,pageSize:t(n).pagination.pageSize,total:t(n).pagination.totalCount},onChange:at},{bodyCell:l(({column:i,record:o})=>[i.key==="timeInfo"?(p(),m(t(I),{key:0,vertical:"",gap:4},{default:l(()=>[s(t(C),null,{default:l(()=>[_(g(o.createdAt),1)]),_:2},1024),o.status==="locked"?(p(),m(t(E),{key:0,type:"info"},{message:l(()=>[_(g(t(d).translate("i18n_tasksview_status_running")),1)]),default:l(()=>[s(t(M),{spin:!0,style:{"margin-left":"4px"}})]),_:1})):(p(),m(t(E),{key:1,type:o.status==="pending"?"warning":"success"},ft({action:l(()=>[s(t(gt),{size:"small",checked:o.status==="completed","onUpdate:checked":f=>t(j)(o,o.status==="pending"?"completed":"pending")},null,8,["checked","onUpdate:checked"])]),_:2},[o.status==="pending"?{name:"message",fn:l(()=>[_(g(t(d).translate("i18n_tasksview_pending_for"))+" "+g(L(o.pendingDuration)),1)]),key:"0"}:o.status==="completed"?{name:"message",fn:l(()=>[_(g(t(d).translate("i18n_tasksview_completed_in"))+" "+g(L(o.duration)),1)]),key:"1"}:void 0]),1032,["type"]))]),_:2},1024)):i.key==="stageInfo"?(p(),m(t(I),{key:1,vertical:"",gap:4},{default:l(()=>[o.deleted?(p(),m(t(C),{key:0},{default:l(()=>[_(g(t(d).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),m(t(I),{key:1,gap:8,align:"center"},{default:l(()=>[(p(),m(mt(t(xt)(o.targetStageType)),{size:20})),s(t(I),{vertical:"",gap:0},{default:l(()=>[c.editor?(p(),m(t(_t),{key:0,href:lt(o.targetStageType,o.targetStageId)},{default:l(()=>[_(g(o.targetStageTitle),1)]),_:2},1032,["href"])):(p(),m(t(C),{key:1},{default:l(()=>[_(g(o.targetStageTitle),1)]),_:2},1024)),s(t(C),{type:"secondary",style:{fontSize:"12px"}},{default:l(()=>[_(g(o.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024)):i.key==="payloadInfo"?(p(),m(t(I),{key:2,gap:8,align:"start",justify:"space-between"},{default:l(()=>[s(t(yt),{"tree-data":t(At)(o.payload),selectable:!1,style:{flex:"1"}},null,8,["tree-data"]),s(A,{type:"text",size:"small",tooltip:t(d).translate("i18n_tasksview_copy_payload_tooltip"),onClick:bt(f=>st(o.payload),["stop"])},{default:l(()=>[s(t(kt))]),_:1},8,["tooltip","onClick"])]),_:2},1024)):Z("",!0)]),footer:l(()=>[s(t(q),{justify:"end",gutter:10},{default:l(()=>[s(t(h),null,{default:l(()=>[s(t(pt),{size:"small"})]),_:1}),s(t(h),null,{default:l(()=>[s(t(C),null,{default:l(()=>[_(g(t(d).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Bt=wt(Pt,[["__scopeId","data-v-2c060d8d"]]),de=Q({__name:"Tasks",setup(c){const u=H(),r=u.params.projectId,y=u.query.stage,b=u.query.status,$=new It(r),{result:S}=Rt(async()=>{const k=(await Ot.list(r)).find(j=>j.latest);if(!k)return null;const[O,z]=await Promise.all([zt.get(k.id),jt.get(r)]);return{buildSpec:O,project:z}}),x=G(()=>!S.value||!S.value.buildSpec?null:S.value.buildSpec.runtimes.map(n=>({id:n.id,stageTitle:n.title,stageType:n.type})));return(n,k)=>(p(),X(Y,null,[s(t(ht),null,{default:l(()=>[_(g(t(d).translate("i18n_tasksview_title")),1)]),_:1}),x.value?(p(),m(Bt,{key:0,class:"tasks",api:t($),stages:x.value,"stage-id":t(y),status:t(b)},null,8,["api","stages","stage-id","status"])):Z("",!0)],64))}});export{de as default};
//# sourceMappingURL=Tasks-D0xPSqb_.js.map

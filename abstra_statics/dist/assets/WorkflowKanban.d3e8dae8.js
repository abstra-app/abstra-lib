var pe=Object.defineProperty;var me=(n,t,a)=>t in n?pe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var V=(n,t,a)=>(me(n,typeof t!="symbol"?t+"":t,a),a);import{t as ne}from"./ant-design.1938c9ca.js";import{f as u,eG as re,e$ as ge,r as $,G as se,E as ye,o as _e,K as ve,d as U,b as l,c as i,w as r,u as e,aq as y,eD as C,ex as w,ev as h,bq as b,eC as S,cK as le,bg as oe,eH as he,cC as F,bO as L,bH as be,ad as N,cB as E,a as ke,co as we,dq as X,e as z,ck as Se,v as Ce}from"./outputWidgets.ec1b7422.js";import{a as j}from"./asyncComputed.57876dc8.js";import{L as Oe,a as Ae}from"./log.c9ca35f9.js";import"./authorManager.f240882c.js";import"./index.c3f6367a.js";import{s as xe}from"./metadata.33b04dfc.js";import{r as De,f as Ie}from"./index.0c8affc8.js";import{T as Te}from"./index.2169a868.js";import{A as ue}from"./index.8cee2b46.js";import{A as ie}from"./index.310cb573.js";import{A as Y,a as Z}from"./Title.4910381d.js";import{D as Pe,a as Re,C as B,A as M}from"./index.d2f7948a.js";import{A as de}from"./index.bdfc37a9.js";import{_ as Fe}from"./SaveButton.vue_vue_type_script_setup_true_lang.2cad5196.js";import{A as Ne}from"./Text.aae02753.js";import{F as ce}from"./Form.7cf53a7d.js";import{A as q}from"./FormItem.674c81e4.js";import{W as Ee}from"./workspaces.11eb87fa.js";import{F as $e}from"./index.a4e8ad18.js";import{C as je}from"./Card.9811cb31.js";import{E as qe}from"./ExpandOutlined.41e867d6.js";import"./index.24928422.js";import"./gateway.7a02c698.js";import"./index.cf4c23b9.js";import"./record.a3f4df6a.js";import"./pubsub.e392a757.js";import"./icons.1f6f4554.js";import"./isNumeric.75337b1e.js";import"./hasIn.4d766825.js";import"./url.7d2ac932.js";import"./index.625ac5d5.js";import"./index.fbb3d5cf.js";import"./TabPane.82332af3.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="a6970204-dfcc-4039-a010-08aa0157391c",n._sentryDebugIdIdentifier="sentry-dbid-a6970204-dfcc-4039-a010-08aa0157391c")}catch{}})();var Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM641.7 520.8L442.3 677.6c-7.4 5.8-18.3.6-18.3-8.8V355.3c0-9.4 10.9-14.7 18.3-8.8l199.4 156.7a11.2 11.2 0 010 17.6z"}}]},name:"play-square",theme:"filled"};const ze=Ve;function Le(n,t){return De(1,arguments),Ie(n,Date.now(),t)}function ee(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),s.forEach(function(d){Ue(n,d,a[d])})}return n}function Ue(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var W=function(t,a){var s=ee({},t,a.attrs);return u(re,ee({},s,{icon:ge}),null)};W.displayName="EyeOutlined";W.inheritAttrs=!1;const Be=W;function te(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable}))),s.forEach(function(d){Me(n,d,a[d])})}return n}function Me(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var J=function(t,a){var s=te({},t,a.attrs);return u(re,te({},s,{icon:ze}),null)};J.displayName="PlaySquareFilled";J.inheritAttrs=!1;const We=J;function Je(n){switch(n.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"};case"abandoned":return{color:"warning",text:"Abandoned"}}}function He(){const n=$({state:"closed"});function t(){n.value={state:"closed"}}function a(){n.value={state:"visualizations"}}function s(o,c){n.value={state:"stage-run",stageRun:c}}const d=se(()=>"stageRun"in n.value?n.value.stageRun:null);return{closeDrawer:t,openVisualizationEditor:a,inspectStageRun:s,drawerState:n,selectedStageRunForDrawer:d}}function Ke({getKanbanData:n,storage:t,getWorkspace:a}){const s=t!=null?t:localStorage;function d(){const p=s.getItem("kanban-selected-stage-ids");if(p)try{return JSON.parse(p)}catch{return[]}else return[]}const o=ye(d()),c=j(async()=>{try{const p=await n(o.value);return s.setItem("kanban-selected-stage-ids",JSON.stringify(o.value)),p}catch{return s.setItem("kanban-selected-stage-ids",JSON.stringify([])),{columns:[],next_stage_options:[]}}finally{o.value=d()}}),k=j(()=>a());async function x(p,f){p?o.value=[...o.value.slice(0,f),p]:o.value=o.value.slice(0,f),await c.refetch()}function D(p,f){var g;const A=(g=p.stages)==null?void 0:g.find(T=>T.id===p.selected_stage.id);if((A==null?void 0:A.type)==="form"){const T=(f==null?void 0:f.status)==="waiting"?{"abstra-run-id":f.id}:{};return{path:`/${A.path}`,query:T}}else return null}let v=null;function O(){_e(()=>{v=setInterval(()=>{c.refetch()},1e3)}),ve(()=>{v&&clearInterval(v)})}const I=se(()=>{var f,A,g;const p=(A=(f=c.result.value)==null?void 0:f.columns)!=null?A:[];return(g=p[p.length-1])==null?void 0:g.selected_stage});return{kanbanAsyncComputed:c,selectedStageIds:o,setNewSelectedStageId:x,workspaceAsyncComputed:k,launchLink:D,lastSelectedStage:I,init:O}}async function Ge(n){return(await fetch("/_editor/api/kanban",{method:"POST",body:JSON.stringify({selected_stages_ids:n}),headers:{"Content-Type":"application/json"}})).json()}async function Qe(n){return(await fetch(`/_editor/api/kanban/logs/${n}`)).json()}const Xe={key:1},Ye=U({__name:"StageRunInspector",props:{stageRun:{}},setup(n){const t=n,{result:a,loading:s}=j(()=>{var o;return Qe((o=t.stageRun)==null?void 0:o.id)}),d=o=>Ae.fromDTO({executionId:o.executionId,runtimeType:o.runtimeType,runtimeName:o.runtimeName,payload:o.payload,event:o.event,createdAt:new Date(o.createdAt*1e3),buildId:""});return(o,c)=>(l(),i(e(ue),{open:"",title:"Stage Run Inspector",size:"large"},{extra:r(()=>[u(e(Y),null,{default:r(()=>[u(e(ie),{style:{"font-weight":"600"}},{default:r(()=>{var k;return[y(C((k=o.stageRun)==null?void 0:k.status),1)]}),_:1}),y(" "+C(e(Le)(new Date(o.stageRun.created_at),{addSuffix:!0})),1)]),_:1})]),default:r(()=>{var k,x,D;return[(k=o.stageRun)!=null&&k.assignee?(l(),i(e(Y),{key:0},{default:r(()=>{var v;return[y(" Assignee: "+C((v=o.stageRun)==null?void 0:v.assignee),1)]}),_:1})):w("",!0),((x=o.stageRun)==null?void 0:x.content)&&((D=o.stageRun)==null?void 0:D.content.length)>0?(l(),h("div",Xe,[u(e(Z),{level:4},{default:r(()=>[y("Thread data")]),_:1}),u(e(Re),{size:"small",layout:"vertical",column:1},{default:r(()=>{var v;return[(l(!0),h(b,null,S((v=o.stageRun)==null?void 0:v.content,O=>(l(),i(e(Pe),{key:O.key,label:O.key},{default:r(()=>[u(e(le),{"tree-data":e(ne)(O.value)},null,8,["tree-data"])]),_:2},1032,["label"]))),128))]}),_:1})])):w("",!0),u(e(Z),{level:4},{default:r(()=>[y("Thread history")]),_:1}),e(s)?(l(),i(e(oe),{key:2})):e(a)?(l(),i(e(B),{key:3,ghost:""},{default:r(()=>[(l(!0),h(b,null,S(e(a),({stage:v,stage_run:O,logs:I})=>(l(),i(e(M),{key:O.id},{header:r(()=>[u(e(de),{align:"center",gap:15},{default:r(()=>[u(he,{path:e(xe)(v.type)},null,8,["path"]),y(" "+C(v.title),1)]),_:2},1024)]),default:r(()=>[u(e(Te),null,{default:r(()=>[(l(!0),h(b,null,S(I,p=>(l(),i(Oe,{key:p.executionId,log:d(p)},null,8,["log"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):w("",!0)]}),_:1}))}}),Ze=[{value:"text",label:"Text"},{value:"image",label:"Image"},{value:"table",label:"Table"},{value:"progress-bar",label:"Progress Bar"}];class ae{static async get(){return(await fetch("/_editor/api/visualizations")).json()}static async put(t){const a=await fetch("/_editor/api/visualizations",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return Object.freeze(a.json())}}function et(n,t){const a=n.length;if(a!==t.length)return!1;for(let s=0;s<a;s++)if(n[s].name!==t[s].name||n[s].type!==t[s].type)return!1;return!0}function R(n,t){var a;return{...n,id:(a=t==null?void 0:t.toString())!=null?a:Math.random().toString(36).slice(2)}}class H{constructor(t){V(this,"initialItems");V(this,"_items");this.initialItems=t.map((a,s)=>R(a,s)),this._items=$(t.map((a,s)=>R(a,s)))}get items(){return this._items.value}hasChanges(){return!et(this.initialItems,this.items)}async save(){const t=await ae.put(this.items);this.initialItems=t.map((a,s)=>R(a,s)),this._items.value=t.map((a,s)=>R(a,s))}static async get(){const t=await ae.get();return new H(t)}add(){this.items.push(R({name:"New var",type:"text"}))}remove(t){const a=this.items.findIndex(s=>s.id===t);a!==-1&&this.items.splice(a,1)}}const tt=U({__name:"VisualizationEditor",setup(n){const{result:t,loading:a}=j(()=>H.get());return(s,d)=>(l(),i(e(ue),{open:"",title:"Visualization settings"},{extra:r(()=>[e(t)?(l(),i(Fe,{key:0,model:e(t),disabled:!e(t).hasChanges()},null,8,["model","disabled"])):w("",!0)]),default:r(()=>[e(a)||!e(t)?(l(),i(e(oe),{key:0})):(l(),i(e(F),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>[u(e(L),{onClick:d[0]||(d[0]=o=>e(t).add())},{default:r(()=>[y("Add")]),_:1}),u(e(B),{bordered:!1},{default:r(()=>[(l(!0),h(b,null,S(e(t).items,o=>(l(),i(e(M),{key:o.id},{header:r(()=>[o.name?(l(),i(e(Ne),{key:0,strong:!0},{default:r(()=>[y(C(o.name),1)]),_:2},1024)):w("",!0)]),extra:r(()=>[u(e(L),{danger:"",onClick:c=>e(t).remove(o.id)},{default:r(()=>[y(" Remove ")]),_:2},1032,["onClick"])]),default:r(()=>[u(e(ce),{layout:"vertical"},{default:r(()=>[u(e(q),{label:"Property name"},{default:r(()=>[u(e(be),{value:o.name,"onUpdate:value":c=>o.name=c},null,8,["value","onUpdate:value"])]),_:2},1024),u(e(q),null,{default:r(()=>[u(e(N),{value:o.type,"onUpdate:value":c=>o.type=c,label:"Visualization type"},{default:r(()=>[(l(!0),h(b,null,S(e(Ze),c=>(l(),i(e(E),{key:c.value,value:c.value},{default:r(()=>[y(C(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1}))}}),fe=["waiting","running","finished","failed"];function at(){const n=$([...fe]),t=$("");return{filterStatus:n,filterSearch:t}}const nt={class:"stages-container"},rt={class:"stages-content"},st={style:{"max-height":"200px","overflow-y":"hidden"}},lt=U({__name:"WorkflowKanban",setup(n){const{kanbanAsyncComputed:t,launchLink:a,setNewSelectedStageId:s,lastSelectedStage:d,init:o}=Ke({getKanbanData:Ge,getWorkspace:()=>Ee.get()}),{filterSearch:c,filterStatus:k}=at(),{closeDrawer:x,inspectStageRun:D,openVisualizationEditor:v,drawerState:O,selectedStageRunForDrawer:I}=He();return o(),(p,f)=>{const A=ke("router-link");return l(),h(b,null,[u(e(de),{vertical:"",style:{height:"100%"}},{default:r(()=>[u(e(B),{ghost:""},{default:r(()=>[u(e(M),{header:"Filters"},{default:r(()=>[u(e(ce),null,{default:r(()=>[u(e(q),{label:"Search"},{default:r(()=>[u(e(we),{value:e(c),"onUpdate:value":f[0]||(f[0]=g=>X(c)?c.value=g:null),placeholder:"Search",style:{width:"400px"}},null,8,["value"])]),_:1}),u(e(q),{label:"Status"},{default:r(()=>[u(e(N),{value:e(k),"onUpdate:value":f[1]||(f[1]=g=>X(k)?k.value=g:null),mode:"multiple",style:{width:"400px"}},{default:r(()=>[(l(!0),h(b,null,S(e(fe),g=>(l(),i(e(E),{key:g,value:g},{default:r(()=>[y(C(e(Je)({status:g}).text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),z("div",nt,[z("div",rt,[u(e(F),{align:"start"},{default:r(()=>{var g,T,K;return[(l(!0),h(b,null,S((T=(g=e(t).result.value)==null?void 0:g.columns)!=null?T:[],(m,G)=>(l(),i(e(F),{key:G,direction:"vertical"},{default:r(()=>[u(e(N),{style:{width:"100%","min-width":"200px"},"allow-clear":"",value:m.selected_stage.id,"onUpdate:value":_=>e(s)(_,G)},{default:r(()=>[(l(!0),h(b,null,S(m.stages,_=>(l(),i(e(E),{key:_.id,value:_.id},{default:r(()=>[y(C(_.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),m.selected_stage.id?(l(),i(e(F),{key:0,direction:"vertical",style:{width:"100%"}},{default:r(()=>[(l(!0),h(b,null,S(m.stage_run_cards,_=>{var Q;return l(),i(e(je),{key:_.id,size:"small",style:{"max-width":"250px",cursor:"pointer"},"body-style":{display:((Q=_.content)==null?void 0:Q.length)>0?"block":"none"},onClick:P=>e(D)(m,_)},{title:r(()=>[u(e(ie),null,{default:r(()=>[y(C(_.status),1)]),_:2},1024)]),default:r(()=>[z("div",st,[(l(!0),h(b,null,S(_.content,P=>(l(),i(e(le),{key:P.key,"tree-data":e(ne)(P.value)},null,8,["tree-data"]))),128))]),y(" "+C(_.assignee),1)]),actions:r(()=>[e(a)(m,_)?(l(),i(A,{key:0,to:e(a)(m,_),target:"_blank",onClick:f[2]||(f[2]=P=>P.stopPropagation())},{default:r(()=>[u(e(We))]),_:2},1032,["to"])):w("",!0)]),extra:r(()=>[u(e(qe),{onClick:P=>e(D)(m,_)},null,8,["onClick"])]),_:2},1032,["body-style","onClick"])}),128)),m.stage_run_cards.length===0?(l(),i(e(Se),{key:0})):w("",!0),m.selected_stage.can_be_started&&e(a)(m)!==null?(l(),i(A,{key:1,target:"_blank",to:e(a)(m)},{default:r(()=>[u(e(L),{style:{width:"100%"}},{default:r(()=>[y(" Start ")]),_:1})]),_:2},1032,["to"])):w("",!0)]),_:2},1024)):w("",!0)]),_:2},1024))),128)),e(t).result.value&&e(t).result.value.next_stage_options.length>0?(l(),i(e(N),{key:(K=e(d))==null?void 0:K.id,style:{width:"100%","min-width":"200px"},"allow-clear":"","onUpdate:value":f[3]||(f[3]=m=>e(s)(m,e(t).result.value.columns.length))},{default:r(()=>[(l(!0),h(b,null,S(e(t).result.value.next_stage_options,m=>(l(),i(e(E),{key:m.id,value:m.id},{default:r(()=>[y(C(m.title),1)]),_:2},1032,["value"]))),128))]),_:1})):w("",!0)]}),_:1})])])]),_:1}),e(O).state==="stage-run"&&e(I)?(l(),i(Ye,{key:0,"stage-run":e(I),onClose:e(x)},null,8,["stage-run","onClose"])):e(O).state==="visualizations"?(l(),i(tt,{key:1,onClose:e(x)},null,8,["onClose"])):w("",!0),u(e($e),{onClick:e(v)},{icon:r(()=>[u(e(Be))]),_:1},8,["onClick"])],64)}}});const Ut=Ce(lt,[["__scopeId","data-v-8cc79f02"]]);export{Ut as default};
//# sourceMappingURL=WorkflowKanban.d3e8dae8.js.map

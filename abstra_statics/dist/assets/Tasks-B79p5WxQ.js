import{h as l,I as J,a as B,c as R,i as d,H as Q,p as X,k as N,f as p,Q as U,w as a,u as e,b5 as $,b6 as P,ba as G,b4 as W,T as D,g as m,t as g,b as f,e as E,E as I,b9 as Y,bl as Z,X as K,a$ as ee,bA as te,bm as ae,be as ne,bp as le,ag as se,ak as oe}from"./jwt-decode.esm-BicT5bVN.js";import{_ as ie}from"./AbstraButton.vue_vue_type_script_setup_true_lang-BIjGauJ1.js";import{I as re}from"./PhCopy.vue-C0Ge1e8w.js";import{T as ue,R as ce}from"./tasksController-rUP1vxRJ.js";import{s as de}from"./metadata-B2ZFEX5j.js";import{t as pe}from"./ant-design-Dhhbe0yW.js";import{R as ge}from"./dayjs-DXUlioj2.js";import{c as j,d as A}from"./router-DgySwpZX.js";import{A as L}from"./index-27jUp0RU.js";import{B as fe,a as me}from"./build-DY8jtVga.js";import{P as _e}from"./project-OkOOskHh.js";import"./tables-Dghgxh0i.js";import{a as ye}from"./asyncComputed-B7wN3TEJ.js";import"./contracts.generated-DjBLjFuH.js";import"./record-B4usCteB.js";import"./linters-BzPJO9Js.js";import"./polling-CgD_pr4i.js";import"./taskCreator-DgvfoNa5.js";import"./PhMagnifyingGlass.vue-DrzhLQ-J.js";import"./PhWebhooksLogo.vue-CuUM6cwJ.js";import"./ts.worker-B2ibprJy.js";import"./string-Bb5jOs6Z.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new Error().stack;r&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[r]="b0e55e91-27d7-411b-9a4c-9b8be5a1f371",u._sentryDebugIdIdentifier="sentry-dbid-b0e55e91-27d7-411b-9a4c-9b8be5a1f371")}catch{}})();var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function M(u){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(i).filter(function(y){return Object.getOwnPropertyDescriptor(i,y).enumerable}))),_.forEach(function(y){we(u,y,i[y])})}return u}function we(u,r,i){return r in u?Object.defineProperty(u,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):u[r]=i,u}var O=function(r,i){var _=M({},r,i.attrs);return l(J,M({},_,{icon:be}),null)};O.displayName="SyncOutlined";O.inheritAttrs=!1;const ve=B({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean},stageId:{},status:{}},setup(u,{expose:r}){const i=u,{setup:_,tearDown:y,state:c,getColumns:v,fetchTasks:x,clearAllTasks:b,updateStatus:S}=ue({api:i.api,poll:!0,stages:i.stages,stageId:i.stageId,status:i.status}),C=(t,n)=>!n?.label||typeof n.label!="string"?!1:n.label.toLowerCase().includes(t.toLowerCase()),h=t=>{if(!t.completed?.at||!t.created?.at)return null;const n=new Date(t.created.at).getTime(),o=new Date(t.completed.at).getTime();return Math.round((o-n)/1e3)},T=t=>{if(!t.created?.at)return null;const n=new Date(t.created.at).getTime(),o=Date.now();return Math.round((o-n)/1e3)},z=t=>{if(t<60)return`${t}s`;const n=Math.floor(t/60);if(n<60){const k=t%60;return k>0?`${n}m ${k}s`:`${n}m`}const o=Math.floor(n/60);if(o<24){const k=n%60;return k>0?`${o}h ${k}m`:`${o}h`}const s=Math.floor(o/24),w=o%24;return w>0?`${s}d ${w}h`:`${s}d`},F=R(()=>i.stages?c.tasks.map(t=>{const n=i.stages?.find(o=>o.id===t.targetStageId);return n?{...t,targetStageTitle:n.stageTitle,targetStageType:n.stageType,completedAt:t.completed?.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1,duration:h(t),pendingDuration:T(t)}:{...t,targetStageTitle:null,targetStageType:null,completedAt:t.completed?.at?new Date(t.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),deleted:!0,duration:h(t),pendingDuration:T(t)}}):c.tasks.map(t=>({...t,deleted:!1,completedAt:t.completed?.at?new Date(t.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),duration:h(t),pendingDuration:T(t)}))),V=(t,n,o)=>{const s=t.current??1,w=t.pageSize??10;c.pagination.currentIndex=s-1,c.pagination.pageSize=w,x()},q=(t,n)=>`/_editor/${t}/${n}`,H=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),le.success({content:d.translate("i18n_tasksview_copied_to_clipboard")})};return r({clearAllTasks:b}),Q(()=>_()),X(()=>y()),(t,n)=>(p(),N(U,null,[l(e(G),{layout:"vertical"},{default:a(()=>[l(e(j),{gutter:10},{default:a(()=>[l(e(A),{span:6},{default:a(()=>[l(e($),{label:e(d).translate("i18n_tasksview_status_label")},{default:a(()=>[l(e(P),{value:e(c).filters.status,"onUpdate:value":n[0]||(n[0]=o=>e(c).filters.status=o),options:e(c).filterOptions.statuses,"option-label":"label","option-value":"value","show-search":"","filter-option":C,filter:!1,placeholder:e(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(A),{span:10},{default:a(()=>[l(e($),{label:e(d).translate("i18n_tasksview_stage_label")},{default:a(()=>[l(e(P),{value:e(c).filters.stage,"onUpdate:value":n[1]||(n[1]=o=>e(c).filters.stage=o),"show-search":"","filter-option":C,options:e(c).filterOptions.stages,placeholder:e(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(A),{span:8},{default:a(()=>[l(e($),{label:e(d).translate("i18n_tasksview_created_at_date_label")},{default:a(()=>[l(e(ge),{value:e(c).filters.dateRange,"onUpdate:value":n[2]||(n[2]=o=>e(c).filters.dateRange=o),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),l(e(ne),{columns:e(v)(),"data-source":F.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(c).pagination.currentIndex+1,pageSize:e(c).pagination.pageSize,total:e(c).pagination.totalCount},onChange:V},{bodyCell:a(({column:o,record:s})=>[o.key==="timeInfo"?(p(),f(e(I),{key:0,vertical:"",gap:4},{default:a(()=>[l(e(D),null,{default:a(()=>[m(g(s.createdAt),1)]),_:2},1024),s.status==="locked"?(p(),f(e(L),{key:0,type:"info"},{message:a(()=>[m(g(e(d).translate("i18n_tasksview_status_running")),1)]),default:a(()=>[l(e(O),{spin:!0,style:{"margin-left":"4px"}})]),_:1})):(p(),f(e(L),{key:1,type:s.status==="pending"?"warning":"success"},Y({action:a(()=>[l(e(Z),{size:"small",checked:s.status==="completed","onUpdate:checked":w=>e(S)(s,s.status==="pending"?"completed":"pending")},null,8,["checked","onUpdate:checked"])]),_:2},[s.status==="pending"?{name:"message",fn:a(()=>[m(g(e(d).translate("i18n_tasksview_pending_for"))+" "+g(z(s.pendingDuration)),1)]),key:"0"}:s.status==="completed"?{name:"message",fn:a(()=>[m(g(e(d).translate("i18n_tasksview_completed_in"))+" "+g(z(s.duration)),1)]),key:"1"}:void 0]),1032,["type"]))]),_:2},1024)):o.key==="stageInfo"?(p(),f(e(I),{key:1,vertical:"",gap:4},{default:a(()=>[s.deleted?(p(),f(e(D),{key:0},{default:a(()=>[m(g(e(d).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),f(e(I),{key:1,gap:8,align:"center"},{default:a(()=>[(p(),f(K(e(de)(s.targetStageType)),{size:20})),l(e(I),{vertical:"",gap:0},{default:a(()=>[u.editor?(p(),f(e(ee),{key:0,href:q(s.targetStageType,s.targetStageId)},{default:a(()=>[m(g(s.targetStageTitle),1)]),_:2},1032,["href"])):(p(),f(e(D),{key:1},{default:a(()=>[m(g(s.targetStageTitle),1)]),_:2},1024)),l(e(D),{type:"secondary",style:{fontSize:"12px"}},{default:a(()=>[m(g(s.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024)):o.key==="payloadInfo"?(p(),f(e(I),{key:2,gap:8,align:"start",justify:"space-between"},{default:a(()=>[l(e(te),{"tree-data":e(pe)(s.payload),selectable:!1,style:{flex:"1"}},null,8,["tree-data"]),l(ie,{type:"text",size:"small",tooltip:e(d).translate("i18n_tasksview_copy_payload_tooltip"),onClick:ae(w=>H(s.payload),["stop"])},{default:a(()=>[l(e(re))]),_:1},8,["tooltip","onClick"])]),_:2},1024)):E("",!0)]),footer:a(()=>[l(e(j),{justify:"end",gutter:10},{default:a(()=>[l(e(A),null,{default:a(()=>[l(e(W),{size:"small"})]),_:1}),l(e(A),null,{default:a(()=>[l(e(D),null,{default:a(()=>[m(g(e(d).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Ve=B({__name:"Tasks",setup(u){const r=se(),i=r.params.projectId,_=r.query.stage,y=r.query.status,c=new ce(i),{result:v}=ye(async()=>{const S=(await fe.list(i)).find(T=>T.latest);if(!S)return null;const[C,h]=await Promise.all([me.get(S.id),_e.get(i)]);return{buildSpec:C,project:h}}),x=R(()=>!v.value||!v.value.buildSpec?null:v.value.buildSpec.runtimes.map(b=>({id:b.id,stageTitle:b.title,stageType:b.type})));return(b,S)=>(p(),N(U,null,[l(e(oe),null,{default:a(()=>[m(g(e(d).translate("i18n_tasksview_title")),1)]),_:1}),x.value?(p(),f(ve,{key:0,class:"tasks",api:e(c),stages:x.value,"stage-id":e(_),status:e(y)},null,8,["api","stages","stage-id","status"])):E("",!0)],64))}});export{Ve as default};
//# sourceMappingURL=Tasks-B79p5WxQ.js.map

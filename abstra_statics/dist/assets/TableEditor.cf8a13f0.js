import{a as S}from"./asyncComputed.3cb2e10b.js";import{d as B,H as q,b as e,c as n,x as t,W as h,Z as x,F as k,L as w,t as I,z as d,I as R,D as T,X as z,N as $,a3 as H,e as m,U as M,O as J,Q as K,q as Q,r as D,ad as U,w as C,J as W}from"./registerWidgets.ca6243ef.js";import{T as A}from"./tables.94b40ff0.js";import{L}from"./CircularLoading.5630a601.js";import{T as X,a as E}from"./Tab.55e05bca.js";import{B as Z}from"./BackButton.6790f37d.js";import{D as G,r as F,C as P,g as Y,i as ee}from"./icons.11151937.js";import{D as te}from"./DocsButton.b174b81b.js";import{S as le}from"./SaveButton.e379ab16.js";import"./activeRecord.11b7d185.js";import"./pubsub.581c075e.js";import"./lottie.9d24e472.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[o]="bb764d2d-0a40-40f1-a557-60b2c365403e",l._sentryDebugIdIdentifier="sentry-dbid-bb764d2d-0a40-40f1-a557-60b2c365403e")}catch{}})();const N=l=>(J("data-v-36a6e10a"),l=l(),K(),l),ae={class:"table-settings"},ne=N(()=>t("label",null,"Name",-1)),oe={class:"table-field"},se={class:"columns"},ue=N(()=>t("label",null,"Columns",-1)),de=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ie=["onUpdate:modelValue"],ce=["onUpdate:modelValue","disabled"],pe=N(()=>t("label",null,"Not null",-1)),me=["onClick"],be=B({__name:"TableSettings",props:{table:null},setup(l){var b;const o=l,{result:c}=S(()=>A.dbTypes()),g=q();(b=o.table)==null||b.onUpdate(()=>{g.replace({name:"tableEditor",params:{tableName:o.table.name}})});function v(p){confirm(`Are you sure you want to delete column "${p}"?`)&&o.table.deleteColumn(p)}function u(){if(!c.value)return;const p=c.value[0].type,_=prompt("Enter column name");!_||o.table.addColumn(_,p)}return(p,_)=>(e(),n("div",ae,[ne,t("div",oe,[h(t("input",{"onUpdate:modelValue":_[0]||(_[0]=a=>l.table.name=a),class:"table-name"},null,512),[[x,l.table.name]])]),t("div",se,[ue,(e(!0),n(k,null,w(l.table.getColumns(),a=>(e(),n("div",{key:a.id,class:"column"},[a.primary_key?(e(),I(R,{key:0,class:"column-primary-key",path:d(G)},null,8,["path"])):T("",!0),d(c)?h((e(),n("select",{key:1,"onUpdate:modelValue":i=>a.type=i,class:"column-type"},[(e(!0),n(k,null,w(d(c),i=>(e(),n("option",{key:i.type},$(i.type),1))),128))],8,de)),[[z,a.type]]):T("",!0),h(t("input",{"onUpdate:modelValue":i=>a.name=i,class:"column-name",placeholder:"Column name"},null,8,re),[[x,a.name]]),h(t("input",{"onUpdate:modelValue":i=>a.default=i,class:"column-default",placeholder:"Default value"},null,8,ie),[[x,a.default]]),h(t("input",{"onUpdate:modelValue":i=>a.not_null=i,type:"checkbox",disabled:!a.default},null,8,ce),[[H,a.not_null]]),pe,a.primary_key?T("",!0):(e(),n("button",{key:2,class:"button delete",onClick:i=>v(a.name)},[m(R,{path:d(F)},null,8,["path"])],8,me))]))),128)),t("button",{class:"button add",onClick:_[1]||(_[1]=a=>u())},[m(R,{path:d(P)},null,8,["path"]),M(" Add Column")])])]))}});const _e=Q(be,[["__scopeId","data-v-36a6e10a"]]),ve={class:"table-data"},ye={class:"column-header"},fe={class:"column-name"},he=t("th",null,null,-1),ke={key:1},we=["open"],ge={key:0,class:"editing-row-content"},Ce={class:"editing-row-header"},$e=["onUpdate:modelValue"],Te={key:0,class:"row-error"},Ve=B({__name:"TableData",props:{table:null},setup(l){const o=l,{result:c,loading:g,refetch:v}=S(()=>o.table.select()),u=D(null),b=D(null),p=D(null);function _(){!o.table||(u.value={},p.value=null,b.value=null)}function a(r){return Object.keys(r).reduce((V,s)=>{var y;return(y=o.table.getColumns().find(f=>f.name===s))!=null&&y.primary_key?{[s]:r[s]}:V},{})}async function i(){if(!(!o.table||!u.value))if(p.value){const r=await o.table.updateRow(a(p.value),u.value);r.type==="update-row:error"?b.value=r.reason:(u.value=null,p.value=null,b.value=null,v())}else{const r=await o.table.insertRow(u.value);r.type==="insert-row:error"?b.value=r.reason:(u.value=null,p.value=null,b.value=null,v())}}function O(r){!o.table||(u.value={...r},p.value={...r},b.value=null)}async function j(r){confirm("Are you sure you want to delete this row?")&&(await o.table.deleteRow(a(r)),v())}return(r,V)=>(e(),n("div",ve,[t("button",{class:"add-row",onClick:_},"Add Row"),t("table",null,[t("thead",null,[t("tr",null,[(e(!0),n(k,null,w(l.table.getColumns(),s=>(e(),n("th",{key:s.id},[t("div",ye,[t("div",fe,$(s.name),1)])]))),128)),he])]),d(g)?(e(),I(L,{key:0})):(e(),n("tbody",ke,[(e(!0),n(k,null,w(d(c),(s,y)=>(e(),n("tr",{key:y},[(e(!0),n(k,null,w(l.table.getColumns(),f=>(e(),n("td",{key:f.id},$(s[f.name]),1))),128)),t("td",null,[m(U,{class:"delete-row",path:d(F),onClick:f=>j(s)},null,8,["path","onClick"]),m(U,{class:"edit-row",path:d(Y),onClick:f=>O(s)},null,8,["path","onClick"])])]))),128))]))]),t("dialog",{class:"editing-row-container",open:!!u.value},[u.value?(e(),n("div",ge,[t("div",Ce,[M(" New Row "),m(U,{path:d(ee),class:"close",onClick:V[0]||(V[0]=s=>u.value=null)},null,8,["path"])]),(e(!0),n(k,null,w(l.table.getColumns(),s=>(e(),n("div",{key:s.id,class:"column"},[t("label",null,$(s.name),1),h(t("input",{"onUpdate:modelValue":y=>u.value[s.name]=y,type:"text"},null,8,$e),[[x,u.value[s.name]]])]))),128)),t("button",{class:"button save",onClick:i},"Save"),b.value?(e(),n("div",Te,$(b.value),1)):T("",!0)])):T("",!0)],8,we)]))}});const Fe=B({__name:"TableEditor",setup(l){const o=W(),{result:c,loading:g}=S(()=>A.get(o.params.tableName));return(v,u)=>d(g)||!d(c)?(e(),I(L,{key:0})):(e(),I(X,{key:1,class:"editor"},{left:C(()=>[m(Z,{link:"/_editor/tables"})]),right:C(()=>[m(te,{path:"tables/overview"}),m(le,{model:d(c)},null,8,["model"])]),default:C(()=>[m(E,{title:"Table data"},{default:C(()=>[m(Ve,{table:d(c)},null,8,["table"])]),_:1}),m(E,{title:"Settings"},{default:C(()=>[m(_e,{table:d(c)},null,8,["table"])]),_:1})]),_:1}))}});export{Fe as default};
//# sourceMappingURL=TableEditor.cf8a13f0.js.map

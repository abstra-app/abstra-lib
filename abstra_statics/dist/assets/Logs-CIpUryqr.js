import{a as he,j as de,c as ae,k as F,f as m,l as We,e as ue,m as E,n as Pe,r as C,s as ze,N as Ce,af as De,H as je,$ as $e,a0 as Ne,b as U,bm as Re,u as e,E as pe,w as o,h as l,b4 as ge,g as re,t as Q,T as Oe,ag as Ue,p as Fe,ak as Be,i as f,ba as xe,b5 as G,b3 as ke,J as ve,b6 as le,Q as Ze,Z as He,bh as Ve,bi as Xe,bj as Ie,c4 as Ge,bq as qe,c2 as oe,bp as ce,aK as Ye}from"./jwt-decode.esm-BRRA-bKi.js";import{R as Le,u as Ke,L as Qe,E as Je}from"./ExecutionContext-HycJ3Wz6.js";import{c as me,d as q,e as et,f as tt}from"./router-Bh5EUIsF.js";import{a as at,b as nt}from"./build-DGO78UwG.js";import"./tables-Cb0rOdcm.js";import{_ as fe}from"./AbstraButton.vue_vue_type_script_setup_true_lang-BpoWn2sZ.js";import{G as Ae}from"./PhBroom.vue-BtkXXd0o.js";import{G as lt}from"./PhDotsThreeVertical.vue-DlsrKbnK.js";import{I as ot}from"./PhStop.vue-DekcdGs8.js";import{F as st,D as it}from"./PhTextAa.vue-BCvB0A2O.js";import{S as Se}from"./index-87ABxo4B.js";import{T as rt,A as ye}from"./index-BSTksIR5.js";import{L as Te}from"./LoadingOutlined-DYARO-Yo.js";import{R as Me}from"./dayjs-CdA6bzAG.js";import"./string-BUHbcr79.js";import"./polling-D7gWgnWW.js";import"./ant-design-DPnaazIl.js";import"./PhCopy.vue-DgCitwRx.js";import"./PhRobot.vue-DH6ce0WX.js";import"./ts.worker-D9N1lSIu.js";import"./record-B_JjtlWo.js";(function(){try{var I=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new Error().stack;u&&(I._sentryDebugIds=I._sentryDebugIds||{},I._sentryDebugIds[u]="4dc26ebe-0191-4fde-8aa0-c3f4c3b55233",I._sentryDebugIdIdentifier="sentry-dbid-4dc26ebe-0191-4fde-8aa0-c3f4c3b55233")}catch{}})();const ut=["width","height","fill","transform"],dt={key:0},ct=E("path",{d:"M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"},null,-1),ft=[ct],pt={key:1},gt=E("path",{d:"M218.34,119.6,183.6,154.34a46.58,46.58,0,0,1-44.31,12.26c-.31.34-.62.67-.95,1L103.6,202.34A46.63,46.63,0,1,1,37.66,136.4L72.4,101.66A46.6,46.6,0,0,1,116.71,89.4c.31-.34.62-.67,1-1L152.4,53.66a46.63,46.63,0,0,1,65.94,65.94Z",opacity:"0.2"},null,-1),ht=E("path",{d:"M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,7.78,8.22H152a8,8,0,0,0,8-7.78A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"},null,-1),vt=[gt,ht],mt={key:2},yt=E("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM115.7,192.49a43.31,43.31,0,0,1-55-66.43l25.37-25.37a43.35,43.35,0,0,1,61.25,0,42.9,42.9,0,0,1,9.95,15.43,8,8,0,1,1-15,5.6A27.33,27.33,0,0,0,97.37,112L72,137.37a27.32,27.32,0,0,0,34.68,41.91,8,8,0,1,1,9,13.21Zm79.61-62.55-25.37,25.37A43,43,0,0,1,139.32,168h0a43.35,43.35,0,0,1-40.53-28.12,8,8,0,1,1,15-5.6A27.35,27.35,0,0,0,139.28,152h0a27.14,27.14,0,0,0,19.32-8L184,118.63a27.32,27.32,0,0,0-34.68-41.91,8,8,0,1,1-9-13.21,43.32,43.32,0,0,1,55,66.43Z"},null,-1),_t=[yt],wt={key:3},bt=E("path",{d:"M238,88.18a52.42,52.42,0,0,1-15.4,35.66l-34.75,34.75A52.28,52.28,0,0,1,150.62,174h-.05A52.63,52.63,0,0,1,98,119.9a6,6,0,0,1,6-5.84h.17a6,6,0,0,1,5.83,6.16A40.62,40.62,0,0,0,150.58,162h0a40.4,40.4,0,0,0,28.73-11.9l34.75-34.74A40.63,40.63,0,0,0,156.63,57.9l-11,11a6,6,0,0,1-8.49-8.49l11-11a52.62,52.62,0,0,1,74.43,0A52.83,52.83,0,0,1,238,88.18Zm-127.62,98.9-11,11A40.36,40.36,0,0,1,70.6,210h0a40.63,40.63,0,0,1-28.7-69.36L76.62,105.9A40.63,40.63,0,0,1,146,135.77a6,6,0,0,0,5.83,6.16H152a6,6,0,0,0,6-5.84A52.63,52.63,0,0,0,68.14,97.42L33.38,132.16A52.63,52.63,0,0,0,70.56,222h0a52.26,52.26,0,0,0,37.22-15.42l11-11a6,6,0,1,0-8.49-8.48Z"},null,-1),xt=[bt],kt={key:4},It=E("path",{d:"M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,16,.45A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"},null,-1),At=[It],St={key:5},Tt=E("path",{d:"M236,88.12a50.44,50.44,0,0,1-14.81,34.31l-34.75,34.74A50.33,50.33,0,0,1,150.62,172h-.05A50.63,50.63,0,0,1,100,120a4,4,0,0,1,4-3.89h.11a4,4,0,0,1,3.89,4.11A42.64,42.64,0,0,0,150.58,164h0a42.32,42.32,0,0,0,30.14-12.49l34.75-34.74a42.63,42.63,0,1,0-60.29-60.28l-11,11a4,4,0,0,1-5.66-5.65l11-11A50.64,50.64,0,0,1,236,88.12ZM111.78,188.49l-11,11A42.33,42.33,0,0,1,70.6,212h0a42.63,42.63,0,0,1-30.11-72.77l34.75-34.74A42.63,42.63,0,0,1,148,135.82a4,4,0,0,0,8,.23A50.64,50.64,0,0,0,69.55,98.83L34.8,133.57A50.63,50.63,0,0,0,70.56,220h0a50.33,50.33,0,0,0,35.81-14.83l11-11a4,4,0,1,0-5.65-5.66Z"},null,-1),Mt=[Tt],Et={name:"PhLink"},Ct=he({...Et,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(I){const u=I,A=de("weight","regular"),D=de("size","1em"),M=de("color","currentColor"),$=de("mirrored",!1),_=ae(()=>u.weight??A),R=ae(()=>u.size??D),w=ae(()=>u.color??M),x=ae(()=>u.mirrored!==void 0?u.mirrored?"scale(-1, 1)":void 0:$?"scale(-1, 1)":void 0);return(J,b)=>(m(),F("svg",Pe({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:R.value,height:R.value,fill:w.value,transform:x.value},J.$attrs),[We(J.$slots,"default"),_.value==="bold"?(m(),F("g",dt,ft)):_.value==="duotone"?(m(),F("g",pt,vt)):_.value==="fill"?(m(),F("g",mt,_t)):_.value==="light"?(m(),F("g",wt,xt)):_.value==="regular"?(m(),F("g",kt,At)):_.value==="thin"?(m(),F("g",St,Mt)):ue("",!0)],16,ut))}}),Dt={0:"pending",1:"running",2:"finished",3:"failed"};function Ee(I){return new Worker("/assets/timeline.worker-CTtnDIl5.js",{type:"module",name:I?.name})}function Rt(){const I=C(!0),u=C(!1),A=C(null),D=C([]),M=C([]),$=ze([]),_=new Map,R=C(Date.now()),w=C(Date.now()),x=C(Date.now()-6e4),J=C(null);let b=null,ee=null;const W=new Le,z=200,B=ae(()=>{const c=(w.value-x.value)/6e4;return c<10?1:c<60?5:c<720?30:c<1440?60:c<1440*7?360:1440}),j=ae(()=>{const y=B.value*6e4,S=Math.floor(x.value/y)*y,P=Math.ceil(w.value/y)*y,T=[];for(let L=S;L<=P;L+=y)T.push(new Date(L));return T});function n(c){return _.get(c)}function Z(c,y){b||(b=new Ee,Y()),b.postMessage({type:"initCanvas",payload:{canvas:c,pixelRatio:y}},[c])}function Y(){b&&(b.onmessage=c=>{const{buffers:y}=c.data;y&&($.value=y)})}function V(c,y,S=!1){if(!b)return;const P=c.map(T=>{const L=T.context,r=L?.sentTasks?[...L.sentTasks]:[];return{id:T.id,stageId:T.stageId,createdAt:T.createdAt.getTime(),updatedAt:T.updatedAt.getTime(),sentTasks:r,triggerTaskId:L?.taskId||void 0,status:T.status,shortId:T.shortId,context:T.context}});b.postMessage({type:"data",payload:{executions:P,tasks:y,reset:S}})}function ne(){b&&b.postMessage({type:"stagesList",payload:JSON.parse(JSON.stringify(M.value))})}function H(c){b&&b.postMessage({type:"view",payload:c})}function s(){b&&b.postMessage({type:"view",payload:{now:R.value,viewStart:x.value,viewEnd:w.value,spacerWidth:z,rootId:J.value}})}async function t(c,y){const S=new Set,P=[y];let T=0;const L=1e3;u.value=!0;const r=new Set;try{for(;P.length>0&&T<L;){const i=P.shift();if(S.has(i))continue;S.add(i),T++;let g=_.get(i);if(g||(g=await W.get(c,i),_.set(g.id,g)),!r.has(g.stageId)){r.add(g.stageId);const d=D.value.filter(X=>r.has(X.id));d.length!==M.value.length&&(M.value=d,ne())}const p=await W.getExecutionTasks(c,i),k={};if(p.sentTasks.forEach(d=>{k[d.id]={start:new Date(d.created.at).getTime(),end:d.completed?new Date(d.completed.at).getTime():void 0}}),p.triggerTask){const d=p.triggerTask;k[d.id]={start:new Date(d.created.at).getTime(),end:d.completed?new Date(d.completed.at).getTime():void 0}}if(V([g],k,!1),i===y){const d=g.createdAt.getTime(),X=g.updatedAt.getTime(),v=Math.max(1e3,X-d);x.value=d-v,w.value=X+v,I.value=!1}p.triggerTask&&p.triggerTask.created.byExecutionId&&(S.has(p.triggerTask.created.byExecutionId)||P.push(p.triggerTask.created.byExecutionId)),p.sentTasks.forEach(d=>{d.completed&&d.completed.byExecutionId&&(S.has(d.completed.byExecutionId)||P.push(d.completed.byExecutionId))})}}catch(i){console.error("Error loading thread",i),A.value="Failed to load execution thread."}finally{u.value=!1,I.value=!1}}async function a(c,y){if(I.value=!0,A.value=null,M.value=[],D.value=[],$.value=[],R.value=Date.now(),_.clear(),!y){A.value="No execution ID provided.",I.value=!1;return}J.value=y,b||(b=new Ee,Y()),ee||(ee=setInterval(()=>{R.value=Date.now()},6e4));try{const S=await W.get(c,y);if(_.set(S.id,S),S.buildId){const P=await at.get(S.buildId);P&&(D.value=P.runtimesSorted)}V([],{},!0),await t(c,y)}catch(S){A.value="Failed to load data.",console.error(S),I.value=!1}}function h(){b&&(b.terminate(),b=null),ee&&(clearInterval(ee),ee=null)}return Ce([M,R,x,w],()=>{s()}),{initialLoading:I,loadingGraph:u,error:A,stages:M,stageBuffers:$,viewStart:x,viewEnd:w,now:R,timelineInterval:B,moments:j,init:a,cleanup:h,postDataToWorker:V,initCanvas:Z,updateView:H,getExecution:n}}const Lt={style:{height:"100%","min-height":"400px",position:"relative",overflow:"hidden"}},Wt={key:2,style:{position:"absolute",top:"10px",right:"220px","z-index":"10","pointer-events":"none"}},O=200,se=32,ie=40,Pt=he({__name:"TimelineComponent",props:{projectId:{},execution:{}},setup(I){const u=I,A=De(),{initialLoading:D,loadingGraph:M,error:$,stages:_,stageBuffers:R,viewStart:w,viewEnd:x,init:J,cleanup:b,initCanvas:ee,updateView:W}=Rt(),z=C(null),B=C(null),j=C(0),n=C(null),Z=C(!1),Y=C(0),V=C(0),ne=ae(()=>{const r=B.value;if(!r)return 0;const i=r.height/window.devicePixelRatio-se;return Math.max(0,_.value.length*ie-i)});function H(r){if(!z.value)return 0;const i=z.value.clientWidth-O,g=x.value-w.value,p=r-O;return w.value+p/i*g}function s(r){if(!z.value)return 0;const i=z.value.clientWidth-O,g=x.value-w.value,p=r-w.value;return O+p/g*i}function t(r){if(!B.value)return{x:0,y:0};const i=B.value.getBoundingClientRect();return{x:r.clientX-i.left,y:r.clientY-i.top}}function a(r,i){const g=i-se;if(r>O){const p=H(r),k=g+j.value;if(k>=0){const d=Math.floor(k/ie);if(d>=0&&d<_.value.length){const X=_.value[d],v=R.value.find(K=>K.stageId===X.id);if(v){const K=v.count;for(let N=0;N<K;N++){const _e=v.starts[N],we=v.ends[N];if(p>=_e&&p<=we){const be=d*ie+(ie-24)/2;if(k>=be&&k<=be+24)return{type:"execution",data:{id:v.ids[N],status:Dt[v.statuses[N]]||"unknown",start:_e,end:we}}}}}}}}return null}const h=r=>{const{x:i,y:g}=t(r),p=g-se+j.value,k=Math.floor(p/ie);if(k>=0&&k<_.value.length&&g>se){const v=_.value[k];n.value!==v.id&&(n.value=v.id,W({hoveredStageId:v.id}))}else n.value!==null&&(n.value=null,W({hoveredStageId:null}));if(Z.value){V.value=H(i);const v=s(Y.value)-O,K=s(V.value)-O;W({selection:{active:!0,start:v,end:K}})}let d={visible:!1,x:0,label:""},X={visible:!1,x:0,y:0,title:"",items:[]};if(i>O){const v=H(i),K=new Date(v);if(!isNaN(K.getTime())){const N=K.toLocaleString([],{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});d={visible:!0,x:i-O,label:N}}}if(i>O&&g>se){const v=a(i,g);if(v){document.body.style.cursor="pointer";const N=((v.data.end-v.data.start)/1e3).toFixed(3)+" s";X={visible:!0,x:i,y:g,title:v.type==="execution"?"Execution":"Task",items:[`Status: ${v.data.status}`,`ID: ${v.data.id}`,`Duration: ${N}`]}}else document.body.style.cursor="default"}else document.body.style.cursor="default";W({cursor:d,tooltip:X})},c=()=>{W({cursor:{visible:!1,x:0},tooltip:{visible:!1,x:0,y:0},hoveredStageId:null}),n.value=null,document.body.style.cursor="default"},y=r=>{const{x:i,y:g}=t(r);if(i<=O)return;const p=a(i,g);p&&p.type==="execution"||(Z.value=!0,Y.value=H(i),V.value=Y.value)},S=r=>{const{x:i,y:g}=t(r);if(Z.value){const p=Math.min(Y.value,V.value),k=Math.max(Y.value,V.value);k-p>100&&(w.value=p,x.value=k),Z.value=!1,W({selection:{active:!1,start:0,end:0}})}else{const p=a(i,g);if(p&&p.type==="execution"){const k=A.resolve({name:"logs",params:{projectId:u.projectId},query:{executionId:p.data.id}});window.open(k.href,"_blank")}}},P=r=>{if(!z.value)return;const i=z.value.clientWidth-O,g=x.value-w.value;if(r.ctrlKey){const k=Math.exp(-r.deltaY*.005),d=g/k;if(d<100||d>1e3*60*60*24*365*10)return;const X=B.value.getBoundingClientRect(),v=r.clientX-X.left-O,N=w.value+v/i*g-v/i*d;w.value=N,x.value=N+d}else{const p=i/(g/6e4),k=r.deltaX/p*6e4;w.value+=k,x.value+=k,j.value=Math.max(0,Math.min(ne.value,j.value+r.deltaY)),W({scrollTop:j.value})}},T=r=>{r.key==="Escape"&&Z.value&&(Z.value=!1,W({selection:{active:!1,start:0,end:0}}))},L=()=>{z.value&&W({viewportWidth:z.value.clientWidth,viewportHeight:z.value.clientHeight})};return je(async()=>{if(window.addEventListener("resize",L),window.addEventListener("keydown",T),B.value){const r=B.value.transferControlToOffscreen();ee(r,window.devicePixelRatio)}await $e(),L(),await J(u.projectId,u.execution.id)}),Ne(()=>{b(),window.removeEventListener("resize",L),window.removeEventListener("keydown",T)}),(r,i)=>(m(),F("div",Lt,[E("div",{ref_key:"canvasContainerRef",ref:z,style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},[E("canvas",{ref_key:"canvasRef",ref:B,style:{display:"block",width:"100%",height:"100%"},onMousemove:h,onMouseleave:c,onMousedown:y,onMouseup:S,onWheel:Re(P,["prevent"])},null,544)],512),e(D)?(m(),U(e(pe),{key:0,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"20",background:"#fff"},justify:"center",align:"center"},{default:o(()=>[l(e(ge),{size:"large"})]),_:1})):e($)?(m(),U(e(pe),{key:1,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"20",background:"#fff"},justify:"center",align:"center"},{default:o(()=>[l(e(Oe),{type:"danger"},{default:o(()=>[re(Q(e($)),1)]),_:1})]),_:1})):ue("",!0),e(M)&&!e(D)?(m(),F("div",Wt,[l(e(ge))])):ue("",!0)]))}});class te{constructor(u,A,D,M){this.major=u,this.minor=A,this.patch=D,this.dev=M}static from(u){if(u===null)return new te(0,0,0);const A=/^(\d+\.\d+\.\d+)(.dev(\d+))?$/,D=u.match(A);if(!D)return new te(0,0,0);const[,M,,$]=D,[_,R,w]=M.split(".").map(Number),x=$?Number($):void 0;return isNaN(_)||isNaN(R)||isNaN(w)?new te(0,0,0):x&&isNaN(x)?new te(0,0,0):new te(_,R,w,x)}gte(u){return this.major!==u.major?this.major>=u.major:this.minor!==u.minor?this.minor>=u.minor:this.patch>=u.patch}get version(){const u=this.dev?`.dev${this.dev}`:"";return`${this.major}.${this.minor}.${this.patch}${u}`}}const zt={class:"execution-header"},jt={class:"execution-header-left"},$t={key:0,class:"status-spinner"},Nt={class:"execution-info"},Ot={class:"execution-stage"},Ut={class:"execution-meta"},Ft={class:"execution-time"},Bt={key:0,style:{display:"flex",width:"100%","justify-content":"center"}},Zt=he({__name:"Logs",props:{executionRepository:{},buildRepository:{},showAllFilters:{type:Boolean}},setup(I){const u=I,A=Ue(),D=De(),M=A.params.projectId,$=A.query.executionId;function _(){const{stageId:s,buildId:t,status:a,startDate:h,endDate:c,executionId:y,payload:S,payloadMatchCase:P,payloadMatchWholeWord:T}=A.query,L={value:S,matchCase:P==="true",matchWholeWord:T==="true"};return h&&c?{stageId:s,buildId:t,status:a,dateRange:[oe(h),oe(c)],payload:L}:{stageId:s,buildId:t,status:a,search:y,payload:L}}function R(s){const t={};ne(),Object.entries(s).forEach(([a,h])=>{if(typeof h=="string"&&a==="search"&&h)t.executionId=h;else if(typeof h=="string"&&h)t[a]=h;else if(a==="dateRange"&&Array.isArray(h)&&oe.isDayjs(h[0])&&oe.isDayjs(h[1]))t.startDate=h[0].toISOString().slice(0,10),t.endDate=h[1].toISOString().slice(0,10);else if(a==="payload"&&h&&typeof h=="object"&&!Array.isArray(h)){const c=h;c.value&&(t.payload=c.value),c.matchCase&&(t.payloadMatchCase="true"),c.matchWholeWord&&(t.payloadMatchWholeWord="true")}}),D.replace({query:t})}function w(){const{page:s,pageSize:t}=A.query;return{currentIndex:s?parseInt(s,10):1,pageSize:t?parseInt(t,10):10}}function x(){n.filters.dateRange=void 0,n.filters.buildId=void 0,n.filters.stageId=void 0,n.filters.status=void 0,n.filters.search=void 0,n.filters.payload={value:void 0,matchCase:!1,matchWholeWord:!1}}function J(s){s=s.slice(0,6);const t=`${window.location.origin}${window.location.pathname}?executionId=${s}`;navigator.clipboard.writeText(t),ce.success({content:f.translate("i18n_logs_copied_to_clipboard")})}function b(s,t){let a={...s};return a.sentTasks=t.sentTasks,delete a.mockExecution,t.triggerTask&&(a.triggerTask=t.triggerTask,delete a.taskId),a}function ee(s){return new Intl.DateTimeFormat(navigator.language,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(s))}async function W(s){try{await j.stopExecution(s),ce.success({content:f.translate("i18n_logs_execution_stopped")})}catch{ce.error({content:f.translate("i18n_logs_execution_stop_error")})}}const z=te.from("3.26.3");function B(s){const t=n.filterOptions.builds.find(h=>h.value===s);return!t||!t.abstraVersion?!1:te.from(t.abstraVersion).gte(z)}const j=Ke();j.init({executionRepository:u.executionRepository,buildRepository:u.buildRepository,projectId:M,filters:_(),pagination:w(),pool:!0,openedExecutionId:$,onFilterChange:R});const{state:n}=j,Z=C(!1);Ce(()=>n.filterOptions.stages,s=>{Z.value=s.length>0},{immediate:!0});function Y(s){const t=n.filterOptions.stages.find(a=>a.value===s);return t?t.label:Z.value?f.translate("i18n_logs_deleted_stage"):f.translate("i18n_logs_stage_loading")}function V(s,t){j.fetchExecutionLogsPage(s,t)}Fe(()=>j.teardown());function ne(){const s=n.filters.dateRange,t=oe();!s||!s[1]?n.filters.dateRange=[t.subtract(90,"day"),t]:s[1].diff(s[0],"day")>90&&(n.filters.dateRange=[s[1].subtract(90,"day"),s[1]],ce.warning({content:f.translate("i18n_logs_date_range_limit_warning",null,90)}))}R(n.filters);function H(s,t){return t&&"label"in t&&typeof t.label=="string"?t.label.toLowerCase().includes(s.toLowerCase()):!0}return(s,t)=>(m(),U(e(Se),{direction:"vertical",style:{width:"100%",padding:"0px 0px 20px 0px"}},{default:o(()=>[l(e(Be),null,{default:o(()=>[re(Q(e(f).translate("i18n_logs_title")),1)]),_:1}),I.showAllFilters?(m(),U(e(xe),{key:0,layout:"vertical"},{default:o(()=>[l(e(me),{gutter:10},{default:o(()=>[l(e(q),{span:8},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_execution_id_label")},{default:o(()=>[l(e(ke),{value:e(n).filters.search,"onUpdate:value":t[0]||(t[0]=a=>e(n).filters.search=a),placeholder:e(f).translate("i18n_logs_search_by_execution_id_placeholder"),style:{width:"100%"},"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:8},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_payload_label")},{default:o(()=>[l(e(ke),{value:e(n).filters.payload.value,"onUpdate:value":t[3]||(t[3]=a=>e(n).filters.payload.value=a),placeholder:e(f).translate("i18n_logs_search_by_payload_placeholder"),style:{width:"100%"},"allow-clear":""},{suffix:o(()=>[E("span",{class:ve({"toggle-btn-active":e(n).filters.payload.matchCase})},[l(fe,{type:"text",size:"small",tooltip:e(f).translate("i18n_logs_match_case_tooltip"),onClick:t[1]||(t[1]=a=>e(n).filters.payload.matchCase=!e(n).filters.payload.matchCase)},{default:o(()=>[l(e(st))]),_:1},8,["tooltip"])],2),E("span",{class:ve({"toggle-btn-active":e(n).filters.payload.matchWholeWord})},[l(fe,{type:"text",size:"small",tooltip:e(f).translate("i18n_logs_match_whole_word_tooltip"),onClick:t[2]||(t[2]=a=>e(n).filters.payload.matchWholeWord=!e(n).filters.payload.matchWholeWord)},{default:o(()=>[l(e(it))]),_:1},8,["tooltip"])],2)]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:8},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_stage_label")},{default:o(()=>[l(e(le),{value:e(n).filters.stageId,"onUpdate:value":t[4]||(t[4]=a=>e(n).filters.stageId=a),options:e(n).filterOptions.stages,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":H},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),l(e(me),{gutter:10,align:"bottom"},{default:o(()=>[l(e(q),{span:8},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_date_label")},{default:o(()=>[l(e(Me),{value:e(n).filters.dateRange,"onUpdate:value":t[5]||(t[5]=a=>e(n).filters.dateRange=a),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:9},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_version_label")},{default:o(()=>[l(e(le),{value:e(n).filters.buildId,"onUpdate:value":t[6]||(t[6]=a=>e(n).filters.buildId=a),options:e(n).filterOptions.builds,"option-label":"label","option-value":"value",filter:!1,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":H},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:6},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_status_label")},{default:o(()=>[l(e(le),{value:e(n).filters.status,"onUpdate:value":t[7]||(t[7]=a=>e(n).filters.status=a),options:e(n).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":H},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:1},{default:o(()=>[l(e(G),null,{default:o(()=>[l(fe,{type:"text",size:"middle",tooltip:e(f).translate("i18n_logs_clear_filters_tooltip"),onClick:x},{default:o(()=>[l(e(Ae))]),_:1},8,["tooltip"])]),_:1})]),_:1})]),_:1})]),_:1})):(m(),U(e(xe),{key:1,layout:"vertical"},{default:o(()=>[l(e(me),{gutter:10,align:"bottom"},{default:o(()=>[l(e(q),{span:8},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_date_label")},{default:o(()=>[l(e(Me),{value:e(n).filters.dateRange,"onUpdate:value":t[8]||(t[8]=a=>e(n).filters.dateRange=a),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:10},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_script_label")},{default:o(()=>[l(e(le),{value:e(n).filters.stageId,"onUpdate:value":t[9]||(t[9]=a=>e(n).filters.stageId=a),options:e(n).filterOptions.stages,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":H},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:5},{default:o(()=>[l(e(G),{label:e(f).translate("i18n_logs_status_label")},{default:o(()=>[l(e(le),{value:e(n).filters.status,"onUpdate:value":t[10]||(t[10]=a=>e(n).filters.status=a),options:e(n).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":H},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(q),{span:1},{default:o(()=>[l(e(G),null,{default:o(()=>[l(fe,{type:"text",size:"middle",tooltip:e(f).translate("i18n_logs_clear_filters_tooltip"),onClick:x},{default:o(()=>[l(e(Ae))]),_:1},8,["tooltip"])]),_:1})]),_:1})]),_:1})]),_:1})),e(n).currentPage.loadingExecutions||e(n).currentPage.waitingDebounce?(m(),U(e(ge),{key:2,style:{width:"100%"}})):e(n).currentPage.executions&&e(n).currentPage.executions.length>0?(m(),U(e(Se),{key:3,direction:"vertical",style:{width:"100%"}},{default:o(()=>[l(e(et),{"active-key":e(n).currentPage.openedExecutionIds,"onUpdate:activeKey":t[12]||(t[12]=a=>e(n).currentPage.openedExecutionIds=a),bordered:!1,style:{"background-color":"transparent"},onChange:e(j).fetchEmptyLogs},{default:o(()=>[(m(!0),F(Ze,null,He(e(n).currentPage.executions,a=>(m(),U(e(tt),{key:a.id,class:"execution-card"},{header:o(()=>[E("div",zt,[E("div",jt,[a.status==="running"?(m(),F("div",$t,[l(e(Te),{spin:""})])):(m(),F("div",{key:1,class:ve(["status-dot",a.status])},null,2)),E("div",Nt,[E("span",Ot,[Z.value?ue("",!0):(m(),U(e(Te),{key:0,spin:"",style:{"margin-right":"6px"}})),re(" "+Q(Y(a.stageId)),1)]),E("span",Ut,Q(e(f).translate("i18n_logs_execution_id_label"))+": "+Q(a.id.slice(0,8))+" Â· "+Q(e(f).translate("i18n_logs_version_label"))+": "+Q(a.buildId.slice(0,8)),1)])]),E("span",Ft,Q(ee(a.createdAt)),1)])]),extra:o(()=>[l(e(Ve),{trigger:["click"],placement:"bottomRight"},{overlay:o(()=>[l(e(Xe),null,{default:o(()=>[l(e(Ie),{key:"copy",onClick:h=>J(a.id)},{default:o(()=>[l(e(pe),{align:"center",gap:8},{default:o(()=>[l(e(Ct),{size:16}),re(" "+Q(e(f).translate("i18n_logs_copy_url_tooltip")),1)]),_:1})]),_:1},8,["onClick"]),a.status==="running"&&B(a.buildId)?(m(),U(e(Ie),{key:"stop",danger:"",onClick:h=>W(a.id)},{default:o(()=>[l(e(pe),{align:"center",gap:8},{default:o(()=>[l(e(ot),{size:16}),re(" "+Q(e(f).translate("i18n_logs_stop_execution")),1)]),_:1})]),_:1},8,["onClick"])):ue("",!0)]),_:2},1024)]),default:o(()=>[E("div",{class:"execution-actions-trigger",onClick:t[11]||(t[11]=Re(()=>{},["stop"]))},[l(e(lt),{size:18})])]),_:2},1024)]),default:o(()=>[e(n).currentPage.executionData[a.id]?(m(),U(e(rt),{key:1},{default:o(()=>[l(e(ye),{key:"logs",tab:"Logs"},{default:o(()=>[l(Qe,{logs:e(n).currentPage.executionData[a.id].logs,pagination:e(n).currentPage.executionData[a.id].logsPagination,onPageChange:h=>V(a.id,h)},null,8,["logs","pagination","onPageChange"])]),_:2},1024),l(e(ye),{key:"context",tab:e(f).translate("i18n_executioncontext_header")},{default:o(()=>[l(Je,{data:b(a.context,e(n).currentPage.executionData[a.id].tasks),"show-fix-with-ai":!1},null,8,["data"])]),_:2},1032,["tab"]),l(e(ye),{key:"timeline",tab:"Timeline"},{default:o(()=>[l(Pt,{"project-id":e(M),execution:a},null,8,["project-id","execution"])]),_:2},1024)]),_:2},1024)):(m(),F("div",Bt,[l(e(ge))]))]),_:2},1024))),128))]),_:1},8,["active-key","onChange"]),l(e(Ge),{current:e(n).pagination.currentIndex,"onUpdate:current":t[13]||(t[13]=a=>e(n).pagination.currentIndex=a),"page-size":e(n).pagination.pageSize,"onUpdate:pageSize":t[14]||(t[14]=a=>e(n).pagination.pageSize=a),total:e(n).pagination.totalCount,"show-total":a=>e(f).translate("i18n_logs_found_runs",null,a),"show-size-changer":""},null,8,["current","page-size","total","show-total"])]),_:1})):(m(),U(e(qe),{key:4}))]),_:1}))}}),Ht=Ye(Zt,[["__scopeId","data-v-969b2b71"]]),pa=he({__name:"Logs",setup(I){const u=new Le,A=new nt;return(D,M)=>(m(),U(Ht,{"execution-repository":e(u),"build-repository":e(A),"show-all-filters":""},null,8,["execution-repository","build-repository"]))}});export{pa as default};
//# sourceMappingURL=Logs-CIpUryqr.js.map

import{B as D}from"./BaseLayout.a4179056.js";import{R as P,S as U,L as $,a as M,E as W,b as F,c as z}from"./SmartChat.7800d9cb.js";import{S as K}from"./SaveButton.7493eb67.js";import{L as O}from"./tasksController.1eeb9d5c.js";import{d as B,e as f,o as d,c as m,w as o,b as s,u as e,bL as V,cz as I,cy as N,f as L,Y as q,aB as H,eo as J,ea as X,X as Y,ah as j,eg as G,z as Q,S as k}from"./index.8a3dbfec.js";import{a as Z}from"./asyncComputed.272f4060.js";import"./linters.9ac9fe2b.js";import{S as ee}from"./scripts.7883e3f8.js";import{W as te}from"./workspaces.225a977a.js";import{_ as se}from"./RunButton.vue_vue_type_script_setup_true_lang.e4f30948.js";import{T as ae}from"./TasksManager.b15ceaf6.js";import{N as re}from"./NavbarControls.7c90bbe3.js";import{b as oe}from"./index.1093fb28.js";import{A as h,T as E}from"./TabPane.e7e62dfc.js";import"./editor.ce4f3e79.js";import"./workspaceStore.afc5352b.js";import"./url.bcae2f8e.js";import"./colorHelpers.d77e373d.js";import"./validations.e98e1eed.js";import"./string.4eeb58c5.js";import"./uuid.ecbdcab5.js";import"./PhCaretRight.vue.b6660d97.js";import"./Badge.1d65f72e.js";import"./LoadingOutlined.45a34b90.js";import"./polling.21f86702.js";import"./PhFolder.vue.e305eb7f.js";import"./PhPencil.vue.1c6e02af.js";import"./toggleHighContrast.254600f4.js";import"./index.f48bc3d3.js";import"./Card.a92efb22.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.6878cdce.js";import"./Logo.8149f387.js";import"./ant-design.93c52ddf.js";import"./PhGear.vue.511c5bb3.js";import"./ai.d42f93e4.js";import"./PhCheckCircle.vue.32c1c328.js";import"./PhCopySimple.vue.5aefbba4.js";import"./Avatar.bb67110f.js";import"./UnsavedChangesHandler.d045e6b8.js";import"./ExclamationCircleOutlined.0a420e42.js";import"./gateway.f0040e48.js";import"./popupNotifcation.2fe235f0.js";import"./record.175a4c9e.js";import"./PhArrowSquareOut.vue.05face49.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.b7f9af1a.js";import"./index.279d5470.js";import"./CollapsePanel.df60edcc.js";import"./index.41611102.js";import"./index.a5652c7a.js";import"./CloseCircleOutlined.71dc3789.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.a69d42d4.js";import"./BookOutlined.defc6085.js";import"./PhChats.vue.a9be8a18.js";import"./index.af52b1fc.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[v]="83b759b8-9c8b-4b83-8015-af5b4aa2ac82",c._sentryDebugIdIdentifier="sentry-dbid-83b759b8-9c8b-4b83-8015-af5b4aa2ac82")}catch{}})();const ie=B({__name:"ScriptSettings",props:{script:{}},setup(c){const n=f(c.script);return(C,l)=>(d(),m(e(N),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:o(()=>[s(e(I),{label:"Name",required:""},{default:o(()=>[s(e(V),{value:n.value.title,"onUpdate:value":l[0]||(l[0]=b=>n.value.title=b)},null,8,["value"])]),_:1}),s(P,{runtime:n.value},null,8,["runtime"])]),_:1}))}}),ne={style:{width:"100%",display:"flex","flex-direction":"column"}},le=B({__name:"ScriptTester",props:{script:{},disabledWarning:{},tasks:{}},emits:["refetch-tasks"],setup(c,{emit:v}){const n=c,C=L(()=>{var i,p;return(p=(i=n.tasks)==null?void 0:i.map(u=>{const x=u.payload,w=JSON.stringify(x,null,2),S=w.length>80?w.slice(0,80)+"...":w,t=new Date(u.created.at).toLocaleString();return{label:`${S} - ${t}`,value:u.id}}))!=null?p:[]}),l=f(void 0),b=L(()=>l.value?null:{title:"No trigger task selected",message:"Please select the task that will trigger the script"}),y=f(!1),g=async()=>{var i;y.value=!0;try{await n.script.run((i=l.value)!=null?i:null)}finally{y.value=!1,l.value=void 0,v("refetch-tasks",n.script.id)}};return(i,p)=>(d(),q("div",ne,[s(e(N),{layout:"vertical",style:{overflow:"auto"}},{default:o(()=>[s(e(I),{label:"Trigger task"},{default:o(()=>[s(e(H),{options:C.value,value:l.value,onSelect:p[0]||(p[0]=u=>l.value=u)},null,8,["options","value"])]),_:1})]),_:1}),s(se,{loading:y.value,disabled:i.disabledWarning||b.value,onClick:g,onSave:p[1]||(p[1]=u=>i.script.save())},null,8,["loading","disabled"])]))}}),ct=B({__name:"ScriptEditor",setup(c){const v=J(),n=X();function C(){v.push({name:"stages"})}const l=f(null),b=f(null),y=a=>{!t.value||(t.value.script.file=a)},g=f("source-code"),i=f("test");function p(){var r;if(!t.value)return;const a=t.value.script.codeContent;(r=l.value)==null||r.updateLocalEditorCode(a)}const u=f(null),x=new O,w=L(()=>{var a;return(a=t.value)!=null&&a.script.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),S=async a=>{const r=await x.getStageTasks(a);u.value=r.tasks.filter(_=>_.status==="pending")},{result:t}=Z(async()=>{const[a,r]=await Promise.all([te.get(),ee.get(n.params.id)]);return S(r.id),Q({workspace:a,script:r})}),T=$.create(),R=new U(a=>T.log(a),n.params.id);Y(()=>{R.connect()}),j(()=>{R.close()});const A=a=>{var r;return a!==g.value&&((r=t.value)==null?void 0:r.script.hasChanges())};return(a,r)=>(d(),m(D,null,G({navbar:o(()=>[e(t)?(d(),m(e(oe),{key:0,title:e(t).script.title,style:{padding:"5px 25px",border:"1px solid #f6f6f6"},onBack:C},{extra:o(()=>[s(re,{"editing-model":e(t).script},null,8,["editing-model"])]),_:1},8,["title"])):k("",!0)]),content:o(()=>[e(t)?(d(),m(W,{key:0},{left:o(()=>[s(e(E),{"active-key":g.value,"onUpdate:activeKey":r[0]||(r[0]=_=>g.value=_)},{rightExtra:o(()=>[s(K,{model:e(t).script,onSave:p},null,8,["model"])]),default:o(()=>[s(e(h),{key:"source-code",tab:"Source code",disabled:A("source-code")},null,8,["disabled"]),s(e(h),{key:"settings",tab:"Settings",disabled:A("settings")},null,8,["disabled"])]),_:1},8,["active-key"]),g.value==="source-code"?(d(),m(F,{key:0,script:e(t).script,workspace:e(t).workspace,onUpdateFile:y},null,8,["script","workspace"])):k("",!0),e(t).script&&g.value==="settings"?(d(),m(ie,{key:1,script:e(t).script},null,8,["script"])):k("",!0)]),center:o(()=>[s(e(E),{"active-key":i.value,"onUpdate:activeKey":r[1]||(r[1]=_=>i.value=_)},{default:o(()=>[s(e(h),{key:"test",tab:"Test"}),s(e(h),{key:"tasks",tab:"Tasks"})]),_:1},8,["active-key"]),e(t).script&&i.value==="tasks"?(d(),m(ae,{key:0,ref:"tasksManager","stage-id":e(t).script.id,onRefetchTasks:S},null,8,["stage-id"])):k("",!0),e(t).script&&i.value==="test"?(d(),m(le,{key:1,ref:"tester",script:e(t).script,"disabled-warning":w.value,tasks:u.value,onRefetchTasks:S},null,8,["script","disabled-warning","tasks"])):k("",!0)]),right:o(()=>[s(z,{"stage-type":"scripts",workspace:e(t).workspace,stage:e(t).script,"log-service":e(T)},null,8,["workspace","stage","log-service"])]),_:1})):k("",!0)]),_:2},[e(t)?{name:"footer",fn:o(()=>[s(M,{ref_key:"smartConsole",ref:b,"stage-type":"scripts",stage:e(t).script,"log-service":e(T),workspace:e(t).workspace},null,8,["stage","log-service","workspace"])]),key:"0"}:void 0]),1024))}});export{ct as default};
//# sourceMappingURL=ScriptEditor.089786a3.js.map

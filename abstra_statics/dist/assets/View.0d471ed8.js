import{d as w,G as R,b as d,c as f,w as a,u as e,f as n,bE as v,aq as g,cC as A,bx as D,ad as $,H as L,eP as q,eu as G,eB as te,eD as oe,aC as j,cp as P,eA as ae,r as I,ew as T}from"./outputWidgets.7d0a89ae.js";import{a as O}from"./asyncComputed.4a991554.js";import{A as C,F as h}from"./Form.88d12391.js";import{A as N}from"./index.933e2682.js";import{C as H}from"./CrudView.f24d64ac.js";import{G as K}from"./PhPencil.vue.f9d40053.js";import{A as ne}from"./index.0cd71c43.js";import{C as le,b as re}from"./repository.7cbcc56b.js";import{p as k}from"./popupNotifcation.c5b9b8ac.js";import{a as S}from"./ant-design.e1305d86.js";import{A as ie}from"./Title.4fae8161.js";import{A as V,T as se}from"./TabPane.3654ab11.js";import"./hasIn.69e272a1.js";import"./isNumeric.75337b1e.js";import"./Paragraph.0fa606da.js";import"./Text.07f71ef6.js";import"./Modal.bd62b8ab.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.8c79c3d4.js";import"./BookOutlined.95b699fd.js";import"./router.22b52423.js";import"./url.f5c9705f.js";import"./index.f86a7b65.js";import"./record.fdee0274.js";import"./pubsub.02f9bcdb.js";import"./fetch.5e2f27c5.js";import"./index.31cd11a6.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new Error().stack;l&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[l]="6383cdac-dea0-4666-8b61-c22ff9a9d266",s._sentryDebugIdIdentifier="sentry-dbid-6383cdac-dea0-4666-8b61-c22ff9a9d266")}catch{}})();const ue=w({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(s,{emit:l}){const t=s.roleOptions.map(u=>({label:u.name,value:u.name})),o=R({email:"",roles:[]});function i(){l("cancel")}function m(){!o.email||l("created",o)}return(u,y)=>(d(),f(e(N),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:a(()=>[n(e(A),null,{default:a(()=>[n(e(v),{onClick:i},{default:a(()=>[g("Cancel")]),_:1}),n(e(v),{type:"primary",onClick:m},{default:a(()=>[g("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(h),{model:o,layout:"vertical"},{default:a(()=>[n(e(C),{key:"email",label:"Email",required:!0},{default:a(()=>[n(e(D),{value:o.email,"onUpdate:value":y[0]||(y[0]=_=>o.email=_)},null,8,["value"])]),_:1}),n(e(C),{key:"role",label:"Role"},{default:a(()=>[n(e($),{value:o.roles,"onUpdate:value":y[1]||(y[1]=_=>o.roles=_),mode:"multiple",options:e(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),pe=w({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(s,{emit:l}){const r=s,t=r.roleOptions.map(u=>({label:u.name,value:u.name})),o=R({email:r.email,roles:r.roles});function i(){l("cancel")}function m(){l("updated",o)}return(u,y)=>(d(),f(e(N),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:a(()=>[n(e(A),null,{default:a(()=>[n(e(v),{onClick:i},{default:a(()=>[g("Cancel")]),_:1}),n(e(v),{type:"primary",onClick:m},{default:a(()=>[g("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(h),{model:o,layout:"vertical"},{default:a(()=>[n(e(C),{key:"email",label:"Email"},{default:a(()=>[n(e(D),{value:o.email,"onUpdate:value":y[0]||(y[0]=_=>o.email=_)},null,8,["value"])]),_:1}),n(e(C),{key:"role",label:"Role"},{default:a(()=>[n(e($),{value:o.roles,"onUpdate:value":y[1]||(y[1]=_=>o.roles=_),mode:"multiple",options:e(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),ce=w({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(s){const l=s,r=L(()=>{var t;return{columns:[{name:"Email"},{name:"Roles"},{name:"",align:"right"}],rows:(t=l.users.map(o=>({key:o.email,cells:[{type:"text",text:o.email},{type:"slot",key:"roles",payload:{roles:o.roles}},{type:"actions",actions:[{icon:K,label:"Edit",onClick:()=>l.onEdit(o)},{icon:q,label:"Delete",onClick:()=>l.onDelete(o)}]}]})))!=null?t:[]}});return(t,o)=>(d(),f(H,{"entity-name":"users",title:"",loading:t.loading,description:"List all app users.","empty-title":"No users yet",table:r.value,"create-button-text":"Add users",onCreate:t.onCreate},{roles:a(({payload:i})=>[(d(!0),G(j,null,te(i.roles,m=>(d(),f(e(ne),{key:m,bordered:""},{default:a(()=>[g(oe(m),1)]),_:2},1024))),128))]),_:1},8,["loading","table","onCreate"]))}}),de=w({__name:"NewRole",emits:["created","cancel"],setup(s,{emit:l}){const r=R({name:"",description:""});function t(){l("cancel")}function o(){!r.name||l("created",r)}return(i,m)=>(d(),f(e(N),{open:"",title:"New role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:t},{extra:a(()=>[n(e(A),null,{default:a(()=>[n(e(v),{onClick:t},{default:a(()=>[g("Cancel")]),_:1}),n(e(v),{type:"primary",onClick:o},{default:a(()=>[g("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(h),{model:r,layout:"vertical"},{default:a(()=>[n(e(C),{key:"name",label:"Name",required:!0},{default:a(()=>[n(e(D),{value:r.name,"onUpdate:value":m[0]||(m[0]=u=>r.name=u)},null,8,["value"])]),_:1}),n(e(C),{key:"description",label:"Description"},{default:a(()=>[n(e(P),{value:r.description,"onUpdate:value":m[1]||(m[1]=u=>r.description=u),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),me=w({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(s,{emit:l}){const r=s,t=R({description:r.description});function o(){l("cancel")}function i(){l("updated",t)}return(m,u)=>(d(),f(e(N),{open:"",title:"Update role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:o},{extra:a(()=>[n(e(A),null,{default:a(()=>[n(e(v),{onClick:o},{default:a(()=>[g("Cancel")]),_:1}),n(e(v),{type:"primary",onClick:i},{default:a(()=>[g("Submit")]),_:1})]),_:1})]),default:a(()=>[n(e(h),{model:t,layout:"vertical"},{default:a(()=>[n(e(C),{key:"name",label:"Name"},{default:a(()=>[n(e(D),{value:r.name,disabled:""},null,8,["value"])]),_:1}),n(e(C),{key:"role",label:"Role"},{default:a(()=>[n(e(P),{value:t.description,"onUpdate:value":u[0]||(u[0]=y=>t.description=y),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),ye=w({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(s){const l=s,r=L(()=>{var t;return{columns:[{name:"Name"},{name:"Description"},{name:"",align:"right"}],rows:(t=l.roles.map(o=>({key:o.id,cells:[{type:"text",text:o.name},{type:"text",text:o.description},{type:"actions",actions:[{icon:K,label:"Edit",onClick:()=>l.onEdit(o)},{icon:q,label:"Delete",onClick:()=>l.onDelete(o)}]}]})))!=null?t:[]}});return(t,o)=>(d(),f(H,{"entity-name":"roles",loading:t.loading,title:"",description:"List all app roles.","empty-title":"No roles yet",table:r.value,"create-button-text":"Add roles",onCreate:t.onCreate},null,8,["loading","table","onCreate"]))}}),Ge=w({__name:"View",setup(s){const r=ae().params.projectId,t=I({type:"initial"}),o=I("users"),i=()=>{t.value.type="initial"},m=()=>{t.value.type="creatingUser"},u=p=>{t.value={type:"editingUser",payload:p}},y=()=>{t.value.type="creatingRole"},_=p=>{t.value={type:"editingRole",payload:p}},U=new le(r),{loading:z,result:J,refetch:E}=O(()=>U.list(100,0)),x=new re(r),{loading:M,result:B,refetch:F}=O(()=>x.list(100,0)),Q=async p=>{try{if(t.value.type!=="creatingUser")return;await U.create(p),i(),E()}catch(c){c instanceof Error&&k("Create Error",c.message)}},W=async p=>{try{if(t.value.type!=="editingUser")return;await U.update(t.value.payload.id,p),i(),E()}catch(c){c instanceof Error&&k("Update Error",c.message)}},X=async p=>{if(!!await S("Deleteing users revoke their access to your application in case they aren't allowed to self sign-up. Are you sure you want to continue?"))try{await U.delete(p.id),E()}catch(b){b instanceof Error&&k("Delete Error",b.message)}},Y=async p=>{try{if(t.value.type!=="creatingRole")return;await x.create(p),i(),F()}catch(c){c instanceof Error&&k("Create Error",c.message)}},Z=async p=>{try{if(t.value.type!=="editingRole")return;await x.update(t.value.payload.id,p),i(),F()}catch(c){c instanceof Error&&k("Update Error",c.message)}},ee=async p=>{if(!!await S("Deleteing roles may revoke access to some features in your application. Are you sure you want to continue?"))try{await x.delete(p.id),F(),E()}catch(b){b instanceof Error&&k("Delete Error",b.message)}};return(p,c)=>(d(),G(j,null,[n(e(ie),null,{default:a(()=>[g("Access Control")]),_:1}),n(e(se),{"active-key":o.value,"onUpdate:activeKey":c[0]||(c[0]=b=>o.value=b)},{default:a(()=>[n(e(V),{key:"users",tab:"Users"}),n(e(V),{key:"roles",tab:"Roles"})]),_:1},8,["active-key"]),o.value==="users"?(d(),f(ce,{key:0,loading:e(z),users:e(J)||[],onCreate:m,onEdit:u,onDelete:X},null,8,["loading","users"])):T("",!0),o.value==="roles"?(d(),f(ye,{key:1,loading:e(M),roles:e(B)||[],onCreate:y,onEdit:_,onDelete:ee},null,8,["loading","roles"])):T("",!0),t.value.type==="creatingUser"?(d(),f(ue,{key:2,"role-options":e(B)||[],onCancel:i,onCreated:Q},null,8,["role-options"])):t.value.type==="editingUser"?(d(),f(pe,{key:3,email:t.value.payload.email,roles:t.value.payload.roles||[],"role-options":e(B)||[],onUpdated:W,onCancel:i},null,8,["email","roles","role-options"])):t.value.type==="creatingRole"?(d(),f(de,{key:4,onCancel:i,onCreated:Y})):t.value.type==="editingRole"?(d(),f(me,{key:5,name:t.value.payload.name,description:t.value.payload.description,onUpdated:Z,onCancel:i},null,8,["name","description"])):T("",!0)],64))}});export{Ge as default};
//# sourceMappingURL=View.0d471ed8.js.map

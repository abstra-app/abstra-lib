import{C as W}from"./CrudView-CEAuhr2p.js";import{a as x,j as C,c as k,k as f,f as i,l as T,e as _,m as b,n as F,h as d,I as j,c7 as Q,af as U,b as m,u as t,w as u,T as w,g as h,t as y,bh as J,bi as X,bj as Y,i as g,bq as ee,ag as te,H as le,p as ae,r as re,aL as ne,bf as ie,bg as oe,P as se,aN as ue,A as de,b4 as ce,ab as pe,Q as me,aK as fe}from"./jwt-decode.esm-fjkZIee2.js";import{a as D}from"./asyncComputed-BmCWu6_h.js";import{g as ge}from"./datetime-BuyrmVal.js";import{u as be}from"./polling-C38boXJn.js";import{G as ve}from"./PhArrowCounterClockwise.vue--nfxyucR.js";import{G as he}from"./PhDownloadSimple.vue-D7-rh20J.js";import{G as ye}from"./PhRobot.vue-CKWy0drz.js";import{L as _e,h as ke,r as Ae}from"./router-CvlvYtqS.js";import{B as we,a as Ce}from"./build-RMjo8p1L.js";import{P as Ze}from"./project-C4rJIGpZ.js";import"./tables-C-BtRrPx.js";import{G as Oe}from"./PhClockCounterClockwise.vue-DlZJLYed.js";import{F as $e,a as Me,G as Se,I as xe}from"./PhWebhooksLogo.vue-3AoG2lvl.js";import{S}from"./index-ueexH8UX.js";import{u as Pe}from"./omniChatStore-Bl2LEFfs.js";import{E as Ve}from"./ExclamationCircleOutlined-DNHT4S27.js";import{C as je}from"./CloseCircleOutlined-lpZ2iWTg.js";import{L as V}from"./LoadingOutlined-j_zuqFe8.js";import"./DocsButton.vue_vue_type_script_setup_true_lang-DnizXQTl.js";import"./constants-BWnkTKwV.js";import"./url-AMJ6SHft.js";import"./PhDotsThreeVertical.vue-Ld32P9do.js";import"./ts.worker-CLxkyooV.js";import"./record-lp259KRZ.js";import"./string-c089C_DZ.js";import"./uuid-C1F5kUX7.js";import"./PhCopySimple.vue-DNke9rIr.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="8ce291d8-3066-40f6-b091-60f295997315",r._sentryDebugIdIdentifier="sentry-dbid-8ce291d8-3066-40f6-b091-60f295997315")}catch{}})();var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};const Le=["width","height","fill","transform"],Be={key:0},De=b("path",{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},null,-1),Ne=[De],Ge={key:1},Ee=b("path",{d:"M128,129.09V232a8,8,0,0,1-3.84-1l-88-48.16a8,8,0,0,1-4.16-7V80.2a8,8,0,0,1,.7-3.27Z",opacity:"0.2"},null,-1),Te=b("path",{d:"M223.68,66.15,135.68,18h0a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,32h0l80.34,44L128,120,47.66,76ZM40,90l80,43.78v85.79L40,175.82Zm96,129.57V133.82L216,90v85.78Z"},null,-1),Fe=[Ee,Te],Ke={key:2},qe=b("path",{d:"M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,120,47.65,76,128,32l80.35,44Zm8,99.64V133.83l80-43.78v85.76Z"},null,-1),Re=[qe],He={key:3},We=b("path",{d:"M222.72,67.9l-88-48.17a13.9,13.9,0,0,0-13.44,0l-88,48.18A14,14,0,0,0,26,80.18v95.64a14,14,0,0,0,7.28,12.27l88,48.18a13.92,13.92,0,0,0,13.44,0l88-48.18A14,14,0,0,0,230,175.82V80.18A14,14,0,0,0,222.72,67.9ZM127,30.25a2,2,0,0,1,1.92,0L212.51,76,128,122.24,43.49,76ZM39,177.57a2,2,0,0,1-1-1.75V86.66l84,46V223Zm177.92,0L134,223V132.64l84-46v89.16A2,2,0,0,1,217,177.57Z"},null,-1),Qe=[We],Ue={key:4},Je=b("path",{d:"M223.68,66.15,135.68,18h0a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,32h0l80.34,44L128,120,47.66,76ZM40,90l80,43.78v85.79L40,175.82Zm96,129.57V133.82L216,90v85.78Z"},null,-1),Xe=[Je],Ye={key:5},et=b("path",{d:"M221.76,69.66l-88-48.18a12,12,0,0,0-11.52,0l-88,48.18A12,12,0,0,0,28,80.18v95.64a12,12,0,0,0,6.24,10.52l88,48.18a11.95,11.95,0,0,0,11.52,0l88-48.18A12,12,0,0,0,228,175.82V80.18A12,12,0,0,0,221.76,69.66ZM126.08,28.5a3.94,3.94,0,0,1,3.84,0L216.67,76,128,124.52,39.33,76Zm-88,150.83A4,4,0,0,1,36,175.82V83.29l88,48.16v94.91Zm179.84,0-85.92,47V131.45l88-48.16v92.53A4,4,0,0,1,217.92,179.32Z"},null,-1),tt=[et],lt={name:"PhCube"},at=x({...lt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const e=r,a=C("weight","regular"),s=C("size","1em"),p=C("color","currentColor"),O=C("mirrored",!1),o=k(()=>e.weight??a),A=k(()=>e.size??s),$=k(()=>e.color??p),M=k(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:O?"scale(-1, 1)":void 0);return(v,Z)=>(i(),f("svg",F({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:A.value,height:A.value,fill:$.value,transform:M.value},v.$attrs),[T(v.$slots,"default"),o.value==="bold"?(i(),f("g",Be,Ne)):o.value==="duotone"?(i(),f("g",Ge,Fe)):o.value==="fill"?(i(),f("g",Ke,Re)):o.value==="light"?(i(),f("g",He,Qe)):o.value==="regular"?(i(),f("g",Ue,Xe)):o.value==="thin"?(i(),f("g",Ye,tt)):_("",!0)],16,Le))}}),rt=["width","height","fill","transform"],nt={key:0},it=b("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-16-84a16,16,0,1,1-16-16A16,16,0,0,1,112,128Zm64,0a16,16,0,1,1-16-16A16,16,0,0,1,176,128Z"},null,-1),ot=[it],st={key:1},ut=b("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),dt=b("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm56-88a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),ct=[ut,dt],pt={key:2},mt=b("path",{d:"M128,24A104,104,0,1,0,232,128,104.13,104.13,0,0,0,128,24ZM84,140a12,12,0,1,1,12-12A12,12,0,0,1,84,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,172,140Z"},null,-1),ft=[mt],gt={key:3},bt=b("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm10-90a10,10,0,1,1-10-10A10,10,0,0,1,138,128Zm-44,0a10,10,0,1,1-10-10A10,10,0,0,1,94,128Zm88,0a10,10,0,1,1-10-10A10,10,0,0,1,182,128Z"},null,-1),vt=[bt],ht={key:4},yt=b("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm12-88a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-88,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),_t=[yt],kt={key:5},At=b("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm8-92a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-44,0a8,8,0,1,1-8-8A8,8,0,0,1,92,128Zm88,0a8,8,0,1,1-8-8A8,8,0,0,1,180,128Z"},null,-1),wt=[At],Ct={name:"PhDotsThreeCircle"},Zt=x({...Ct,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const e=r,a=C("weight","regular"),s=C("size","1em"),p=C("color","currentColor"),O=C("mirrored",!1),o=k(()=>e.weight??a),A=k(()=>e.size??s),$=k(()=>e.color??p),M=k(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:O?"scale(-1, 1)":void 0);return(v,Z)=>(i(),f("svg",F({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:A.value,height:A.value,fill:$.value,transform:M.value},v.$attrs),[T(v.$slots,"default"),o.value==="bold"?(i(),f("g",nt,ot)):o.value==="duotone"?(i(),f("g",st,ct)):o.value==="fill"?(i(),f("g",pt,ft)):o.value==="light"?(i(),f("g",gt,vt)):o.value==="regular"?(i(),f("g",ht,_t)):o.value==="thin"?(i(),f("g",kt,wt)):_("",!0)],16,rt))}});function N(r){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(p){return Object.getOwnPropertyDescriptor(a,p).enumerable}))),s.forEach(function(p){Ot(r,p,a[p])})}return r}function Ot(r,e,a){return e in r?Object.defineProperty(r,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[e]=a,r}var I=function(e,a){var s=N({},e,a.attrs);return d(j,N({},s,{icon:Q}),null)};I.displayName="CheckCircleOutlined";I.inheritAttrs=!1;function G(r){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(p){return Object.getOwnPropertyDescriptor(a,p).enumerable}))),s.forEach(function(p){$t(r,p,a[p])})}return r}function $t(r,e,a){return e in r?Object.defineProperty(r,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[e]=a,r}var z=function(e,a){var s=G({},e,a.attrs);return d(j,G({},s,{icon:Ie}),null)};z.displayName="MinusCircleOutlined";z.inheritAttrs=!1;function E(r){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(p){return Object.getOwnPropertyDescriptor(a,p).enumerable}))),s.forEach(function(p){Mt(r,p,a[p])})}return r}function Mt(r,e,a){return e in r?Object.defineProperty(r,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[e]=a,r}var L=function(e,a){var s=E({},e,a.attrs);return d(j,E({},s,{icon:ze}),null)};L.displayName="PauseCircleOutlined";L.inheritAttrs=!1;const St={style:{display:"flex","align-items":"center",gap:"5px"}},xt={key:1},Pt=x({__name:"BuildInspector",props:{buildSpec:{}},setup(r){const e=U(),a=r,s=p=>{e.push({name:"logs",params:{projectId:a.buildSpec.projectId},query:p.logQuery})};return(p,O)=>r.buildSpec.runtimes.length>0?(i(),m(t(_e),{key:0,"item-layout":"horizontal","data-source":r.buildSpec.runtimes},{renderItem:u(({item:o})=>[d(t(ke),null,{actions:u(()=>[d(t(J),null,{overlay:u(()=>[d(t(X),null,{default:u(()=>[d(t(Y),{onClick:A=>s(o)},{default:u(()=>[b("div",St,[d(t(Oe)),d(t(w),null,{default:u(()=>[h(y(t(g).translate("i18n_build_inspector_view_logs",null)),1)]),_:1})])]),_:1},8,["onClick"])]),_:2},1024)]),default:u(()=>[d(t(Zt),{style:{cursor:"pointer"}})]),_:2},1024)]),default:u(()=>[o.type=="form"?(i(),m(t(S),{key:0,size:"large"},{default:u(()=>[d(t($e)),d(t(w),{strong:""},{default:u(()=>[h(y(o.title),1)]),_:2},1024),d(t(w),{type:"secondary",code:""},{default:u(()=>[h("/"+y(o.path),1)]),_:2},1024)]),_:2},1024)):_("",!0),o.type=="job"?(i(),m(t(S),{key:1,size:"large"},{default:u(()=>[d(t(Me)),d(t(w),{strong:""},{default:u(()=>[h(y(o.title),1)]),_:2},1024),d(t(w),{type:"secondary",code:""},{default:u(()=>[h(y(o.schedule),1)]),_:2},1024)]),_:2},1024)):_("",!0),o.type=="hook"?(i(),m(t(S),{key:2,size:"large"},{default:u(()=>[d(t(Se)),d(t(w),{strong:""},{default:u(()=>[h(y(o.title),1)]),_:2},1024),d(t(w),{type:"secondary",code:""},{default:u(()=>[h("/_hooks/"+y(o.path),1)]),_:2},1024)]),_:2},1024)):_("",!0),o.type=="script"?(i(),m(t(S),{key:3,size:"large"},{default:u(()=>[d(t(xe)),d(t(w),{strong:""},{default:u(()=>[h(y(o.title),1)]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(i(),f("div",xt,[d(t(ee),{description:t(g).translate("i18n_build_inspector_no_runtimes",null)},null,8,["description"])]))}}),Vt=x({__name:"Builds",setup(r){const a=te().params.projectId,s=Pe();s.init("console",a);const p=async l=>{if(!l.log)return;s.open();const n=s.controller;n&&(n.setInput([g.translate("i18n_builds_fix_with_ai_prompt"),l.log].join(`
`)),await n.send())},{loading:O,result:o,refetch:A}=D(async()=>{const[l,n]=await Promise.all([we.list(a),Ze.getStatus(a)]);return{b:l.map(B=>({build:B,status:n.filter(P=>P.buildId==B.id).map(P=>P.status)})),status:n}}),{startPolling:$,endPolling:M}=be({task:A,interval:1e4});le(()=>$()),ae(()=>M());const v=re(null),Z=D(async()=>v.value?await Ce.get(v.value):null),K=()=>{const l=o.value?.b.find(c=>c.build.id===v.value);return`Version ${l?.build.id.slice(0,8)} - ${l?.build.createdAt.toLocaleString()}`},q=[{translationKey:"i18n_builds_deploying",tagColor:"blue",check:l=>(l.build.latest&&l.status.some(n=>n=="Running")&&o.value?.status.some(n=>n.buildId!==l.build.id))??!1,loading:!0},{translationKey:"i18n_builds_deactivating",tagColor:"orange",check:l=>l.build.status==="success"&&!l.build.latest&&l.status.some(n=>n=="Running"),loading:!0},{translationKey:"i18n_builds_live",tagColor:"green",check:l=>l.build.latest&&l.status.some(n=>n=="Running")},{translationKey:"i18n_builds_sleeping",tagColor:"cyan",check:l=>l.build.latest&&l.status.length===0},{translationKey:"i18n_builds_failed",tagColor:"red",check:l=>l.build.latest&&l.status.some(n=>n=="Failed")},{translationKey:"i18n_builds_inactive",tagColor:"default",check:l=>l.build.status==="success"},{translationKey:"i18n_builds_aborted",tagColor:"default",check:l=>l.build.status==="aborted"||l.build.status==="aborted-by-user"},{translationKey:"i18n_builds_failed",tagColor:"orange",check:l=>l.build.status==="failure"},{translationKey:"i18n_builds_deploying",tagColor:"blue",check:l=>l.build.status==="in-progress",loading:!0},{translationKey:"i18n_builds_uploading",tagColor:"yellow",check:l=>l.build.status==="pending"}];function R(l){const n=q.find(c=>c.check(l));return{text:n?g.translate(n.translationKey):"unknown",tagColor:n?.tagColor??"default",hover:l.build.log??void 0}}const H=k(()=>{const l=[{title:g.translate("i18n_builds_id")},{title:g.translate("i18n_builds_date")},{title:g.translate("i18n_builds_abstra_version")},{title:g.translate("i18n_builds_status")},{title:"",align:"right"}];return o.value?{columns:l,rows:o.value.b.map((n,c)=>({key:n.build.id,cells:[{type:"text",text:n.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:ge(n.build.createdAt,{weekday:void 0}),distance:ne(n.build.createdAt)}},{type:"text",text:n.build.abstraVersion??"-"},{key:"status",type:"slot",payload:R(n)},{type:"actions",actions:[{icon:at,label:g.translate("i18n_builds_inspect_version"),onClick:async()=>{v.value=n.build.id,Z.refetch()}},{icon:ve,label:g.translate("i18n_builds_view_application_logs"),onClick:()=>{Ae.push({name:"logs",params:{projectId:a},query:{buildId:n.build.id}})}},{icon:he,label:g.translate("i18n_builds_download_files"),onClick:()=>n.build.download()},{icon:ye,label:g.translate("i18n_builds_fix_with_ai"),onClick:()=>p(n.build),hide:n.build.status!=="failure"||!n.build.log,badge:c===0}]}]}))}:{columns:l,rows:[]}});return(l,n)=>(i(),f(me,null,[d(W,{"entity-name":"build",loading:t(O),title:t(g).translate("i18n_builds_version_history"),description:t(g).translate("i18n_builds_description"),"empty-title":t(g).translate("i18n_builds_empty_title"),table:H.value,live:""},{date:u(({payload:c})=>[d(t(de),null,{title:u(()=>[h(y(c.distance),1)]),default:u(()=>[h(y(c.date)+" ",1)]),_:2},1024)]),status:u(({payload:c})=>[d(t(ie),{open:c.hover?void 0:!1},{content:u(()=>[d(t(ue),{style:{width:"300px",overflow:"auto","font-family":"monospace"},content:c.hover,copyable:""},null,8,["content"])]),default:u(()=>[c.text!=="unknown"?(i(),m(t(oe),{key:0,color:c.tagColor,style:se({cursor:c.hover?"pointer":"default"})},{default:u(()=>[c.text==="Live"?(i(),m(t(I),{key:0})):c.text==="Inactive"?(i(),m(t(z),{key:1})):c.text==="Failed"?(i(),m(t(Ve),{key:2})):c.text==="Aborted"?(i(),m(t(je),{key:3})):c.text==="Sleeping"?(i(),m(t(L),{key:4})):c.text==="Uploading"?(i(),m(t(V),{key:5})):c.text==="Deploying"?(i(),m(t(V),{key:6})):c.text==="Deactivating"?(i(),m(t(V),{key:7})):_("",!0),h(" "+y(c.text),1)]),_:2},1032,["color","style"])):_("",!0)]),_:2},1032,["open"])]),_:1},8,["loading","title","description","empty-title","table"]),v.value?(i(),m(t(pe),{key:0,footer:null,open:!!v.value,size:"large",width:"80%",title:K(),onCancel:n[0]||(n[0]=c=>v.value=null)},{default:u(()=>[!t(Z).result.value||t(Z).loading.value?(i(),m(t(ce),{key:0})):t(Z).result.value?(i(),m(Pt,{key:1,"build-spec":t(Z).result.value},null,8,["build-spec"])):_("",!0)]),_:1},8,["open","title"])):_("",!0)],64))}}),o1=fe(Vt,[["__scopeId","data-v-14bc60df"]]);export{o1 as default};
//# sourceMappingURL=Builds-BBQWW6SH.js.map

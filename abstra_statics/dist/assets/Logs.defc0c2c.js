import{d as J,r as R,H as U,G as F,eB as K,F as M,eH as Q,b as d,c as y,w as r,u as e,eG as W,f as l,aq as q,ad as T,cr as X,bu as Z,cF as S,eu as _,eC as ee,ew as E,eD as m,e as x,cN as te,a_ as ae,bR as le,cn as se,t as ne}from"./outputWidgets.6c6bbcfd.js";import{t as re}from"./ant-design.ff909c2a.js";import{C as P}from"./gateway.3543d1b0.js";import{A as C}from"./router.98f12fd8.js";import{B as oe}from"./build.aee7e9e7.js";import"./index.fa74f1f3.js";import{a as ue}from"./asyncComputed.77186ed9.js";import{R as ie}from"./dayjs.e8ab3792.js";import{f as de}from"./index.b048d0fb.js";import{A as pe}from"./Title.307e6445.js";import{A as z,a as ce}from"./Text.51d0b007.js";import{A as h,F as me}from"./Base.d198dcc9.js";import{A as fe,C as ve}from"./CollapsePanel.a46a9866.js";import{A as k}from"./index.9883e2bc.js";import"./transButton.2945a1d9.js";import"./index.d102918e.js";import"./record.5aef9f17.js";import"./pubsub.ccb56b51.js";import"./index.b43ad913.js";(function(){try{var b=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(b._sentryDebugIds=b._sentryDebugIds||{},b._sentryDebugIds[s]="854fbc6e-8bb1-4af6-ad39-bb25e620cc7b",b._sentryDebugIdIdentifier="sentry-dbid-854fbc6e-8bb1-4af6-ad39-bb25e620cc7b")}catch{}})();class ye{list({projectId:s,buildId:i,...c}){return P.post(`projects/${s}/builds/${i}/logs`,c)}filters(s){return P.get(`projects/${s}/log-filters`)}}const O=new ye;class A{constructor(s,i,c,w,I,f,g){this.executionId=s,this.runtimeType=i,this.runtimeName=c,this.payload=w,this.event=I,this.buildId=f,this.createdAt=g}static fromDTO(s){return new A(s.executionId,s.runtimeType,s.runtimeName,s.payload,s.event,s.buildId,new Date(s.createdAt))}static async list(s){const i=await O.list(s);return{total:i.total,logs:i.logs.map(A.fromDTO)}}static async filters(s){return O.filters(s)}}const be={key:0},_e=["title"],ge=["textContent"],he=["textContent"],Ae=["textContent"],we=["textContent"],Ie=J({__name:"Logs",setup(b){function s(t){return de(t,new Date,{addSuffix:!0})}const i=R(1),c=R(10);U([i,c],([t,n])=>{i.value=t,c.value=n,B()});function w(t){return(t.event==="stderr"||t.event==="stdout")&&typeof t.payload.log=="string"&&t.payload.log.trim().length===0}const I=F(()=>{var t,n;return{runtimes:(t=v.value)==null?void 0:t.filters.runtimes.map(({runtimeName:p,runtimeType:u})=>({label:`[${u}] ${p}`,value:p})),events:(n=v.value)==null?void 0:n.filters.events.map(p=>({label:`[${p.runtimeType}] ${p.event}`,value:p.event}))}}),f=K(),g=f.params.projectId;function j(){const t=[];return typeof f.query.runtimeId=="string"&&t.push(f.query.runtimeId),typeof f.query.runtimeTitle=="string"&&t.push(f.query.runtimeTitle),t}const o=M({selectedBuild:f.query.buildId||"latest",dateRange:void 0,search:"",runtimeNames:j(),events:[]}),V=Q.exports.debounce(async()=>{await B(),D.value=!1},500),D=R(!1);U(o,()=>{D.value=!0,i.value=1,V()});const G=F(()=>v.value?[{label:"Latest",value:"latest"},{label:"All",value:"all"},...v.value.builds.map(t=>({label:`${s(t.createdAt)} (${t.id.slice(0,8)})`,value:t.id}))]:[{label:"Latest",value:"latest"},{label:"All",value:"all"}]),H=t=>{o.selectedBuild=t,B()},{loading:Y,result:v,refetch:B}=ue(()=>{var t,n;return Promise.all([A.list({projectId:g,limit:c.value,offset:(i.value-1)*c.value,buildId:o.selectedBuild,from:(t=o.dateRange)==null?void 0:t[0].toDate(),to:(n=o.dateRange)==null?void 0:n[1].toDate(),search:o.search,runtimeNames:o.runtimeNames,events:o.events}),oe.list(g),A.filters(g)]).then(([{total:p,logs:u},a,N])=>W({total:p,logs:u,builds:a,filters:N}))});return(t,n)=>(d(),y(e(S),{direction:"vertical"},{default:r(()=>{var p;return[l(e(pe),null,{default:r(()=>[q("Logs")]),_:1}),l(e(me),{layout:"vertical"},{default:r(()=>[l(e(z),{gutter:10},{default:r(()=>[l(e(C),{span:12},{default:r(()=>[l(e(h),{label:"Build"},{default:r(()=>[l(e(T),{value:o.selectedBuild,"onUpdate:value":n[0]||(n[0]=u=>o.selectedBuild=u),options:G.value,"option-label":"label","option-value":"value",filter:!1,onChange:H},null,8,["value","options"])]),_:1})]),_:1}),l(e(C),{span:12},{default:r(()=>[l(e(h),{label:"Date"},{default:r(()=>[l(e(ie),{value:o.dateRange,"onUpdate:value":n[1]||(n[1]=u=>o.dateRange=u),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(e(z),{gutter:10},{default:r(()=>[l(e(C),{span:12},{default:r(()=>[l(e(h),{label:"Runtimes"},{default:r(()=>[l(e(T),{value:o.runtimeNames,"onUpdate:value":n[2]||(n[2]=u=>o.runtimeNames=u),options:I.value.runtimes,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1}),l(e(C),{span:12},{default:r(()=>[l(e(h),{label:"Events"},{default:r(()=>[l(e(T),{value:o.events,"onUpdate:value":n[3]||(n[3]=u=>o.events=u),options:I.value.events,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),l(e(h),{label:"Search"},{default:r(()=>[l(e(X),{value:o.search,"onUpdate:value":n[4]||(n[4]=u=>o.search=u),type:"search"},null,8,["value"])]),_:1})]),_:1}),e(Y)||D.value?(d(),y(e(Z),{key:0,style:{width:"100%"}})):(p=e(v))!=null&&p.logs.length?(d(),y(e(S),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>{var u;return[l(e(ve),{"data-source":(u=e(v))==null?void 0:u.logs},{default:r(()=>[(d(!0),_(ae,null,ee(e(v).logs,(a,N)=>(d(),y(e(fe),{key:N,disabled:w(a)},{extra:r(()=>[w(a)?(d(),y(e(ce),{key:0},{default:r(()=>[q(" EMPTY ")]),_:1})):E("",!0)]),header:r(()=>[l(e(S),null,{default:r(()=>[o.selectedBuild=="all"?(d(),_("span",be,m(a.buildId.split("-")[0]),1)):E("",!0),l(e(k),{type:"vertical"}),x("span",{title:a.createdAt.toISOString()},m(s(a.createdAt)),9,_e),l(e(k),{type:"vertical"}),x("span",null," ["+m(a.runtimeType)+"] "+m(a.runtimeName),1),l(e(k),{type:"vertical"}),x("span",null,m(a.executionId.slice(0,8)),1),l(e(k),{type:"vertical"}),x("span",null,m(a.event),1)]),_:2},1024)]),default:r(()=>{var $,L;return[a.event==="stdout"?(d(),_("pre",{key:0,class:"stdio-log",textContent:m(a.payload.log)},null,8,ge)):a.event==="stderr"?(d(),_("pre",{key:1,class:"stdio-log",textContent:m(a.payload.log)},null,8,he)):a.event==="program-start-failed"?(d(),_("pre",{key:2,textContent:m(a.payload.error)},null,8,Ae)):a.event==="widgets-computed"&&((L=($=a.payload.errors)==null?void 0:$.general)==null?void 0:L.repr)?(d(),_("pre",{key:3,textContent:m(a.payload.errors.general.repr)},null,8,we)):(d(),y(e(te),{key:4,"tree-data":e(re)(a.payload)},null,8,["tree-data"]))]}),_:2},1032,["disabled"]))),128))]),_:1},8,["data-source"]),l(e(le),{current:i.value,"onUpdate:current":n[5]||(n[5]=a=>i.value=a),"page-size":c.value,"onUpdate:pageSize":n[6]||(n[6]=a=>c.value=a),"show-size-changer":"",total:e(v).total},null,8,["current","page-size","total"])]}),_:1})):(d(),y(e(se),{key:2}))]}),_:1}))}});const Ve=ne(Ie,[["__scopeId","data-v-d516d11d"]]);export{Ve as default};
//# sourceMappingURL=Logs.defc0c2c.js.map

var oe=Object.defineProperty;var ie=(n,e,a)=>e in n?oe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var U=(n,e,a)=>(ie(n,typeof e!="symbol"?e+"":e,a),a);import{t as de}from"./ant-design.b6e6d5e6.js";import{f as o,eG as te,f1 as ce,r as $,E as pe,d as B,G as j,F as fe,b as u,c as d,w as r,u as t,aq as g,eD as w,ex as b,ev as _,bq as k,eC as C,ci as me,bg as ge,cC as I,bO as L,bH as ve,ad as F,cB as E,o as ye,K as _e,a as be,co as he,dm as X,e as V,cK as ke,ck as we,v as Se}from"./outputWidgets.e04018d6.js";import{a as q}from"./asyncComputed.23285845.js";import{W as Ce}from"./workspaces.5bf76ed0.js";import{L as Ae,a as Oe}from"./log.e8f998ee.js";import"./authorManager.36b9c592.js";import"./index.6b6d28d1.js";import{T as Re}from"./index.2243323f.js";import{A as ae}from"./index.dad00965.js";import{A as ne}from"./index.841b47e6.js";import{A as z,a as xe}from"./Text.cb37dd29.js";import{D as Pe,A as De}from"./index.fcf4b3c7.js";import{A as Te}from"./Title.873659e3.js";import{_ as Ie}from"./SaveButton.vue_vue_type_script_setup_true_lang.5780dcee.js";import{A as re,C as le}from"./CollapsePanel.0ebcc574.js";import{F as se}from"./Form.ef695b37.js";import{A as N}from"./FormItem.e4984bde.js";import{F as Fe}from"./index.e83ca9c0.js";import{C as Ee}from"./Card.0eba72b3.js";import{E as $e}from"./ExpandOutlined.b9917d05.js";import{A as je}from"./index.141031bd.js";import"./index.88b45e8b.js";import"./Modal.0805ccf5.js";import"./record.3dcaee8d.js";import"./pubsub.273e94b2.js";import"./url.39460579.js";import"./gateway.a8335306.js";import"./index.cf4c23b9.js";import"./isNumeric.75337b1e.js";import"./hasIn.ca61761c.js";import"./index.59653966.js";import"./index.6beb5dcf.js";import"./TabPane.d6c55a1f.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="861cb74b-a49b-48b5-a35c-3beece26aaad",n._sentryDebugIdIdentifier="sentry-dbid-861cb74b-a49b-48b5-a35c-3beece26aaad")}catch{}})();var Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM641.7 520.8L442.3 677.6c-7.4 5.8-18.3.6-18.3-8.8V355.3c0-9.4 10.9-14.7 18.3-8.8l199.4 156.7a11.2 11.2 0 010 17.6z"}}]},name:"play-square",theme:"filled"};const Ue=Ne;function Y(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),s.forEach(function(c){Ve(n,c,a[c])})}return n}function Ve(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var M=function(e,a){var s=Y({},e,a.attrs);return o(te,Y({},s,{icon:ce}),null)};M.displayName="EyeOutlined";M.inheritAttrs=!1;const ze=M;function Z(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},s=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable}))),s.forEach(function(c){Le(n,c,a[c])})}return n}function Le(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var W=function(e,a){var s=Z({},e,a.attrs);return o(te,Z({},s,{icon:Ue}),null)};W.displayName="PlaySquareFilled";W.inheritAttrs=!1;const qe=W;function Be(n){switch(n.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"};case"abandoned":return{color:"warning",text:"Abandoned"}}}function Me(){const n=$({state:"closed"});function e(){n.value={state:"closed"}}function a(){n.value={state:"visualizations"}}function s(c,p){n.value={state:"stage-run",stageRun:p}}return{closeDrawer:e,openVisualizationEditor:a,inspectStageRun:s,drawerState:n}}function We({getKanbanData:n}){const e=pe([]),a=q(()=>n(e.value)),s=q(()=>Ce.get());async function c(l,y){l?e.value=[...e.value.slice(0,y),l]:e.value=e.value.slice(0,y),a.refetch()}function p(l,y){var O;const S=(O=l.stages)==null?void 0:O.find(h=>h.id===l.selected_stage.id);if((S==null?void 0:S.type)==="form"){const h=(y==null?void 0:y.status)==="waiting"?{"abstra-run-id":y.id}:{};return{path:`/${S.path}`,query:h}}else return null}return{kanbanAsyncComputed:a,selectedStageIds:e,setNewSelectedStageId:c,workspaceAsyncComputed:s,launchLink:p}}const Ge={key:2},Ke={key:3},He=B({__name:"StageRunInspector",props:{stageRun:{}},setup(n){const e=n,a=j(()=>e.stageRun?Array.from(new Set(e.stageRun.logs.map(l=>l.event))):[]),s=fe({filters:a.value}),c=j(()=>e.stageRun?e.stageRun.logs.filter(l=>l.payload&&s.filters.includes(l.event)):[]),p=l=>Oe.fromDTO({executionId:l.executionId,runtimeType:l.runtimeType,runtimeName:l.runtimeName,payload:l.payload,event:l.event,createdAt:new Date(l.createdAt*1e3),buildId:""});return(l,y)=>(u(),d(t(ae),{open:"",title:"Stage Run Inspector",size:"large"},{default:r(()=>{var S,O,h,T,P,R;return[o(t(z),null,{default:r(()=>[g(" Status: "),o(t(ne),{style:{"font-weight":"600"}},{default:r(()=>{var i;return[g(w((i=l.stageRun)==null?void 0:i.status),1)]}),_:1})]),_:1}),(S=l.stageRun)!=null&&S.assignee?(u(),d(t(z),{key:0},{default:r(()=>{var i;return[g(" Assignee: "+w((i=l.stageRun)==null?void 0:i.assignee),1)]}),_:1})):b("",!0),(O=l.stageRun)!=null&&O.created_at?(u(),d(t(z),{key:1},{default:r(()=>{var i;return[g(" Created at: "+w((i=l.stageRun)==null?void 0:i.created_at),1)]}),_:1})):b("",!0),((h=l.stageRun)==null?void 0:h.content)&&((T=l.stageRun)==null?void 0:T.content.length)>0?(u(),_("div",Ge,[o(t(De),{title:"Stored data",size:"small",layout:"vertical",column:1},{default:r(()=>{var i;return[(u(!0),_(k,null,C((i=l.stageRun)==null?void 0:i.content,A=>(u(),d(t(Pe),{key:A.key,label:A.key},{default:r(()=>{var m;return[g(w((m=A.value)!=null?m:"null"),1)]}),_:2},1032,["label"]))),128))]}),_:1})])):b("",!0),((P=l.stageRun)==null?void 0:P.logs)&&((R=l.stageRun)==null?void 0:R.logs.length)>0?(u(),_("div",Ke,[o(t(Te),{level:4},{default:r(()=>[g("Logs")]),_:1}),o(t(me),{value:s.filters,"onUpdate:value":y[0]||(y[0]=i=>s.filters=i),options:a.value},null,8,["value","options"]),o(t(Re),null,{default:r(()=>[(u(!0),_(k,null,C(c.value,i=>(u(),d(Ae,{key:i.executionId,log:p(i)},null,8,["log"]))),128))]),_:1})])):b("",!0)]}),_:1}))}}),Je=[{value:"text",label:"Text"},{value:"image",label:"Image"},{value:"table",label:"Table"},{value:"progress-bar",label:"Progress Bar"}];class ee{static async get(){return(await fetch("/_editor/api/visualizations")).json()}static async put(e){const a=await fetch("/_editor/api/visualizations",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return Object.freeze(a.json())}}function Qe(n,e){const a=n.length;if(a!==e.length)return!1;for(let s=0;s<a;s++)if(n[s].name!==e[s].name||n[s].type!==e[s].type)return!1;return!0}function D(n,e){var a;return{...n,id:(a=e==null?void 0:e.toString())!=null?a:Math.random().toString(36).slice(2)}}class G{constructor(e){U(this,"initialItems");U(this,"_items");this.initialItems=e.map((a,s)=>D(a,s)),this._items=$(e.map((a,s)=>D(a,s)))}get items(){return this._items.value}hasChanges(){return!Qe(this.initialItems,this.items)}async save(){const e=await ee.put(this.items);this.initialItems=e.map((a,s)=>D(a,s)),this._items.value=e.map((a,s)=>D(a,s))}static async get(){const e=await ee.get();return new G(e)}add(){this.items.push(D({name:"New var",type:"text"}))}remove(e){const a=this.items.findIndex(s=>s.id===e);a!==-1&&this.items.splice(a,1)}}const Xe=B({__name:"VisualizationEditor",setup(n){const{result:e,loading:a}=q(()=>G.get());return(s,c)=>(u(),d(t(ae),{open:"",title:"Visualization settings"},{extra:r(()=>[t(e)?(u(),d(Ie,{key:0,model:t(e),disabled:!t(e).hasChanges()},null,8,["model","disabled"])):b("",!0)]),default:r(()=>[t(a)||!t(e)?(u(),d(t(ge),{key:0})):(u(),d(t(I),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>[o(t(L),{onClick:c[0]||(c[0]=p=>t(e).add())},{default:r(()=>[g("Add")]),_:1}),o(t(le),{bordered:!1},{default:r(()=>[(u(!0),_(k,null,C(t(e).items,p=>(u(),d(t(re),{key:p.id},{header:r(()=>[p.name?(u(),d(t(xe),{key:0,strong:!0},{default:r(()=>[g(w(p.name),1)]),_:2},1024)):b("",!0)]),extra:r(()=>[o(t(L),{danger:"",onClick:l=>t(e).remove(p.id)},{default:r(()=>[g(" Remove ")]),_:2},1032,["onClick"])]),default:r(()=>[o(t(se),{layout:"vertical"},{default:r(()=>[o(t(N),{label:"Property name"},{default:r(()=>[o(t(ve),{value:p.name,"onUpdate:value":l=>p.name=l},null,8,["value","onUpdate:value"])]),_:2},1024),o(t(N),null,{default:r(()=>[o(t(F),{value:p.type,"onUpdate:value":l=>p.type=l,label:"Visualization type"},{default:r(()=>[(u(!0),_(k,null,C(t(Je),l=>(u(),d(t(E),{key:l.value,value:l.value},{default:r(()=>[g(w(l.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1}))}}),ue=["waiting","running","finished","failed"];function Ye(){const n=$([...ue]),e=$("");return{filterStatus:n,filterSearch:e}}async function Ze(n){return(await fetch("/_editor/api/kanban",{method:"POST",body:JSON.stringify({selected_stages_ids:n}),headers:{"Content-Type":"application/json"}})).json()}const et={class:"stages-container"},tt={class:"stages-content"},at={style:{"max-height":"200px","overflow-y":"hidden"}},nt=B({__name:"WorkflowKanban",setup(n){const{kanbanAsyncComputed:e,launchLink:a,setNewSelectedStageId:s}=We({getKanbanData:Ze});let c=null;ye(()=>{c=setInterval(()=>{e.refetch()},1e3)}),_e(()=>{c&&clearInterval(c)});const{filterSearch:p,filterStatus:l}=Ye(),{closeDrawer:y,inspectStageRun:S,openVisualizationEditor:O,drawerState:h}=Me(),T=j(()=>{var i,A,m;const R=(A=(i=e.result.value)==null?void 0:i.columns)!=null?A:[];return(m=R[R.length-1])==null?void 0:m.selected_stage}),P=j(()=>"stageRun"in h.value?h.value.stageRun:null);return(R,i)=>{const A=be("router-link");return u(),_(k,null,[o(t(je),{vertical:"",style:{height:"100%"}},{default:r(()=>[o(t(le),{ghost:""},{default:r(()=>[o(t(re),{header:"Filters"},{default:r(()=>[o(t(se),null,{default:r(()=>[o(t(N),{label:"Search"},{default:r(()=>[o(t(he),{value:t(p),"onUpdate:value":i[0]||(i[0]=m=>X(p)?p.value=m:null),placeholder:"Search",style:{width:"400px"}},null,8,["value"])]),_:1}),o(t(N),{label:"Status"},{default:r(()=>[o(t(F),{value:t(l),"onUpdate:value":i[1]||(i[1]=m=>X(l)?l.value=m:null),mode:"multiple",style:{width:"400px"}},{default:r(()=>[(u(!0),_(k,null,C(t(ue),m=>(u(),d(t(E),{key:m,value:m},{default:r(()=>[g(w(t(Be)({status:m}).text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),V("div",et,[V("div",tt,[o(t(I),{align:"start"},{default:r(()=>{var m,K,H;return[(u(!0),_(k,null,C((K=(m=t(e).result.value)==null?void 0:m.columns)!=null?K:[],(f,J)=>(u(),d(t(I),{key:J,direction:"vertical"},{default:r(()=>[o(t(F),{style:{width:"100%","min-width":"200px"},"allow-clear":"",value:f.selected_stage.id,"onUpdate:value":v=>t(s)(v,J)},{default:r(()=>[(u(!0),_(k,null,C(f.stages,v=>(u(),d(t(E),{key:v.id,value:v.id},{default:r(()=>[g(w(v.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),f.selected_stage.id?(u(),d(t(I),{key:0,direction:"vertical",style:{width:"100%"}},{default:r(()=>[(u(!0),_(k,null,C(f.stage_run_cards,v=>{var Q;return u(),d(t(Ee),{key:v.id,size:"small",style:{"max-width":"250px",cursor:"pointer"},"body-style":{display:((Q=v.content)==null?void 0:Q.length)>0?"block":"none"},onClick:x=>t(S)(f,v)},{title:r(()=>[o(t(ne),null,{default:r(()=>[g(w(v.status),1)]),_:2},1024)]),default:r(()=>[V("div",at,[(u(!0),_(k,null,C(v.content,x=>(u(),d(t(ke),{key:x.key,"tree-data":t(de)(x.value)},null,8,["tree-data"]))),128))]),g(" "+w(v.assignee),1)]),actions:r(()=>[t(a)(f,v)?(u(),d(A,{key:0,to:t(a)(f,v),target:"_blank",onClick:i[2]||(i[2]=x=>x.stopPropagation())},{default:r(()=>[o(t(qe))]),_:2},1032,["to"])):b("",!0)]),extra:r(()=>[o(t($e),{onClick:x=>t(S)(f,v)},null,8,["onClick"])]),_:2},1032,["body-style","onClick"])}),128)),f.stage_run_cards.length===0?(u(),d(t(we),{key:0})):b("",!0),f.selected_stage.can_be_started&&t(a)(f)!==null?(u(),d(A,{key:1,target:"_blank",to:t(a)(f)},{default:r(()=>[o(t(L),{style:{width:"100%"}},{default:r(()=>[g(" Start ")]),_:1})]),_:2},1032,["to"])):b("",!0)]),_:2},1024)):b("",!0)]),_:2},1024))),128)),t(e).result.value&&t(e).result.value.next_stage_options.length>0?(u(),d(t(F),{key:(H=T.value)==null?void 0:H.id,style:{width:"100%","min-width":"200px"},"allow-clear":"","onUpdate:value":i[3]||(i[3]=f=>t(s)(f,t(e).result.value.columns.length))},{default:r(()=>[(u(!0),_(k,null,C(t(e).result.value.next_stage_options,f=>(u(),d(t(E),{key:f.id,value:f.id},{default:r(()=>[g(w(f.title),1)]),_:2},1032,["value"]))),128))]),_:1})):b("",!0)]}),_:1})])])]),_:1}),t(h).state==="stage-run"&&P.value?(u(),d(He,{key:0,"stage-run":P.value,onClose:t(y)},null,8,["stage-run","onClose"])):t(h).state==="visualizations"?(u(),d(Xe,{key:1,onClose:t(y)},null,8,["onClose"])):b("",!0),o(t(Fe),{onClick:t(O)},{icon:r(()=>[o(t(ze))]),_:1},8,["onClick"])],64)}}});const Ut=Se(nt,[["__scopeId","data-v-5b447973"]]);export{Ut as default};
//# sourceMappingURL=WorkflowKanban.59aef613.js.map

import{d as z,at as M,c as I,o,ac as p,ae as ee,h as k,ed as te,e as b,v as ae,r as Z,al as D,en as oe,w as O,a as V,b as h,aY as J,ej as G,ad as ne,t as E,u as a,df as P,g as S,dj as Y,_ as Q,f as x,i as y,b0 as $,eh as se,d6 as ie,cM as j}from"./jwt-decode.esm.4071145e.js";import{A as re,C as le}from"./router.ef7a08cf.js";import{B as ce}from"./build.1cc9147c.js";import{c as U}from"./string.0157e442.js";import"./tables.59457dad.js";import{e as de}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang.7bd1f43d.js";import{u as ue}from"./polling.cabdf3a3.js";import{t as pe}from"./ant-design.805ab95d.js";import{I as W}from"./PhCopy.vue.5aeb9248.js";import{A as fe}from"./index.c25fb6e2.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[i]="2f52dc6e-feaf-4e40-994e-f63a13d0c046",n._sentryDebugIdIdentifier="sentry-dbid-2f52dc6e-feaf-4e40-994e-f63a13d0c046")}catch{}})();const ge=["width","height","fill","transform"],he={key:0},me=b("path",{d:"M72,104a16,16,0,1,1,16,16A16,16,0,0,1,72,104Zm96,16a16,16,0,1,0-16-16A16,16,0,0,0,168,120Zm68-40V192a36,36,0,0,1-36,36H56a36,36,0,0,1-36-36V80A36,36,0,0,1,56,44h60V16a12,12,0,0,1,24,0V44h60A36,36,0,0,1,236,80Zm-24,0a12,12,0,0,0-12-12H56A12,12,0,0,0,44,80V192a12,12,0,0,0,12,12H200a12,12,0,0,0,12-12Zm-12,82a30,30,0,0,1-30,30H86a30,30,0,0,1,0-60h84A30,30,0,0,1,200,162Zm-80-6v12h16V156ZM86,168H96V156H86a6,6,0,0,0,0,12Zm90-6a6,6,0,0,0-6-6H160v12h10A6,6,0,0,0,176,162Z"},null,-1),_e=[me],ye={key:1},ve=b("path",{d:"M200,56H56A24,24,0,0,0,32,80V192a24,24,0,0,0,24,24H200a24,24,0,0,0,24-24V80A24,24,0,0,0,200,56ZM164,184H92a20,20,0,0,1,0-40h72a20,20,0,0,1,0,40Z",opacity:"0.2"},null,-1),xe=b("path",{d:"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80V192a32,32,0,0,0,32,32H200a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48Zm16,144a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V80A16,16,0,0,1,56,64H200a16,16,0,0,1,16,16ZM72,108a12,12,0,1,1,12,12A12,12,0,0,1,72,108Zm88,0a12,12,0,1,1,12,12A12,12,0,0,1,160,108Zm4,28H92a28,28,0,0,0,0,56h72a28,28,0,0,0,0-56Zm-24,16v24H116V152ZM80,164a12,12,0,0,1,12-12h8v24H92A12,12,0,0,1,80,164Zm84,12h-8V152h8a12,12,0,0,1,0,24Z"},null,-1),Ae=[ve,xe],be={key:2},He=b("path",{d:"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80V192a32,32,0,0,0,32,32H200a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48ZM172,96a12,12,0,1,1-12,12A12,12,0,0,1,172,96ZM96,184H80a16,16,0,0,1,0-32H96ZM84,120a12,12,0,1,1,12-12A12,12,0,0,1,84,120Zm60,64H112V152h32Zm32,0H160V152h16a16,16,0,0,1,0,32Z"},null,-1),we=[He],Ze={key:3},ke=b("path",{d:"M200,50H134V16a6,6,0,0,0-12,0V50H56A30,30,0,0,0,26,80V192a30,30,0,0,0,30,30H200a30,30,0,0,0,30-30V80A30,30,0,0,0,200,50Zm18,142a18,18,0,0,1-18,18H56a18,18,0,0,1-18-18V80A18,18,0,0,1,56,62H200a18,18,0,0,1,18,18ZM74,108a10,10,0,1,1,10,10A10,10,0,0,1,74,108Zm88,0a10,10,0,1,1,10,10A10,10,0,0,1,162,108Zm2,30H92a26,26,0,0,0,0,52h72a26,26,0,0,0,0-52Zm-22,12v28H114V150ZM78,164a14,14,0,0,1,14-14h10v28H92A14,14,0,0,1,78,164Zm86,14H154V150h10a14,14,0,0,1,0,28Z"},null,-1),Ve=[ke],Ce={key:4},Ie=b("path",{d:"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80V192a32,32,0,0,0,32,32H200a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48Zm16,144a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V80A16,16,0,0,1,56,64H200a16,16,0,0,1,16,16Zm-52-56H92a28,28,0,0,0,0,56h72a28,28,0,0,0,0-56Zm-24,16v24H116V152ZM80,164a12,12,0,0,1,12-12h8v24H92A12,12,0,0,1,80,164Zm84,12h-8V152h8a12,12,0,0,1,0,24ZM72,108a12,12,0,1,1,12,12A12,12,0,0,1,72,108Zm88,0a12,12,0,1,1,12,12A12,12,0,0,1,160,108Z"},null,-1),Ee=[Ie],Se={key:5},Te=b("path",{d:"M200,52H132V16a4,4,0,0,0-8,0V52H56A28,28,0,0,0,28,80V192a28,28,0,0,0,28,28H200a28,28,0,0,0,28-28V80A28,28,0,0,0,200,52Zm20,140a20,20,0,0,1-20,20H56a20,20,0,0,1-20-20V80A20,20,0,0,1,56,60H200a20,20,0,0,1,20,20ZM76,108a8,8,0,1,1,8,8A8,8,0,0,1,76,108Zm88,0a8,8,0,1,1,8,8A8,8,0,0,1,164,108Zm0,32H92a24,24,0,0,0,0,48h72a24,24,0,0,0,0-48Zm-20,8v32H112V148ZM76,164a16,16,0,0,1,16-16h12v32H92A16,16,0,0,1,76,164Zm88,16H152V148h12a16,16,0,0,1,0,32Z"},null,-1),Me=[Te],De={name:"PhRobot"},je=z({...De,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(n){const i=n,m=M("weight","regular"),f=M("size","1em"),w=M("color","currentColor"),s=M("mirrored",!1),r=I(()=>{var c;return(c=i.weight)!=null?c:m}),l=I(()=>{var c;return(c=i.size)!=null?c:f}),v=I(()=>{var c;return(c=i.color)!=null?c:w}),t=I(()=>i.mirrored!==void 0?i.mirrored?"scale(-1, 1)":void 0:s?"scale(-1, 1)":void 0);return(c,H)=>(o(),p("svg",te({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:l.value,height:l.value,fill:v.value,transform:t.value},c.$attrs),[ee(c.$slots,"default"),r.value==="bold"?(o(),p("g",he,_e)):r.value==="duotone"?(o(),p("g",ye,Ae)):r.value==="fill"?(o(),p("g",be,we)):r.value==="light"?(o(),p("g",Ze,Ve)):r.value==="regular"?(o(),p("g",Ce,Ee)):r.value==="thin"?(o(),p("g",Se,Me)):k("",!0)],16,ge))}}),et=ae("logs",()=>{const n=Z(null),i=Z(null),m=Z(""),f=Z(!1),w=Z(),s=D({openedExecutionIds:[],loadingExecutions:!1,waitingDebounce:!1,executions:[],executionData:{}}),r=D({currentIndex:1,pageSize:10,totalCount:0}),l=D({dateRange:void 0,buildId:void 0,stageId:void 0,status:void 0,search:void 0}),v=D({builds:[],stages:[],statuses:de.map(e=>({label:U(e),value:e}))}),t=ue({task:()=>F(),interval:1e4}),c=async e=>{var d;n.value=e.executionRepository,i.value=e.buildRepository,m.value=e.projectId,f.value=(d=e.pool)!=null?d:!1,w.value=e.onFilterChange,Object.assign(l,e.filters||{}),Object.assign(r,e.pagination||{}),e.openedExecutionId&&(s.openedExecutionIds=[e.openedExecutionId]),await Promise.all([A(),R()]),N(),f.value&&t.startPolling()},H=()=>{t.endPolling()},A=async()=>{var g,u,_,C;if(!n.value)return;s.loadingExecutions=!0;const{executions:e,totalCount:d}=await n.value.list({projectId:m.value,buildId:l.buildId,status:l.status,limit:r.pageSize,offset:(r.currentIndex-1)*r.pageSize,stageId:l.stageId,startDate:(u=(g=l.dateRange)==null?void 0:g[0])==null?void 0:u.toISOString(),endDate:(C=(_=l.dateRange)==null?void 0:_[1])==null?void 0:C.toISOString(),search:l.search});s.loadingExecutions=!1,s.executions=e,r.totalCount=d},T=async()=>{if(!i.value)return;const d=(await i.value.list(m.value)).map(g=>({label:`[${g.id.slice(0,8)}] ${g.createdAt.toLocaleString()} ${g.latest?"(Latest)":""}`,value:g.id}));v.builds=d},B=async()=>{var g;if(!n.value)return;if(!i.value){const _=(await n.value.fetchStages()).map(C=>({label:C.title,value:C.id}));v.stages=_!=null?_:[];return}const e=await ce.get((g=l.buildId)!=null?g:v.builds[0].value),d=e==null?void 0:e.runtimes.map(u=>({label:u.title,value:u.id}));v.stages=d!=null?d:[]},R=async()=>{await T(),await B()},L=async e=>{if(!n.value)return;const[d,g,u]=await Promise.all([n.value.fetchLogs(m.value,e),n.value.fetchThreadData(m.value,e),n.value.getExecutionTasks(m.value,e)]);s.executionData[e]={logs:d,threadData:g,tasks:{triggerTask:u.triggerTask?{type:u.triggerTask.type,payload:u.triggerTask.payload}:null,sentTasks:u.sentTasks.map(_=>({type:_.type,payload:_.payload}))}}},N=()=>{s.openedExecutionIds.forEach(async e=>{s.executionData[e]||await L(e)})},F=async()=>{s.openedExecutionIds.map(e=>L(e))},q=()=>{s.waitingDebounce=!0,r.currentIndex=1,X(),w.value&&w.value(l)},X=oe.exports.debounce(async()=>{await A(),s.waitingDebounce=!1},500),K=async e=>{let d=s.executions;return e&&(d=d.filter(u=>u.stageId===e)),d.length===0?null:d.reduce((u,_)=>u.createdAt>_.createdAt?u:_).id};return O(()=>l.buildId,()=>{B()}),O(l,()=>{s.openedExecutionIds=[],q()}),O(r,()=>{s.openedExecutionIds=[],A()}),{state:I(()=>({currentPage:s,pagination:r,filters:l,filterOptions:v})),currentPage:s,pagination:r,filters:l,filterOptions:v,init:c,teardown:H,fetchPage:A,fetchBuildOptions:T,fetchStageOptions:B,fetchOptions:R,fetchExecutionDetails:L,fetchEmptyLogs:N,refetch:F,handleFilterChange:q,getNewestExecutionId:K,polling:t}}),Pe={key:0,class:"cli"},Be={key:0},Le=z({__name:"LogContainer",props:{logs:{}},setup(n){return(i,m)=>(o(),V(a(Y),{vertical:"",gap:"small"},{default:h(()=>[i.logs.entries.length?(o(),p("div",Pe,[(o(!0),p(J,null,G(i.logs.entries,f=>(o(),p("p",{key:f.createdAt,style:ne({margin:0,"white-space":"pre-wrap",color:f.event==="unhandled-exception"?"rgb(255, 133, 133)":"inherit"})},[f.payload.text?(o(),p("span",Be,E(f.payload.text.trim()),1)):k("",!0)],4))),128))])):(o(),V(a(P),{key:1,type:"secondary"},{default:h(()=>[S("Empty")]),_:1}))]),_:1}))}});const tt=Q(Le,[["__scopeId","data-v-b7f04a41"]]),Oe={key:0},$e=["onClick"],ze=["onClick"],Re=z({__name:"ExecutionContext",props:{data:{},showFixWithAi:{type:Boolean},isSmartChatIdle:{type:Boolean}},emits:["ask-ai"],setup(n,{emit:i}){const m=n,f=Z(!1),w=t=>{if(t==="legacyThreadData")return y.translate("i18n_executioncontext_thread_data");const c=U(t);return c.replace(/([A-Z])/g," $1").trim(),c},s=t=>t==null?!0:Array.isArray(t)?t.length===0:typeof t=="object"?Object.keys(t).length===0:!1,r=t=>{typeof t=="object"&&t!==null&&"payload"in t?(navigator.clipboard.writeText(JSON.stringify(t.payload)),j.success({content:y.translate("i18n_executioncontext_copied_to_clipboard")})):(navigator.clipboard.writeText(""),j.error({content:y.translate("i18n_executioncontext_no_payload")}))},l=t=>{f.value=!0,t.stopPropagation(),m.isSmartChatIdle!==!1&&(i("ask-ai"),setTimeout(()=>{f.value=!1},1e3))},v=t=>{typeof t=="object"?(navigator.clipboard.writeText(JSON.stringify(t)),j.success({content:y.translate("i18n_executioncontext_copied_to_clipboard")})):(navigator.clipboard.writeText(""),j.error({content:y.translate("i18n_executioncontext_failed_copy_request")}))};return(t,c)=>(o(),V(a(le),{bordered:!1,style:{"background-color":"transparent",width:"100%"}},{default:h(()=>[x(a(re),{key:"execution-context"},{header:h(()=>[x(a(Y),{justify:"space-between"},{default:h(()=>[x(a(P),null,{default:h(()=>[S(E(a(y).translate("i18n_executioncontext_header")),1)]),_:1}),x(a($),{title:t.isSmartChatIdle?"":a(y).translate("i18n_executioncontext_wait_or_stop"),placement:"left"},{default:h(()=>[t.showFixWithAi?(o(),p("div",{key:0,class:se(["ask-to-ai",{disabled:!t.isSmartChatIdle||f.value}]),onClick:l},[S(E(a(y).translate("i18n_executioncontext_fix_with_ai"))+" ",1),x(a(je),{size:16})],2)):k("",!0)]),_:1},8,["title"])]),_:1})]),default:h(()=>[x(a(fe),{direction:"vertical",style:{"border-radius":"5px",padding:"10px",color:"#fff",width:"100%","font-family":"monospace","max-height":"600px",overflow:"auto",border:"1px solid #e8e8e8"}},{default:h(()=>[Object.keys(t.data).length?(o(!0),p(J,{key:1},G(Object.entries(t.data),([H,A])=>(o(),p("div",{key:H,class:"tree"},[H!=="legacyThreadData"||!s(A)?(o(),p("div",Oe,[x(a(P),{strong:""},{default:h(()=>[S(E(w(H)),1)]),_:2},1024),H==="request"?(o(),V(a($),{key:0,title:a(y).translate("i18n_executioncontext_copy_request_tooltip")},{default:h(()=>[b("span",{style:{"margin-left":"5px",cursor:"pointer",color:"initial"},onClick:T=>v(A)},[x(a(W))],8,$e)]),_:2},1032,["title"])):k("",!0),H==="triggerTask"?(o(),V(a($),{key:1,title:a(y).translate("i18n_executioncontext_copy_payload_tooltip")},{default:h(()=>[b("span",{style:{"margin-left":"5px",cursor:"pointer",color:"initial"},onClick:T=>r(A)},[x(a(W))],8,ze)]),_:2},1032,["title"])):k("",!0),x(a(ie),{"tree-data":a(pe)(A),selectable:!1},null,8,["tree-data"])])):k("",!0)]))),128)):(o(),V(a(P),{key:0,type:"secondary"},{default:h(()=>[S(E(a(y).translate("i18n_executioncontext_empty")),1)]),_:1}))]),_:1})]),_:1})]),_:1}))}});const at=Q(Re,[["__scopeId","data-v-f7630ec7"]]);export{at as E,tt as L,et as u};
//# sourceMappingURL=ExecutionContext.8c367ef7.js.map

import{d as A,v as pe,K as G,H as he,b as l,c as u,z as p,V,W as z,x as e,D,N as R,e as E,ab as ve,S as Q,O as X,Q as Z,q as ee,r as _,R as te,X as N,o as se,U as ne,I as M,G as T,A as me,F as K,L as J,a2 as fe,J as ye,a as ge,t as _e,ac as ke}from"./registerWidgets.7452ec0b.js";import{p as we,o as O,q as W,r as Y,t as Ce}from"./icons.97625e56.js";import{a as q}from"./asyncComputed.23d75013.js";import{F as be}from"./forms.91463966.js";import{D as Se}from"./dashes.7c8e2bf8.js";import{H as Ie}from"./hooks.911e43af.js";import{J as j}from"./jobs.cb7d0efd.js";import{W as $e}from"./workspaces.4c177a35.js";import{l as k,u as xe}from"./log.ccaee3bb.js";import{L as Ee}from"./login.29b4c1f1.js";import{c as Re}from"./sentry.2692e5c6.js";const oe=n=>(X("data-v-7d69f0ed"),n=n(),Z(),n),Le={class:"runtime-settings"},Pe={key:0,class:"field"},Me=oe(()=>e("div",{class:"label"},"Path",-1)),De={class:"field"},Te=oe(()=>e("div",{class:"label"},"Code",-1)),Ue={class:"input-row"},Ae={key:1,class:"root-path loading"},Be={class:"path-feedback"},Fe={key:1,class:"error"},He=A({__name:"RuntimeCommonSettings",props:{runtime:null},setup(n){const t=n,a=pe({pathError:null}),{result:r}=q(()=>$e.get()),c=()=>{!r.value||!t.runtime.file||r.value.openFile(t.runtime.file)},w=G(()=>{var f;return(f=t.runtime.file)!=null&&f.endsWith(".py")?null:"It should be a .py file"}),m=()=>{!r.value||!I.value||r.value.openFile(".")},d=he(),{result:I}=q(()=>fetch("/_editor/api/workspace/root-path").then(f=>f.text()));return t.runtime.onUpdate(()=>{if(!(t.runtime instanceof j))if(console.log("runtime updated",t.runtime.path),t.runtime instanceof be)d.push({path:`/_editor/form/${encodeURIComponent(t.runtime.path)}`});else if(t.runtime instanceof Ie)d.push({path:`/_editor/hook/${encodeURIComponent(t.runtime.path)}`});else if(t.runtime instanceof Se)d.push({path:`/_editor/dash/${encodeURIComponent(t.runtime.path)}`});else throw new Error(`Unknown runtime type ${t.runtime}`)}),(f,y)=>(l(),u("div",Le,[n.runtime instanceof p(j)?D("",!0):(l(),u("div",Pe,[Me,V(e("input",{"onUpdate:modelValue":y[0]||(y[0]=g=>n.runtime.path=g),class:"path-input",type:"text"},null,512),[[z,n.runtime.path]])])),e("div",De,[Te,e("div",Ue,[p(I)?(l(),u("button",{key:0,class:"root-path",onClick:y[1]||(y[1]=g=>m())},R(p(I)),1)):(l(),u("span",Ae," Loading... ")),V(e("input",{"onUpdate:modelValue":y[2]||(y[2]=g=>n.runtime.file=g),type:"text"},null,512),[[z,n.runtime.file]]),e("button",{class:"open-file-icon",onClick:y[3]||(y[3]=g=>c())},[E(ve,{path:p(we)},null,8,["path"]),Q(" Open in editor ")])]),e("div",Be,R(p(w)),1)]),a.pathError?(l(),u("div",Fe,R(a.pathError),1)):D("",!0)]))}});const mt=ee(He,[["__scopeId","data-v-7d69f0ed"]]);class Ve{static async*sendMessage(t,a){var w;const c=(w=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t,runtime:a})})).body)==null?void 0:w.getReader();if(!c)throw new Error("No response body");for(;;){const m=await c.read();if(m.done)break;yield new TextDecoder().decode(m.value)}}}const ze=n=>(X("data-v-eb2edac5"),n=n(),Z(),n),Ne={class:"smart-console"},Ke={class:"header"},Je={class:"left"},Oe={class:"right"},We={class:"cli"},Ye={class:"left"},qe=ze(()=>e("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),je={key:1,class:"local-entry"},Ge={class:"entry ai-output"},Qe={key:0},Xe={class:"local-entry"},Ze={class:"input"},et=["pointer-events","onKeydown"],tt={class:"right"},st=A({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},dashPlayerState:null,formCode:null,runtime:null},emits:["clear-terminal","restart","enter"],setup(n,{emit:t}){const a=n,r=_(""),c=_(null),w=ye(),m=_(!1),d=_(!1),I=()=>{k.clear(),t("restart")},f=()=>{C.value=C.value==="assistant"?"debugger":"assistant"};function y(s){switch(s.type){case"ai-input":return{role:"user",content:s.log};case"ai-output":return{role:"assistant",content:s.log};case"stderr":case"stdout":return{role:"user",content:s.log};case"restart":return{role:"user",content:"-- new session --"}}}te(w,()=>{k.clear(),t("clear-terminal")});const g=_(null),C=_("assistant"),ae=async s=>{var i;if(s.preventDefault(),r.value=((i=g.value)==null?void 0:i.innerText)||"",s.shiftKey){document.execCommand("insertLineBreak");return}g.value&&(g.value.innerText=""),C.value==="assistant"?await re():await le()},re=async()=>{var i;if(t("enter",r.value),k.log({type:"ai-input",log:r.value}),r.value="",!d.value){k.log({type:"stderr",log:"Please login to use the AI assistant."});return}m.value=!0;const s={role:"user",content:(i=a.formCode)!=null?i:""};try{const v=xe();let o="";const b=Ve.sendMessage([s,...k.logs.map(x=>y(x)),{role:"user",content:r.value}],a.runtime);for await(const x of b)o+=x,k.log({type:"ai-output",log:o},v)}catch(v){k.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(v),Re(v)}finally{m.value=!1}},le=async()=>{r.value&&(S({type:"eval-request",content:`>>> ${r.value}`}),ie(r.value),r.value="")},L=_([]),S=async s=>{L.value.push(s),await N(),c.value&&(c.value.scrollTop=c.value.scrollHeight)},ie=s=>{var i,v,o;(o=(i=a.dashPlayerState)==null?void 0:i.broker)==null||o.send({type:"eval",expression:s,state:(v=a.dashPlayerState)==null?void 0:v.apiPageState})};(()=>{var s,i,v,o,b,x;(s=a.dashPlayerState)==null||s.on("eval-return",h=>{h.repr&&S({type:"log",content:h.repr})}),(i=a.dashPlayerState)==null||i.on("eval-error",h=>{S({type:"error",content:h.repr})}),(v=a.dashPlayerState)==null||v.on("stderr",h=>{S({type:"error",content:h.log})}),(o=a.dashPlayerState)==null||o.on("stdout",h=>{S({type:"log",content:h.log})}),(b=a.dashPlayerState)==null||b.on("widgets-computed",h=>{var P;(P=h.errors)!=null&&P.general&&S({type:"error",content:h.errors.general.repr})}),(x=a.dashPlayerState)==null||x.on("program-start-failed",h=>{var P;S({type:"error",content:(P=h.error)!=null?P:""})})})();const ue=()=>{C.value==="assistant"&&k.clear(),L.value.splice(0,L.value.length)};k.listen(async s=>{s.type!=="restart"&&($.value=!0,await N(),c.value&&(c.value.scrollTop=c.value.scrollHeight))});const $=_(!1),B=_(400),ce=G(()=>({height:`${B.value}px`})),U=_(!1),de=()=>U.value=!0,F=s=>{!U.value||(B.value=document.body.clientHeight-s.clientY)},H=()=>U.value=!1;return se(()=>{document.addEventListener("mousemove",F),document.addEventListener("mouseup",H),Ee.get().then(s=>d.value=!!s)}),ne(()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",H)}),(s,i)=>{const v=ge("Markdown");return l(),u("div",Ne,[e("div",Ke,[e("div",Je,[E(M,{path:C.value==="assistant"?p(O):p(W)},null,8,["path"]),Q(" Smart Console ")]),e("div",Oe,[n.runtime==="dashes"?(l(),u("button",{key:0,class:"header-button",onClick:i[0]||(i[0]=o=>f())},R(C.value==="assistant"?"Switch to Debugger":"Switch to AI Assistant"),1)):D("",!0),e("div",{class:"changes-container"},[e("button",{class:"header-button",onClick:I},"Restart")]),e("div",{class:"toggle-button",onClick:i[1]||(i[1]=o=>$.value=!$.value)},[E(M,{class:T(["icon",{open:$.value}]),path:p(Y),fill:"#fff"},null,8,["class","path"])])])]),$.value?(l(),u("div",{key:0,class:"terminal",style:me(p(ce))},[e("div",{class:"resize-handler",onMousedown:de},null,32),e("div",We,[e("div",Ye,[C.value==="assistant"?(l(),u("div",{key:0,ref_key:"entriesContainer",ref:c,class:"entries"},[qe,(l(!0),u(K,null,J(p(k).logs,(o,b)=>(l(),u("div",{key:b,class:T([o.type,"entry"])},[o.type==="ai-output"?(l(),_e(v,{key:0,source:o.log},null,8,["source"])):(l(),u("div",je,R(o.type==="restart"?"-- restarted --":o.log),1))],2))),128))],512)):(l(),u("div",{key:1,ref_key:"entriesContainer",ref:c,class:"entries"},[e("div",Ge,[L.value.length===0?(l(),u("div",Qe," You can inspect your code here. ")):D("",!0),(l(!0),u(K,null,J(L.value,(o,b)=>(l(),u("div",{key:b,class:T([o.type,"entry"])},[e("div",Xe,R(o.type==="restart"?"-- restarted --":o.content),1)],2))),128))])],512)),e("div",Ze,[E(M,{class:T(["icon",{open:$.value}]),path:p(Y)},null,8,["class","path"]),e("div",{ref_key:"inputRef",ref:g,class:"input-text",contenteditable:"","pointer-events":m.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:fe(ae,["enter"])},null,40,et)])]),e("div",tt,[e("div",{class:"icons",onClick:ue},[E(M,{class:"icon",path:p(Ce)},null,8,["path"])]),e("div",null,[E(M,{class:"icon",path:C.value==="assistant"?p(O):p(W)},null,8,["path"])])])])],4)):D("",!0)])}}});const ft=ee(st,[["__scopeId","data-v-eb2edac5"]]),yt=A({__name:"UnsavedChangesHandler",props:{hasChanges:{type:Boolean}},setup(n){const t=n,a="You have unsaved changes. Are you sure you want to leave?",r=d=>(d=d||window.event,d&&(d.returnValue=a),a),c=()=>{window.addEventListener("beforeunload",r)};ke((d,I,f)=>{if(!t.hasChanges)return f();confirm(a)?f():f(!1)});const w=()=>window.removeEventListener("beforeunload",r),m=d=>d?c():w();return te(()=>t.hasChanges,m),se(()=>m(t.hasChanges)),ne(w),()=>{}}});export{mt as R,ft as S,yt as _};
//# sourceMappingURL=UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.540c1045.js.map

import{d as A,H as D,eL as R,r as k,o as C,G as x,b as p,ev as V,f as c,w as u,c as g,u as r,ae as N,ar as b,bP as O,e as y,ez as F,I as j,bV as T,ex as B,a$ as J,eE as $,eF as E,v as z}from"./outputWidgets.73e48adb.js";import{e as M}from"./toggleHighContrast.6c9a9b39.js";import{v as L}from"./string.8dd42f8b.js";import{D as P}from"./icons.37a32d23.js";import{f as U}from"./index.1fd851ee.js";import{A as G,F as H}from"./Form.96a128f7.js";import{A as W}from"./index.54a44884.js";import{A as q}from"./index.27d555b2.js";import{A as K}from"./index.49a6e40d.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="597822d0-ba70-4124-878a-5dee672a417b",s._sentryDebugIdIdentifier="sentry-dbid-597822d0-ba70-4124-878a-5dee672a417b")}catch{}})();class Q{async list(t){const n=new URLSearchParams({stage:t});return await(await fetch(`/_editor/api/stage_runs?${n}`)).json()}}const X=new Q;class f{constructor(t){this.dto=t}static async list(t){return(await X.list(t)).map(d=>new f(d))}get id(){return this.dto.id}get data(){return this.dto.data}get assignee(){return this.dto.assignee}get stage(){return this.dto.stage}get status(){return this.dto.status}get createdAt(){return new Date(this.dto.createdAt)}}const Y=s=>($("data-v-1a85240c"),s=s(),E(),s),Z=Y(()=>y("span",null," Fix with AI ",-1)),ee=A({__name:"StageRunSelector",props:{stage:{},stageRunId:{},enableStartThread:{type:Boolean}},emits:["fix-invalid-json","update:stage-run-id","update:enable-start-thread"],setup(s,{emit:t}){var h;const n=s,d=D(()=>{if(!n.stage.testData)return{valid:!0,parsed:{}};const e=L(n.stage.testData);return e.valid&&!R.exports.isObject(e.parsed)?{valid:!1,message:"Thread data must be an object."}:e});function m(){d.value.valid||t("fix-invalid-json",n.stage.testData,d.value.message)}const v=k(null),S=e=>{const a=l.stageRuns.find(I=>I.id===e),i=JSON.stringify(a==null?void 0:a.data,null,2);t("update:stage-run-id",e),o.setValue(i),o.updateOptions({readOnly:!!e})},w=()=>{t("update:stage-run-id",null),o.setValue("{}"),o.updateOptions({readOnly:!1})},_=e=>{t("update:enable-start-thread",e),o.setValue("{}"),o.updateOptions({readOnly:e})};let o;C(async()=>{l.stageRuns=await f.list(n.stage.id),l.options=l.stageRuns.filter(e=>e.status==="waiting").map(e=>({value:e.id,label:`Started ${U(e.createdAt,{addSuffix:!0})}`})),o=M.create(v.value,{language:"json",value:n.stage.testData,fontFamily:"monospace",lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",horizontal:"visible"}}),o.onDidChangeModelContent(()=>{n.stage.testData=o.getValue()})});const l=x({stageRuns:[],options:[],loading:!1,stageRunId:(h=n.stageRunId)!=null?h:void 0});return(e,a)=>(p(),V(J,null,[c(r(H),{layout:"vertical"},{default:u(()=>[e.stage.isInitial?(p(),g(r(O),{key:1,checked:e.enableStartThread,onChange:a[3]||(a[3]=i=>_(i.target.checked))},{default:u(()=>[b(" Continue with the thread after this ")]),_:1},8,["checked"])):(p(),g(r(G),{key:0,label:"Select a thread or edit the test thread data"},{default:u(()=>[c(r(N),{value:l.stageRunId,"onUpdate:value":a[0]||(a[0]=i=>l.stageRunId=i),placeholder:"No thread selected","filter-option":"",style:{width:"100%"},"allow-clear":!0,options:l.options,disabled:e.stage.isInitial,"not-found-content":"There are no waiting threads",onSelect:a[1]||(a[1]=i=>S(i)),onClear:a[2]||(a[2]=i=>w())},null,8,["value","options","disabled"])]),_:1}))]),_:1}),c(r(W),{orientation:"left"},{default:u(()=>[b("Data")]),_:1}),y("div",{ref_key:"dataJson",ref:v,class:F(["data-container",{threaded:!!e.stageRunId,invalid:!d.value.valid}])},null,2),d.value.valid===!1?(p(),g(r(K),{key:0,type:"error",message:"Invalid JSON",description:d.value.message},{action:u(()=>[c(r(T),{onClick:m},{default:u(()=>[c(r(q),{align:"center",gap:"small"},{default:u(()=>[c(j,{path:r(P)},null,8,["path"]),Z]),_:1})]),_:1})]),_:1},8,["description"])):B("",!0)],64))}});const ue=z(ee,[["__scopeId","data-v-1a85240c"]]);export{ue as S};
//# sourceMappingURL=StageRunSelector.2387f8c5.js.map

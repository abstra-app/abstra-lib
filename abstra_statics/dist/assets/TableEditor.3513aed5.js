import{a as X}from"./asyncComputed.b85a7eae.js";import{d as F,r as L,G as Y,ex as de,F as z,a as s,b as c,c as y,e,eq as t,bw as j,bh as D,eA as P,er as u,ez as Z,bu as v,dm as ee,p as te,eB as ae,eC as ne,e8 as ce,t as J,E as oe,eu as U,u as V,ep as _e,ey as pe}from"./registerWidgets.a7f9f083.js";import{T as me,a as H}from"./Tab.6ae5f124.js";import{B as fe}from"./BackButton.5fd5f4fd.js";import{n as be}from"./index.3cb779ee.js";import{L as ve}from"./CircularLoading.f04a39f3.js";import{b as ye,O as ge}from"./icons.71d8e4fb.js";import{T as he}from"./tables.8d4279c4.js";import"./lottie.0b007633.js";import"./gateway.0b4ed6c7.js";import"./passwordlessManager.c97a120a.js";import"./pubsub.e3e6423a.js";import"./activeRecord.8c74a961.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_=new Error().stack;_&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[_]="6c884799-a3fa-48fb-a0eb-246694bab6d3",d._sentryDebugIdIdentifier="sentry-dbid-6c884799-a3fa-48fb-a0eb-246694bab6d3")}catch{}})();const le=d=>(ae("data-v-4cd8f680"),d=d(),ne(),d),ke={class:"table-settings"},Ce={key:0},we=le(()=>u("span",null," protected ",-1)),De=[we],Ie={key:1},xe=["onClick"],Te=le(()=>u("a",null,"Delete",-1)),$e=F({__name:"TableColumns",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(d,{emit:_}){var K;const n=d,l=r=>{ce.error({message:"Database error",description:r})},h=L(n.loading);Y(()=>n.loading,()=>{h.value=n.loading});const k=["varchar","int","boolean","json","date","timestamp","uuid"],I=de();(K=n.table)==null||K.onUpdate(()=>{var r;I.replace({name:"tableEditor",params:{tableName:(r=n.table)==null?void 0:r.name}})});const i=[...[{title:"Name",dataIndex:"name"},{title:"Type",dataIndex:"type"},{title:"Default Value",dataIndex:"default"},{title:"Nullable",dataIndex:"nullable"},{title:"Primary Key",dataIndex:"primaryKey"}],{title:"Actions",key:"action"}],o=L({name:"",type:"",nullable:!0,unique:!1}),x=()=>{o.value={name:"",type:"",nullable:!0,unique:!1}},S=z(()=>{var r;return(r=n.table)==null?void 0:r.getColumns().map(a=>({name:a.name,type:a.type,default:a.default,nullable:a.nullable,primaryKey:a.primaryKey,id:a.id,unique:a.unique}))}),m=L(!1),N=()=>{m.value=!0},E=()=>{m.value=!1};function B(r){var a,p;(p=(a=n.table)==null?void 0:a.getColumn(r))==null||p.delete(),h.value=!0,setTimeout(()=>{_("refresh")},2e3)}async function f(){var r;if(!!n.table&&!(!o.value.name||!o.value.type)){if(o.value.id){const a=(r=n.table)==null?void 0:r.getColumn(o.value.id);if(!a)return;const{success:p,error:T}=await a.update(o.value);p||l(T)}else{const{success:a,error:p}=await n.table.addColumn(o.value);a||l(p)}x(),h.value=!0,E(),setTimeout(()=>{_("refresh")},2e3)}}const b=r=>{var a,p,T;return(T=(p=(a=n.table)==null?void 0:a.getColumn(r))==null?void 0:p.protected)!=null?T:!1},C=r=>{var p;const a=te.exports.cloneDeep((p=S.value)==null?void 0:p.filter(T=>T.id===r));!a||(o.value=a[0],N())};return(r,a)=>{const p=s("a-divider"),T=s("a-popconfirm"),q=s("a-button"),M=s("a-table"),G=s("a-input"),w=s("a-form-item"),A=s("a-select-option"),O=s("a-select"),R=s("a-switch"),se=s("a-form"),ie=s("a-space"),re=s("a-drawer");return c(),y("div",ke,[e(v(ee),{theme:{token:{colorPrimary:"#D14056",colorLink:"#D14056"}}},{default:t(()=>[e(M,{columns:i,"data-source":S.value,bordered:"",loading:h.value,pagination:!1},{bodyCell:t(({column:g,text:ue,record:W})=>[g.key!=="action"?(c(),y(j,{key:0},[D(P(ue),1)],64)):(c(),y(j,{key:1},[b(W.id)?(c(),y("div",Ce,De)):(c(),y("div",Ie,[u("span",null,[u("a",{onClick:()=>C(W.id)},"Edit",8,xe)]),e(p,{type:"vertical"}),e(T,{title:"Sure to delete?",onConfirm:Ze=>B(W.id)},{default:t(()=>[Te]),_:2},1032,["onConfirm"])]))],64))]),footer:t(()=>[e(q,{type:"primary",onClick:N},{default:t(()=>[D("+ Add New Column")]),_:1})]),_:1},8,["data-source","loading"]),e(re,{title:"Column",width:720,open:m.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:E},{extra:t(()=>[e(ie,null,{default:t(()=>[e(q,{onClick:E},{default:t(()=>[D("Cancel")]),_:1}),e(q,{type:"primary",onClick:f},{default:t(()=>[D("Submit")]),_:1})]),_:1})]),default:t(()=>[e(se,{model:o.value,layout:"vertical"},{default:t(()=>[e(w,{key:"name",label:"Name"},{default:t(()=>[e(G,{value:o.value.name,"onUpdate:value":a[0]||(a[0]=g=>o.value.name=g)},null,8,["value"])]),_:1}),e(w,{key:"type",label:"Type"},{default:t(()=>[e(O,{value:o.value.type,"onUpdate:value":a[1]||(a[1]=g=>o.value.type=g),"default-active-first-option":""},{default:t(()=>[(c(),y(j,null,Z(k,g=>e(A,{key:g,value:g},{default:t(()=>[D(P(g),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),e(w,{key:"nullable",label:"Nullable"},{default:t(()=>[e(R,{checked:o.value.nullable,"onUpdate:checked":a[2]||(a[2]=g=>o.value.nullable=g)},null,8,["checked"])]),_:1}),e(w,{key:"unique",label:"Unique"},{default:t(()=>[e(R,{checked:o.value.unique,"onUpdate:checked":a[3]||(a[3]=g=>o.value.unique=g)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})])}}});const Ne=J($e,[["__scopeId","data-v-4cd8f680"]]),Q=d=>(ae("data-v-ae548358"),d=d(),ne(),d),Ee={class:"table-settings"},Se=Q(()=>u("h2",{class:"title"},"Table settings",-1)),Be=Q(()=>u("div",{class:"subtitle"},"Edit table metadata",-1)),Re={key:0,class:"table-presenter"},Ue={class:"table-property-item"},qe={class:"property-item"},Ae={key:1},Le={class:"change-warning"},je={class:"section-title"},Pe=Q(()=>u("div",{class:"section-body"}," Changing the table's name can possibly result in the break of running applications. ",-1)),Ve={class:"input-section"},Ke={class:"table-name-value-input"},Oe=["value"],ze={key:0,class:"error"},Fe={class:"option-buttons"},Me=F({__name:"TableSettings",props:{table:{}},emits:["refresh"],setup(d,{emit:_}){var x,S;const n=d,l=oe({name:(S=(x=n.table)==null?void 0:x.name)!=null?S:"",error:"",editing:!1,loading:!1}),h=()=>l.editing=!0,k=()=>{i(),l.editing=!1,l.error=""},I=async()=>{l.error="",l.loading=!0,await $(),l.error||(l.editing=!1),l.loading=!1},$=async()=>{if(!(!n.table||n.table.name===l.name)){if(!l.name){l.error="Table name cannot be empty";return}n.table.name=l.name,await n.table.save(),_("refresh")}},i=()=>{var m,N;return l.name=(N=(m=n.table)==null?void 0:m.name)!=null?N:""},o=m=>{l.name=be(m.target.value,{replacement:"-",lower:!0,strict:!0})};return Y(()=>{var m;return(m=n.table)==null?void 0:m.name},()=>i()),(m,N)=>{var B;const E=s("icon");return c(),y("div",Ee,[Se,Be,l.editing?(c(),y("div",Ae,[u("div",Le,[u("div",je,[e(E,{path:v(ye),width:"12",height:"12",fill:"#D35249"},null,8,["path"]),D(" Be careful ")]),Pe]),u("div",Ve,[u("div",Ke,[u("input",{value:l.name,type:"text",onInput:o},null,40,Oe)]),l.error?(c(),y("div",ze,[e(E,{path:v(ge),fill:"#D35249",width:"12",height:"12"},null,8,["path"]),D(" "+P(l.error),1)])):U("",!0),u("div",Fe,[u("button",{class:"cancel-button",onClick:k},"Cancel"),u("button",{class:"save-button",onClick:I},[D(" Save Changes "),l.loading?(c(),V(ve,{key:0,size:"16"})):U("",!0)])])])])):(c(),y("div",Re,[u("div",Ue,[u("div",qe,"Name: "+P((B=m.table)==null?void 0:B.name),1)]),u("button",{onClick:h},"Edit Name")]))])}}});const Ge=J(Me,[["__scopeId","data-v-ae548358"]]),We={class:"table-data"},He={key:1},Je=["onClick"],Qe=u("a",null,"Delete",-1),Xe=F({__name:"TableData",props:{table:{}},setup(d){var B;const _=d,{result:n,loading:l,refetch:h}=X(()=>_.table.select()),k=z(()=>{var b;return[...(b=_.table)==null?void 0:b.getColumns().map(C=>({title:C.name,dataIndex:C.name})),{title:"Actions",key:"action"}]}),I=z(()=>{var f;return((f=n.value)==null?void 0:f.map(b=>({key:b.id,...b})))||[]}),$=L(!1),i=L({}),o=()=>{$.value=!0},x=()=>{i.value={},$.value=!1};let S=oe((B=_.table)==null?void 0:B.getUnprotectedColumns().reduce((f,b)=>({...f,[b.name]:""}),{}));async function m(){if(!(!_.table||!S)){if(i.value.id){await _.table.updateRow(i.value.id,i.value),h(),i.value={};return}await _.table.insertRow(i.value),i.value={},h(),x()}}const N=async f=>{!n.value||!n.value.find(C=>C.id===f)||(await _.table.deleteRow(f),h())},E=f=>{var b;i.value=_e.pick(te.exports.cloneDeep((b=I.value)==null?void 0:b.filter(C=>f===C.key)[0]),_.table.getColumns().map(C=>C.name)),o()};return(f,b)=>{const C=s("a-divider"),K=s("a-popconfirm"),r=s("a-button"),a=s("a-table"),p=s("a-input"),T=s("a-form-item"),q=s("a-form"),M=s("a-space"),G=s("a-drawer");return c(),y("div",We,[e(v(ee),{theme:{token:{colorPrimary:"#D14056",colorLink:"#D14056"}}},{default:t(()=>[e(a,{columns:k.value,"data-source":I.value,bordered:"",loading:v(l)},{bodyCell:t(({column:w,text:A,record:O})=>[k.value.map(R=>R.title).includes(w.dataIndex)?(c(),y(j,{key:0},[D(P(A),1)],64)):U("",!0),w.key==="action"?(c(),y("div",He,[u("span",null,[u("a",{onClick:R=>E(O.id)},"Edit",8,Je)]),e(C,{type:"vertical"}),e(K,{title:"Sure to delete?",onConfirm:R=>N(O.id)},{default:t(()=>[Qe]),_:2},1032,["onConfirm"])])):U("",!0)]),footer:t(()=>[e(r,{type:"primary",onClick:o},{default:t(()=>[D("+ Add New Data")]),_:1})]),_:1},8,["columns","data-source","loading"]),e(G,{title:"Data",width:720,open:$.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:x},{extra:t(()=>[e(M,null,{default:t(()=>[e(r,{onClick:x},{default:t(()=>[D("Cancel")]),_:1}),e(r,{type:"primary",onClick:m},{default:t(()=>[D("Submit")]),_:1})]),_:1})]),default:t(()=>[e(q,{model:i.value,layout:"vertical"},{default:t(()=>[(c(!0),y(j,null,Z(f.table.getUnprotectedColumns(),w=>(c(),V(T,{key:w.id,label:w.name},{default:t(()=>[i.value?(c(),V(p,{key:0,value:i.value[w.name],"onUpdate:value":A=>i.value[w.name]=A},null,8,["value","onUpdate:value"])):U("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})])}}});const Ye=F({__name:"TableEditor",setup(d){const _=z(()=>{var i;return`/projects/${(i=k.value)==null?void 0:i.projectId}/tables`}),n=pe(),l=n.params.tableId,h=n.params.projectId,{result:k,loading:I,refetch:$}=X(()=>he.get(h,l));return(i,o)=>(c(),V(me,{class:"editor"},{left:t(()=>[e(fe,{link:_.value},null,8,["link"])]),right:t(()=>[]),default:t(()=>[e(H,{title:"Data"},{default:t(()=>[v(k)?(c(),V(Xe,{key:0,loading:v(I),table:v(k)},null,8,["loading","table"])):U("",!0)]),_:1}),e(H,{title:"Columns"},{default:t(()=>[e(Ne,{table:v(k),loading:v(I),onRefresh:o[0]||(o[0]=x=>v($)())},null,8,["table","loading"])]),_:1}),e(H,{title:"Settings"},{default:t(()=>[e(Ge,{table:v(k),loading:v(I),onRefresh:o[1]||(o[1]=x=>v($)())},null,8,["table","loading"])]),_:1})]),_:1}))}});const pt=J(Ye,[["__scopeId","data-v-f565d979"]]);export{pt as default};
//# sourceMappingURL=TableEditor.3513aed5.js.map

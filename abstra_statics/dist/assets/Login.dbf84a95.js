import{L as R}from"./CircularLoading.e44d6e9e.js";import{d as T,e as P,o as u,W as h,a as _,b as t,eA as s,u as a,f6 as n,c as b,w as c,bD as w,f4 as I,co as L,ax as p,bL as m,cn as A,R as C,$ as x,eN as D,eB as q,f as E,dr as K}from"./vue-router.c2ee0e91.js";import{L as M}from"./Logo.13a34b42.js";import{T as N}from"./router.8cbc8b5b.js";import{a as v,E as U}from"./gateway.bf2cabe4.js";import"./tables.f86a0e1f.js";import{M as $}from"./member.c87ce2d2.js";import"./popupNotifcation.34667eaf.js";import"./record.7ac8200f.js";import"./string.187ed685.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[o]="4bd7c0d4-c4db-4c81-8873-b5a83967c964",l._sentryDebugIdIdentifier="sentry-dbid-4bd7c0d4-c4db-4c81-8873-b5a83967c964")}catch{}})();const S={class:"form"},V={class:"header"},F={class:"description"},O={class:"description"},j={class:"footer"},z={key:2,class:"loading"},W=T({__name:"Passwordless",emits:["done"],setup(l,{emit:o}){const e=P({stage:"collect-info",info:{email:""},token:"",invalid:!1,secsToAllowResend:0});let i;const r=async()=>{e.value.stage="loading";try{await v.authenticate(e.value.info.email),e.value.stage="collect-token",e.value.secsToAllowResend=120,clearInterval(i),i=setInterval(()=>{e.value.secsToAllowResend-=1,e.value.secsToAllowResend<=0&&clearInterval(i)},1e3)}catch{e.value.invalid=!0,e.value.stage="collect-info"}},y=async()=>{var f;if(!!((f=e.value.info)!=null&&f.email)){e.value.stage="loading";try{const d=await v.verify(e.value.info.email,e.value.token);if(!d)throw new Error("[Passwordless] Login did not return an user");N.trackSession(),o("done",d),e.value.stage="done"}catch{e.value.invalid=!0,e.value.stage="collect-token"}}},k=()=>{e.value.info&&r()},B=()=>{e.value.stage="collect-info",e.value.info={email:""},e.value.token="",e.value.invalid=!1};return(f,d)=>(u(),h("div",S,[_("div",V,[t(M,{"hide-text":"",size:"large"}),_("h2",null,s(a(n).translate("i18n_auth_validate_your_email_login")),1)]),e.value.stage==="collect-info"?(u(),b(a(A),{key:0,class:"section"},{default:c(()=>[_("div",F,s(a(n).translate("i18n_auth_info_description")),1),t(a(L),{"has-feedback":"","validate-status":e.value.invalid?"error":"",help:e.value.invalid?a(n).translate("i18n_auth_info_invalid_email"):""},{default:c(()=>[t(a(w),{value:e.value.info.email,"onUpdate:value":d[0]||(d[0]=g=>e.value.info.email=g),placeholder:"Email address",onKeyup:I(r,["enter"])},null,8,["value","onKeyup"])]),_:1},8,["validate-status","help"]),t(a(m),{type:"primary",onClick:r},{default:c(()=>[p(s(a(n).translate("i18n_auth_info_send_code")),1)]),_:1})]),_:1})):e.value.stage==="collect-token"?(u(),b(a(A),{key:1,class:"section"},{default:c(()=>[_("div",O,s(a(n).translate("i18n_auth_token_label",null,e.value.info)),1),t(a(L),{"has-feedback":"","validate-status":e.value.invalid?"error":"",help:e.value.invalid?a(n).translate("i18n_auth_token_invalid"):""},{default:c(()=>[t(a(w),{value:e.value.token,"onUpdate:value":d[1]||(d[1]=g=>e.value.token=g),type:"text",placeholder:"Type your verification code",onKeyup:I(y,["enter"])},null,8,["value","onKeyup"])]),_:1},8,["validate-status","help"]),t(a(m),{type:"primary",onClick:y},{default:c(()=>[p(s(a(n).translate("i18n_auth_token_verify_email")),1)]),_:1}),t(a(m),{onClick:B},{default:c(()=>[p(s(a(n).translate("i18n_auth_edit_email")),1)]),_:1}),t(a(m),{disabled:!!e.value.secsToAllowResend,onClick:k},{default:c(()=>[p(s(a(n).translate("i18n_auth_token_resend_email"))+" ("+s(e.value.secsToAllowResend)+" s) ",1)]),_:1},8,["disabled"]),_("div",j,s(a(n).translate("i18n_auth_token_footer_alternative_email")),1)]),_:1})):e.value.stage==="loading"?(u(),h("div",z,[t(R)])):C("",!0)]))}});const G=x(W,[["__scopeId","data-v-03eb8108"]]),H=async()=>{const l=await $.onboarding(),o=v.getAuthor();if(l.shouldBeOnboarded&&o){const e=`${U.onboarding}/schedule`,i=new URLSearchParams({token:o.jwt}),r=e+"?"+i;v.removeAuthor(),window.location.replace(r)}},J={key:0,class:"login"},Q={key:1,class:"loading"},X=T({__name:"Login",setup(l){const o=D(),e=q();async function i(){await H(),e.query.redirect?await o.push({path:e.query.redirect,query:{...e.query,redirect:e.query["prev-redirect"],"prev-redirect":void 0}}):o.push({name:"home"})}const r=E(()=>!v.getAuthor());return K(()=>{r.value||i()}),(y,k)=>r.value?(u(),h("div",J,[t(G,{onDone:i})])):(u(),h("div",Q,[t(R)]))}});const re=x(X,[["__scopeId","data-v-e4e9b925"]]);export{re as default};
//# sourceMappingURL=Login.dbf84a95.js.map

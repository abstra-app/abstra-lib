var U=Object.defineProperty;var R=(s,e,n)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>(R(s,typeof e!="symbol"?e+"":e,n),n);import{C as T}from"./ConnectorCard.ea8dbf54.js";import{_ as V}from"./AbstraButton.vue_vue_type_script_setup_true_lang.8aef727a.js";import{e as P,cL as b,d as M,o as l,c as u,w as a,b as i,u as t,dc as D,aG as r,e9 as L,d5 as O,bR as x,bz as B,bx as v,S as m,dh as p,em as G,en as z,a as j,a0 as S,ea as Y,Y as w,aS as _,dd as y,db as E,eb as $,cz as q,bL as H,eO as J}from"./index.f642553c.js";import{C as A}from"./gateway.d1732116.js";import{C as K}from"./router.cd0be8d6.js";import{G as Q}from"./PhDotsThreeVertical.vue.c5095cdb.js";import{A as W}from"./Avatar.b15a9856.js";import{C as X}from"./Card.fac996a7.js";import{A as Z}from"./index.3b613af3.js";import"./popupNotifcation.040c54ab.js";import"./Badge.7cb0aad6.js";import"./TabPane.a3c2b7f1.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="a8acd9e2-ba19-4ae4-b4f5-9d9ef470c2ea",s._sentryDebugIdIdentifier="sentry-dbid-a8acd9e2-ba19-4ae4-b4f5-9d9ef470c2ea")}catch{}})();class ee{async listAgents(){return A.get("agents")}async listAgentConnections(e){return A.get(`projects/${e}/agents/connections`)}async createAgentConnection({projectId:e,agentId:n}){return A.post(`projects/${e}/agents/connections`,{agentId:n})}async renameAgentConnection({projectId:e,agentConnectionId:n,newAgentConnectionName:o}){return A.patch(`projects/${e}/agents/connections/${n}`,{newAgentConnectionName:o})}async deleteAgentConnection({projectId:e,agentConnectionId:n}){return A.delete(`projects/${e}/agents/connections/${n}`)}}const te="/src/assets/logo.svg";class F{constructor(e){this.data=e}get id(){return this.data.id}get name(){return this.data.name}get description(){return this.data.description}get setupPath(){return this.data.setupPath}get logoURL(){return this.data.logoURL||te}get unavailable(){return!this.data.isAvailable}}class ne{constructor(e){this.data=e}get id(){return this.data.id}get connectionName(){return this.data.connectionName}get agentId(){return this.data.agentId}get clientProjectId(){return this.data.clientProjectId}get connectionStatus(){return this.data.connectionStatus}}class oe{constructor(e){C(this,"agentConnection");C(this,"agent");C(this,"redirectURL");this.data=e,this.agentConnection=new ne(e.agentConnection),this.agent=new F(e.agent),this.redirectURL=e.redirectURL}}class ae{constructor(e,n){C(this,"state");this.api=e,this.projectId=n,this.state=P({agents:[],agentConnectionDetailsList:[],selectedAgentForConnection:null,editingAgentConnection:{selectedAgentConnection:null,newName:"",errorMessage:null}})}get agents(){return this.state.value.agents}get agentConnectionDetailsList(){return this.state.value.agentConnectionDetailsList}get selectedAgentForConnection(){return this.state.value.selectedAgentForConnection}get selectedAgentConnectionForEditing(){return this.state.value.editingAgentConnection.selectedAgentConnection}get editingNewName(){return this.state.value.editingAgentConnection.newName}set editingNewName(e){this.state.value.editingAgentConnection.newName=e}get editingErrorMessage(){return this.state.value.editingAgentConnection.errorMessage}hasChanges(){return!!this.state.value.editingAgentConnection.selectedAgentConnection&&this.state.value.editingAgentConnection.newName!==this.state.value.editingAgentConnection.selectedAgentConnection.connectionName}async fetchInitialState(){await Promise.all([this.fetchAgents(),this.fetchAgentConnections()])}async fetchAgents(){const e=await this.api.listAgents();this.state.value.agents=e.map(n=>new F(n))}async fetchAgentConnections(){const e=await this.api.listAgentConnections(this.projectId);this.state.value.agentConnectionDetailsList=e.map(n=>new oe(n))}cancelAgentConnectionCreation(){this.state.value.selectedAgentForConnection=null}cancelAgentConnectionEditing(){this.state.value.editingAgentConnection.selectedAgentConnection=null,this.state.value.editingAgentConnection.newName="",this.removeEditingErrorMessage()}async createAgentConnection(){if(!this.state.value.selectedAgentForConnection)return;const n=(await this.api.createAgentConnection({projectId:this.projectId,agentId:this.state.value.selectedAgentForConnection.id})).redirectUrl;n?window.location.href=n:(await this.fetchAgentConnections(),this.cancelAgentConnectionCreation())}handleEditAgentConnectionClick(e){this.state.value.editingAgentConnection.newName=e.connectionName,this.state.value.editingAgentConnection.selectedAgentConnection=e}async renameAgentConnection(){try{await this.api.renameAgentConnection({projectId:this.projectId,agentConnectionId:this.state.value.editingAgentConnection.selectedAgentConnection.id,newAgentConnectionName:this.state.value.editingAgentConnection.newName}),this.cancelAgentConnectionEditing(),await this.fetchAgentConnections()}catch{this.state.value.editingAgentConnection.errorMessage="There's already a connection to the same agent with this name"}}removeEditingErrorMessage(){this.state.value.editingAgentConnection.errorMessage=null}async deleteAgentConnection(e){await this.api.deleteAgentConnection({projectId:this.projectId,agentConnectionId:e}),await this.fetchAgentConnections()}handleDeleteAgentConnectionClick(e){b.confirm({title:`Are you sure you want to delete ${e.connectionName}?`,onOk:()=>this.deleteAgentConnection(e.id)})}showNewAgentConnectionModal(e){this.state.value.selectedAgentForConnection=e}handleSetupAgentConnectionClick(e){!e.redirectURL||(window.location.href=e.redirectURL)}}const ie=s=>(G("data-v-4372bea0"),s=s(),z(),s),se=ie(()=>j("div",{style:{"flex-grow":"1"}},null,-1)),ce=M({__name:"AgentConnectionCard",props:{agentConnectionDetails:{},controller:{}},setup(s){function e(n){switch(n){case"connected":return"success";case"pending":return"warning";default:return"default"}}return(n,o)=>(l(),u(t(X),null,{default:a(()=>[i(t(p),{align:"center",gap:16},{default:a(()=>[i(t(W),{src:n.agentConnectionDetails.agent.logoURL,height:"40px",shape:"square"},null,8,["src"]),i(t(D),{strong:""},{default:a(()=>[r(L(n.agentConnectionDetails.agent.name),1)]),_:1}),se,i(t(D),{content:n.agentConnectionDetails.agentConnection.connectionName,code:""},null,8,["content"]),i(t(O),{class:"status-tag",color:e(n.agentConnectionDetails.agentConnection.connectionStatus)},{default:a(()=>[r(L(n.agentConnectionDetails.agentConnection.connectionStatus),1)]),_:1},8,["color"]),i(t(x),null,{overlay:a(()=>[i(t(B),null,{default:a(()=>[n.agentConnectionDetails.redirectURL?(l(),u(t(v),{key:0,onClick:o[0]||(o[0]=h=>n.controller.handleSetupAgentConnectionClick(n.agentConnectionDetails))},{default:a(()=>[r(" Setup ")]),_:1})):m("",!0),i(t(v),{onClick:o[1]||(o[1]=h=>n.controller.handleEditAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:a(()=>[r(" Rename ")]),_:1}),i(t(v),{danger:"",onClick:o[2]||(o[2]=h=>n.controller.handleDeleteAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:a(()=>[r(" Disconnect ")]),_:1})]),_:1})]),default:a(()=>[i(t(Q))]),_:1})]),_:1})]),_:1}))}});const re=S(ce,[["__scopeId","data-v-4372bea0"]]),le={class:"agents-grid"},ge=M({__name:"AgentsView",setup(s){const n=Y().params.projectId,o=new ae(new ee,n);o.fetchInitialState();function h(f){f.unavailable?K.showNewMessage(J.translate("i18n_agents_ask_for_access",null,f.name)):o.showNewAgentConnectionModal(f)}return(f,c)=>{var I,N;return l(),w(_,null,[i(t(Z),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:a(()=>{var g,k;return[i(t(y),null,{default:a(()=>[r("Agents")]),_:1}),i(t(E),null,{default:a(()=>[r("Add and manage external integrations to your project.")]),_:1}),(g=t(o).agentConnectionDetailsList)!=null&&g.length?(l(),u(t(p),{key:0,vertical:""},{default:a(()=>[i(t(y),{level:2},{default:a(()=>[r("Connected")]),_:1}),i(t(p),{vertical:"",gap:10},{default:a(()=>[(l(!0),w(_,null,$(t(o).agentConnectionDetailsList,d=>(l(),u(re,{key:d.agentConnection.id,"agent-connection-details":d,controller:t(o)},null,8,["agent-connection-details","controller"]))),128))]),_:1})]),_:1})):m("",!0),(k=t(o).agents)!=null&&k.length?(l(),u(t(p),{key:1,vertical:""},{default:a(()=>[i(t(y),{level:2},{default:a(()=>[r("All")]),_:1}),j("div",le,[(l(!0),w(_,null,$(t(o).agents,d=>(l(),u(T,{key:d.id,title:d.name,"logo-url":d.logoURL,description:d.description,unavailable:d.unavailable,onClick:de=>h(d)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})):m("",!0)]}),_:1}),i(t(b),{open:!!t(o).selectedAgentForConnection,title:(I=t(o).selectedAgentForConnection)==null?void 0:I.name,"ok-text":"Connect",onCancel:c[0]||(c[0]=g=>t(o).cancelAgentConnectionCreation()),onOk:c[1]||(c[1]=g=>t(o).createAgentConnection())},{default:a(()=>[i(t(E),null,{default:a(()=>[r("You will be redirected to the Agent's setup page.")]),_:1})]),_:1},8,["open","title"]),i(t(b),{open:!!t(o).selectedAgentConnectionForEditing,title:`${(N=t(o).selectedAgentConnectionForEditing)==null?void 0:N.connectionName} Connection`,onCancel:c[5]||(c[5]=g=>t(o).cancelAgentConnectionEditing())},{footer:a(()=>[i(t(p),{justify:"end"},{default:a(()=>[i(V,{type:"primary",disabled:!t(o).hasChanges(),onClick:c[4]||(c[4]=g=>t(o).renameAgentConnection())},{default:a(()=>[r(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[i(t(q),{"has-feedback":"","validate-status":t(o).editingErrorMessage?"error":"",help:t(o).editingErrorMessage},{default:a(()=>[t(o).selectedAgentConnectionForEditing?(l(),u(t(H),{key:0,value:t(o).editingNewName,"onUpdate:value":c[2]||(c[2]=g=>t(o).editingNewName=g),onChange:c[3]||(c[3]=g=>t(o).removeEditingErrorMessage())},null,8,["value"])):m("",!0)]),_:1},8,["validate-status","help"])]),_:1},8,["open","title"])],64)}}});const Ne=S(ge,[["__scopeId","data-v-f3283209"]]);export{Ne as default};
//# sourceMappingURL=AgentsView.ad5a99a4.js.map

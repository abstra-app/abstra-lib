var x=Object.defineProperty;var ee=(c,t,a)=>t in c?x(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a;var E=(c,t,a)=>(ee(c,typeof t!="symbol"?t+"":t,a),a);import{d as $,af as B,g as A,o as n,K as g,O as H,F as _,e5 as te,a as h,Q as z,c as w,w as u,b as i,u as s,az as P,da as C,ec as R,aP as W,e4 as K,f as S,h as ae,am as D,J as G,aj as se,a8 as q,N as oe,ea as ne,eb as O,aL as Q,dA as re,aT as le,aU as ie,ed as ue,bE as ce,a6 as de,cs as pe}from"./index.79dc3613.js";import{B as me}from"./BaseLayout.d150b06f.js";import{S as ve}from"./SaveButton.c39369b6.js";import{u as fe}from"./omniChatStore.e2a2ad30.js";import{S as ge,L as he,a as ye,b as Y}from"./OmniChat.bf2b5c23.js";import{N as _e,_ as be}from"./Navbar.5b16dbfb.js";import{S as ke}from"./SourceCode.eedc6365.js";import{T as we}from"./TasksManager.88945fe2.js";import{G as F}from"./PhCaretRight.vue.6cfb715f.js";import{B as Se}from"./Badge.2ec6bac1.js";import"./Card.b1519b39.js";import{T as J,A as V}from"./TabPane.1571cc7a.js";import"./linters.a2a3c525.js";import{H as Te,J as He,S as Ce}from"./scripts.d3d21022.js";import{n as $e}from"./validations.6a3e760f.js";import{u as Me}from"./editor.53929e78.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[t]="5f26adfb-3b83-4451-99e3-a10509d3244f",c._sentryDebugIdIdentifier="sentry-dbid-5f26adfb-3b83-4451-99e3-a10509d3244f")}catch{}})();const Le=["width","height","fill","transform"],Ve={key:0},Ae=h("path",{d:"M72.5,150.63,100.79,128,72.5,105.37a12,12,0,1,1,15-18.74l40,32a12,12,0,0,1,0,18.74l-40,32a12,12,0,0,1-15-18.74ZM144,172h32a12,12,0,0,0,0-24H144a12,12,0,0,0,0,24ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},null,-1),Ie=[Ae],Ze={key:1},Ee=h("path",{d:"M224,56V200a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V56a8,8,0,0,1,8-8H216A8,8,0,0,1,224,56Z",opacity:"0.2"},null,-1),Be=h("path",{d:"M128,128a8,8,0,0,1-3,6.25l-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32A8,8,0,0,1,128,128Zm48,24H136a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm56-96V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56ZM216,200V56H40V200H216Z"},null,-1),Oe=[Ee,Be],ze={key:2},Ne=h("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm-91,94.25-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32a8,8,0,0,1,0,12.5ZM176,168H136a8,8,0,0,1,0-16h40a8,8,0,0,1,0,16Z"},null,-1),Pe=[Ne],Re={key:3},Ue=h("path",{d:"M126,128a6,6,0,0,1-2.25,4.69l-40,32a6,6,0,0,1-7.5-9.38L110.4,128,76.25,100.69a6,6,0,1,1,7.5-9.38l40,32A6,6,0,0,1,126,128Zm50,26H136a6,6,0,0,0,0,12h40a6,6,0,0,0,0-12Zm54-98V200a14,14,0,0,1-14,14H40a14,14,0,0,1-14-14V56A14,14,0,0,1,40,42H216A14,14,0,0,1,230,56Zm-12,0a2,2,0,0,0-2-2H40a2,2,0,0,0-2,2V200a2,2,0,0,0,2,2H216a2,2,0,0,0,2-2Z"},null,-1),je=[Ue],De={key:4},Fe=h("path",{d:"M128,128a8,8,0,0,1-3,6.25l-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32A8,8,0,0,1,128,128Zm48,24H136a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm56-96V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56ZM216,200V56H40V200H216Z"},null,-1),Je=[Fe],We={key:5},Ke=h("path",{d:"M122.5,124.88a4,4,0,0,1,0,6.24l-40,32a4,4,0,0,1-5-6.24L113.6,128,77.5,99.12a4,4,0,0,1,5-6.24ZM176,156H136a4,4,0,0,0,0,8h40a4,4,0,0,0,0-8ZM228,56V200a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V56A12,12,0,0,1,40,44H216A12,12,0,0,1,228,56Zm-8,0a4,4,0,0,0-4-4H40a4,4,0,0,0-4,4V200a4,4,0,0,0,4,4H216a4,4,0,0,0,4-4Z"},null,-1),Ge=[Ke],qe={name:"PhTerminalWindow"},Qe=$({...qe,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(c){const t=c,a=B("weight","regular"),v=B("size","1em"),o=B("color","currentColor"),p=B("mirrored",!1),r=A(()=>{var l;return(l=t.weight)!=null?l:a}),m=A(()=>{var l;return(l=t.size)!=null?l:v}),b=A(()=>{var l;return(l=t.color)!=null?l:o}),y=A(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:p?"scale(-1, 1)":void 0);return(l,I)=>(n(),g("svg",te({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:m.value,height:m.value,fill:b.value,transform:y.value},l.$attrs),[H(l.$slots,"default"),r.value==="bold"?(n(),g("g",Ve,Ie)):r.value==="duotone"?(n(),g("g",Ze,Oe)):r.value==="fill"?(n(),g("g",ze,Pe)):r.value==="light"?(n(),g("g",Re,je)):r.value==="regular"?(n(),g("g",De,Je)):r.value==="thin"?(n(),g("g",We,Ge)):_("",!0)],16,Le))}}),Ye={class:"editor-layout"},Xe={class:"layout-left"},xe={class:"layout-center"},et={class:"layout-right"},tt=$({__name:"EditorLayout",props:{fullWidth:{type:Boolean}},setup(c){return(t,a)=>(n(),g("div",Ye,[h("section",Xe,[H(t.$slots,"left",{},void 0,!0)]),h("section",xe,[H(t.$slots,"center",{},void 0,!0)]),h("section",et,[H(t.$slots,"right",{},void 0,!0)])]))}});const at=z(tt,[["__scopeId","data-v-ea35460f"]]);class X{constructor(t,a){E(this,"ws",null);E(this,"selfClosed",!1);E(this,"reconnectInterval");this.onMessage=t,this.stageId=a}get url(){return"/_editor/api/stdio/listen"}handleMessage(t){const a=JSON.parse(t.data);a.stage_id===this.stageId&&this.onMessage(a)}handleClose(t){this.selfClosed||this.reconnectInterval||(this.reconnectInterval=setInterval(()=>this.reset(),2e3))}clearReconnectInterval(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=void 0)}async close(){if(!!this.ws){this.selfClosed=!0;try{this.ws.close()}catch{console.warn("already closed")}this.ws=null}}async reset(){await this.close(),await this.connect()}async connect(){return await new Promise(t=>{this.ws=new WebSocket(this.url),this.ws.onopen=()=>t(),this.ws.onclose=a=>this.handleClose(a),this.ws.onmessage=a=>this.handleMessage(a),this.selfClosed=!1,this.clearReconnectInterval()})}}const st={class:"toggle-button"},ot=$({__name:"TerminalOutputHeader",props:{controller:{},open:{type:Boolean}},emits:["toggle-console"],setup(c,{emit:t}){return(a,v)=>(n(),w(s(C),{class:"header",justify:"space-between"},{default:u(()=>[i(s(C),{align:"center",gap:"middle"},{default:u(()=>[i(s(Qe),{size:"20"}),P(" Terminal Output ")]),_:1}),i(s(W),{placement:"left","mouse-enter-delay":.5,title:a.open?"Hide Smart Console":"Show Smart Console"},{default:u(()=>{var o,p,r;return[h("div",st,[((o=a.controller)==null?void 0:o.badgeState.type)==="unseen"?(n(),w(s(Se),{key:0,count:(p=a.controller)==null?void 0:p.badgeState.count,"number-style":{backgroundColor:((r=a.controller)==null?void 0:r.badgeState.severity)==="error"?"#e03636":"#606060"}},{default:u(()=>[i(s(F),{class:R(["icon",{open:a.open}]),onClick:v[0]||(v[0]=m=>t("toggle-console"))},null,8,["class"])]),_:1},8,["count","number-style"])):(n(),w(s(F),{key:1,class:R(["icon",{open:a.open}]),onClick:v[1]||(v[1]=m=>t("toggle-console"))},null,8,["class"]))])]}),_:1},8,["title"])]),_:1}))}});const nt=z(ot,[["__scopeId","data-v-e08ca106"]]),rt={key:0,class:"entry ai-output"},lt={key:0,class:"local-entry"},it=$({__name:"TerminalOutput",props:{workspace:{},stage:{}},setup(c,{expose:t}){const a=c,v=K(),o=S(null),p=S(!1),r=S(200),m=S(!1),b=Y.create(),y=new X(f=>b.log(f),a.stage.id),l=new ge(new he,b,a.stage.id,{origin:"editor"}),I=A(()=>({height:`${r.value}px`})),T=S(!0);async function Z(){var f;if(p.value=!p.value,p.value){if(l.setSeen(),await D(),!o.value)return;o.value.addEventListener("wheel",M),T.value&&(o.value.scrollTop=(f=o.value)==null?void 0:f.scrollHeight)}else{if(!o.value)return;o.value.removeEventListener("wheel",M)}}const M=()=>{if(!o.value)return;const{scrollTop:f,scrollHeight:e,clientHeight:d}=o.value;f+d>=e?T.value=!0:T.value=!1};ae(v,()=>b.clear()),t({closeTerminal:()=>p.value=!1,fixJson:async(f,e)=>{p.value=!0,await l.fixJson(f,e)}}),b.listen(async f=>{p.value||l.setUnseen(f),f.type!=="restart"&&(await D(),!!o.value&&T.value&&(o.value.scrollTop=o.value.scrollHeight))});const L=f=>{!m.value||(r.value=document.body.clientHeight-f.clientY)},N=()=>m.value=!1;return G(async()=>{document.addEventListener("mousemove",L),document.addEventListener("mouseup",N),await y.connect()}),se(async()=>{o.value&&o.value.removeEventListener("wheel",M)}),q(async()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",N),await y.close()}),(f,e)=>(n(),w(s(C),{vertical:""},{default:u(()=>[i(nt,{controller:s(l),open:p.value,onToggleConsole:Z},null,8,["controller","open"]),p.value?(n(),w(s(C),{key:0,class:"terminal",style:oe(I.value),vertical:""},{default:u(()=>[h("div",{class:"resize-handler",onMousedown:e[0]||(e[0]=d=>m.value=!0)},null,32),i(s(C),{class:"cli"},{default:u(()=>[i(s(C),{class:"left",vertical:""},{default:u(()=>[h("div",{ref_key:"entriesContainer",ref:o,class:"entries"},[s(b).logs.length===0?(n(),g("div",rt," The output and errors generated by your code will be printed here. ")):_("",!0),(n(!0),g(Q,null,ne(s(b).logs,(d,k)=>(n(),g("div",{key:k,class:R([d.type,"entry"])},[d.type==="stdout"||d.type==="stderr"||d.type==="restart"?(n(),g("div",lt,O(d.type==="restart"?"-- restarted --":d.log),1)):_("",!0)],2))),128))],512)]),_:1}),i(s(C),{class:"right",vertical:"",justify:"space-between",align:"center"},{default:u(()=>[i(s(W),{placement:"left",title:"Start new conversation"},{default:u(()=>[i(s(ye),{size:20,class:"broom-icon",onClick:e[1]||(e[1]=d=>s(l).clearLogService())})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])):_("",!0)]),_:1}))}});const ut=z(it,[["__scopeId","data-v-edd3b7c0"]]),Vt=$({__name:"Editor",props:{workspace:{},stage:{},stageType:{},testTabName:{},extraTab:{},docsPath:{}},emits:["refetch-tasks","on-save"],setup(c,{expose:t,emit:a}){const v=c,o=K(),p=S(null),r=S(null),m=fe(),b=e=>{v.stage.file=e},y=S("source-code"),l=S("test");function I(){var d;const e=v.stage.codeContent;(d=p.value)==null||d.updateLocalEditorCode(e)}const T=Y.create(),Z=new X(e=>T.log(e),o.params.id);let M;re(()=>{M=m.isOpen,m.open()}),G(()=>{Z.connect()}),q(()=>{m.isOpen=M,Z.close()});const L=e=>e!==y.value&&v.stage.hasChanges();return t({code:p,logService:T,goToTestTab:()=>{l.value="test"},closeTerminal:()=>{var e;(e=r.value)==null||e.closeTerminal()}}),(e,d)=>(n(),w(me,null,{navbar:u(()=>[i(_e,{"page-title":e.stage.title},null,8,["page-title"])]),content:u(()=>[i(at,null,{left:u(()=>{var k,U;return[i(s(J),{"active-key":y.value,"onUpdate:activeKey":d[0]||(d[0]=j=>y.value=j)},{rightExtra:u(()=>[i(ve,{model:e.stage,onSave:I},null,8,["model"])]),default:u(()=>[i(s(V),{key:"source-code",tab:"Source code",disabled:L("source-code")},null,8,["disabled"]),i(s(V),{key:"settings",tab:"Settings",disabled:L("settings")},null,8,["disabled"]),e.extraTab?(n(),w(s(V),{key:e.extraTab.key,tab:e.extraTab.name,disabled:L(e.extraTab.key)},null,8,["tab","disabled"])):_("",!0)]),_:1},8,["active-key"]),le(i(ke,{ref_key:"code",ref:p,script:e.stage,workspace:e.workspace,onUpdateFile:b,onSave:d[1]||(d[1]=j=>a("on-save"))},null,8,["script","workspace"]),[[ie,y.value==="source-code"]]),e.stage&&y.value==="settings"?H(e.$slots,"settings",{key:0}):_("",!0),e.stage&&y.value===((k=e.extraTab)==null?void 0:k.key)?H(e.$slots,(U=e.extraTab)==null?void 0:U.key,{key:1}):_("",!0)]}),center:u(()=>[i(s(J),{"active-key":l.value,"onUpdate:activeKey":d[2]||(d[2]=k=>l.value=k)},{rightExtra:u(()=>[H(e.$slots,"action-button")]),default:u(()=>{var k;return[i(s(V),{key:"test",tab:(k=e.testTabName)!=null?k:"Test"},null,8,["tab"]),i(s(V),{key:"tasks",tab:"Tasks"})]}),_:3},8,["active-key"]),e.stage&&l.value==="tasks"?(n(),w(we,{key:0,ref:"tasksManager","stage-id":e.stage.id,onRefetchTasks:d[3]||(d[3]=k=>a("refetch-tasks"))},null,8,["stage-id"])):_("",!0),e.stage&&l.value==="test"?H(e.$slots,"test",{key:1}):_("",!0)]),right:u(()=>[i(be,{"stage-editor-info":{stage:e.stage,workspace:e.workspace,logService:s(T)}},null,8,["stage-editor-info"])]),_:3})]),footer:u(()=>[i(ut,{ref_key:"terminalOutput",ref:r,stage:e.stage,workspace:e.workspace},null,8,["stage","workspace"])]),_:3}))}}),ct=$({__name:"PathInput",props:{runtime:{}},setup(c){const t=c,{cloudProject:a}=Me(),v=()=>{const o=$e(t.runtime.path);o&&o!==t.runtime.path&&(t.runtime.path=o)};return(o,p)=>(n(),w(s(ce),{value:o.runtime.path,"onUpdate:value":p[0]||(p[0]=r=>o.runtime.path=r),type:"text",onBlur:v},ue({_:2},[o.runtime instanceof s(Te)?{name:"addonBefore",fn:u(()=>{var r,m;return[P(" https://"+O((m=(r=s(a))==null?void 0:r.subdomain)!=null?m:"your-project-domain")+".abstra.app/_hooks/ ",1)]}),key:"0"}:{name:"addonBefore",fn:u(()=>{var r,m;return[P(" https://"+O((m=(r=s(a))==null?void 0:r.subdomain)!=null?m:"your-project-domain")+".abstra.app/ ",1)]}),key:"1"}]),1032,["value"]))}}),dt={key:1},pt=$({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(c){const t=de({pathError:null});return(a,v)=>(n(),g(Q,null,[a.runtime instanceof s(He)||a.runtime instanceof s(Ce)?_("",!0):(n(),w(s(pe),{key:0,label:"URL path"},{default:u(()=>[i(ct,{runtime:a.runtime},null,8,["runtime"])]),_:1})),t.pathError?(n(),g("div",dt,O(t.pathError),1)):_("",!0)],64))}});const At=z(pt,[["__scopeId","data-v-18856675"]]);export{At as R,Vt as _};
//# sourceMappingURL=RuntimeCommonSettings.32dd5f80.js.map

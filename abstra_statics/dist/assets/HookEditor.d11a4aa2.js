import{B as R}from"./BaseLayout.2eb77e5e.js";import{R as F,S as G,E as M,a as W,b as Q,L as V}from"./SmartChat.12b60eb6.js";import{a as z}from"./asyncComputed.c6319089.js";import{d as D,o as i,c as p,w as o,b as t,u as e,bL as g,cB as f,cA as q,f as O,E as j,e as _,aB as J,Y as S,eb as x,bT as C,aG as y,aS as E,cG as L,S as h,a as Y,e9 as N,d7 as K,eo as X,ea as Z,eg as ee,z as te,eM as oe,cO as ae}from"./index.73a38d81.js";import{H as re}from"./scripts.345756e7.js";import"./linters.19a229f9.js";import{W as se}from"./workspaces.d6292660.js";import{_ as le}from"./RunButton.vue_vue_type_script_setup_true_lang.4561320c.js";import{D as ne,A as ue}from"./index.8087cb60.js";import{C as ie,A as B}from"./CollapsePanel.5b52b88b.js";import{A as $}from"./index.2d36535b.js";import{A as de}from"./index.c30ceca6.js";import{T as pe}from"./TasksManager.1b0c87d8.js";import{N as me}from"./NavbarControls.f99c5e32.js";import{b as ce}from"./index.1d99cd36.js";import{A,T as fe}from"./TabPane.5f6856ea.js";import"./validations.aa32a170.js";import"./string.ead22143.js";import"./editor.a961dd5c.js";import"./workspaceStore.9a1cf89e.js";import"./url.9bc6af1d.js";import"./colorHelpers.2f665bfc.js";import"./uuid.8c8c77c5.js";import"./PhCaretRight.vue.cd4f7433.js";import"./Badge.c734bd0c.js";import"./LoadingOutlined.70a572c4.js";import"./SaveButton.30165a8c.js";import"./UnsavedChangesHandler.186eda01.js";import"./ExclamationCircleOutlined.670eff0a.js";import"./polling.b4e09b79.js";import"./PhFolder.vue.f61e1a65.js";import"./PhPencil.vue.e94c1cbe.js";import"./toggleHighContrast.e2e5f044.js";import"./index.78e04c78.js";import"./Card.f9ea02bd.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.30c7ded0.js";import"./Logo.20f38e81.js";import"./ai.d3dc1da1.js";import"./PhCheckCircle.vue.40ecb9b7.js";import"./PhCopySimple.vue.ec2f2118.js";import"./Avatar.b56b94ed.js";import"./record.0e492bf3.js";import"./tasksController.a7392939.js";import"./gateway.e9e7eb7d.js";import"./popupNotifcation.3e5ffef1.js";import"./ant-design.dfa6c76d.js";import"./PhArrowSquareOut.vue.86b1b3ba.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.aa101f2b.js";import"./index.904b936f.js";import"./CloseCircleOutlined.f621b712.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.14bb05c7.js";import"./BookOutlined.0a5325b1.js";import"./PhChats.vue.0ddbb468.js";import"./index.6a44bd55.js";(function(){try{var v=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(v._sentryDebugIds=v._sentryDebugIds||{},v._sentryDebugIds[c]="0e385c4f-968b-44b2-9e29-47b2f6fc750e",v._sentryDebugIdIdentifier="sentry-dbid-0e385c4f-968b-44b2-9e29-47b2f6fc750e")}catch{}})();const ve=D({__name:"HookSettings",props:{hook:{}},setup(v){return(c,k)=>(i(),p(e(q),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:o(()=>[t(e(f),{label:"Name",required:""},{default:o(()=>[t(e(g),{value:c.hook.title,"onUpdate:value":k[0]||(k[0]=b=>c.hook.title=b)},null,8,["value"])]),_:1}),t(F,{runtime:c.hook},null,8,["runtime"])]),_:1}))}}),ke={style:{display:"flex","flex-direction":"column",gap:"10px"}},ye={key:0},he=D({__name:"HookTester",props:{hook:{},disabledWarning:{}},setup(v,{expose:c}){const k=v,b=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],P=O(()=>{var d;if((d=a.response)!=null&&d.status)return a.response.status>=500?"red":a.response.status>=400?"orange":a.response.status>=200?"green":"blue"}),a=j({queryParams:[],headers:[{key:"Content-Type",value:"application/json"}],method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4)}),m=_(!1),w=async()=>{m.value=!0;try{const d={method:a.method,query:a.queryParams.reduce((u,{name:s,value:r})=>(s&&r&&(u[s]=r),u),{}),body:a.body,headers:a.headers.reduce((u,{key:s,value:r})=>(s&&r&&(u[s]=r),u),{})};a.response=await k.hook.run(d)}finally{m.value=!1}},H=()=>{a.queryParams.push({name:"",value:""})},U=d=>{a.queryParams=a.queryParams.filter((u,s)=>s!==d)},T=()=>{a.headers.push({key:"",value:""})},l=d=>{a.headers=a.headers.filter((u,s)=>s!==d)};return c({runHook:w}),(d,u)=>(i(),p(e(q),{layout:"vertical",style:{overflow:"auto"}},{default:o(()=>[t(e(f),{label:"Method"},{default:o(()=>[t(e(J),{value:a.method,options:b,onSelect:u[0]||(u[0]=s=>a.method=s)},null,8,["value"])]),_:1}),t(e(f),null,{default:o(()=>[t(e(ie),{ghost:""},{default:o(()=>[t(e(B),{header:`Query Params (${a.queryParams.length})`},{default:o(()=>[(i(!0),S(E,null,x(a.queryParams,(s,r)=>(i(),p(e(f),{key:r},{default:o(()=>[t(e($),null,{default:o(()=>[t(e(g),{value:s.name,"onUpdate:value":n=>s.name=n,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(g),{value:s.value,"onUpdate:value":n=>s.value=n,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),t(e(C),{danger:"",onClick:n=>U(r)},{default:o(()=>[y("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(f),null,{default:o(()=>[t(e(C),{type:"dashed",style:{width:"100%"},onClick:H},{default:o(()=>[y(" Add Query Param ")]),_:1})]),_:1})]),_:1},8,["header"]),t(e(B),{header:`Headers (${a.headers.length})`},{default:o(()=>[(i(!0),S(E,null,x(a.headers,(s,r)=>(i(),p(e(f),{key:r,label:r===0?"Headers":void 0},{default:o(()=>[t(e($),null,{default:o(()=>[t(e(g),{value:s.key,"onUpdate:value":n=>s.key=n,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(g),{value:s.value,"onUpdate:value":n=>s.value=n,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),t(e(C),{danger:"",onClick:n=>l(r)},{default:o(()=>[y("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["label"]))),128)),t(e(f),null,{default:o(()=>[t(e(C),{type:"dashed",style:{width:"100%"},onClick:T},{default:o(()=>[y("Add Header")]),_:1})]),_:1})]),_:1},8,["header"]),t(e(B),{header:"Body"},{default:o(()=>[a.method!=="GET"?(i(),p(e(f),{key:0},{default:o(()=>[t(e(L),{value:a.body,"onUpdate:value":u[1]||(u[1]=s=>a.body=s)},null,8,["value"])]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1}),t(e(f),null,{default:o(()=>[Y("div",ke,[t(le,{loading:m.value,disabled:d.disabledWarning,onClick:w,onSave:u[2]||(u[2]=s=>d.hook.save())},null,8,["loading","disabled"])])]),_:1}),t(e(de),{orientation:"left"},{default:o(()=>[y("Response")]),_:1}),a.response?(i(),S("div",ye,[t(e(K),{color:P.value},{default:o(()=>[y(N(a.response.status),1)]),_:1},8,["color"]),t(e(ue),null,{default:o(()=>[(i(!0),S(E,null,x(a.response.headers,(s,r)=>(i(),p(e(ne),{key:r,label:r},{default:o(()=>[y(N(s),1)]),_:2},1032,["label"]))),128))]),_:1}),t(e(L),{value:a.response.body},null,8,["value"])])):h("",!0)]),_:1}))}}),bt=D({__name:"HookEditor",setup(v){const c=X(),k=Z(),b=_(null),P=_(null),a=r=>{!l.value||(l.value.hook.file=r)},m=_("source-code");function w(){var n;if(!l.value)return;const r=l.value.hook.codeContent;(n=b.value)==null||n.updateLocalEditorCode(r)}const H=O(()=>{var r;return(r=l.value)!=null&&r.hook.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null});function U(){c.push({name:"stages"})}const T=_(null),{result:l}=z(async()=>{const[r,n]=await Promise.all([se.get(),re.get(k.params.id)]);return te({workspace:r,hook:n})}),d=V.create(),u=r=>{var n;return r!==m.value&&((n=l.value)==null?void 0:n.hook.hasChanges())};async function s(){var r,n;(r=T.value)==null||r.closeConsole();try{await((n=l.value)==null?void 0:n.hook.save()),w(),m.value="test"}catch{ae.error({message:"Error saving"})}}return(r,n)=>(i(),p(R,null,ee({navbar:o(()=>[e(l)?(i(),p(e(ce),{key:0,title:e(l).hook.title,style:{padding:"5px 25px",border:"1px solid #f6f6f6"},onBack:U},{extra:o(()=>[t(me,{"docs-path":"concepts/hooks","editing-model":e(l).hook},null,8,["editing-model"])]),_:1},8,["title"])):h("",!0)]),content:o(()=>[e(l)?(i(),p(M,{key:0},{left:o(()=>[t(e(fe),{"active-key":m.value,"onUpdate:activeKey":n[0]||(n[0]=I=>m.value=I)},{rightExtra:o(()=>[t(e(C),{onClick:s},{default:o(()=>[t(e(oe),{size:"20"})]),_:1})]),default:o(()=>[t(e(A),{key:"source-code",tab:"Source code",disabled:u("source-code")},null,8,["disabled"]),t(e(A),{key:"test",tab:"Test",disabled:u("test")},null,8,["disabled"]),t(e(A),{key:"tasks",tab:"Tasks",disabled:u("tasks")},null,8,["disabled"]),t(e(A),{key:"settings",tab:"Settings",disabled:u("settings")},null,8,["disabled"])]),_:1},8,["active-key"]),m.value==="source-code"?(i(),p(W,{key:0,ref_key:"code",ref:b,script:e(l).hook,workspace:e(l).workspace,onUpdateFile:a},null,8,["script","workspace"])):h("",!0),e(l).hook&&m.value==="settings"?(i(),p(ve,{key:1,hook:e(l).hook},null,8,["hook"])):h("",!0),e(l).hook&&m.value==="test"?(i(),p(he,{key:2,ref_key:"tester",ref:P,hook:e(l).hook,"disabled-warning":H.value},null,8,["hook","disabled-warning"])):m.value==="tasks"?(i(),p(pe,{key:3,"stage-id":e(l).hook.id},null,8,["stage-id"])):h("",!0)]),right:o(()=>[t(Q,{"stage-type":"hooks",workspace:e(l).workspace,stage:e(l).hook,"log-service":e(d)},null,8,["workspace","stage","log-service"])]),_:1})):h("",!0)]),_:2},[e(l)?{name:"footer",fn:o(()=>[t(G,{ref_key:"smartConsole",ref:T,"stage-type":"hooks",stage:e(l).hook,"log-service":e(d),workspace:e(l).workspace},null,8,["stage","log-service","workspace"])]),key:"0"}:void 0]),1024))}});export{bt as default};
//# sourceMappingURL=HookEditor.d11a4aa2.js.map

import{d as N,f as h,o as d,c as p,w as t,b as a,u as e,dh as o,dc as m,aG as r,e9 as g,eC as X,bO as P,d5 as Y,S as b,Y as w,eb as A,d9 as q,d2 as H,aS as D,a0 as U,X as Q,ah as W,bT as F,el as Z,eD as x,F as ee,cy as te,cz as V,bL as ae,cE as se,cL as le,em as ne,en as de,a as re}from"./index.0050062d.js";import{T as oe,L as ie}from"./tasksController.bbd2773f.js";import{t as ue}from"./ant-design.2b9c7b39.js";import{F as E}from"./PhArrowSquareOut.vue.40487513.js";import{_ as L}from"./AbstraButton.vue_vue_type_script_setup_true_lang.e67738fa.js";import{A as pe}from"./index.dddfec09.js";import{C as ce}from"./Card.1b95b8d2.js";import{A as ke,C as fe}from"./CollapsePanel.da1aa02b.js";import"./index.bb2e54f0.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[v]="f46dbcde-82f1-4c76-b888-ce8b7deefe22",u._sentryDebugIdIdentifier="sentry-dbid-f46dbcde-82f1-4c76-b888-ce8b7deefe22")}catch{}})();const ye=N({__name:"TaskCard",props:{task:{},checked:{type:Boolean},type:{},map:{}},emits:["change"],setup(u,{emit:v}){const c=u,C=(l,i)=>{let _=`/_editor/${l}/${i}`;window.open(`${_}`,"_blank")},S=h(()=>c.task.targetStageTitle.length<16?c.task.targetStageTitle:c.task.targetStageTitle.slice(0,16)+"..."),$=h(()=>c.task.sourceStageTitle.length<16?c.task.sourceStageTitle:c.task.sourceStageTitle.slice(0,16)+"...");return(l,i)=>(d(),p(e(ce),{size:"small"},{default:t(()=>[a(e(o),{justify:"space-between",vertical:""},{default:t(()=>[a(e(o),{justify:"end",style:{height:"6px"}},{default:t(()=>[a(e(m),{type:"secondary",style:{"font-size":"10px","margin-top":"-5px"}},{default:t(()=>[r(g(e(X)(new Date(l.task.created.at))),1)]),_:1})]),_:1}),a(e(o),{align:"start",justify:"space-between"},{default:t(()=>[a(e(o),{align:"center",gap:"middle"},{default:t(()=>[a(e(P),{checked:l.checked,disabled:l.type==="sent",onChange:i[0]||(i[0]=_=>v("change",l.task.id))},null,8,["checked","disabled"]),a(e(o),{align:"center"},{default:t(()=>[a(e(Y),{color:l.map.get(l.task.type)},{default:t(()=>[r(g(l.task.type.length>18?l.task.type.slice(0,18)+"...":l.task.type),1)]),_:1},8,["color"]),a(e(pe),{type:"vertical"}),l.type==="received"&&l.task.sourceStageTitle?(d(),p(e(o),{key:0,align:"center"},{default:t(()=>[a(e(m),{type:"secondary"},{default:t(()=>[r("Sent by: ")]),_:1}),a(L,{type:"link",onClick:i[1]||(i[1]=_=>C(l.task.sourceStageType,l.task.created.byStageId))},{default:t(()=>[r(g($.value)+" ",1),a(e(E),{size:16})]),_:1})]),_:1})):b("",!0),l.type==="received"&&!l.task.sourceStageTitle?(d(),p(e(o),{key:1,align:"center"},{default:t(()=>[a(e(m),{type:"secondary"},{default:t(()=>[r("Created manually")]),_:1})]),_:1})):b("",!0),l.type==="sent"?(d(),p(e(o),{key:2,align:"center"},{default:t(()=>[a(e(m),{type:"secondary"},{default:t(()=>[r("Sent to: ")]),_:1}),a(L,{type:"link",onClick:i[2]||(i[2]=_=>C(l.task.targetStageType,l.task.targetStageId))},{default:t(()=>[r(g(S.value)+" ",1),a(e(E),{size:16})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1}),a(e(o),{vertical:"",style:{padding:"10px"}},{default:t(()=>[(d(!0),w(D,null,A(l.task.payload,(_,I)=>(d(),p(e(o),{key:I},{default:t(()=>[a(e(q),{class:"center"},{default:t(()=>[r(g(I)+":",1)]),_:2},1024),a(e(H),{"tree-data":e(ue)(_),selectable:!1,style:{padding:"0"}},{title:t(({title:f})=>[a(e(m),{type:"secondary",style:{"max-width":"200px"},ellipsis:""},{default:t(()=>[r(g(f),1)]),_:2},1024)]),_:2},1032,["tree-data"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}});const ge=U(ye,[["__scopeId","data-v-c67a9853"]]),me=u=>(ne("data-v-1fd9b528"),u=u(),de(),u),_e=me(()=>re("code",null,"send_task",-1)),ve=N({__name:"TasksManager",props:{stageId:{}},emits:["refetch-tasks"],setup(u,{emit:v}){const c=u,C=new ie,S=k=>{k(),v("refetch-tasks",c.stageId)},{setup:$,tearDown:l,state:i,createTask:_,startCreatingTask:I,creatingTaskState:f,cancelCreatingTask:j,isPayloadValid:B,collapseValue:z,getPossibleActions:O,checkTask:G}=oe({api:C,poll:!1,stageId:c.stageId,stages:null}),R=h(()=>O()),J=(k,n)=>{k.stopPropagation();const s=M.value.find(T=>T.key===n);if(!s)return;const y=s.tasks.every(T=>T.checked);s.tasks.forEach(T=>T.checked=!y)},M=h(()=>{var k;return[{key:"pending",title:"Pending tasks",tasks:i.tasks.filter(n=>n.status==="pending"),type:"received"},{key:"completed",title:"Completed tasks",tasks:i.tasks.filter(n=>n.status==="completed"),type:"received"},{key:"sent",title:"Sent tasks",tasks:(k=i.sentTasks)!=null?k:[],type:"sent"}]}),K=h(()=>{let k={pending:!1,completed:!1,sent:!1};return M.value.forEach(n=>{n.tasks.length!==0&&(k[n.key]=n.tasks.every(s=>s.checked))}),k});return Q(()=>$()),W(()=>l()),(k,n)=>(d(),p(e(o),{vertical:"",gap:"small",class:"tasks-manager"},{default:t(()=>[a(e(o),{justify:"end",gap:"small"},{default:t(()=>[(d(!0),w(D,null,A(R.value,s=>(d(),p(e(F),{key:s.name,onClick:y=>S(s.handler)},{default:t(()=>[r(g(s.label),1)]),_:2},1032,["onClick"]))),128)),a(e(F),{type:"primary",onClick:Z(e(I),["stop"])},{default:t(()=>[r("Add Task")]),_:1},8,["onClick"])]),_:1}),a(e(fe),{"active-key":e(z),"onUpdate:activeKey":n[0]||(n[0]=s=>ee(z)?z.value=s:null),ghost:""},{default:t(()=>[(d(!0),w(D,null,A(M.value,s=>(d(),p(e(ke),{key:s.key},{header:t(()=>[a(e(o),{gap:"small"},{default:t(()=>[a(e(P),{checked:K.value[s.key],disabled:s.tasks.length===0,onClick:y=>J(y,s.key)},null,8,["checked","disabled","onClick"]),a(e(m),null,{default:t(()=>[r(g(s.title)+" : "+g(s.tasks.length),1)]),_:2},1024)]),_:2},1024)]),default:t(()=>[a(e(o),{vertical:"",gap:"small"},{default:t(()=>[a(x,null,{default:t(()=>[(d(!0),w(D,null,A(s.tasks,y=>(d(),p(ge,{key:y.id+"-"+s.key,task:y,type:s.type,map:e(i).colorMap,checked:!!y.checked,onChange:T=>e(G)(y.id)},null,8,["task","type","map","checked","onChange"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["active-key"]),a(e(le),{open:e(f).state==="creating","ok-button-props":{disabled:!e(B)},onCancel:e(j),onOk:n[3]||(n[3]=s=>S(e(_)))},{title:t(()=>[a(e(m),null,{default:t(()=>[r("Add Task")]),_:1})]),default:t(()=>[a(e(te),{layout:"vertical"},{default:t(()=>[a(e(V),{label:"Task type"},{default:t(()=>[e(f).state==="creating"?(d(),p(e(ae),{key:0,value:e(f).name,"onUpdate:value":n[1]||(n[1]=s=>e(f).name=s),"auto-size":""},null,8,["value"])):b("",!0)]),_:1}),a(e(V),{label:"Task data"},{default:t(()=>[e(f).state==="creating"?(d(),p(e(se),{key:0,value:e(f).payloadCode,"onUpdate:value":n[2]||(n[2]=s=>e(f).payloadCode=s),"auto-size":""},null,8,["value"])):b("",!0)]),_:1})]),_:1}),e(B)?b("",!0):(d(),p(e(m),{key:0,type:"danger"},{default:t(()=>[r("Invalid JSON")]),_:1}))]),_:1},8,["open","ok-button-props","onCancel"]),a(e(m),{type:"secondary"},{default:t(()=>[r(" Use "),_e,r(" on previous stages to send tasks to this stage. ")]),_:1})]),_:1}))}});const $e=U(ve,[["__scopeId","data-v-1fd9b528"]]);export{$e as T};
//# sourceMappingURL=TasksManager.ec09dd2e.js.map

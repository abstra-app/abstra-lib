import{d as Y,r as N,H as K,G as fe,b as f,ev as A,f as a,w as n,aD as W,ar as T,eD as Z,ex as I,e as D,u as e,cz as me,bG as F,cG as ve,cE as te,eC as ge,c as C,bz as H,eK as Te,bA as xe,eN as ae,eB as le,J as ue,a as ne,bg as ye,o as Le,ae as Ue,v as re,eA as be,eE as he,eF as _e,eM as Ae}from"./outputWidgets.3c3deba7.js";import{p as ke,T as J,d as Ne}from"./tables.70bbd5be.js";import{B as Ee}from"./BaseLayout.da9f9b22.js";import{a as oe}from"./asyncComputed.41e37f4b.js";import{p as X}from"./popupNotifcation.032fe7c1.js";import{A as Ce}from"./index.9c0f1ee5.js";import{F as ie,A as B}from"./Form.21b032af.js";import{A as de}from"./index.071c40f7.js";import"./router.2687a12c.js";import{P as ce}from"./project.a7f8dc6e.js";import"./index.79fda194.js";import{O as Be}from"./organization.aba66f3b.js";import{Z as we,_ as De,$ as ze,P as qe,a0 as Ke}from"./icons.c5a369ef.js";import{A as Ie}from"./index.0539d0c4.js";import{A as ee}from"./index.a78013f7.js";import{L as Re}from"./CircularLoading.34d2123c.js";import{T as je,A as se}from"./TabPane.6a76387e.js";import{B as Oe,a as Pe,c as Fe}from"./index.9a533a9a.js";import"./record.e2163ce9.js";import"./pubsub.59f66cb7.js";import"./string.dc95a94c.js";import"./hasIn.26cab181.js";import"./isNumeric.75337b1e.js";import"./index.cf4c23b9.js";import"./index.2091f9c4.js";import"./ArrowRightOutlined.08fa31dd.js";import"./Base.c0a62eaa.js";import"./Typography.828881b4.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b=new Error().stack;b&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[b]="63bab91f-1fd4-4ad9-b3bd-e3be6e567ef6",h._sentryDebugIdIdentifier="sentry-dbid-63bab91f-1fd4-4ad9-b3bd-e3be6e567ef6")}catch{}})();const Me={class:"table-data",style:{width:"calc(100% - 80px)"}},Ve={key:1},Ge=["onClick"],He=D("a",null,"Delete",-1),Je=Y({__name:"TableData",props:{table:{}},setup(h){var s,_;const b=h,t=N(1),m=N(10),$=K(()=>{var l,y;return{total:(y=(l=v.value)==null?void 0:l.total)!=null?y:0,current:t.value,pageSize:m.value,totalBoundaryShowSizeChanger:10,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],onChange:async(k,O)=>{t.value=k,m.value=O,await c()}}}),S=K(()=>{var l;return((l=v.value)==null?void 0:l.rows.length)===1}),{result:v,loading:L,refetch:c}=oe(()=>b.table.select({},(t.value-1)*m.value,m.value)),g=(l,y)=>k=>{if(l==="json"&&k==""){i.value[y]="null";return}i.value[y]=k},E=(s=b.table)==null?void 0:s.getColumns().map(l=>({title:l.name,dataIndex:l.name,resizable:!0,minWidth:100,ellipsis:!1})),x=N([...E,{title:"",key:"action",fixed:"right",width:150,align:"center"}]);function p(l,y){y.width=l}const U=K(()=>{var l;return((l=v.value)==null?void 0:l.rows.map(y=>({key:y.id,...y})))||[]}),z=N(!1),i=N({}),R=()=>{z.value=!0},V=()=>{i.value={},z.value=!1};let G=fe((_=b.table)==null?void 0:_.getUnprotectedColumns().reduce((l,y)=>({...l,[y.name]:""}),{}));async function j(){if(!(!b.table||!G))try{i.value.id?await b.table.updateRow(i.value.id,i.value):await b.table.insertRow(i.value),i.value={},c(),V()}catch(l){l instanceof Error&&X("Database error",l.message)}}const u=async l=>{if(!(!v.value||!v.value.rows.find(y=>y.id===l)))try{await b.table.deleteRow(l),S.value&&(t.value=Math.max(1,t.value-1)),c()}catch(y){y instanceof Error&&X("Database error",y.message)}},o=l=>{var P;const y=(P=U.value)==null?void 0:P.filter(q=>l===q.key)[0],k=b.table.getColumns(),O=k.map(q=>q.name),Q=k.filter(q=>q.type==="json").map(q=>q.name);i.value=ae.exports.pick(ae.exports.cloneDeep(y),O),Q.forEach(q=>{i.value[q]&&(i.value[q]=JSON.stringify(i.value[q]))}),R()};return(l,y)=>(f(),A("div",Me,[a(e(ve),{columns:x.value,"data-source":U.value,pagination:$.value,bordered:"",loading:e(L),scroll:{x:2e3,y:720},size:"small",onResizeColumn:p},{bodyCell:n(({column:k,text:O,record:Q})=>[x.value.map(P=>P.title).includes(k.dataIndex)?(f(),A(W,{key:0},[T(Z(O),1)],64)):I("",!0),k.key==="action"?(f(),A("div",Ve,[D("span",null,[D("a",{onClick:P=>o(Q.id)},"Edit",8,Ge)]),a(e(Ce),{type:"vertical"}),a(e(me),{title:"Sure to delete?",onConfirm:P=>u(Q.id)},{default:n(()=>[He]),_:2},1032,["onConfirm"])])):I("",!0)]),footer:n(()=>[a(e(F),{type:"primary",onClick:R},{default:n(()=>[T("+ Add New Data")]),_:1})]),_:1},8,["columns","data-source","pagination","loading"]),a(e(de),{title:"Data",width:720,open:z.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:V},{extra:n(()=>[a(e(te),null,{default:n(()=>[a(e(F),{onClick:V},{default:n(()=>[T("Cancel")]),_:1}),a(e(F),{type:"primary",onClick:j},{default:n(()=>[T("Submit")]),_:1})]),_:1})]),default:n(()=>[a(e(ie),{model:i.value,layout:"vertical"},{default:n(()=>[(f(!0),A(W,null,ge(l.table.getUnprotectedColumns(),k=>(f(),C(e(B),{key:k.id,label:k.name,required:!k.nullable},{default:n(()=>[i.value?(f(),C(e(H),{key:0,placeholder:k.type,value:i.value[k.name],disabled:i.value[k.name]===null,"onUpdate:value":O=>g(k.type,k.name)(O)},Te({_:2},[k.nullable?{name:"addonAfter",fn:n(()=>[a(e(xe),{checked:i.value[k.name]===null,"onUpdate:checked":O=>i.value[k.name]=O?null:""},{default:n(()=>[T(" NULL ")]),_:2},1032,["checked","onUpdate:checked"])]),key:"0"}:void 0]),1032,["placeholder","value","disabled","onUpdate:value"])):I("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])]),_:1},8,["open"])]))}});const $e=(h,b)=>b.includes(h)?{status:"error",help:"There already is a column with this name in the table"}:{status:""},Qe=Y({__name:"NewColumn",props:{open:{type:Boolean},table:{}},emits:["created","cancel"],setup(h,{emit:b}){const t=h,$=le().params.projectId,S=K(()=>{var o;return((o=t.table)==null?void 0:o.getColumns().map(s=>s.name))||[]}),v=K(()=>$e(c.value.name,S.value)),L={name:"",type:"varchar",default:"",nullable:!0,unique:!1},c=N(L),g=()=>{c.value={...L}},E=N([{value:"reference",label:"reference",isLeaf:!1},...ke.map(o=>({value:o,label:o,isLeaf:!0}))]),x=o=>{if(!o)return;const s=o[o.length-1];switch(o.length){case 0:return;case 1:s.loading=!0,J.list($).then(_=>{s.children=_.map(l=>({value:l.id,label:l.name,isLeaf:!1})),s.loading=!1});return;case 2:s.loading=!0,J.get($,s.value).then(_=>{s.children=_.getColumns().map(l=>({type:l.type,value:l.id,label:l.name,isLeaf:!0})),s.loading=!1});return}},p=(o,s)=>{if(!!o){if(o.length===1){c.value.type=o[0],c.value.foreignKey=void 0;return}if(o.length===3){const _=s[s.length-1];c.value.type=_.type,c.value.foreignKey={columnId:_.value}}}},U=o=>{const s=o.selectedOptions;return s?s.length===1?s[0].label:s.length===3?`reference to ${s[1].label}(${s[2].label})`:"":"Select type"},i=N({...{status:"success",message:"",fakeLoading:!1}}),R=()=>{i.value.fakeLoading=!0,G()};ue(()=>c.value.type,()=>{c.value.default=Ne[c.value.type]||"",R()});const G=ae.exports.debounce(async()=>{if(!c.value.default){i.value.status="success",i.value.message="",i.value.fakeLoading=!1;return}const o=`select (${c.value.default})::${c.value.type} `;ce.executeQuery($,o,[]).then(s=>{i.value.status=s.errors.length>0?"error":"success",i.value.message=s.errors[0]||"",i.value.fakeLoading=!1})},500);function j(){b("cancel")}async function u(){if(!!t.table&&!(!c.value.name||!c.value.type))try{await t.table.addColumn(c.value),g(),b("created")}catch(o){o instanceof Error&&X("Database error",o.message)}}return(o,s)=>{const _=ne("icon");return f(),C(e(de),{title:"New column",width:720,open:t.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:j},{extra:n(()=>[a(e(te),null,{default:n(()=>[a(e(F),{onClick:j},{default:n(()=>[T("Cancel")]),_:1}),a(e(F),{type:"primary",onClick:u},{default:n(()=>[T("Submit")]),_:1})]),_:1})]),default:n(()=>[a(e(ie),{model:c.value,layout:"vertical"},{default:n(()=>[a(e(B),{key:"name",label:"Name",required:"","validate-status":v.value.status,help:v.value.help},{default:n(()=>[a(e(H),{value:c.value.name,"onUpdate:value":s[0]||(s[0]=l=>c.value.name=l)},null,8,["value"])]),_:1},8,["validate-status","help"]),a(e(B),{key:"type",label:"Type",required:""},{default:n(()=>[a(e(Ie),{options:E.value,"load-data":x,"display-render":U,"allow-clear":!1,onChange:p},null,8,["options"])]),_:1}),a(e(B),{key:"default-value",label:"Default value","validate-status":i.value.status,help:i.value.message},{default:n(()=>[a(e(H),{value:c.value.default,"onUpdate:value":s[1]||(s[1]=l=>c.value.default=l),onInput:R},{suffix:n(()=>[i.value.fakeLoading?(f(),C(e(ye),{key:0})):I("",!0),!i.value.fakeLoading&&i.value.status==="success"?(f(),C(_,{key:1,path:e(we),width:"18",height:"18"},null,8,["path"])):I("",!0),!i.value.fakeLoading&&i.value.status==="error"?(f(),C(_,{key:2,path:e(De),width:"18",height:"18"},null,8,["path"])):I("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),a(e(B),{key:"nullable",label:"Nullable"},{default:n(()=>[a(e(ee),{checked:c.value.nullable,"onUpdate:checked":s[2]||(s[2]=l=>c.value.nullable=l)},null,8,["checked"])]),_:1}),a(e(B),{key:"unique",label:"Unique"},{default:n(()=>[a(e(ee),{checked:c.value.unique,"onUpdate:checked":s[3]||(s[3]=l=>c.value.unique=l)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),We={class:"twin-container"},Ze={class:"fullwidth-input"},Xe={class:"fullwidth-input"},Ye={class:"using-container"},et={class:"fullwidth-input"},tt=Y({__name:"UpdateColumn",props:{open:{type:Boolean},table:{},column:{}},emits:["updated","cancel"],setup(h,{emit:b}){const t=h,$=le().params.projectId,S=N(t.column.record.initialState.type);Le(async()=>{if(!t.column.foreignKey)return;S.value="loading...";const r=await J.fromColumnId($,t.column.foreignKey.columnId),d=r.getColumn(t.column.foreignKey.columnId);S.value=`reference to ${r.name}(${d.name})`});const v=K(()=>{var r;return((r=t.table)==null?void 0:r.getColumns().map(d=>d.record.initialState.name))||[]}),L=K(()=>t.column.name===t.column.record.initialState.name?{status:"",help:""}:$e(t.column.name,v.value)),{result:c,loading:g}=oe(async()=>t.table.select({},10,0).then(({total:r})=>r));function E(){t.column.record.resetChanges(),b("cancel")}const p=N({status:"success",message:"",fakeLoading:!1}),U=()=>{p.value.fakeLoading=!0,z()},z=ae.exports.debounce(async()=>{if(!t.column.default){p.value.status="success",p.value.message="",p.value.fakeLoading=!1;return}const r=`select (${t.column.default})::${t.column.type} `,d=await ce.executeQuery($,r,[]);p.value.status=d.errors.length>0?"error":"success",p.value.message=d.errors[0]||"",p.value.fakeLoading=!1},500),i=N([{value:"reference",label:"reference",isLeaf:!1},...ke.map(r=>({value:r,label:r,isLeaf:!0}))]),R=r=>{if(!r)return;const d=r[r.length-1];switch(r.length){case 0:return;case 1:d.loading=!0,J.list($).then(M=>{d.children=M.map(w=>({value:w.id,label:w.name,isLeaf:!1})),d.loading=!1});return;case 2:d.loading=!0,J.get($,d.value).then(M=>{d.children=M.getColumns().map(w=>({type:w.type,value:w.id,label:w.name,isLeaf:!0})),d.loading=!1});return}},V=r=>{const d=r.selectedOptions;return d?d.length===1?d[0].label:d.length===3?`reference to ${d[1].label}(${d[2].label})`:"":"Select type"},G=(r,d)=>{if(!!r){if(r.length===1){t.column.type=r[0],t.column.foreignKey=null;return}if(r.length===3){if(t.column.foreignKey&&t.column.foreignKey.columnId===r[2])return;const M=d[d.length-1];t.column.type=M.type,t.column.foreignKey={columnId:M.value}}}},j=()=>c.value===0||g.value?!1:t.column.record.hasChangesDeep("type"),u=N({type:"default"}),o=()=>{t.column.type=t.column.record.initialState.type,u.value={type:"default"}};function s(r,d){return d==="varchar"||r==="int"&&d==="boolean"||r==="boolean"&&d==="int"}ue(()=>t.column.type,()=>{U(),l.value||(u.value={type:"user-defined",using:P.value,mandatory:!0})});const l=K(()=>u.value.type==="default"&&s(t.column.record.initialState.type,t.column.type)),y=K(()=>!s(t.column.record.initialState.type,t.column.type));function k(r){r?u.value={type:"default"}:u.value={type:"user-defined",using:P.value,mandatory:!1}}function O(r){if(u.value.type==="default")throw new Error("Can't change using when using default casting");u.value.using=r!=null?r:""}const Q=()=>y.value?!0:j()&&u.value.type==="user-defined",P=K(()=>`${t.column.record.initialState.name}::${t.column.type}`);async function q(){if(!t.column)return;let r=u.value.type==="default"?P.value:u.value.using;c.value===0&&(r=`${t.column.name}::text::${t.column.type}`);try{await t.column.update(r),b("updated")}catch(d){d instanceof Error&&X("Database error",d.message)}}return(r,d)=>{const M=ne("icon");return f(),C(e(de),{title:"Edit column",width:720,open:r.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:E},{extra:n(()=>[a(e(te),null,{default:n(()=>[a(e(F),{onClick:E},{default:n(()=>[T("Cancel")]),_:1}),a(e(F),{type:"primary",onClick:q},{default:n(()=>[T("Submit")]),_:1})]),_:1})]),default:n(()=>[a(e(ie),{model:r.column,layout:"vertical"},{default:n(()=>[a(e(B),{key:"name",label:"Name","validate-status":L.value.status,help:L.value.help},{default:n(()=>[a(e(H),{value:r.column.name,"onUpdate:value":d[0]||(d[0]=w=>r.column.name=w)},null,8,["value"])]),_:1},8,["validate-status","help"]),D("div",We,[D("span",Ze,[a(e(B),{key:"type",label:"Current Type"},{default:n(()=>[a(e(Ue),{value:S.value,"onUpdate:value":d[1]||(d[1]=w=>S.value=w),"default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),a(M,{class:"right-arrow",path:e(ze)},null,8,["path"]),D("span",Xe,[a(e(B),{key:"new-type",label:"New Type"},{default:n(()=>[a(e(Ie),{options:i.value,"load-data":R,"display-render":V,"allow-clear":!0,onClear:o,onChange:G},null,8,["options"])]),_:1})])]),a(e(B),{key:"default-value",label:"Default value","validate-status":p.value.status,help:p.value.message},{default:n(()=>[a(e(H),{value:r.column.default,"onUpdate:value":d[2]||(d[2]=w=>r.column.default=w),onInput:U},{suffix:n(()=>[p.value.fakeLoading?(f(),C(e(ye),{key:0,size:"small"})):I("",!0),!p.value.fakeLoading&&p.value.status==="success"?(f(),C(M,{key:1,path:e(we),width:"18",height:"18"},null,8,["path"])):I("",!0),!p.value.fakeLoading&&p.value.status==="error"?(f(),C(M,{key:2,path:e(De),width:"18",height:"18"},null,8,["path"])):I("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),D("div",Ye,[j()?(f(),C(e(B),{key:"default-casting",label:"Use default casting"},{default:n(()=>[a(e(ee),{checked:l.value,disabled:y.value,"onUpdate:checked":d[3]||(d[3]=w=>k(!!w))},null,8,["checked","disabled"])]),_:1})):I("",!0),D("span",et,[j()?(f(),C(e(B),{key:"using",label:"Using"},{default:n(()=>[a(e(H),{value:u.value.type==="user-defined"?u.value.using:P.value,disabled:!Q(),onInput:d[4]||(d[4]=w=>O(w.target.value))},null,8,["value","disabled"])]),_:1})):I("",!0)])]),a(e(B),{key:"nullable",label:"Nullable"},{default:n(()=>[a(e(ee),{checked:r.column.nullable,"onUpdate:checked":d[5]||(d[5]=w=>r.column.nullable=w)},null,8,["checked"])]),_:1}),a(e(B),{key:"unique",label:"Unique"},{default:n(()=>[a(e(ee),{checked:r.column.unique,"onUpdate:checked":d[6]||(d[6]=w=>r.column.unique=w)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}});const at=re(tt,[["__scopeId","data-v-d14cbe65"]]),Se=h=>(he("data-v-e8bbfa9c"),h=h(),_e(),h),lt={class:"table-settings"},nt={key:0},ot=Se(()=>D("span",null," protected ",-1)),st=[ot],ut={key:1},rt=["onClick"],it=Se(()=>D("a",null,"Delete",-1)),dt=Y({__name:"TableColumns",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(h,{emit:b}){var j;const t=h,m=N(t.loading);ue(()=>t.loading,()=>{m.value=t.loading});const $=be(),S=le();(j=t.table)==null||j.onUpdate(()=>{var u;$.replace({name:"tableEditor",params:{tableName:(u=t.table)==null?void 0:u.name}})});const v=S.params.projectId,c=[...[{title:"Name",dataIndex:"name",sorter:(u,o)=>u.name.localeCompare(o.name)},{title:"Type",dataIndex:"type",sorter:(u,o)=>u.type.localeCompare(o.type)},{title:"Default Value",dataIndex:"default",sorter:(u,o)=>{var s,_,l,y;return(y=(l=u.default)==null?void 0:l.localeCompare((_=(s=o.default)==null?void 0:s.toString())!=null?_:""))!=null?y:0}},{title:"Nullable",dataIndex:"nullable",sorter:(u,o)=>u.nullable||!o.nullable?1:-1},{title:"Unique",dataIndex:"unique",sorter:(u,o)=>u.unique||!o.unique?1:-1},{title:"Primary Key",dataIndex:"primaryKey",sorter:(u,o)=>u.primaryKey||!o.primaryKey?1:-1}],{title:"",key:"action"}],g=K(()=>{var u;return(u=t.table)==null?void 0:u.getColumns()}),{result:E,refetch:x}=oe(async()=>{const u=new Map;return g.value&&await Promise.all(g.value.map(async o=>{if(!o.foreignKey)u.set(o.id,o.type);else{const s=o.foreignKey.columnId,_=await J.fromColumnId(v,s),l=_.getColumn(s);u.set(o.id,`reference to ${_.name}(${l==null?void 0:l.name})`)}})),u});function p(){i.value={type:"idle"}}function U(){p(),x(),m.value=!0,setTimeout(()=>{b("refresh")},500)}function z(){i.value={type:"creating"}}const i=N({type:"idle"});function R(u){var o,s;(s=(o=t.table)==null?void 0:o.getColumn(u))==null||s.delete(),m.value=!0,setTimeout(()=>{b("refresh")},500)}const V=u=>{var o,s,_;return(_=(s=(o=t.table)==null?void 0:o.getColumn(u))==null?void 0:s.protected)!=null?_:!1},G=u=>{if(!t.table)throw new Error("Table not found");i.value={type:"editing",column:t.table.getColumn(u)}};return(u,o)=>(f(),A("div",lt,[a(e(ve),{columns:c,"data-source":g.value,bordered:"",loading:m.value,pagination:!1},{bodyCell:n(({column:s,text:_,record:l})=>[s.dataIndex==="type"?(f(),A(W,{key:0},[T(Z(e(E)?e(E).get(l.id):"loading..."),1)],64)):s.key!=="action"?(f(),A(W,{key:1},[T(Z(_),1)],64)):(f(),A(W,{key:2},[V(l.id)?(f(),A("div",nt,st)):(f(),A("div",ut,[D("span",null,[D("a",{onClick:()=>G(l.id)},"Edit",8,rt)]),a(e(Ce),{type:"vertical"}),a(e(me),{title:"Sure to delete?",onConfirm:y=>R(l.id)},{default:n(()=>[it]),_:2},1032,["onConfirm"])]))],64))]),footer:n(()=>[a(e(F),{type:"primary",onClick:z},{default:n(()=>[T("+ Add New Column")]),_:1})]),_:1},8,["data-source","loading"]),u.table&&i.value.type==="creating"?(f(),C(Qe,{key:0,open:"",table:t.table,onClose:p,onCancel:p,onCreated:U},null,8,["table"])):I("",!0),u.table&&i.value.type==="editing"?(f(),C(at,{key:1,column:i.value.column,open:"",table:u.table,onUpdated:U,onClose:p,onCancel:p},null,8,["column","table"])):I("",!0)]))}});const ct=re(dt,[["__scopeId","data-v-e8bbfa9c"]]),pe=h=>(he("data-v-06f57b7a"),h=h(),_e(),h),pt={class:"table-settings"},ft=pe(()=>D("h2",{class:"title"},"Table settings",-1)),mt=pe(()=>D("div",{class:"subtitle"},"Edit table metadata",-1)),vt={key:0,class:"table-presenter"},gt={class:"table-property-item"},yt={class:"property-item"},bt={key:1},ht={class:"change-warning"},_t={class:"section-title"},kt=pe(()=>D("div",{class:"section-body"}," Changing the table's name can possibly result in the break of running applications. ",-1)),Ct={class:"table-name-value-input"},wt={key:0,class:"error"},Dt=Y({__name:"TableSettings",props:{table:{}},emits:["refresh"],setup(h,{emit:b}){const t=h,m=fe({error:"",editing:!1,loading:!1}),$=()=>m.editing=!0,S=()=>{t.table.resetChanges(),m.editing=!1,m.error=""},v=async()=>{m.error="",m.loading=!0;try{await L()}catch(g){g instanceof Error&&(X("Database error",g.message),m.error=g.message)}m.error||(m.editing=!1),m.loading=!1},L=async()=>{if(!t.table.name){m.error="Table name cannot be empty";return}try{await t.table.save(),b("refresh")}catch(g){g instanceof Error&&(X("Database error",g.message),m.error=g.message)}},c=g=>{t.table.name=g.target.value};return(g,E)=>{var p;const x=ne("icon");return f(),A("div",pt,[ft,mt,m.editing?(f(),A("div",bt,[D("div",ht,[D("div",_t,[a(x,{path:e(qe),width:"12",height:"12",fill:"#D35249"},null,8,["path"]),T(" Be careful ")]),kt]),a(e(te),{direction:"vertical"},{default:n(()=>[D("div",Ct,[a(e(H),{value:g.table.name,type:"text",onInput:c,onBlur:E[0]||(E[0]=U=>g.table.fixTraillingName())},null,8,["value"])]),m.error?(f(),A("div",wt,[a(x,{path:e(Ke),fill:"#D35249",width:"12",height:"12"},null,8,["path"]),T(" "+Z(m.error),1)])):I("",!0),a(e(te),null,{default:n(()=>[a(e(F),{onClick:S},{default:n(()=>[T("Cancel")]),_:1}),a(e(F),{type:"primary",disabled:!g.table.hasChangesDeep("name"),onClick:v},{default:n(()=>[T(" Save Changes "),m.loading?(f(),C(Re,{key:0,size:"16"})):I("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})])):(f(),A("div",vt,[D("div",gt,[D("div",yt,"Name: "+Z((p=g.table)==null?void 0:p.name),1)]),a(e(F),{onClick:$},{default:n(()=>[T("Edit Name")]),_:1})]))])}}});const It=re(Dt,[["__scopeId","data-v-06f57b7a"]]),ea=Y({__name:"TableEditor",setup(h){const b=be(),t=le(),m=t.params.tableId,$=t.params.projectId,S=N("data"),{result:v,loading:L,refetch:c}=oe(()=>Promise.all([ce.get($).then(async x=>{const p=await Be.get(x.organizationId);return{project:x,organization:p}}),J.get($,m)]).then(([{project:x,organization:p},U])=>Ae({project:x,organization:p,table:U}))),g=K(()=>!L.value&&v.value?[{label:"My organizations",path:"/organizations"},{label:v.value.organization.name,path:`/organizations/${v.value.organization.id}`},{label:v.value.project.name,path:`/projects/${v.value.project.id}/tables`}]:void 0);function E(){b.push({name:"tables",params:{projectId:$}})}return(x,p)=>{const U=ne("router-link");return f(),C(Ee,null,{navbar:n(()=>{var z;return[a(e(Fe),{title:(z=e(v))==null?void 0:z.table.name,style:{padding:"5px 25px"},onBack:E},{footer:n(()=>[a(e(je),{"active-key":S.value,"onUpdate:activeKey":p[0]||(p[0]=i=>S.value=i)},{default:n(()=>[a(e(se),{key:"columns",tab:"Columns"}),a(e(se),{key:"data",tab:"Data"}),a(e(se),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),breadcrumb:n(()=>[g.value?(f(),C(e(Oe),{key:0},{default:n(()=>[(f(!0),A(W,null,ge(g.value,(i,R)=>(f(),C(e(Pe),{key:R},{default:n(()=>[a(U,{to:i.path},{default:n(()=>[T(Z(i.label),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):I("",!0)]),_:1},8,["title"])]}),content:n(()=>[e(v)&&S.value==="columns"?(f(),C(ct,{key:0,table:e(v).table,loading:e(L),onRefresh:p[1]||(p[1]=z=>e(c)())},null,8,["table","loading"])):I("",!0),e(v)&&S.value==="data"?(f(),C(Je,{key:1,loading:e(L),table:e(v).table},null,8,["loading","table"])):I("",!0),e(v)&&S.value==="settings"?(f(),C(It,{key:2,table:e(v).table,loading:e(L),onRefresh:p[2]||(p[2]=z=>e(c)())},null,8,["table","loading"])):I("",!0)]),_:1})}}});export{ea as default};
//# sourceMappingURL=TableEditor.6a85cb39.js.map

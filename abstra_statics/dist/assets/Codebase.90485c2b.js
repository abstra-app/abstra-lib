var M=Object.defineProperty;var z=(n,e,t)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var L=(n,e,t)=>(z(n,typeof e!="symbol"?e+"":e,t),t);import{S as B}from"./SourceCode.11bde9ae.js";import{_ as O}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.14f1b61f.js";import{C as H}from"./ContentLayout.16882285.js";import{i as N,F as V,I as J,_ as W}from"./FilesNavigator.af685f1b.js";import{S as Q}from"./SaveButton.eafe8d71.js";import{G as K,I as X}from"./PhFilePy.vue.8f8cb6e2.js";import{G as Y}from"./PhFolder.vue.164d7697.js";import{H as Z,F as ee}from"./PhPackage.vue.ad0464c8.js";import{f as b,g as $,d as te,eH as re,o as u,c as p,w,u as s,a as D,b as j,az as ae,d6 as se,F as G,da as ne,eI as oe,cy as ie,Q as ce}from"./index.56a4aa2e.js";import{F as le,G as ue,a as pe,I as de}from"./PhWebhooksLogo.vue.f3a45ccc.js";import{A as me,b as he,c as fe,d as ye,e as ge,f as be,g as we,h as ke}from"./linters.bbf68979.js";import{W as ve}from"./workspaces.32be68c6.js";import"./asyncComputed.9c066391.js";import"./polling.c6b67ee3.js";import"./validations.38f1d22d.js";import"./string.c8a67ded.js";import"./toggleHighContrast.1f96e29f.js";import"./index.d70f3c4f.js";import"./Card.e1cbf4fc.js";import"./TabPane.f81b8fb1.js";import"./Logo.376aef10.js";import"./popupNotifcation.2b90a8f1.js";import"./ant-design.495703a7.js";import"./UnsavedChangesHandler.492bbe1e.js";import"./ExclamationCircleOutlined.593820b1.js";import"./workspaceStore.00fd0aec.js";import"./userStore.31baf024.js";import"./url.7ee1877f.js";import"./colorHelpers.21549eb9.js";import"./record.1426f0e6.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="4f932741-86ee-4346-92d5-59b895ceff6f",n._sentryDebugIdIdentifier="sentry-dbid-4f932741-86ee-4346-92d5-59b895ceff6f")}catch{}})();class _e{async list(){const t=await(await fetch("/_editor/api/codebase/files")).json();return me.parse(t)}async create(e,t){const i=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"POST",body:t})).json();return he.parse(i)}async delete(e){const c=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();return fe.parse(c)}async update(e,t){const i=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"PUT",body:t})).json();return ye.parse(i)}async retrieve(e){const c=await(await fetch(`/_editor/api/codebase/files/${e}`)).arrayBuffer();return new Uint8Array(c)}async rename(e,t){const c=ge.parse({pathParts:e,newPathParts:t}),m=await(await fetch("/_editor/api/codebase/files/rename",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).json();return be.parse(m)}async mkdir(e){const c=await(await fetch(`/_editor/api/codebase/dir/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();return we.parse(c)}async settings(){const t=await(await fetch("/_editor/api/codebase/settings")).json();return ke.parse(t)}}const xe=n=>{switch(n){case"abap":return"abap";case"apex":return"apex";case"azcli":return"azcli";case"bat":return"bat";case"bicep":return"bicep";case"c":return"c";case"cameligo":return"cameligo";case"clojure":return"clojure";case"coffeescript":return"coffeescript";case"cpp":return"cpp";case"csharp":return"csharp";case"csp":return"csp";case"css":return"css";case"cypher":return"cypher";case"dart":return"dart";case"dockerfile":return"dockerfile";case"ecl":return"ecl";case"elixir":return"elixir";case"flow9":return"flow9";case"freemarker2":return"freemarker2";case"freemarker2.tag-angle.interpolation-bracket":return"freemarker2.tag-angle.interpolation-bracket";case"freemarker2.tag-angle.interpolation-dollar":return"freemarker2.tag-angle.interpolation-dollar";case"freemarker2.tag-auto.interpolation-bracket":return"freemarker2.tag-auto.interpolation-bracket";case"freemarker2.tag-auto.interpolation-dollar":return"freemarker2.tag-auto.interpolation-dollar";case"freemarker2.tag-bracket.interpolation-bracket":return"freemarker2.tag-bracket.interpolation-bracket";case"freemarker2.tag-bracket.interpolation-dollar":return"freemarker2.tag-bracket.interpolation-dollar";case"fsharp":return"fsharp";case"go":return"go";case"graphql":return"graphql";case"handlebars":return"handlebars";case"hcl":return"hcl";case"html":return"html";case"ini":return"ini";case"java":return"java";case"javascript":return"javascript";case"json":return"json";case"julia":return"julia";case"kotlin":return"kotlin";case"less":return"less";case"lexon":return"lexon";case"liquid":return"liquid";case"lua":return"lua";case"m3":return"m3";case"markdown":return"markdown";case"mdx":return"mdx";case"mips":return"mips";case"msdax":return"msdax";case"mysql":return"mysql";case"objective-c":return"objective-c";case"pascal":return"pascal";case"pascaligo":return"pascaligo";case"perl":return"perl";case"pgsql":return"pgsql";case"php":return"php";case"pla":return"pla";case"plaintext":return"plaintext";case"postiats":return"postiats";case"powerquery":return"powerquery";case"powershell":return"powershell";case"proto":return"proto";case"pug":return"pug";case"python":return"python";case"qsharp":return"qsharp";case"r":return"r";case"razor":return"razor";case"redis":return"redis";case"redshift":return"redshift";case"restructuredtext":return"restructuredtext";case"ruby":return"ruby";case"rust":return"rust";case"sb":return"sb";case"scala":return"scala";case"scheme":return"scheme";case"scss":return"scss";case"shell":return"shell";case"sol":return"sol";case"sparql":return"sparql";case"sql":return"sql";case"st":return"st";case"swift":return"swift";case"systemverilog":return"systemverilog";case"tcl":return"tcl";case"twig":return"twig";case"typescript":return"typescript";case"typespec":return"typespec";case"vb":return"vb";case"verilog":return"verilog";case"xml":return"xml";case"yaml":return"yaml";default:return"plaintext"}};class je{constructor(e,t,c,i){L(this,"initialContent");this.fileNode=e,this.content=t,this.sep=c,this.onSave=i,this.initialContent=new Uint8Array(t)}get file(){return this.fileNode.pathParts.join(this.sep)}get codeContent(){return this.text}set codeContent(e){this.text=e}updateInitialState(e,t){this.initialContent=new TextEncoder().encode(t)}get text(){return new TextDecoder().decode(this.content)}set text(e){const t=new TextEncoder;this.content=t.encode(e)}get url(){return`/_editor/api/codebase/files/${this.file}`}hasChanges(){return this.content.length!==this.initialContent.length||!this.content.every((e,t)=>e===this.initialContent[t])}async save(){await this.onSave(this),this.initialContent=new Uint8Array(this.content)}isImage(){return N(this.file)}isText(){return!this.isImage()}}const Ce=n=>{const e=b([]),t=b(!1),c=b(null),i=b({separator:"/"}),m=async()=>{t.value=!0;try{e.value=await n.api.list()}finally{t.value=!1}},C=async()=>{i.value=await n.api.settings()},k=n.router.currentRoute.value.query.f,f=async(a,o)=>{const l=a.join(i.value.separator);await n.api.create(l,o),await m()},F=async a=>{const o=a.join(i.value.separator);await n.api.delete(o),await m()},A=async(a,o)=>{await n.api.rename(a,o),await m()},v=async(a,o)=>{const l=a.join(i.value.separator);await n.api.update(l,o)},E=async a=>{const o=a.join(i.value.separator);return n.api.retrieve(o)},q=async a=>{const o=a.join(i.value.separator);await n.api.mkdir(o),await m()},_=a=>{switch(a.type){case"form":return{name:"formEditor",params:{id:a.id}};case"hook":return{name:"hookEditor",params:{id:a.id}};case"job":return{name:"jobEditor",params:{id:a.id}};case"script":return{name:"scriptEditor",params:{id:a.id}};default:throw new Error(`Unknown stage type: ${a.type}`)}},x=async a=>{var g;const o=a.join(i.value.separator),l=e.value.find(y=>y.file.pathParts.join(i.value.separator)===o);if(!l)throw new Error(`File not found: ${o}`);if(l.file.type==="directory")c.value=null;else if(l.file.pathParts.length===1&&l.file.pathParts[0]==="requirements.txt")n.router.push({name:"settingsRequirements"});else if(l.file.pathParts.length===1&&l.file.pathParts[0]===".env")n.router.push({name:"env-vars"});else if(!l.stages||l.stages.length===0)c.value=new je(l.file,await E(a),(g=i.value.separator)!=null?g:"/",({content:I})=>v(a,I)),new URL(window.location.href).searchParams.set("f",a.join(i.value.separator)),n.router.replace({query:{...n.router.currentRoute.value.query,f:a}});else if(l.stages.length===1){const y=l.stages[0];n.router.push(_(y))}},P=$(()=>e.value.map(({file:a})=>a)),S=$(()=>{var o;const a=(o=c.value)==null?void 0:o.file.split(".").pop();return a?xe(a):"plaintext"}),R=$(()=>c.value?c.value:null),h=b(null);return ve.get().then(a=>{h.value=a}),Promise.all([m(),C()]).then(()=>{typeof k=="string"&&x(k.split(i.value.separator))}),{files:P,loading:t,editing:c,language:S,settings:i,mkdir:q,fetchFiles:m,uploadFile:f,deleteFile:F,renameFile:A,editFile:v,open:x,sourceCodeEditable:R,workspaceModel:h,filesListResponse:e}},Fe={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"stretch","align-items":"stretch"}},Ae={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ee=te({__name:"Codebase",setup(n){const e=re(),t=r=>r.type==="file"&&r.pathParts[r.pathParts.length-1].endsWith(".py"),c=r=>r.type==="file"&&r.pathParts.length===1&&r.pathParts[0]==="abstra.json",i=r=>r.type==="file"&&N(r.pathParts[r.pathParts.length-1]),m=r=>r.type==="file"&&r.pathParts.length===1&&r.pathParts[0]==="requirements.txt",C=r=>r.type==="file"&&r.pathParts.length===1&&r.pathParts[0]===".env",k=r=>r.type==="file"&&r.pathParts.length===1&&r.pathParts[0]===".gitignore",f=(r,T)=>y.value.some(d=>d.stages.some(U=>U.type===r)&&d.file.pathParts.join("/")===T.pathParts.join("/")),F=r=>f("form",r),A=r=>f("hook",r),v=r=>f("job",r),E=r=>f("script",r),q=new _e,{loading:_,uploadFile:x,deleteFile:P,open:S,files:R,editing:h,renameFile:a,sourceCodeEditable:o,mkdir:l,workspaceModel:g,filesListResponse:y,settings:I}=Ce({api:q,router:e});return(r,T)=>(u(),p(H,{"full-width":!!s(h)},{default:w(()=>[D("div",Fe,[D("div",Ae,[j(s(se),null,{default:w(()=>[ae("Source Code")]),_:1}),s(o)?(u(),p(Q,{key:0,model:s(o),disabled:s(_)},null,8,["model","disabled"])):G("",!0)]),j(W,{"inner-class":"scroll-area","outer-style":{flexGrow:1},"inner-style":{display:"flex",justifyContent:"stretch",gap:"20px"}},{default:w(()=>[j(V,{class:"files-nav",files:s(R),loading:s(_),separator:s(I).separator,onCreate:s(x),onDelete:s(P),onOpen:s(S),onRename:s(a),onMkdir:s(l)},{icon:w(({file:d})=>[j(s(ne),{style:{height:"100%"},justify:"center",align:"center"},{default:w(()=>[d.type==="directory"?(u(),p(s(Y),{key:0})):F(d)?(u(),p(s(le),{key:1})):A(d)?(u(),p(s(ue),{key:2})):v(d)?(u(),p(s(pe),{key:3})):E(d)?(u(),p(s(de),{key:4})):t(d)?(u(),p(s(K),{key:5})):c(d)?(u(),p(O,{key:6,"hide-text":""})):m(d)?(u(),p(s(Z),{key:7})):C(d)?(u(),p(s(X),{key:8})):i(d)?(u(),p(s(oe),{key:9})):k(d)?(u(),p(s(ee),{key:10})):(u(),p(s(J),{key:11}))]),_:2},1024)]),_:1},8,["files","loading","separator","onCreate","onDelete","onOpen","onRename","onMkdir"]),s(h)&&s(h).isImage()?(u(),p(s(ie),{key:0,class:"editing-content",src:s(h).url},null,8,["src"])):s(o)&&s(g)?(u(),p(B,{key:1,script:s(o),class:"editing-content","hide-header":"",workspace:s(g)},null,8,["script","workspace"])):G("",!0)]),_:1})])]),_:1},8,["full-width"]))}});const ot=ce(Ee,[["__scopeId","data-v-8c65d618"]]);export{ot as default};
//# sourceMappingURL=Codebase.90485c2b.js.map

var X=Object.defineProperty;var x=(c,e,t)=>e in c?X(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var E=(c,e,t)=>(x(c,typeof e!="symbol"?e+"":e,t),t);import{d as L,af as B,g as Z,o as r,K as f,O as H,F as k,e4 as ee,a as y,Q as N,c as T,w as u,b as i,u as s,az as P,dc as $,eb as R,aP as F,e3 as J,f as S,h as te,am as U,J as W,aj as ae,a8 as K,N as se,e9 as oe,ea as z,aL as G,aT as ne,aU as re,ec as le,bE as ie,a6 as ue,cu as ce}from"./index.d4d161e1.js";import{B as de}from"./BaseLayout.0d27c73c.js";import{S as pe}from"./SaveButton.c35ea311.js";import{S as me,L as ve,b as ge,c as q}from"./OmniChat.b2e603f8.js";import{N as fe,_ as he}from"./Navbar.74161f89.js";import{S as ye}from"./SourceCode.0ff98935.js";import{T as _e}from"./TasksManager.31584de6.js";import{G as j}from"./PhCaretRight.vue.8f1c1595.js";import{B as be}from"./Badge.38264a07.js";import"./Card.87f819bd.js";import{T as D,A as I}from"./TabPane.5791ca0b.js";import"./linters.8088261b.js";import{H as ke,J as we,S as Te}from"./scripts.7fe75ec8.js";import{n as Se}from"./validations.fc3edc6e.js";import{u as He}from"./editor.57410d58.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[e]="f62c47d5-ea75-4ea8-a701-e05617d775cd",c._sentryDebugIdIdentifier="sentry-dbid-f62c47d5-ea75-4ea8-a701-e05617d775cd")}catch{}})();const Ce=["width","height","fill","transform"],$e={key:0},Le=y("path",{d:"M72.5,150.63,100.79,128,72.5,105.37a12,12,0,1,1,15-18.74l40,32a12,12,0,0,1,0,18.74l-40,32a12,12,0,0,1-15-18.74ZM144,172h32a12,12,0,0,0,0-24H144a12,12,0,0,0,0,24ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},null,-1),Me=[Le],Ve={key:1},Ie=y("path",{d:"M224,56V200a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V56a8,8,0,0,1,8-8H216A8,8,0,0,1,224,56Z",opacity:"0.2"},null,-1),Ze=y("path",{d:"M128,128a8,8,0,0,1-3,6.25l-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32A8,8,0,0,1,128,128Zm48,24H136a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm56-96V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56ZM216,200V56H40V200H216Z"},null,-1),Ae=[Ie,Ze],Ee={key:2},Be=y("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm-91,94.25-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32a8,8,0,0,1,0,12.5ZM176,168H136a8,8,0,0,1,0-16h40a8,8,0,0,1,0,16Z"},null,-1),ze=[Be],Ne={key:3},Oe=y("path",{d:"M126,128a6,6,0,0,1-2.25,4.69l-40,32a6,6,0,0,1-7.5-9.38L110.4,128,76.25,100.69a6,6,0,1,1,7.5-9.38l40,32A6,6,0,0,1,126,128Zm50,26H136a6,6,0,0,0,0,12h40a6,6,0,0,0,0-12Zm54-98V200a14,14,0,0,1-14,14H40a14,14,0,0,1-14-14V56A14,14,0,0,1,40,42H216A14,14,0,0,1,230,56Zm-12,0a2,2,0,0,0-2-2H40a2,2,0,0,0-2,2V200a2,2,0,0,0,2,2H216a2,2,0,0,0,2-2Z"},null,-1),Pe=[Oe],Re={key:4},Ue=y("path",{d:"M128,128a8,8,0,0,1-3,6.25l-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32A8,8,0,0,1,128,128Zm48,24H136a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm56-96V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56ZM216,200V56H40V200H216Z"},null,-1),je=[Ue],De={key:5},Fe=y("path",{d:"M122.5,124.88a4,4,0,0,1,0,6.24l-40,32a4,4,0,0,1-5-6.24L113.6,128,77.5,99.12a4,4,0,0,1,5-6.24ZM176,156H136a4,4,0,0,0,0,8h40a4,4,0,0,0,0-8ZM228,56V200a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V56A12,12,0,0,1,40,44H216A12,12,0,0,1,228,56Zm-8,0a4,4,0,0,0-4-4H40a4,4,0,0,0-4,4V200a4,4,0,0,0,4,4H216a4,4,0,0,0,4-4Z"},null,-1),Je=[Fe],We={name:"PhTerminalWindow"},Ke=L({...We,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(c){const e=c,t=B("weight","regular"),v=B("size","1em"),o=B("color","currentColor"),d=B("mirrored",!1),l=Z(()=>{var p;return(p=e.weight)!=null?p:t}),m=Z(()=>{var p;return(p=e.size)!=null?p:v}),g=Z(()=>{var p;return(p=e.color)!=null?p:o}),w=Z(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:d?"scale(-1, 1)":void 0);return(p,M)=>(r(),f("svg",ee({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:m.value,height:m.value,fill:g.value,transform:w.value},p.$attrs),[H(p.$slots,"default"),l.value==="bold"?(r(),f("g",$e,Me)):l.value==="duotone"?(r(),f("g",Ve,Ae)):l.value==="fill"?(r(),f("g",Ee,ze)):l.value==="light"?(r(),f("g",Ne,Pe)):l.value==="regular"?(r(),f("g",Re,je)):l.value==="thin"?(r(),f("g",De,Je)):k("",!0)],16,Ce))}}),Ge={class:"editor-layout"},qe={class:"layout-left"},Qe={class:"layout-center"},Ye={class:"layout-right"},Xe=L({__name:"EditorLayout",props:{fullWidth:{type:Boolean}},setup(c){return(e,t)=>(r(),f("div",Ge,[y("section",qe,[H(e.$slots,"left",{},void 0,!0)]),y("section",Qe,[H(e.$slots,"center",{},void 0,!0)]),y("section",Ye,[H(e.$slots,"right",{},void 0,!0)])]))}});const xe=N(Xe,[["__scopeId","data-v-10d349a3"]]);class Q{constructor(e,t){E(this,"ws",null);E(this,"selfClosed",!1);E(this,"reconnectInterval");this.onMessage=e,this.stageId=t}get url(){return"/_editor/api/stdio/listen"}handleMessage(e){const t=JSON.parse(e.data);t.stage_id===this.stageId&&this.onMessage(t)}handleClose(e){this.selfClosed||this.reconnectInterval||(this.reconnectInterval=setInterval(()=>this.reset(),2e3))}clearReconnectInterval(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=void 0)}async close(){if(!!this.ws){this.selfClosed=!0;try{this.ws.close()}catch{console.warn("already closed")}this.ws=null}}async reset(){await this.close(),await this.connect()}async connect(){return await new Promise(e=>{this.ws=new WebSocket(this.url),this.ws.onopen=()=>e(),this.ws.onclose=t=>this.handleClose(t),this.ws.onmessage=t=>this.handleMessage(t),this.selfClosed=!1,this.clearReconnectInterval()})}}const et={class:"toggle-button"},tt=L({__name:"TerminalOutputHeader",props:{controller:{},open:{type:Boolean}},emits:["toggle-console"],setup(c,{emit:e}){return(t,v)=>(r(),T(s($),{class:"header",justify:"space-between"},{default:u(()=>[i(s($),{align:"center",gap:"middle"},{default:u(()=>[i(s(Ke),{size:"20"}),P(" Terminal Output ")]),_:1}),i(s(F),{placement:"left","mouse-enter-delay":.5,title:t.open?"Hide Smart Console":"Show Smart Console"},{default:u(()=>{var o,d,l;return[y("div",et,[((o=t.controller)==null?void 0:o.badgeState.type)==="unseen"?(r(),T(s(be),{key:0,count:(d=t.controller)==null?void 0:d.badgeState.count,"number-style":{backgroundColor:((l=t.controller)==null?void 0:l.badgeState.severity)==="error"?"#e03636":"#606060"}},{default:u(()=>[i(s(j),{class:R(["icon",{open:t.open}]),onClick:v[0]||(v[0]=m=>e("toggle-console"))},null,8,["class"])]),_:1},8,["count","number-style"])):(r(),T(s(j),{key:1,class:R(["icon",{open:t.open}]),onClick:v[1]||(v[1]=m=>e("toggle-console"))},null,8,["class"]))])]}),_:1},8,["title"])]),_:1}))}});const at=N(tt,[["__scopeId","data-v-e08ca106"]]),st={key:0,class:"entry ai-output"},ot={key:0,class:"local-entry"},nt=L({__name:"TerminalOutput",props:{workspace:{},stage:{}},setup(c,{expose:e}){const t=c,v=J(),o=S(null),d=S(!1),l=S(200),m=S(!1),g=q.create(),w=new Q(n=>g.log(n),t.stage.id),p=new me(new ve,g,t.stage.id,{origin:"editor"}),M=Z(()=>({height:`${l.value}px`})),C=S(!0);async function V(){var n;if(d.value=!d.value,d.value){if(p.setSeen(),await U(),!o.value)return;o.value.addEventListener("wheel",A),C.value&&(o.value.scrollTop=(n=o.value)==null?void 0:n.scrollHeight)}else{if(!o.value)return;o.value.removeEventListener("wheel",A)}}const A=()=>{if(!o.value)return;const{scrollTop:n,scrollHeight:_,clientHeight:b}=o.value;n+b>=_?C.value=!0:C.value=!1};te(v,()=>g.clear()),e({closeTerminal:()=>d.value=!1,fixJson:async(n,_)=>{d.value=!0,await p.fixJson(n,_)}}),g.listen(async n=>{d.value||p.setUnseen(n),n.type!=="restart"&&(await U(),!!o.value&&C.value&&(o.value.scrollTop=o.value.scrollHeight))});const O=n=>{!m.value||(l.value=document.body.clientHeight-n.clientY)},a=()=>m.value=!1;W(async()=>{document.addEventListener("mousemove",O),document.addEventListener("mouseup",a),await w.connect()}),ae(async()=>{o.value&&o.value.removeEventListener("wheel",A)}),K(async()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",a),await w.close()});const h=n=>["stdout","stderr","restart"].includes(n);return(n,_)=>(r(),T(s($),{vertical:""},{default:u(()=>[i(at,{controller:s(p),open:d.value,onToggleConsole:V},null,8,["controller","open"]),d.value?(r(),T(s($),{key:0,class:"terminal",style:se(M.value),vertical:""},{default:u(()=>[y("div",{class:"resize-handler",onMousedown:_[0]||(_[0]=b=>m.value=!0)},null,32),i(s($),{class:"cli"},{default:u(()=>[i(s($),{class:"left",vertical:""},{default:u(()=>[y("div",{ref_key:"entriesContainer",ref:o,class:"entries"},[s(g).logs.length===0?(r(),f("div",st," The output and errors generated by your code will be printed here. ")):k("",!0),(r(!0),f(G,null,oe(s(g).logs,(b,Y)=>(r(),f("div",{key:Y,class:R([b.type,"entry"])},[h(b.type)?(r(),f("div",ot,z(b.type==="restart"?"-- restarted --":b.log),1)):k("",!0)],2))),128))],512)]),_:1}),i(s($),{class:"right",vertical:"",justify:"space-between",align:"center"},{default:u(()=>[i(s(F),{placement:"left",title:"Start new conversation"},{default:u(()=>[i(s(ge),{size:20,class:"broom-icon",onClick:_[1]||(_[1]=b=>s(p).clearLogService())})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])):k("",!0)]),_:1}))}});const rt=N(nt,[["__scopeId","data-v-f8403533"]]),Ct=L({__name:"Editor",props:{workspace:{},stage:{},stageType:{},testTabName:{},extraTab:{},docsPath:{}},emits:["refetch-tasks","on-save"],setup(c,{expose:e,emit:t}){const v=c,o=J(),d=S(null),l=S(null),m=a=>{v.stage.file=a},g=S("source-code"),w=S("test");function p(){var h;const a=v.stage.codeContent;(h=d.value)==null||h.updateLocalEditorCode(a)}const M=q.create(),C=new Q(a=>M.log(a),o.params.id);W(()=>{C.connect()}),K(()=>{C.close()});const V=a=>a!==g.value&&v.stage.hasChanges();return e({code:d,logService:M,goToTestTab:()=>{w.value="test"},closeTerminal:()=>{var a;(a=l.value)==null||a.closeTerminal()}}),(a,h)=>(r(),T(de,null,{navbar:u(()=>[i(fe,{"page-title":a.stage.title},null,8,["page-title"])]),content:u(()=>[i(xe,null,{left:u(()=>{var n,_;return[i(s(D),{"active-key":g.value,"onUpdate:activeKey":h[0]||(h[0]=b=>g.value=b)},{rightExtra:u(()=>[i(pe,{model:a.stage,onSave:p},null,8,["model"])]),default:u(()=>[i(s(I),{key:"source-code",tab:"Source code",disabled:V("source-code")},null,8,["disabled"]),i(s(I),{key:"settings",tab:"Settings",disabled:V("settings")},null,8,["disabled"]),a.extraTab?(r(),T(s(I),{key:a.extraTab.key,tab:a.extraTab.name,disabled:V(a.extraTab.key)},null,8,["tab","disabled"])):k("",!0)]),_:1},8,["active-key"]),ne(i(ye,{ref_key:"code",ref:d,script:a.stage,workspace:a.workspace,onUpdateFile:m,onSave:h[1]||(h[1]=b=>t("on-save"))},null,8,["script","workspace"]),[[re,g.value==="source-code"]]),a.stage&&g.value==="settings"?H(a.$slots,"settings",{key:0}):k("",!0),a.stage&&g.value===((n=a.extraTab)==null?void 0:n.key)?H(a.$slots,(_=a.extraTab)==null?void 0:_.key,{key:1}):k("",!0)]}),center:u(()=>[i(s(D),{"active-key":w.value,"onUpdate:activeKey":h[2]||(h[2]=n=>w.value=n)},{rightExtra:u(()=>[H(a.$slots,"action-button")]),default:u(()=>{var n;return[i(s(I),{key:"test",tab:(n=a.testTabName)!=null?n:"Test"},null,8,["tab"]),i(s(I),{key:"tasks",tab:"Tasks"})]}),_:3},8,["active-key"]),a.stage&&w.value==="tasks"?(r(),T(_e,{key:0,ref:"tasksManager","stage-id":a.stage.id,onRefetchTasks:h[3]||(h[3]=n=>t("refetch-tasks"))},null,8,["stage-id"])):k("",!0),a.stage&&w.value==="test"?H(a.$slots,"test",{key:1}):k("",!0)]),right:u(()=>[i(he,{"always-open":"","stage-editor-info":{stage:a.stage,workspace:a.workspace,logService:s(M)}},null,8,["stage-editor-info"])]),_:3})]),footer:u(()=>[i(rt,{ref_key:"terminalOutput",ref:l,stage:a.stage,workspace:a.workspace},null,8,["stage","workspace"])]),_:3}))}}),lt=L({__name:"PathInput",props:{runtime:{}},setup(c){const e=c,{cloudProject:t}=He(),v=()=>{const o=Se(e.runtime.path);o&&o!==e.runtime.path&&(e.runtime.path=o)};return(o,d)=>(r(),T(s(ie),{value:o.runtime.path,"onUpdate:value":d[0]||(d[0]=l=>o.runtime.path=l),type:"text",onBlur:v},le({_:2},[o.runtime instanceof s(ke)?{name:"addonBefore",fn:u(()=>{var l,m;return[P(" https://"+z((m=(l=s(t))==null?void 0:l.subdomain)!=null?m:"your-project-domain")+".abstra.app/_hooks/ ",1)]}),key:"0"}:{name:"addonBefore",fn:u(()=>{var l,m;return[P(" https://"+z((m=(l=s(t))==null?void 0:l.subdomain)!=null?m:"your-project-domain")+".abstra.app/ ",1)]}),key:"1"}]),1032,["value"]))}}),it={key:1},ut=L({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(c){const e=ue({pathError:null});return(t,v)=>(r(),f(G,null,[t.runtime instanceof s(we)||t.runtime instanceof s(Te)?k("",!0):(r(),T(s(ce),{key:0,label:"URL path"},{default:u(()=>[i(lt,{runtime:t.runtime},null,8,["runtime"])]),_:1})),e.pathError?(r(),f("div",it,z(e.pathError),1)):k("",!0)],64))}});const $t=N(ut,[["__scopeId","data-v-18856675"]]);export{$t as R,Ct as _};
//# sourceMappingURL=RuntimeCommonSettings.4c157e94.js.map

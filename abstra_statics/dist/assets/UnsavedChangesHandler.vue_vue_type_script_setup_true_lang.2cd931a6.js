var ce=Object.defineProperty;var de=(s,e,t)=>e in s?ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var D=(s,e,t)=>(de(s,typeof e!="symbol"?e+"":e,t),t);import{d as B,v as W,K as Y,H as pe,b as u,c,z as p,W as H,Z as N,x as n,D as E,N as I,e as k,ad as ve,U as j,O as G,Q,q as Z,r as f,J as he,a1 as X,ae as fe,o as ee,Y as te,a as me,I as S,G as T,A as ge,F as _e,L as ye,af as we,t as be,ag as ke,ah as Ce}from"./registerWidgets.7afd6438.js";import{p as Se,n as V,o as O,q as K,r as Ie}from"./icons.0ae396f2.js";import{a as q}from"./asyncComputed.b60ddd9a.js";import{F as $e}from"./forms.5559899c.js";import{D as Ee}from"./dashes.e2e2b65e.js";import{H as Le}from"./hooks.99d7546c.js";import{J}from"./jobs.cd5428dc.js";import{W as xe}from"./workspaces.ddbd5106.js";import{u as A}from"./uuid.261a01ca.js";import{L as Re}from"./login.d80f2927.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="400b95ee-57fa-4a36-920a-eefaa36183d7",s._sentryDebugIdIdentifier="sentry-dbid-400b95ee-57fa-4a36-920a-eefaa36183d7")}catch{}})();const se=s=>(G("data-v-0dfc8705"),s=s(),Q(),s),Me={class:"runtime-settings"},De={key:0,class:"field"},Te=se(()=>n("div",{class:"label"},"Path",-1)),Ue={class:"field"},Ae=se(()=>n("div",{class:"label"},"Code",-1)),Be={class:"input-row"},Fe={key:1,class:"root-path loading"},Pe={class:"path-feedback"},ze={key:1,class:"error"},He=B({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(s){const e=s,t=W({pathError:null}),{result:a}=q(()=>xe.get()),l=()=>{!a.value||!e.runtime.file||a.value.openFile(e.runtime.file)},m=Y(()=>{var r;return(r=e.runtime.file)!=null&&r.endsWith(".py")?null:"It should be a .py file"}),o=()=>{!a.value||!v.value||a.value.openFile(".")},y=pe(),{result:v}=q(()=>fetch("/_editor/api/workspace/root-path").then(r=>r.text()));return e.runtime.onUpdate(r=>{if(e.runtime instanceof J||!r||!("path"in r)||!(r!=null&&r.path))return;const h=[{runtime:$e,basePath:"form"},{runtime:Le,basePath:"hook"},{runtime:Ee,basePath:"dash"}].find(L=>e.runtime instanceof L.runtime);if(!h)throw new Error(`Unknown runtime type ${e.runtime}`);y.push({path:`/_editor/${h.basePath}/${encodeURIComponent(r.path)}`})}),(r,d)=>(u(),c("div",Me,[r.runtime instanceof p(J)?E("",!0):(u(),c("div",De,[Te,H(n("input",{"onUpdate:modelValue":d[0]||(d[0]=h=>r.runtime.path=h),class:"path-input",type:"text"},null,512),[[N,r.runtime.path]])])),n("div",Ue,[Ae,n("div",Be,[p(v)?(u(),c("button",{key:0,class:"root-path",onClick:d[1]||(d[1]=h=>o())},I(p(v)),1)):(u(),c("span",Fe," Loading... ")),H(n("input",{"onUpdate:modelValue":d[2]||(d[2]=h=>r.runtime.file=h),type:"text"},null,512),[[N,r.runtime.file]]),n("button",{class:"open-file-icon",onClick:d[3]||(d[3]=h=>l())},[k(ve,{path:p(Se)},null,8,["path"]),j(" Open in editor ")])]),n("div",Pe,I(m.value),1)]),t.pathError?(u(),c("div",ze,I(t.pathError),1)):E("",!0)]))}});const ht=Z(He,[["__scopeId","data-v-0dfc8705"]]);class ne{constructor(){D(this,"logState",W({log:[]}));D(this,"_listeners",{})}static create(){return new ne}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const a=t?this.logs.find(l=>l.id===t):null;return a?Object.assign(a,e):this.logs.push({...e,id:t||A()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=A();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class Ne{static async*sendMessage(e,t){var m;const l=(m=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:m.getReader();if(!l)throw new Error("No response body");for(;;){const o=await l.read();if(o.done)break;yield new TextDecoder().decode(o.value)}}}const Ve=s=>(G("data-v-cfdedb79"),s=s(),Q(),s),Oe={class:"smart-console"},Ke={class:"header"},qe={class:"left"},Je={class:"right"},We=["unseen-severity"],Ye={class:"cli"},je={class:"left"},Ge=Ve(()=>n("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Qe={key:1,class:"local-entry"},Ze={class:"input"},Xe=["pointer-events","onKeydown"],et={class:"right"},tt=B({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(s,{emit:e}){const t=s,a=f(""),l=f(null),m=he(),o=f({type:"seen"}),y=f(!1),v=f(!1),r=()=>{t.logService.clear(),e("restart")},d=()=>{C.value=C.value==="assistant"?"debugger":"assistant"};function h(i){switch(i.type){case"ai-input":return{role:"user",content:i.log};case"ai-output":return{role:"assistant",content:i.log};case"stderr":case"stdout":return{role:"user",content:i.log};case"restart":return{role:"user",content:"-- new session --"};default:throw new Error(`Unknown log type: ${i.type}`)}}function L(){w.value=!w.value,w.value&&(o.value={type:"seen"})}X(m,()=>{t.logService.clear(),e("clear-terminal")});const $=f(null),C=f("assistant"),oe=async i=>{var _;if(i.preventDefault(),a.value=((_=$.value)==null?void 0:_.innerText)||"",i.shiftKey){document.execCommand("insertLineBreak");return}$.value&&($.value.innerText=""),C.value==="assistant"?await ae():await re()},ae=async()=>{var _;if(e("enter",a.value),t.logService.log({type:"ai-input",log:a.value}),a.value="",!v.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}y.value=!0;const i={role:"user",content:(_=t.formCode)!=null?_:""};try{const b=A();let g="";const R=Ne.sendMessage([i,...t.logService.logs.map(M=>h(M)),{role:"user",content:a.value}],t.runtime);for await(const M of R)g+=M,t.logService.log({type:"ai-output",log:g},b)}catch(b){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(b),ke(b)}finally{y.value=!1}},re=async()=>{a.value&&(t.logService.log({type:"eval-input",log:`>>> ${a.value}`}),e("eval-request",a.value),a.value="")},ie=()=>{t.logService.clear()};t.logService.listen(async i=>{w.value||(o.value={type:"unseen",count:o.value.type==="unseen"?o.value.count+1:1,severity:i.type==="stderr"?"error":"info"}),i.type!=="restart"&&(await fe(),l.value&&(l.value.scrollTop=l.value.scrollHeight))});const w=f(!1),F=f(400),le=Y(()=>({height:`${F.value}px`})),x=f(!1),ue=()=>x.value=!0,P=i=>{!x.value||(F.value=document.body.clientHeight-i.clientY)},z=()=>x.value=!1;return ee(()=>{document.addEventListener("mousemove",P),document.addEventListener("mouseup",z),Re.get().then(i=>v.value=!!i)}),te(()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",z)}),(i,_)=>{const b=me("Markdown");return u(),c("div",Oe,[n("div",Ke,[n("div",qe,[k(S,{path:C.value==="assistant"?p(V):p(O)},null,8,["path"]),j(" Smart Console ")]),n("div",Je,[n("div",{class:"changes-container"},[n("button",{class:"header-button",onClick:r},"Restart")]),n("div",{class:"toggle-button",onClick:L},[k(S,{class:T(["icon",{open:w.value}]),path:p(K),fill:"#fff"},null,8,["class","path"]),o.value.type==="unseen"?(u(),c("div",{key:0,class:"unseen-count","unseen-severity":o.value.severity},I(o.value.count),9,We)):E("",!0)])])]),w.value?(u(),c("div",{key:0,class:"terminal",style:ge(le.value)},[n("div",{class:"resize-handler",onMousedown:ue},null,32),n("div",Ye,[n("div",je,[n("div",{ref_key:"entriesContainer",ref:l,class:"entries"},[Ge,(u(!0),c(_e,null,ye(t.logService.logs,(g,R)=>(u(),c("div",{key:R,class:T([g.type,"entry"])},[g.type==="ai-output"?(u(),be(b,{key:0,source:g.log},null,8,["source"])):(u(),c("div",Qe,I(g.type==="restart"?"-- restarted --":g.log),1))],2))),128))],512),n("div",Ze,[k(S,{class:T(["icon",{open:w.value}]),path:p(K)},null,8,["class","path"]),n("div",{ref_key:"inputRef",ref:$,class:"input-text",contenteditable:"","pointer-events":y.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:we(oe,["enter"])},null,40,Xe)])]),n("div",et,[n("div",{class:"icons",onClick:ie},[k(S,{class:"icon",path:p(Ie)},null,8,["path"])]),n("div",null,[k(S,{class:"icon clickable",path:C.value==="assistant"?p(V):p(O),onClick:_[0]||(_[0]=g=>d())},null,8,["path"])])])])],4)):E("",!0)])}}});const ft=Z(tt,[["__scopeId","data-v-cfdedb79"]]),st={class:"unsaved-changes-handler"},U="You have unsaved changes. Are you sure you want to leave?",mt=B({__name:"UnsavedChangesHandler",props:{hasChanges:{type:Boolean}},setup(s){const e=s,t=o=>(o=o||window.event,o&&(o.returnValue=U),U),a=()=>{window.addEventListener("beforeunload",t)};Ce((o,y,v)=>{if(!e.hasChanges)return v();confirm(U)?v():v(!1)});const l=()=>window.removeEventListener("beforeunload",t),m=o=>o?a():l();return X(()=>e.hasChanges,m),ee(()=>m(e.hasChanges)),te(l),(o,y)=>(u(),c("div",st))}});export{ne as L,ht as R,ft as S,mt as _};
//# sourceMappingURL=UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.2cd931a6.js.map

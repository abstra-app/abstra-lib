import{d as I,r as F,G as N,u as $,b as d,c as h,v as e,F as T,J as B,H as S,V as L,Y as M,B as W,y as t,e as u,T as j,N as z,O as G,q as D,t as V,w as _,K as J,L as O,a as Y,R as q,E as Q}from"./registerWidgets.fff064a1.js";import{a as A,L as X}from"./CircularLoading.59d7fd3d.js";import{E as Z}from"./Error.de2ae46c.js";import{R as ee,F as te}from"./broker.64603716.js";import{R as ae,T as se,B as oe,a as H}from"./BackButton.0686fb5a.js";import{j as re,i as le}from"./icons.907f45d7.js";import{l as ne}from"./WidgetsFrame.cebd6d3d.js";import{F as ie}from"./forms.7bc6baea.js";import{W as ce}from"./workspaces.32af92db.js";import"./dashes.f5f65b41.js";import"./utils.3371dfe5.js";import"./runnerData.81f4c073.js";import"./hooks.039c0cd9.js";import"./jobs.af366134.js";import"./index.314cf40a.js";import"./Modal.2ceba592.js";const ue="forms_workspace_id_path_key",C=f=>(z("data-v-83062094"),f=f(),G(),f),de={class:"form-settings"},pe={class:"content"},me={class:"subsection-label"},he={class:"property-label"},fe=["value","placeholder","onChange"],ve={class:"content"},_e={class:"property"},ye=C(()=>e("div",{class:"property-label"},"Start smart form automatically",-1)),be={class:"property"},ge=C(()=>e("div",{class:"property-label"}," Allow the user to restart the smart form after it is over ",-1)),ke={class:"property column"},we=C(()=>e("div",{class:"property-label"},"Smart Form Path",-1)),xe={key:0,class:"error"},Se={class:"path-input"},Ce=["value","disabled"],Ee=C(()=>e("div",{class:"home-label"},"Home Form",-1)),Fe=["checked"],Pe=I({__name:"FormSettings",props:{form:null},setup(f){const n=f,s=F(n.form),p=[{label:"Welcome Screen",props:[{label:"Title",fallbackKey:"title",valueKey:"welcomeTitle"},{label:"Subtitle",valueKey:"startMessage"},{label:"Start button text",valueKey:"startButtonText"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"endMessage"},{label:"Restart button text",valueKey:"restartButtonText"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"errorMessage"}]}],y=r=>{const o=r.value;if(o===""){j.error("Path must not be empty"),r.value=n.form.path;return}v(o)},b=N(()=>n.form.path===""),i=r=>{v(r?"":n.form.path)},v=async r=>{if(!n.form)return;m.pathError=null,(n.form.path=r)||(m.pathError=k)},m=$({pathError:null,sectionsShown:[!0,!1,!1]}),g=r=>{r.detail.includes(ue)&&(m.pathError=k)},k="This path is already being used by another form or dash on your workspace";return addEventListener("hasura-error",g),(r,o)=>(d(),h("div",de,[e("div",pe,[(d(),h(T,null,B(p,l=>e("div",{key:l.label,class:"subsection"},[e("div",me,S(l.label),1),(d(!0),h(T,null,B(l.props,c=>{var w;return d(),h("div",{key:c.label,class:"property column"},[e("div",he,S(c.label),1),e("input",{class:"property-input",type:"text",value:s.value[c.valueKey],placeholder:(w=c.fallbackKey?s.value[c.fallbackKey]:null)!=null?w:"Enter message",onChange:E=>s.value[c.valueKey]=E.target.value},null,40,fe)])}),128))])),64))]),e("div",ve,[e("div",_e,[L(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.value.autoStart=l),class:"checkbox-input",type:"checkbox"},null,512),[[M,s.value.autoStart]]),ye]),e("div",be,[L(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>s.value.allowRestart=l),class:"checkbox-input",type:"checkbox"},null,512),[[M,s.value.allowRestart]]),ge]),e("div",ke,[we,m.pathError?(d(),h("div",xe,S(m.pathError),1)):W("",!0),e("div",Se,[e("input",{value:s.value.path,class:"property-input",type:"text",disabled:t(b),onChange:o[2]||(o[2]=l=>y(l.target))},null,40,Ce),Ee,e("input",{type:"checkbox",checked:t(b),onChange:o[3]||(o[3]=l=>i(l.target.checked))},null,40,Fe)])])]),u(ae,{runtime:s.value},null,8,["runtime"])]))}});const Ke=D(Pe,[["__scopeId","data-v-83062094"]]),Re={class:"page"},Te={key:1,class:"error"},Be=I({__name:"FormEditor",setup(f){const n=J(),s=O(),p=$({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});addEventListener("keydown",a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),o())});const y=F(null),{loading:b,result:i,error:v,refetch:m}=A(async()=>{const a=await ie.get(s.params.formPath);return c(),a}),{result:g}=A(()=>ce.get()),k=()=>{i.value&&n.push(`/_editor/form/${i.value.path}/preview`)},r=F(!1);async function o(){var a;r.value=!0;try{await((a=i.value)==null?void 0:a.save())}finally{r.value=!1}}const l=N(()=>ee.create({isLocal:!1,formPath:s.params.formPath,isPreview:!0})),c=async()=>{var a;if(p.rightPanelCollapsed=!1,p.hasChanges=!1,!p.started){(a=y.value)==null||a.run();return}ne.log({type:"restart"}),p.started=!1},w=({path:a,type:x})=>{x==="dash"?n.push({name:"dashEditor",params:{dashPath:a},query:s.query}):(n.push({name:"editor",params:{formPath:a},query:s.query}),m())},E=()=>{p.started=!0},U=()=>{p.started=!1};return(a,x)=>{const P=Y("icon");return d(),h("div",Re,[t(b)||!t(i)||!t(g)?(d(),V(X,{key:0})):t(v)?(d(),h("div",Te,[u(Z,{error:t(v),onReload:t(m)},null,8,["error","onReload"])])):(d(),V(se,{key:2},{left:_(()=>[u(oe,{link:"/_editor/forms"})]),right:_(()=>{var K,R;return[e("button",{class:"preview-button",onClick:k},[u(P,{class:"icon",path:t(re),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),q(" Preview ")]),e("button",{class:Q(["save-button",{changes:(K=t(i))==null?void 0:K.hasChanges()}]),onClick:x[0]||(x[0]=Le=>o())},[u(P,{class:"icon",path:t(le),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),q(" "+S(r.value?"Saving ...":(R=t(i))!=null&&R.hasChanges()?"Save":"Saved"),1)],2)]}),default:_(()=>[u(H,{title:"Preview"},{default:_(()=>[u(te,{ref_key:"runner",ref:y,form:t(i).makeRunnerData(t(g)),params:t(s).query,"is-preview":!0,"enable-auto-focus":!1,broker:t(l),style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:w,onLogout:c,onExit:U,onStart:E},null,8,["form","params","broker"])]),_:1}),u(H,{title:"Settings"},{default:_(()=>[u(Ke,{form:t(i)},null,8,["form"])]),_:1})]),_:1}))])}}});const Ye=D(Be,[["__scopeId","data-v-b6f5dd32"]]);export{Ye as default};
//# sourceMappingURL=FormEditor.0f529fb4.js.map

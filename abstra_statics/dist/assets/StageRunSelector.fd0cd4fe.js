import{d as w,H as h,r as S,o as D,G as I,b as m,ev as R,f as u,w as c,u as l,ae as A,ar as v,e as N,ez as x,c as C,ex as V,a$ as k,v as J}from"./outputWidgets.c849273f.js";import{e as O}from"./toggleHighContrast.26f55f0a.js";import{v as $}from"./string.f642a49f.js";import{f as F}from"./index.6ff5e404.js";import{A as B}from"./index.6b141440.js";import{A as T}from"./FormItem.8767aead.js";import{F as z}from"./Form.5ae0aee9.js";import{A as j}from"./Text.4e6778b2.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="bad9b790-2ea3-4ecc-8436-3dde0b22747a",n._sentryDebugIdIdentifier="sentry-dbid-bad9b790-2ea3-4ecc-8436-3dde0b22747a")}catch{}})();class E{async list(e){const a=new URLSearchParams({stage:e});return await(await fetch(`/_editor/api/stage_runs?${a}`)).json()}}const M=new E;class p{constructor(e){this.dto=e}static async list(e){return(await M.list(e)).map(i=>new p(i))}get id(){return this.dto.id}get data(){return this.dto.data}get assignee(){return this.dto.assignee}get stage(){return this.dto.stage}get status(){return this.dto.status}get createdAt(){return new Date(this.dto.createdAt)}}const U=w({__name:"StageRunSelector",props:{stage:{},stageRunId:{}},emits:["update-stage-run-id","update-data"],setup(n,{emit:e}){var f;const a=n,i=h(()=>a.stage.testData?!$(a.stage.testData):!1),g=S(null),b=t=>{const s=r.stageRuns.find(_=>_.id===t),d=JSON.stringify(s==null?void 0:s.data,null,2);e("update-stage-run-id",t),o.setValue(d),o.updateOptions({readOnly:!!t})},y=()=>{e("update-stage-run-id",null),o.setValue("{}"),o.updateOptions({readOnly:!1})};let o;D(async()=>{r.stageRuns=await p.list(a.stage.id),r.options=r.stageRuns.filter(t=>t.status==="waiting").map(t=>({value:t.id,label:`Started ${F(t.createdAt,{addSuffix:!0})}`})),o=O.create(g.value,{language:"json",value:a.stage.testData,fontFamily:"monospace",lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",horizontal:"visible"}}),o.onDidChangeModelContent(()=>{a.stage.testData=o.getValue()})});const r=I({stageRuns:[],options:[],loading:!1,stageRunId:(f=a.stageRunId)!=null?f:void 0});return(t,s)=>(m(),R(k,null,[u(l(z),{layout:"vertical"},{default:c(()=>[u(l(T),{label:"Select a thread or edit the test thread data"},{default:c(()=>[u(l(A),{value:r.stageRunId,"onUpdate:value":s[0]||(s[0]=d=>r.stageRunId=d),placeholder:"No thread selected","filter-option":"",style:{width:"100%"},"allow-clear":!0,options:r.options,disabled:t.$props.stage.isInitial,"not-found-content":"There are no waiting threads",onSelect:s[1]||(s[1]=d=>b(d)),onClear:s[2]||(s[2]=d=>y())},null,8,["value","options","disabled"])]),_:1})]),_:1}),u(l(B),{orientation:"left"},{default:c(()=>[v("Data")]),_:1}),N("div",{ref_key:"dataJson",ref:g,class:x(["data-container",{threaded:!!t.stageRunId,invalid:i.value}])},null,2),i.value?(m(),C(l(j),{key:0,type:"danger"},{default:c(()=>[v("Invalid JSON")]),_:1})):V("",!0)],64))}});const X=J(U,[["__scopeId","data-v-8a6b5d71"]]);export{X as S};
//# sourceMappingURL=StageRunSelector.fd0cd4fe.js.map

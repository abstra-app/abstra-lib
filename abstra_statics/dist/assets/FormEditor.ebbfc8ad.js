import{d as T,r as A,b as c,c as y,w as r,f as t,u as e,bU as _,aA as d,bV as j,eB as O,eA as M,b$ as F,G as S,eD as D,cG as X,F as oe,H as Z,ew as P,eu as H,eC as le,cK as ne,b8 as se,bD as ue,e as ie,eG as de}from"./outputWidgets.1a399dc6.js";import{R as pe,_ as ce,S as me,L as fe}from"./Debugger.vue_vue_type_script_setup_true_lang.189eb425.js";import{A as g,F as ee}from"./Base.80679599.js";import{A as C}from"./Title.02accb2a.js";import{a as te}from"./asyncComputed.c1d6a1a0.js";import{F as ve}from"./forms.dc4af201.js";import{W as ae}from"./workspaces.43030cf4.js";import{_ as ge}from"./SaveButton.vue_vue_type_script_setup_true_lang.6275933e.js";import{l as Y,_ as ye}from"./DocsButton.vue_vue_type_script_setup_true_lang.7b3cef8b.js";import{B as he}from"./BaseLayout.1c409643.js";import{R as _e,F as be,r as re}from"./FormRunner.a7b5d6b0.js";import{A as z}from"./index.81fe960c.js";import{C as we,A as ke}from"./CollapsePanel.6342c531.js";import{a as L}from"./Text.8bc41793.js";import{A as Se}from"./index.b127ba07.js";import{A as xe}from"./index.820a6223.js";import{A as J,T as Pe}from"./TabPane.973a5296.js";import{c as Ae}from"./index.b59f6352.js";import"./hooks.eb45c42a.js";import"./activeRecord.09a0d7a2.js";import"./pubsub.2cf495bb.js";import"./jobs.b34ca5b0.js";import"./icons.fb5e6f1e.js";import"./uuid.c0e2e902.js";import"./transButton.e953e2d0.js";import"./url.03b5d673.js";import"./ant-design.a60cf9b7.js";import"./index.fa829f53.js";import"./CircularLoading.a249ba49.js";import"./PlayerNavbar.ed99f230.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.84b30eb5.js";import"./WidgetsFrame.89ec3179.js";(function(){try{var v=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new Error().stack;m&&(v._sentryDebugIds=v._sentryDebugIds||{},v._sentryDebugIds[m]="5f3a0186-eb4e-4ae6-a067-6087ef0ff6d6",v._sentryDebugIdIdentifier="sentry-dbid-5f3a0186-eb4e-4ae6-a067-6087ef0ff6d6")}catch{}})();const Re=T({__name:"FormSettings",props:{form:{}},setup(v){const a=A(v.form);return(p,o)=>(c(),y(e(ee),{layout:"vertical"},{default:r(()=>[t(pe,{runtime:a.value},null,8,["runtime"]),t(e(g),{label:"Form name"},{default:r(()=>[t(e(_),{type:"text",onChange:o[0]||(o[0]=n=>{var l;return a.value.title=(l=n.target.value)!=null?l:""})})]),_:1}),t(e(C),{level:3},{default:r(()=>[d(" Texts ")]),_:1}),t(e(C),{level:4},{default:r(()=>[d(" Welcome Screen ")]),_:1}),t(e(g),{label:"Title"},{default:r(()=>[t(e(_),{value:a.value.welcomeTitle,"onUpdate:value":o[1]||(o[1]=n=>a.value.welcomeTitle=n),type:"text",placeholder:a.value.title,disabled:a.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),t(e(g),{label:"Description"},{default:r(()=>[t(e(_),{value:a.value.startMessage,"onUpdate:value":o[2]||(o[2]=n=>a.value.startMessage=n),type:"text",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(g),{label:"Start button label"},{default:r(()=>[t(e(_),{value:a.value.startButtonText,"onUpdate:value":o[3]||(o[3]=n=>a.value.startButtonText=n),type:"text",placeholder:"Start",disabled:a.value.autoStart},null,8,["value","disabled"])]),_:1}),t(e(g),null,{default:r(()=>[t(e(j),{checked:a.value.autoStart,"onUpdate:checked":o[4]||(o[4]=n=>a.value.autoStart=n)},{default:r(()=>[d("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),t(e(C),{level:4},{default:r(()=>[d(" End Screen ")]),_:1}),t(e(g),{label:"End text"},{default:r(()=>[t(e(_),{value:a.value.endMessage,"onUpdate:value":o[5]||(o[5]=n=>a.value.endMessage=n),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),t(e(g),{label:"Restart button label"},{default:r(()=>[t(e(_),{value:a.value.restartButtonText,"onUpdate:value":o[6]||(o[6]=n=>a.value.restartButtonText=n),placeholder:"Restart",type:"text",disabled:!a.value.allowRestart},null,8,["value","disabled"])]),_:1}),t(e(g),null,{default:r(()=>[t(e(j),{checked:a.value.allowRestart,"onUpdate:checked":o[7]||(o[7]=n=>a.value.allowRestart=n)},{default:r(()=>[d("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),t(e(C),{level:4},{default:r(()=>[d(" Alert Messages ")]),_:1}),t(e(g),{label:"Error message"},{default:r(()=>[t(e(_),{value:a.value.errorMessage,"onUpdate:value":o[8]||(o[8]=n=>a.value.errorMessage=n),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),Te=T({__name:"PreviewButton",props:{model:{}},setup(v){const m=v,a=O(),p=M(),o=()=>{const n=a.query;p.push({path:`/_editor/${m.model.routeName}/${encodeURIComponent(m.model.path)}/preview`,query:n})};return(n,l)=>(c(),y(e(F),{class:"preview-button",onClick:o},{default:r(()=>[d(" Preview ")]),_:1}))}}),$e=T({__name:"LaunchButton",props:{path:{}},setup(v){const m=v,a=A({state:"loading"}),p=S(()=>a.value.state!=="found"),o=S(()=>a.value.state==="loading"),n=S(()=>a.value.state==="found"?a.value.url:void 0),l=S(()=>{switch(a.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${a.value}`)}}),$=S(()=>{switch(a.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${a.value}`)}});async function k(f){const i=`https://${f}.abstra.app/_version`;return(await fetch(i)).ok}async function R(f){const i=`https://${f}.abstra.app/_pages/${m.path}`;return(await fetch(i)).ok}async function b(){if(!(await Y.get()).logged){a.value={state:"not-logged"};return}const i=await Y.getProjectInfo().catch(()=>null);if(!i){a.value={state:"error"};return}if(!await k(i.subdomain).catch(()=>null)){a.value={state:"not-deployed"};return}if(!await R(i.subdomain).catch(()=>null)){a.value={state:"not-found"};return}const q=`https://${i.subdomain}.abstra.app/${m.path}`;a.value={state:"found",url:q}}return b(),(f,i)=>(c(),y(e(X),{title:l.value},{content:r(()=>[d(D($.value),1)]),default:r(()=>[t(e(F),{href:n.value,target:"_blank",disabled:p.value,loading:o.value},{default:r(()=>[d("Launch last deploy")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Ue=ie("p",{style:{width:"200px"}}," Add query params to simulate someone using your forms with specific data in the URL. ",-1),Ce={key:2,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},B="abstra-run-id",Be=T({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(v,{expose:m,emit:a}){var V,G,K,W;const p=v,o=A(void 0);function n(){o.value=o.value?void 0:"query-params"}const l=oe({queryParams:[],url:`${p.form.path}`,stageRunId:null}),$=s=>{l.stageRunId=s},{result:k,loading:R}=te(()=>ae.get()),b=()=>{l.queryParams.push({name:"",value:""})},f=s=>{l.queryParams=l.queryParams.filter((w,u)=>u!==s)};Z([()=>l.stageRunId,()=>l.queryParams],([s,w])=>{const u=w.find(h=>h.name===B);if(console.log(s,u),s&&!u){l.queryParams.push({name:B,value:s});return}if(!s&&u){l.queryParams=l.queryParams.filter(h=>h.name!==B);return}s&&u&&s!==u.value&&(u.value=s)});const i=S(()=>_e.create({formPath:p.form.path}));(V=i.value)==null||V.on("stdout",s=>{p.logService.log({type:"stdout",log:s.log})}),(G=i.value)==null||G.on("stderr",s=>{p.logService.log({type:"stderr",log:s.log})}),(K=i.value)==null||K.onClose(()=>{p.logService.log({type:"stderr",log:"Program closed"})}),(W=i.value)==null||W.on("files:changed",()=>{p.logService.log({type:"files-changed",log:"Files changed"})});const U=M(),N=({path:s})=>{re("editor",U,s)};function q(s,w){a("redirect",s,w)}const E=A(null);async function Q(){var s;return p.logService.log({type:"restart"}),(s=E.value)==null?void 0:s.run()}const I=S(()=>{const s=new URLSearchParams(l.queryParams.filter(u=>u.name.trim()).reduce((u,h)=>({...u,[h.name]:h.value}),{})).toString();return{subdomain:"[your-subdomain]",path:p.form.path,query:s}});return m({restart:Q}),(s,w)=>(c(),y(e(ee),{layout:"vertical"},{default:r(()=>[P("",!0),t(e(g),{label:"Testing URL"},{default:r(()=>[t(e(z),{gap:0,style:{overflow:"hidden"}},{default:r(()=>[d(" https:// "),t(e(L),{style:{"margin-right":"0"}},{default:r(()=>[d(D(I.value.subdomain),1)]),_:1}),d(" .abstra.app/ "),t(e(L),{style:{"margin-right":"0","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis"}},{default:r(()=>[d(D(I.value.path),1)]),_:1}),t(e(z),null,{default:r(()=>[d(" ? "),t(e(X),{title:"Query params"},{content:r(()=>[Ue]),default:r(()=>[t(e(L),{style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer"},onClick:n},{default:r(()=>[d(D(I.value.query||"[ ... ]"),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(e(g),null,{default:r(()=>[t(e(we),{"active-key":o.value,"onUpdate:activeKey":w[1]||(w[1]=u=>o.value=u),ghost:""},{default:r(()=>[t(e(ke),{key:"query-params",header:`Query Params (${l.queryParams.length})`},{default:r(()=>[(c(!0),H(se,null,le(l.queryParams,(u,h)=>(c(),y(e(g),{key:h},{default:r(()=>[t(e(ne),null,{default:r(()=>[t(e(_),{value:u.name,"onUpdate:value":x=>u.name=x,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(_),{value:u.value,"onUpdate:value":x=>u.value=x,type:"text",placeholder:"value",disabled:u.name===B},null,8,["value","onUpdate:value","disabled"]),t(e(F),{danger:"",onClick:x=>f(h)},{default:r(()=>[d("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(g),null,{default:r(()=>[t(e(F),{type:"dashed",style:{width:"100%"},onClick:b},{default:r(()=>[d("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1},8,["active-key"])]),_:1})]),_:1}),t(e(Se),{orientation:"left"},{default:r(()=>[d("Quick Preview")]),_:1}),e(R)||!e(k)?(c(),y(e(ue),{key:1})):l.stageRunId||p.form.isInitial?(c(),H("div",Ce,[t(be,{ref_key:"runner",ref:E,form:s.form.makeRunnerData(e(k)),params:{...l.queryParams.reduce((u,{name:h,value:x})=>({...u,[h]:x}),{})},"is-preview":"","enable-auto-focus":"",broker:i.value,onNavigate:N,onRedirect:q,onLogout:Q},null,8,["form","params","broker"])])):(c(),y(e(xe),{key:3,message:"This form is an intermediate task within the workflow. Please select a task instance to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}}),pt=T({__name:"FormEditor",setup(v){const m=M(),a=O(),p=A(null),o=A("test");function n(){m.push({name:"forms"})}const{result:l,refetch:$}=te(()=>Promise.all([ae.get(),ve.get(a.params.formPath)]).then(([b,f])=>de({workspace:b,form:f}))),k=fe.create();function R(b,f){re("editor",m,b,f)}return Z(()=>a.params.formPath,()=>{$()}),(b,f)=>(c(),y(he,null,{navbar:r(()=>[e(l)?(c(),y(e(Ae),{key:0,title:e(l).form.title,style:{padding:"5px 10px"},onBack:n},{footer:r(()=>[t(e(Pe),{"active-key":o.value,"onUpdate:activeKey":f[0]||(f[0]=i=>o.value=i)},{default:r(()=>[t(e(J),{key:"test",tab:"Test"}),t(e(J),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:r(()=>[t(ce),t($e,{path:e(l).form.path},null,8,["path"]),t(ye,{path:"forms/overview"}),t(Te,{model:e(l).form},null,8,["model"]),o.value==="settings"?(c(),y(ge,{key:0,model:e(l).form},null,8,["model"])):P("",!0)]),_:1},8,["title"])):P("",!0)]),content:r(()=>[e(l)&&o.value==="test"?(c(),y(Be,{key:0,ref_key:"tester",ref:p,form:e(l).form,"log-service":e(k),onRedirect:R},null,8,["form","log-service"])):P("",!0),e(l)&&o.value==="settings"?(c(),y(Re,{key:1,form:e(l).form},null,8,["form"])):P("",!0)]),footer:r(()=>{var i;return[e(l)&&o.value==="test"?(c(),y(me,{key:0,runtime:"forms","log-service":e(k),onRestart:(i=p.value)==null?void 0:i.restart},null,8,["log-service","onRestart"])):P("",!0)]}),_:1}))}});export{pt as default};
//# sourceMappingURL=FormEditor.ebbfc8ad.js.map

import{f as s,ex as H,d as B,c as L,U as Y,R as G,ac as U,b as n,u as e,aY as N,o as p,cE as O,i as c,aI as j,cD as Q,a as m,df as A,g as y,t as f,eI as W,bT as X,dj as D,eD as Z,dd as K,d6 as ee,eK as te,h as E,S as ae,d0 as ne,cM as se,eA as le,A as oe}from"./jwt-decode.esm.5884e5c3.js";import{_ as ie}from"./AbstraButton.vue_vue_type_script_setup_true_lang.57d0db7e.js";import{I as re}from"./PhCopy.vue.6f9029ba.js";import{T as ue,R as de}from"./tasksController.6c93ddab.js";import{s as ce}from"./metadata.03e5f598.js";import{t as pe}from"./ant-design.e4ba8930.js";import{R as ge}from"./dayjs.2ec56b90.js";import{g as M,a as I}from"./router.5430a706.js";import{A as P}from"./index.faa61ee8.js";import{a as fe,B as me}from"./build.a19c1a10.js";import{a as _e}from"./project.fc4ca599.js";import"./tables.341beecf.js";import{a as ye}from"./asyncComputed.c9fff478.js";import"./contracts.generated.15f07aae.js";import"./record.21dc8063.js";import"./linters.5fce82f6.js";import"./polling.8cee6b57.js";import"./PhWebhooksLogo.vue.dd1dc76b.js";import"./index.a3b45294.js";import"./string.ba444688.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new Error().stack;r&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[r]="f411615c-2a4f-4e68-93b6-ac3d8b7dd94e",u._sentryDebugIdIdentifier="sentry-dbid-f411615c-2a4f-4e68-93b6-ac3d8b7dd94e")}catch{}})();var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const ve=be;function R(u){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},b=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(i).filter(function(v){return Object.getOwnPropertyDescriptor(i,v).enumerable}))),b.forEach(function(v){we(u,v,i[v])})}return u}function we(u,r,i){return r in u?Object.defineProperty(u,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):u[r]=i,u}var $=function(r,i){var b=R({},r,i.attrs);return s(H,R({},b,{icon:ve}),null)};$.displayName="SyncOutlined";$.inheritAttrs=!1;const Se=$,he=B({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean},stageId:{},status:{}},setup(u,{expose:r}){const i=u,{setup:b,tearDown:v,state:d,getColumns:S,fetchTasks:x,clearAllTasks:w,updateStatus:h}=ue({api:i.api,poll:!0,stages:i.stages,stageId:i.stageId,status:i.status}),T=t=>{var a,g;if(!((a=t.completed)!=null&&a.at)||!((g=t.created)!=null&&g.at))return null;const l=new Date(t.created.at).getTime(),o=new Date(t.completed.at).getTime();return Math.round((o-l)/1e3)},k=t=>{var a;if(!((a=t.created)!=null&&a.at))return null;const l=new Date(t.created.at).getTime(),o=Date.now();return Math.round((o-l)/1e3)},C=t=>{if(t<60)return`${t}s`;const l=Math.floor(t/60);if(l<60){const _=t%60;return _>0?`${l}m ${_}s`:`${l}m`}const o=Math.floor(l/60);if(o<24){const _=l%60;return _>0?`${o}h ${_}m`:`${o}h`}const a=Math.floor(o/24),g=o%24;return g>0?`${a}d ${g}h`:`${a}d`},F=L(()=>i.stages?d.tasks.map(t=>{var o,a,g;const l=(o=i.stages)==null?void 0:o.find(_=>_.id===t.targetStageId);return l?{...t,targetStageTitle:l.stageTitle,targetStageType:l.stageType,completedAt:(g=t.completed)!=null&&g.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1,duration:T(t),pendingDuration:k(t)}:{...t,targetStageTitle:null,targetStageType:null,completedAt:(a=t.completed)!=null&&a.at?new Date(t.completed.at).toLocaleString():c.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),deleted:!0,duration:T(t),pendingDuration:k(t)}}):d.tasks.map(t=>{var l;return{...t,deleted:!1,completedAt:(l=t.completed)!=null&&l.at?new Date(t.completed.at).toLocaleString():c.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),duration:T(t),pendingDuration:k(t)}})),V=(t,l,o)=>{var _,z;const a=(_=t.current)!=null?_:1,g=(z=t.pageSize)!=null?z:10;d.pagination.currentIndex=a-1,d.pagination.pageSize=g,x()},q=(t,l)=>`/_editor/${t}/${l}`,J=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),se.success({content:c.translate("i18n_tasksview_copied_to_clipboard")})};return r({clearAllTasks:w}),Y(()=>b()),G(()=>v()),(t,l)=>(p(),U(N,null,[s(e(Q),{layout:"vertical"},{default:n(()=>[s(e(M),{gutter:10},{default:n(()=>[s(e(I),{span:6},{default:n(()=>[s(e(O),{label:e(c).translate("i18n_tasksview_status_label")},{default:n(()=>[s(e(j),{value:e(d).filters.status,"onUpdate:value":l[0]||(l[0]=o=>e(d).filters.status=o),options:e(d).filterOptions.statuses,"option-label":"label","option-value":"value","show-search":"",filter:!1,placeholder:e(c).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(e(I),{span:10},{default:n(()=>[s(e(O),{label:e(c).translate("i18n_tasksview_stage_label")},{default:n(()=>[s(e(j),{value:e(d).filters.stage,"onUpdate:value":l[1]||(l[1]=o=>e(d).filters.stage=o),"show-search":"",options:e(d).filterOptions.stages,placeholder:e(c).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(e(I),{span:8},{default:n(()=>[s(e(O),{label:e(c).translate("i18n_tasksview_created_at_date_label")},{default:n(()=>[s(e(ge),{value:e(d).filters.dateRange,"onUpdate:value":l[2]||(l[2]=o=>e(d).filters.dateRange=o),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),s(e(ne),{columns:e(S)(),"data-source":F.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(d).pagination.currentIndex+1,pageSize:e(d).pagination.pageSize,total:e(d).pagination.totalCount},onChange:V},{bodyCell:n(({column:o,record:a})=>[o.key==="timeInfo"?(p(),m(e(D),{key:0,vertical:"",gap:4},{default:n(()=>[s(e(A),null,{default:n(()=>[y(f(a.createdAt),1)]),_:2},1024),a.status==="locked"?(p(),m(e(P),{key:0,type:"info"},{message:n(()=>[y(f(e(c).translate("i18n_tasksview_status_running")),1)]),default:n(()=>[s(e(Se),{spin:!0,style:{"margin-left":"4px"}})]),_:1})):(p(),m(e(P),{key:1,type:a.status==="pending"?"warning":"success"},W({action:n(()=>[s(e(X),{size:"small",checked:a.status==="completed","onUpdate:checked":g=>e(h)(a,a.status==="pending"?"completed":"pending")},null,8,["checked","onUpdate:checked"])]),_:2},[a.status==="pending"?{name:"message",fn:n(()=>[y(f(e(c).translate("i18n_tasksview_pending_for"))+" "+f(C(a.pendingDuration)),1)]),key:"0"}:a.status==="completed"?{name:"message",fn:n(()=>[y(f(e(c).translate("i18n_tasksview_completed_in"))+" "+f(C(a.duration)),1)]),key:"1"}:void 0]),1032,["type"]))]),_:2},1024)):o.key==="stageInfo"?(p(),m(e(D),{key:1,vertical:"",gap:4},{default:n(()=>[a.deleted?(p(),m(e(A),{key:0},{default:n(()=>[y(f(e(c).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),m(e(D),{key:1,gap:8,align:"center"},{default:n(()=>[(p(),m(Z(e(ce)(a.targetStageType)),{size:20})),s(e(D),{vertical:"",gap:0},{default:n(()=>[u.editor?(p(),m(e(K),{key:0,href:q(a.targetStageType,a.targetStageId)},{default:n(()=>[y(f(a.targetStageTitle),1)]),_:2},1032,["href"])):(p(),m(e(A),{key:1},{default:n(()=>[y(f(a.targetStageTitle),1)]),_:2},1024)),s(e(A),{type:"secondary",style:{fontSize:"12px"}},{default:n(()=>[y(f(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024)):o.key==="payloadInfo"?(p(),m(e(D),{key:2,gap:8,align:"start",justify:"space-between"},{default:n(()=>[s(e(ee),{"tree-data":e(pe)(a.payload),selectable:!1,style:{flex:"1"}},null,8,["tree-data"]),s(ie,{type:"text",size:"small",tooltip:e(c).translate("i18n_tasksview_copy_payload_tooltip"),onClick:te(g=>J(a.payload),["stop"])},{default:n(()=>[s(e(re))]),_:1},8,["tooltip","onClick"])]),_:2},1024)):E("",!0)]),footer:n(()=>[s(e(M),{justify:"end",gutter:10},{default:n(()=>[s(e(I),null,{default:n(()=>[s(e(ae),{size:"small"})]),_:1}),s(e(I),null,{default:n(()=>[s(e(A),null,{default:n(()=>[y(f(e(c).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Ve=B({__name:"Tasks",setup(u){const r=le(),i=r.params.projectId,b=r.query.stage,v=r.query.status,d=new de(i),{result:S}=ye(async()=>{const h=(await fe.list(i)).find(C=>C.latest);if(!h)return null;const[T,k]=await Promise.all([me.get(h.id),_e.get(i)]);return{buildSpec:T,project:k}}),x=L(()=>!S.value||!S.value.buildSpec?null:S.value.buildSpec.runtimes.map(w=>({id:w.id,stageTitle:w.title,stageType:w.type})));return(w,h)=>(p(),U(N,null,[s(e(oe),null,{default:n(()=>[y(f(e(c).translate("i18n_tasksview_title")),1)]),_:1}),x.value?(p(),m(he,{key:0,class:"tasks",api:e(d),stages:x.value,"stage-id":e(b),status:e(v)},null,8,["api","stages","stage-id","status"])):E("",!0)],64))}});export{Ve as default};
//# sourceMappingURL=Tasks.a5c9be40.js.map

import{T as B}from"./tasksController.59a3734d.js";import{s as F}from"./metadata.c758068d.js";import{t as R}from"./ant-design.ad3f7270.js";import{c as E}from"./string.4c6457d7.js";import{R as U}from"./dayjs.4287266f.js";import{b as l,ee as V,d as $,f as M,X as Y,ah as G,o as c,Y as b,w as n,u as e,aS as T,cz as _,aB as O,cy as J,c as f,d2 as X,aG as m,dc as v,ec as q,da as H,e9 as w,dh as D,d5 as Q,S as C,by as W,cY as Z}from"./index.3d66ab3f.js";import{a as I,A as y}from"./index.103fa591.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new Error().stack;r&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[r]="3cdb8f5f-e3a3-4f17-96d2-b22f32074790",s._sentryDebugIdIdentifier="sentry-dbid-3cdb8f5f-e3a3-4f17-96d2-b22f32074790")}catch{}})();var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const ee=K;function x(s){for(var r=1;r<arguments.length;r++){var d=arguments[r]!=null?Object(arguments[r]):{},p=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(d).filter(function(a){return Object.getOwnPropertyDescriptor(d,a).enumerable}))),p.forEach(function(a){te(s,a,d[a])})}return s}function te(s,r,d){return r in s?Object.defineProperty(s,r,{value:d,enumerable:!0,configurable:!0,writable:!0}):s[r]=d,s}var A=function(r,d){var p=x({},r,d.attrs);return l(V,x({},p,{icon:ee}),null)};A.displayName="SyncOutlined";A.inheritAttrs=!1;const ae=A,ne={key:3,style:{"min-width":"100px"}},ce=$({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean}},setup(s){const r=s,{setup:d,tearDown:p,state:a,getColumns:k,fetchTasks:z}=B({api:r.api,poll:!0,stages:r.stages}),L=t=>t.dataIndex===void 0&&"children"in t&&Array.isArray(t.children)&&t.children.length===0,N=M(()=>r.stages?a.tasks.map(t=>{var i,g,u;const o=(i=r.stages)==null?void 0:i.find(S=>S.id===t.targetStageId);return o?{...t,targetStageTitle:o.stageTitle,targetStageType:o.stageType,completedAt:(u=t.completed)!=null&&u.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1}:{...t,targetStageTitle:null,targetStageType:null,completedAt:(g=t.completed)!=null&&g.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!0}}):a.tasks.map(t=>{var o;return{...t,deleted:!1,completedAt:(o=t.completed)!=null&&o.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString()}})),j=(t,o,i)=>{var S,h;const g=(S=t.current)!=null?S:1,u=(h=t.pageSize)!=null?h:10;a.pagination.currentIndex=g-1,a.pagination.pageSize=u,z()},P=(t,o)=>t==="agent"||t==="client"?"/_editor/workflow":`/_editor/${t}/${o}`;return Y(()=>d()),G(()=>p()),(t,o)=>(c(),b(T,null,[l(e(J),{layout:"vertical"},{default:n(()=>[l(e(I),{gutter:10},{default:n(()=>[l(e(y),{span:10},{default:n(()=>[l(e(_),{label:"Stage"},{default:n(()=>[l(e(O),{value:e(a).filters.stage,"onUpdate:value":o[0]||(o[0]=i=>e(a).filters.stage=i),options:e(a).filterOptions.stages,placeholder:"All","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),l(e(y),{span:6},{default:n(()=>[l(e(_),{label:"Status"},{default:n(()=>[l(e(O),{value:e(a).filters.status,"onUpdate:value":o[1]||(o[1]=i=>e(a).filters.status=i),options:e(a).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:"All","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),l(e(y),{span:8},{default:n(()=>[l(e(_),{label:"Created at date"},{default:n(()=>[l(e(U),{value:e(a).filters.dateRange,"onUpdate:value":o[2]||(o[2]=i=>e(a).filters.dateRange=i),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),l(e(Z),{columns:e(k)(),"data-source":N.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(a).pagination.currentIndex+1,pageSize:e(a).pagination.pageSize,total:e(a).pagination.totalCount},onChange:j},{bodyCell:n(({column:i,text:g,record:u})=>[i.key==="payload"?(c(),f(e(X),{key:0,"tree-data":e(R)(u.payload),selectable:!1},null,8,["tree-data"])):i.key==="targetStageTitle"?(c(),b(T,{key:1},[u.deleted?(c(),f(e(v),{key:0},{default:n(()=>[m("Not found")]),_:1})):(c(),f(e(D),{key:1,gap:"small",justify:"center"},{default:n(()=>[(c(),f(q(e(F)(u.targetStageType)),{size:"20"})),t.editor?(c(),f(e(H),{key:0,href:P(u.targetStageType,u.targetStageId)},{default:n(()=>[m(w(u.targetStageTitle),1)]),_:2},1032,["href"])):(c(),f(e(v),{key:1},{default:n(()=>[m(w(u.targetStageTitle),1)]),_:2},1024))]),_:2},1024))],64)):i.dataIndex==="status"?(c(),f(e(D),{key:2,gap:"small",justify:"center"},{default:n(()=>[l(e(Q),null,{default:n(()=>[m(w(e(E)(String(g)))+" ",1),g==="started"?(c(),f(e(ae),{key:0,spin:!0,style:{"margin-left":"4px"}})):C("",!0)]),_:2},1024)]),_:2},1024)):L(i)?(c(),b("div",ne)):C("",!0)]),footer:n(()=>[l(e(I),{justify:"end",gutter:10},{default:n(()=>[l(e(y),null,{default:n(()=>[l(e(W),{size:"small"})]),_:1}),l(e(y),null,{default:n(()=>[l(e(v),null,{default:n(()=>[m(" auto updating ")]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}});export{ce as _};
//# sourceMappingURL=TasksView.vue_vue_type_script_setup_true_lang.bb66d1b2.js.map

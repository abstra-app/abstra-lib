var R=Object.defineProperty;var V=(r,e,t)=>e in r?R(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var I=(r,e,t)=>(V(r,typeof e!="symbol"?e+"":e,t),t);import{d as x,F as U,b as f,c as w,w as s,f as l,u as o,bO as h,aq as g,cC as $,bH as E,ad as j,eB as q,r as G,G as L,ev as O,ex as H,bq as T}from"./outputWidgets.c7d3adb6.js";import{o as z,l as J}from"./icons.04bb36b4.js";import{a as K}from"./asyncComputed.503b98af.js";import"./authorManager.e16729e9.js";import{C as b}from"./gateway.bdb6eee5.js";import"./index.25051644.js";import{A as v}from"./FormItem.424fcca7.js";import{F as S}from"./Form.d2f4c6bd.js";import{A as B}from"./index.60fbfe14.js";import{C as Q}from"./CrudView.a5c5f789.js";import{p as A}from"./popupNotifcation.7f01a27d.js";import"./index.cf4c23b9.js";import"./record.75c383f2.js";import"./pubsub.83cf89e6.js";import"./hasIn.2d7f1a4b.js";import"./isNumeric.75337b1e.js";import"./Title.07360565.js";import"./Text.b8f940d0.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.a0e6335c.js";import"./router.7306eaee.js";import"./index.935dd85c.js";import"./url.125f4924.js";import"./index.7fe1152d.js";import"./index.402d7e13.js";import"./index.4508a88d.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="5c7a4eb9-ddf5-4480-b482-7d0a2b815802",r._sentryDebugIdIdentifier="sentry-dbid-5c7a4eb9-ddf5-4480-b482-7d0a2b815802")}catch{}})();const W=["admin","user"],N=W.map(r=>({label:r,value:r}));class X{constructor(){I(this,"urlPath","users")}async create(e,t){return b.post(`projects/${e}/${this.urlPath}`,t)}async delete(e,t){await b.delete(`projects/${e}/${this.urlPath}/${t}`)}async list(e,t,a){const n=new URLSearchParams({limit:t.toString(),offset:a.toString()});return b.get(`projects/${e}/${this.urlPath}?${n.toString()}`)}async update(e,t,a){return b.patch(`projects/${e}/${this.urlPath}/${t}`,a)}}const _=new X;class y{constructor(e){this.dto=e}static async list(e,t,a){return(await _.list(e,t,a)).map(p=>new y(p))}static async create(e,t){const a=await _.create(e,t);return new y(a)}async delete(){await _.delete(this.projectId,this.id)}async change(e){this.roles=e.roles,await _.update(this.projectId,this.id,e)}get id(){return this.dto.id}get email(){return this.dto.email}get projectId(){return this.dto.projectId}get roles(){return this.dto.roles}set roles(e){this.dto.roles=e}}const Y=x({__name:"NewUser",emits:["created","cancel"],setup(r,{emit:e}){const t=U({email:"",roles:[]});function a(){e("cancel")}function n(){!t.email||e("created",t)}return(p,d)=>(f(),w(o(B),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:a},{extra:s(()=>[l(o($),null,{default:s(()=>[l(o(h),{onClick:a},{default:s(()=>[g("Cancel")]),_:1}),l(o(h),{type:"primary",onClick:n},{default:s(()=>[g("Submit")]),_:1})]),_:1})]),default:s(()=>[l(o(S),{model:t,layout:"vertical"},{default:s(()=>[l(o(v),{key:"email",label:"Email",required:!0},{default:s(()=>[l(o(E),{value:t.email,"onUpdate:value":d[0]||(d[0]=u=>t.email=u)},null,8,["value"])]),_:1}),l(o(v),{key:"role",label:"Role"},{default:s(()=>[l(o(j),{value:t.roles,"onUpdate:value":d[1]||(d[1]=u=>t.roles=u),mode:"multiple",options:o(N)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Z=x({__name:"UpdateUser",props:{roles:{},email:{}},emits:["updated","cancel"],setup(r,{emit:e}){const t=r,a=U({roles:t.roles});function n(){e("cancel")}function p(){e("updated",a)}return(d,u)=>(f(),w(o(B),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:n},{extra:s(()=>[l(o($),null,{default:s(()=>[l(o(h),{onClick:n},{default:s(()=>[g("Cancel")]),_:1}),l(o(h),{type:"primary",onClick:p},{default:s(()=>[g("Submit")]),_:1})]),_:1})]),default:s(()=>[l(o(S),{model:a,layout:"vertical"},{default:s(()=>[l(o(v),{key:"email",label:"Email"},{default:s(()=>[l(o(E),{value:t.email,disabled:""},null,8,["value"])]),_:1}),l(o(v),{key:"role",label:"Role"},{default:s(()=>[l(o(j),{value:a.roles,"onUpdate:value":u[0]||(u[0]=C=>a.roles=C),mode:"multiple",options:o(N)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Ie=x({__name:"Users",setup(r){const t=q().params.projectId,a=G({type:"none"}),n=()=>{a.value.type="none"},p=()=>{a.value.type="new"},d=i=>{a.value={type:"edit",user:i}},u=async i=>{try{await y.create(t,i),n(),k()}catch(c){c instanceof Error&&A("Create Error",c.message)}},C=async i=>{try{if(a.value.type!=="edit")return;a.value.user.roles=i.roles,await a.value.user.change(i),n(),k()}catch(c){c instanceof Error&&A("Update Error",c.message)}},{loading:P,result:D,refetch:k}=K(()=>y.list(t,100,0)),F=L(()=>{var i,c;return{columns:[{name:"Email"},{name:"Roles"},{name:"Actions",align:"right"}],rows:(c=(i=D.value)==null?void 0:i.map(m=>({key:m.email,cells:[{text:m.email},{text:m.roles.join(", ")},{text:"",actions:[{icon:z,label:"Edit",onClick:()=>d(m)},{icon:J,label:"Delete",onClick:async()=>{await m.delete(),k()}}]}]})))!=null?c:[]}});return(i,c)=>(f(),O(T,null,[l(Q,{"entity-name":"users",loading:o(P),title:"Application users",description:"List all application users.","empty-title":"No users yet",table:F.value,"create-button-text":"Add users",onCreate:p},null,8,["loading","table"]),a.value.type==="new"?(f(),w(Y,{key:0,onCancel:n,onCreated:u})):a.value.type==="edit"?(f(),w(Z,{key:1,email:a.value.user.email,roles:a.value.user.roles,onUpdated:C,onCancel:n},null,8,["email","roles"])):H("",!0)],64))}});export{Ie as default};
//# sourceMappingURL=Users.b063911c.js.map

var U=Object.defineProperty;var R=(s,e,n)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>(R(s,typeof e!="symbol"?e+"":e,n),n);import{C as P}from"./ConnectorCard.baf8fbfc.js";import{_ as T}from"./AbstraButton.vue_vue_type_script_setup_true_lang.307ae3ed.js";import{f as V,cE as b,d as M,o as l,c as u,w as a,b as i,u as t,d5 as D,az as c,eb as E,c_ as O,bK as B,bs as x,bq as v,F as m,da as p,eP as G,eQ as q,a as j,Q as F,e4 as K,K as w,aL as _,d6 as y,d4 as L,ea as $,cs as Q,bE as z,eh as Y}from"./index.e5dd373b.js";import{C as A}from"./gateway.388f33c3.js";import{C as H}from"./router.43af1d83.js";import{G as J}from"./PhDotsThreeVertical.vue.2a005089.js";import{A as W}from"./Avatar.96bdc451.js";import{C as X}from"./Card.6b3b92e1.js";import{A as Z}from"./index.7869885d.js";import"./popupNotifcation.abf8e04e.js";import"./TabPane.11354d45.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="66b6787f-aba1-452e-a6d1-a5a0d1a9edd4",s._sentryDebugIdIdentifier="sentry-dbid-66b6787f-aba1-452e-a6d1-a5a0d1a9edd4")}catch{}})();class ee{async listAgents(){return A.get("agents")}async listAgentConnections(e){return A.get(`projects/${e}/agents/connections`)}async createAgentConnection({projectId:e,agentId:n}){return A.post(`projects/${e}/agents/connections`,{agentId:n})}async renameAgentConnection({projectId:e,agentConnectionId:n,newAgentConnectionName:o}){return A.patch(`projects/${e}/agents/connections/${n}`,{newAgentConnectionName:o})}async deleteAgentConnection({projectId:e,agentConnectionId:n}){return A.delete(`projects/${e}/agents/connections/${n}`)}}const te="/src/assets/logo.svg";class S{constructor(e){this.data=e}get id(){return this.data.id}get name(){return this.data.name}get description(){return this.data.description}get setupPath(){return this.data.setupPath}get logoURL(){return this.data.logoURL||te}get unavailable(){return!this.data.isAvailable}}class ne{constructor(e){this.data=e}get id(){return this.data.id}get connectionName(){return this.data.connectionName}get agentId(){return this.data.agentId}get clientProjectId(){return this.data.clientProjectId}get connectionStatus(){return this.data.connectionStatus}}class oe{constructor(e){C(this,"agentConnection");C(this,"agent");C(this,"redirectURL");this.data=e,this.agentConnection=new ne(e.agentConnection),this.agent=new S(e.agent),this.redirectURL=e.redirectURL}}class ae{constructor(e,n){C(this,"state");this.api=e,this.projectId=n,this.state=V({agents:[],agentConnectionDetailsList:[],selectedAgentForConnection:null,editingAgentConnection:{selectedAgentConnection:null,newName:"",errorMessage:null}})}get agents(){return this.state.value.agents}get agentConnectionDetailsList(){return this.state.value.agentConnectionDetailsList}get selectedAgentForConnection(){return this.state.value.selectedAgentForConnection}get selectedAgentConnectionForEditing(){return this.state.value.editingAgentConnection.selectedAgentConnection}get editingNewName(){return this.state.value.editingAgentConnection.newName}set editingNewName(e){this.state.value.editingAgentConnection.newName=e}get editingErrorMessage(){return this.state.value.editingAgentConnection.errorMessage}hasChanges(){return!!this.state.value.editingAgentConnection.selectedAgentConnection&&this.state.value.editingAgentConnection.newName!==this.state.value.editingAgentConnection.selectedAgentConnection.connectionName}async fetchInitialState(){await Promise.all([this.fetchAgents(),this.fetchAgentConnections()])}async fetchAgents(){const e=await this.api.listAgents();this.state.value.agents=e.map(n=>new S(n))}async fetchAgentConnections(){const e=await this.api.listAgentConnections(this.projectId);this.state.value.agentConnectionDetailsList=e.map(n=>new oe(n))}cancelAgentConnectionCreation(){this.state.value.selectedAgentForConnection=null}cancelAgentConnectionEditing(){this.state.value.editingAgentConnection.selectedAgentConnection=null,this.state.value.editingAgentConnection.newName="",this.removeEditingErrorMessage()}async createAgentConnection(){if(!this.state.value.selectedAgentForConnection)return;const n=(await this.api.createAgentConnection({projectId:this.projectId,agentId:this.state.value.selectedAgentForConnection.id})).redirectUrl;n?window.location.href=n:(await this.fetchAgentConnections(),this.cancelAgentConnectionCreation())}handleEditAgentConnectionClick(e){this.state.value.editingAgentConnection.newName=e.connectionName,this.state.value.editingAgentConnection.selectedAgentConnection=e}async renameAgentConnection(){try{await this.api.renameAgentConnection({projectId:this.projectId,agentConnectionId:this.state.value.editingAgentConnection.selectedAgentConnection.id,newAgentConnectionName:this.state.value.editingAgentConnection.newName}),this.cancelAgentConnectionEditing(),await this.fetchAgentConnections()}catch{this.state.value.editingAgentConnection.errorMessage="There's already a connection to the same agent with this name"}}removeEditingErrorMessage(){this.state.value.editingAgentConnection.errorMessage=null}async deleteAgentConnection(e){await this.api.deleteAgentConnection({projectId:this.projectId,agentConnectionId:e}),await this.fetchAgentConnections()}handleDeleteAgentConnectionClick(e){b.confirm({title:`Are you sure you want to delete ${e.connectionName}?`,onOk:()=>this.deleteAgentConnection(e.id)})}showNewAgentConnectionModal(e){this.state.value.selectedAgentForConnection=e}handleSetupAgentConnectionClick(e){!e.redirectURL||(window.location.href=e.redirectURL)}}const ie=s=>(G("data-v-4372bea0"),s=s(),q(),s),se=ie(()=>j("div",{style:{"flex-grow":"1"}},null,-1)),re=M({__name:"AgentConnectionCard",props:{agentConnectionDetails:{},controller:{}},setup(s){function e(n){switch(n){case"connected":return"success";case"pending":return"warning";default:return"default"}}return(n,o)=>(l(),u(t(X),null,{default:a(()=>[i(t(p),{align:"center",gap:16},{default:a(()=>[i(t(W),{src:n.agentConnectionDetails.agent.logoURL,height:"40px",shape:"square"},null,8,["src"]),i(t(D),{strong:""},{default:a(()=>[c(E(n.agentConnectionDetails.agent.name),1)]),_:1}),se,i(t(D),{content:n.agentConnectionDetails.agentConnection.connectionName,code:""},null,8,["content"]),i(t(O),{class:"status-tag",color:e(n.agentConnectionDetails.agentConnection.connectionStatus)},{default:a(()=>[c(E(n.agentConnectionDetails.agentConnection.connectionStatus),1)]),_:1},8,["color"]),i(t(B),null,{overlay:a(()=>[i(t(x),null,{default:a(()=>[n.agentConnectionDetails.redirectURL?(l(),u(t(v),{key:0,onClick:o[0]||(o[0]=h=>n.controller.handleSetupAgentConnectionClick(n.agentConnectionDetails))},{default:a(()=>[c(" Setup ")]),_:1})):m("",!0),i(t(v),{onClick:o[1]||(o[1]=h=>n.controller.handleEditAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:a(()=>[c(" Rename ")]),_:1}),i(t(v),{danger:"",onClick:o[2]||(o[2]=h=>n.controller.handleDeleteAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:a(()=>[c(" Disconnect ")]),_:1})]),_:1})]),default:a(()=>[i(t(J))]),_:1})]),_:1})]),_:1}))}});const ce=F(re,[["__scopeId","data-v-4372bea0"]]),le={class:"agents-grid"},de=M({__name:"AgentsView",setup(s){const n=K().params.projectId,o=new ae(new ee,n);o.fetchInitialState();function h(f){f.unavailable?H.showNewMessage(Y.translate("i18n_agents_ask_for_access",null,f.name)):o.showNewAgentConnectionModal(f)}return(f,r)=>{var I,N;return l(),w(_,null,[i(t(Z),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:a(()=>{var d,k;return[i(t(y),null,{default:a(()=>[c("Agents")]),_:1}),i(t(L),null,{default:a(()=>[c("Add and manage external integrations to your project.")]),_:1}),(d=t(o).agentConnectionDetailsList)!=null&&d.length?(l(),u(t(p),{key:0,vertical:""},{default:a(()=>[i(t(y),{level:2},{default:a(()=>[c("Connected")]),_:1}),i(t(p),{vertical:"",gap:10},{default:a(()=>[(l(!0),w(_,null,$(t(o).agentConnectionDetailsList,g=>(l(),u(ce,{key:g.agentConnection.id,"agent-connection-details":g,controller:t(o)},null,8,["agent-connection-details","controller"]))),128))]),_:1})]),_:1})):m("",!0),(k=t(o).agents)!=null&&k.length?(l(),u(t(p),{key:1,vertical:""},{default:a(()=>[i(t(y),{level:2},{default:a(()=>[c("All")]),_:1}),j("div",le,[(l(!0),w(_,null,$(t(o).agents,g=>(l(),u(P,{key:g.id,title:g.name,"logo-url":g.logoURL,description:g.description,unavailable:g.unavailable,onClick:ge=>h(g)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})):m("",!0)]}),_:1}),i(t(b),{open:!!t(o).selectedAgentForConnection,title:(I=t(o).selectedAgentForConnection)==null?void 0:I.name,"ok-text":"Connect",onCancel:r[0]||(r[0]=d=>t(o).cancelAgentConnectionCreation()),onOk:r[1]||(r[1]=d=>t(o).createAgentConnection())},{default:a(()=>[i(t(L),null,{default:a(()=>[c("You will be redirected to the Agent's setup page.")]),_:1})]),_:1},8,["open","title"]),i(t(b),{open:!!t(o).selectedAgentConnectionForEditing,title:`${(N=t(o).selectedAgentConnectionForEditing)==null?void 0:N.connectionName} Connection`,onCancel:r[5]||(r[5]=d=>t(o).cancelAgentConnectionEditing())},{footer:a(()=>[i(t(p),{justify:"end"},{default:a(()=>[i(T,{type:"primary",disabled:!t(o).hasChanges(),onClick:r[4]||(r[4]=d=>t(o).renameAgentConnection())},{default:a(()=>[c(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[i(t(Q),{"has-feedback":"","validate-status":t(o).editingErrorMessage?"error":"",help:t(o).editingErrorMessage},{default:a(()=>[t(o).selectedAgentConnectionForEditing?(l(),u(t(z),{key:0,value:t(o).editingNewName,"onUpdate:value":r[2]||(r[2]=d=>t(o).editingNewName=d),onChange:r[3]||(r[3]=d=>t(o).removeEditingErrorMessage())},null,8,["value"])):m("",!0)]),_:1},8,["validate-status","help"])]),_:1},8,["open","title"])],64)}}});const Ie=F(de,[["__scopeId","data-v-f3283209"]]);export{Ie as default};
//# sourceMappingURL=AgentsView.edaefc87.js.map

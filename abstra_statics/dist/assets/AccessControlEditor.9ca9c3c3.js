var te=Object.defineProperty;var se=(l,e,s)=>e in l?te(l,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[e]=s;var z=(l,e,s)=>(se(l,typeof e!="symbol"?e+"":e,s),s);import{C as ae}from"./ContentLayout.ea0e6e53.js";import{l as oe}from"./fetch.59899a55.js";import{E as re}from"./record.c2b8598b.js";import{d as _,a0 as S,D as b,b as m,ey as v,dq as le,eA as V,eD as ne,e as C,f as a,eK as ie,c as y,w as o,u as t,bI as x,au as g,eH as T,cF as ue,eJ as j,aG as M,ah as N,eI as ce,aK as pe,am as K,al as L,r as O,cG as U,cD as Z,N as de,bB as me,dn as G}from"./outputWidgets.e2ed3ff5.js";import{E as fe,a as ge,b as ye}from"./repository.bccf7315.js";import{a as R}from"./asyncComputed.fa173b5a.js";import{S as he}from"./SaveButton.80a0fc44.js";import{I as ve}from"./PhGlobe.vue.82548c12.js";import"./envVars.03ed69f5.js";import{l as q}from"./editor.74ef0801.js";import{P as be,A as I,T as _e}from"./TabPane.5bdf986a.js";import{A as we}from"./index.baa0cc96.js";import{i as Ce}from"./metadata.1a86161f.js";import{a as Ae}from"./Base.1e6a845e.js";import{A}from"./index.91914483.js";import{A as Pe}from"./Text.30cd4048.js";import{A as Ve}from"./index.d93a0c04.js";import{A as He}from"./index.e57f2a09.js";import{A as D}from"./Paragraph.96f9081a.js";import"./router.a09506b3.js";/* empty css                                                                 */import{A as Y,F as ke}from"./Form.ba5a97c1.js";import{A as Oe}from"./index.981d8ca6.js";import{A as Se}from"./Title.451e374d.js";import"./pubsub.c137a732.js";import"./UnsavedChangesHandler.f5a7ffa3.js";import"./ExclamationCircleOutlined.9b8a76c4.js";import"./Modal.53b83c19.js";import"./Link.20516420.js";import"./runnerData.832879c7.js";import"./url.f4a27c06.js";import"./index.bb482f76.js";import"./hasIn.ee0df185.js";import"./PhCheckCircle.vue.93eccbe4.js";import"./PhKanban.vue.2e5547c7.js";import"./PhScroll.vue.33d9bb0a.js";import"./PhWebhooksLogo.vue.458845cb.js";import"./popupNotifcation.d3f5b3fe.js";import"./isNumeric.75337b1e.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[e]="d6ff737b-2c84-4b18-97c4-1f290d392838",l._sentryDebugIdIdentifier="sentry-dbid-d6ff737b-2c84-4b18-97c4-1f290d392838")}catch{}})();const Re=["width","height","fill","transform"],Ue={key:0},xe=C("path",{d:"M208,76H180V56A52,52,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76ZM100,56a28,28,0,0,1,56,0V76H100ZM204,204H52V100H204Z"},null,-1),Me=[xe],Ze={key:1},qe=C("path",{d:"M216,96V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V96a8,8,0,0,1,8-8H208A8,8,0,0,1,216,96Z",opacity:"0.2"},null,-1),Ie=C("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"},null,-1),De=[qe,Ie],Te={key:2},je=C("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},null,-1),Ne=[je],Be={key:3},Ee=C("path",{d:"M208,82H174V56a46,46,0,0,0-92,0V82H48A14,14,0,0,0,34,96V208a14,14,0,0,0,14,14H208a14,14,0,0,0,14-14V96A14,14,0,0,0,208,82ZM94,56a34,34,0,0,1,68,0V82H94ZM210,208a2,2,0,0,1-2,2H48a2,2,0,0,1-2-2V96a2,2,0,0,1,2-2H208a2,2,0,0,1,2,2Z"},null,-1),$e=[Ee],Fe={key:4},ze=C("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"},null,-1),Le=[ze],Ge={key:5},Ye=C("path",{d:"M208,84H172V56a44,44,0,0,0-88,0V84H48A12,12,0,0,0,36,96V208a12,12,0,0,0,12,12H208a12,12,0,0,0,12-12V96A12,12,0,0,0,208,84ZM92,56a36,36,0,0,1,72,0V84H92ZM212,208a4,4,0,0,1-4,4H48a4,4,0,0,1-4-4V96a4,4,0,0,1,4-4H208a4,4,0,0,1,4,4Z"},null,-1),Je=[Ye],Ke={name:"PhLockSimple"},We=_({...Ke,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const e=l,s=S("weight","regular"),c=S("size","1em"),n=S("color","currentColor"),f=S("mirrored",!1),i=b(()=>{var d;return(d=e.weight)!=null?d:s}),p=b(()=>{var d;return(d=e.size)!=null?d:c}),u=b(()=>{var d;return(d=e.color)!=null?d:n}),r=b(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(d,h)=>(m(),v("svg",ne({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:p.value,height:p.value,fill:u.value,transform:r.value},d.$attrs),[le(d.$slots,"default"),i.value==="bold"?(m(),v("g",Ue,Me)):i.value==="duotone"?(m(),v("g",Ze,De)):i.value==="fill"?(m(),v("g",Te,Ne)):i.value==="light"?(m(),v("g",Be,$e)):i.value==="regular"?(m(),v("g",Fe,Le)):i.value==="thin"?(m(),v("g",Ge,Je)):V("",!0)],16,Re))}});function J(l){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),c.forEach(function(n){Qe(l,n,s[n])})}return l}function Qe(l,e,s){return e in l?Object.defineProperty(l,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):l[e]=s,l}var B=function(e,s){var c=J({},e,s.attrs);return a(ie,J({},c,{icon:be}),null)};B.displayName="PlusOutlined";B.inheritAttrs=!1;const Xe=B;class E{constructor(e){z(this,"record");this.record=re.from(e)}get id(){return this.record.get("id")}get type(){return this.record.get("type")}get title(){return this.record.get("title")}get isPublic(){return this.record.get("is_public")}set isPublic(e){e&&this.record.set("required_roles",[]),this.record.set("is_public",e)}get requiredRoles(){return this.record.get("required_roles")}set requiredRoles(e){e.length!==0&&this.record.set("is_public",!1),this.record.set("required_roles",e)}makePublic(){this.isPublic=!0}makeProtected(){this.isPublic=!1,this.requiredRoles=[]}require(e){e.length!==0&&(this.isPublic=!1),this.requiredRoles=e}get visibility(){return this.isPublic?"public":"private"}hasChanges(){return this.record.hasChanges("is_public")||this.record.hasChangesDeep("required_roles")}get changes(){return this.record.changes}get initialState(){return this.record.initialState}toUpdateDTO(){return{id:this.id,is_public:this.isPublic,required_roles:this.requiredRoles}}commit(){this.record.commit()}static from(e){return new E(e)}}class et{constructor(e=oe){this.fetch=e}async list(){return(await(await this.fetch("/_editor/api/access-control",{method:"GET",headers:{"Content-Type":"application/json"}})).json()).map(E.from)}async update(e){const s=e.reduce((n,f)=>(f.hasChanges()&&n.push({id:f.id,...f.changes}),n),[]);return await(await fetch("/_editor/api/access-control",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}}const tt=_({__name:"RoleSelector",props:{value:{},roleOptions:{},disabled:{type:Boolean}},emits:["update:value"],setup(l,{emit:e}){const s=l,c=()=>{var u,r;if(!((u=q.asyncComputed.result.value)!=null&&u.logged))return;const p=(r=q.asyncComputed.result.value)==null?void 0:r.info.projectId;window.open(`https://cloud.abstra.io/projects/${p}/access-control?selected-panel=roles`,"__roles")},n=p=>{e("update:value",p)},f=b(()=>s.disabled?"":"All users listed in the cloud"),i=_({props:{vnodes:{type:Object,required:!0}},render(){return this.vnodes}});return(p,u)=>(m(),y(t(N),{value:p.value,mode:"multiple",placeholder:f.value,disabled:p.disabled,"onUpdate:value":n},{dropdownRender:o(({menuNode:r})=>{var d;return[a(t(i),{vnodes:r},null,8,["vnodes"]),a(t(we),{style:{margin:"4px 0"}}),(d=t(q).asyncComputed.result.value)!=null&&d.logged?(m(),y(t(x),{key:0,type:"default",style:{width:"100%"},onClick:c},{icon:o(()=>[a(t(Xe))]),default:o(()=>[g(" Create a new role ")]),_:1})):V("",!0)]}),default:o(()=>[(m(!0),v(M,null,T(p.roleOptions,r=>(m(),y(t(ue),{key:r,value:r},{default:o(()=>[g(j(r),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","disabled"]))}}),st=_({__name:"AccessControlItem",props:{accessControl:{},roles:{}},emits:["update:access-control"],setup(l,{emit:e}){const s=l,c=b(()=>s.roles.map(i=>i.name)),n=i=>{i?s.accessControl.makePublic():s.accessControl.makeProtected(),e("update:access-control",s.accessControl)},f=i=>{s.accessControl.require(i),i.length!==0&&(s.accessControl.isPublic=!1),e("update:access-control",s.accessControl)};return(i,p)=>(m(),y(t(A),{justify:"space-between",align:"center",gap:"small"},{default:o(()=>[(m(),y(ce(t(Ce)(i.accessControl.type)),{style:{"flex-shrink":"0",width:"22px",height:"18px"}})),a(t(Ae),{style:{width:"300px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}},{default:o(()=>[a(t(pe),{title:i.accessControl.title,placement:"left",open:i.accessControl.title.length>36?void 0:!1},{default:o(()=>[g(j(i.accessControl.title),1)]),_:1},8,["title","open"])]),_:1}),a(t(A),{gap:"large",align:"center"},{default:o(()=>[a(tt,{disabled:i.accessControl.visibility==="public",style:{width:"320px"},value:i.accessControl.requiredRoles||[],"role-options":c.value||[],"onUpdate:value":p[0]||(p[0]=u=>f(u))},null,8,["disabled","value","role-options"]),a(t(K),{value:i.accessControl.visibility},{default:o(()=>[a(t(L),{value:"public",onChange:p[1]||(p[1]=u=>n(!0))},{default:o(()=>[a(t(A),{align:"center",gap:"small"},{default:o(()=>[g(" Public "),a(t(ve),{size:14})]),_:1})]),_:1}),a(t(L),{value:"private",onChange:p[2]||(p[2]=u=>n(!1))},{default:o(()=>[a(t(A),{align:"center",gap:"small"},{default:o(()=>[g(" Private "),a(t(We),{size:14})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}))}}),at=_({__name:"DanglingRolesAlert",props:{danglingRoles:{}},setup(l){return(e,s)=>(m(),y(t(He),{type:"warning","show-icon":"",closable:""},{description:o(()=>[a(t(Pe),null,{default:o(()=>[g("The following roles are not defined in the Cloud Console:")]),_:1}),(m(!0),v(M,null,T(e.danglingRoles,c=>(m(),y(t(Ve),{key:c,style:{margin:"2px"},color:"red"},{default:o(()=>[g(j(c),1)]),_:2},1024))),128))]),_:1}))}}),ot=_({__name:"View",props:{accessControls:{},roles:{},loading:{type:Boolean}},emits:["update:access-controls","save"],setup(l,{emit:e}){const s=l,c=r=>{const d=s.accessControls.findIndex(h=>h.id===r.id);d!==-1&&(s.accessControls[d]=r,e("update:access-controls",[...s.accessControls]))},n=b(()=>{var r;return((r=s.accessControls)==null?void 0:r.filter(d=>d.hasChanges()))||[]}),f=b(()=>n.value.length>0),p={save:async()=>{e("save")},hasChanges:()=>f.value},u=b(()=>{const r=s.accessControls.flatMap(h=>h.requiredRoles)||[],d=s.roles.map(h=>h.name)||[];return(r==null?void 0:r.filter(h=>!d.includes(h)))||[]});return(r,d)=>(m(),v(M,null,[a(t(A),{justify:"flex-end"},{default:o(()=>[a(he,{model:p})]),_:1}),!r.loading&&u.value.length>0?(m(),y(at,{key:0,"dangling-roles":u.value},null,8,["dangling-roles"])):V("",!0),a(t(A),{vertical:"",gap:"small",style:{"margin-top":"10px"}},{default:o(()=>[(m(!0),v(M,null,T(r.accessControls,h=>(m(),y(t(A),{key:h.id},{default:o(()=>[a(st,{"access-control":h,roles:r.roles,"onUpdate:accessControl":c},null,8,["access-control","roles"])]),_:2},1024))),128))]),_:1})],64))}}),rt={style:{padding:"30px"}},lt=_({__name:"View",props:{signupPolicy:{}},emits:["update:signup-policy","save"],setup(l,{emit:e}){const s=l,c=O(s.signupPolicy.strategy),n=O(s.signupPolicy.strategy==="patternOnly"?s.signupPolicy.emailPatterns:[]),f=O(s.signupPolicy.strategy==="patternOnly"?s.signupPolicy.emailPatterns.map(u=>({label:u})):[]),i=u=>{const r=u;if(n.value=r,r.length===0){p("inviteOnly");return}f.value=r.map(d=>({label:d})),s.signupPolicy.emailPatterns=u,e("update:signup-policy",s.signupPolicy)},p=u=>{c.value=u,u!=="patternOnly"&&(u==="inviteOnly"&&s.signupPolicy.allowOnlyInvited(),e("update:signup-policy",s.signupPolicy))};return(u,r)=>(m(),y(t(U),{direction:"vertical",style:{"padding-top":"8px"}},{default:o(()=>[a(t(D),null,{default:o(()=>[g(" Control which end users may sign-up to your app. ")]),_:1}),a(t(x),{disabled:!u.signupPolicy.hasChanges,type:"primary",onClick:r[0]||(r[0]=d=>e("save"))},{default:o(()=>[g(" Save changes ")]),_:1},8,["disabled"]),C("div",rt,[a(t(D),{strong:""},{default:o(()=>[g(" Allow self sign-up? ")]),_:1}),a(t(K),{value:c.value,"onUpdate:value":p},{default:o(()=>[a(t(U),{direction:"vertical"},{default:o(()=>[a(t(Z),{value:"inviteOnly"},{default:o(()=>[g("No, users must be added by me.")]),_:1}),a(t(U),null,{default:o(()=>[a(t(Z),{value:"patternOnly"},{default:o(()=>[g("Yes, but only for users in")]),_:1}),a(t(N),{mode:"tags",value:n.value,style:{"min-width":"250px"},placeholder:"@domain.com or sub.domain.com",disabled:c.value!=="patternOnly",options:f.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":i},null,8,["value","disabled","options"])]),_:1}),a(t(Z),{value:"anyone"},{default:o(()=>[g("Yes, for anyone")]),_:1})]),_:1})]),_:1},8,["value"])])]),_:1}))}}),nt=_({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(l,{emit:e}){const c=l.roleOptions.map(p=>({label:p.name,value:p.name})),n=de({email:"",roles:[]});function f(){e("cancel")}function i(){!n.email||e("created",n)}return(p,u)=>(m(),y(t(Oe),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:f},{extra:o(()=>[a(t(U),null,{default:o(()=>[a(t(x),{onClick:f},{default:o(()=>[g("Cancel")]),_:1}),a(t(x),{type:"primary",onClick:i},{default:o(()=>[g("Submit")]),_:1})]),_:1})]),default:o(()=>[a(t(ke),{model:n,layout:"vertical"},{default:o(()=>[a(t(Y),{key:"email",label:"Email",required:!0},{default:o(()=>[a(t(me),{value:n.email,"onUpdate:value":u[0]||(u[0]=r=>n.email=r)},null,8,["value"])]),_:1}),a(t(Y),{key:"role",label:"Role"},{default:o(()=>[a(t(N),{value:n.roles,"onUpdate:value":u[1]||(u[1]=r=>n.roles=r),mode:"multiple",options:t(c)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Yt=_({__name:"AccessControlEditor",setup(l){const e=()=>{s.value={type:"initial"}},s=O({type:"initial"}),c=O("enforcement"),n=new et,{result:f,refetch:i}=R(async()=>await n.list()),p=b(()=>{var H;return((H=f.value)==null?void 0:H.filter(w=>w.hasChanges()))||[]}),u=async()=>{await n.update(p.value),await i()},r=new fe,{refetch:d}=R(()=>r.list()),h=async H=>{await r.create(H),await d(),e()},$=new ge,{result:P,refetch:W}=R(()=>$.get()),Q=async()=>{!P.value||(await $.update(P.value),await W())},X=new ye,{result:F,loading:ee}=R(()=>X.list(100,0));return(H,w)=>(m(),y(ae,null,{default:o(()=>[a(t(Se),null,{default:o(()=>[g("Access Control")]),_:1}),a(t(D),null,{default:o(()=>[g(" Configure the security level of your application. You can define which pages are accessible to signed-in users, which pages are accessible to users with specific roles, and which pages are accessible to everyone. ")]),_:1}),a(t(_e),{"active-key":c.value,"onUpdate:activeKey":w[0]||(w[0]=k=>c.value=k)},{default:o(()=>[a(t(I),{key:"enforcement",tab:"Security Level"}),a(t(I),{key:"signup-policy",tab:"Sign-Up Policy"}),a(t(I),{key:"users",tab:"Test Users"})]),_:1},8,["active-key"]),c.value==="enforcement"&&t(f)?(m(),y(ot,{key:0,"access-controls":t(f),"onUpdate:accessControls":w[1]||(w[1]=k=>G(f)?f.value=k:null),roles:t(F)||[],loading:t(ee),onSave:u},null,8,["access-controls","roles","loading"])):V("",!0),c.value==="signup-policy"&&t(P)?(m(),y(lt,{key:1,"signup-policy":t(P),"onUpdate:signupPolicy":w[2]||(w[2]=k=>G(P)?P.value=k:null),onSave:Q},null,8,["signup-policy"])):V("",!0),s.value.type==="user-create"?(m(),y(t(nt),{key:2,"role-options":t(F)||[],onCreated:h,onCancel:e},null,8,["role-options"])):V("",!0)]),_:1}))}});export{Yt as default};
//# sourceMappingURL=AccessControlEditor.9ca9c3c3.js.map

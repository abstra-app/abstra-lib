import{_ as z}from"./AbstraButton.vue_vue_type_script_setup_true_lang.63e284e5.js";import{a as K}from"./asyncComputed.96287c0e.js";import{F as V}from"./PhKey.vue.ca27958a.js";import{G as j}from"./PhPencil.vue.37d30c5b.js";import{_ as A,a as F}from"./vue-flow-minimap.e38af8ee.js";import{u as B,f as G,j as v,c as h,d as w}from"./index.3a8315ec.js";import{d as H,e5 as M,c as $,r as P,m as Q,W as k,f as s,u as a,a as f,b as r,ed as U,aQ as x,o as i,S as W,d7 as m,g as _,ec as g,eb as q,db as C,h as J,_ as O}from"./jwt-decode.esm.f0e7c156.js";import"./gateway.d13f2aab.js";import{T as I}from"./tables.138888b9.js";import{_ as X}from"./TablesTabs.vue_vue_type_script_setup_true_lang.37d83dbd.js";import{A as Y}from"./index.3762587c.js";import{C as Z}from"./Card.7ced52f7.js";import"./popupNotifcation.299c313a.js";import"./record.c58778b3.js";import"./string.d14b3078.js";import"./TabPane.9278d8ed.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new Error().stack;p&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[p]="3cdd47dd-da4f-431b-826e-dd82eade8fbd",l._sentryDebugIdIdentifier="sentry-dbid-3cdd47dd-da4f-431b-826e-dd82eade8fbd")}catch{}})();const ee=H({__name:"TablesDiagram",setup(l){const p=(t,n)=>{const o=new w.graphlib.Graph;return o.setGraph({rankdir:"LR",align:"UL",ranker:"longest-path"}),o.setDefaultEdgeLabel(()=>({})),t.forEach(e=>{o.setNode(e.id,{width:500,height:200+e.data.getColumns().length*20})}),n.forEach(e=>{o.setEdge(e.source,e.target)}),w.layout(o),t.map(e=>({...e,position:{x:o.node(e.id).x,y:o.node(e.id).y}}))},u=M().params.projectId,{result:c,loading:y}=K(async()=>{const t=await I.list(u);return Promise.all(t.map(n=>I.get(u,n.id)))}),b=$(()=>{var t,n;return(n=(t=c.value)==null?void 0:t.flatMap(o=>o.getColumns().filter(e=>e.foreignKey).map(e=>({id:`${o.id}:${e.id}:${e.foreignKey.columnId}`,source:o.id,target:c.value.find(d=>d.getColumn(e.foreignKey.columnId)).id,targetHandle:`target-${e.foreignKey.columnId}`,sourceHandle:`source-${e.id}`}))))!=null?n:[]}),L=$(()=>y.value?[]:p(c.value.map(t=>({id:t.id,type:"table",data:t,position:{x:0,y:0}})),b.value)),{onInit:T,onNodeDragStop:E,onConnect:N,addEdges:R}=B(),S=P(!1);return T(t=>{t.fitView()}),E(({event:t,nodes:n,node:o})=>{console.log("Node Drag Stop",{event:t,nodes:n,node:o})}),N(t=>{R(t)}),(t,n)=>{const o=Q("RouterLink");return i(),k(x,null,[s(X),a(y)?(i(),f(a(W),{key:0,style:{width:"100%"}})):(i(),f(a(G),{key:1,nodes:L.value,edges:b.value,class:U([{dark:S.value},"basic-flow"]),"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.2,"max-zoom":4,"pan-on-scroll":""},{"node-table":r(e=>[s(a(Z),{style:{padding:"0"}},{title:r(()=>[s(a(m),{level:5},{default:r(()=>[_(g(e.data.name),1)]),_:2},1024)]),extra:r(()=>[s(o,{to:`/projects/${a(u)}/tables/${e.data.id}`},{default:r(()=>[s(a(Y),{size:"large"}),s(z,null,{default:r(()=>[s(a(j))]),_:1})]),_:2},1032,["to"])]),default:r(()=>[(i(!0),k(x,null,q(e.data.getColumns(),d=>(i(),f(a(C),{key:d.id,vertical:""},{default:r(()=>[s(a(C),{align:"center",gap:"small",style:{position:"relative"}},{default:r(()=>[s(a(v),{id:`target-${d.id}`,type:"target",position:a(h).Left,connectable:!1},null,8,["id","position"]),s(a(m),null,{default:r(()=>[_(g(d.name),1)]),_:2},1024),s(a(m),{type:"secondary"},{default:r(()=>[_(g(d.type),1)]),_:2},1024),d.primaryKey?(i(),f(a(V),{key:0})):J("",!0),s(a(v),{id:`source-${d.id}`,type:"source",position:a(h).Right,connectable:!1},null,8,["id","position"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),default:r(()=>[s(a(A),{"pattern-color":"#aaa",gap:16}),s(a(F),{pannable:""})]),_:1},8,["nodes","edges","class"]))],64)}}});const ye=O(ee,[["__scopeId","data-v-f0dbbd69"]]);export{ye as default};
//# sourceMappingURL=TablesDiagram.18a691b7.js.map

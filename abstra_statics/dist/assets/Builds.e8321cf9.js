import{C as F}from"./CrudView.a7272ae3.js";import{d as I,at as Z,c as x,o as u,ac as h,ae as K,h as C,ew as H,e as A,f as o,ex as j,fu as q,ec as U,a as f,b as s,u as e,bW as W,bE as Q,bD as Y,df as k,g as _,t as y,i as g,cC as J,U as X,R as ee,r as te,aY as ne,eA as ae,b0 as le,cS as re,de as ie,ad as se,d9 as oe,S as ue,M as ce,eC as de,_ as pe}from"./jwt-decode.esm.fbcfeaec.js";import{a as V}from"./asyncComputed.5a2bb5ad.js";import{g as fe}from"./datetime.282d916c.js";import{u as me}from"./polling.1c41f31c.js";import{G as ge}from"./PhArrowCounterClockwise.vue.7bb8643e.js";import{H as be}from"./PhCube.vue.53d4e96d.js";import{G as _e}from"./PhDownloadSimple.vue.5a5d3464.js";import{f as ye,e as ve,r as he}from"./router.ed823a0a.js";import{a as Ce,B as ke}from"./build.d7280696.js";import{a as Ae}from"./project.ea5e8538.js";import"./tables.76beaff5.js";import{G as Oe}from"./PhClockCounterClockwise.vue.03399d4f.js";import{F as we,a as Se,G as xe,I as Pe}from"./PhWebhooksLogo.vue.b4180f20.js";import{b as M}from"./index.561c6514.js";import{E as Ze}from"./ExclamationCircleOutlined.a1b3bc81.js";import{C as Me}from"./CloseCircleOutlined.43b9bbfe.js";import{L as $}from"./LoadingOutlined.8738663a.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.28a130ec.js";import"./constants.b8ded506.js";import"./url.90414523.js";import"./PhDotsThreeVertical.vue.1f08b241.js";import"./index.d9ce41fc.js";import"./record.63a637c8.js";import"./string.b10c2096.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[t]="b03bdc67-26e7-417e-83f8-95a3c6b1c8e7",a._sentryDebugIdIdentifier="sentry-dbid-b03bdc67-26e7-417e-83f8-95a3c6b1c8e7")}catch{}})();var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const Ie=$e;var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};const ze=je,Be=["width","height","fill","transform"],De={key:0},Ee=A("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-16-84a16,16,0,1,1-16-16A16,16,0,0,1,112,128Zm64,0a16,16,0,1,1-16-16A16,16,0,0,1,176,128Z"},null,-1),Ve=[Ee],Ne={key:1},Te=A("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),Ge=A("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm56-88a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Le=[Te,Ge],Re={key:2},Fe=A("path",{d:"M128,24A104,104,0,1,0,232,128,104.13,104.13,0,0,0,128,24ZM84,140a12,12,0,1,1,12-12A12,12,0,0,1,84,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,172,140Z"},null,-1),Ke=[Fe],He={key:3},qe=A("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm10-90a10,10,0,1,1-10-10A10,10,0,0,1,138,128Zm-44,0a10,10,0,1,1-10-10A10,10,0,0,1,94,128Zm88,0a10,10,0,1,1-10-10A10,10,0,0,1,182,128Z"},null,-1),Ue=[qe],We={key:4},Qe=A("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm12-88a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-88,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Ye=[Qe],Je={key:5},Xe=A("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm8-92a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-44,0a8,8,0,1,1-8-8A8,8,0,0,1,92,128Zm88,0a8,8,0,1,1-8-8A8,8,0,0,1,180,128Z"},null,-1),et=[Xe],tt={name:"PhDotsThreeCircle"},nt=I({...tt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(a){const t=a,l=Z("weight","regular"),d=Z("size","1em"),c=Z("color","currentColor"),P=Z("mirrored",!1),p=x(()=>{var m;return(m=t.weight)!=null?m:l}),w=x(()=>{var m;return(m=t.size)!=null?m:d}),v=x(()=>{var m;return(m=t.color)!=null?m:c}),O=x(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:P?"scale(-1, 1)":void 0);return(m,E)=>(u(),h("svg",H({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:v.value,transform:O.value},m.$attrs),[K(m.$slots,"default"),p.value==="bold"?(u(),h("g",De,Ve)):p.value==="duotone"?(u(),h("g",Ne,Le)):p.value==="fill"?(u(),h("g",Re,Ke)):p.value==="light"?(u(),h("g",He,Ue)):p.value==="regular"?(u(),h("g",We,Ye)):p.value==="thin"?(u(),h("g",Je,et)):C("",!0)],16,Be))}});function N(a){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(c){return Object.getOwnPropertyDescriptor(l,c).enumerable}))),d.forEach(function(c){at(a,c,l[c])})}return a}function at(a,t,l){return t in a?Object.defineProperty(a,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[t]=l,a}var z=function(t,l){var d=N({},t,l.attrs);return o(j,N({},d,{icon:q}),null)};z.displayName="CheckCircleOutlined";z.inheritAttrs=!1;const lt=z;function T(a){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(c){return Object.getOwnPropertyDescriptor(l,c).enumerable}))),d.forEach(function(c){rt(a,c,l[c])})}return a}function rt(a,t,l){return t in a?Object.defineProperty(a,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[t]=l,a}var B=function(t,l){var d=T({},t,l.attrs);return o(j,T({},d,{icon:Ie}),null)};B.displayName="MinusCircleOutlined";B.inheritAttrs=!1;const it=B;function G(a){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?Object(arguments[t]):{},d=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(l).filter(function(c){return Object.getOwnPropertyDescriptor(l,c).enumerable}))),d.forEach(function(c){st(a,c,l[c])})}return a}function st(a,t,l){return t in a?Object.defineProperty(a,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[t]=l,a}var D=function(t,l){var d=G({},t,l.attrs);return o(j,G({},d,{icon:ze}),null)};D.displayName="PauseCircleOutlined";D.inheritAttrs=!1;const ot=D,ut={style:{display:"flex","align-items":"center",gap:"5px"}},ct={key:1},dt=I({__name:"BuildInspector",props:{buildSpec:{}},setup(a){const t=U(),l=a,d=c=>{t.push({name:"logs",params:{projectId:l.buildSpec.projectId},query:c.logQuery})};return(c,P)=>a.buildSpec.runtimes.length>0?(u(),f(e(ve),{key:0,"item-layout":"horizontal","data-source":a.buildSpec.runtimes},{renderItem:s(({item:p})=>[o(e(ye),null,{actions:s(()=>[o(e(W),null,{overlay:s(()=>[o(e(Q),null,{default:s(()=>[o(e(Y),{onClick:w=>d(p)},{default:s(()=>[A("div",ut,[o(e(Oe)),o(e(k),null,{default:s(()=>[_(y(e(g).translate("i18n_build_inspector_view_logs",null)),1)]),_:1})])]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[o(e(nt),{style:{cursor:"pointer"}})]),_:2},1024)]),default:s(()=>[p.type=="form"?(u(),f(e(M),{key:0,size:"large"},{default:s(()=>[o(e(we)),o(e(k),{strong:""},{default:s(()=>[_(y(p.title),1)]),_:2},1024),o(e(k),{type:"secondary",code:""},{default:s(()=>[_("/"+y(p.path),1)]),_:2},1024)]),_:2},1024)):C("",!0),p.type=="job"?(u(),f(e(M),{key:1,size:"large"},{default:s(()=>[o(e(Se)),o(e(k),{strong:""},{default:s(()=>[_(y(p.title),1)]),_:2},1024),o(e(k),{type:"secondary",code:""},{default:s(()=>[_(y(p.schedule),1)]),_:2},1024)]),_:2},1024)):C("",!0),p.type=="hook"?(u(),f(e(M),{key:2,size:"large"},{default:s(()=>[o(e(xe)),o(e(k),{strong:""},{default:s(()=>[_(y(p.title),1)]),_:2},1024),o(e(k),{type:"secondary",code:""},{default:s(()=>[_("/_hooks/"+y(p.path),1)]),_:2},1024)]),_:2},1024)):C("",!0),p.type=="script"?(u(),f(e(M),{key:3,size:"large"},{default:s(()=>[o(e(Pe)),o(e(k),{strong:""},{default:s(()=>[_(y(p.title),1)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(u(),h("div",ct,[o(e(J),{description:e(g).translate("i18n_build_inspector_no_runtimes",null)},null,8,["description"])]))}}),pt=I({__name:"Builds",setup(a){const l=ae().params.projectId,{loading:d,result:c,refetch:P}=V(async()=>{const[n,r]=await Promise.all([Ce.list(l),Ae.getStatus(l)]);return{b:n.map(b=>({build:b,status:r.filter(S=>S.buildId==b.id).map(S=>S.status)})),status:r}}),{startPolling:p,endPolling:w}=me({task:P,interval:1e4});X(()=>p()),ee(()=>w());const v=te(null),O=V(async()=>v.value?await ke.get(v.value):null),m=()=>{var i;const n=(i=c.value)==null?void 0:i.b.find(b=>b.build.id===v.value);return`Version ${n==null?void 0:n.build.id.slice(0,8)} - ${n==null?void 0:n.build.createdAt.toLocaleString()}`},E=[{translationKey:"i18n_builds_deploying",tagColor:"blue",check:n=>{var r,i;return(i=n.build.latest&&n.status.some(b=>b=="Running")&&((r=c.value)==null?void 0:r.status.some(b=>b.buildId!==n.build.id)))!=null?i:!1},loading:!0},{translationKey:"i18n_builds_deactivating",tagColor:"orange",check:n=>n.build.status==="success"&&!n.build.latest&&n.status.some(r=>r=="Running"),loading:!0},{translationKey:"i18n_builds_live",tagColor:"green",check:n=>n.build.latest&&n.status.some(r=>r=="Running")},{translationKey:"i18n_builds_sleeping",tagColor:"cyan",check:n=>n.build.latest&&n.status.length===0},{translationKey:"i18n_builds_failed",tagColor:"red",check:n=>n.build.latest&&n.status.some(r=>r=="Failed")},{translationKey:"i18n_builds_inactive",tagColor:"default",check:n=>n.build.status==="success"},{translationKey:"i18n_builds_aborted",tagColor:"default",check:n=>n.build.status==="aborted"||n.build.status==="aborted-by-user"},{translationKey:"i18n_builds_failed",tagColor:"orange",check:n=>n.build.status==="failure"},{translationKey:"i18n_builds_deploying",tagColor:"blue",check:n=>n.build.status==="in-progress",loading:!0},{translationKey:"i18n_builds_uploading",tagColor:"yellow",check:n=>n.build.status==="pending"}];function L(n){var i,b;const r=E.find(S=>S.check(n));return{text:r?g.translate(r.translationKey):"unknown",tagColor:(i=r==null?void 0:r.tagColor)!=null?i:"default",hover:(b=n.build.log)!=null?b:void 0}}const R=x(()=>{const n=[{title:g.translate("i18n_builds_id")},{title:g.translate("i18n_builds_date")},{title:g.translate("i18n_builds_abstra_version")},{title:g.translate("i18n_builds_status")},{title:"",align:"right"}];return c.value?{columns:n,rows:c.value.b.map(r=>{var i;return{key:r.build.id,cells:[{type:"text",text:r.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:fe(r.build.createdAt,{weekday:void 0}),distance:de(r.build.createdAt)}},{type:"text",text:(i=r.build.abstraVersion)!=null?i:"-"},{key:"status",type:"slot",payload:L(r)},{type:"actions",actions:[{icon:be,label:g.translate("i18n_builds_inspect_version"),onClick:async()=>{v.value=r.build.id,O.refetch()}},{icon:ge,label:g.translate("i18n_builds_view_application_logs"),onClick:()=>{he.push({name:"logs",params:{projectId:l},query:{buildId:r.build.id}})}},{icon:_e,label:g.translate("i18n_builds_download_files"),onClick:()=>r.build.download()}]}]}})}:{columns:n,rows:[]}});return(n,r)=>(u(),h(ne,null,[o(F,{"entity-name":"build",loading:e(d),title:e(g).translate("i18n_builds_version_history"),description:e(g).translate("i18n_builds_description"),"empty-title":e(g).translate("i18n_builds_empty_title"),table:R.value,live:""},{date:s(({payload:i})=>[o(e(le),null,{title:s(()=>[_(y(i.distance),1)]),default:s(()=>[_(y(i.date)+" ",1)]),_:2},1024)]),status:s(({payload:i})=>[o(e(re),{open:i.hover?void 0:!1},{content:s(()=>[o(e(ie),{style:{width:"300px",overflow:"auto","font-family":"monospace"},content:i.hover,copyable:""},null,8,["content"])]),default:s(()=>[i.text!=="unknown"?(u(),f(e(oe),{key:0,color:i.tagColor,style:se({cursor:i.hover?"pointer":"default"})},{default:s(()=>[i.text==="Live"?(u(),f(e(lt),{key:0})):i.text==="Inactive"?(u(),f(e(it),{key:1})):i.text==="Failed"?(u(),f(e(Ze),{key:2})):i.text==="Aborted"?(u(),f(e(Me),{key:3})):i.text==="Sleeping"?(u(),f(e(ot),{key:4})):i.text==="Uploading"?(u(),f(e($),{key:5})):i.text==="Deploying"?(u(),f(e($),{key:6})):i.text==="Deactivating"?(u(),f(e($),{key:7})):C("",!0),_(" "+y(i.text),1)]),_:2},1032,["color","style"])):C("",!0)]),_:2},1032,["open"])]),_:1},8,["loading","title","description","empty-title","table"]),v.value?(u(),f(e(ce),{key:0,footer:null,open:!!v.value,size:"large",width:"80%",title:m(),onCancel:r[0]||(r[0]=i=>v.value=null)},{default:s(()=>[!e(O).result.value||e(O).loading.value?(u(),f(e(ue),{key:0})):e(O).result.value?(u(),f(dt,{key:1,"build-spec":e(O).result.value},null,8,["build-spec"])):C("",!0)]),_:1},8,["open","title"])):C("",!0)],64))}});const Vt=pe(pt,[["__scopeId","data-v-cfc16bae"]]);export{Vt as default};
//# sourceMappingURL=Builds.e8321cf9.js.map

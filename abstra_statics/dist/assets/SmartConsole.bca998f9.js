import{d as j,v as G,K as Q,H as ue,b as a,c as l,z as u,V as H,W as N,x as e,D as L,N as R,e as $,ab as de,S as X,O as Z,Q as ee,q as te,r as y,R as pe,X as V,o as he,U as me,I as D,G as T,A as ve,F as B,L as K,a2 as fe,J as ye,a as ge,t as _e}from"./registerWidgets.802bba2f.js";import{p as ke,o as J,q as O,r as W,t as we}from"./icons.97625e56.js";import{a as q}from"./asyncComputed.1364aaa9.js";import{F as Se}from"./forms.91463966.js";import{D as be}from"./dashes.ca1ade9b.js";import{H as Ce}from"./hooks.911e43af.js";import{J as Y}from"./jobs.cb7d0efd.js";import{W as xe}from"./workspaces.4c177a35.js";import{l as f,u as Ie}from"./log.8028a717.js";import{L as $e}from"./login.29b4c1f1.js";import{c as Re}from"./sentry.2692e5c6.js";const se=o=>(Z("data-v-7d69f0ed"),o=o(),ee(),o),Ee={class:"runtime-settings"},Pe={key:0,class:"field"},Me=se(()=>e("div",{class:"label"},"Path",-1)),De={class:"field"},Le=se(()=>e("div",{class:"label"},"Code",-1)),Te={class:"input-row"},Ae={key:1,class:"root-path loading"},Ue={class:"path-feedback"},Fe={key:1,class:"error"},ze=j({__name:"RuntimeCommonSettings",props:{runtime:null},setup(o){const n=o,i=G({pathError:null}),{result:c}=q(()=>xe.get()),d=()=>{!c.value||!n.runtime.file||c.value.openFile(n.runtime.file)},b=Q(()=>{var w;return(w=n.runtime.file)!=null&&w.endsWith(".py")?null:"It should be a .py file"}),g=()=>{!c.value||!E.value||c.value.openFile(".")},C=ue(),{result:E}=q(()=>fetch("/_editor/api/workspace/root-path").then(w=>w.text()));return n.runtime.onUpdate(()=>{if(!(n.runtime instanceof Y))if(console.log("runtime updated",n.runtime.path),n.runtime instanceof Se)C.push({path:`/_editor/form/${encodeURIComponent(n.runtime.path)}`});else if(n.runtime instanceof Ce)C.push({path:`/_editor/hook/${encodeURIComponent(n.runtime.path)}`});else if(n.runtime instanceof be)C.push({path:`/_editor/dash/${encodeURIComponent(n.runtime.path)}`});else throw new Error(`Unknown runtime type ${n.runtime}`)}),(w,m)=>(a(),l("div",Ee,[o.runtime instanceof u(Y)?L("",!0):(a(),l("div",Pe,[Me,H(e("input",{"onUpdate:modelValue":m[0]||(m[0]=v=>o.runtime.path=v),class:"path-input",type:"text"},null,512),[[N,o.runtime.path]])])),e("div",De,[Le,e("div",Te,[u(E)?(a(),l("button",{key:0,class:"root-path",onClick:m[1]||(m[1]=v=>g())},R(u(E)),1)):(a(),l("span",Ae," Loading... ")),H(e("input",{"onUpdate:modelValue":m[2]||(m[2]=v=>o.runtime.file=v),type:"text"},null,512),[[N,o.runtime.file]]),e("button",{class:"open-file-icon",onClick:m[3]||(m[3]=v=>d())},[$(de,{path:u(ke)},null,8,["path"]),X(" Open in editor ")])]),e("div",Ue,R(u(b)),1)]),i.pathError?(a(),l("div",Fe,R(i.pathError),1)):L("",!0)]))}});const mt=te(ze,[["__scopeId","data-v-7d69f0ed"]]);class He{static async*sendMessage(n,i){var b;const d=(b=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:n,runtime:i})})).body)==null?void 0:b.getReader();if(!d)throw new Error("No response body");for(;;){const g=await d.read();if(g.done)break;yield new TextDecoder().decode(g.value)}}}const Ne=o=>(Z("data-v-580c5bff"),o=o(),ee(),o),Ve={class:"smart-console"},Be={class:"header"},Ke={class:"left"},Je={class:"right"},Oe={class:"cli"},We={class:"left"},qe=Ne(()=>e("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Ye={key:1,class:"local-entry"},je={class:"entry ai-output"},Ge={key:0},Qe={class:"local-entry"},Xe={class:"input"},Ze=["pointer-events","onKeydown"],et={class:"right"},tt=j({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},dashPlayerState:null,formCode:null,runtime:null},emits:["clear-terminal","restart","enter"],setup(o,{emit:n}){const i=o,c=y(""),d=y(null),b=ye(),g=y(!1),C=y(!1),E=()=>{f.clear(),n("restart")},w=()=>{_.value=_.value==="assistant"?"debugger":"assistant"};function m(t){switch(t.type){case"ai-input":return{role:"user",content:t.log};case"ai-output":return{role:"assistant",content:t.log};case"stderr":case"stdout":return{role:"user",content:t.log};case"restart":return{role:"user",content:"-- new session --"}}}pe(b,()=>{f.clear(),n("clear-terminal")});const v=y(null),_=y("assistant"),ne=async t=>{var r;if(t.preventDefault(),c.value=((r=v.value)==null?void 0:r.innerText)||"",t.shiftKey){document.execCommand("insertLineBreak");return}v.value&&(v.value.innerText=""),_.value==="assistant"?await oe():await ae()},oe=async()=>{var r;if(n("enter",c.value),f.log({type:"ai-input",log:c.value}),c.value="",!C.value){f.log({type:"stderr",log:"Please login to use the AI assistant."});return}g.value=!0;const t={role:"user",content:(r=i.formCode)!=null?r:""};try{const h=Ie();let s="";const k=He.sendMessage([t,...f.logs.map(I=>m(I)),{role:"user",content:c.value}],i.runtime);for await(const I of k)s+=I,f.log({type:"ai-output",log:s},h)}catch(h){f.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(h),Re(h)}finally{g.value=!1}},ae=async()=>{c.value&&(S({type:"eval-request",content:`>>> ${c.value}`}),re(c.value),c.value="")},P=G([]),S=async t=>{P.push(t),await V(),d.value&&(d.value.scrollTop=d.value.scrollHeight)},re=t=>{var r,h,s;(s=(r=i.dashPlayerState)==null?void 0:r.broker)==null||s.send({type:"eval",expression:t,state:(h=i.dashPlayerState)==null?void 0:h.apiPageState})};(()=>{var t,r,h,s,k,I;(t=i.dashPlayerState)==null||t.on("eval-return",p=>{p.repr&&S({type:"log",content:p.repr})}),(r=i.dashPlayerState)==null||r.on("eval-error",p=>{S({type:"error",content:p.repr})}),(h=i.dashPlayerState)==null||h.on("stderr",p=>{S({type:"error",content:p.log})}),(s=i.dashPlayerState)==null||s.on("stdout",p=>{S({type:"log",content:p.log})}),(k=i.dashPlayerState)==null||k.on("widgets-computed",p=>{var M;(M=p.errors)!=null&&M.general&&S({type:"error",content:p.errors.general.repr})}),(I=i.dashPlayerState)==null||I.on("program-start-failed",p=>{var M;S({type:"error",content:(M=p.error)!=null?M:""})})})();const le=()=>{_.value==="assistant"&&f.clear(),P.splice(0,P.length)};f.listen(async t=>{t.type!=="restart"&&(x.value=!0,await V(),d.value&&(d.value.scrollTop=d.value.scrollHeight))});const x=y(!1),U=y(400),ie=Q(()=>({height:`${U.value}px`})),A=y(!1),ce=()=>A.value=!0,F=t=>{!A.value||(U.value=document.body.clientHeight-t.clientY)},z=()=>A.value=!1;return he(()=>{document.addEventListener("mousemove",F),document.addEventListener("mouseup",z),$e.get().then(t=>C.value=!!t)}),me(()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",z)}),(t,r)=>{const h=ge("Markdown");return a(),l("div",Ve,[e("div",Be,[e("div",Ke,[$(D,{path:_.value==="assistant"?u(J):u(O)},null,8,["path"]),X(" Smart Console ")]),e("div",Je,[o.runtime==="dashes"?(a(),l("button",{key:0,class:"header-button",onClick:r[0]||(r[0]=s=>w())},R(_.value==="assistant"?"Switch to Debugger":"Switch to AI Assistant"),1)):L("",!0),e("div",{class:"changes-container"},[e("button",{class:"header-button",onClick:E},"Restart")]),e("div",{class:"toggle-button",onClick:r[1]||(r[1]=s=>x.value=!x.value)},[$(D,{class:T(["icon",{open:x.value}]),path:u(W),fill:"#fff"},null,8,["class","path"])])])]),x.value?(a(),l("div",{key:0,class:"terminal",style:ve(u(ie))},[e("div",{class:"resize-handler",onMousedown:ce},null,32),e("div",Oe,[e("div",We,[_.value==="assistant"?(a(),l("div",{key:0,ref_key:"entriesContainer",ref:d,class:"entries"},[qe,(a(!0),l(B,null,K(u(f).logs,(s,k)=>(a(),l("div",{key:k,class:T([s.type,"entry"])},[s.type==="ai-output"?(a(),_e(h,{key:0,source:s.log},null,8,["source"])):(a(),l("div",Ye,R(s.type==="restart"?"-- restarted --":s.log),1))],2))),128))],512)):(a(),l("div",{key:1,ref_key:"entriesContainer",ref:d,class:"entries"},[e("div",je,[P.length===0?(a(),l("div",Ge," You can inspect your code here. ")):L("",!0),(a(!0),l(B,null,K(P,(s,k)=>(a(),l("div",{key:k,class:T([s.type,"entry"])},[e("div",Qe,R(s.type==="restart"?"-- restarted --":s.content),1)],2))),128))])],512)),e("div",Xe,[$(D,{class:T(["icon",{open:x.value}]),path:u(W)},null,8,["class","path"]),e("div",{ref_key:"inputRef",ref:v,class:"input-text",contenteditable:"","pointer-events":g.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:fe(ne,["enter"])},null,40,Ze)])]),e("div",et,[e("div",{class:"icons",onClick:le},[$(D,{class:"icon",path:u(we)},null,8,["path"])]),e("div",null,[$(D,{class:"icon",path:_.value==="assistant"?u(J):u(O)},null,8,["path"])])])])],4)):L("",!0)])}}});const vt=te(tt,[["__scopeId","data-v-580c5bff"]]);export{mt as R,vt as S};
//# sourceMappingURL=SmartConsole.bca998f9.js.map

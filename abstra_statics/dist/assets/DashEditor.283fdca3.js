var Cs=Object.defineProperty;var Ns=(e,t,s)=>t in e?Cs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var le=(e,t,s)=>(Ns(e,typeof t!="symbol"?t+"":t,s),s);import{r as xs}from"./index.7a773bce.js";import{T as Ms,B as Ws,a as Ct}from"./BackButton.05f1911d.js";import{p as Bs,i as Jt,z as tt,A as st,B as Gs,k as Qt,C as Fs}from"./icons.a63cb90b.js";import{d as Z,b,c as O,v as _,V as Ie,W as ft,e as T,N as ze,O as Ke,q as J,p as q,r as F,G,Q as ge,a7 as vt,H,y as g,F as $e,J as Te,z as Ce,B as U,u as gt,U as mt,a as Oe,$ as Hs,E as ce,t as he,X as yt,o as qt,af as Us,D as zs,ag as Ks,ah as Vs,w as we,R as Be,ai as js,K as Zs,L as Js}from"./registerWidgets.d12d7cf9.js";import{i as Qs,w as be,l as it,v as qs,r as Xt,a as Yt,s as Pe,p as Xs,b as Y,c as S,d as De,e as Ys,f as A,D as eo,g as Nt,C as to,h as xt,j as so,k as Mt,m as ot,n as Wt}from"./DashPlayer.526e44da.js";import{R as oo,S as ao}from"./SmartConsole.de1ab198.js";import{a as Bt,L as ro}from"./CircularLoading.89577a16.js";import{i as z,g as B,a as Ge,b as fe,f as _e,w as ne,c as wt,e as no,h as io,s as lo,j as co,k as uo}from"./runnerData.12d27e35.js";import{u as Ve}from"./log.2520bfaa.js";import{D as po}from"./dashes.8e41d473.js";import{W as ho}from"./workspaces.32af92db.js";import{S as fo}from"./SaveButton.afacdfe9.js";import"./WidgetsFrame.015f5931.js";import"./Modal.8745ec05.js";import"./forms.7bc6baea.js";import"./utils.3371dfe5.js";import"./hooks.944007d1.js";import"./jobs.987450d7.js";const vo=e=>(ze("data-v-e0f3144d"),e=e(),Ke(),e),go={class:"dash-settings"},mo={class:"dash-property"},yo=vo(()=>_("label",{class:"property-label"},"Name",-1)),wo=Z({__name:"DashSettings",props:{dash:null},setup(e){return(t,s)=>(b(),O("div",go,[_("div",mo,[yo,Ie(_("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.dash.title=o),class:"property-input",placeholder:"Enter a name"},null,512),[[ft,e.dash.title]])]),T(oo,{runtime:e.dash},null,8,["runtime"])]))}});const _o=J(wo,[["__scopeId","data-v-e0f3144d"]]);class _t{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const So=e=>_t.isMac&&e.ctrlKey,ke=e=>_t.isMac?e.metaKey:e.ctrlKey,lt=e=>e.altKey,pe=e=>e.shiftKey,at={alt:lt,"arrow-up":e=>e.code==="ArrowUp","arrow-down":e=>e.code==="ArrowDown","arrow-left":e=>e.code==="ArrowLeft","arrow-right":e=>e.code==="ArrowRight",ctrl:ke,delete:e=>_t.isMac?e.code==="Backspace":e.code==="Delete",enter:e=>e.code==="Enter",escape:e=>e.code==="Escape",shift:pe,space:e=>e.code==="Space",a:e=>e.code==="KeyA",b:e=>e.code==="KeyB",c:e=>e.code==="KeyC",d:e=>e.code==="KeyD",f:e=>e.code==="KeyF",g:e=>e.code==="KeyG",h:e=>e.code==="KeyH",k:e=>e.code==="KeyK",p:e=>e.code==="KeyP",v:e=>e.code==="KeyV",x:e=>e.code==="KeyX",z:e=>e.code==="KeyZ",0:e=>e.code==="Digit0","[":e=>e.code==="BracketLeft","]":e=>e.code==="BracketRight"};class Eo{constructor(t){le(this,"pressedKeys");le(this,"evt");this.evt=t,this.pressedKeys={};const s=o=>a=>{Object.keys(at).forEach(n=>{at[n](a)&&this.setPressed(n,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(t,s){this.pressedKeys[t]=s}isPressed(t){var s;return this.evt?at[t](this.evt):(s=this.pressedKeys[t])!=null?s:!1}}const bo=new Eo;/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Po=globalThis&&globalThis.__extends||function(){var e=function(t,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var n in a)a.hasOwnProperty(n)&&(o[n]=a[n])},e(t,s)};return function(t,s){e(t,s);function o(){this.constructor=t}t.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}(),Io=Object.prototype.hasOwnProperty;function ct(e,t){return Io.call(e,t)}function ut(e){if(Array.isArray(e)){for(var t=new Array(e.length),s=0;s<t.length;s++)t[s]=""+s;return t}if(Object.keys)return Object.keys(e);var o=[];for(var a in e)ct(e,a)&&o.push(a);return o}function K(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function dt(e){for(var t=0,s=e.length,o;t<s;){if(o=e.charCodeAt(t),o>=48&&o<=57){t++;continue}return!1}return!0}function ve(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function es(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function pt(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,s=e.length;t<s;t++)if(pt(e[t]))return!0}else if(typeof e=="object"){for(var o=ut(e),a=o.length,n=0;n<a;n++)if(pt(e[o[n]]))return!0}}return!1}function Gt(e,t){var s=[e];for(var o in t){var a=typeof t[o]=="object"?JSON.stringify(t[o],null,2):t[o];typeof a<"u"&&s.push(o+": "+a)}return s.join(`
`)}var ts=function(e){Po(t,e);function t(s,o,a,n,i){var c=this.constructor,u=e.call(this,Gt(s,{name:o,index:a,operation:n,tree:i}))||this;return u.name=o,u.index=a,u.operation=n,u.tree=i,Object.setPrototypeOf(u,c.prototype),u.message=Gt(s,{name:o,index:a,operation:n,tree:i}),u}return t}(Error),N=ts,Oo=K,Se={add:function(e,t,s){return e[t]=this.value,{newDocument:s}},remove:function(e,t,s){var o=e[t];return delete e[t],{newDocument:s,removed:o}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:function(e,t,s){var o=Fe(s,this.path);o&&(o=K(o));var a=me(s,{op:"remove",path:this.from}).removed;return me(s,{op:"add",path:this.path,value:a}),{newDocument:s,removed:o}},copy:function(e,t,s){var o=Fe(s,this.from);return me(s,{op:"add",path:this.path,value:K(o)}),{newDocument:s}},test:function(e,t,s){return{newDocument:s,test:Ne(e[t],this.value)}},_get:function(e,t,s){return this.value=e[t],{newDocument:s}}},Ao={add:function(e,t,s){return dt(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:s,index:t}},remove:function(e,t,s){var o=e.splice(t,1);return{newDocument:s,removed:o[0]}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:Se.move,copy:Se.copy,test:Se.test,_get:Se._get};function Fe(e,t){if(t=="")return e;var s={op:"_get",path:t};return me(e,s),s.value}function me(e,t,s,o,a,n){if(s===void 0&&(s=!1),o===void 0&&(o=!0),a===void 0&&(a=!0),n===void 0&&(n=0),s&&(typeof s=="function"?s(t,0,e,t.path):He(t,0)),t.path===""){var i={newDocument:e};if(t.op==="add")return i.newDocument=t.value,i;if(t.op==="replace")return i.newDocument=t.value,i.removed=e,i;if(t.op==="move"||t.op==="copy")return i.newDocument=Fe(e,t.from),t.op==="move"&&(i.removed=e),i;if(t.op==="test"){if(i.test=Ne(e,t.value),i.test===!1)throw new N("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument=e,i}else{if(t.op==="remove")return i.removed=e,i.newDocument=null,i;if(t.op==="_get")return t.value=e,i;if(s)throw new N("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e);return i}}else{o||(e=K(e));var c=t.path||"",u=c.split("/"),l=e,v=1,f=u.length,d=void 0,h=void 0,D=void 0;for(typeof s=="function"?D=s:D=He;;){if(h=u[v],h&&h.indexOf("~")!=-1&&(h=es(h)),a&&(h=="__proto__"||h=="prototype"&&v>0&&u[v-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(s&&d===void 0&&(l[h]===void 0?d=u.slice(0,v).join("/"):v==f-1&&(d=t.path),d!==void 0&&D(t,0,e,d)),v++,Array.isArray(l)){if(h==="-")h=l.length;else{if(s&&!dt(h))throw new N("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);dt(h)&&(h=~~h)}if(v>=f){if(s&&t.op==="add"&&h>l.length)throw new N("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);var i=Ao[t.op].call(t,l,h,e);if(i.test===!1)throw new N("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}}else if(v>=f){var i=Se[t.op].call(t,l,h,e);if(i.test===!1)throw new N("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}if(l=l[h],s&&v<f&&(!l||typeof l!="object"))throw new N("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function M(e,t,s,o,a){if(o===void 0&&(o=!0),a===void 0&&(a=!0),s&&!Array.isArray(t))throw new N("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=K(e));for(var n=new Array(t.length),i=0,c=t.length;i<c;i++)n[i]=me(e,t[i],s,!0,a,i),e=n[i].newDocument;return n.newDocument=e,n}function Lo(e,t,s){var o=me(e,t);if(o.test===!1)throw new N("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument}function He(e,t,s,o){if(typeof e!="object"||e===null||Array.isArray(e))throw new N("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,s);if(Se[e.op]){if(typeof e.path!="string")throw new N("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,s);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new N('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,s);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new N("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new N("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&pt(e.value))throw new N("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,s);if(s){if(e.op=="add"){var a=e.path.split("/").length,n=o.split("/").length;if(a!==n+1&&a!==n)throw new N("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,s)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==o)throw new N("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,s)}else if(e.op==="move"||e.op==="copy"){var i={op:"_get",path:e.from,value:void 0},c=ss([i],s);if(c&&c.name==="OPERATION_PATH_UNRESOLVABLE")throw new N("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,s)}}}else throw new N("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,s)}function ss(e,t,s){try{if(!Array.isArray(e))throw new N("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)M(K(t),K(e),s||!0);else{s=s||He;for(var o=0;o<e.length;o++)s(e[o],o,t,void 0)}}catch(a){if(a instanceof N)return a;throw a}}function Ne(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var s=Array.isArray(e),o=Array.isArray(t),a,n,i;if(s&&o){if(n=e.length,n!=t.length)return!1;for(a=n;a--!==0;)if(!Ne(e[a],t[a]))return!1;return!0}if(s!=o)return!1;var c=Object.keys(e);if(n=c.length,n!==Object.keys(t).length)return!1;for(a=n;a--!==0;)if(!t.hasOwnProperty(c[a]))return!1;for(a=n;a--!==0;)if(i=c[a],!Ne(e[i],t[i]))return!1;return!0}return e!==e&&t!==t}const Ro=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:N,deepClone:Oo,getValueByPointer:Fe,applyOperation:me,applyPatch:M,applyReducer:Lo,validator:He,validate:ss,_areEquals:Ne},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var St=new WeakMap,Do=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),ko=function(){function e(t,s){this.callback=t,this.observer=s}return e}();function $o(e){return St.get(e)}function To(e,t){return e.observers.get(t)}function Co(e,t){e.observers.delete(t.callback)}function No(e,t){t.unobserve()}function xo(e,t){var s=[],o,a=$o(e);if(!a)a=new Do(e),St.set(e,a);else{var n=To(a,t);o=n&&n.observer}if(o)return o;if(o={},a.value=K(e),t){o.callback=t,o.next=null;var i=function(){ht(o)},c=function(){clearTimeout(o.next),o.next=setTimeout(i)};typeof window<"u"&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return o.patches=s,o.object=e,o.unobserve=function(){ht(o),clearTimeout(o.next),Co(a,o),typeof window<"u"&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new ko(t,o)),o}function ht(e,t){t===void 0&&(t=!1);var s=St.get(e.object);Et(s.value,e.object,e.patches,"",t),e.patches.length&&M(s.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function Et(e,t,s,o,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var n=ut(t),i=ut(e),c=!1,u=i.length-1;u>=0;u--){var l=i[u],v=e[l];if(ct(t,l)&&!(t[l]===void 0&&v!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof v=="object"&&v!=null&&typeof f=="object"&&f!=null&&Array.isArray(v)===Array.isArray(f)?Et(v,f,s,o+"/"+ve(l),a):v!==f&&(a&&s.push({op:"test",path:o+"/"+ve(l),value:K(v)}),s.push({op:"replace",path:o+"/"+ve(l),value:K(f)}))}else Array.isArray(e)===Array.isArray(t)?(a&&s.push({op:"test",path:o+"/"+ve(l),value:K(v)}),s.push({op:"remove",path:o+"/"+ve(l)}),c=!0):(a&&s.push({op:"test",path:o,value:e}),s.push({op:"replace",path:o,value:t}))}if(!(!c&&n.length==i.length))for(var u=0;u<n.length;u++){var l=n[u];!ct(e,l)&&t[l]!==void 0&&s.push({op:"add",path:o+"/"+ve(l),value:K(t[l])})}}}function Mo(e,t,s){s===void 0&&(s=!1);var o=[];return Et(e,t,o,"",s),o}const Wo=Object.freeze(Object.defineProperty({__proto__:null,unobserve:No,observe:xo,generate:ht,compare:Mo},Symbol.toStringTag,{value:"Module"}));Object.assign({},Ro,Wo,{JsonPatchError:ts,deepClone:K,escapePathComponent:ve,unescapePathComponent:es});function bt(e,t,s){const{selectedWidgets:o,grid:a}=e,n=[...o,...s||[]],i=Math.min(...n.map(f=>{var d,h;return(h=(d=fe(f,t))==null?void 0:d.colStart)!=null?h:null}).filter(f=>f!==null)),c=Math.max(...n.map(f=>{var d,h;return(h=(d=fe(f,t))==null?void 0:d.colEnd)!=null?h:null}).filter(f=>f!==null)),u=Math.min(...n.map(f=>{var d,h;return(h=(d=fe(f,t))==null?void 0:d.rowStart)!=null?h:null}).filter(f=>f!==null)),l=c>a.columns-1?a.columns-1-c:i<0?-i:0,v=u<0?-u:0;return n.flatMap(f=>{const d=fe(f,t);if(l===0&&v===0)return[];if(!d||!z(d))return[];const h=te(ee(f,B(t)),t);return[{op:"replace",path:`${h}/${f}/colStart`,backup:d,value:d.colStart+l},{op:"replace",path:`${h}/${f}/colEnd`,backup:d,value:d.colEnd+l},{op:"replace",path:`${h}/${f}/rowStart`,backup:d,value:d.rowStart+v},{op:"replace",path:`${h}/${f}/rowEnd`,backup:d,value:d.rowEnd+v}]})}const ee=(e,t,s=null)=>{for(const o in t){const a=t[o];if(z(a)){if(o==e)return s}else{const n=ee(e,a.slot,o);if(n)return n}}return null},Bo=(e,t)=>e.rowStart>=t.row&&e.rowStart<t.row+t.height,os=(e,t)=>{var s;return(s=Object.keys(t.slottables).find(o=>Bo(e,t.slottables[o].position)))!=null?s:null},Ft=(e,t)=>{const s=B(t),o=(n,i,c)=>{for(const u in i){if(u==n)return c;const l=i[u];if(z(l))continue;const v=o(n,l.slot,`${c}/${u}/slot`);if(v)return v}return null},a=o(e,s,Ge(t));if(!a)throw new Error("Widget not found in layout");return a},te=(e,t)=>e?`${Ge(t)}/${e}/slot`:Ge(t),Ue=(e,t,s)=>{if(s){const a=t.slottables[s];return{...e,rowStart:e.rowStart-a.position.row,rowEnd:e.rowEnd-a.position.row}}const o=Object.values(t.slottables).reduce((a,n)=>a+(n.position.row<e.rowStart?n.position.height:0),0);return{...e,rowStart:e.rowStart-o,rowEnd:e.rowEnd-o}};function Go(e){const{grid:t,mouseState:s,workingLayout:o,calculatedPositions:a}=e;if(s.state!=="MOVING_SLOTTABLE")return[];const n=t.cellAt(s.mousePos.x,s.mousePos.y),i=[],c=s.slottableId,u=o.getSlottable(c);if(!u)throw new Error("Slottable not found");const l=ns(rs(n,u.height),a,c);return i.push({op:"replace",path:`/slot/${c}/row`,backup:u.row,value:l.row}),i.push({op:"replace",path:`/slot/${c}/order`,backup:u.order,value:l.order}),i}function Fo(e,t){const{grid:s,mouseState:o,selectedWidgets:a,calculatedPositions:n,workingLayout:i}=e;if(o.state!=="MOVING")return[];const c=s.cellAt(o.initialMousePos.x,o.initialMousePos.y),u=s.cellAt(o.mousePos.x,o.mousePos.y),l={deltaI:u.i-c.i,deltaJ:u.j-c.j},v=[];for(const f of a){const d=n.widgets[f],h={colStart:d.position.colStart+l.deltaI,colEnd:d.position.colEnd+l.deltaI,rowStart:d.position.rowStart+l.deltaJ,rowEnd:d.position.rowEnd+l.deltaJ},D=te(ee(f,B(i.layout)),i.layout),y=os(h,n),R=te(y,i.layout),I=_e(f,B(t));!I||!z(I)||(D===R?v.push({op:"replace",path:`${D}/${f}`,backup:I,value:{...I,...Ue(h,n,y)}}):(v.push({op:"remove",path:`${D}/${f}`,backup:I}),v.push({op:"add",path:`${R}/${f}`,value:{...I,...Ue(h,n,y)}})))}return v}function Ho(e,t,s,o){const a=[];for(const n of e.selectedWidgets){const i=te(ee(n,B(o)),o),c=fe(n,o);!z(c)||(a.push({op:"replace",path:`${i}/${n}/colStart`,backup:c,value:c.colStart+t}),a.push({op:"replace",path:`${i}/${n}/colEnd`,backup:c,value:c.colEnd+t}),a.push({op:"replace",path:`${i}/${n}/rowStart`,backup:c,value:c.rowStart+s}),a.push({op:"replace",path:`${i}/${n}/rowEnd`,backup:c,value:c.rowEnd+s}))}return a}function as(e,t,s,o){const{camera:a,mouseState:n,grid:i}=e;if(!a)throw new Error("No camera value yet");if(n.state!=="RESIZING"&&n.state!=="SLOTTABLE_RESIZING")return null;const c=n.side,u=a.screenPoint2world(n.mousePos),l=c==="bottom"||c==="right"?"bottom-right":"top-left",v=i.snap(u,l),f=c.includes("left")?v.x:t.x,d=c.includes("top")?v.y:t.y,h=c.includes("right")?v.x:t.x+t.width,D=c.includes("bottom")?v.y:t.y+t.height,y=Math.abs(h-f),R=Math.abs(D-d);let I={x:Math.min(f,h),y:Math.min(d,D),width:y,height:R,referential:v.referential};return y<s&&(I={...I,width:s}),R<o&&(I={...I,height:o}),I}const Uo=({selectedWidgets:e,grid:t,calculatedPositions:s})=>Xt(Object.entries(s.widgets).filter(([o])=>e.has(o)).map(([o,a])=>be(s.widgets[o].position,t)).filter(o=>o!==null));function zo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="SLOTTABLE_RESIZING")return[];const a=o.slottables[t.slottableId],n={colStart:0,rowStart:a.position.row,colEnd:s.columns,rowEnd:a.position.row+a.position.height},i=s.rectFromArea(n);if(!i)return[];const c=as(e,i,s.width,s.cellHeight);if(!c)return[];const u=s.areaFromRect(c);return[{op:"replace",path:`/slot/${t.slottableId}/height`,backup:a.position.height,value:u.rowEnd-u.rowStart+1}]}function Ko(e){const{mouseState:t,selectedWidgets:s,grid:o,workingLayout:a,calculatedPositions:n}=e;if(t.state!=="RESIZING")return[];const i=t.side,c=Uo(e);if(!c)return[];const u=Array.from(s).filter(f=>{const d=n.widgets[f];return Qs(be(d.position,o),c,i)}),{minWidth:l,minHeight:v}=ne[t.type].dashProperties;return u.flatMap(f=>{const d=n.widgets[f],h=be(d.position,o),D=as(e,h,l,v);if(!D)return[];const y=ee(f,B(a.layout)),R=te(y,a.layout),I=o.areaFromRect(h),X=Ue(o.areaFromRect(D),n,y);return[{op:"replace",path:`${R}/${f}/colStart`,backup:I.colStart,value:Math.max(X.colStart,0)},{op:"replace",path:`${R}/${f}/colEnd`,backup:I.colEnd,value:Math.min(X.colEnd,it.columns-1)},{op:"replace",path:`${R}/${f}/rowStart`,backup:I.rowStart,value:Math.max(X.rowStart,0)},{op:"replace",path:`${R}/${f}/rowEnd`,backup:I.rowEnd,value:X.rowEnd}]})}function Vo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING")return{operations:[]};const a=Object.values(ne[t.type].pythonAPI.params).reduce((h,D)=>(D.isKwarg||!D.dashesInitialValue||(h[D.argName]=D.dashesInitialValue),h),{}),{initialWidth:n,initialHeight:i}=ne[t.type].dashProperties,c=s.areaFromRect({x:t.x,y:t.y,width:n,height:i,referential:"world"}),u=os(c,o),l=te(u,e.workingLayout.layout),v=Ve(),f={id:v,type:t.type,props:{...a},...Ue(c,o,u),events:{}};return{operations:[{op:"add",path:`${l}/${v}`,value:f}],widgetId:v}}const rs=({j:e},t)=>({row:e,height:t,order:0}),jo=(e,t)=>Object.keys(e).reduce((s,o)=>(o===t||(s[o]=e[o]),s),{}),ns=(e,t,s)=>{const o=s?{...t,slottables:jo(t.slottables,s)}:t,a=Math.max(Object.values(o.slottables).reduce((i,c)=>c.position.row>=e.row?i:c.position.row+c.position.height<=e.row?i-c.position.height:i-(e.row-c.position.row),e.row),0),n=Zo(e,o);return{...e,row:a,order:n}},Ht=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).find(o=>e.row>=o.position.row+o.position.height/2&&e.row<=o.position.row+o.position.height),Ut=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).filter(o=>o.position.row+o.position.height/2>e.row&&o.position.row<=e.row+e.height).reduce((o,a)=>!o||a.position.order<o.position.order?a:o,null),Zo=(e,t)=>{var v,f;const s=Ht(e,t),o=Ut(e,t),a=s?Ut(s.position,t,s.id):null,n=o?Ht(o.position,t,o.id):null,i=[s,n].reduce((d,h)=>d?h&&d.position.order>h.position.order?h:d:h,null),c=[o,a].reduce((d,h)=>d?h&&d.position.order<h.position.order?h:d:h,null);if(!i&&!c)return 0;const u=(v=i==null?void 0:i.position.order)!=null?v:c.position.order-2,l=(f=c==null?void 0:c.position.order)!=null?f:i.position.order+2;return(u+l)/2};function Jo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING_SLOTTABLE")return{operations:[]};const a=s.cellAt(t.x,t.y),n=Ve(),i={id:n,type:t.type,props:{condition:"True"},slot:{},...ns(rs(a,1),o)};return{operations:[{op:"add",path:`/slot/${n}`,value:i}],widgetId:n}}function Qo(e,t){const{mouseState:s,selectedWidgets:o}=e;if(s.state!=="MOVING"||!s.duplicating)return[];const a=[];for(const n of o){const i=te(ee(n,B(t)),t),c=fe(n,t);if(!c)continue;const u=Ve();a.push({op:"add",path:`${i}/${u}`,value:{...q.exports.cloneDeep(c),id:u}})}return a}function is(e,t,s){const o=e.selectedWidgets,a=o.keys().next().value,n=ee(a,B(t)),i=n?wt(n,t).slot:B(t),u=Object.keys(i).filter(f=>!o.has(f)&&!(s!=null&&s.some(d=>f==d))&&z(i[f])).sort((f,d)=>qs(_e(f,B(t)),_e(d,B(t)))),l=[...o,...s||[]].map(f=>_e(f,B(t))).filter(f=>f!=null),v=[];return u.forEach(f=>{const d=_e(f,B(t));if(!d||!z(d))return;let h=0,D={...d};const y=()=>l.some(R=>Yt(D,R));for(;y();)h++,D={...d,rowStart:d.rowStart+h,rowEnd:d.rowEnd+h};if(h){const R=te(n,t);v.push({op:"replace",path:`${R}/${f}/rowStart`,backup:d.rowStart,value:d.rowStart+h}),v.push({op:"replace",path:`${R}/${f}/rowEnd`,backup:d.rowEnd,value:d.rowEnd+h})}l.push(D)}),v}function qo(e,t,s,o){const a=e.selectedWidgets;if(!a.size)return[];const n=[...a],i=[];return n.some(u=>{const l=ee(u,B(o)),v=l?wt(l,o).slot:B(o),f=Object.keys(v).filter(h=>!a.has(h)&&z(v[h])),d=fe(u,o);return f.some(h=>Yt(d,v[h]))})&&a.forEach(u=>{const l=_e(u,B(o)),v=te(ee(u,B(o)),o);!l||!z(l)||(i.push({op:"replace",path:`${v}/${u}/rowStart`,backup:l.rowStart,value:l.rowStart-s}),i.push({op:"replace",path:`${v}/${u}/rowEnd`,backup:l.rowEnd,value:l.rowEnd-s}),i.push({op:"replace",path:`${v}/${u}/colStart`,backup:l.colStart,value:l.colStart-t}),i.push({op:"replace",path:`${v}/${u}/colEnd`,backup:l.colEnd,value:l.colEnd-t}))}),i}function Xo(e,t){const s=[],o=[];for(const a of t){const n=Ve();s.push({op:"add",path:`/slot/${n}`,value:{...q.exports.cloneDeep(a),id:n}}),o.push(n)}return{operations:s,widgetsId:o}}function Yo(e){const t=K(e.workingLayout.layout),s=Qo(e,t);M(t,s);const o=Go(e);M(t,o);const a=Fo(e,t);M(t,a);const n=Ko(e);M(t,n);const i=zo(e);M(t,i);const c=Vo(e);M(t,c.operations);const u=Jo(e);M(t,u.operations);const l=bt(e,t,c.widgetId?[c.widgetId]:[]);M(t,l);const v=is(e,t,c.widgetId?[c.widgetId]:[]);return M(t,v),{layout:t,operations:[...s,...a,...o,...n,...i,...c.operations,...l,...v,...u.operations]}}function ea(e,t,s){const o=e.workingLayout.layout,a=Ho(e,t,s,o);M(o,a);const n=qo(e,t,s,o);M(o,n);const i=bt(e,o);return M(o,i),[...a,...n,...i]}function ta(e,t){const s=e.workingLayout.layout,o=Xo(e,t);M(s,o.operations);const a=bt(e,s,o.widgetsId);M(s,a);const n=is(e,s,o.widgetsId);return M(s,n),[...o.operations,...a,...n]}const sa={class:"zoom-bar"},oa={class:"zoom-value"},aa=Z({__name:"ZoomBar",props:{camera:null},emits:["hover","leave"],setup(e,{emit:t}){const s=e,o=F(!1),a=F(null),n=()=>{var l;(l=s.camera)==null||l.zoomIn(1.1,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},i=()=>{var l;(l=s.camera)==null||l.zoomIn(.9,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},c=G(()=>{var u,l;return`${Math.floor(((l=(u=s.camera)==null?void 0:u.zoom)!=null?l:1)*100)}%`});return ge(()=>{var u;return(u=s.camera)==null?void 0:u.zoom},()=>{clearTimeout(a.value),o.value=!0,a.value=setTimeout(()=>o.value=!1,3e3)}),(u,l)=>Ie((b(),O("div",{class:"zoom-bar-wrapper",onMouseover:l[0]||(l[0]=v=>t("hover")),onMouseleave:l[1]||(l[1]=v=>t("leave"))},[_("div",sa,[_("span",{class:"zoom-control",onClick:i},"-"),_("span",oa,H(g(c)),1),_("span",{class:"zoom-control",onClick:n},"+")])],544)),[[vt,e.camera&&o.value]])}});const ra=J(aa,[["__scopeId","data-v-f937a967"]]),na=()=>window.location.href.startsWith("vscode-webview://"),ia=(e,t)=>{!na()||window.vscode.postMessage({type:"usage-event",event:{type:e,payload:t}})},la=async({operations:e,name:t})=>{ia("widgets_updated",{checkpoint:t,operations:K(e)})};class Pt{constructor(t,s){le(this,"checkpointHistory",{undos:[],redos:[]});le(this,"_save",null);this.workingLayout=t,this.appState=s}static create(t,s){return new Pt(t,s)}setWorkingLayout(t){this.workingLayout=t}undo(){if(this.appState.isPreview||!this.checkpointHistory.undos.length)return;const t=this.checkpointHistory.undos.pop();if(t)return M(this.workingLayout,t.operations),this.checkpointHistory.redos.push(rt(t)),t}redo(){if(this.appState.isPreview)return;const t=this.checkpointHistory.redos.pop();if(t)return M(this.workingLayout,t.operations),this.checkpointHistory.undos.push(rt(t)),t}execute(t){this.appState.isPreview||(M(this.workingLayout,t.operations),this.checkpointHistory.undos.push(rt(t)),this.checkpointHistory.redos=[],this.save(),la(t))}onSave(t){this._save=t}save(){var t;this.appState.isPreview||(t=this._save)==null||t.call(this)}}const rt=e=>({selection:e.selection,name:`RE: ${e.name}`,operations:e.operations.slice().reverse().map(t=>ca(t))}),ca=e=>{switch(e.op){case"add":return{op:"remove",backup:e.value,path:e.path};case"remove":return{op:"add",path:e.path,value:e.backup};case"replace":return{op:"replace",backup:e.value,path:e.path,value:e.backup}}};class It{constructor(t,s){le(this,"operationQueue");this.layout=t,this.operationQueue=Pt.create(t,s)}getRootSlot(){return B(this.layout)}getRootSlotPath(){return Ge(this.layout)}setLayout(t){this.operationQueue.setWorkingLayout(t)}static create(t,s){return new It(t,s)}getWidget(t){return fe(t,this.layout)}getWidgetOrSlottable(t){const s=no(t,this.layout);if(!s)throw new Error(`Could not find widget or slottable with id ${t}`);return s}get widgets(){return this.getRootSlot()}get allWidgets(){const t=s=>Object.entries(s).reduce((o,[a,n])=>z(n)?{...o,[a]:n}:{...o,...t(n.slot)},{});return t(this.widgets)}getSlottable(t){return wt(t,this.layout)}redo(){let t=this.operationQueue.redo();for(;t&&t.operations.length===0;)t=this.operationQueue.redo();return this.operationQueue.save(),t}undo(){let t=this.operationQueue.undo();for(;t&&t.operations.length===0;)t=this.operationQueue.undo();return this.operationQueue.save(),t}updateVariable(t,s){const o=this.getWidget(s);if(!z(o))return;const a=te(ee(s,this.getRootSlot()),this.layout);this.operationQueue.execute({name:"update variable",selection:new Set([s]),operations:[{op:"replace",backup:o.variable,value:t,path:`${a}/${s}/variable`}]})}updateProp({param:t,value:s},o){const a=i=>this.getWidgetOrSlottable(i).props,n=(i,c,u)=>{const l=Ft(i,this.layout);return[{op:"replace",backup:a(i)[c],value:u,path:`${l}/${i}/props/${c}`}]};this.operationQueue.execute({name:"update props",operations:o.flatMap(i=>n(i,t.argName,s)),selection:new Set(o)})}updateEvent({event:t,value:s},o){const a=i=>this.getWidget(i).events,n=(i,c,u)=>{const l=te(ee(i,this.getRootSlot()),this.layout);return[{op:"replace",backup:a(i)[c],value:u,path:`${l}/${i}/events/${c}`}]};this.operationQueue.execute({name:"update events",operations:o.flatMap(i=>n(i,t.key,s)),selection:new Set(o)})}delete(t){this.operationQueue.execute({name:"widgets deleted",operations:t.map(s=>{const o=Ft(s,this.layout);return{op:"remove",backup:this.getWidgetOrSlottable(s),path:`${o}/${s}`}}),selection:new Set(t)})}onSave(t){this.operationQueue.onSave(t)}updateVersion(){this.layout.version!=="0.2"&&this.operationQueue.execute({name:"Version updated",operations:[{op:"replace",backup:this.layout.version,value:"0.2",path:"/version"},{op:"add",value:this.layout.widgets,path:"/slot"},{op:"remove",path:"/widgets",backup:this.layout.widgets}],selection:new Set})}}const zt={PandasDataFrame:"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html",PlotlyFigure:"https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html","datetime.time":"https://docs.python.org/3/library/datetime.html#datetime.time","datetime.date":"https://docs.python.org/3/library/datetime.html#datetime.date","io.IOBase":"https://docs.python.org/3/library/io.html#io.IOBase","time.struct_time":"https://docs.python.org/3/library/time.html#time.struct_time"},ua="#E286A3",da="#EF9542",pa="#B462DB",ha="#40B6D3",fa="#6FB96E",va=[ua,da,pa,ha,fa];function Kt(e){let t=e;return Object.keys(zt).forEach(s=>{if(e.includes(s)){const o=zt[s];t=t.replace(s,`<a href="${o}" target="_blank">${s}</a>`)}}),t}const Ee={},ga=e=>t=>{if(Ee[t])return Ee[t];const s=Object.keys(Ee).length%e.length;return Ee[t]=e[s],e[s]},Vt=ga([...va]),ma=()=>{Object.keys(Ee).forEach(e=>delete Ee[e])};class ya{constructor(){le(this,"globalEventListeners",[])}addGlobalEventListener(t,s){addEventListener(t,s),this.globalEventListeners.find(o=>o.evt===t)||this.globalEventListeners.push({evt:t,handler:s})}removeGlobalEventListeners(){this.globalEventListeners.forEach(({evt:t,handler:s})=>{removeEventListener(t,s)}),this.globalEventListeners=[]}}const wa={class:"param-types"},_a=["innerHTML"],Sa={key:1,class:"prop-type"},Ea=["innerHTML"],ba=Z({__name:"ParamTypes",props:{param:null},setup(e){return(t,s)=>(b(),O("div",wa,[e.param&&e.param.typeDescription?(b(!0),O($e,{key:0},Te(e.param.typeDescription,o=>(b(),O("div",{key:o,class:"prop-type"},[_("p",{class:"type",style:Ce({color:g(Vt)(o)}),innerHTML:g(Kt)(o)},null,12,_a)]))),128)):e.param&&e.param.typeName?(b(),O("div",Sa,[_("p",{class:"type",style:Ce({color:g(Vt)(e.param.typeName)}),innerHTML:g(Kt)(e.param.typeName)},null,12,Ea)])):U("",!0)]))}});const jt=J(ba,[["__scopeId","data-v-d6aed39d"]]),Pa=["value","placeholder"],Ia=["value","placeholder"],Oa=Z({__name:"PythonPropInputRaw",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input","change","clearSuggestions"],setup(e,{emit:t}){const s=e,o=gt({isActive:!1,hasChanges:!1}),a=u=>{t("input",u),o.hasChanges=!0},n=()=>{o.isActive=!1,t("clearSuggestions")},i=u=>{u.preventDefault();const l=u.target,v=l.selectionStart,f=l.selectionEnd,d=l.value;l.value=d.substring(0,v)+"	"+d.substring(f),l.selectionStart=l.selectionEnd=v+1,l.dispatchEvent(new Event("input"))},c=u=>{s.commit(u),o.hasChanges=!1};return mt(()=>{o.hasChanges&&s.commit(s.value)}),(u,l)=>{var f,d;const v=Oe("icon");return b(),O("div",{class:ce(["input-container",{error:e.hasError}])},[T(v,{path:g(Bs),class:"icon",fill:e.hasError?"#D35249":o.isActive?"#3482E5":void 0},null,8,["path","fill"]),e.isCode?(b(),O("textarea",{key:0,value:e.value,class:"prop-input",placeholder:(f=e.placeholder)!=null?f:void 0,onInput:l[0]||(l[0]=h=>a(h.target.value)),onClick:l[1]||(l[1]=h=>o.isActive=!0),onBlur:n,onKeydown:l[2]||(l[2]=Hs(h=>i(h),["tab"])),onChange:l[3]||(l[3]=h=>c(h.target.value))},null,40,Pa)):(b(),O("input",{key:1,value:e.value,class:"prop-input",placeholder:(d=e.placeholder)!=null?d:void 0,onInput:l[4]||(l[4]=h=>a(h.target.value)),onClick:l[5]||(l[5]=h=>o.isActive=!0),onBlur:n,onChange:l[6]||(l[6]=h=>c(h.target.value))},null,40,Ia))],2)}}});const Aa=J(Oa,[["__scopeId","data-v-1159e0c0"]]),La={class:"suggestions"},Ra=["onMousedown"],Da=Z({__name:"PythonAutoCompleteSuggestions",props:{suggestions:null},emits:["select"],setup(e,{emit:t}){return(s,o)=>Ie((b(),O("div",La,[(b(!0),O($e,null,Te(e.suggestions,a=>(b(),O("div",{key:a,class:"suggestion",onMousedown:n=>t("select",a)},H(a),41,Ra))),128))],512)),[[vt,e.suggestions.length]])}});const ka=J(Da,[["__scopeId","data-v-afec000d"]]),$a={class:"python-wrapper"},Ta=Z({__name:"PythonPropInput",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,dashPlayerState:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input"],setup(e,{emit:t}){const s=e,o=G(()=>s.dashPlayerState.suggestionsFor),a=G(()=>s.dashPlayerState.suggestions),n=l=>{c(s.paramName,l),t("input",l)},i=l=>{u(),t("input",l),s.commit(l)},c=async(l,v)=>{!v||s.dashPlayerState.getAutocompleteSuggestions(l,v)},u=async()=>{await yt(),s.dashPlayerState.clearSuggestions()};return(l,v)=>(b(),O("div",$a,[T(Aa,{value:e.value,commit:e.commit,"is-code":e.isCode,"param-name":e.paramName,"dash-player-state":e.dashPlayerState,onInput:n,onClearSuggestions:u},null,8,["value","commit","is-code","param-name","dash-player-state"]),g(o)===e.paramName?(b(),he(ka,{key:0,suggestions:g(a),onSelect:i},null,8,["suggestions"])):U("",!0)]))}});const nt=J(Ta,[["__scopeId","data-v-5e99cdec"]]),se=e=>(ze("data-v-772fa7a8"),e=e(),Ke(),e),Ca={class:"wrapper"},Na={class:"title"},xa={key:0,class:"widget-prop"},Ma=se(()=>_("h2",null,"Error",-1)),Wa=se(()=>_("p",{class:"section-description"}," Some errors were found while computing the widget. ",-1)),Ba=["textContent"],Ga={key:1,class:"section"},Fa=se(()=>_("h2",null,"VARIABLE",-1)),Ha={key:0,class:"section-content"},Ua={class:"widget-prop"},za=se(()=>_("p",{class:"prop-label"},"Bind a variable",-1)),Ka=se(()=>_("p",{class:"prop-description"}," Create a variable to be controlled by this widget. ",-1)),Va={class:"input-container"},ja={key:0,class:"variable-error prop-error"},Za=se(()=>_("pre",null,"Variable not defined",-1)),Ja={key:1,class:"prop-error",textContent:"SyntaxError: This field must be a variable name"},Qa=["textContent"],qa={key:2,class:"section"},Xa=se(()=>_("h2",null,"EVENTS",-1)),Ya={key:0,class:"section-content"},er=se(()=>_("p",{class:"section-description"}," Each event is a Python code that runs on specified situations ",-1)),tr={class:"prop-label"},sr={class:"prop-description"},or={class:"section"},ar=se(()=>_("h2",null,"PROPERTIES",-1)),rr={key:0,class:"section-content"},nr=se(()=>_("p",{class:"section-description"}," Each property is a Python expression, make sure to use the correct syntax. ",-1)),ir={class:"prop-label"},lr={class:"prop-description"},cr=["textContent"],ur=se(()=>_("div",{class:"feedback"},null,-1)),dr=[ur],pr=Z({__name:"WidgetEditor",props:{selectedWidgetErrors:null,layoutModel:null,selectedWidgets:null,dashPlayerState:null},emits:["close","create-variable"],setup(e,{emit:t}){const s=e,o=F(null);ge(()=>s.selectedWidgetErrors,()=>{o.value=null});const a=E=>{y.openedSections.includes(E)?y.openedSections=y.openedSections.filter(P=>P!==E):y.openedSections.push(E)},n=E=>y.openedSections.includes(E),i=E=>z(E)?ne[E.type].name:Pe[E.type].name,c=G(()=>o.value===null?s.selectedWidgetErrors:o.value==="variable"?q.exports.omit(s.selectedWidgetErrors,"variable"):{...s.selectedWidgetErrors,props:q.exports.omit(s.selectedWidgetErrors.props,o.value)}),u=G(()=>l.value.type.includes("-input")&&l.value.type!=="click-input"),l=G(()=>s.selectedWidgets[0]),v=G(()=>{var L;if(!z(l.value))return;const P=((L=ne[l.value.type].pythonAPI.params)!=null?L:[]).find(C=>C.argName==="initial_value");return P||null});function f(E){this.style.height="0",this.style.height=this.scrollHeight-24+"px"}const d=new ya,h=F(null),D=402,y=gt({isActive:!1,resizing:!1,width:D,openedSections:["properties","variable"]});qt(()=>{h.value&&(d.addGlobalEventListener("mouseup",()=>y.resizing=!1),d.addGlobalEventListener("mousemove",L=>R(L))),document.querySelectorAll(".widget-props-editor textarea").forEach(L=>{!L||(L.setAttribute("style","height:"+(L.scrollHeight-24)+"px;overflow-y:hidden;"),L.addEventListener("input",f,!1))})}),Us(()=>{ma(),d.removeGlobalEventListeners()});const R=E=>{y.resizing&&(y.width=Math.max(y.width-E.movementX,D))},I=G(()=>({width:`${y.width}px`})),X=E=>Pe[E.type].params,je=G(()=>{const E=(C,V)=>C.argName===V.argName&&C.typeName===V.typeName,P=(C,V,k)=>k.findIndex(ue=>E(C,ue))===V,L=C=>!C.formOnly;return s.selectedWidgets.flatMap(C=>{var V;return z(C)?(V=ne[C.type])==null?void 0:V.pythonAPI.params:X(C)}).filter(Boolean).filter(L).filter(P)}),ye=G(()=>{const E=(L,C)=>L.key===C.key,P=(L,C,V)=>V.findIndex(k=>E(L,k))===C;return s.selectedWidgets.flatMap(L=>{var C;return z(L)?(C=ne[L.type])==null?void 0:C.events:[]}).filter(Boolean).filter(P).filter(L=>L.key!=="change")}),Ze=E=>{s.layoutModel.updateVariable(E,l.value.id),o.value="variable"},xe=E=>P=>{s.layoutModel.updateProp({param:E,value:P},s.selectedWidgets.map(L=>L.id)),o.value=E.argName},Je=E=>P=>{s.layoutModel.updateEvent({event:E,value:P},s.selectedWidgets.map(L=>L.id))},Qe=()=>{var E,P;return(P=(E=c.value.variable)==null?void 0:E.repr)==null?void 0:P.includes("SyntaxError")},qe=()=>{var E,P;return(P=(E=c.value.variable)==null?void 0:E.repr)==null?void 0:P.includes("NameError")},w=E=>{var P;!E||((P=s.dashPlayerState.broker)==null||P.send({name:E,value:null,type:"variable-created",state:s.dashPlayerState.apiPageState}),t("create-variable",E))},x=()=>{var E,P;return((E=c.value.widget)==null?void 0:E.repr)&&!Object.values((P=c.value.props)!=null?P:{}).some(L=>L.repr)},Q=E=>{var P,L;return(L=(P=c.value.props)==null?void 0:P[E])==null?void 0:L.repr},oe=E=>q.exports.upperFirst(E.replace(/_/g," "));return(E,P)=>{var C,V;const L=Oe("icon");return b(),O("div",{class:"widget-props-editor",style:Ce(g(I))},[_("div",Ca,[_("div",Na,[_("h1",null,H(i(g(l))),1),T(L,{path:g(Jt),fill:"#414A58",class:"close-icon",width:"16",height:"16",onClick:P[0]||(P[0]=k=>t("close"))},null,8,["path"])]),x()?(b(),O("div",xa,[Ma,Wa,_("pre",{class:"prop-error",textContent:H(x())},null,8,Ba)])):U("",!0),g(u)?(b(),O("div",Ga,[_("div",{class:"section-header",onClick:P[1]||(P[1]=k=>a("variable"))},[T(L,{path:n("variable")?g(tt):g(st),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Fa]),n("variable")?(b(),O("div",Ha,[_("div",Ua,[za,Ka,_("div",Va,[T(nt,{placeholder:"variable_name","param-name":"variable","dash-player-state":e.dashPlayerState,value:(C=g(l).variable)!=null?C:"",commit:Ze,"is-code":!1,onInput:P[2]||(P[2]=k=>g(l).variable=k)},null,8,["dash-player-state","value"])]),qe()&&g(l).variable?(b(),O("div",ja,[Za,_("button",{onClick:P[3]||(P[3]=k=>w(g(l).variable))}," Create ")])):Qe()?(b(),O("pre",Ja)):(V=g(c).variable)!=null&&V.repr?(b(),O("pre",{key:2,class:"prop-error",textContent:H(g(c).variable.repr)},null,8,Qa)):U("",!0),T(jt,{param:g(v)},null,8,["param"])])])):U("",!0)])):U("",!0),g(ye).length?(b(),O("div",qa,[_("div",{class:"section-header",onClick:P[4]||(P[4]=k=>a("events"))},[T(L,{path:n("events")?g(tt):g(st),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Xa]),n("events")?(b(),O("div",Ya,[er,(b(!0),O($e,null,Te(g(ye),k=>(b(),O("div",{key:k.key,class:"widget-prop"},[_("label",tr,"On "+H(k.key),1),_("p",sr,"Executed after "+H(k.key),1),T(nt,{"param-name":k.key,"dash-player-state":e.dashPlayerState,value:g(l).events[k.key],commit:Je(k),"is-code":!0,onInput:ue=>g(l).events[k.key]=ue},null,8,["param-name","dash-player-state","value","commit","onInput"])]))),128))])):U("",!0)])):U("",!0),_("div",or,[_("div",{class:"section-header",onClick:P[5]||(P[5]=k=>a("properties"))},[T(L,{path:n("properties")?g(tt):g(st),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),ar]),n("properties")?(b(),O("div",rr,[nr,(b(!0),O($e,null,Te(g(je),k=>{var ue;return b(),O("div",{key:k.argName,class:"widget-prop"},[_("p",ir,H(oe(k.argName)),1),_("p",lr,H(k.description),1),T(nt,{"has-error":!!Q(k.argName),placeholder:(ue=k.default)!=null?ue:void 0,"param-name":k.argName,"dash-player-state":e.dashPlayerState,value:g(l).props[k.argName],commit:xe(k),"is-code":!0,onInput:de=>g(l).props[k.argName]=de},null,8,["has-error","placeholder","param-name","dash-player-state","value","commit","onInput"]),Q(k.argName)?(b(),O("pre",{key:0,class:"prop-error",textContent:H(Q(k.argName))},null,8,cr)):U("",!0),T(jt,{param:k},null,8,["param"])])}),128))])):U("",!0)])]),_("div",{ref_key:"handlerRef",ref:h,class:"handler",onMousedown:P[6]||(P[6]=zs(k=>y.resizing=!0,["stop"]))},dr,544)],4)}}});const hr=J(pr,[["__scopeId","data-v-772fa7a8"]]),ls=e=>(ze("data-v-0d595f79"),e=e(),Ke(),e),fr={class:"interact-menu"},vr={class:"icon-container"},gr=ls(()=>_("span",{class:"edit"},"Edit [Shift + P]",-1)),mr={class:"icon-container"},yr=ls(()=>_("span",null,"Interact [Shift + P]",-1)),wr=Z({__name:"InteractMenu",props:{isPreview:{type:Boolean}},emits:["changePreview"],setup(e,{emit:t}){return(s,o)=>{const a=Oe("icon");return b(),O("div",fr,[_("div",vr,[T(a,{class:ce(["icon",{active:!e.isPreview}]),path:g(Gs),fill:"#5A677A",onClick:o[0]||(o[0]=n=>t("changePreview",!1))},null,8,["class","path"]),gr]),_("div",mr,[T(a,{class:ce(["icon",{active:e.isPreview}]),path:g(Qt),fill:"#5A677A",onClick:o[1]||(o[1]=n=>t("changePreview",!0))},null,8,["class","path"]),yr])])}}});const _r=J(wr,[["__scopeId","data-v-0d595f79"]]),Sr={class:"header"},Er={key:0},br={key:1},Pr=Z({__name:"RuntimeHeader",props:{title:{type:String},path:{type:String,required:!0}},setup(e){return(t,s)=>(b(),O("div",Sr,[e.title?(b(),O("p",Er,H(e.title),1)):(b(),O("p",br,H(e.path),1))]))}});const Ir=J(Pr,[["__scopeId","data-v-c8a406b2"]]);function Or(e){var s;const t=(s=document.getSelection())==null?void 0:s.toString();return(e==null?void 0:e.selectionStart)!==void 0||!!t}const Ar={key:0,class:"widget-metadata-card"},Lr=["src"],Rr={class:"metadata-title"},Dr={class:"metadata-description"},kr={key:1,class:"collapsed-widget-metadata-card"},$r=["src"],Tr=Z({__name:"WidgetMetadataCard",props:{metadata:null,collapsed:{type:Boolean}},setup(e){const t=window.__baseURL?`${window.__baseURL}/media`:"",s=a=>a in Pe?`${t}/${Pe[a].thumbname}`:`${t}/widget-thumbs/${io(a)}.svg`,o=window.__vscodeTheme===2?"dark":"light";return(a,n)=>e.collapsed?(b(),O("div",kr,[_("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:Ce(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,$r)])):(b(),O("div",Ar,[_("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:Ce(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,Lr),_("div",Rr,H(e.metadata.name),1),_("div",Dr,H(e.metadata.description),1)]))}});const Cr=J(Tr,[["__scopeId","data-v-2b654c57"]]),We={"click-input":-1,"text-output":0,"number-input":1,"text-input":2,"link-output":3,"multiple-choice-input":4,"file-input":5,"email-input":6,"markdown-output":7,"dropdown-input":8,"date-input":9,"cards-input":10,"textarea-input":11,"list-input":12,"file-output":13,"html-output":14,"pandas-output":15,"checkbox-input":16,"cnpj-input":17,"code-input":18,"progress-output":19,"pandas-row-selection-input":20,"image-input":21,"password-input":22,"currency-input":23,"iframe-output":24,"checklist-input":25,"image-output":26,"nps-input":27,"phone-input":28},Nr=Z({__name:"WidgetsMetadataList",emits:["dragstart","hover","leave"],setup(e,{emit:t}){const s=F(""),o=F(),a=F(!0),n=()=>{a.value=!1},i=()=>{a.value=!0,u()},c=async()=>{await yt(),o.value&&o.value.focus()},u=()=>{s.value=""},l=Object.values(ne).concat(Object.entries(Pe).map(([d,h])=>({type:d,...h}))).reduce((d,h)=>h.formOnly?d:{...d,[h.type]:h},{}),v=G(()=>s.value?Object.values(l).map(d=>({widget:d,score:lo(d,s.value.split(" "))})).filter(({score:d})=>d>0).sort(({score:d},{score:h})=>h-d).map(({widget:d})=>d):Object.values(l).sort((d,h)=>{const D=d.type,y=h.type;if(D in We){if(!(y in We))return-1}else return 1;return We[D]-We[y]}));function f(d,h){t("dragstart",d,h)}return(d,h)=>{const D=Oe("icon");return b(),O("div",{class:"widgets-metadata",onMouseover:n,onMouseleave:i},[_("div",Ks({class:["search",{collapsed:a.value}]},Vs(a.value?{click:c}:{},!0)),[T(D,{path:g(Fs),class:"search-icon"},null,8,["path"]),a.value?U("",!0):Ie((b(),O("input",{key:0,ref_key:"searchInput",ref:o,"onUpdate:modelValue":h[0]||(h[0]=y=>s.value=y),type:"search",class:"widgets-metadata-filter",placeholder:"Find widgets"},null,512)),[[ft,s.value]])],16),_("div",{class:ce(["widgets-metadata-list",{collapsed:a.value}])},[(b(!0),O($e,null,Te(g(v),y=>(b(),he(Cr,{key:y.type,metadata:y,draggable:!0,collapsed:a.value,onDragstart:R=>f(R,y.type)},{default:we(()=>[Be(H(y.type),1)]),_:2},1032,["metadata","collapsed","onDragstart"]))),128))],2)],32)}}});const xr=J(Nr,[["__scopeId","data-v-cb0151ea"]]),Mr=e=>t=>q.exports.uniq(e.map(Xs(t))).length===1,Wr=e=>e.some(t=>ne[t.type].autoHeight);function Br(e,t){const s=Mr(e),o=Wr(e),a=[],n=16,i=6;return s("colStart")&&a.push({rect:{x:t.x-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"left"}),s("colEnd")&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"right"}),s("colStart")&&s("rowStart")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-left"}),s("colEnd")&&s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-right"}),s("colStart")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-left"}),s("colEnd")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-right"}),s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y-i/2,width:n,height:i,referential:"screen"},side:"top"}),s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y+t.height-i/2,width:n,height:i,referential:"screen"},side:"bottom"}),a}const Gr=e=>({type:"copyAndPaste",selectedWidgets:e});function Fr(e,t){return e.setData("text/plain",JSON.stringify(Gr(t))),!0}function Hr(e,t,s){const o=e.getData("text/plain");try{const a=o&&JSON.parse(o);if(!(a&&"type"in a&&a.type==="copyAndPaste"&&"selectedWidgets"in a&&Array.isArray(a.selectedWidgets)))return!1;const i=ta(t,a.selectedWidgets);return s.operationQueue.execute({name:"paste",operations:i,selection:t.selectedWidgets}),!0}catch{return!1}}const cs=e=>(ze("data-v-2c14d939"),e=e(),Ke(),e),Ur={class:"runtime-editor"},zr={class:"title"},Kr=cs(()=>_("br",null,null,-1)),Vr={class:"properties"},jr={class:"property"},Zr=cs(()=>_("p",{class:"property-name"},"Title",-1)),Jr=Z({__name:"RuntimePropertiesEditor",props:{runtime:{type:Object,required:!0}},emits:["close"],setup(e,{emit:t}){return(s,o)=>{const a=Oe("icon");return b(),O("div",Ur,[_("div",zr,[_("h1",null,[Be(H(e.runtime.title),1),Kr,Be(" properties ")]),T(a,{path:g(Jt),fill:"#414A58",class:"close-icon",onClick:o[0]||(o[0]=n=>t("close"))},null,8,["path"])]),_("div",Vr,[_("div",jr,[Zr,Ie(_("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>e.runtime.title=n),type:"text",class:"property-input"},null,512),[[ft,e.runtime.title]])])])])}}});const Qr=J(Jr,[["__scopeId","data-v-2c14d939"]]);class qr{constructor(t){le(this,"event");this.event=t}setData(t,s){var o;(o=this.event.clipboardData)==null||o.setData(t,s)}getData(t){var s,o;return(o=(s=this.event.clipboardData)==null?void 0:s.getData(t))!=null?o:null}getTransferItems(){var t,s;return Object.values((s=(t=this.event.clipboardData)==null?void 0:t.items)!=null?s:[]).map(Yr)}}class Xr{constructor(t){le(this,"item");this.item=t}get type(){return this.item.type}getAsString(){return new Promise(t=>this.item.getAsString(s=>t(s)))}getJSONValue(){return this.getAsString().then(t=>{try{return t?JSON.parse(t):null}catch{return null}})}getAsFile(){return this.item.getAsFile()}}function Yr(e){return new Xr(e)}function Zt(e){return new qr(e)}const en=Z({__name:"DashLayoutEditor",props:{dash:null,params:null,dashPlayerState:null,workspace:null},emits:["navigate","change-preview","create-variable"],setup(e,{emit:t}){const s=e,o=()=>I.updateVersion(),a=F(null),n=F(null),i=r=>t("navigate",r),c=r=>t("create-variable",r),u=r=>t("change-preview",r),l=()=>{var r;return(r=A)==null?void 0:r.correct()},v=r=>{if(!A||s.dashPlayerState.brokerIsClosed)return;const p={x:r.pageX,y:r.pageY,referential:"screen"},m=A.screenPoint2world(p);if(w.value.state==="PANNING"){const $={dx:-r.movementX,dy:-r.movementY},W=A.screenDelta2world({dx:$.dx,dy:$.dy,referential:"screen"});A.translate(W),r.preventDefault(),r.stopPropagation();return}w.value.state==="MOVING"&&(w.value.mousePos=m,w.value.duplicating=lt(r)),w.value.state==="MOVING_SLOTTABLE"&&(w.value.mousePos=m),w.value.state==="JUST_CLICKED"&&Nt(w.value.pos,m)*A.zoom>5&&(S.has(w.value.widgetId)||(pe(r)?S.addToSelectedWidgets(w.value.widgetId):(S.resetSelection(),S.addToSelectedWidgets(w.value.widgetId))),w.value={state:"MOVING",initialMousePos:w.value.pos,mousePos:m,duplicating:lt(r)}),w.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&Nt(w.value.mousePos,m)*A.zoom>5&&(w.value={state:"MOVING_SLOTTABLE",initialMousePos:A.screenPoint2world(w.value.mousePos),mousePos:m,slottableId:w.value.slottableId}),w.value.state==="SELECTING"&&(w.value.mousePos=p),w.value.state==="RESIZING"&&(w.value.mousePos=p),w.value.state==="SLOTTABLE_RESIZING"&&(w.value.mousePos=p),Dt(p)},f=r=>{Or(r==null?void 0:r.target)||Fr(Zt(r),S.selectedWidgets)&&r.preventDefault()},d=r=>{Hr(Zt(r),de(),I)&&r.preventDefault()},h=gt({active:!1,hoverZoomBar:!1}),D=()=>{h.hoverZoomBar=!0},y=()=>{h.hoverZoomBar=!1},R=F(null),I=It.create(q.exports.cloneDeep(s.dash.layout),Y);ge(s.dash.layout,()=>{I.setLayout(s.dash.layout)});const X=G(()=>Y.isPreview||s.dashPlayerState.brokerIsClosed),je=G(()=>Object.keys(s.dash.rootSlot).reduce((r,p)=>{const m=s.dash.rootSlot[p];return m.position&&(r[p]=m),r},{}));let ye=null;const Ze=q.exports.throttle(()=>{q.exports.isEqual(s.dash.rootSlot,ye)||(ye=q.exports.cloneDeep(s.dash.rootSlot),ds())},500),xe=()=>{I.onSave(async()=>{!s.workspace||(s.dash.layout=I.layout,s.dashPlayerState.updateDashData(s.dash.makeRunnerData(s.workspace)),Ze())})};xe(),ge(I,xe);const Je=G(()=>Object.keys(I.widgets).reduce((r,p)=>{var j,ae,re;const m=(j=s.dashPlayerState.computedErrors.props)==null?void 0:j[p],$=(ae=s.dashPlayerState.computedErrors.variables)==null?void 0:ae[p],W=(re=s.dashPlayerState.computedErrors.widgets)==null?void 0:re[p];return!m&&!$&&!W||!Object.keys({...m,...$,...W}).length?r:r?[...r,p]:[p]},[])),Qe=G(()=>{var r,p,m,$,W,j;return{props:(p=s.dashPlayerState.computedErrors.props)==null?void 0:p[(r=S.selectedSlottableId)!=null?r:S.selectedWidgetId],widget:($=s.dashPlayerState.computedErrors.widgets)==null?void 0:$[(m=S.selectedSlottableId)!=null?m:S.selectedWidgetId],variable:(j=s.dashPlayerState.computedErrors.variables)==null?void 0:j[(W=S.selectedSlottableId)!=null?W:S.selectedWidgetId]}});function qe(r,p){if(!A)return;const m=A.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});S.resetSelection(),p in Pe?w.value={state:"DRAGGING_SLOTTABLE",...m,type:p}:w.value={state:"DRAGGING",...m,type:p}}const w=F({state:"IDLE"});let x={state:"NONE"};const Q=G(()=>(it.setDashRunnerData(s.dashPlayerState.navbarVisible,s.dashPlayerState.hasSidebar),it));ge(Q,()=>{var r;return(r=A)==null?void 0:r.updateGrid(Q.value)});const oe=F(null),E=F(null),P=F(null),L=F(null);function C(){var $,W;const r=E.value,p=L.value;if(!r)throw new Error(`canvas = ${r}`);if(!p)throw new Error(`editor = ${p}`);A.setProjectedCanvas(r),A.correct(),p.addEventListener("wheel",V),r.addEventListener("mousedown",ue),r.addEventListener("drop",Rt),r.addEventListener("dragover",ps),($=r.parentElement)==null||$.addEventListener("keydown",bs),(W=r.parentElement)==null||W.addEventListener("keyup",Ps);const m=r.getContext("2d");if(!m)throw new Error(`I can't get no context 2d ${r}`);R.value=to.create(r),Xe(m)}function V(r){if(!A)return;const p={x:r.pageX,y:r.pageY,referential:"screen"};if(ke(r)||So(r))A.zoomIn(Math.exp(-Math.sign(r.deltaY)*.05),p),r.preventDefault();else{const m=pe(r)?{dx:r.deltaY,dy:0}:{dx:r.deltaX,dy:r.deltaY},$=A.screenDelta2world({dx:m.dx,dy:m.dy,referential:"screen"});A.translate($)}r.stopPropagation()}function k(r){var p;De.overrideProps(r,{condition:!((p=De.props)!=null&&p[r].condition)})}function ue(r){var $;if(!A)return;const p={x:r.pageX,y:r.pageY,referential:"screen"};if(r.button==1||r.button==0&&bo.isPressed("space")){w.value={state:"PANNING",initialMousePos:p,mousePos:p};return}const m=A.screenPoint2world(p);x.state==="HOVERING_WIDGET"?w.value={state:"JUST_CLICKED",pos:m,widgetId:x.widgetId}:x.state==="HOVERING_RESIZE_HANDLER"?w.value={state:"RESIZING",side:x.side,initialMousePos:p,mousePos:p,type:($=S.selectedWidget)==null?void 0:$.type}:x.state==="HOVERING_TOGGLE"?w.value={state:"JUST_CLICKED_TOGGLE",mousePos:p,slottable:x.slottable}:x.state==="HOVERING_SLOTTABLE_RESIZE_HANDLER"?w.value={state:"SLOTTABLE_RESIZING",initialMousePos:p,mousePos:p,slottableId:x.slottableId,side:"bottom"}:x.state==="HOVERING_SLOTTABLE_SELECTOR"?w.value={state:"JUST_CLICKED_SLOTTABLE_SELECTOR",slottableId:x.slottableId,mousePos:p}:(pe(r)||S.resetSelection(),w.value={state:"SELECTING",initialMousePos:p,mousePos:p})}const de=()=>{var r;return{mouseState:w.value,grid:Q.value,camera:A,workingLayout:I,hoverState:x,resizeHandlerRects:At(),widgetsInRectangularSelection:Ye(),selectedWidgets:new Set(S.selectedWidgetsIds),dash:s.dash,calculatedPositions:xt(s.dashPlayerState.runnerData.layout.slot,(r=De.props)!=null?r:{},Q.value),selectedSlottable:S.selectedSlottableId}},us=()=>{var W,j,ae,re,Ae,Le,Re,kt,$t,Tt;const r=A.screenRect2world(A.canvasRect),p=A.screenDelta2world({dx:8,dy:8,referential:"screen"}),m=A.screenRect2world({x:(W=n.value)==null?void 0:W.$el.getBoundingClientRect().x,y:(j=n.value)==null?void 0:j.$el.getBoundingClientRect().y,width:(ae=n.value)==null?void 0:ae.$el.getBoundingClientRect().width,height:(re=n.value)==null?void 0:re.$el.getBoundingClientRect().height,referential:"screen"});et({origin:{x:Math.min(Q.value.width+p.dx,r.x+r.width-m.width-p.dx),y:Math.max(r.y+p.dy,0),referential:"world"},element:(Ae=n==null?void 0:n.value)==null?void 0:Ae.$el,ignoreZoom:!0});const $=A.screenRect2world({x:(Le=oe.value)==null?void 0:Le.$el.getBoundingClientRect().x,y:(Re=oe.value)==null?void 0:Re.$el.getBoundingClientRect().y,width:(kt=oe.value)==null?void 0:kt.$el.getBoundingClientRect().width,height:($t=oe.value)==null?void 0:$t.$el.getBoundingClientRect().height,referential:"screen"});et({origin:{x:0,y:-$.height-p.dy,referential:"world"},element:(Tt=oe==null?void 0:oe.value)==null?void 0:Tt.$el,ignoreZoom:!0})},ds=()=>{var r;(r=s.dashPlayerState.broker)==null||r.send({type:"widgets-changed",state:s.dashPlayerState.apiPageState,dashDefinition:{slot:s.dash.rootSlot}})},ie=F(null);function Xe(r){var j,ae,re,Ae,Le,Re;if(!A||!s.workspace)return;et({origin:{x:0,y:0,referential:"world"},element:(j=a==null?void 0:a.value)==null?void 0:j.$el}),us();const p=r.canvas.getBoundingClientRect();if(r.canvas.width=r.canvas.offsetWidth,r.canvas.height=r.canvas.offsetHeight,r.clearRect(0,0,r.canvas.width,r.canvas.height),r.translate(-p.x,-p.y),r.canvas.style.cursor=(re=(ae=R.value)==null?void 0:ae.cursor(w.value,x))!=null?re:"default",!R.value){requestAnimationFrame(()=>Xe(r));return}const m=de(),$=Yo(m);(!q.exports.isEqual($.operations,(Ae=ie.value)==null?void 0:Ae.operations)||!q.exports.isEqual($.layout,(Le=ie.value)==null?void 0:Le.layout))&&(ie.value=$,s.dashPlayerState.updateRunnerData(s.dash.makeRunnerData(s.workspace,ie.value.layout))),ie.value&&R.value.render({...m,computedState:ie.value,isPreview:Y.isPreview,calculatedPositions:xt(s.dash.makeRunnerData(s.workspace,ie.value.layout).layout.slot,(Re=De.props)!=null?Re:{},Q.value)}),requestAnimationFrame(()=>Xe(r))}s.dashPlayerState.onWidgetsComputedMessage(r=>{var $;const p=Object.keys(s.dashPlayerState.runnerData.layout.slot),m=Object.keys(($=r.props)!=null?$:{});co(p,m)}),qt(()=>{o(),ye=q.exports.cloneDeep(uo(je.value,ne)),De.setInitialEditProps(s.dash.rootSlot),S.setLayoutModel(I),addEventListener("resize",l),addEventListener("copy",f),addEventListener("paste",d),addEventListener("mousemove",v),yt(()=>{C()})}),mt(()=>{removeEventListener("resize",l),removeEventListener("copy",f),removeEventListener("paste",d),removeEventListener("mousemove",v),Ys()});function ps(r){if(!A)return;r.preventDefault();const p=A.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});w.value={...w.value,...p}}const hs=()=>{w.value.state==="IDLE"&&S.resetSelection(),Lt({referential:"screen",x:0,y:0})},Ot=()=>{S.selectedSlottableId?I.delete([S.selectedSlottableId]):I.delete(S.selectedWidgetsIds),S.resetSelection()},fs=r=>{if(ke(r)&&pe(r)){r.preventDefault(),r.stopPropagation();const p=I.redo();if(p){if(p.operations.some(m=>m.op==="remove")){S.resetSelection();return}S.selectedWidgetsIds=[...new Set(p.selection)]}return}else if(ke(r)){r.preventDefault(),r.stopPropagation();const p=I.undo();if(p){if(p.operations.some(m=>m.op==="remove")){S.resetSelection();return}S.selectedWidgetsIds=[...new Set(p.selection)]}return}},Me=(r,p)=>{const[m,$]={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}[p],W=ea(r,m,$);I.operationQueue.execute({name:`move ${p}`,operations:W,selection:r.selectedWidgets})},vs=()=>{Me(de(),"up")},gs=()=>{Me(de(),"down")},ms=()=>{Me(de(),"left")},ys=()=>{Me(de(),"right")},ws=r=>{ke(r)&&(r.preventDefault(),r.stopPropagation(),S.selectAll())};ge(()=>s.dashPlayerState.authenticating,r=>{r&&(Y.isPreview=!0)});const _s=r=>{pe(r)&&u(!Y.isPreview)},Ss=()=>{w.value.state!=="PANNING"&&(w.value.state="START_PANNING")},Es=r=>({escape:()=>hs(),backspace:()=>Ot(),delete:()=>Ot(),z:()=>fs(r),arrowup:()=>vs(),arrowdown:()=>gs(),arrowleft:()=>ms(),arrowright:()=>ys(),a:()=>ws(r),p:()=>_s(r),space:()=>Ss()}),bs=r=>{var p,m;return(m=(p=Es(r))[r.key.toLowerCase().trim()?r.key.toLowerCase():r.code.toLowerCase()])==null?void 0:m.call(p)},Ps=()=>{w.value.state="IDLE"};function Is(){if(w.value.state!=="SELECTING")return null;const{x:r,y:p}=w.value.initialMousePos,{x:m,y:$}=w.value.mousePos;return{x:Math.min(r,m),y:Math.min(p,$),width:Math.abs(r-m),height:Math.abs(p-$),referential:"screen"}}function Ye(){if(!A)throw new Error("No camera value yet");const r=Is();return r?new Set(Object.keys(s.dashPlayerState.widgets).filter(p=>so(A.worldRect2screen(be(s.dashPlayerState.getWidgetPosition(p),Q.value)),r))):new Set}function Os(){return S.selectedWidgetsIds.every(r=>Object.keys(s.dashPlayerState.widgets).includes(r))}const As=()=>Xt(Object.entries(s.dashPlayerState.widgets).filter(([r])=>S.has(r)).map(([r,p])=>be(p.position,Q.value)));function At(){if(!A)throw new Error("No camera value yet");const r=As();return!r||!Os()?[]:Br(S.selectedWidgets,A.worldRect2screen(r))}function Lt(r){w.value={state:"IDLE"},Dt(r)}const Ls=r=>{w.value=w.value,pe(r)?Ye().forEach(p=>{S.toggleWidgetSelection(p)}):(S.resetSelection(),Ye().forEach(p=>{S.addToSelectedWidgets(p)}))};function Rt(r){var m;(m=ie.value)!=null&&m.operations.length&&I.operationQueue.execute({name:"mouse up",operations:ie.value.operations,selection:new Set(S.selectedWidgetsIds)}),w.value.state==="SELECTING"&&Ls(r),w.value.state==="JUST_CLICKED"&&(S.isDashSelected=!1,pe(r)?S.toggleWidgetSelection(w.value.widgetId):(S.clearWidgetSelection(),S.selectedSlottableId=null,S.addToSelectedWidgets(w.value.widgetId))),w.value.state==="JUST_CLICKED_TOGGLE"&&k(w.value.slottable),w.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&(S.isDashSelected=!1,S.selectedSlottableId=w.value.slottableId);const p={x:r.pageX,y:r.pageY,referential:"screen"};Lt(p)}addEventListener("mouseup",Rt);const Rs=r=>{for(const p of At())if(Mt(r,p.rect)){x={state:"HOVERING_RESIZE_HANDLER",side:p.side};return}},Ds=r=>{var m;const p=(m=Object.keys(s.dashPlayerState.widgets).find($=>Mt(A.screenPoint2world(r),be(s.dashPlayerState.getWidgetPosition($),Q.value))))!=null?m:null;p?x={state:"HOVERING_WIDGET",widgetId:p}:x={state:"NONE"}},ks=r=>{const p=ot.getToggleUnderCursor(r);p&&(x={state:"HOVERING_TOGGLE",slottable:p.id})},$s=r=>{const p=ot.getSelectorUnderCursor(r);p&&(x={state:"HOVERING_SLOTTABLE_SELECTOR",slottableId:p.id})},Ts=r=>{const p=ot.getResizerUnderCursor(r);p&&(x={state:"HOVERING_SLOTTABLE_RESIZE_HANDLER",slottableId:p.id})};function Dt(r){!A||(Ds(r),Rs(r),ks(r),$s(r),Ts(r))}const et=r=>{const{origin:p,element:m,ignoreZoom:$}=r;if(!A||!m||!m.style)return;const W=A.worldPoint2screen(p),j=E.value.getBoundingClientRect(),ae=[`translate(${W.x-j.x}px, ${W.y-j.y}px)`,$?null:`scale(${A.zoom})`].filter(re=>re).join(" ");Object.assign(m.style,{transform:ae,transformOrigin:"top left"})};return(r,p)=>(b(),O("div",{class:ce(["dash-layout-editor",{isInactive:e.dashPlayerState.brokerIsClosed}])},[Ie(T(xr,{onDragstart:qe},null,512),[[vt,!g(X)]]),_("div",{ref_key:"editor",ref:P,class:ce(["editor",{isInactive:e.dashPlayerState.brokerIsClosed}]),onDblclick:p[1]||(p[1]=(...m)=>g(S).selectDash&&g(S).selectDash(...m))},[_("div",{ref_key:"listeners",ref:L,class:"listeners",tabindex:"0"},[T(eo,{ref_key:"player",ref:a,class:ce(["player",{preview:g(Y).isPreview},{selected:g(S).isDashSelected}]),style:{top:0,left:0,height:"unset"},"is-preview":!0,params:e.params,camera:g(A),"editing-mode":!g(Y).isPreview,"force-responsivity":"desktop","widgets-with-errors":g(Je),"dash-player-state":e.dashPlayerState,onNavigate:i},null,8,["class","params","camera","editing-mode","widgets-with-errors","dash-player-state"]),_("canvas",{ref_key:"canvas",ref:E,class:ce(["layout-canvas",{hide:g(X)}])},null,2)],512),T(Ir,{ref_key:"runtimeHeader",ref:oe,title:e.dashPlayerState.runnerData.title,path:e.dashPlayerState.runnerData.path,onClick:p[0]||(p[0]=m=>g(S).selectDash())},null,8,["title","path"]),T(_r,{ref_key:"interactMenu",ref:n,class:"interact-menu","is-preview":g(Y).isPreview,onChangePreview:u},null,8,["is-preview"])],34),(g(S).selectedWidgetsIds.length>0||g(S).selectedSlottableId)&&!g(Y).isPreview&&w.value.state==="IDLE"?(b(),he(hr,{key:0,"selected-widget-errors":g(Qe),"layout-model":g(I),"selected-widgets":g(S).selectedSlottable?[g(S).selectedSlottable]:g(S).selectedWidgets,"dash-player-state":e.dashPlayerState,onClose:p[2]||(p[2]=m=>g(S).clearWidgetSelection()),onCreateVariable:c},null,8,["selected-widget-errors","layout-model","selected-widgets","dash-player-state"])):U("",!0),g(S).isDashSelected&&!g(Y).isPreview?(b(),he(Qr,{key:1,runtime:e.dash,"runtime-type":"dash",onClose:p[3]||(p[3]=m=>g(S).isDashSelected=!1)},null,8,["runtime"])):U("",!0),T(ra,{camera:g(A),class:"zoom-bar",onHover:D,onLeave:y},null,8,["camera"])],2))}});const tn=J(en,[["__scopeId","data-v-b271b3a1"]]),sn={class:"dash-editor"},on=Z({__name:"DashEditor",setup(e){const t=Zs(),s=G(()=>{var y,R,I,X;return(R=(y=d.value)==null?void 0:y.broker)==null||R.observable.observe(),((X=(I=d.value)==null?void 0:I.broker)==null?void 0:X.state)==="RUNNING"}),{result:o}=Bt(()=>ho.get()),a=({id:y,type:R})=>{R==="dash"?(t.push({name:"dashEditor",params:{dashId:y},query:i.query}),l()):t.push({name:"editor",params:{formId:y},query:i.query})},n=()=>{var y;!((y=u.value)!=null&&y.path)||t.push(`/_editor/dash/${encodeURIComponent(u.value.path)}/preview`)},i=Js(),{loading:c,result:u,refetch:l}=Bt(()=>po.get(i.params.dashPath)),v=y=>{Y.isPreview=y},f=y=>{var R;return(R=u.value)==null?void 0:R.addVariableToCode(y)};let d=js(null);const h=()=>{var y;if(!(!u.value||!o.value)){if(u.value.path===((y=d.value)==null?void 0:y.runnerData.path)){d.value.updateDashData(u.value.makeRunnerData(o.value));return}d.value=Wt.create(u.value.makeRunnerData(o.value),!0),d.value.onRedirect(({url:R,queryParams:I})=>xs(t,R,I))}},D=()=>{var y;!d.value||(y=d.value)==null||y.resetState()};return ge(u,h),mt(()=>{var y;!u.value||!o.value||Wt.delete((y=u.value)==null?void 0:y.makeRunnerData(o.value).idOrPath)}),(y,R)=>{const I=Oe("icon");return b(),O("div",sn,[g(c)||!g(u)||!g(o)?(b(),he(ro,{key:0,class:"loading",justify:"center"})):(b(),he(Ms,{key:1},{left:we(()=>[T(Ws,{link:"/_editor/dashes"})]),right:we(()=>[_("button",{class:"preview-button",onClick:n},[T(I,{class:"icon",path:g(Qt),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),Be(" Preview ")]),T(fo,{model:g(u)},null,8,["model"])]),default:we(()=>[T(Ct,{title:"Layout editor"},{default:we(()=>[g(d)?(b(),he(tn,{key:0,workspace:g(o),class:ce({"not-running":!g(s)}),dash:g(u),"dash-player-state":g(d),params:g(i).query,onNavigate:a,onChangePreview:v,onCreateVariable:f},null,8,["workspace","class","dash","dash-player-state","params"])):U("",!0)]),_:1}),T(Ct,{title:"Settings"},{default:we(()=>[T(_o,{dash:g(u)},null,8,["dash"])]),_:1})]),_:1})),g(u)?(b(),he(ao,{key:2,"dash-player-state":g(d)||void 0,runtime:"dashes",onRestart:D},null,8,["dash-player-state"])):U("",!0)])}}});const Pn=J(on,[["__scopeId","data-v-8892d38c"]]);export{Pn as default};
//# sourceMappingURL=DashEditor.283fdca3.js.map

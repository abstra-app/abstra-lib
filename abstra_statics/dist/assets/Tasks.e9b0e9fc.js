import{f as s,ex as W,d as R,c as N,X,W as Y,ac as U,b as l,u as e,aY as E,o as p,cE as O,i as d,aI as M,cD as G,a as m,df as A,g as y,t as f,eI as Q,bT as Z,dj as D,eD as K,dd as ee,d6 as te,eJ as ae,h as F,S as ne,d0 as le,cM as se,eA as re,A as oe}from"./jwt-decode.esm.a6723498.js";import{_ as ie}from"./AbstraButton.vue_vue_type_script_setup_true_lang.052b0ab3.js";import{I as ue}from"./PhCopy.vue.d2d06834.js";import{T as ce,R as de}from"./tasksController.29c7761b.js";import{s as pe}from"./metadata.2b8eedea.js";import{t as ge}from"./ant-design.e466d69a.js";import{R as fe}from"./dayjs.863dbddf.js";import{g as L,a as I}from"./router.cc3a61f0.js";import{A as P}from"./index.d0bf3570.js";import{a as me,B as _e}from"./build.d297a390.js";import{a as ye}from"./project.d831e9de.js";import"./tables.10e48acd.js";import{a as be}from"./asyncComputed.1f5dec2d.js";import"./contracts.generated.d9f015d9.js";import"./record.5e31b608.js";import"./linters.cbd6e4b3.js";import"./polling.235055c7.js";import"./PhWebhooksLogo.vue.e32e7637.js";import"./ts.worker.6fb5ea06.js";import"./string.0fcb2f7e.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[i]="659564b6-0130-4919-8e52-2cc03387b421",u._sentryDebugIdIdentifier="sentry-dbid-659564b6-0130-4919-8e52-2cc03387b421")}catch{}})();var we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const ve=we;function B(u){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?Object(arguments[i]):{},b=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(o).filter(function(w){return Object.getOwnPropertyDescriptor(o,w).enumerable}))),b.forEach(function(w){Se(u,w,o[w])})}return u}function Se(u,i,o){return i in u?Object.defineProperty(u,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):u[i]=o,u}var $=function(i,o){var b=B({},i,o.attrs);return s(W,B({},b,{icon:ve}),null)};$.displayName="SyncOutlined";$.inheritAttrs=!1;const he=$,Te=R({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean},stageId:{},status:{}},setup(u,{expose:i}){const o=u,{setup:b,tearDown:w,state:c,getColumns:S,fetchTasks:x,clearAllTasks:v,updateStatus:h}=ce({api:o.api,poll:!0,stages:o.stages,stageId:o.stageId,status:o.status}),C=(t,n)=>!(n!=null&&n.label)||typeof n.label!="string"?!1:n.label.toLowerCase().includes(t.toLowerCase()),T=t=>{var a,g;if(!((a=t.completed)!=null&&a.at)||!((g=t.created)!=null&&g.at))return null;const n=new Date(t.created.at).getTime(),r=new Date(t.completed.at).getTime();return Math.round((r-n)/1e3)},k=t=>{var a;if(!((a=t.created)!=null&&a.at))return null;const n=new Date(t.created.at).getTime(),r=Date.now();return Math.round((r-n)/1e3)},z=t=>{if(t<60)return`${t}s`;const n=Math.floor(t/60);if(n<60){const _=t%60;return _>0?`${n}m ${_}s`:`${n}m`}const r=Math.floor(n/60);if(r<24){const _=n%60;return _>0?`${r}h ${_}m`:`${r}h`}const a=Math.floor(r/24),g=r%24;return g>0?`${a}d ${g}h`:`${a}d`},V=N(()=>o.stages?c.tasks.map(t=>{var r,a,g;const n=(r=o.stages)==null?void 0:r.find(_=>_.id===t.targetStageId);return n?{...t,targetStageTitle:n.stageTitle,targetStageType:n.stageType,completedAt:(g=t.completed)!=null&&g.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1,duration:T(t),pendingDuration:k(t)}:{...t,targetStageTitle:null,targetStageType:null,completedAt:(a=t.completed)!=null&&a.at?new Date(t.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),deleted:!0,duration:T(t),pendingDuration:k(t)}}):c.tasks.map(t=>{var n;return{...t,deleted:!1,completedAt:(n=t.completed)!=null&&n.at?new Date(t.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),duration:T(t),pendingDuration:k(t)}})),J=(t,n,r)=>{var _,j;const a=(_=t.current)!=null?_:1,g=(j=t.pageSize)!=null?j:10;c.pagination.currentIndex=a-1,c.pagination.pageSize=g,x()},q=(t,n)=>`/_editor/${t}/${n}`,H=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),se.success({content:d.translate("i18n_tasksview_copied_to_clipboard")})};return i({clearAllTasks:v}),X(()=>b()),Y(()=>w()),(t,n)=>(p(),U(E,null,[s(e(G),{layout:"vertical"},{default:l(()=>[s(e(L),{gutter:10},{default:l(()=>[s(e(I),{span:6},{default:l(()=>[s(e(O),{label:e(d).translate("i18n_tasksview_status_label")},{default:l(()=>[s(e(M),{value:e(c).filters.status,"onUpdate:value":n[0]||(n[0]=r=>e(c).filters.status=r),options:e(c).filterOptions.statuses,"option-label":"label","option-value":"value","show-search":"",filter:!1,placeholder:e(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(e(I),{span:10},{default:l(()=>[s(e(O),{label:e(d).translate("i18n_tasksview_stage_label")},{default:l(()=>[s(e(M),{value:e(c).filters.stage,"onUpdate:value":n[1]||(n[1]=r=>e(c).filters.stage=r),"show-search":"","filter-option":C,options:e(c).filterOptions.stages,placeholder:e(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(e(I),{span:8},{default:l(()=>[s(e(O),{label:e(d).translate("i18n_tasksview_created_at_date_label")},{default:l(()=>[s(e(fe),{value:e(c).filters.dateRange,"onUpdate:value":n[2]||(n[2]=r=>e(c).filters.dateRange=r),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),s(e(le),{columns:e(S)(),"data-source":V.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(c).pagination.currentIndex+1,pageSize:e(c).pagination.pageSize,total:e(c).pagination.totalCount},onChange:J},{bodyCell:l(({column:r,record:a})=>[r.key==="timeInfo"?(p(),m(e(D),{key:0,vertical:"",gap:4},{default:l(()=>[s(e(A),null,{default:l(()=>[y(f(a.createdAt),1)]),_:2},1024),a.status==="locked"?(p(),m(e(P),{key:0,type:"info"},{message:l(()=>[y(f(e(d).translate("i18n_tasksview_status_running")),1)]),default:l(()=>[s(e(he),{spin:!0,style:{"margin-left":"4px"}})]),_:1})):(p(),m(e(P),{key:1,type:a.status==="pending"?"warning":"success"},Q({action:l(()=>[s(e(Z),{size:"small",checked:a.status==="completed","onUpdate:checked":g=>e(h)(a,a.status==="pending"?"completed":"pending")},null,8,["checked","onUpdate:checked"])]),_:2},[a.status==="pending"?{name:"message",fn:l(()=>[y(f(e(d).translate("i18n_tasksview_pending_for"))+" "+f(z(a.pendingDuration)),1)]),key:"0"}:a.status==="completed"?{name:"message",fn:l(()=>[y(f(e(d).translate("i18n_tasksview_completed_in"))+" "+f(z(a.duration)),1)]),key:"1"}:void 0]),1032,["type"]))]),_:2},1024)):r.key==="stageInfo"?(p(),m(e(D),{key:1,vertical:"",gap:4},{default:l(()=>[a.deleted?(p(),m(e(A),{key:0},{default:l(()=>[y(f(e(d).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),m(e(D),{key:1,gap:8,align:"center"},{default:l(()=>[(p(),m(K(e(pe)(a.targetStageType)),{size:20})),s(e(D),{vertical:"",gap:0},{default:l(()=>[u.editor?(p(),m(e(ee),{key:0,href:q(a.targetStageType,a.targetStageId)},{default:l(()=>[y(f(a.targetStageTitle),1)]),_:2},1032,["href"])):(p(),m(e(A),{key:1},{default:l(()=>[y(f(a.targetStageTitle),1)]),_:2},1024)),s(e(A),{type:"secondary",style:{fontSize:"12px"}},{default:l(()=>[y(f(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024)):r.key==="payloadInfo"?(p(),m(e(D),{key:2,gap:8,align:"start",justify:"space-between"},{default:l(()=>[s(e(te),{"tree-data":e(ge)(a.payload),selectable:!1,style:{flex:"1"}},null,8,["tree-data"]),s(ie,{type:"text",size:"small",tooltip:e(d).translate("i18n_tasksview_copy_payload_tooltip"),onClick:ae(g=>H(a.payload),["stop"])},{default:l(()=>[s(e(ue))]),_:1},8,["tooltip","onClick"])]),_:2},1024)):F("",!0)]),footer:l(()=>[s(e(L),{justify:"end",gutter:10},{default:l(()=>[s(e(I),null,{default:l(()=>[s(e(ne),{size:"small"})]),_:1}),s(e(I),null,{default:l(()=>[s(e(A),null,{default:l(()=>[y(f(e(d).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Je=R({__name:"Tasks",setup(u){const i=re(),o=i.params.projectId,b=i.query.stage,w=i.query.status,c=new de(o),{result:S}=be(async()=>{const h=(await me.list(o)).find(k=>k.latest);if(!h)return null;const[C,T]=await Promise.all([_e.get(h.id),ye.get(o)]);return{buildSpec:C,project:T}}),x=N(()=>!S.value||!S.value.buildSpec?null:S.value.buildSpec.runtimes.map(v=>({id:v.id,stageTitle:v.title,stageType:v.type})));return(v,h)=>(p(),U(E,null,[s(e(oe),null,{default:l(()=>[y(f(e(d).translate("i18n_tasksview_title")),1)]),_:1}),x.value?(p(),m(Te,{key:0,class:"tasks",api:e(c),stages:x.value,"stage-id":e(b),status:e(w)},null,8,["api","stages","stage-id","status"])):F("",!0)],64))}});export{Je as default};
//# sourceMappingURL=Tasks.e9b0e9fc.js.map

var h=Object.defineProperty;var m=(s,e,t)=>e in s?h(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var p=(s,e,t)=>(m(s,typeof e!="symbol"?e+"":e,t),t);import{E as b}from"./record.ed1b75ef.js";import{C as u}from"./index.deb8cd66.js";import{n as l}from"./string.1d0e243b.js";import{C as a}from"./router.5f815d47.js";import"./outputWidgets.6a7b2974.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="bcc20d4d-14ef-4d7a-ae86-05aafa2b5ff1",s._sentryDebugIdIdentifier="sentry-dbid-bcc20d4d-14ef-4d7a-ae86-05aafa2b5ff1")}catch{}})();const C=["varchar","int","boolean","json","date","timestamp","uuid"],D={varchar:"'DEFAULT_VALUE'",int:"42",boolean:"false",json:"'{}'::json",date:"now()",timestamp:"now()",uuid:"gen_random_uuid()"};class f{async list(e){return a.get(`projects/${e}/tables`)}async create(e,t){return await a.post(`projects/${e.projectId}/tables`,t)}async get(e){return a.get(`projects/${e.projectId}/tables/${e.tableId}`)}async delete(e){return a.delete(`projects/${e.projectId}/tables/${e.tableId}`)}async selectRows(e){return a.get(`projects/${e.projectId}/tables/${e.tableId}/rows`,{limit:e.limit.toString(),offset:e.offset.toString(),search:e.search})}async update(e,t){return a.patch(`projects/${e.projectId}/tables/${e.tableId}`,t)}async insertRow(e,t){return a.post(`projects/${e.projectId}/tables/${e.tableId}/rows`,t)}async updateRow(e,t){return a.patch(`projects/${e.projectId}/tables/${e.tableId}/rows/${e.rowId}`,t)}async deleteRow(e){return a.delete(`projects/${e.projectId}/tables/${e.tableId}/rows/${e.rowId}`)}async getByColumnID(e){return a.get(`projects/${e.projectId}/columns/${e.columnId}`)}}const n=new f;class d{constructor(e,t=null){p(this,"record");p(this,"columns");this.record=b.from(e),this.columns=t}static async list(e){return(await n.list(e)).map(r=>new d(r))}static async fromColumnId(e,t){const r=await n.getByColumnID({projectId:e,columnId:t});return d.get(e,r.table.id)}static async create(e,t){const r=l(t,!1),o=await n.create({projectId:e},{name:r});return new d(o.table,o.columns.map(c=>u.fromDTO(c)))}static async get(e,t){const r=await n.get({projectId:e,tableId:t}),o=r.table,i=r.columns.map(c=>u.fromDTO({...c,projectId:o.projectId}));return new d(o,i)}async delete(e,t){return n.delete({projectId:e,tableId:t})}fixTraillingName(){this.name=l(this.name,!1)}async save(){if(Object.keys(this.record.changes).length!==0){this.record.changes.name&&this.fixTraillingName();try{await n.update({id:this.id,tableId:this.id,projectId:this.projectId},this.record.changes)}finally{this.record.resetChanges()}}}resetChanges(){this.record.resetChanges()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(){return this.record.hasChanges()}hasChangesDeep(e){return this.record.hasChangesDeep(e)&&l(this.name,!1)!==this.record.initialState.name}getColumns(){var e;return(e=this.columns)!=null?e:[]}getUnprotectedColumns(){var e,t;return(t=(e=this.columns)==null?void 0:e.filter(r=>!r.protected).map(r=>r.toDTO()))!=null?t:[]}get id(){return this.record.get("id")}get name(){return this.record.get("name")}set name(e){const t=l(e,!0);this.record.set("name",t)}get projectId(){return this.record.get("projectId")}async addColumn(e){const t=await u.create(e.name,e.type,e.default,e.nullable,e.unique,this.id,this.projectId,e.foreignKey);return"error"in t?{success:!1,error:t.error}:this.columns?(this.columns.push(t),{success:!0,error:""}):(this.columns=[t],{success:!0,error:""})}getColumn(e){var t;return(t=this.columns)==null?void 0:t.find(r=>r.id&&r.id===e)}async select(e={},t,r,o){const i=Object.keys(e).map(c=>`${c} = :${c}`).join(" AND ");return n.selectRows({name:this.name,where:i,params:e,tableId:this.id,projectId:this.projectId,limit:r,offset:t,search:o})}async insertRow(e){return n.insertRow({tableId:this.id,projectId:this.projectId},e)}async updateRow(e,t){return n.updateRow({tableId:this.id,projectId:this.projectId,rowId:e},t)}async deleteRow(e){return n.deleteRow({tableId:this.id,projectId:this.projectId,rowId:e})}}export{d as T,D as d,C as p};
//# sourceMappingURL=tables.f8995d6b.js.map

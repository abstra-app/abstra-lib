import{a as X}from"./asyncComputed.ded4e064.js";import{d as F,r as L,G as Y,ex as ue,F as z,a as s,b as d,c as y,e,eq as t,bw as j,bh as D,eA as P,er as c,ez as Z,bu as v,dm as ee,p as te,eB as ae,eC as ne,e8 as de,t as J,E as oe,eu as U,u as V,ep as _e,ey as pe}from"./registerWidgets.fbede4e9.js";import{T as me,a as H}from"./Tab.999a25bb.js";import{B as be}from"./BackButton.a6b30b4d.js";import{n as fe}from"./index.1acdc6c8.js";import{L as ve}from"./CircularLoading.1684a417.js";import{b as ye,O as ge}from"./icons.9ea484f9.js";import{T as he}from"./tables.a3bc3af7.js";import"./lottie.af5deb23.js";import"./gateway.6dfda10a.js";import"./passwordlessManager.fc9080ef.js";import"./pubsub.9639d873.js";import"./storage.953471f2.js";import"./activeRecord.4cd28aae.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_=new Error().stack;_&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[_]="18e6cbc4-919d-4c74-b598-bad7310c78cc",u._sentryDebugIdIdentifier="sentry-dbid-18e6cbc4-919d-4c74-b598-bad7310c78cc")}catch{}})();const le=u=>(ae("data-v-3ecc1cb1"),u=u(),ne(),u),ke={class:"table-settings"},Ce={key:0},we=le(()=>c("span",null," protected ",-1)),De=[we],xe={key:1},Ie=["onClick"],Te=le(()=>c("a",null,"Delete",-1)),$e=F({__name:"TableColumns",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(u,{emit:_}){var K;const n=u,l=r=>{de.error({message:"Database error",description:r})},h=L(n.loading);Y(()=>n.loading,()=>{h.value=n.loading});const k=["varchar","int","boolean","json","date","timestamp","uuid"],x=ue();(K=n.table)==null||K.onUpdate(()=>{var r;x.replace({name:"tableEditor",params:{tableName:(r=n.table)==null?void 0:r.name}})});const i=[...[{title:"Name",dataIndex:"name"},{title:"Type",dataIndex:"type"},{title:"Default Value",dataIndex:"default"},{title:"Nullable",dataIndex:"nullable"},{title:"Primary Key",dataIndex:"primaryKey"}],{title:"Actions",key:"action"}],o=L({name:"",type:"",nullable:!0,unique:!1}),I=()=>{o.value={name:"",type:"",nullable:!0,unique:!1}},S=z(()=>{var r;return(r=n.table)==null?void 0:r.getColumns().map(a=>({name:a.name,type:a.type,default:a.default,nullable:a.nullable,primaryKey:a.primaryKey,id:a.id,unique:a.unique}))}),m=L(!1),N=()=>{m.value=!0},E=()=>{m.value=!1};function B(r){var a,p;(p=(a=n.table)==null?void 0:a.getColumn(r))==null||p.delete(),h.value=!0,setTimeout(()=>{_("refresh")},2e3)}async function b(){var r;if(!!n.table&&!(!o.value.name||!o.value.type)){if(o.value.id){const a=(r=n.table)==null?void 0:r.getColumn(o.value.id);if(!a)return;const{success:p,error:T}=await a.update(o.value);p||l(T)}else{const{success:a,error:p}=await n.table.addColumn(o.value);a||l(p)}I(),h.value=!0,E(),setTimeout(()=>{_("refresh")},2e3)}}const f=r=>{var a,p,T;return(T=(p=(a=n.table)==null?void 0:a.getColumn(r))==null?void 0:p.protected)!=null?T:!1},C=r=>{var p;const a=te.exports.cloneDeep((p=S.value)==null?void 0:p.filter(T=>T.id===r));!a||(o.value=a[0],N())};return(r,a)=>{const p=s("a-divider"),T=s("a-popconfirm"),q=s("a-button"),M=s("a-table"),G=s("a-input"),w=s("a-form-item"),A=s("a-select-option"),O=s("a-select"),R=s("a-switch"),se=s("a-form"),ie=s("a-space"),re=s("a-drawer");return d(),y("div",ke,[e(v(ee),{theme:{token:{colorPrimary:"#D14056",colorLink:"#D14056"}}},{default:t(()=>[e(M,{columns:i,"data-source":S.value,bordered:"",loading:h.value,pagination:!1},{bodyCell:t(({column:g,text:ce,record:W})=>[g.key!=="action"?(d(),y(j,{key:0},[D(P(ce),1)],64)):(d(),y(j,{key:1},[f(W.id)?(d(),y("div",Ce,De)):(d(),y("div",xe,[c("span",null,[c("a",{onClick:()=>C(W.id)},"Edit",8,Ie)]),e(p,{type:"vertical"}),e(T,{title:"Sure to delete?",onConfirm:Ze=>B(W.id)},{default:t(()=>[Te]),_:2},1032,["onConfirm"])]))],64))]),footer:t(()=>[e(q,{type:"primary",onClick:N},{default:t(()=>[D("+ Add New Column")]),_:1})]),_:1},8,["data-source","loading"]),e(re,{title:"Column",width:720,open:m.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:E},{extra:t(()=>[e(ie,null,{default:t(()=>[e(q,{onClick:E},{default:t(()=>[D("Cancel")]),_:1}),e(q,{type:"primary",onClick:b},{default:t(()=>[D("Submit")]),_:1})]),_:1})]),default:t(()=>[e(se,{model:o.value,layout:"vertical"},{default:t(()=>[e(w,{key:"name",label:"Name"},{default:t(()=>[e(G,{value:o.value.name,"onUpdate:value":a[0]||(a[0]=g=>o.value.name=g)},null,8,["value"])]),_:1}),e(w,{key:"type",label:"Type"},{default:t(()=>[e(O,{value:o.value.type,"onUpdate:value":a[1]||(a[1]=g=>o.value.type=g),"default-active-first-option":""},{default:t(()=>[(d(),y(j,null,Z(k,g=>e(A,{key:g,value:g},{default:t(()=>[D(P(g),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),e(w,{key:"nullable",label:"Nullable"},{default:t(()=>[e(R,{checked:o.value.nullable,"onUpdate:checked":a[2]||(a[2]=g=>o.value.nullable=g)},null,8,["checked"])]),_:1}),e(w,{key:"unique",label:"Unique"},{default:t(()=>[e(R,{checked:o.value.unique,"onUpdate:checked":a[3]||(a[3]=g=>o.value.unique=g)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})])}}});const Ne=J($e,[["__scopeId","data-v-3ecc1cb1"]]),Q=u=>(ae("data-v-ae548358"),u=u(),ne(),u),Ee={class:"table-settings"},Se=Q(()=>c("h2",{class:"title"},"Table settings",-1)),Be=Q(()=>c("div",{class:"subtitle"},"Edit table metadata",-1)),Re={key:0,class:"table-presenter"},Ue={class:"table-property-item"},qe={class:"property-item"},Ae={key:1},Le={class:"change-warning"},je={class:"section-title"},Pe=Q(()=>c("div",{class:"section-body"}," Changing the table's name can possibly result in the break of running applications. ",-1)),Ve={class:"input-section"},Ke={class:"table-name-value-input"},Oe=["value"],ze={key:0,class:"error"},Fe={class:"option-buttons"},Me=F({__name:"TableSettings",props:{table:{}},emits:["refresh"],setup(u,{emit:_}){var I,S;const n=u,l=oe({name:(S=(I=n.table)==null?void 0:I.name)!=null?S:"",error:"",editing:!1,loading:!1}),h=()=>l.editing=!0,k=()=>{i(),l.editing=!1,l.error=""},x=async()=>{l.error="",l.loading=!0,await $(),l.error||(l.editing=!1),l.loading=!1},$=async()=>{if(!(!n.table||n.table.name===l.name)){if(!l.name){l.error="Table name cannot be empty";return}n.table.name=l.name,await n.table.save(),_("refresh")}},i=()=>{var m,N;return l.name=(N=(m=n.table)==null?void 0:m.name)!=null?N:""},o=m=>{l.name=fe(m.target.value,{replacement:"-",lower:!0,strict:!0})};return Y(()=>{var m;return(m=n.table)==null?void 0:m.name},()=>i()),(m,N)=>{var B;const E=s("icon");return d(),y("div",Ee,[Se,Be,l.editing?(d(),y("div",Ae,[c("div",Le,[c("div",je,[e(E,{path:v(ye),width:"12",height:"12",fill:"#D35249"},null,8,["path"]),D(" Be careful ")]),Pe]),c("div",Ve,[c("div",Ke,[c("input",{value:l.name,type:"text",onInput:o},null,40,Oe)]),l.error?(d(),y("div",ze,[e(E,{path:v(ge),fill:"#D35249",width:"12",height:"12"},null,8,["path"]),D(" "+P(l.error),1)])):U("",!0),c("div",Fe,[c("button",{class:"cancel-button",onClick:k},"Cancel"),c("button",{class:"save-button",onClick:x},[D(" Save Changes "),l.loading?(d(),V(ve,{key:0,size:"16"})):U("",!0)])])])])):(d(),y("div",Re,[c("div",Ue,[c("div",qe,"Name: "+P((B=m.table)==null?void 0:B.name),1)]),c("button",{onClick:h},"Edit Name")]))])}}});const Ge=J(Me,[["__scopeId","data-v-ae548358"]]),We={class:"table-data"},He={key:1},Je=["onClick"],Qe=c("a",null,"Delete",-1),Xe=F({__name:"TableData",props:{table:{}},setup(u){var B;const _=u,{result:n,loading:l,refetch:h}=X(()=>_.table.select()),k=z(()=>{var f;return[...(f=_.table)==null?void 0:f.getColumns().map(C=>({title:C.name,dataIndex:C.name})),{title:"Actions",key:"action",fixed:"right",width:100,align:"center"}]}),x=z(()=>{var b;return((b=n.value)==null?void 0:b.map(f=>({key:f.id,...f})))||[]}),$=L(!1),i=L({}),o=()=>{$.value=!0},I=()=>{i.value={},$.value=!1};let S=oe((B=_.table)==null?void 0:B.getUnprotectedColumns().reduce((b,f)=>({...b,[f.name]:""}),{}));async function m(){if(!(!_.table||!S)){if(i.value.id){await _.table.updateRow(i.value.id,i.value),h(),i.value={};return}await _.table.insertRow(i.value),i.value={},h(),I()}}const N=async b=>{!n.value||!n.value.find(C=>C.id===b)||(await _.table.deleteRow(b),h())},E=b=>{var f;i.value=_e.pick(te.exports.cloneDeep((f=x.value)==null?void 0:f.filter(C=>b===C.key)[0]),_.table.getColumns().map(C=>C.name)),o()};return(b,f)=>{const C=s("a-divider"),K=s("a-popconfirm"),r=s("a-button"),a=s("a-table"),p=s("a-input"),T=s("a-form-item"),q=s("a-form"),M=s("a-space"),G=s("a-drawer");return d(),y("div",We,[e(v(ee),{theme:{token:{colorPrimary:"#D14056",colorLink:"#D14056"}}},{default:t(()=>[e(a,{columns:k.value,"data-source":x.value,bordered:"",loading:v(l),scroll:{x:2e3,y:720}},{bodyCell:t(({column:w,text:A,record:O})=>[k.value.map(R=>R.title).includes(w.dataIndex)?(d(),y(j,{key:0},[D(P(A),1)],64)):U("",!0),w.key==="action"?(d(),y("div",He,[c("span",null,[c("a",{onClick:R=>E(O.id)},"Edit",8,Je)]),e(C,{type:"vertical"}),e(K,{title:"Sure to delete?",onConfirm:R=>N(O.id)},{default:t(()=>[Qe]),_:2},1032,["onConfirm"])])):U("",!0)]),footer:t(()=>[e(r,{type:"primary",onClick:o},{default:t(()=>[D("+ Add New Data")]),_:1})]),_:1},8,["columns","data-source","loading"]),e(G,{title:"Data",width:720,open:$.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:I},{extra:t(()=>[e(M,null,{default:t(()=>[e(r,{onClick:I},{default:t(()=>[D("Cancel")]),_:1}),e(r,{type:"primary",onClick:m},{default:t(()=>[D("Submit")]),_:1})]),_:1})]),default:t(()=>[e(q,{model:i.value,layout:"vertical"},{default:t(()=>[(d(!0),y(j,null,Z(b.table.getUnprotectedColumns(),w=>(d(),V(T,{key:w.id,label:w.name},{default:t(()=>[i.value?(d(),V(p,{key:0,value:i.value[w.name],"onUpdate:value":A=>i.value[w.name]=A},null,8,["value","onUpdate:value"])):U("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})])}}});const Ye=F({__name:"TableEditor",setup(u){const _=z(()=>{var i;return`/projects/${(i=k.value)==null?void 0:i.projectId}/tables`}),n=pe(),l=n.params.tableId,h=n.params.projectId,{result:k,loading:x,refetch:$}=X(()=>he.get(h,l));return(i,o)=>(d(),V(me,{class:"editor"},{left:t(()=>[e(be,{link:_.value},null,8,["link"])]),right:t(()=>[]),default:t(()=>[e(H,{title:"Data"},{default:t(()=>[v(k)?(d(),V(Xe,{key:0,loading:v(x),table:v(k)},null,8,["loading","table"])):U("",!0)]),_:1}),e(H,{title:"Columns"},{default:t(()=>[e(Ne,{table:v(k),loading:v(x),onRefresh:o[0]||(o[0]=I=>v($)())},null,8,["table","loading"])]),_:1}),e(H,{title:"Settings"},{default:t(()=>[e(Ge,{table:v(k),loading:v(x),onRefresh:o[1]||(o[1]=I=>v($)())},null,8,["table","loading"])]),_:1})]),_:1}))}});const mt=J(Ye,[["__scopeId","data-v-f565d979"]]);export{mt as default};
//# sourceMappingURL=TableEditor.7eca499e.js.map

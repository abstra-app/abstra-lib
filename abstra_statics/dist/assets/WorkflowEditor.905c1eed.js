var ct=Object.defineProperty;var pt=(o,e,n)=>e in o?ct(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var Se=(o,e,n)=>(pt(o,typeof e!="symbol"?e+"":e,n),n);import{g as gt,W as ft,w as vt}from"./controller.929aa99f.js";import{o as ie,u as mt}from"./omniChatStore.3474fda6.js";import{a as De}from"./asyncComputed.fe6ca61b.js";import{d as N,af as q,g as M,o as a,K as h,O as j,F as I,e5 as ke,a as S,e as yt,f as D,b as d,w as r,u as t,aL as X,ea as ce,c as w,da as K,d5 as ee,az as V,eb as Z,d3 as Re,eh as G,cH as ht,bM as fe,Q as se,h as we,bu as Ie,aP as Ye,ec as ze,N as te,J as _e,a8 as Fe,bE as ve,cs as ye,cr as Xe,cE as We,ex as kt,B as re,ei as Ge,bs as wt,bq as Ue,bK as _t,au as Me,e3 as bt,d2 as $t,bH as Ct,eL as At,eM as St,el as It,aj as Mt,em as Dt,en as xt}from"./index.6b1213c6.js";import{u as J,P as Et,_ as zt,a as Ft,b as Bt,g as qe,c as pe,N as Vt,d as Ht,M as Tt,e as Pt}from"./vue-flow-core.ab5c79cf.js";import"./linters.caf56568.js";import{W as ge}from"./workspaces.1557b2ee.js";import{U as Lt,G as Nt}from"./UnsavedChangesHandler.2bc8785e.js";import{w as he,s as jt}from"./metadata.bd4debbe.js";import{A as Ut}from"./index.4176e63d.js";import{A as xe}from"./index.525c9059.js";import{_ as Zt,a as Ot}from"./vue-flow-minimap.1fdcd987.js";import{G as Rt}from"./PhArrowCounterClockwise.vue.c41aa07c.js";import{T as Yt}from"./TasksManager.b3504e10.js";import{a as Xt,b as Wt,n as Gt}from"./validations.fc2b95fa.js";import{u as qt}from"./editor.3928d6cb.js";import{n as Kt}from"./string.8a712bbd.js";import{u as Jt,C as Qt}from"./useCodebase.f402bfd7.js";import"./index.0af6ec2a.js";import{A as ea}from"./index.bf9bb248.js";import{t as Ke}from"./index.edcfcfeb.js";import{B as ta}from"./Badge.591ea564.js";import{G as Ze}from"./PhArrowDown.vue.c5a58a1a.js";import"./uuid.b638d083.js";import"./record.9f32285a.js";import"./runnerData.f49521d9.js";import"./url.16d95866.js";import"./colorHelpers.59418473.js";import"./ExclamationCircleOutlined.e92280ca.js";import"./PhWebhooksLogo.vue.496527e8.js";import"./tasksController.7f537028.js";import"./gateway.d1bcadc7.js";import"./popupNotifcation.97dc9547.js";import"./scripts.7f0663fc.js";import"./polling.32ed3bad.js";import"./ant-design.d006a6d7.js";import"./PhArrowSquareOut.vue.7aebffb0.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.26e45286.js";import"./Card.e2c03a6d.js";import"./TabPane.49a7fa43.js";import"./CollapsePanel.b77f7bb6.js";import"./userStore.c0cb42b5.js";import"./workspaceStore.436b122e.js";import"./files.b924b280.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="80300973-761a-4dd7-9684-c6c161800052",o._sentryDebugIdIdentifier="sentry-dbid-80300973-761a-4dd7-9684-c6c161800052")}catch{}})();const aa=["width","height","fill","transform"],oa={key:0},sa=S("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),na=[sa],la={key:1},ia=S("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),ra=S("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ua=[ia,ra],da={key:2},ca=S("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),pa=[ca],ga={key:3},fa=S("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),va=[fa],ma={key:4},ya=S("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ha=[ya],ka={key:5},wa=S("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),_a=[wa],ba={name:"PhArrowClockwise"},$a=N({...ba,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(o){const e=o,n=q("weight","regular"),s=q("size","1em"),u=q("color","currentColor"),m=q("mirrored",!1),p=M(()=>{var i;return(i=e.weight)!=null?i:n}),k=M(()=>{var i;return(i=e.size)!=null?i:s}),_=M(()=>{var i;return(i=e.color)!=null?i:u}),c=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:m?"scale(-1, 1)":void 0);return(i,g)=>(a(),h("svg",ke({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:_.value,transform:c.value},i.$attrs),[j(i.$slots,"default"),p.value==="bold"?(a(),h("g",oa,na)):p.value==="duotone"?(a(),h("g",la,ua)):p.value==="fill"?(a(),h("g",da,pa)):p.value==="light"?(a(),h("g",ga,va)):p.value==="regular"?(a(),h("g",ma,ha)):p.value==="thin"?(a(),h("g",ka,_a)):I("",!0)],16,aa))}}),Ca=["width","height","fill","transform"],Aa={key:0},Sa=S("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),Ia=[Sa],Ma={key:1},Da=S("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),xa=S("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ea=[Da,xa],za={key:2},Fa=S("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),Ba=[Fa],Va={key:3},Ha=S("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Ta=[Ha],Pa={key:4},La=S("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Na=[La],ja={key:5},Ua=S("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Za=[Ua],Oa={name:"PhFunnel"},Ra=N({...Oa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(o){const e=o,n=q("weight","regular"),s=q("size","1em"),u=q("color","currentColor"),m=q("mirrored",!1),p=M(()=>{var i;return(i=e.weight)!=null?i:n}),k=M(()=>{var i;return(i=e.size)!=null?i:s}),_=M(()=>{var i;return(i=e.color)!=null?i:u}),c=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:m?"scale(-1, 1)":void 0);return(i,g)=>(a(),h("svg",ke({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:_.value,transform:c.value},i.$attrs),[j(i.$slots,"default"),p.value==="bold"?(a(),h("g",Aa,Ia)):p.value==="duotone"?(a(),h("g",Ma,Ea)):p.value==="fill"?(a(),h("g",za,Ba)):p.value==="light"?(a(),h("g",Va,Ta)):p.value==="regular"?(a(),h("g",Pa,Na)):p.value==="thin"?(a(),h("g",ja,Za)):I("",!0)],16,Ca))}});class Je{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const W=o=>Je.isMac?o.metaKey:o.ctrlKey,Ya=o=>o.shiftKey;class Xa{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const Oe=new Xa;class be{constructor(e){this.dto=e}static async listConnections(){return(await Oe.listConnections()).map(n=>new be(n))}static async getIsUsageMode(){return await Oe.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const Qe=yt("agents-usage-mode",()=>{const o=D(!1);return(async()=>{o.value=await be.getIsUsageMode()})(),{agentUsageMode:o}}),Wa=["onDragstart"],Ga={style:{display:"flex","flex-direction":"column","max-width":"250px"}},qa=N({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(o,{emit:e}){const n=Qe(),s=M(()=>n.agentUsageMode?he.stages:he.stages.filter(u=>!["agents","clients"].includes(u.typeName)));return(u,m)=>(a(),h(X,null,[d(t(K),{class:"toolbar",align:"center"},{default:r(()=>[(a(!0),h(X,null,ce(s.value,p=>(a(),w(t(ht),{key:p.key,placement:"top"},{title:r(()=>[d(t(K),{gap:"small"},{default:r(()=>[d(t(ee),null,{default:r(()=>[V(Z(p.title),1)]),_:2},1024),d(t(ee),{keyboard:""},{default:r(()=>[V(Z(p.key),1)]),_:2},1024)]),_:2},1024)]),content:r(()=>[S("div",Ga,[d(t(ee),null,{default:r(()=>[V(Z(p.description),1)]),_:2},1024),p.beta?(a(),w(t(xe),{key:0,type:"warning",class:"beta-alert"},{description:r(()=>[d(t(ee),null,{default:r(()=>[V(" This is a beta feature, "),d(t(Re),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:r(()=>[V(" click here ")]),_:1}),V(" to learn more about it ")]),_:1})]),_:1})):I("",!0)])]),default:r(()=>[S("div",{draggable:!0,class:"toolbar__item",onDragstart:k=>e("drag-start",k.dataTransfer,p.typeName)},[(a(),w(G(p.icon),{size:18}))],40,Wa)]),_:2},1024))),128)),d(t(Ut),{type:"vertical"}),d(t(fe),{disabled:!u.controller.hasChanges(),onClick:m[0]||(m[0]=p=>u.controller.save())},{default:r(()=>[d(t(K),{align:"center",gap:"small"},{default:r(()=>[d(t(Nt),{size:16}),V(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),d(Lt,{"has-changes":u.controller.hasChanges()},null,8,["has-changes"])],64))}});const Ka=se(qa,[["__scopeId","data-v-d855dff0"]]);function et(){let o;const e={draggedType:D(null),isDragOver:D(!1),isAdding:D(!1),isDragging:D(!1),mousePosition:D(null)},{draggedType:n,isDragOver:s,isDragging:u,isAdding:m}=e,p=C=>{o=C,document.addEventListener("mousemove",z)},{screenToFlowCoordinate:k}=J();we(m,C=>{document.body.style.userSelect=C?"none":""});function _(C,T){m.value=!0,C?(C.setData("application/vueflow",T),C.effectAllowed="move",n.value=T,u.value=!0,document.addEventListener("drop",g)):(n.value=T,document.addEventListener("click",$))}function c(C){C.preventDefault(),n.value&&(s.value=!0,C.dataTransfer&&(C.dataTransfer.dropEffect="move"))}function i(){s.value=!1}function g(){m.value=!1,u.value=!1,s.value=!1,n.value=null,document.removeEventListener("drop",g)}function z(C){const T={x:C.pageX-200,y:C.pageY-80};e.mousePosition.value=T}function f(C){if(!n.value)throw new Error("No dragged type");return k({x:C.clientX-70,y:C.clientY-25})}function $(C){if(!o)return;if(!n.value)throw new Error("No dragged type");const T=f(C);o.addStages([{type:n.value,position:T}]),g()}function H(){document.removeEventListener("mousemove",z)}return{init:p,tearDown:H,draggedType:n,isDragOver:s,isAdding:m,isDragging:u,mousePosition:e.mousePosition,onDragStart:_,onDragLeave:i,onDragOver:c,onDrop:$}}const Ja={name:"ControlButton",compatConfig:{MODE:3}},Qa=(o,e)=>{const n=o.__vccOpts||o;for(const[s,u]of e)n[s]=u;return n},eo={class:"vue-flow__controls-button"};function to(o,e,n,s,u,m){return a(),h("button",eo,[j(o.$slots,"default")])}const de=Qa(Ja,[["render",to]]),ao={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},oo=S("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),so=[oo];function no(o,e){return a(),h("svg",ao,so)}const lo={render:no},io={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},ro=S("path",{d:"M0 0h32v4.2H0z"},null,-1),uo=[ro];function co(o,e){return a(),h("svg",io,uo)}const po={render:co},go={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},fo=S("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),vo=[fo];function mo(o,e){return a(),h("svg",go,vo)}const yo={render:mo},ho={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ko=S("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),wo=[ko];function _o(o,e){return a(),h("svg",ho,wo)}const bo={render:_o},$o={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Co=S("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),Ao=[Co];function So(o,e){return a(),h("svg",$o,Ao)}const Io={render:So},Mo={name:"Controls",compatConfig:{MODE:3}},Do=N({...Mo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>Et.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(o,{emit:e}){const{nodesDraggable:n,nodesConnectable:s,elementsSelectable:u,setInteractive:m,zoomIn:p,zoomOut:k,fitView:_,viewport:c,minZoom:i,maxZoom:g}=J(),z=Ie(()=>n.value||s.value||u.value),f=Ie(()=>c.value.zoom<=i.value),$=Ie(()=>c.value.zoom>=g.value);function H(){p(),e("zoomIn")}function C(){k(),e("zoomOut")}function T(){_(o.fitViewParams),e("fitView")}function P(){m(!z.value),e("interactionChange",!z.value)}return(A,x)=>(a(),w(t(zt),{class:"vue-flow__controls",position:A.position},{default:r(()=>[j(A.$slots,"top"),A.showZoom?(a(),h(X,{key:0},[j(A.$slots,"control-zoom-in",{},()=>[d(de,{class:"vue-flow__controls-zoomin",disabled:$.value,onClick:H},{default:r(()=>[j(A.$slots,"icon-zoom-in",{},()=>[(a(),w(G(t(lo))))])]),_:3},8,["disabled"])]),j(A.$slots,"control-zoom-out",{},()=>[d(de,{class:"vue-flow__controls-zoomout",disabled:f.value,onClick:C},{default:r(()=>[j(A.$slots,"icon-zoom-out",{},()=>[(a(),w(G(t(po))))])]),_:3},8,["disabled"])])],64)):I("",!0),A.showFitView?j(A.$slots,"control-fit-view",{key:1},()=>[d(de,{class:"vue-flow__controls-fitview",onClick:T},{default:r(()=>[j(A.$slots,"icon-fit-view",{},()=>[(a(),w(G(t(yo))))])]),_:3})]):I("",!0),A.showInteractive?j(A.$slots,"control-interactive",{key:2},()=>[A.showInteractive?(a(),w(de,{key:0,class:"vue-flow__controls-interactive",onClick:P},{default:r(()=>[z.value?j(A.$slots,"icon-unlock",{key:0},()=>[(a(),w(G(t(Io))))]):I("",!0),z.value?I("",!0):j(A.$slots,"icon-lock",{key:1},()=>[(a(),w(G(t(bo))))])]),_:3})):I("",!0)]):I("",!0),j(A.$slots,"default")]),_:3},8,["position"]))}}),xo=N({__name:"ControlButtons",props:{workflow:{}},setup(o){return(e,n)=>(a(),w(t(Do),{position:"top-left","show-interactive":!1},{default:r(()=>[d(t(de),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:n[0]||(n[0]=s=>e.workflow.history.undo())},{default:r(()=>[d(t(Rt))]),_:1},8,["disabled"]),d(t(de),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:n[1]||(n[1]=s=>e.workflow.history.redo())},{default:r(()=>[d(t($a))]),_:1},8,["disabled"])]),_:1}))}});class Eo{constructor(e,n){Se(this,"dx");Se(this,"dy");this.dx=n.x-e.x,this.dy=n.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function zo(o,e,n=0){const{x:s,y:u}=e.center,{width:m,height:p}=e,k=new Eo(o,e.center),_=n*(k.x/k.length),c=n*(k.y/k.length),i=p/m;let g,z;if(Math.abs(k.m)>Math.abs(i)){const f=p/2*(1/k.m);g=s-(k.y>0?f:-f),z=u+(k.y>0?-p/2:p/2)}else{const f=m/2*k.m;g=s+(k.x>0?-m/2:m/2),z=u-(k.x>0?f:-f)}return{x:g+_,y:z+c}}const Fo=(o,e=0,n=0)=>{const s=Math.atan2(o.ty-o.sy,o.tx-o.sx),u=e*Math.sin(s),m=e*Math.cos(s),p=n*Math.cos(s),k=n*Math.sin(s);return{sourceX:o.sx-u+p,sourceY:o.sy+m+k,targetX:o.tx-u-p,targetY:o.ty+m-k}};function Ee(o,e,n=0){const s={x:o.computedPosition.x+o.dimensions.width/2,y:o.computedPosition.y+o.dimensions.height/2},m={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return zo(s,m,n)}function tt(o,e){const n=Ee(o,e,-10),s=Ee(e,o,-10);return{sx:s.x,sy:s.y,tx:n.x,ty:n.y}}const Bo=N({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(o){return(e,n)=>(a(),w(t(K),{vertical:"",gap:"small",style:te({marginBottom:`-${16*e.menuOptions.length}%`})},{default:r(()=>[(a(!0),h(X,null,ce(e.menuOptions,s=>(a(),w(t(Ye),{key:s.label,title:s.tooltip,placement:"right"},{default:r(()=>[d(t(fe),{class:ze([{"warning-button":s.warning}]),disabled:s.disabled,style:te({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:u=>s.click(u)},{default:r(()=>[d(t(K),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:r(()=>[V(Z(s.label)+" ",1),s.key?(a(),w(t(ee),{key:0,keyboard:"",disabled:s.disabled},{default:r(()=>[V(Z(s.key),1)]),_:2},1032,["disabled"])):I("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const Vo=N({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(o){const e=o,n=[{label:"Edit task type",key:"E",click:()=>u.value="editing"},{label:"Delete",key:"Del",click:()=>z(e.data.id)}],s=D(e.data.props.taskType||""),u=D("idle"),m=()=>{u.value!=="idle"&&(s.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:s.value}),u.value="idle")},{onEdgeClick:p,onPaneClick:k,getSelectedEdges:_}=J();p(f=>{f.edge.id===e.id&&u.value==="idle"&&(u.value="selected")}),k(()=>m());const c=M(()=>tt(e.sourceNode,e.targetNode)),i=M(()=>qe(Fo(c.value))),g=f=>{!_.value.map($=>$.id).includes(e.data.id)||(f.key==="Enter"&&m(),(f.key==="e"||f.key==="E")&&(u.value="editing"),(f.key==="Backspace"||f.key==="Delete")&&z(e.data.id))},{removeEdges:z}=J();return _e(()=>window.addEventListener("keydown",g)),Fe(()=>window.removeEventListener("keydown",g)),(f,$)=>(a(),h(X,null,[d(t(Ft),{path:i.value[0],"marker-end":f.markerEnd},null,8,["path","marker-end"]),d(t(Bt),null,{default:r(()=>[u.value==="idle"?(a(),h("div",{key:0,style:te({transform:`translate(-50%, -50%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(a(),w(t(ee),{key:1},{default:r(()=>[V(Z(e.data.props.taskType),1)]),_:1})):(a(),w(t(Ra),{key:0,size:16}))],4)):u.value==="selected"?(a(),h("div",{key:1,style:te({transform:`translate(-50%, -120%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[d(Bo,{"is-connecting":!0,"is-editing":!0,"menu-options":n})],4)):u.value==="editing"?(a(),h("div",{key:2,style:te({transform:`translate(-50%, -50%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[d(t(ve),{value:s.value,"onUpdate:value":$[0]||($[0]=H=>s.value=H),placeholder:"Task type"},null,8,["value"])],4)):I("",!0)]),_:1})],64))}});const Ho=se(Vo,[["__scopeId","data-v-47da1de6"]]),To={key:0},Po=S("defs",null,[S("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[S("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),Lo=["d"],No=N({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(o){const e=o,n=D(!0),{onNodeMouseEnter:s,onNodeMouseLeave:u}=J();s(_=>{_.node.id===e.sourceNode.id&&(n.value=!1)}),u(_=>{_.node.id===e.sourceNode.id&&(n.value=!0)});const m=M(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),p=M(()=>tt(e.sourceNode,m.value)),k=M(()=>qe({sourceX:p.value.sx,sourceY:p.value.sy,targetX:p.value.tx,targetY:p.value.ty}));return(_,c)=>n.value?(a(),h("g",To,[Po,S("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:k.value[0],"marker-end":"url(#arrowhead)"},null,8,Lo)])):I("",!0)}}),jo=N({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(o,{emit:e}){const n=o,s=M(()=>{const u=Xt(n.filename);return u.valid?n.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:u});return(u,m)=>(a(),w(t(We),{open:u.creatingFileStatus==="prompting"||u.creatingFileStatus==="creating",closable:!1,"confirm-loading":u.creatingFileStatus==="creating",onOk:m[1]||(m[1]=p=>e("create-file",u.filename)),onCancel:m[2]||(m[2]=p=>e("cancel"))},{default:r(()=>[d(t(Xe),{layout:"vertical",disabled:u.creatingFileStatus=="creating"},{default:r(()=>[d(t(ye),{label:"You're creating a new file. What should it be called?","validate-status":s.value.valid?"success":"error",help:s.value.valid?s.value.help:s.value.reason},{default:r(()=>[d(t(ve),{value:u.filename,onChange:m[0]||(m[0]=p=>e("update-filename",p.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),Uo={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},Zo=N({...Uo,props:{nodeId:null,isVisible:{type:Boolean},position:{default:pe.Top},offset:{default:10},align:{default:"center"}},setup(o){const e=o,n=q(Vt,null),{viewportRef:s,viewport:u,getSelectedNodes:m,findNode:p}=J();function k(f,$,H,C,T){let P=.5;T==="start"?P=0:T==="end"&&(P=1);let A=[(f.x+f.width*P)*$.zoom+$.x,f.y*$.zoom+$.y-C],x=[-100*P,-100];switch(H){case pe.Right:A=[(f.x+f.width)*$.zoom+$.x+C,(f.y+f.height*P)*$.zoom+$.y],x=[0,-100*P];break;case pe.Bottom:A[1]=(f.y+f.height)*$.zoom+$.y+C,x[1]=0;break;case pe.Left:A=[f.x*$.zoom+$.x-C,(f.y+f.height*P)*$.zoom+$.y],x=[-100,-100*P];break}return`translate(${A[0]}px, ${A[1]}px) translate(${x[0]}%, ${x[1]}%)`}const _=M(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||n||""]).reduce((f,$)=>{const H=p($);return H&&f.push(H),f},[])),c=M(()=>typeof e.isVisible=="boolean"?e.isVisible:_.value.length===1&&_.value[0].selected&&m.value.length===1),i=M(()=>Ht(_.value)),g=M(()=>Math.max(..._.value.map(f=>(f.computedPosition.z||1)+1))),z=M(()=>({position:"absolute",transform:k(i.value,u.value,e.position,e.offset,e.align),zIndex:g.value}));return(f,$)=>(a(),w(kt,{to:t(s),disabled:!t(s)},[t(c)&&t(_).length?(a(),h("div",ke({key:0},f.$attrs,{style:t(z),class:"vue-flow__node-toolbar"}),[j(f.$slots,"default")],16)):I("",!0)],8,["to","disabled"]))}}),Oo=N({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(o){return(e,n)=>(a(),w(t(Zo),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:t(pe).Right},{default:r(()=>[d(t(K),{vertical:"",gap:"small",style:te({marginBottom:`-${16*e.menuOptions.length}%`})},{default:r(()=>[(a(!0),h(X,null,ce(e.menuOptions,s=>(a(),w(t(Ye),{key:s.label,title:s.tooltip,placement:"right"},{default:r(()=>[d(t(fe),{class:ze([{"warning-button":s.warning}]),disabled:s.disabled,style:te({backgroundColor:s.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:u=>s.click(u)},{default:r(()=>[d(t(K),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:r(()=>[V(Z(s.label)+" ",1),s.key?(a(),w(t(ee),{key:0,keyboard:"",disabled:s.disabled},{default:r(()=>[V(Z(s.key),1)]),_:2},1032,["disabled"])):I("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const Ro=N({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(o,{emit:e}){var R;const n=o,s=D(!1),m=Qe().agentUsageMode,p=re.object({title:re.string(),clientStageId:re.string().uuid(),inputSchemas:re.any(),outputSchemas:re.any()});we(()=>n.stageProps.projectId,()=>{s.value=!0,A()});const k=qt(),_=()=>{var F;const b=(F=k.cloudProject)==null?void 0:F.id;return b?`https://cloud.abstra.io/projects/${b}/agents`:""},c=re.array(p),i=D((R=n.stageProps.projectId)!=null?R:""),g=D(!1),z=b=>f.loading.value||!f.result.value?null:f.result.value.find(F=>F.agentConnection.id===b),f=De(async()=>be.listConnections()),$=M(()=>f.loading.value||!f.result.value?[]:f.result.value.map(b=>({label:b.agentConnection.connectionName,key:b.agentConnection.id,value:b.agent.projectId}))),{result:H,loading:C,refetch:T,error:P}=De(async()=>{const b=n.stageProps.projectId;if(!b)return[];const O=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${b}`)).json();return c.parse(O)}),A=Ge.exports.debounce(()=>{s.value=!1,T()},500),x=M(()=>C.value||!H.value?[]:H.value.map(b=>({label:b.title,value:b.clientStageId})));function U(b){e("update:stage-props",{...n.stageProps,projectId:b,clientStageId:null})}function ne(b){const F=z(b.key);!F||(U(F.agent.projectId),i.value=F.agent.projectId,g.value=!1)}function y(b){const F=b.target;i.value=F.value,U(F.value),g.value=!0}function E(b){g.value=b}function B(b){const F=String(b);!H.value||e("update:stage-props",{...n.stageProps,clientStageId:F})}return(b,F)=>(a(),h(X,null,[d(t(ye),{label:"Project ID"},{default:r(()=>{var O;return[t(m)?(a(),w(t(_t),{key:0,trigger:"click",visible:g.value,onVisibleChange:E},{overlay:r(()=>[d(t(wt),{onClick:ne},{default:r(()=>[(a(!0),h(X,null,ce($.value,Q=>(a(),w(t(Ue),{key:Q.key},{default:r(()=>[V(Z(Q.label),1)]),_:2},1024))),128)),d(t(Ue),null,{default:r(()=>[d(t(Re),{class:"cloud-link",href:_(),target:"_blank"},{default:r(()=>[V(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:r(()=>[d(t(ve),{value:i.value,"onUpdate:value":F[0]||(F[0]=Q=>i.value=Q),autofocus:"","allow-clear":"",onInput:y},null,8,["value"])]),_:1},8,["visible"])):(a(),w(t(ve),{key:1,value:(O=b.stageProps.projectId)!=null?O:"",placeholder:"Project ID",autofocus:"","onUpdate:value":U},null,8,["value"]))]}),_:1}),d(t(ye),{label:"Client entrypoint"},{default:r(()=>{var O;return[s.value||t(C)?(a(),w(t(Me),{key:0,disabled:"",loading:""})):t(P)?(a(),w(t(xe),{key:1,type:"error",message:"Invalid project id"})):b.stageProps.projectId?t(H).length===0?(a(),w(t(xe),{key:3,type:"warning",message:"The project has no entrypoints"})):(a(),w(t(Me),{key:4,class:"entrypoint-select",options:x.value,value:(O=b.stageProps.clientStageId)!=null?O:void 0,"onUpdate:value":B},null,8,["options","value"])):(a(),w(t(Me),{key:2,disabled:""}))]}),_:1})],64))}});const Yo=se(Ro,[["__scopeId","data-v-f4d2a34d"]]),Xo=N({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(o){var je;const e=o,{useToken:n}=Ke,s=bt(),{token:u}=n(),m=u.value.colorText,p=[{label:"Add transition",key:"C",click:l=>He(l)},{label:"Rename",key:"R",click:()=>Y.value=!0},{label:"Go to editor",key:"Enter",click:()=>Ve()},{label:"Tasks",key:"M",click:()=>_.value=!0},{label:"Delete",key:"Del",click:()=>i.value=!0}],k=M(()=>{let l=[...p];return c.value||l.unshift({label:"Create missing file",warning:!0,click:()=>E()}),e.controller.hasChanges()&&(l=l.map(v=>v.label==="Go to editor"?{...v,disabled:!0,tooltip:"Save it to allow editing"}:v.label==="Tasks"?{...v,disabled:!0,tooltip:"Save it to allow managing tasks"}:v)),(e.stage.type==="agents"||e.stage.type==="clients")&&(l=l.filter(v=>!["Create missing file","Go to editor","Tasks"].includes(v.label))),e.stage.type==="agents"&&(l=l.map(v=>v.label==="Rename"?{...v,label:"Edit"}:v)),l}),_=D(!1),c=D(!0);we(()=>e.initialFileCheck,l=>{P.value||(c.value=l)});const i=D(!1),g=()=>{i.value=!1,Q(e.stage)},z=new Qt,{deleteFile:f}=Jt({api:z,router:s}),$=async()=>{if(i.value=!1,"filename"in e.stage.props&&e.stage.props.filename){const l=e.stage.props.filename;(await ge.checkFile(l)).exists&&await f([l])}Q(e.stage)},H=l=>{x.value=l,A()},C=l=>{e.controller.updateStageProps(e.stage.id,l)},T=()=>{var l;U.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(x.value=(l=e.stage.props.filename)!=null?l:"",A())},P=M(()=>e.controller.getUnsavedFilenameStages().some(l=>l.id===e.stage.id)),A=Ge.exports.debounce(async()=>{if(P.value){c.value=!0;return}const l=x.value;if(!l){c.value=!0;return}ge.checkFile(l).then(v=>{c.value=v.exists})},500),x=D((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(je=e.stage.props.filename)!=null?je:""),U=D("idle"),ne=async()=>{U.value="creating",await ge.initFile(x.value,e.stage.type),c.value=!0;const l=await ge.checkFile(x.value);if(c.value=l.exists,U.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:x.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:x.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},y=M(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!c.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),E=()=>{U.value="prompting"},{startConnection:B,updateConnection:R,onNodeClick:b,addEdges:F,endConnection:O,removeNodes:Q,onPaneClick:ot,getSelectedNodes:st,flowToScreenCoordinate:Be,onNodeMouseEnter:nt,onNodeMouseLeave:lt,getNodes:it,onNodesChange:rt,applyNodeChanges:ut}=J(),ae=D(!1),Y=D(!1),oe=D(e.stage.title),$e=D(!0),me=M(()=>{const v=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Kt(oe.value,!1,!0)}.py`;return v!==x.value?v:null}),Ce=D(!1),Ae=D(!1);rt(async l=>{var L;const v=[];for(const le of l)le.type==="remove"?Y.value||((L=e.controller)==null||L.delete([le.id]),v.push(le)):v.push(le);ut(v)});const Ve=()=>{const l=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Ae.value?window.open(`/_editor/${l}/${e.stage.id}`,"_blank"):s.push({path:`/_editor/${l}/${e.stage.id}`})},He=(l,v=!0)=>{B({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:v?l.pageX:l.pageX-90,y:v?l.pageY-50:l.pageY-20}),document.addEventListener("mousemove",Te),ae.value=!0},Te=l=>{ae.value&&!Ce.value&&R({x:l.pageX,y:l.pageY-52})};b(l=>{if(l.node.id===e.stage.id&&A(),ae.value&&l.node.id!==e.stage.id){const v={sourceStageId:e.stage.id,targetStageId:l.node.id,type:"task",id:gt(),props:{taskType:null}};try{e.controller.connect([v]),document.removeEventListener("mousemove",Te),F({id:v.id,source:e.stage.id,target:l.node.id,type:"task",markerEnd:{type:Tt.Arrow,width:24,height:24},data:v}),O(),ae.value=!1}catch(L){console.error(L)}}}),nt(l=>{if(ae.value&&l.node.id!==e.stage.id){Ce.value=!0;const v=it.value.find(le=>le.id===e.stage.id);if(!v)return;const L=Ee(v,l.node,-10);R(Be({x:L.x,y:L.y-52}))}}),lt(()=>{Ce.value=!1});const dt=()=>{if(!c.value){const l=Wt(oe.value+".py");x.value=l;let v={filename:l,path:null};if(["forms","hooks"].includes(e.stage.type)){const L=Gt(oe.value);v={...v,path:L}}e.controller.updateStageProps(e.stage.id,v)}},Pe=async()=>{e.stage.title!==oe.value&&(e.controller.updateStageTitle(e.stage.id,oe.value),$e.value&&me.value&&(x.value=me.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:x.value})),dt()),A()};ot(()=>{Y.value=!1,Pe(),ae.value=!1,O()});const Le=l=>{if(Ae.value=W(l),!!st.value.map(v=>v.id).includes(e.stage.id)&&U.value==="idle"){if(l.key==="Enter")if(Y.value)Y.value=!1,Pe();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;Ve()}if(!Y.value){if(l.key==="c"||l.key==="C"){const v=Be(e.stage.position);He({pageX:v.x,pageY:v.y},!1)}if((l.key==="r"||l.key==="R")&&(Y.value=!0),l.key==="m"||l.key==="M"){if(e.controller.hasChanges())return;_.value=!0}(l.key==="Backspace"||l.key==="Delete")&&("filename"in e.stage.props&&e.stage.props.filename?i.value=!0:Q(e.stage))}}},Ne=l=>{Ae.value=W(l)};return _e(()=>{P.value||(c.value=e.initialFileCheck),window.addEventListener("keydown",Le),window.addEventListener("keyup",Ne)}),Fe(()=>{window.removeEventListener("keydown",Le),window.removeEventListener("keyup",Ne)}),(l,v)=>(a(),h(X,null,[d(Oo,{"is-connecting":ae.value,"is-editing":Y.value,"menu-options":k.value},null,8,["is-connecting","is-editing","menu-options"]),d(t(We),{open:i.value,title:"Delete file"},{footer:r(()=>[d(t(K),{justify:"space-between",gap:"small"},{default:r(()=>[d(t(fe),{onClick:g},{default:r(()=>[V("Delete only stage")]),_:1}),d(t(fe),{type:"primary",danger:"",onClick:$},{default:r(()=>[V("Yes, delete file")]),_:1})]),_:1})]),default:r(()=>[V(" Do you also want to delete the file associated with the stage "+Z(l.stage.title)+"? ",1)]),_:1},8,["open"]),S("div",{class:"stage",onDblclick:v[2]||(v[2]=L=>Y.value=!0)},[d(t(K),{vertical:Y.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:r(()=>[(a(),w(G(t(jt)(l.stage.type)),{size:18,color:t(m)},null,8,["color"])),Y.value?(a(),w(t(Xe),{key:1,layout:"vertical"},{default:r(()=>[d(t(ye),{label:"Title"},{default:r(()=>[d(t(ve),{value:oe.value,"onUpdate:value":v[0]||(v[0]=L=>oe.value=L),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),me.value?(a(),w(t(Ct),{key:0,checked:$e.value,"onUpdate:checked":v[1]||(v[1]=L=>$e.value=L),style:{"margin-bottom":"12px"}},{default:r(()=>[V(" Update filename to "),d(t(ee),{code:""},{default:r(()=>[V(Z(me.value),1)]),_:1})]),_:1},8,["checked"])):I("",!0),l.stage.type==="agents"?(a(),w(Yo,{key:1,"stage-props":l.stage.props,"onUpdate:stageProps":C},null,8,["stage-props"])):I("",!0)]),_:1})):(a(),w(t($t),{key:0,class:"title"},{default:r(()=>[V(Z(l.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),y.value?(a(),w(t(ta),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):I("",!0),U.value==="prompting"||U.value==="creating"?(a(),w(jo,{key:1,filename:x.value,"file-exists":c.value,"creating-file-status":U.value,onCreateFile:ne,onCancel:T,onUpdateFilename:H},null,8,["filename","file-exists","creating-file-status"])):I("",!0),d(t(ea),{visible:_.value,"onUpdate:visible":v[3]||(v[3]=L=>_.value=L),title:"Tasks",width:"500",onClose:v[4]||(v[4]=L=>_.value=!1)},{default:r(()=>[d(Yt,{"stage-id":l.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const ue=se(Xo,[["__scopeId","data-v-bc14805d"]]),at=o=>(At("data-v-f4278104"),o=o(),St(),o),Wo={class:"empty-hint"},Go={key:0,class:"drag-hint"},qo=at(()=>S("div",{class:"title"},"Start here",-1)),Ko={key:1,class:"drop-hint"},Jo=at(()=>S("div",{class:"title"},"Drop here",-1)),Qo={key:2,class:"stages-hint"},es={class:"header"},ts={class:"title"},as={class:"description"},os=N({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(o){return(e,n)=>(a(),h("div",Wo,[e.showDragHint?(a(),h("div",Go,[qo,d(t(Ze),{size:32,class:"arrow"})])):I("",!0),e.showDragHint?I("",!0):(a(),h("div",Ko,[Jo,d(t(Ze),{size:32,class:"arrow"})])),e.showDragHint?(a(),h("div",Qo,[(a(!0),h(X,null,ce(t(he).stages,s=>(a(),h("div",{key:s.key,class:"stage-hint"},[S("div",es,[(a(),w(G(s.icon))),S("span",ts,Z(s.title),1)]),S("div",as,Z(s.description),1)]))),128))])):I("",!0)]))}});const ss=se(os,[["__scopeId","data-v-f4278104"]]),ns=N({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(o){const e=o;It(c=>({aea56c2e:t(p),"124ca7b4":t(m)}));const n=et(),{useToken:s}=Ke,{token:u}=s(),m=u.value.colorPrimaryBorder,p=u.value.colorBgElevated,{onInit:k}=J();k(c=>{c.fitView()});const _=c=>{var i;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:c&&(i=e.initialFileCheckStatus[c])!=null?i:!1};return _e(()=>{const c=ie.subscribe("stageCreated",()=>{e.workflow.refetch()}),i=ie.subscribe("stageEdited",()=>{e.workflow.refetch()}),g=ie.subscribe("transitionCreated",()=>{e.workflow.refetch()});Mt(()=>{ie.unsubscribe(c),ie.unsubscribe(g),ie.unsubscribe(i)})}),(c,i)=>c.workflow?(a(),w(t(Pt),{key:0,nodes:c.workflow.vueFlowNodes.value,edges:c.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":c.editable,"pan-on-scroll":t(Je).isMac,"elements-selectable":c.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":[],onDragover:t(n).onDragOver,onDragleave:t(n).onDragLeave},{"connection-line":r(g=>[d(No,Dt(xt(g)),null,16)]),"edge-task":r(g=>[d(Ho,ke(g,{controller:c.workflow}),null,16,["controller"])]),"node-forms":r(g=>[d(ue,{stage:g.data,node:g,controller:c.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":r(g=>[d(ue,{stage:g.data,node:g,controller:c.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":r(g=>[d(ue,{stage:g.data,node:g,controller:c.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":r(g=>[d(ue,{stage:g.data,node:g,controller:c.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":r(g=>[d(ue,{stage:g.data,node:g,controller:c.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":r(g=>[d(ue,{stage:g.data,node:g,controller:c.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:r(()=>[d(t(Zt)),c.editable&&!c.workflow.vueFlowNodes.value.length?(a(),w(ss,{key:0,"show-drag-hint":c.showDragHint},null,8,["show-drag-hint"])):I("",!0),d(t(Ot),{pannable:"",zoomable:""}),c.editable?(a(),w(xo,{key:1,workflow:c.workflow},null,8,["workflow"])):I("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):I("",!0)}});const ls=se(ns,[["__scopeId","data-v-87cb53b9"]]),is=N({__name:"WorkflowEditor",setup(o){const e=mt(),{init:n,tearDown:s,onDragStart:u,onDrop:m,isDragging:p,isAdding:k,draggedType:_,mousePosition:c}=et(),{result:i}=De(async()=>await ft.init(vt,!0)),g=D(null),z=async()=>{if(!i.value)return;const y=i.value.vueFlowNodes.value.map(E=>{var B,R,b,F,O;return((B=E.data)==null?void 0:B.type)==="forms"||((R=E.data)==null?void 0:R.type)==="hooks"||((b=E.data)==null?void 0:b.type)==="scripts"||((F=E.data)==null?void 0:F.type)==="jobs"?(O=E.data)==null?void 0:O.props.filename:null});g.value=await ge.checkFiles(y.filter(E=>typeof E=="string"))};we(()=>i.value,()=>{i.value&&(n(i.value),z())});const{onNodeDragStop:f,onEdgesChange:$,getSelectedElements:H,getNodes:C,addSelectedNodes:T,zoomIn:P,fitView:A,zoomOut:x,applyEdgeChanges:U}=J();f(y=>{var E;(E=i.value)==null||E.move(y.nodes.map(B=>({id:B.id,position:B.position})))}),$(y=>{var E;for(const B of y)B.type==="remove"&&((E=i.value)==null||E.delete([B.id]));U(y)});const ne=y=>{var E,B;e.isInputFocused||!i.value||((y.key==="z"||y.key==="Z")&&W(y)&&(Ya(y)?i.value.history.redo():(E=i.value)==null||E.history.undo(),y.preventDefault()),W(y)&&(y.key==="s"||y.key==="S")&&((B=i.value)==null||B.save(),y.preventDefault()),!(W(y)&&(y.key==="f"||y.key==="F"))&&(H.value.length||(y.key==="f"||y.key==="F"?u(null,"forms"):y.key==="h"||y.key==="H"?u(null,"hooks"):y.key==="j"||y.key==="J"?u(null,"jobs"):y.key==="t"||y.key==="T"?u(null,"scripts"):(y.key==="a"||y.key==="A")&&W(y)?(T(C.value),y.preventDefault()):y.key==="0"&&W(y)?(A(),y.preventDefault()):(y.key==="="||y.key==="+")&&W(y)?(y.preventDefault(),P()):y.key==="-"&&W(y)&&(y.preventDefault(),x()))))};return _e(()=>{window.addEventListener("keydown",ne)}),Fe(()=>{window.removeEventListener("keydown",ne),s()}),(y,E)=>t(i)?(a(),h("div",{key:0,class:ze(["workflow-container",{dragging:t(k)}]),onDrop:E[0]||(E[0]=(...B)=>t(m)&&t(m)(...B))},[d(ls,{workflow:t(i),editable:"","show-drag-hint":!t(k),"check-file-status":!0,"initial-file-check-status":g.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),d(Ka,{controller:t(i),onDragStart:t(u)},null,8,["controller","onDragStart"]),(a(!0),h(X,null,ce(t(he).stages,B=>{var R,b;return a(),h("div",{key:B.key},[t(k)&&!t(p)&&B.typeName===t(_)?(a(),h("div",{key:0,class:"dragging-node",style:te({left:`${(R=t(c))==null?void 0:R.x}px`,top:`${(b=t(c))==null?void 0:b.y}px`,position:"absolute",cursor:t(k)?"grabbing":"grab"})},[(a(),w(G(B.icon),{size:18}))],4)):I("",!0)])}),128))],34)):I("",!0)}});const Qs=se(is,[["__scopeId","data-v-aa8dbb66"]]);export{Qs as default};
//# sourceMappingURL=WorkflowEditor.905c1eed.js.map

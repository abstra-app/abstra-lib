var v=Object.defineProperty;var y=(e,t,i)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var r=(e,t,i)=>(y(e,typeof t!="symbol"?t+"":t,i),i);import{d as m,X as w,W as b,a as c,b as s,o as d,f as o,u as n,dj as f,cT as I,A as P,g as p,t as h,i as u,df as g,_ as x,r as j,eA as A}from"./jwt-decode.esm.a6723498.js";import{_ as W}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.bc1746cf.js";import{B as E}from"./BaseLayout.89acf9a1.js";import{l as _}from"./fetch.909c8a54.js";import"./router.cc3a61f0.js";import{a as T}from"./project.d831e9de.js";import"./tables.10e48acd.js";import"./Logo.3d6705f0.js";import"./ts.worker.6fb5ea06.js";import"./record.5e31b608.js";import"./string.0fcb2f7e.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b879be12-5262-42e7-9bec-cb44314f29f7",e._sentryDebugIdIdentifier="sentry-dbid-b879be12-5262-42e7-9bec-cb44314f29f7")}catch{}})();const R=m({__name:"View",props:{controller:{}},setup(e){const t=e,i=t.controller.loadingPercentage();return w(()=>{t.controller.start()}),b(()=>{t.controller.cleanUp()}),(a,l)=>(d(),c(E,null,{content:s(()=>[o(n(f),{align:"center",justify:"center",style:{width:"100vw",height:"100dvh"}},{default:s(()=>[o(n(f),{gap:"large",align:"center",justify:"space-evenly",vertical:"",style:{width:"45%","min-width":"600px",height:"100%"}},{default:s(()=>[o(W,{size:"large"}),o(n(I),{size:[10,10],"show-info":!1,percent:n(i),"stroke-color":"#EA576A"},null,8,["percent"]),o(n(P),{level:3},{default:s(()=>[p(h(n(u).translate("i18n_webeditorview_preparing_environment")),1)]),_:1}),n(i)<100?(d(),c(n(g),{key:0},{default:s(()=>[p(h(n(u).translate("i18n_webeditorview_setting_up")),1)]),_:1})):(d(),c(n(g),{key:1},{default:s(()=>[p(h(n(u).translate("i18n_webeditorview_redirecting_soon")),1)]),_:1}))]),_:1})]),_:1})]),_:1}))}});const k=x(R,[["__scopeId","data-v-5fd653ca"]]);function D(e,t){if(!e)return"";const i=t.toString();if(!i)return e;const l=e.includes("?")?"&":"?";return`${e}${l}${i}`}class S{constructor(t,i,a=_){r(this,"projectId");r(this,"loading");r(this,"fetch",_);r(this,"interval",null);r(this,"urls",null);r(this,"totalWaitTime");r(this,"poolingInterval");r(this,"pingResponded",!1);r(this,"redirectPath");this.projectId=t,this.loading=j(0),this.fetch=a,this.totalWaitTime=6e4,this.poolingInterval=2500,this.redirectPath=i}increment(){this.loading.value+=100/(this.totalWaitTime/this.poolingInterval)}speedUp(){this.totalWaitTime=5e3,this.poolingInterval=500,this.interval&&clearInterval(this.interval),this.interval=setInterval(async()=>{this.increment(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}navigate(){if(this.urls){const t=new URLSearchParams;this.redirectPath&&t.set("redirect",this.redirectPath);const i=D(this.urls.redirect,t);window.location.replace(i)}this.cleanUp()}async ping(){if(!this.urls)return!1;if(this.pingResponded)return!0;const t=await this.fetch(this.urls.ping,{signal:AbortSignal.timeout(500)});return this.pingResponded=t.status===200,this.pingResponded}async start(){const t=await T.startWebEditor(this.projectId);this.urls=t,this.interval=setInterval(async()=>{this.increment(),this.pingResponded||await this.ping()&&this.speedUp(),this.loading.value>=100&&this.navigate()},this.poolingInterval)}cleanUp(){this.interval&&clearInterval(this.interval)}loadingPercentage(){return this.loading}}const H=m({__name:"WebEditor",setup(e){const t=A(),i=t.params.projectId,a=t.query.redirect,l=new S(i,a);return(U,V)=>(d(),c(k,{controller:n(l)},null,8,["controller"]))}});export{H as default};
//# sourceMappingURL=WebEditor.2c52ac61.js.map

import{d as j,g as h,o as r,c,w as a,b as t,u as e,da as o,d5 as m,az as d,eb as g,eN as X,bH as L,c_ as q,F as C,K as I,ea as A,d2 as x,cX as W,aL as $,Q as P,J as Y,a8 as Z,bM as F,eI as ee,eO as ae,ez as te,cr as se,cs as E,bE as le,cx as ne,cE as de,eL as re,eM as oe,a as ie}from"./index.d0e73820.js";import{T as ue,L as ce}from"./tasksController.046fe5ce.js";import{t as pe,a as ke}from"./ant-design.901cb255.js";import{F as N}from"./PhArrowSquareOut.vue.a3b81bc0.js";import{_ as V}from"./AbstraButton.vue_vue_type_script_setup_true_lang.2fe26c62.js";import{A as fe}from"./index.e66443cf.js";import{C as ye}from"./Card.d3b3322c.js";import{A as ge,C as me}from"./CollapsePanel.31ea4806.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[v]="a517aaac-eaf4-4213-a7cb-a0b25dcf7ca4",u._sentryDebugIdIdentifier="sentry-dbid-a517aaac-eaf4-4213-a7cb-a0b25dcf7ca4")}catch{}})();const _e=j({__name:"TaskCard",props:{task:{},checked:{type:Boolean},type:{},map:{}},emits:["change"],setup(u,{emit:v}){const k=u,b=(l,i)=>{let _=`/_editor/${l}/${i}`;window.open(`${_}`,"_blank")},S=h(()=>k.task.targetStageTitle.length<16?k.task.targetStageTitle:k.task.targetStageTitle.slice(0,16)+"..."),D=h(()=>k.task.sourceStageTitle.length<16?k.task.sourceStageTitle:k.task.sourceStageTitle.slice(0,16)+"...");return(l,i)=>(r(),c(e(ye),{size:"small"},{default:a(()=>[t(e(o),{justify:"space-between",vertical:""},{default:a(()=>[t(e(o),{justify:"end",style:{height:"6px"}},{default:a(()=>[t(e(m),{type:"secondary",style:{"font-size":"10px","margin-top":"-5px"}},{default:a(()=>[d(g(e(X)(new Date(l.task.created.at))),1)]),_:1})]),_:1}),t(e(o),{align:"start",justify:"space-between"},{default:a(()=>[t(e(o),{align:"center",gap:"middle"},{default:a(()=>[t(e(L),{checked:l.checked,disabled:l.type==="sent",onChange:i[0]||(i[0]=_=>v("change",l.task.id))},null,8,["checked","disabled"]),t(e(o),{align:"center"},{default:a(()=>[t(e(q),{color:l.map.get(l.task.type)},{default:a(()=>[d(g(l.task.type.length>18?l.task.type.slice(0,18)+"...":l.task.type),1)]),_:1},8,["color"]),t(e(fe),{type:"vertical"}),l.type==="received"&&l.task.sourceStageTitle?(r(),c(e(o),{key:0,align:"center"},{default:a(()=>[t(e(m),{type:"secondary"},{default:a(()=>[d("Sent by: ")]),_:1}),t(V,{type:"link",onClick:i[1]||(i[1]=_=>b(l.task.sourceStageType,l.task.created.byStageId))},{default:a(()=>[d(g(D.value)+" ",1),t(e(N),{size:16})]),_:1})]),_:1})):C("",!0),l.type==="received"&&!l.task.sourceStageTitle?(r(),c(e(o),{key:1,align:"center"},{default:a(()=>[t(e(m),{type:"secondary"},{default:a(()=>[d("Created manually")]),_:1})]),_:1})):C("",!0),l.type==="sent"?(r(),c(e(o),{key:2,align:"center"},{default:a(()=>[t(e(m),{type:"secondary"},{default:a(()=>[d("Sent to: ")]),_:1}),t(V,{type:"link",onClick:i[2]||(i[2]=_=>b(l.task.targetStageType,l.task.targetStageId))},{default:a(()=>[d(g(S.value)+" ",1),t(e(N),{size:16})]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1})]),_:1}),t(e(o),{vertical:"",style:{padding:"10px"}},{default:a(()=>[(r(!0),I($,null,A(l.task.payload,(_,w)=>(r(),c(e(o),{key:w},{default:a(()=>[t(e(x),{class:"center"},{default:a(()=>[d(g(w)+":",1)]),_:2},1024),t(e(W),{"tree-data":e(pe)(_),selectable:!1,style:{padding:"0"}},{title:a(({title:f})=>[t(e(m),{type:"secondary",style:{"max-width":"200px"},ellipsis:""},{default:a(()=>[d(g(f),1)]),_:2},1024)]),_:2},1032,["tree-data"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}});const ve=P(_e,[["__scopeId","data-v-c67a9853"]]),Te=u=>(re("data-v-d0fd7f73"),u=u(),oe(),u),Ce=Te(()=>ie("code",null,"send_task",-1)),he=j({__name:"TasksManager",props:{stageId:{}},emits:["refetch-tasks"],setup(u,{emit:v}){const k=u,b=new ce,S=p=>{p(),v("refetch-tasks",k.stageId)},{setup:D,tearDown:l,state:i,createTask:_,startCreatingTask:w,creatingTaskState:f,cancelCreatingTask:U,isPayloadValid:B,collapseValue:M,getPossibleActions:O,checkTask:J,clearAllTasks:K}=ue({api:b,poll:!1,stageId:k.stageId,stages:null}),R=h(()=>O()),G=(p,n)=>{p.stopPropagation();const s=z.value.find(T=>T.key===n);if(!s)return;const y=s.tasks.every(T=>T.checked);s.tasks.forEach(T=>T.checked=!y)};async function H(){await ke("Are you sure you want to clear all tasks and their associated payloads?")&&await K()}const z=h(()=>{var p;return[{key:"pending",title:"Pending tasks",tasks:i.tasks.filter(n=>n.status==="pending"),type:"received"},{key:"completed",title:"Completed tasks",tasks:i.tasks.filter(n=>n.status==="completed"),type:"received"},{key:"sent",title:"Sent tasks",tasks:(p=i.sentTasks)!=null?p:[],type:"sent"}]}),Q=h(()=>{let p={pending:!1,completed:!1,sent:!1};return z.value.forEach(n=>{n.tasks.length!==0&&(p[n.key]=n.tasks.every(s=>s.checked))}),p});return Y(()=>D()),Z(()=>l()),(p,n)=>(r(),c(e(o),{vertical:"",gap:"small",class:"tasks-manager"},{default:a(()=>[t(e(o),{justify:"space-between",align:"center"},{default:a(()=>[t(e(o),null,{default:a(()=>[t(e(F),{type:"link",onClick:H},{default:a(()=>[d("Clear all")]),_:1})]),_:1}),t(e(o),{justify:"end",gap:"small"},{default:a(()=>[(r(!0),I($,null,A(R.value,s=>(r(),c(e(F),{key:s.name,onClick:y=>S(s.handler)},{default:a(()=>[d(g(s.label),1)]),_:2},1032,["onClick"]))),128)),t(e(F),{type:"primary",onClick:ee(e(w),["stop"])},{default:a(()=>[d("Add Task")]),_:1},8,["onClick"])]),_:1})]),_:1}),t(e(me),{"active-key":e(M),"onUpdate:activeKey":n[0]||(n[0]=s=>te(M)?M.value=s:null),ghost:""},{default:a(()=>[(r(!0),I($,null,A(z.value,s=>(r(),c(e(ge),{key:s.key},{header:a(()=>[t(e(o),{gap:"small"},{default:a(()=>[t(e(L),{checked:Q.value[s.key],disabled:s.tasks.length===0||s.key==="sent",onClick:y=>G(y,s.key)},null,8,["checked","disabled","onClick"]),t(e(m),null,{default:a(()=>[d(g(s.title)+" : "+g(s.tasks.length),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[t(e(o),{vertical:"",gap:"small"},{default:a(()=>[t(ae,null,{default:a(()=>[(r(!0),I($,null,A(s.tasks,y=>(r(),c(ve,{key:y.id+"-"+s.key,task:y,type:s.type,map:e(i).colorMap,checked:!!y.checked,onChange:T=>e(J)(y.id)},null,8,["task","type","map","checked","onChange"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["active-key"]),t(e(de),{open:e(f).state==="creating","ok-button-props":{disabled:!e(B)},onCancel:e(U),onOk:n[3]||(n[3]=s=>S(e(_)))},{title:a(()=>[t(e(m),null,{default:a(()=>[d("Add Task")]),_:1})]),default:a(()=>[t(e(se),{layout:"vertical"},{default:a(()=>[t(e(E),{label:"Task type"},{default:a(()=>[e(f).state==="creating"?(r(),c(e(le),{key:0,value:e(f).name,"onUpdate:value":n[1]||(n[1]=s=>e(f).name=s),"auto-size":""},null,8,["value"])):C("",!0)]),_:1}),t(e(E),{label:"Task data"},{default:a(()=>[e(f).state==="creating"?(r(),c(e(ne),{key:0,value:e(f).payloadCode,"onUpdate:value":n[2]||(n[2]=s=>e(f).payloadCode=s),"auto-size":""},null,8,["value"])):C("",!0)]),_:1})]),_:1}),e(B)?C("",!0):(r(),c(e(m),{key:0,type:"danger"},{default:a(()=>[d("Invalid JSON")]),_:1}))]),_:1},8,["open","ok-button-props","onCancel"]),t(e(m),{type:"secondary"},{default:a(()=>[d(" Use "),Ce,d(" on previous stages to send tasks to this stage. ")]),_:1})]),_:1}))}});const ze=P(he,[["__scopeId","data-v-d0fd7f73"]]);export{ze as T};
//# sourceMappingURL=TasksManager.35736c45.js.map

var q=Object.defineProperty;var H=(a,e,n)=>e in a?q(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var c=(a,e,n)=>(H(a,typeof e!="symbol"?e+"":e,n),n);import{i as isUrl}from"./url.1b83203f.js";import{d as defineComponent,u as unref,b as openBlock,ev as createElementBlock,ar as createTextVNode,eD as toDisplayString,eN as i18nProvider,ex as createCommentVNode,eO as createStaticVNode,v as _export_sfc,e as createBaseVNode,f as createVNode,a$ as Fragment,a as resolveComponent,c as createBlock,dp as renderSlot,r as ref,w as withCtx,eL as lodash,H as computed,J as watch,G as reactive,o as onMounted,L as onUnmounted,ez as normalizeClass,eP as StartWidget,eQ as EndWidget,eR as ErrorWidget,eC as renderList,eS as resolveDynamicComponent}from"./outputWidgets.bb2f46e4.js";import{P as Passwordless}from"./Passwordless.9f672d31.js";import{S as SetttingsProvider,u as userManager}from"./index.43167b0d.js";import{P as PlayerNavbar}from"./PlayerNavbar.4f2f7033.js";import{S as Steps,A as ActionButton}from"./ActionButton.dd373f26.js";import{L as LoadingIndicator}from"./CircularLoading.25972084.js";import{W as WidgetsFrame}from"./WidgetsFrame.113f7141.js";import{g as magicWand,i as info}from"./icons.94ad51fe.js";import"./index.2fc0d039.js";import{C as Card}from"./Card.37a856a7.js";import{a as Typography}from"./Base.3e5c9785.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="8195c92a-8543-4309-9b4e-d8e62014feb1",a._sentryDebugIdIdentifier="sentry-dbid-8195c92a-8543-4309-9b4e-d8e62014feb1")}catch{}})();function normalizePath(a){return a.startsWith("/")?a.slice(1):a}async function redirect(a,e,n,s={}){if(isUrl(n)){const r=new URLSearchParams(s),o=new URL(n);o.search=r.toString(),window.location.href=o.toString()}else{const r=n.replace(/\/$/,"");if(a==="player")e.push({path:"/"+normalizePath(r),query:s});else if(a==="editor")e.push({name:"formEditor",params:{formPath:normalizePath(r)},query:s});else if(a==="preview")e.push({name:"formPreview",params:{formPath:normalizePath(r)},query:s});else throw new Error("Invalid routing")}}const closingStates=[WebSocket.CLOSING,WebSocket.CLOSED];function notify(a,e){const n=a[e.type];if(!n){console.warn("no callback for",e.type);return}n.forEach(s=>s(e))}const b=class{constructor(e){c(this,"ws",null);c(this,"callbacks",{"form:render-page":[],"form:user-event":[],"form:update-page":[],"form:page-response":[],"execution:start":[],"execution:heartbeat":[],"execution:stderr":[],"execution:stdout":[],"execution:lock-failed":[],"execution:ended":[],"execute-js:request":[],"execute-js:response":[],"redirect:request":[],"auth:require-info":[],"auth:invalid-jwt":[],"auth:valid-jwt":[],"auth:saved-jwt":[],"env:files-changed":[],"debug:close-attempt":[]});c(this,"onCloseCallbacks",[]);c(this,"heartbeatCounter",0);c(this,"heartbeatInterval");c(this,"params",{});this.formId=e}static create(e){return b._instance&&b._instance.close(),b._instance=new b(e),b._instance}get url(){return`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/_socket?id=${encodeURIComponent(this.formId)}`}isConnected(){return this.ws?this.ws&&this.ws.readyState===this.ws.OPEN:!1}resetState(){this.close()}resetHeartbeatCounter(){this.heartbeatCounter=0}on(e,n){this.callbacks[e].push(n)}clearWSEvents(){!this.ws||(clearInterval(this.heartbeatInterval),this.ws.onclose=()=>{},this.ws.onerror=()=>{},this.ws.onmessage=()=>{})}async connect(e,n=1){if(!(n>3))return this.params=e!=null?e:this.params,new Promise(s=>{this.clearWSEvents(),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{s(),this.resetHeartbeatCounter(),this.send({type:"execution:start",params:this.params})};let r=!1;const o=()=>{r||(r=!0)};this.ws.onclose=i=>{if(i.code===1006||!i.wasClean)return o();clearInterval(this.heartbeatInterval),this.onCloseCallbacks.forEach(f=>f())},this.ws.onerror=()=>o(),this.ws.onmessage=i=>{const f=JSON.parse(i.data);notify(this.callbacks,f)},this.heartbeatInterval=setInterval(()=>{if(!(!this.ws||this.ws.readyState!==this.ws.OPEN)){if(this.heartbeatCounter++,this.heartbeatCounter>3)return this.ws.onclose=()=>{},clearInterval(this.heartbeatInterval),o();this.send({type:"execution:heartbeat"})}},2e3)}).catch(()=>{this.connect(this.params,n+1)})}onClose(e){this.onCloseCallbacks.push(e)}close(){if(!this.ws){console.warn("no websocket to close");return}this.clearWSEvents(),this.ws.close()}async send(e){if(!this.ws){console.warn("no websocket to send");return}closingStates.includes(this.ws.readyState)&&await this.connect(),this.ws.send(JSON.stringify(e)),notify(this.callbacks,e)}};let RemoteBroker=b;c(RemoteBroker,"_instance");const _hoisted_1$4=["href"],_hoisted_2$3=createStaticVNode('<svg width="44" height="32" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-91fa59aa><g clip-path="url(#clip0_405_116214)" data-v-91fa59aa><path d="M188.697 133.808L172.68 148.263C172.68 148.263 216.044 185.966 217.997 187.72C219.951 189.475 234.405 174.566 232.843 173.266C231.28 171.966 188.697 133.808 188.697 133.808Z" fill="#E36C7C" data-v-91fa59aa></path><path d="M188.697 133.808L172.68 148.263C172.68 148.263 216.044 185.966 217.997 187.72C219.951 189.475 234.405 174.566 232.843 173.266C231.28 171.966 188.697 133.808 188.697 133.808Z" fill="url(#paint0_linear_405_116214)" data-v-91fa59aa></path><path d="M218.387 91.2249L176.195 127.557L173.851 129.51C151.192 149.849 149.853 152.309 141.642 152.584L141.584 152.586C139.612 152.652 135.357 152.795 131.875 149.849C126.797 145.552 120.155 140.083 117.03 137.348C115.34 135.869 112.465 133.039 109.998 131.097C107.902 129.448 106.482 127.581 104.919 127.581C103.357 127.581 100.622 129.925 96.3246 133.832C92.0272 137.739 82.6511 146.333 82.6511 146.333L65.0712 161.569C65.0712 161.569 42.5857 180.688 36.7256 185.376C30.8656 190.064 16.5797 175.69 21.4895 171.703C21.9628 171.23 26.2429 167.755 29.7179 164.915C32.2165 162.84 34.2084 161.179 34.2084 161.179C34.9897 160.397 66.2433 133.051 66.2433 133.051L87.723 114.573C87.723 114.573 95.9339 106.094 105.701 106.094C108.826 106.094 112.83 106.485 126.015 118.205C129.531 121.33 131.485 122.542 135.782 126.409C137.345 127.816 139.852 130.316 140.861 130.316C141.882 130.316 143.986 128.363 145.549 127.023C145.549 127.023 195.897 84.4149 202.37 77.9421C207.839 72.4726 223.075 86.9273 218.387 91.2249Z" fill="url(#paint1_linear_405_116214)" data-v-91fa59aa></path><path d="M33.238 67.1372C31.2846 68.6564 23.9305 75.1737 22.2992 76.9039C19.3366 80.0417 21.3638 81.3905 25.6611 84.9065C29.9585 88.4225 57.8962 112.712 64.8542 118.963L79.9642 105.221L41.288 71.2331C36.5999 67.1372 35.1913 65.6179 33.238 67.1372Z" fill="url(#paint2_linear_405_116214)" data-v-91fa59aa></path></g><defs data-v-91fa59aa><linearGradient id="paint0_linear_405_116214" x1="172.68" y1="133.808" x2="183.059" y2="196.169" gradientUnits="userSpaceOnUse" data-v-91fa59aa><stop offset="0.114583" stop-color="#FF98A6" data-v-91fa59aa></stop><stop offset="1" stop-color="#E36C7C" data-v-91fa59aa></stop></linearGradient><linearGradient id="paint1_linear_405_116214" x1="219.271" y1="186.305" x2="206.115" y2="57.7298" gradientUnits="userSpaceOnUse" data-v-91fa59aa><stop stop-color="#E36C7C" data-v-91fa59aa></stop><stop offset="0.859375" stop-color="#FF98A6" data-v-91fa59aa></stop></linearGradient><linearGradient id="paint2_linear_405_116214" x1="20.8984" y1="66.56" x2="30.8589" y2="127.049" gradientUnits="userSpaceOnUse" data-v-91fa59aa><stop stop-color="#E36C7C" data-v-91fa59aa></stop><stop offset="0.859375" stop-color="#FF98A6" data-v-91fa59aa></stop></linearGradient><clipPath id="clip0_405_116214" data-v-91fa59aa><rect width="256" height="256" fill="white" data-v-91fa59aa></rect></clipPath></defs></svg><b data-v-91fa59aa>Abstra Cloud</b>',2),_sfc_main$6=defineComponent({__name:"Watermark",props:{runtime:{}},setup(a){var s;const e=window.location.hostname.split(".")[0],n=(s=SetttingsProvider.instance)==null?void 0:s.showWatermark;return(r,o)=>unref(n)?(openBlock(),createElementBlock("a",{key:0,href:`https://www.abstra.io/forms?utm_source=abstra_pages&utm_medium=badge&utm_campaign=${r.runtime.id}&origin_subdomain=${unref(e)}`,target:"_blank",class:"watermark"},[createTextVNode(toDisplayString(unref(i18nProvider).translate("i18n_watermark_text"))+" ",1),_hoisted_2$3],8,_hoisted_1$4)):createCommentVNode("",!0)}}),Watermark_vue_vue_type_style_index_0_scoped_91fa59aa_lang="",Watermark=_export_sfc(_sfc_main$6,[["__scopeId","data-v-91fa59aa"]]),_sfc_main$5=defineComponent({__name:"RuntimeCommons",props:{runtime:{},fullWidth:{type:Boolean},forceResponsivity:{},userEmail:{},stepsInfo:{}},emits:["navigate","logout"],setup(a,{expose:e,emit:n}){const s=r=>n("navigate",r);return e({open}),(r,o)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("header",null,[createVNode(PlayerNavbar,{runtime:r.runtime,"user-email":r.userEmail,"force-responsivity":r.forceResponsivity,onLogout:o[0]||(o[0]=i=>n("logout")),onNavigate:s},null,8,["runtime","user-email","force-responsivity"])]),createVNode(Steps,{class:"steps","steps-info":r.stepsInfo},null,8,["steps-info"]),createVNode(Watermark,{class:"watermark",runtime:r.runtime},null,8,["runtime"])],64))}}),RuntimeCommons_vue_vue_type_style_index_0_scoped_783ba36b_lang="",RuntimeCommons=_export_sfc(_sfc_main$5,[["__scopeId","data-v-783ba36b"]]);function isInputWidget(a){return"key"in a&&"value"in a&&"errors"in a}const _hoisted_1$3={key:0,class:"text"},_hoisted_2$2={key:1,class:"text"},_sfc_main$4=defineComponent({__name:"component",props:{status:{}},setup(a){return(e,n)=>e.status==="running"?(openBlock(),createElementBlock("div",_hoisted_1$3," This form is already being filled ")):(openBlock(),createElementBlock("div",_hoisted_2$2,"This form was already filled"))}}),executeCode=($context,code)=>{let evaluatedCode;try{evaluatedCode=eval(code)}catch(a){throw console.error(`[Error: execute_js]: ${a.message}, context: ${$context}`),a}return isSerializable(evaluatedCode)?evaluatedCode:null};async function executeJs(a){return{type:"execute-js:response",value:await executeCode(a.context,a.code)}}const isSerializable=a=>{try{return JSON.stringify(a),!0}catch{return!1}};class BrokerMessageHandler{constructor(e,n){c(this,"showEndWidget",!0);c(this,"reactivePollInterval",null);c(this,"seq",0);c(this,"programEnded",!1);c(this,"setErrorPageState",()=>{this.newPageState({widgets:[{type:"error"}],actions:[],fullWidth:!1,steps:null})});c(this,"setEndPageState",()=>{!this.showEndWidget||this.newPageState({widgets:[{type:"end"}],actions:this.pageActionFactory.restartAction,fullWidth:!1,steps:null})});c(this,"setLockFailedPageState",e=>{this.newPageState({widgets:[{type:"lock-failed",status:e}],actions:[],fullWidth:!1,steps:null})});c(this,"sendUser",e=>{this.broker.send({type:"auth:saved-jwt",jwt:e.jwt})});c(this,"sendBrowserTryDisconnect",()=>{this.broker.send({type:"debug:close-attempt"})});c(this,"updatePageStateListener",()=>{});c(this,"newPageStateListener",()=>{});c(this,"onReactivePollListener",()=>{});c(this,"onErrorListener",()=>{});c(this,"onExitListener",()=>{});c(this,"onStartAuthListener");c(this,"onEndAuthListener");c(this,"onBadAuthListener");this.broker=e,this.pageActionFactory=n}static create(e,n,s){const r=new BrokerMessageHandler(e,n);return r.broker.onClose(()=>{r.programEnded||(r.setErrorPageState(),r.error("Connection with service closed before program ended"))}),r.broker.on("form:render-page",({widgets:o,actions:i,buttonText:f,endProgram:h,reactivePollingInterval:k,steps:E})=>{r.newPageState({widgets:o,actions:r.pageActionFactory.fromPageActionsDto(f?[f]:i!=null?i:[]),fullWidth:o.some(C=>"fullWidth"in C&&C.fullWidth),steps:E}),k&&(r.reactivePollInterval=setInterval(r.onReactivePollListener,k*1e3)),h&&(r.showEndWidget=!1,r.broker.send({type:"form:page-response",payload:{},secrets:[],seq:++r.seq}))}),r.broker.on("execute-js:request",async o=>{const i=await executeJs(o);r.broker.send(i)}),r.broker.on("auth:require-info",o=>{r.newPageState({widgets:[],actions:[],fullWidth:!1,steps:null}),r.onStartAuthListener&&r.onStartAuthListener(o)}),r.broker.on("auth:valid-jwt",()=>{r.onEndAuthListener&&r.onEndAuthListener()}),r.broker.on("auth:invalid-jwt",()=>{console.warn("invalid jwt"),r.onBadAuthListener&&r.onBadAuthListener()}),r.broker.on("execution:ended",o=>{if(r.programEnded=!0,o.exitStatus!=="SUCCESS"||o.exception){r.setErrorPageState(),r.error(o);return}r.setEndPageState(),r.exit(o)}),r.broker.on("execution:lock-failed",o=>{r.programEnded=!0,r.setLockFailedPageState(o.status)}),r.broker.on("redirect:request",o=>{s.onRedirect(o.url,o.queryParams)}),r.broker.on("execution:heartbeat",()=>{r.broker.resetHeartbeatCounter()}),r.broker.on("form:update-page",({widgets:o,validation:i,seq:f})=>{f===r.seq&&r.updatePageState({widgets:o,error:{message:i.message,status:i.status},fullWidth:o.some(h=>"fullWidth"in h&&h.fullWidth)})}),r}handleAction(e,n,s){this.reactivePollInterval&&clearInterval(this.reactivePollInterval);const r={};Object.entries(e).forEach(([o,i])=>{r[o]=i}),this.broker.send({type:"form:page-response",payload:r,action:n==null?void 0:n.name,secrets:s,seq:++this.seq})}sendUserEvent(e,n){const s={};Object.entries(e).forEach(([r,o])=>{s[r]=o}),this.broker.send({type:"form:user-event",payload:s,secrets:n,seq:++this.seq})}init(e){this.newPageState({widgets:[],actions:[],fullWidth:!1,steps:null}),this.broker.connect(e!=null?e:{})}updatePageState(e){this.updatePageStateListener(e)}listenToPageStateUpdate(e){this.updatePageStateListener=e}onNewPageState(e){this.newPageStateListener=e}newPageState(e){this.newPageStateListener(e)}onReactivePoll(e){this.onReactivePollListener=e}error(e){this.reactivePollInterval&&clearInterval(this.reactivePollInterval),this.onErrorListener(e)}onError(e){this.onErrorListener=e}exit(e){this.reactivePollInterval&&clearInterval(this.reactivePollInterval),this.onExitListener(e)}onExit(e){this.onExitListener=e}onStartAuth(e){this.onStartAuthListener=e}onEndAuth(e){this.onEndAuthListener=e}onBadAuth(e){this.onBadAuthListener=e}}class PageAction{constructor(e,n){c(this,"element",null);this.name=e,this.isDefault=n}static fromDto(e){return typeof e=="string"?new PageAction(e,!1):new PageAction(e.name,e.is_default)}setElement(e){e instanceof HTMLElement&&(this.element=e)}get isFocused(){return this.element===document.activeElement}focusOnButton(){var e;(e=this.element)==null||e.focus()}addKeydownListener(e){var n;(n=this.element)==null||n.addEventListener("keydown",e)}}class PageActionsFactory{constructor(e){this.form=e}static from(e){return new PageActionsFactory(e)}get startAction(){return[PageAction.fromDto(this.form.startButtonText||"Start")]}get restartAction(){const e=this.form.restartButtonText||"Restart";return this.form.allowRestart?[PageAction.fromDto(e)]:[]}fromPageActionsDto(e){return e.filter(n=>!!n).map(n=>PageAction.fromDto(n))}}const _hoisted_1$2={class:"outline-button"},_sfc_main$3=defineComponent({__name:"OutlineButton",props:{iconPath:{},noShadow:{type:Boolean},status:{}},setup(a){return(e,n)=>{const s=resolveComponent("icon");return openBlock(),createElementBlock("button",_hoisted_1$2,[e.iconPath?(openBlock(),createBlock(s,{key:0,path:e.iconPath,fill:"#fff",class:"icon"},null,8,["path"])):createCommentVNode("",!0),renderSlot(e.$slots,"default",{},void 0,!0)])}}}),OutlineButton_vue_vue_type_style_index_0_scoped_56f62044_lang="",OutlineButton=_export_sfc(_sfc_main$3,[["__scopeId","data-v-56f62044"]]),_sfc_main$2=defineComponent({__name:"FormAutoFill",props:{broker:{},form:{}},setup(a){const e=a,n=window.__runs||(window.__runs={previous:[],current:[]});e.broker.on("execution:start",()=>{n.previous=n.current,n.current=[]});const s=ref(null);function r(){for(const f in n.current){const h=n.previous[f],k=n.current[f];if(!h||h.type!==k.type||h.type=="form:render-page"&&!lodash.exports.isEqual(h.widgets,k.widgets)||h.type=="form:page-response"&&!lodash.exports.isEqual(h.payload,k.payload))return null}const i=n.previous[n.current.length];if((i==null?void 0:i.type)!=="form:page-response")return null;s.value=i}function o(){const i=s.value;i&&e.broker.send(i)}return e.broker.on("form:render-page",i=>{n.current.push(i),r()}),e.broker.on("form:page-response",i=>{n.current.push(i),s.value=null}),(i,f)=>s.value?(openBlock(),createBlock(OutlineButton,{key:0,"icon-path":unref(magicWand),class:"form-auto-fill-btn",onClick:o},{default:withCtx(()=>[createTextVNode(" Repeat last answer ")]),_:1},8,["icon-path"])):createCommentVNode("",!0)}}),FormAutoFill_vue_vue_type_style_index_0_scoped_25e670dc_lang="",FormAutoFill=_export_sfc(_sfc_main$2,[["__scopeId","data-v-25e670dc"]]),_hoisted_1$1={key:0,class:"hint"},_hoisted_2$1={class:"icon",viewBox:"0 0 24 24",style:{width:"20px",height:"20px"}},_hoisted_3$1=["d"],_hoisted_4$1={class:"hint-content"},_sfc_main$1=defineComponent({__name:"WidgetHint",props:{hint:{}},setup(a){return(e,n)=>e.hint?(openBlock(),createElementBlock("div",_hoisted_1$1,[(openBlock(),createElementBlock("svg",_hoisted_2$1,[createBaseVNode("path",{d:unref(info)},null,8,_hoisted_3$1)])),createBaseVNode("div",_hoisted_4$1,toDisplayString(e.hint),1)])):createCommentVNode("",!0)}}),WidgetHint_vue_vue_type_style_index_0_scoped_9a7a836d_lang="",WidgetHint=_export_sfc(_sfc_main$1,[["__scopeId","data-v-9a7a836d"]]),_hoisted_1={key:0,class:"form-wrapper"},_hoisted_2=["id"],_hoisted_3={key:5,class:"span-error"},_hoisted_4={key:1,class:"loading-wrapper"},_hoisted_5={class:"buttons"},_sfc_main=defineComponent({__name:"FormRunner",props:{form:{},params:{},isPreview:{type:Boolean},enableAutoFocus:{type:Boolean},broker:{},disabled:{type:Boolean}},emits:["log","error","exit","navigate","logout","start","redirect"],setup(a,{expose:e,emit:n}){const s=a,r=[],o=ref({}),i=ref({}),f=ref({}),h=ref(null),k=(t,l)=>{r[l]=t},E=ref(null),C=computed(()=>PageActionsFactory.from(s.form)),N=t=>n("navigate",t),B=()=>{d.value={widgets:[{type:"start"}],actions:C.value.startAction,fullWidth:!1,steps:null}};watch(()=>s.form,()=>{var t;((t=d.value.widgets[0])==null?void 0:t.type)=="start"&&B()});const _=reactive({user:null,authenticating:!1}),d=ref({widgets:[],fullWidth:!1,actions:[],steps:null}),w=ref("idle"),L=computed(()=>d.value.widgets.filter(t=>"secret"in t).reduce((t,l)=>"key"in l&&"secret"in l?[...t,{key:l.key,secret:l.secret}]:t,[]));S();function S(){_.user=userManager.getUser()}const V=()=>{userManager.removeUser(),S(),n("logout")},v=BrokerMessageHandler.create(s.broker,C.value,{onRedirect(t,l){n("redirect",t,l)}}),P=ref(null);v.onError(t=>{n("error",t),w.value="error"}),v.onExit(t=>{n("exit",t),w.value="over"}),v.onStartAuth(t=>{t.refresh?(userManager.removeUser(),S(),_.authenticating=!0):_.user?v.sendUser(_.user):_.authenticating=!0}),v.onEndAuth(()=>{_.authenticating=!1}),v.onBadAuth(()=>{userManager.removeUser(),_.user=null,_.authenticating=!0}),v.onReactivePoll(()=>{v.sendUserEvent(o.value,L.value)});const R=t=>{_.user=t,v.sendUser(t)};v.onNewPageState(t=>{h.value=null,d.value=t;const l={},p={};d.value.widgets.forEach(m=>{isInputWidget(m)&&(l[m.key]=m.value,p[m.key]=m.errors)}),o.value=l,i.value=p,f.value={},P.value&&(P.value.scrollTop=0)}),v.listenToPageStateUpdate(t=>{h.value=null,d.value={...d.value,...t};const l={},p={};d.value.widgets.forEach(m=>{isInputWidget(m)&&(l[m.key]=m.value,p[m.key]=m.errors)}),o.value=l,i.value=p});const A=t=>{var l;if(!(w.value!=="running"||s.isPreview||!((l=window.should_ask_before_leave)==null||l)))return v.sendBrowserTryDisconnect(),t.preventDefault(),t.returnValue="Are you sure?",""};onMounted(async()=>{window.addEventListener("beforeunload",A),B(),s.form.autoStart&&x()}),onUnmounted(()=>{s.broker.close(),window.removeEventListener("beforeunload",A)});const U=()=>{r.forEach(t=>{!t||!("setErrors"in t)||typeof t.setErrors!="function"||t.setErrors()})},I=computed(()=>{var t;return((t=d.value.error)==null?void 0:t.status)===!1}),D=t=>!Object.values(f.value).some(p=>p.length>0)&&!I.value?!1:t!=="i18n_back_action",F=ref(Date.now().toString()),O=async t=>{if(w.value!=="running")return x();U(),!(Object.values(f.value).some(p=>p.length>0)&&(t==null?void 0:t.name)!=="i18n_back_action")&&(v.handleAction(o.value,t,L.value),h.value=t!=null?t:null,F.value=Date.now().toString())},x=async()=>{v.init(s.params),w.value="running",n("start")},j=async()=>{B(),s.broker.close(),w.value="idle",n("exit",{})};function T(t){var l;return isInputWidget(t)&&(l=o.value[t.key])!=null?l:null}function $(t){var u;if(!isInputWidget(t))return[];const l=t.errors.map(g=>i18nProvider.translateIfFound(g,t)),m=((u=f.value[t.key])!=null?u:[]).map(g=>i18nProvider.translateIfFound(g,t));return[...l,...m]}function M(t,l){if(!isInputWidget(t))return;const p={...o.value};p[t.key]=l,o.value=p,v.sendUserEvent(o.value)}function z(t,l){if(!isInputWidget(t))return;const p={...f.value};p[t.key]=l,f.value=p}return e({run:x,exit:j,formState:w}),(t,l)=>(openBlock(),createBlock(WidgetsFrame,{class:normalizeClass([{preview:t.isPreview},"runner"]),"main-color":t.form.mainColor,theme:t.form.theme,"font-family":t.form.fontFamily,runtime:"form"},{default:withCtx(()=>{var p,m;return[t.disabled?(openBlock(),createBlock(unref(Card),{key:0,class:"unsaved-changes"},{default:withCtx(()=>[createVNode(unref(Typography),{style:{"font-size":"18px","font-weight":"500"}},{default:withCtx(()=>[createTextVNode("You have unsaved changes")]),_:1}),createVNode(unref(Typography),{style:{"margin-bottom":"18px"}},{default:withCtx(()=>[createTextVNode("Please save to run the preview")]),_:1})]),_:1})):createCommentVNode("",!0),t.isPreview?(openBlock(),createBlock(FormAutoFill,{key:1,class:"auto-fill-btn",broker:t.broker,form:t.form,style:{"z-index":1}},null,8,["broker","form"])):createCommentVNode("",!0),createVNode(RuntimeCommons,{ref_key:"runtimeCommonsRef",ref:E,runtime:t.form,"full-width":d.value.fullWidth,"steps-info":d.value.steps,"user-email":(p=_.user)==null?void 0:p.claims.email,onLogout:V,onNavigate:N},null,8,["runtime","full-width","steps-info","user-email"]),createBaseVNode("main",{ref_key:"mainContainer",ref:P,class:normalizeClass([{disabled:t.disabled}])},[_.authenticating?(openBlock(),createBlock(Passwordless,{key:0,class:"form-auth",onDone:R})):(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(["form",{"full-width":d.value.fullWidth}])},[d.value.widgets.length>0?(openBlock(),createElementBlock("div",_hoisted_1,[d.value.widgets[0].type=="start"?(openBlock(),createBlock(StartWidget,{key:0,form:t.form},null,8,["form"])):d.value.widgets[0].type=="end"?(openBlock(),createBlock(EndWidget,{key:1,"end-message":t.form.endMessage},null,8,["end-message"])):d.value.widgets[0].type=="error"?(openBlock(),createBlock(ErrorWidget,{key:2,"error-message":t.form.errorMessage},null,8,["error-message"])):d.value.widgets[0].type=="lock-failed"?(openBlock(),createBlock(_sfc_main$4,{key:3,status:d.value.widgets[0].status},null,8,["status"])):(openBlock(!0),createElementBlock(Fragment,{key:4},renderList(d.value.widgets,(u,g)=>{var W;return openBlock(),createElementBlock("div",{id:u.type+g,key:(W=u.key)!=null?W:u.type+g,class:"widget"},[(openBlock(),createBlock(resolveDynamicComponent(u.type),{ref_for:!0,ref:y=>k(y,g),value:T(u),errors:$(u),"user-props":u,"refresh-key":F.value,runtime:"form","onUpdate:value":y=>M(u,y),"onUpdate:errors":y=>z(u,y)},null,40,["value","errors","user-props","refresh-key","onUpdate:value","onUpdate:errors"])),createVNode(WidgetHint,{hint:"hint"in u?u.hint:null},null,8,["hint"]),(openBlock(!0),createElementBlock(Fragment,null,renderList($(u),y=>(openBlock(),createElementBlock("span",{key:y,class:"span-error"},toDisplayString(y),1))),128))],8,_hoisted_2)}),128)),I.value?(openBlock(),createElementBlock("span",_hoisted_3,toDisplayString(((m=d.value.error)==null?void 0:m.message)||unref(i18nProvider).translateIfFound("i18n_generic_validation_error")),1)):createCommentVNode("",!0)])):(openBlock(),createElementBlock("div",_hoisted_4,[createVNode(LoadingIndicator)])),createBaseVNode("div",_hoisted_5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.value.actions,u=>{var g;return openBlock(),createBlock(ActionButton,{key:u.name,disabled:D(u.name),loading:((g=h.value)==null?void 0:g.name)==u.name,"display-name":unref(i18nProvider).translateIfFound(u.name),action:u,onClick:W=>O(u)},null,8,["disabled","loading","display-name","action","onClick"])}),128))])],2))],2)]}),_:1},8,["class","main-color","theme","font-family"]))}}),FormRunner_vue_vue_type_style_index_0_scoped_fb75bcf7_lang="",FormRunner=_export_sfc(_sfc_main,[["__scopeId","data-v-fb75bcf7"]]);export{FormRunner as F,RemoteBroker as R,redirect as r};
//# sourceMappingURL=FormRunner.2e2448bf.js.map

var ye=Object.defineProperty;var fe=(s,e,a)=>e in s?ye(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a;var U=(s,e,a)=>(fe(s,typeof e!="symbol"?e+"":e,a),a);import{a as L}from"./asyncComputed.b977e570.js";import{d as b,r as E,b as m,c as g,w as l,u as t,f as n,cG as R,cD as M,au as h,ah as q,am as ge,bI as _,N,bB as T,y as K,eS as Q,ey as W,eH as he,eJ as ve,aG as X,ct as Y,eG as _e,o as we,eA as $}from"./outputWidgets.8a57432e.js";import{A as be}from"./index.c7cc1675.js";import{_ as Ce}from"./DocsButton.vue_vue_type_script_setup_true_lang.bbc591d6.js";import{A as w,F}from"./Form.1346885e.js";import{A as B}from"./index.d04f4f57.js";import{C as ee}from"./CrudView.ba85f7d8.js";import{G as te}from"./PhPencil.vue.cabbba51.js";import{A as ke}from"./index.7b1e9218.js";import{C as Pe}from"./repository.3f12b883.js";import{C as A}from"./gateway.5b50c65a.js";import{E as ae}from"./record.639044d8.js";import{p as k}from"./popupNotifcation.3975178a.js";import{a as Z}from"./ant-design.6e8a5c56.js";import{A as Ue}from"./Title.b43010e0.js";import{A as Ae}from"./Paragraph.81c1f36c.js";import{A as H,T as Re}from"./TabPane.be2331c4.js";import"./BookOutlined.70d8e637.js";import"./hasIn.cd8b8ea3.js";import"./isNumeric.75337b1e.js";import"./router.b4a06dcc.js";import"./url.111ab675.js";import"./Modal.adda7bc8.js";import"./Text.bb9224c4.js";import"./Base.2f04b24d.js";import"./fetch.b416d74b.js";import"./pubsub.f6510647.js";import"./index.063aebdc.js";import"./PlusOutlined.cf52d035.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="13184035-2236-4ba0-91a0-091ea0f33439",s._sentryDebugIdIdentifier="sentry-dbid-13184035-2236-4ba0-91a0-091ea0f33439")}catch{}})();const Ee=b({__name:"View",props:{signupPolicy:{}},emits:["updated","save"],setup(s,{emit:e}){const a=s,o=E(a.signupPolicy.strategy),r=E(a.signupPolicy.strategy==="patternOnly"?a.signupPolicy.emailPatterns:[]),i=E(a.signupPolicy.strategy==="patternOnly"?a.signupPolicy.emailPatterns.map(c=>({label:c})):[]),y=c=>{const C=c;if(r.value=C,C.length===0){o.value="inviteOnly",f("inviteOnly");return}i.value=C.map(P=>({label:P})),a.signupPolicy.emailPatterns=c,e("updated",a.signupPolicy)},p=()=>{e("save")},f=c=>{o.value=c,c!=="patternOnly"&&(c==="inviteOnly"&&a.signupPolicy.allowOnlyInvited(),e("updated",a.signupPolicy))};return(c,C)=>(m(),g(t(be),{style:{"padding-top":"8px",width:"100%"},justify:"space-between",align:"flex-end"},{default:l(()=>[n(t(ge),{value:o.value,"onUpdate:value":f},{default:l(()=>[n(t(R),{direction:"vertical"},{default:l(()=>[n(t(M),{value:"inviteOnly"},{default:l(()=>[h("Allow listed users only")]),_:1}),n(t(R),null,{default:l(()=>[n(t(M),{value:"patternOnly"},{default:l(()=>[h("Allow everyone from this domain:")]),_:1}),n(t(q),{mode:"tags",value:c.signupPolicy.emailPatterns,style:{"min-width":"300px"},placeholder:"@domain.com or sub.domain.com",disabled:o.value!=="patternOnly",options:i.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":y},null,8,["value","disabled","options"])]),_:1})]),_:1})]),_:1},8,["value"]),n(t(_),{disabled:!c.signupPolicy.hasChanges,type:"primary",onClick:p},{default:l(()=>[h(" Save changes ")]),_:1},8,["disabled"])]),_:1}))}}),xe=b({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(s,{emit:e}){const o=s.roleOptions.map(p=>({label:p.name,value:p.name})),r=N({email:"",roles:[]});function i(){e("cancel")}function y(){!r.email||e("created",r)}return(p,f)=>(m(),g(t(B),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:l(()=>[n(t(R),null,{default:l(()=>[n(t(_),{onClick:i},{default:l(()=>[h("Cancel")]),_:1}),n(t(_),{type:"primary",onClick:y},{default:l(()=>[h("Submit")]),_:1})]),_:1})]),default:l(()=>[n(t(F),{model:r,layout:"vertical"},{default:l(()=>[n(t(w),{key:"email",label:"Email",required:!0},{default:l(()=>[n(t(T),{value:r.email,"onUpdate:value":f[0]||(f[0]=c=>r.email=c)},null,8,["value"])]),_:1}),n(t(w),{key:"role",label:"Role"},{default:l(()=>[n(t(q),{value:r.roles,"onUpdate:value":f[1]||(f[1]=c=>r.roles=c),mode:"multiple",options:t(o)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Oe=b({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(s,{emit:e}){const a=s,o=a.roleOptions.map(p=>({label:p.name,value:p.name})),r=N({email:a.email,roles:a.roles});function i(){e("cancel")}function y(){e("updated",r)}return(p,f)=>(m(),g(t(B),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:l(()=>[n(t(R),null,{default:l(()=>[n(t(_),{onClick:i},{default:l(()=>[h("Cancel")]),_:1}),n(t(_),{type:"primary",onClick:y},{default:l(()=>[h("Submit")]),_:1})]),_:1})]),default:l(()=>[n(t(F),{model:r,layout:"vertical"},{default:l(()=>[n(t(w),{key:"email",label:"Email"},{default:l(()=>[n(t(T),{value:r.email,"onUpdate:value":f[0]||(f[0]=c=>r.email=c)},null,8,["value"])]),_:1}),n(t(w),{key:"role",label:"Role"},{default:l(()=>[n(t(q),{value:r.roles,"onUpdate:value":f[1]||(f[1]=c=>r.roles=c),mode:"multiple",options:t(o)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),De=b({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(s){const e=s,a=K(()=>{var o;return{columns:[{name:"Email"},{name:"Roles"},{name:"",align:"right"}],rows:(o=e.users.map(r=>({key:r.email,cells:[{type:"text",text:r.email},{type:"slot",key:"roles",payload:{roles:r.roles}},{type:"actions",actions:[{icon:te,label:"Edit",onClick:()=>e.onEdit(r)},{icon:Q,label:"Delete",onClick:()=>e.onDelete(r)}]}]})))!=null?o:[]}});return(o,r)=>(m(),g(ee,{"entity-name":"users",title:"",loading:o.loading,description:"List all app users.","empty-title":"No users yet",table:a.value,"create-button-text":"Add users",onCreate:o.onCreate},{roles:l(({payload:i})=>[(m(!0),W(X,null,he(i.roles,y=>(m(),g(t(ke),{key:y,bordered:""},{default:l(()=>[h(ve(y),1)]),_:2},1024))),128))]),_:1},8,["loading","table","onCreate"]))}}),Ie=b({__name:"NewRole",emits:["created","cancel"],setup(s,{emit:e}){const a=N({name:"",description:""});function o(){e("cancel")}function r(){!a.name||e("created",a)}return(i,y)=>(m(),g(t(B),{open:"",title:"New role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:o},{extra:l(()=>[n(t(R),null,{default:l(()=>[n(t(_),{onClick:o},{default:l(()=>[h("Cancel")]),_:1}),n(t(_),{type:"primary",onClick:r},{default:l(()=>[h("Submit")]),_:1})]),_:1})]),default:l(()=>[n(t(F),{model:a,layout:"vertical"},{default:l(()=>[n(t(w),{key:"name",label:"Name",required:!0},{default:l(()=>[n(t(T),{value:a.name,"onUpdate:value":y[0]||(y[0]=p=>a.name=p)},null,8,["value"])]),_:1}),n(t(w),{key:"description",label:"Description"},{default:l(()=>[n(t(Y),{value:a.description,"onUpdate:value":y[1]||(y[1]=p=>a.description=p),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),$e=b({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(s,{emit:e}){const a=s,o=N({description:a.description});function r(){e("cancel")}function i(){e("updated",o)}return(y,p)=>(m(),g(t(B),{open:"",title:"Update role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:r},{extra:l(()=>[n(t(R),null,{default:l(()=>[n(t(_),{onClick:r},{default:l(()=>[h("Cancel")]),_:1}),n(t(_),{type:"primary",onClick:i},{default:l(()=>[h("Submit")]),_:1})]),_:1})]),default:l(()=>[n(t(F),{model:o,layout:"vertical"},{default:l(()=>[n(t(w),{key:"name",label:"Name"},{default:l(()=>[n(t(T),{value:a.name,disabled:""},null,8,["value"])]),_:1}),n(t(w),{key:"role",label:"Role"},{default:l(()=>[n(t(Y),{value:o.description,"onUpdate:value":p[0]||(p[0]=f=>o.description=f),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),je=b({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(s){const e=s,a=K(()=>{var o;return{columns:[{name:"Name"},{name:"Description"},{name:"",align:"right"}],rows:(o=e.roles.map(r=>({key:r.id,cells:[{type:"text",text:r.name},{type:"text",text:r.description},{type:"actions",actions:[{icon:te,label:"Edit",onClick:()=>e.onEdit(r)},{icon:Q,label:"Delete",onClick:()=>e.onDelete(r)}]}]})))!=null?o:[]}});return(o,r)=>(m(),g(ee,{"entity-name":"roles",loading:o.loading,title:"",description:"List all app roles.","empty-title":"No roles yet",table:a.value,"create-button-text":"Add roles",onCreate:o.onCreate},null,8,["loading","table","onCreate"]))}}),S=class{constructor(e){U(this,"record");this.dto=e,this.record=ae.from(e)}static from(e){return new S(e)}toDTO(){return this.record.toDTO()}get id(){return this.record.get("id")}get projectId(){return this.record.get("projectId")}get emailPatterns(){return this.record.get("emailPatterns")}set emailPatterns(e){this.record.set("emailPatterns",e)}get hasChanges(){return this.record.hasChangesDeep("emailPatterns")}get strategy(){return this.dto.emailPatterns.length===0?"inviteOnly":"patternOnly"}get changes(){return this.record.changes}allowOnlyInvited(){this.record.set("emailPatterns",[])}static validate(e){return S.pattern.test(e)}};let x=S;U(x,"pattern",new RegExp("^@?(?!-)[A-Za-z0-9-]{1,}(?<!-)(\\.[A-Za-z]{2,})+$"));class Se{constructor(){U(this,"urlPath","signup-policy")}async update(e,a){return A.patch(`projects/${e}/${this.urlPath}`,a)}async get(e){return A.get(`projects/${e}/${this.urlPath}`)}}const J=new Se;class Ne{constructor(e){this.projectId=e}async update(e){const{emailPatterns:a}=e.changes;if(!a)return e;const o=await J.update(this.projectId,{emailPatterns:a});return x.from(o)}async get(){const e=await J.get(this.projectId);return x.from(e)}}class z{constructor(e){U(this,"record");this.dto=e,this.record=ae.from(e)}static from(e){return new z(e)}toDTO(){return this.record.toDTO()}get changes(){return this.record.changes}get id(){return this.record.get("id")}get email(){return this.record.get("email")}set email(e){this.record.set("email",e)}get projectId(){return this.record.get("projectId")}get roles(){return this.record.get("roles")}set roles(e){this.record.set("roles",e)}update(e){this.record.update(e)}resetChanges(){this.record.resetChanges()}}class Te{constructor(){U(this,"urlPath","users")}async create(e,a){return A.post(`projects/${e}/${this.urlPath}`,a)}async delete(e,a){await A.delete(`projects/${e}/${this.urlPath}/${a}`)}async list(e,{limit:a,offset:o}){const r={};a&&(r.limit=a.toString()),o&&(r.offset=o.toString());const i=new URLSearchParams(r);return A.get(`projects/${e}/${this.urlPath}?${i.toString()}`)}async update(e,a,o){return A.patch(`projects/${e}/${this.urlPath}/${a}`,o)}}const j=new Te;class Fe{constructor(e){this.projectId=e}async create(e){await j.create(this.projectId,e)}async update(e,a){await j.update(this.projectId,e,a)}async delete(e){await j.delete(this.projectId,e)}async list(e,a){return(await j.list(this.projectId,{limit:e,offset:a})).map(z.from)}}const ft=b({__name:"View",setup(s){const a=_e().params.projectId,o=E({type:"initial"}),r=E("users");we(()=>{const d=new URLSearchParams(location.search).get("selected-panel")||"users",v=["roles","users"].includes(d)?d:"users";d&&(r.value=v)});const i=()=>{o.value.type="initial"},y=()=>{o.value.type="creatingUser"},p=u=>{o.value={type:"editingUser",payload:u}},f=()=>{o.value.type="creatingRole"},c=u=>{o.value={type:"editingRole",payload:u}},C=new Ne(a),{result:P,refetch:oe}=L(()=>C.get()),re=async()=>{if(!!P.value)try{await C.update(P.value),oe()}catch(u){u instanceof Error&&k("Update Error",u.message)}},O=new Fe(a),{loading:ne,result:le,refetch:D}=L(()=>O.list(100,0)),I=new Pe(a),{loading:se,result:V,refetch:G}=L(()=>I.list(100,0)),ie=async u=>{try{if(o.value.type!=="creatingUser")return;await O.create(u),i(),D()}catch(d){d instanceof Error&&k("Create Error",d.message)}},ce=async u=>{try{if(o.value.type!=="editingUser")return;await O.update(o.value.payload.id,u),i(),D()}catch(d){d instanceof Error&&k("Update Error",d.message)}},ue=async u=>{if(!!await Z("Deleteing users revoke their access to your application in case they aren't allowed to self sign-up. Are you sure you want to continue?"))try{await O.delete(u.id),D()}catch(v){v instanceof Error&&k("Delete Error",v.message)}},de=async u=>{try{if(o.value.type!=="creatingRole")return;await I.create(u),i(),G()}catch(d){d instanceof Error&&k("Create Error",d.message)}},pe=async u=>{try{if(o.value.type!=="editingRole")return;await I.update(o.value.payload.id,u),i(),G()}catch(d){d instanceof Error&&k("Update Error",d.message)}},me=async u=>{if(!!await Z("Deleteing roles may revoke access to some features in your application. Are you sure you want to continue?"))try{await I.delete(u.id),G(),D()}catch(v){v instanceof Error&&k("Delete Error",v.message)}};return(u,d)=>(m(),W(X,null,[n(t(Ue),null,{default:l(()=>[h("Access Control")]),_:1}),n(t(Ae),null,{default:l(()=>[h(" Manage how your end users interect with your application. "),n(Ce,{path:"concepts/access-control"})]),_:1}),n(t(Re),{"active-key":r.value,"onUpdate:activeKey":d[0]||(d[0]=v=>r.value=v)},{default:l(()=>[n(t(H),{key:"users",tab:"Users"}),n(t(H),{key:"roles",tab:"Roles"})]),_:1},8,["active-key"]),r.value==="users"&&t(P)?(m(),g(Ee,{key:0,"signup-policy":t(P),onSave:re},null,8,["signup-policy"])):$("",!0),r.value==="users"?(m(),g(De,{key:1,loading:t(ne),users:t(le)||[],onCreate:y,onEdit:p,onDelete:ue},null,8,["loading","users"])):$("",!0),r.value==="roles"?(m(),g(je,{key:2,loading:t(se),roles:t(V)||[],onCreate:f,onEdit:c,onDelete:me},null,8,["loading","roles"])):$("",!0),o.value.type==="creatingUser"?(m(),g(xe,{key:3,"role-options":t(V)||[],onCancel:i,onCreated:ie},null,8,["role-options"])):o.value.type==="editingUser"?(m(),g(Oe,{key:4,email:o.value.payload.email,roles:o.value.payload.roles||[],"role-options":t(V)||[],onUpdated:ce,onCancel:i},null,8,["email","roles","role-options"])):o.value.type==="creatingRole"?(m(),g(Ie,{key:5,onCancel:i,onCreated:de})):o.value.type==="editingRole"?(m(),g($e,{key:6,name:o.value.payload.name,description:o.value.payload.description,onUpdated:pe,onCancel:i},null,8,["name","description"])):$("",!0)],64))}});export{ft as default};
//# sourceMappingURL=View.2200daf5.js.map

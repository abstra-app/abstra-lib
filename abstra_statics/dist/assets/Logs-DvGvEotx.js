import{a as ge,j as de,c as ae,k as B,f as m,l as De,e as ue,m as L,n as Re,r as D,s as Ce,N as Se,af as Te,H as Le,$ as Pe,a0 as je,b as U,bm as Ee,u as e,E as fe,w as l,h as o,b4 as pe,g as re,t as G,T as ze,ag as Ne,p as $e,ak as Oe,i as v,ba as we,b5 as J,b3 as We,b6 as oe,Q as Ue,Z as Be,bh as Ze,bi as Fe,bj as be,J as He,c3 as Ve,bq as Xe,c8 as se,bp as ce,aK as qe}from"./jwt-decode.esm-BT0CZMUi.js";import{R as Me,u as Ge,L as Ye,E as Ke}from"./ExecutionContext-uoCJC4LH.js";import{c as ve,d as ee,e as Qe,f as Je}from"./router-Dy-EE0-5.js";import{a as et,b as tt}from"./build-DfO6HJ2t.js";import"./tables-AyQXRFEo.js";import{G as at}from"./PhDotsThreeVertical.vue-DvLSLDTG.js";import{I as nt}from"./PhStop.vue-CTV4rmWL.js";import{S as xe}from"./index-CyCT7jv-.js";import{T as ot,A as he}from"./index-BnEUKty4.js";import{L as ke}from"./LoadingOutlined-1dKWuDjC.js";import{R as Ie}from"./dayjs-DughKb4R.js";import"./string-DkM9Shp8.js";import"./polling-C_uxciAF.js";import"./ant-design-B_izXXiv.js";import"./PhCopy.vue-C_2DMPDV.js";import"./PhRobot.vue-BHb-Lg6q.js";import"./ts.worker-DKBPHUqu.js";import"./record-Bo4Wk8Mz.js";(function(){try{var k=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new Error().stack;u&&(k._sentryDebugIds=k._sentryDebugIds||{},k._sentryDebugIds[u]="94a4e676-ca32-4d80-80e6-fc2684063514",k._sentryDebugIdIdentifier="sentry-dbid-94a4e676-ca32-4d80-80e6-fc2684063514")}catch{}})();const st=["width","height","fill","transform"],lt={key:0},it=L("path",{d:"M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"},null,-1),rt=[it],ut={key:1},dt=L("path",{d:"M218.34,119.6,183.6,154.34a46.58,46.58,0,0,1-44.31,12.26c-.31.34-.62.67-.95,1L103.6,202.34A46.63,46.63,0,1,1,37.66,136.4L72.4,101.66A46.6,46.6,0,0,1,116.71,89.4c.31-.34.62-.67,1-1L152.4,53.66a46.63,46.63,0,0,1,65.94,65.94Z",opacity:"0.2"},null,-1),ct=L("path",{d:"M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,7.78,8.22H152a8,8,0,0,0,8-7.78A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"},null,-1),ft=[dt,ct],pt={key:2},gt=L("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM115.7,192.49a43.31,43.31,0,0,1-55-66.43l25.37-25.37a43.35,43.35,0,0,1,61.25,0,42.9,42.9,0,0,1,9.95,15.43,8,8,0,1,1-15,5.6A27.33,27.33,0,0,0,97.37,112L72,137.37a27.32,27.32,0,0,0,34.68,41.91,8,8,0,1,1,9,13.21Zm79.61-62.55-25.37,25.37A43,43,0,0,1,139.32,168h0a43.35,43.35,0,0,1-40.53-28.12,8,8,0,1,1,15-5.6A27.35,27.35,0,0,0,139.28,152h0a27.14,27.14,0,0,0,19.32-8L184,118.63a27.32,27.32,0,0,0-34.68-41.91,8,8,0,1,1-9-13.21,43.32,43.32,0,0,1,55,66.43Z"},null,-1),vt=[gt],ht={key:3},mt=L("path",{d:"M238,88.18a52.42,52.42,0,0,1-15.4,35.66l-34.75,34.75A52.28,52.28,0,0,1,150.62,174h-.05A52.63,52.63,0,0,1,98,119.9a6,6,0,0,1,6-5.84h.17a6,6,0,0,1,5.83,6.16A40.62,40.62,0,0,0,150.58,162h0a40.4,40.4,0,0,0,28.73-11.9l34.75-34.74A40.63,40.63,0,0,0,156.63,57.9l-11,11a6,6,0,0,1-8.49-8.49l11-11a52.62,52.62,0,0,1,74.43,0A52.83,52.83,0,0,1,238,88.18Zm-127.62,98.9-11,11A40.36,40.36,0,0,1,70.6,210h0a40.63,40.63,0,0,1-28.7-69.36L76.62,105.9A40.63,40.63,0,0,1,146,135.77a6,6,0,0,0,5.83,6.16H152a6,6,0,0,0,6-5.84A52.63,52.63,0,0,0,68.14,97.42L33.38,132.16A52.63,52.63,0,0,0,70.56,222h0a52.26,52.26,0,0,0,37.22-15.42l11-11a6,6,0,1,0-8.49-8.48Z"},null,-1),yt=[mt],_t={key:4},wt=L("path",{d:"M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,16,.45A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"},null,-1),bt=[wt],xt={key:5},kt=L("path",{d:"M236,88.12a50.44,50.44,0,0,1-14.81,34.31l-34.75,34.74A50.33,50.33,0,0,1,150.62,172h-.05A50.63,50.63,0,0,1,100,120a4,4,0,0,1,4-3.89h.11a4,4,0,0,1,3.89,4.11A42.64,42.64,0,0,0,150.58,164h0a42.32,42.32,0,0,0,30.14-12.49l34.75-34.74a42.63,42.63,0,1,0-60.29-60.28l-11,11a4,4,0,0,1-5.66-5.65l11-11A50.64,50.64,0,0,1,236,88.12ZM111.78,188.49l-11,11A42.33,42.33,0,0,1,70.6,212h0a42.63,42.63,0,0,1-30.11-72.77l34.75-34.74A42.63,42.63,0,0,1,148,135.82a4,4,0,0,0,8,.23A50.64,50.64,0,0,0,69.55,98.83L34.8,133.57A50.63,50.63,0,0,0,70.56,220h0a50.33,50.33,0,0,0,35.81-14.83l11-11a4,4,0,1,0-5.65-5.66Z"},null,-1),It=[kt],At={name:"PhLink"},St=ge({...At,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(k){const u=k,I=de("weight","regular"),R=de("size","1em"),S=de("color","currentColor"),z=de("mirrored",!1),y=ae(()=>u.weight??I),C=ae(()=>u.size??R),_=ae(()=>u.color??S),A=ae(()=>u.mirrored!==void 0?u.mirrored?"scale(-1, 1)":void 0:z?"scale(-1, 1)":void 0);return(Y,w)=>(m(),B("svg",Re({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:C.value,height:C.value,fill:_.value,transform:A.value},Y.$attrs),[De(Y.$slots,"default"),y.value==="bold"?(m(),B("g",lt,rt)):y.value==="duotone"?(m(),B("g",ut,ft)):y.value==="fill"?(m(),B("g",pt,vt)):y.value==="light"?(m(),B("g",ht,yt)):y.value==="regular"?(m(),B("g",_t,bt)):y.value==="thin"?(m(),B("g",xt,It)):ue("",!0)],16,st))}}),Tt={0:"pending",1:"running",2:"finished",3:"failed"};function Ae(k){return new Worker("/assets/timeline.worker-CTtnDIl5.js",{type:"module",name:k?.name})}function Et(){const k=D(!0),u=D(!1),I=D(null),R=D([]),S=D([]),z=Ce([]),y=new Map,C=D(Date.now()),_=D(Date.now()),A=D(Date.now()-6e4),Y=D(null);let w=null,K=null;const P=new Me,j=200,T=ae(()=>{const p=(_.value-A.value)/6e4;return p<10?1:p<60?5:p<720?30:p<1440?60:p<1440*7?360:1440}),n=ae(()=>{const b=T.value*6e4,E=Math.floor(A.value/b)*b,N=Math.ceil(_.value/b)*b,M=[];for(let $=E;$<=N;$+=b)M.push(new Date($));return M});function Z(p){return y.get(p)}function V(p,b){w||(w=new Ae,X()),w.postMessage({type:"initCanvas",payload:{canvas:p,pixelRatio:b}},[p])}function X(){w&&(w.onmessage=p=>{const{buffers:b}=p.data;b&&(z.value=b)})}function F(p,b,E=!1){if(!w)return;const N=p.map(M=>{const $=M.context,r=$?.sentTasks?[...$.sentTasks]:[];return{id:M.id,stageId:M.stageId,createdAt:M.createdAt.getTime(),updatedAt:M.updatedAt.getTime(),sentTasks:r,triggerTaskId:$?.taskId||void 0,status:M.status,shortId:M.shortId,context:M.context}});w.postMessage({type:"data",payload:{executions:N,tasks:b,reset:E}})}function Q(){w&&w.postMessage({type:"stagesList",payload:JSON.parse(JSON.stringify(S.value))})}function s(p){w&&w.postMessage({type:"view",payload:p})}function t(){w&&w.postMessage({type:"view",payload:{now:C.value,viewStart:A.value,viewEnd:_.value,spacerWidth:j,rootId:Y.value}})}async function a(p,b){const E=new Set,N=[b];let M=0;const $=1e3;u.value=!0;const r=new Set;try{for(;N.length>0&&M<$;){const i=N.shift();if(E.has(i))continue;E.add(i),M++;let f=y.get(i);if(f||(f=await P.get(p,i),y.set(f.id,f)),!r.has(f.stageId)){r.add(f.stageId);const d=R.value.filter(H=>r.has(H.id));d.length!==S.value.length&&(S.value=d,Q())}const c=await P.getExecutionTasks(p,i),x={};if(c.sentTasks.forEach(d=>{x[d.id]={start:new Date(d.created.at).getTime(),end:d.completed?new Date(d.completed.at).getTime():void 0}}),c.triggerTask){const d=c.triggerTask;x[d.id]={start:new Date(d.created.at).getTime(),end:d.completed?new Date(d.completed.at).getTime():void 0}}if(F([f],x,!1),i===b){const d=f.createdAt.getTime(),H=f.updatedAt.getTime(),g=Math.max(1e3,H-d);A.value=d-g,_.value=H+g,k.value=!1}c.triggerTask&&c.triggerTask.created.byExecutionId&&(E.has(c.triggerTask.created.byExecutionId)||N.push(c.triggerTask.created.byExecutionId)),c.sentTasks.forEach(d=>{d.completed&&d.completed.byExecutionId&&(E.has(d.completed.byExecutionId)||N.push(d.completed.byExecutionId))})}}catch(i){console.error("Error loading thread",i),I.value="Failed to load execution thread."}finally{u.value=!1,k.value=!1}}async function h(p,b){if(k.value=!0,I.value=null,S.value=[],R.value=[],z.value=[],C.value=Date.now(),y.clear(),!b){I.value="No execution ID provided.",k.value=!1;return}Y.value=b,w||(w=new Ae,X()),K||(K=setInterval(()=>{C.value=Date.now()},6e4));try{const E=await P.get(p,b);if(y.set(E.id,E),E.buildId){const N=await et.get(E.buildId);N&&(R.value=N.runtimesSorted)}F([],{},!0),await a(p,b)}catch(E){I.value="Failed to load data.",console.error(E),k.value=!1}}function ne(){w&&(w.terminate(),w=null),K&&(clearInterval(K),K=null)}return Se([S,C,A,_],()=>{t()}),{initialLoading:k,loadingGraph:u,error:I,stages:S,stageBuffers:z,viewStart:A,viewEnd:_,now:C,timelineInterval:T,moments:n,init:h,cleanup:ne,postDataToWorker:F,initCanvas:V,updateView:s,getExecution:Z}}const Mt={style:{height:"100%","min-height":"400px",position:"relative",overflow:"hidden"}},Dt={key:2,style:{position:"absolute",top:"10px",right:"220px","z-index":"10","pointer-events":"none"}},W=200,le=32,ie=40,Rt=ge({__name:"TimelineComponent",props:{projectId:{},execution:{}},setup(k){const u=k,I=Te(),{initialLoading:R,loadingGraph:S,error:z,stages:y,stageBuffers:C,viewStart:_,viewEnd:A,init:Y,cleanup:w,initCanvas:K,updateView:P}=Et(),j=D(null),T=D(null),n=D(0),Z=D(null),V=D(!1),X=D(0),F=D(0),Q=ae(()=>{const r=T.value;if(!r)return 0;const i=r.height/window.devicePixelRatio-le;return Math.max(0,y.value.length*ie-i)});function s(r){if(!j.value)return 0;const i=j.value.clientWidth-W,f=A.value-_.value,c=r-W;return _.value+c/i*f}function t(r){if(!j.value)return 0;const i=j.value.clientWidth-W,f=A.value-_.value,c=r-_.value;return W+c/f*i}function a(r){if(!T.value)return{x:0,y:0};const i=T.value.getBoundingClientRect();return{x:r.clientX-i.left,y:r.clientY-i.top}}function h(r,i){const f=i-le;if(r>W){const c=s(r),x=f+n.value;if(x>=0){const d=Math.floor(x/ie);if(d>=0&&d<y.value.length){const H=y.value[d],g=C.value.find(q=>q.stageId===H.id);if(g){const q=g.count;for(let O=0;O<q;O++){const me=g.starts[O],ye=g.ends[O];if(c>=me&&c<=ye){const _e=d*ie+(ie-24)/2;if(x>=_e&&x<=_e+24)return{type:"execution",data:{id:g.ids[O],status:Tt[g.statuses[O]]||"unknown",start:me,end:ye}}}}}}}}return null}const ne=r=>{const{x:i,y:f}=a(r),c=f-le+n.value,x=Math.floor(c/ie);if(x>=0&&x<y.value.length&&f>le){const g=y.value[x];Z.value!==g.id&&(Z.value=g.id,P({hoveredStageId:g.id}))}else Z.value!==null&&(Z.value=null,P({hoveredStageId:null}));if(V.value){F.value=s(i);const g=t(X.value)-W,q=t(F.value)-W;P({selection:{active:!0,start:g,end:q}})}let d={visible:!1,x:0,label:""},H={visible:!1,x:0,y:0,title:"",items:[]};if(i>W){const g=s(i),q=new Date(g);if(!isNaN(q.getTime())){const O=q.toLocaleString([],{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});d={visible:!0,x:i-W,label:O}}}if(i>W&&f>le){const g=h(i,f);if(g){document.body.style.cursor="pointer";const O=((g.data.end-g.data.start)/1e3).toFixed(3)+" s";H={visible:!0,x:i,y:f,title:g.type==="execution"?"Execution":"Task",items:[`Status: ${g.data.status}`,`ID: ${g.data.id}`,`Duration: ${O}`]}}else document.body.style.cursor="default"}else document.body.style.cursor="default";P({cursor:d,tooltip:H})},p=()=>{P({cursor:{visible:!1,x:0},tooltip:{visible:!1,x:0,y:0},hoveredStageId:null}),Z.value=null,document.body.style.cursor="default"},b=r=>{const{x:i,y:f}=a(r);if(i<=W)return;const c=h(i,f);c&&c.type==="execution"||(V.value=!0,X.value=s(i),F.value=X.value)},E=r=>{const{x:i,y:f}=a(r);if(V.value){const c=Math.min(X.value,F.value),x=Math.max(X.value,F.value);x-c>100&&(_.value=c,A.value=x),V.value=!1,P({selection:{active:!1,start:0,end:0}})}else{const c=h(i,f);if(c&&c.type==="execution"){const x=I.resolve({name:"logs",params:{projectId:u.projectId},query:{executionId:c.data.id}});window.open(x.href,"_blank")}}},N=r=>{if(!j.value)return;const i=j.value.clientWidth-W,f=A.value-_.value;if(r.ctrlKey){const x=Math.exp(-r.deltaY*.005),d=f/x;if(d<100||d>1e3*60*60*24*365*10)return;const H=T.value.getBoundingClientRect(),g=r.clientX-H.left-W,O=_.value+g/i*f-g/i*d;_.value=O,A.value=O+d}else{const c=i/(f/6e4),x=r.deltaX/c*6e4;_.value+=x,A.value+=x,n.value=Math.max(0,Math.min(Q.value,n.value+r.deltaY)),P({scrollTop:n.value})}},M=r=>{r.key==="Escape"&&V.value&&(V.value=!1,P({selection:{active:!1,start:0,end:0}}))},$=()=>{j.value&&P({viewportWidth:j.value.clientWidth,viewportHeight:j.value.clientHeight})};return Le(async()=>{if(window.addEventListener("resize",$),window.addEventListener("keydown",M),T.value){const r=T.value.transferControlToOffscreen();K(r,window.devicePixelRatio)}await Pe(),$(),await Y(u.projectId,u.execution.id)}),je(()=>{w(),window.removeEventListener("resize",$),window.removeEventListener("keydown",M)}),(r,i)=>(m(),B("div",Mt,[L("div",{ref_key:"canvasContainerRef",ref:j,style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},[L("canvas",{ref_key:"canvasRef",ref:T,style:{display:"block",width:"100%",height:"100%"},onMousemove:ne,onMouseleave:p,onMousedown:b,onMouseup:E,onWheel:Ee(N,["prevent"])},null,544)],512),e(R)?(m(),U(e(fe),{key:0,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"20",background:"#fff"},justify:"center",align:"center"},{default:l(()=>[o(e(pe),{size:"large"})]),_:1})):e(z)?(m(),U(e(fe),{key:1,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"20",background:"#fff"},justify:"center",align:"center"},{default:l(()=>[o(e(ze),{type:"danger"},{default:l(()=>[re(G(e(z)),1)]),_:1})]),_:1})):ue("",!0),e(S)&&!e(R)?(m(),B("div",Dt,[o(e(pe))])):ue("",!0)]))}});class te{constructor(u,I,R,S){this.major=u,this.minor=I,this.patch=R,this.dev=S}static from(u){if(u===null)return new te(0,0,0);const I=/^(\d+\.\d+\.\d+)(.dev(\d+))?$/,R=u.match(I);if(!R)return new te(0,0,0);const[,S,,z]=R,[y,C,_]=S.split(".").map(Number),A=z?Number(z):void 0;return isNaN(y)||isNaN(C)||isNaN(_)?new te(0,0,0):A&&isNaN(A)?new te(0,0,0):new te(y,C,_,A)}gte(u){return this.major!==u.major?this.major>=u.major:this.minor!==u.minor?this.minor>=u.minor:this.patch>=u.patch}get version(){const u=this.dev?`.dev${this.dev}`:"";return`${this.major}.${this.minor}.${this.patch}${u}`}}const Ct={class:"execution-header"},Lt={class:"execution-header-left"},Pt={key:0,class:"status-spinner"},jt={class:"execution-info"},zt={class:"execution-stage"},Nt={class:"execution-meta"},$t={class:"execution-time"},Ot={key:0,style:{display:"flex",width:"100%","justify-content":"center"}},Wt=ge({__name:"Logs",props:{executionRepository:{},buildRepository:{},showAllFilters:{type:Boolean}},setup(k){const u=k,I=Ne(),R=Te(),S=I.params.projectId,z=I.query.executionId;function y(){const{stageId:s,buildId:t,status:a,startDate:h,endDate:ne,executionId:p}=I.query;return h&&ne?{stageId:s,buildId:t,status:a,dateRange:[se(h),se(ne)]}:{stageId:s,buildId:t,status:a,search:p}}function C(s){const t={};F(),Object.entries(s).forEach(([a,h])=>{typeof h=="string"&&a==="search"&&h?t.executionId=h:typeof h=="string"&&h?t[a]=h:a==="dateRange"&&h&&se.isDayjs(h[0])&&se.isDayjs(h[1])&&(t.startDate=h[0].toISOString().slice(0,10),t.endDate=h[1].toISOString().slice(0,10))}),R.replace({query:t})}function _(){const{page:s,pageSize:t}=I.query;return{currentIndex:s?parseInt(s,10):1,pageSize:t?parseInt(t,10):10}}function A(s){s=s.slice(0,6);const t=`${window.location.origin}${window.location.pathname}?executionId=${s}`;navigator.clipboard.writeText(t),ce.success({content:v.translate("i18n_logs_copied_to_clipboard")})}function Y(s,t){let a={...s};return a.sentTasks=t.sentTasks,delete a.mockExecution,t.triggerTask&&(a.triggerTask=t.triggerTask,delete a.taskId),a}function w(s){return new Intl.DateTimeFormat(navigator.language,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(s))}async function K(s){try{await T.stopExecution(s),ce.success({content:v.translate("i18n_logs_execution_stopped")})}catch{ce.error({content:v.translate("i18n_logs_execution_stop_error")})}}const P=te.from("3.26.3");function j(s){const t=n.filterOptions.builds.find(h=>h.value===s);return!t||!t.abstraVersion?!1:te.from(t.abstraVersion).gte(P)}const T=Ge();T.init({executionRepository:u.executionRepository,buildRepository:u.buildRepository,projectId:S,filters:y(),pagination:_(),pool:!0,openedExecutionId:z,onFilterChange:C});const{state:n}=T,Z=D(!1);Se(()=>n.filterOptions.stages,s=>{Z.value=s.length>0},{immediate:!0});function V(s){const t=n.filterOptions.stages.find(a=>a.value===s);return t?t.label:Z.value?v.translate("i18n_logs_deleted_stage"):v.translate("i18n_logs_stage_loading")}function X(s,t){T.fetchExecutionLogsPage(s,t)}$e(()=>T.teardown());function F(){const s=n.filters.dateRange,t=se();!s||!s[1]?n.filters.dateRange=[t.subtract(90,"day"),t]:s[1].diff(s[0],"day")>90&&(n.filters.dateRange=[s[1].subtract(90,"day"),s[1]],ce.warning({content:v.translate("i18n_logs_date_range_limit_warning",null,90)}))}C(n.filters);function Q(s,t){return t&&"label"in t&&typeof t.label=="string"?t.label.toLowerCase().includes(s.toLowerCase()):!0}return(s,t)=>(m(),U(e(xe),{direction:"vertical",style:{width:"100%",padding:"0px 0px 20px 0px"}},{default:l(()=>[o(e(Oe),null,{default:l(()=>[re(G(e(v).translate("i18n_logs_title")),1)]),_:1}),k.showAllFilters?(m(),U(e(we),{key:0,layout:"vertical"},{default:l(()=>[o(e(ve),{gutter:10},{default:l(()=>[o(e(ee),{span:12},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_execution_id_label")},{default:l(()=>[o(e(We),{value:e(n).filters.search,"onUpdate:value":t[0]||(t[0]=a=>e(n).filters.search=a),placeholder:e(v).translate("i18n_logs_search_by_execution_id_placeholder"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(ee),{span:12},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_stage_label")},{default:l(()=>[o(e(oe),{value:e(n).filters.stageId,"onUpdate:value":t[1]||(t[1]=a=>e(n).filters.stageId=a),options:e(n).filterOptions.stages,placeholder:e(v).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":Q},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),o(e(ve),{gutter:10},{default:l(()=>[o(e(ee),{span:8},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_date_label")},{default:l(()=>[o(e(Ie),{value:e(n).filters.dateRange,"onUpdate:value":t[2]||(t[2]=a=>e(n).filters.dateRange=a),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),o(e(ee),{span:10},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_version_label")},{default:l(()=>[o(e(oe),{value:e(n).filters.buildId,"onUpdate:value":t[3]||(t[3]=a=>e(n).filters.buildId=a),options:e(n).filterOptions.builds,"option-label":"label","option-value":"value",filter:!1,placeholder:e(v).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":Q},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(ee),{span:6},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_status_label")},{default:l(()=>[o(e(oe),{value:e(n).filters.status,"onUpdate:value":t[4]||(t[4]=a=>e(n).filters.status=a),options:e(n).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(v).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":Q},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1})):(m(),U(e(we),{key:1,layout:"vertical"},{default:l(()=>[o(e(ve),{gutter:10},{default:l(()=>[o(e(ee),{span:8},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_date_label")},{default:l(()=>[o(e(Ie),{value:e(n).filters.dateRange,"onUpdate:value":t[5]||(t[5]=a=>e(n).filters.dateRange=a),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),o(e(ee),{span:10},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_script_label")},{default:l(()=>[o(e(oe),{value:e(n).filters.stageId,"onUpdate:value":t[6]||(t[6]=a=>e(n).filters.stageId=a),options:e(n).filterOptions.stages,placeholder:e(v).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":Q},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(ee),{span:6},{default:l(()=>[o(e(J),{label:e(v).translate("i18n_logs_status_label")},{default:l(()=>[o(e(oe),{value:e(n).filters.status,"onUpdate:value":t[7]||(t[7]=a=>e(n).filters.status=a),options:e(n).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(v).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":Q},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1})),e(n).currentPage.loadingExecutions||e(n).currentPage.waitingDebounce?(m(),U(e(pe),{key:2,style:{width:"100%"}})):e(n).currentPage.executions&&e(n).currentPage.executions.length>0?(m(),U(e(xe),{key:3,direction:"vertical",style:{width:"100%"}},{default:l(()=>[o(e(Qe),{"active-key":e(n).currentPage.openedExecutionIds,"onUpdate:activeKey":t[9]||(t[9]=a=>e(n).currentPage.openedExecutionIds=a),bordered:!1,style:{"background-color":"transparent"},onChange:e(T).fetchEmptyLogs},{default:l(()=>[(m(!0),B(Ue,null,Be(e(n).currentPage.executions,a=>(m(),U(e(Je),{key:a.id,class:"execution-card"},{header:l(()=>[L("div",Ct,[L("div",Lt,[a.status==="running"?(m(),B("div",Pt,[o(e(ke),{spin:""})])):(m(),B("div",{key:1,class:He(["status-dot",a.status])},null,2)),L("div",jt,[L("span",zt,[Z.value?ue("",!0):(m(),U(e(ke),{key:0,spin:"",style:{"margin-right":"6px"}})),re(" "+G(V(a.stageId)),1)]),L("span",Nt,G(e(v).translate("i18n_logs_execution_id_label"))+": "+G(a.id.slice(0,8))+" Â· "+G(e(v).translate("i18n_logs_version_label"))+": "+G(a.buildId.slice(0,8)),1)])]),L("span",$t,G(w(a.createdAt)),1)])]),extra:l(()=>[o(e(Ze),{trigger:["click"],placement:"bottomRight"},{overlay:l(()=>[o(e(Fe),null,{default:l(()=>[o(e(be),{key:"copy",onClick:h=>A(a.id)},{default:l(()=>[o(e(fe),{align:"center",gap:8},{default:l(()=>[o(e(St),{size:16}),re(" "+G(e(v).translate("i18n_logs_copy_url_tooltip")),1)]),_:1})]),_:1},8,["onClick"]),a.status==="running"&&j(a.buildId)?(m(),U(e(be),{key:"stop",danger:"",onClick:h=>K(a.id)},{default:l(()=>[o(e(fe),{align:"center",gap:8},{default:l(()=>[o(e(nt),{size:16}),re(" "+G(e(v).translate("i18n_logs_stop_execution")),1)]),_:1})]),_:1},8,["onClick"])):ue("",!0)]),_:2},1024)]),default:l(()=>[L("div",{class:"execution-actions-trigger",onClick:t[8]||(t[8]=Ee(()=>{},["stop"]))},[o(e(at),{size:18})])]),_:2},1024)]),default:l(()=>[e(n).currentPage.executionData[a.id]?(m(),U(e(ot),{key:1},{default:l(()=>[o(e(he),{key:"logs",tab:"Logs"},{default:l(()=>[o(Ye,{logs:e(n).currentPage.executionData[a.id].logs,pagination:e(n).currentPage.executionData[a.id].logsPagination,onPageChange:h=>X(a.id,h)},null,8,["logs","pagination","onPageChange"])]),_:2},1024),o(e(he),{key:"context",tab:e(v).translate("i18n_executioncontext_header")},{default:l(()=>[o(Ke,{data:Y(a.context,e(n).currentPage.executionData[a.id].tasks),"show-fix-with-ai":!1},null,8,["data"])]),_:2},1032,["tab"]),o(e(he),{key:"timeline",tab:"Timeline"},{default:l(()=>[o(Rt,{"project-id":e(S),execution:a},null,8,["project-id","execution"])]),_:2},1024)]),_:2},1024)):(m(),B("div",Ot,[o(e(pe))]))]),_:2},1024))),128))]),_:1},8,["active-key","onChange"]),o(e(Ve),{current:e(n).pagination.currentIndex,"onUpdate:current":t[10]||(t[10]=a=>e(n).pagination.currentIndex=a),"page-size":e(n).pagination.pageSize,"onUpdate:pageSize":t[11]||(t[11]=a=>e(n).pagination.pageSize=a),total:e(n).pagination.totalCount,"show-total":a=>e(v).translate("i18n_logs_found_runs",null,a),"show-size-changer":""},null,8,["current","page-size","total","show-total"])]),_:1})):(m(),U(e(Xe),{key:4}))]),_:1}))}}),Ut=qe(Wt,[["__scopeId","data-v-c06aa418"]]),la=ge({__name:"Logs",setup(k){const u=new Me,I=new tt;return(R,S)=>(m(),U(Ut,{"execution-repository":e(u),"build-repository":e(I),"show-all-filters":""},null,8,["execution-repository","build-repository"]))}});export{la as default};
//# sourceMappingURL=Logs-DvGvEotx.js.map

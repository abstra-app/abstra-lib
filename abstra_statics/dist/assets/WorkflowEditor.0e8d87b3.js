var fs=Object.defineProperty;var ms=(r,e,t)=>e in r?fs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var S=(r,e,t)=>(ms(r,typeof e!="symbol"?e+"":e,t),t);import{F as Jt}from"./forms.ac6f6a41.js";import{r as xe,G as ce,t as ys,cG as vs,eF as Re,d as We,b as I,c as E,w,f as b,u as g,bZ as _s,aJ as L,eC as se,cT as gs,J as He,ez as xs,o as ws,eu as jt,e as te,bg as bs,eB as ks,ew as D,I as Lt,cI as Ss,x as Ns}from"./outputWidgets.51b6bae1.js";import{W as Ts}from"./workspaces.f0831df3.js";import{D as qt,f as Yt,j as Xt,h as Qt,E as Is,F as Es,a as Cs,q as Os,e as Ps}from"./icons.368bb45e.js";import{a as Ms,_ as Rs}from"./FormTester.vue_vue_type_script_setup_true_lang.66b41385.js";import{d as G,r as le,t as ve,e as Ds,i as es,f as Zs,g as js,h as Ye,j as At,p as Ls,k as As}from"./geometryUtils.b6e8f69c.js";import{a as zt,s as Vt,c as $t,m as Gt}from"./keyboard.dfb12322.js";import{P as ts}from"./pubsub.933450ea.js";import{a as zs,t as Vs}from"./ant-design.200d7eca.js";import{H as $s}from"./hooks.f303c172.js";import{J as ss}from"./jobs.da4dcf4c.js";import{A as Gs}from"./activeRecord.d956865b.js";import{u as Us,r as Ke}from"./uuid.d3607693.js";import{L as Bs,R as Ws,S as Fs}from"./SmartConsole.f6579a2b.js";import{M as Hs,A as Ks}from"./Title.32186eec.js";import{a as rs}from"./asyncComputed.04a1cbef.js";import{_ as Js}from"./LaunchButton.vue_vue_type_script_setup_true_lang.e87bbe7d.js";import{_ as qs}from"./DocsButton.vue_vue_type_script_setup_true_lang.3dc8d4e3.js";import{_ as Ys}from"./SaveButton.vue_vue_type_script_setup_true_lang.47707105.js";import{a as Xs,_ as Qs}from"./HookSettings.vue_vue_type_script_setup_true_lang.e7374c9f.js";import{a as er,_ as tr}from"./JobSettings.vue_vue_type_script_setup_true_lang.29353f54.js";import{F as sr}from"./Form.0c72c506.js";import{A as rr}from"./index.cf4e9e77.js";import{S as nr}from"./StageRunSelector.vue_vue_type_script_setup_true_lang.58310071.js";import{a as W}from"./index.a5039da3.js";import{a as Ut,A as ar}from"./index.e8703b66.js";import{A as ir}from"./index.89e851cd.js";import{L as or}from"./LoginBlock.79c063c8.js";import{A as cr,c as Bt}from"./index.8de9b030.js";import{A as dr}from"./index.bf11425e.js";import{A as lr}from"./index.a23c5517.js";import{A as Je,T as ur}from"./TabPane.c04f3b85.js";import"./url.0dd5dd74.js";import"./broker.f23dc08f.js";import"./index.cdde3d09.js";import"./executeJs.8e0872d4.js";import"./CircularLoading.0e31148f.js";import"./PlayerNavbar.ad0b82e9.js";import"./index.a9533207.js";import"./Steps.c1f8bfce.js";import"./WidgetsFrame.d986fea7.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.205d291a.js";import"./index.94e11a35.js";import"./CollapsePanel.0366869a.js";import"./index.a10aab26.js";import"./dashes.15a50bce.js";import"./index.051f0241.js";import"./RunButton.vue_vue_type_script_setup_true_lang.f7135a83.js";import"./index.f58793a9.js";import"./index.49f406a4.js";import"./dayjs.7beb1594.js";import"./popupNotifcation.b955383b.js";import"./index.57d98920.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="89611242-5be6-451a-8202-b55bdb275a05",r._sentryDebugIdIdentifier="sentry-dbid-89611242-5be6-451a-8202-b55bdb275a05")}catch{}})();class hr{async list(){return await(await fetch("/_editor/api/scripts")).json()}async create(){return await(await fetch("/_editor/api/scripts",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}async get(e){return await(await fetch(`/_editor/api/scripts/${e}`)).json()}async update(e,t){return await(await fetch(`/_editor/api/scripts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async delete(e){await fetch(`/_editor/api/scripts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async test(e){return(await fetch(`/_editor/api/scripts/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()}}const oe=new hr;class _e{constructor(e){S(this,"record");this.record=Gs.create(oe,e,"path")}static async list(){return(await oe.list()).map(t=>new _e(t))}static async create(){const e=await oe.create();return new _e(e)}static async get(e){const t=await oe.get(e);return new _e(t)}async delete(){await oe.delete(this.path)}async duplicate(){return this}async save(){await this.record.save()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(e){return this.record.hasChanges(e)}get schedule(){return this.record.get("schedule")}set schedule(e){this.record.set("schedule",e)}get title(){return this.record.get("title")}set title(e){this.record.set("title",e)}get file(){return this.record.get("file")}set file(e){this.record.set("file",e)}get path(){return this.record.get("path")}set path(e){this.record.set("path",e)}async test(){return oe.test(this.path)}get routeName(){return"script"}get position(){const[e,t]=this.record.get("workflow_position");return{x:e,y:t,referential:"world"}}get isInitial(){return!1}}const De={left:100,right:100,top:100,bottom:100},Wt={width:600,height:600};class st{constructor(e){S(this,"_state");S(this,"projectedElement");this._state=xe({x:0,y:0,zoom:1}),this.projectedElement=e}get x(){return this._state.value.x}set x(e){if(Number.isNaN(e))throw new Error("x is NaN");this._state.value.x=e}get y(){return this._state.value.y}set y(e){if(Number.isNaN(e))throw new Error("y is NaN");this._state.value.y=e}static create(e){return new st(e)}get zoom(){return this._state.value.zoom}set zoom(e){if(e<=0)throw new Error("Zoom must be positive");this._state.value.zoom=e}fit(e){const t={x:e.x+e.width/2,y:e.y+e.height/2,referential:"world"},s=this.screenRect2world(this.canvasRect);this.x=t.x-s.width/2,this.y=t.y-s.height/2,this.zoomIn(Math.min((this.canvasRect.width-De.left-De.right)/Math.max(Wt.width,e.width),(this.canvasRect.height-De.top-De.bottom)/Math.max(Wt.height,e.height))/this.zoom,this.worldPoint2screen(t))}screenPoint2world(e){return{x:e.x/this.zoom+this.x,y:e.y/this.zoom+this.y,referential:"world"}}worldPoint2screen(e){return{x:(e.x-this.x)*this.zoom,y:(e.y-this.y)*this.zoom,referential:"screen"}}screenDelta2world(e){return{dx:e.dx/this.zoom,dy:e.dy/this.zoom,referential:"world"}}worldDelta2screen(e){return{dx:e.dx*this.zoom,dy:e.dy*this.zoom,referential:"screen"}}screenRect2world(e){const t=this.screenPoint2world({x:e.x,y:e.y,referential:e.referential}),s=this.screenPoint2world({x:e.x+e.width,y:e.y+e.height,referential:e.referential});return{x:t.x,y:t.y,width:s.x-t.x,height:s.y-t.y,referential:t.referential}}worldRect2screen(e){const t=this.worldPoint2screen({x:e.x,y:e.y,referential:e.referential}),s=this.worldPoint2screen({x:e.x+e.width,y:e.y+e.height,referential:e.referential});return{x:t.x,y:t.y,width:s.x-t.x,height:s.y-t.y,referential:t.referential}}zoomIn(e,t){const s=this.screenPoint2world(t);this.zoom*=e;const n=this.worldPoint2screen(s),a=G(t,n),i=this.screenDelta2world({dx:a.dx,dy:a.dy,referential:"screen"});this.x+=i.dx,this.y+=i.dy}translate(e){this.x+=e.dx,this.y+=e.dy}get canvasRect(){if(!this.projectedElement)throw new Error("No canvas element");const e=this.projectedElement.getBoundingClientRect();return{x:e.x,y:e.y,width:e.width,height:e.height,referential:"screen"}}}const pr="#e55b70";class rt{constructor(){}static create(){return new rt}render(e){const t=le(e.selectedNodes.map(s=>s.projectedRect(e)));!t||(e.ctx.strokeStyle=pr,e.ctx.lineWidth=2,e.ctx.strokeRect(t.x,t.y,t.width,t.height))}}class nt{constructor(e){S(this,"_nodes");S(this,"_links");S(this,"_selectedNodes");S(this,"_selectedLinks");S(this,"_mouseState");S(this,"floatingMenu");S(this,"selectionHull");S(this,"pubsub");S(this,"canvas");S(this,"ctx");S(this,"camera");this.canvas=e,this.camera=st.create(e),this._mouseState=ce({state:"IDLE",mousePos:{x:0,y:0,referential:"screen"}}),this.pubsub=new ts,this.floatingMenu=null;const t=e.getContext("2d");if(!t)throw new Error("Unable to get canvas context");this.ctx=t,this._nodes=ce([]),this._links=ce([]),this._selectedNodes=ce([]),this._selectedLinks=ce([]),this.selectionHull=rt.create()}static create(e){return new nt(e)}addTransition(){this.mouseState={state:"LINKING",mousePos:this.mouseState.mousePos,initialMousePos:this.mouseState.mousePos,snappedTarget:null}}duplicateSelection(){const e=this.selectedNodes,t=this.selectedNodes.map(i=>i.clone()),s=this.links.filter(i=>{const o=this.nodes.find(d=>d.id===i.sourceNodeId),c=this.nodes.find(d=>d.id===i.targetNodeId);if(!o||!c)throw new Error("Invalid state");return this.selectedNodes.includes(o)&&this.selectedNodes.includes(c)}).map(i=>{const o=this.nodes.find(O=>O.id===i.sourceNodeId),c=this.nodes.find(O=>O.id===i.targetNodeId);if(!o||!c)throw new Error("Invalid state");const d=this.selectedNodes.indexOf(o),l=t[d],C=this.selectedNodes.indexOf(c),T=t[C];return i.clone(l.id,T.id)});this.nodes.push(...t),this.links.push(...s),this.selectedNodes=t;const n=le(t.map(i=>i.projectedRect(this)));if(!n)throw new Error("Invalid state");const a={x:n.x+n.width/2,y:n.y+n.height/2,referential:"screen"};this.pubsub.publish("nodes:duplicated",ys.exports.zip(e,t).map(([i,o])=>({original:i,duplicate:o}))),this.mouseState={state:"MOVING",duplicating:!1,initialMousePos:a,mousePos:this.mouseState.mousePos}}async deleteSelection(){if(await zs("Are you sure? This operation can't be undone")){const e={nodes:this.selectedNodes,links:this.selectedLinks};this.selectedNodes.forEach(t=>this.deleteNode(t)),this.selectedLinks.forEach(t=>this.deleteLink(t)),this.pubsub.publish("deleted",e)}}setupFixSize(){const e=()=>{const{width:t,height:s}=this.canvas.getBoundingClientRect();this.canvas.width=t*devicePixelRatio,this.canvas.height=s*devicePixelRatio,this.ctx.scale(devicePixelRatio,devicePixelRatio)};addEventListener("resize",e),e()}computeCursor(){switch(this.mouseState.state){case"HOVERING_NODE":case"HOVERING_MENU_ITEM":case"HOVERING_LINK":this.canvas.style.cursor="pointer";break;case"JUST_CLICKED_NODE":this.canvas.style.cursor="default";break;case"MOVING":this.canvas.style.cursor="move";break;case"PANNING":this.canvas.style.cursor="grabbing";break;case"LINKING":this.canvas.style.cursor="crosshair";break;case"IDLE":default:this.canvas.style.cursor="grab"}}computePan(e){if(this.mouseState.state!=="PANNING")throw new Error("Invalid state");const t=G(e,this.mouseState.mousePos),s=this.camera.screenDelta2world(t);this.camera.translate(s),this.mouseState={state:"PANNING",initialMousePos:this.mouseState.initialMousePos,mousePos:e}}computeStartMoving(e,t){if(this.mouseState.state!=="JUST_CLICKED_NODE")throw new Error("Invalid state");this.mouseState={state:"MOVING",duplicating:t,initialMousePos:this.mouseState.mousePos,mousePos:e}}get mouseState(){return this._mouseState.value}set mouseState(e){this._mouseState.value=e}get nodes(){return this._nodes.value}set nodes(e){this._nodes.value=e}get links(){return this._links.value}set links(e){this._links.value=e}get selectedNodes(){return this._selectedNodes.value}set selectedNodes(e){this._selectedNodes.value=e}get selectedLinks(){return this._selectedLinks.value}set selectedLinks(e){this._selectedLinks.value=e}computeKeepMoving(e,t){if(this.mouseState.state!=="MOVING")throw new Error("Invalid state");this.mouseState={state:"MOVING",duplicating:t,initialMousePos:this.mouseState.initialMousePos,mousePos:e}}computeKeepLinking(e){if(this.mouseState.state!=="LINKING")throw new Error("Invalid state");const t=this.nodes.find(s=>s.isHovering(this,e));t?this.mouseState={state:"LINKING",initialMousePos:this.mouseState.initialMousePos,mousePos:e,snappedTarget:t}:this.mouseState={state:"LINKING",initialMousePos:this.mouseState.initialMousePos,mousePos:e,snappedTarget:null}}computeHover(e){var a;const t=(a=this.floatingMenu)==null?void 0:a.hoverItem(this,e);if(t){this.mouseState={state:"HOVERING_MENU_ITEM",mousePos:e,menuItem:t};return}const s=this.links.find(i=>i.isHovering(this,e));if(s){this.mouseState={state:"HOVERING_LINK",link:s,mousePos:e};return}const n=this.nodes.find(i=>i.isHovering(this,e));if(n){this.mouseState={state:"HOVERING_NODE",node:n,mousePos:e};return}this.mouseState={state:"IDLE",mousePos:e}}fitCameraToContent(){const e=le(this.nodes.map(t=>t.projectedRect(this)));!e||this.camera.fit(this.camera.screenRect2world(e))}computeFinishMoving(){if(this.mouseState.state!=="MOVING")throw new Error("Invalid state");const e=this.camera.screenPoint2world(this.mouseState.initialMousePos),t=this.camera.screenPoint2world(this.mouseState.mousePos),s=G(e,t);this.pubsub.publish("nodes:moved",this.selectedNodes.map(n=>{const a=n.position;n.translate(s);const i=n.position;return{node:n,from:a,to:i}}))}computeFinishDuplicating(){if(this.mouseState.state!=="MOVING"||!this.mouseState.duplicating)throw new Error("Invalid state");const e=this.camera.screenPoint2world(this.mouseState.initialMousePos),t=this.camera.screenPoint2world(this.mouseState.mousePos),s=G(e,t);this.pubsub.publish("nodes:duplicated",this.selectedNodes.map(n=>{const a=n.clone();return a.translate(s),this.nodes.push(a),{original:n,duplicate:a}})),this.selectedNodes=this.selectedNodes.map(n=>{const a=n.clone();return a.translate(s),a})}computeFinishLinking(e){if(this.mouseState.state!=="LINKING"||!this.mouseState.snappedTarget)throw new Error("Invalid state");const t=this.mouseState.snappedTarget,s=this.selectedNodes.map(n=>n.addLinkTo(this,t));this.pubsub.publish("transition:added",{links:s}),this.selectedNodes=[this.mouseState.snappedTarget],this.mouseState={state:"IDLE",mousePos:e}}computeMouseRelease(e){this.mouseState.state==="MOVING"&&!this.mouseState.duplicating?this.computeFinishMoving():this.mouseState.state==="MOVING"&&this.mouseState.duplicating?this.computeFinishDuplicating():this.mouseState.state==="LINKING"&&this.mouseState.snappedTarget&&this.computeFinishLinking(e),this.mouseState={state:"IDLE",mousePos:e}}setupMousemove(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.mouseState.state==="PANNING"?this.computePan(s):this.mouseState.state==="JUST_CLICKED_NODE"?this.computeStartMoving(s,zt(t)):this.mouseState.state==="MOVING"?this.computeKeepMoving(s,zt(t)):this.mouseState.state==="LINKING"?this.computeKeepLinking(s):this.mouseState.state==="ADDING_NEW_NODES"?this.computeKeepAdding(s):this.computeHover(s),this.computeCursor()};addEventListener("mousemove",e)}computeKeepAdding(e){if(this.mouseState.state!=="ADDING_NEW_NODES")throw new Error("Invalid state");this.mouseState.nodes.forEach(t=>t.position=this.camera.screenPoint2world(t.projectedCenter(this))),this.mouseState={state:"ADDING_NEW_NODES",mousePos:e,nodes:this.mouseState.nodes}}setupDragover(){const e=t=>{if(t.preventDefault(),this.mouseState.state!=="ADDING_NEW_NODES")return;const s=this.getScreenPointerFromEvent(t);this.computeKeepAdding(s)};this.canvas.addEventListener("dragover",e)}computeFinishAdding(e){if(this.mouseState.state!=="ADDING_NEW_NODES")return;this.computeKeepAdding(e),this.nodes.push(...this.mouseState.nodes),this.selectedNodes=this.mouseState.nodes;const t=le(this.mouseState.nodes.map(o=>o.projectedRect(this)));if(!t)throw new Error("Invalid state");const s={x:t.x+t.width/2,y:t.y+t.height/2,referential:"screen"},n=this.camera.screenPoint2world(s),a=this.camera.screenPoint2world(e),i=G(n,a);this.mouseState.nodes.forEach(o=>o.translate(i)),this.mouseState={state:"IDLE",mousePos:e},this.pubsub.publish("nodes:added",{nodes:this.selectedNodes})}setupDrop(){const e=t=>{t.stopPropagation();const s=this.getScreenPointerFromEvent(t);this.computeFinishAdding(s)};this.canvas.addEventListener("drop",e)}getScreenPointerFromEvent(e){return{x:e.offsetX,y:e.offsetY,referential:"screen"}}computeStartClicking(e,t){if(this.mouseState.state==="ADDING_NEW_NODES")this.computeFinishAdding(e);else if(this.mouseState.state==="HOVERING_LINK"){const s=this.mouseState.link;t?this.selectedLinks=[...this.selectedLinks,s]:this.selectedLinks.includes(s)||(this.selectedLinks=[s],this.selectedNodes=[]),this.mouseState={state:"JUST_CLICKED_NODE",mousePos:e,node:this.nodes.find(n=>n.id===s.sourceNodeId)}}else if(this.mouseState.state==="HOVERING_NODE"){const s=this.mouseState.node;t?this.selectedNodes=[...this.selectedNodes,s]:this.selectedNodes.includes(s)||(this.selectedNodes=[s],this.selectedLinks=[]),this.mouseState={state:"JUST_CLICKED_NODE",mousePos:e,node:s}}else this.mouseState.state==="HOVERING_MENU_ITEM"?this.mouseState.menuItem.click():this.mouseState.state==="LINKING"?this.computeFinishLinking(e):(this.clearSelection(),this.mouseState={state:"PANNING",initialMousePos:e,mousePos:e})}setupDoubleClick(){const e=()=>{if(this.mouseState.state!=="HOVERING_NODE")return;const t=this.mouseState.node;this.pubsub.publish("node:dblclick",{node:t})};this.canvas.addEventListener("dblclick",e)}setupMousedown(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.computeStartClicking(s,Vt(t))};this.canvas.addEventListener("mousedown",e)}setupMouseup(){const e=t=>{const s=this.getScreenPointerFromEvent(t);this.computeMouseRelease(s),this.computeHover(s),this.computeCursor()};this.canvas.addEventListener("mouseup",e)}computeZoomIn(e,t){this.camera.zoomIn(t,e)}setupWheel(){const e=t=>{if(!this.camera)return;const s={x:t.pageX,y:t.pageY,referential:"screen"};if($t(t)||Gt(t))this.computeZoomIn(s,t.deltaY>0?.9:1.1),t.preventDefault();else{const n=Vt(t)?{dx:t.deltaY,dy:0}:{dx:t.deltaX,dy:t.deltaY},a=this.camera.screenDelta2world({dx:n.dx,dy:n.dy,referential:"screen"});this.camera.translate(a)}t.stopPropagation()};this.canvas.addEventListener("wheel",e)}deleteNode(e){this.nodes=this.nodes.filter(t=>t!==e),this.links=this.links.filter(t=>t.sourceNodeId!==e.id&&t.targetNodeId!==e.id),this.selectedNodes=this.selectedNodes.filter(t=>t!==e)}deleteLink(e){this.links=this.links.filter(t=>t!==e),this.selectedLinks=[]}setupKeydown(){const e=t=>{t.key==="Delete"||t.key==="Backspace"?this.deleteSelection():t.key==="a"&&($t(t)||Gt(t))?(this.selectedNodes=this.nodes,t.preventDefault()):t.key==="Escape"?(this.clearSelection(),this.mouseState={state:"IDLE",mousePos:this.mouseState.mousePos}):t.key==="t"?this.addTransition():t.key==="Enter"&&this.pubsub.publish("node:dblclick",{node:this.selectedNodes[0]})};this.canvas.parentElement.addEventListener("keydown",e)}renderMouseState(){switch(this.mouseState.state){case"ADDING_NEW_NODES":this.mouseState.nodes.forEach(e=>e.render(this));break}}setFloatingMenu(e){this.floatingMenu=e}render(){var e;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.links.forEach(t=>{t.render(this)}),this.nodes.forEach(t=>{t.render(this)}),(e=this.floatingMenu)==null||e.render(this),this.selectionHull.render(this),this.renderMouseState(),requestAnimationFrame(()=>this.render())}init(){this.setupFixSize(),this.setupMousemove(),this.setupDragover(),this.setupDoubleClick(),this.setupMousedown(),this.setupDrop(),this.setupMouseup(),this.setupWheel(),this.setupKeydown(),this.fitCameraToContent(),this.render()}clear(){this.nodes=[],this.links=[]}addNode(e){this.nodes.push(e)}addLink(e){this.links.push(e)}clearSelection(){this.selectedNodes=[],this.selectedLinks=[]}dragstart(e,t){const s=this.getScreenPointerFromEvent(t);this.clearSelection(),this.mouseState={state:"ADDING_NEW_NODES",mousePos:s,nodes:[e]}}}const fr="rgba(0, 0, 0, 1)",mr="rgba(0, 0, 0, 0.5)";class at{constructor(e){S(this,"rawItems");this.rawItems=e}static create(e){return new at(e)}getMenuItems(e){const t=e.selectedNodes,s=le(t.map(C=>C.projectedRect(e)));if(!s)return[];const n={x:s.x+s.width,y:s.y,referential:"screen"},a=10,i=16,o=10,c={dx:i+a,dy:i,referential:"screen"},d={dx:0,dy:2*i+o,referential:"screen"},l=ve(n,c);return this.rawItems.map((C,T)=>{const O=ve(l,Ds(d,T));return{label:C.label,icon:C.icon,circle:{...O,radius:i},click:C.click}})}isVisible(e){return e.selectedNodes.length>0&&e.mouseState.state!=="LINKING"&&e.mouseState.state!=="MOVING"}itemHover(e,t){return e.mouseState.state==="HOVERING_MENU_ITEM"&&e.mouseState.menuItem.label===t.label}renderItem(e,t){const s=this.itemHover(e,t),n=s?fr:mr;if(e.ctx.strokeStyle=n,e.ctx.lineWidth=2,s){e.ctx.font="12px sans-serif";const o=e.ctx.measureText(t.label).width;e.ctx.beginPath(),e.ctx.arc(t.circle.x,t.circle.y,t.circle.radius,Math.PI/2,-Math.PI/2),e.ctx.lineTo(t.circle.x+o+t.circle.radius,t.circle.y-t.circle.radius),e.ctx.arc(t.circle.x+o+t.circle.radius,t.circle.y,t.circle.radius,-Math.PI/2,Math.PI/2),e.ctx.lineTo(t.circle.x,t.circle.y+t.circle.radius),e.ctx.fillStyle="white",e.ctx.fill(),e.ctx.stroke(),e.ctx.textBaseline="middle",e.ctx.textAlign="left",e.ctx.font="12px sans-serif",e.ctx.fillStyle=n,e.ctx.fillText(t.label,t.circle.x+t.circle.radius,t.circle.y)}else e.ctx.beginPath(),e.ctx.arc(t.circle.x,t.circle.y,t.circle.radius,0,2*Math.PI),e.ctx.fillStyle="white",e.ctx.fill(),e.ctx.stroke();const a=new Path2D(t.icon);e.ctx.save();const i=12;e.ctx.translate(t.circle.x-i,t.circle.y-i),e.ctx.fillStyle=n,e.ctx.fill(a),e.ctx.restore()}render(e){!this.isVisible(e)||this.getMenuItems(e).forEach(t=>{this.renderItem(e,t)})}hoverItem(e,t){if(!!this.isVisible(e))return this.getMenuItems(e).find(s=>{if(this.itemHover(e,s)){const n=e.ctx.measureText(s.label).width,a={x:s.circle.x-s.circle.radius,y:s.circle.y-s.circle.radius,width:n+3*s.circle.radius,height:2*s.circle.radius,referential:"screen"};return es(t,a)}else return Zs(t,s.circle)})}}var x;(function(r){r.assertEqual=n=>n;function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{const a={};for(const i of n)a[i]=i;return a},r.getValidEnumValues=n=>{const a=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),i={};for(const o of a)i[o]=n[o];return r.objectValues(i)},r.objectValues=n=>r.objectKeys(n).map(function(a){return n[a]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const a=[];for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&a.push(i);return a},r.find=(n,a)=>{for(const i of n)if(a(i))return i},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,a=" | "){return n.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}r.joinValues=s,r.jsonStringifyReplacer=(n,a)=>typeof a=="bigint"?a.toString():a})(x||(x={}));var Xe;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Xe||(Xe={}));const h=x.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Y=r=>{switch(typeof r){case"undefined":return h.undefined;case"string":return h.string;case"number":return isNaN(r)?h.nan:h.number;case"boolean":return h.boolean;case"function":return h.function;case"bigint":return h.bigint;case"symbol":return h.symbol;case"object":return Array.isArray(r)?h.array:r===null?h.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?h.promise:typeof Map<"u"&&r instanceof Map?h.map:typeof Set<"u"&&r instanceof Set?h.set:typeof Date<"u"&&r instanceof Date?h.date:h.object;default:return h.unknown}},u=x.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),yr=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class z extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(a){return a.message},s={_errors:[]},n=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(n);else if(i.code==="invalid_return_type")n(i.returnTypeError);else if(i.code==="invalid_arguments")n(i.argumentsError);else if(i.path.length===0)s._errors.push(t(i));else{let o=s,c=0;for(;c<i.path.length;){const d=i.path[c];c===i.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(t(i))):o[d]=o[d]||{_errors:[]},o=o[d],c++}}};return n(this),s}toString(){return this.message}get message(){return JSON.stringify(this.issues,x.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}z.create=r=>new z(r);const we=(r,e)=>{let t;switch(r.code){case u.invalid_type:r.received===h.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case u.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,x.jsonStringifyReplacer)}`;break;case u.unrecognized_keys:t=`Unrecognized key(s) in object: ${x.joinValues(r.keys,", ")}`;break;case u.invalid_union:t="Invalid input";break;case u.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${x.joinValues(r.options)}`;break;case u.invalid_enum_value:t=`Invalid enum value. Expected ${x.joinValues(r.options)}, received '${r.received}'`;break;case u.invalid_arguments:t="Invalid function arguments";break;case u.invalid_return_type:t="Invalid function return type";break;case u.invalid_date:t="Invalid date";break;case u.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:x.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case u.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case u.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case u.custom:t="Invalid input";break;case u.invalid_intersection_types:t="Intersection results could not be merged";break;case u.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case u.not_finite:t="Number must be finite";break;default:t=e.defaultError,x.assertNever(r)}return{message:t}};let ns=we;function vr(r){ns=r}function je(){return ns}const Le=r=>{const{data:e,path:t,errorMaps:s,issueData:n}=r,a=[...t,...n.path||[]],i={...n,path:a};let o="";const c=s.filter(d=>!!d).slice().reverse();for(const d of c)o=d(i,{data:e,defaultError:o}).message;return{...n,path:a,message:n.message||o}},_r=[];function p(r,e){const t=Le({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,je(),we].filter(s=>!!s)});r.common.issues.push(t)}class P{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if(n.status==="aborted")return y;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const n of t)s.push({key:await n.key,value:await n.value});return P.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:a,value:i}=n;if(a.status==="aborted"||i.status==="aborted")return y;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),(typeof i.value<"u"||n.alwaysSet)&&(s[a.value]=i.value)}return{status:e.value,value:s}}}const y=Object.freeze({status:"aborted"}),as=r=>({status:"dirty",value:r}),R=r=>({status:"valid",value:r}),Qe=r=>r.status==="aborted",et=r=>r.status==="dirty",Ae=r=>r.status==="valid",ze=r=>typeof Promise<"u"&&r instanceof Promise;var f;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(f||(f={}));class U{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ft=(r,e)=>{if(Ae(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new z(r.common.issues);return this._error=t,this._error}}};function v(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(i,o)=>i.code!=="invalid_type"?{message:o.defaultError}:typeof o.data>"u"?{message:s!=null?s:o.defaultError}:{message:t!=null?t:o.defaultError},description:n}}class _{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Y(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Y(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new P,ctx:{common:e.parent.common,data:e.data,parsedType:Y(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ze(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const n={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Y(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Ft(n,a)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Y(e)},n=this._parse({data:e,path:s.path,parent:s}),a=await(ze(n)?n:Promise.resolve(n));return Ft(s,a)}refine(e,t){const s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,a)=>{const i=e(n),o=()=>a.addIssue({code:u.custom,...s(n)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new $({schema:this,typeName:m.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return F.create(this,this._def)}nullable(){return ie.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return V.create(this,this._def)}promise(){return pe.create(this,this._def)}or(e){return Ne.create([this,e],this._def)}and(e){return Te.create(this,e,this._def)}transform(e){return new $({...v(this._def),schema:this,typeName:m.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Pe({...v(this._def),innerType:this,defaultValue:t,typeName:m.ZodDefault})}brand(){return new os({typeName:m.ZodBranded,type:this,...v(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Ue({...v(this._def),innerType:this,catchValue:t,typeName:m.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Me.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const gr=/^c[^\s-]{8,}$/i,xr=/^[a-z][a-z0-9]*$/,wr=/[0-9A-HJKMNP-TV-Z]{26}/,br=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,kr=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,Sr=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,Nr=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Tr=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ir=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Er(r,e){return!!((e==="v4"||!e)&&Nr.test(r)||(e==="v6"||!e)&&Tr.test(r))}class A extends _{constructor(){super(...arguments),this._regex=(e,t,s)=>this.refinement(n=>e.test(n),{validation:t,code:u.invalid_string,...f.errToObj(s)}),this.nonempty=e=>this.min(1,f.errToObj(e)),this.trim=()=>new A({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new A({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new A({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==h.string){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.string,received:a.parsedType}),y}const s=new P;let n;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(n=this._getOrReturnCtx(e,n),i?p(n,{code:u.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&p(n,{code:u.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),s.dirty())}else if(a.kind==="email")kr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"email",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="emoji")Sr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"emoji",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="uuid")br.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"uuid",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid")gr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"cuid",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid2")xr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"cuid2",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="ulid")wr.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"ulid",code:u.invalid_string,message:a.message}),s.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),p(n,{validation:"url",code:u.invalid_string,message:a.message}),s.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"regex",code:u.invalid_string,message:a.message}),s.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),s.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:{startsWith:a.value},message:a.message}),s.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:{endsWith:a.value},message:a.message}),s.dirty()):a.kind==="datetime"?Ir(a).test(e.data)||(n=this._getOrReturnCtx(e,n),p(n,{code:u.invalid_string,validation:"datetime",message:a.message}),s.dirty()):a.kind==="ip"?Er(e.data,a.version)||(n=this._getOrReturnCtx(e,n),p(n,{validation:"ip",code:u.invalid_string,message:a.message}),s.dirty()):x.assertNever(a);return{status:s.value,value:e.data}}_addCheck(e){return new A({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...f.errToObj(e)})}url(e){return this._addCheck({kind:"url",...f.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...f.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...f.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...f.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...f.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...f.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...f.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...f.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...f.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...f.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...f.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...f.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...f.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...f.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...f.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}A.create=r=>{var e;return new A({checks:[],typeName:m.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...v(r)})};function Cr(r,e){const t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,a=parseInt(r.toFixed(n).replace(".","")),i=parseInt(e.toFixed(n).replace(".",""));return a%i/Math.pow(10,n)}class X extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==h.number){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.number,received:a.parsedType}),y}let s;const n=new P;for(const a of this._def.checks)a.kind==="int"?x.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),p(s,{code:u.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?Cr(e.data,a.value)!==0&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),p(s,{code:u.not_finite,message:a.message}),n.dirty()):x.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,s,n){return new X({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:f.toString(n)}]})}_addCheck(e){return new X({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:f.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:f.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:f.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:f.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&x.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}X.create=r=>new X({checks:[],typeName:m.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...v(r)});class Q extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==h.bigint){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.bigint,received:a.parsedType}),y}let s;const n=new P;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),p(s,{code:u.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):x.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,s,n){return new Q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:f.toString(n)}]})}_addCheck(e){return new Q({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Q.create=r=>{var e;return new Q({checks:[],typeName:m.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...v(r)})};class be extends _{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==h.boolean){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.boolean,received:s.parsedType}),y}return R(e.data)}}be.create=r=>new be({typeName:m.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...v(r)});class ne extends _{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==h.date){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_type,expected:h.date,received:a.parsedType}),y}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return p(a,{code:u.invalid_date}),y}const s=new P;let n;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),p(n,{code:u.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):x.assertNever(a);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ne({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:f.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:f.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ne.create=r=>new ne({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:m.ZodDate,...v(r)});class Ve extends _{_parse(e){if(this._getType(e)!==h.symbol){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.symbol,received:s.parsedType}),y}return R(e.data)}}Ve.create=r=>new Ve({typeName:m.ZodSymbol,...v(r)});class ke extends _{_parse(e){if(this._getType(e)!==h.undefined){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.undefined,received:s.parsedType}),y}return R(e.data)}}ke.create=r=>new ke({typeName:m.ZodUndefined,...v(r)});class Se extends _{_parse(e){if(this._getType(e)!==h.null){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.null,received:s.parsedType}),y}return R(e.data)}}Se.create=r=>new Se({typeName:m.ZodNull,...v(r)});class he extends _{constructor(){super(...arguments),this._any=!0}_parse(e){return R(e.data)}}he.create=r=>new he({typeName:m.ZodAny,...v(r)});class re extends _{constructor(){super(...arguments),this._unknown=!0}_parse(e){return R(e.data)}}re.create=r=>new re({typeName:m.ZodUnknown,...v(r)});class H extends _{_parse(e){const t=this._getOrReturnCtx(e);return p(t,{code:u.invalid_type,expected:h.never,received:t.parsedType}),y}}H.create=r=>new H({typeName:m.ZodNever,...v(r)});class $e extends _{_parse(e){if(this._getType(e)!==h.undefined){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.void,received:s.parsedType}),y}return R(e.data)}}$e.create=r=>new $e({typeName:m.ZodVoid,...v(r)});class V extends _{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==h.array)return p(t,{code:u.invalid_type,expected:h.array,received:t.parsedType}),y;if(n.exactLength!==null){const i=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(i||o)&&(p(t,{code:i?u.too_big:u.too_small,minimum:o?n.exactLength.value:void 0,maximum:i?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(p(t,{code:u.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(p(t,{code:u.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>n.type._parseAsync(new U(t,i,t.path,o)))).then(i=>P.mergeArray(s,i));const a=[...t.data].map((i,o)=>n.type._parseSync(new U(t,i,t.path,o)));return P.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new V({...this._def,minLength:{value:e,message:f.toString(t)}})}max(e,t){return new V({...this._def,maxLength:{value:e,message:f.toString(t)}})}length(e,t){return new V({...this._def,exactLength:{value:e,message:f.toString(t)}})}nonempty(e){return this.min(1,e)}}V.create=(r,e)=>new V({type:r,minLength:null,maxLength:null,exactLength:null,typeName:m.ZodArray,...v(e)});function de(r){if(r instanceof N){const e={};for(const t in r.shape){const s=r.shape[t];e[t]=F.create(de(s))}return new N({...r._def,shape:()=>e})}else return r instanceof V?new V({...r._def,type:de(r.element)}):r instanceof F?F.create(de(r.unwrap())):r instanceof ie?ie.create(de(r.unwrap())):r instanceof B?B.create(r.items.map(e=>de(e))):r}class N extends _{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=x.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==h.object){const d=this._getOrReturnCtx(e);return p(d,{code:u.invalid_type,expected:h.object,received:d.parsedType}),y}const{status:s,ctx:n}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof H&&this._def.unknownKeys==="strip"))for(const d in n.data)i.includes(d)||o.push(d);const c=[];for(const d of i){const l=a[d],C=n.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new U(n,C,n.path,d)),alwaysSet:d in n.data})}if(this._def.catchall instanceof H){const d=this._def.unknownKeys;if(d==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(d==="strict")o.length>0&&(p(n,{code:u.unrecognized_keys,keys:o}),s.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const l of o){const C=n.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new U(n,C,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const d=[];for(const l of c){const C=await l.key;d.push({key:C,value:await l.value,alwaysSet:l.alwaysSet})}return d}).then(d=>P.mergeObjectSync(s,d)):P.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return f.errToObj,new N({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var n,a,i,o;const c=(i=(a=(n=this._def).errorMap)===null||a===void 0?void 0:a.call(n,t,s).message)!==null&&i!==void 0?i:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=f.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new N({...this._def,unknownKeys:"strip"})}passthrough(){return new N({...this._def,unknownKeys:"passthrough"})}extend(e){return new N({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new N({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:m.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new N({...this._def,catchall:e})}pick(e){const t={};return x.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new N({...this._def,shape:()=>t})}omit(e){const t={};return x.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new N({...this._def,shape:()=>t})}deepPartial(){return de(this)}partial(e){const t={};return x.objectKeys(this.shape).forEach(s=>{const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}),new N({...this._def,shape:()=>t})}required(e){const t={};return x.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let a=this.shape[s];for(;a instanceof F;)a=a._def.innerType;t[s]=a}}),new N({...this._def,shape:()=>t})}keyof(){return is(x.objectKeys(this.shape))}}N.create=(r,e)=>new N({shape:()=>r,unknownKeys:"strip",catchall:H.create(),typeName:m.ZodObject,...v(e)});N.strictCreate=(r,e)=>new N({shape:()=>r,unknownKeys:"strict",catchall:H.create(),typeName:m.ZodObject,...v(e)});N.lazycreate=(r,e)=>new N({shape:r,unknownKeys:"strip",catchall:H.create(),typeName:m.ZodObject,...v(e)});class Ne extends _{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function n(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new z(o.ctx.common.issues));return p(t,{code:u.invalid_union,unionErrors:i}),y}if(t.common.async)return Promise.all(s.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(n);{let a;const i=[];for(const c of s){const d={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:d});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:d}),d.common.issues.length&&i.push(d.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new z(c));return p(t,{code:u.invalid_union,unionErrors:o}),y}}get options(){return this._def.options}}Ne.create=(r,e)=>new Ne({options:r,typeName:m.ZodUnion,...v(e)});const Ze=r=>r instanceof Ee?Ze(r.schema):r instanceof $?Ze(r.innerType()):r instanceof Ce?[r.value]:r instanceof ee?r.options:r instanceof Oe?Object.keys(r.enum):r instanceof Pe?Ze(r._def.innerType):r instanceof ke?[void 0]:r instanceof Se?[null]:null;class Fe extends _{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.object)return p(t,{code:u.invalid_type,expected:h.object,received:t.parsedType}),y;const s=this.discriminator,n=t.data[s],a=this.optionsMap.get(n);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(p(t,{code:u.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const n=new Map;for(const a of t){const i=Ze(a.shape[e]);if(!i)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,a)}}return new Fe({typeName:m.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...v(s)})}}function tt(r,e){const t=Y(r),s=Y(e);if(r===e)return{valid:!0,data:r};if(t===h.object&&s===h.object){const n=x.objectKeys(e),a=x.objectKeys(r).filter(o=>n.indexOf(o)!==-1),i={...r,...e};for(const o of a){const c=tt(r[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===h.array&&s===h.array){if(r.length!==e.length)return{valid:!1};const n=[];for(let a=0;a<r.length;a++){const i=r[a],o=e[a],c=tt(i,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===h.date&&s===h.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Te extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(a,i)=>{if(Qe(a)||Qe(i))return y;const o=tt(a.value,i.value);return o.valid?((et(a)||et(i))&&t.dirty(),{status:t.value,value:o.data}):(p(s,{code:u.invalid_intersection_types}),y)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([a,i])=>n(a,i)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Te.create=(r,e,t)=>new Te({left:r,right:e,typeName:m.ZodIntersection,...v(t)});class B extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.array)return p(s,{code:u.invalid_type,expected:h.array,received:s.parsedType}),y;if(s.data.length<this._def.items.length)return p(s,{code:u.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y;!this._def.rest&&s.data.length>this._def.items.length&&(p(s,{code:u.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new U(s,i,s.path,o)):null}).filter(i=>!!i);return s.common.async?Promise.all(a).then(i=>P.mergeArray(t,i)):P.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new B({...this._def,rest:e})}}B.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new B({items:r,typeName:m.ZodTuple,rest:null,...v(e)})};class Ie extends _{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.object)return p(s,{code:u.invalid_type,expected:h.object,received:s.parsedType}),y;const n=[],a=this._def.keyType,i=this._def.valueType;for(const o in s.data)n.push({key:a._parse(new U(s,o,s.path,o)),value:i._parse(new U(s,s.data[o],s.path,o))});return s.common.async?P.mergeObjectAsync(t,n):P.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof _?new Ie({keyType:e,valueType:t,typeName:m.ZodRecord,...v(s)}):new Ie({keyType:A.create(),valueType:e,typeName:m.ZodRecord,...v(t)})}}class Ge extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.map)return p(s,{code:u.invalid_type,expected:h.map,received:s.parsedType}),y;const n=this._def.keyType,a=this._def.valueType,i=[...s.data.entries()].map(([o,c],d)=>({key:n._parse(new U(s,o,s.path,[d,"key"])),value:a._parse(new U(s,c,s.path,[d,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const d=await c.key,l=await c.value;if(d.status==="aborted"||l.status==="aborted")return y;(d.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(d.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const d=c.key,l=c.value;if(d.status==="aborted"||l.status==="aborted")return y;(d.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(d.value,l.value)}return{status:t.value,value:o}}}}Ge.create=(r,e,t)=>new Ge({valueType:e,keyType:r,typeName:m.ZodMap,...v(t)});class ae extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==h.set)return p(s,{code:u.invalid_type,expected:h.set,received:s.parsedType}),y;const n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(p(s,{code:u.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(p(s,{code:u.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const d=new Set;for(const l of c){if(l.status==="aborted")return y;l.status==="dirty"&&t.dirty(),d.add(l.value)}return{status:t.value,value:d}}const o=[...s.data.values()].map((c,d)=>a._parse(new U(s,c,s.path,d)));return s.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new ae({...this._def,minSize:{value:e,message:f.toString(t)}})}max(e,t){return new ae({...this._def,maxSize:{value:e,message:f.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ae.create=(r,e)=>new ae({valueType:r,minSize:null,maxSize:null,typeName:m.ZodSet,...v(e)});class ue extends _{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.function)return p(t,{code:u.invalid_type,expected:h.function,received:t.parsedType}),y;function s(o,c){return Le({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,je(),we].filter(d=>!!d),issueData:{code:u.invalid_arguments,argumentsError:c}})}function n(o,c){return Le({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,je(),we].filter(d=>!!d),issueData:{code:u.invalid_return_type,returnTypeError:c}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof pe?R(async(...o)=>{const c=new z([]),d=await this._def.args.parseAsync(o,a).catch(T=>{throw c.addIssue(s(o,T)),c}),l=await i(...d);return await this._def.returns._def.type.parseAsync(l,a).catch(T=>{throw c.addIssue(n(l,T)),c})}):R((...o)=>{const c=this._def.args.safeParse(o,a);if(!c.success)throw new z([s(o,c.error)]);const d=i(...c.data),l=this._def.returns.safeParse(d,a);if(!l.success)throw new z([n(d,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ue({...this._def,args:B.create(e).rest(re.create())})}returns(e){return new ue({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new ue({args:e||B.create([]).rest(re.create()),returns:t||re.create(),typeName:m.ZodFunction,...v(s)})}}class Ee extends _{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ee.create=(r,e)=>new Ee({getter:r,typeName:m.ZodLazy,...v(e)});class Ce extends _{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return p(t,{received:t.data,code:u.invalid_literal,expected:this._def.value}),y}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ce.create=(r,e)=>new Ce({value:r,typeName:m.ZodLiteral,...v(e)});function is(r,e){return new ee({values:r,typeName:m.ZodEnum,...v(e)})}class ee extends _{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return p(t,{expected:x.joinValues(s),received:t.parsedType,code:u.invalid_type}),y}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),s=this._def.values;return p(t,{received:t.data,code:u.invalid_enum_value,options:s}),y}return R(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return ee.create(e)}exclude(e){return ee.create(this.options.filter(t=>!e.includes(t)))}}ee.create=is;class Oe extends _{_parse(e){const t=x.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==h.string&&s.parsedType!==h.number){const n=x.objectValues(t);return p(s,{expected:x.joinValues(n),received:s.parsedType,code:u.invalid_type}),y}if(t.indexOf(e.data)===-1){const n=x.objectValues(t);return p(s,{received:s.data,code:u.invalid_enum_value,options:n}),y}return R(e.data)}get enum(){return this._def.values}}Oe.create=(r,e)=>new Oe({values:r,typeName:m.ZodNativeEnum,...v(e)});class pe extends _{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.promise&&t.common.async===!1)return p(t,{code:u.invalid_type,expected:h.promise,received:t.parsedType}),y;const s=t.parsedType===h.promise?t.data:Promise.resolve(t.data);return R(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}pe.create=(r,e)=>new pe({type:r,typeName:m.ZodPromise,...v(e)});class $ extends _{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===m.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null;if(n.type==="preprocess"){const i=n.transform(s.data);return s.common.async?Promise.resolve(i).then(o=>this._def.schema._parseAsync({data:o,path:s.path,parent:s})):this._def.schema._parseSync({data:i,path:s.path,parent:s})}const a={addIssue:i=>{p(s,i),i.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),n.type==="refinement"){const i=o=>{const c=n.refinement(o,a);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?y:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){const i=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Ae(i))return i;const o=n.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(i=>Ae(i)?Promise.resolve(n.transform(i.value,a)).then(o=>({status:t.value,value:o})):i);x.assertNever(n)}}$.create=(r,e,t)=>new $({schema:r,typeName:m.ZodEffects,effect:e,...v(t)});$.createWithPreprocess=(r,e,t)=>new $({schema:e,effect:{type:"preprocess",transform:r},typeName:m.ZodEffects,...v(t)});class F extends _{_parse(e){return this._getType(e)===h.undefined?R(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}F.create=(r,e)=>new F({innerType:r,typeName:m.ZodOptional,...v(e)});class ie extends _{_parse(e){return this._getType(e)===h.null?R(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ie.create=(r,e)=>new ie({innerType:r,typeName:m.ZodNullable,...v(e)});class Pe extends _{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===h.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Pe.create=(r,e)=>new Pe({innerType:r,typeName:m.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...v(e)});class Ue extends _{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return ze(n)?n.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new z(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new z(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Ue.create=(r,e)=>new Ue({innerType:r,typeName:m.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...v(e)});class Be extends _{_parse(e){if(this._getType(e)!==h.nan){const s=this._getOrReturnCtx(e);return p(s,{code:u.invalid_type,expected:h.nan,received:s.parsedType}),y}return{status:"valid",value:e.data}}}Be.create=r=>new Be({typeName:m.ZodNaN,...v(r)});const Or=Symbol("zod_brand");class os extends _{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Me extends _{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?y:a.status==="dirty"?(t.dirty(),as(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})})();{const n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?y:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new Me({in:e,out:t,typeName:m.ZodPipeline})}}const cs=(r,e={},t)=>r?he.create().superRefine((s,n)=>{var a,i;if(!r(s)){const o=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,c=(i=(a=o.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0,d=typeof o=="string"?{message:o}:o;n.addIssue({code:"custom",...d,fatal:c})}}):he.create(),Pr={object:N.lazycreate};var m;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline"})(m||(m={}));const Mr=(r,e={message:`Input not instance of ${r.name}`})=>cs(t=>t instanceof r,e),ds=A.create,ls=X.create,Rr=Be.create,Dr=Q.create,us=be.create,Zr=ne.create,jr=Ve.create,Lr=ke.create,Ar=Se.create,zr=he.create,Vr=re.create,$r=H.create,Gr=$e.create,Ur=V.create,Br=N.create,Wr=N.strictCreate,Fr=Ne.create,Hr=Fe.create,Kr=Te.create,Jr=B.create,qr=Ie.create,Yr=Ge.create,Xr=ae.create,Qr=ue.create,en=Ee.create,tn=Ce.create,sn=ee.create,rn=Oe.create,nn=pe.create,Ht=$.create,an=F.create,on=ie.create,cn=$.createWithPreprocess,dn=Me.create,ln=()=>ds().optional(),un=()=>ls().optional(),hn=()=>us().optional(),pn={string:r=>A.create({...r,coerce:!0}),number:r=>X.create({...r,coerce:!0}),boolean:r=>be.create({...r,coerce:!0}),bigint:r=>Q.create({...r,coerce:!0}),date:r=>ne.create({...r,coerce:!0})},fn=y;var Z=Object.freeze({__proto__:null,defaultErrorMap:we,setErrorMap:vr,getErrorMap:je,makeIssue:Le,EMPTY_PATH:_r,addIssueToContext:p,ParseStatus:P,INVALID:y,DIRTY:as,OK:R,isAborted:Qe,isDirty:et,isValid:Ae,isAsync:ze,get util(){return x},get objectUtil(){return Xe},ZodParsedType:h,getParsedType:Y,ZodType:_,ZodString:A,ZodNumber:X,ZodBigInt:Q,ZodBoolean:be,ZodDate:ne,ZodSymbol:Ve,ZodUndefined:ke,ZodNull:Se,ZodAny:he,ZodUnknown:re,ZodNever:H,ZodVoid:$e,ZodArray:V,ZodObject:N,ZodUnion:Ne,ZodDiscriminatedUnion:Fe,ZodIntersection:Te,ZodTuple:B,ZodRecord:Ie,ZodMap:Ge,ZodSet:ae,ZodFunction:ue,ZodLazy:Ee,ZodLiteral:Ce,ZodEnum:ee,ZodNativeEnum:Oe,ZodPromise:pe,ZodEffects:$,ZodTransformer:$,ZodOptional:F,ZodNullable:ie,ZodDefault:Pe,ZodCatch:Ue,ZodNaN:Be,BRAND:Or,ZodBranded:os,ZodPipeline:Me,custom:cs,Schema:_,ZodSchema:_,late:Pr,get ZodFirstPartyTypeKind(){return m},coerce:pn,any:zr,array:Ur,bigint:Dr,boolean:us,date:Zr,discriminatedUnion:Hr,effect:Ht,enum:sn,function:Qr,instanceof:Mr,intersection:Kr,lazy:en,literal:tn,map:Yr,nan:Rr,nativeEnum:rn,never:$r,null:Ar,nullable:on,number:ls,object:Br,oboolean:hn,onumber:un,optional:an,ostring:ln,pipeline:dn,preprocess:cn,promise:nn,record:qr,set:Xr,strictObject:Wr,string:ds,symbol:jr,transformer:Ht,tuple:Jr,undefined:Lr,union:Fr,unknown:Vr,void:Gr,NEVER:fn,ZodIssueCode:u,quotelessJson:yr,ZodError:z});const mn=Z.object({id:Z.string(),label:Z.string().nullable(),targetPath:Z.string(),targetType:Z.enum(["forms","hooks","jobs","scripts"])}),yn=Z.object({type:Z.enum(["forms","hooks","jobs","scripts"]),position:Z.tuple([Z.number(),Z.number()]),label:Z.string(),id:Z.string(),transitions:Z.array(mn)}),vn=Z.array(yn),ye={"Content-Type":"application/json"};class _n{constructor(){S(this,"pubsub");this.pubsub=new ts}async getInitialData(){const e=await fetch("/_editor/api/workflow-editor/initial-data");if(e.ok){const t=await e.json();return vn.parse(t)}else throw this.pubsub.publish("error",{message:await e.text(),action:"getInitialData"}),new Error("Failed to fetch initial data")}async move(e){const t=await fetch("/_editor/api/workflow-editor/move",{method:"POST",headers:ye,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"move"}),new Error("Failed to move nodes")}async delete(e){const t=await fetch("/_editor/api/workflow-editor/delete",{method:"POST",headers:ye,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"delete"}),new Error("Failed to delete nodes")}async addNodes(e){const t=await fetch("/_editor/api/workflow-editor/add-nodes",{method:"POST",headers:ye,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"addNodes"}),new Error("Failed to add nodes")}async duplicateNodes(e){const t=await fetch("/_editor/api/workflow-editor/duplicate-nodes",{method:"POST",headers:ye,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"duplicateNodes"}),new Error("Failed to duplicate nodes")}async addTransition(e){const t=await fetch("/_editor/api/workflow-editor/add-transition",{method:"POST",headers:ye,body:JSON.stringify(e)});if(!t.ok)throw this.pubsub.publish("error",{message:await t.text(),action:"duplicateNodes"}),new Error("Failed to duplicate nodes")}}const q=new _n,gn="#ababab",xn="#e55b70";function hs(r,e,t){const s=e.projectedCenter(r);let n;if(t instanceof j){const i=t.projectedRect(r),o=Ye(i);n=At(s,G(s,o),t.projectedRect(r))}else n=r.mouseState.mousePos;return{p1:At(n,G(n,s),e.projectedRect(r)),p2:n}}function ps(r,e,t,s=!1){const{p1:n,p2:a}=hs(r,e,t),i=20,o=10;if(Ls(n,a)<2*i)return;const c=Math.atan2(a.y-n.y,a.x-n.x);r.ctx.strokeStyle=s?xn:gn,r.ctx.lineWidth=4,r.ctx.lineJoin="round",r.ctx.lineCap="round",r.ctx.beginPath(),r.ctx.moveTo(n.x+i*Math.cos(c),n.y+i*Math.sin(c)),r.ctx.lineTo(a.x-i*Math.cos(c),a.y-i*Math.sin(c)),r.ctx.moveTo(a.x-i*Math.cos(c)-o*Math.cos(c-Math.PI/6),a.y-i*Math.sin(c)-o*Math.sin(c-Math.PI/6)),r.ctx.lineTo(a.x-i*Math.cos(c),a.y-i*Math.sin(c)),r.ctx.lineTo(a.x-i*Math.cos(c)-o*Math.cos(c+Math.PI/6),a.y-i*Math.sin(c)-o*Math.sin(c+Math.PI/6)),r.ctx.stroke()}class fe{constructor(e,t,s){S(this,"sourceType");S(this,"sourceId");S(this,"dto");if(!s.targetPath)throw new Error(`Link ${s.id} has no target`);this.sourceType=e,this.sourceId=t,this.dto=s}get sourceNodeId(){return this.sourceId}get sourceNodeType(){return this.sourceType}get targetNodeId(){return this.dto.targetPath}get targetNodeType(){return this.dto.targetType}get id(){return this.dto.id}clone(e,t){return new fe(this.sourceType,e,{...this.dto,id:Us(),targetPath:t})}isHovering(e,t){const s=e.nodes.find(i=>i.id===this.sourceNodeId),n=e.nodes.find(i=>i.id===this.targetNodeId);if(!s)throw new Error(`Source node ${this.sourceId} not found`);if(!n)throw new Error(`Target node ${this.targetNodeId} not found`);const a={radius:10,segment:hs(e,s,n)};return js(t,a)}static from(e,t,s){return new fe(e,t,s)}render(e){const t=e.nodes.find(a=>a.id===this.sourceNodeId),s=e.nodes.find(a=>a.id===this.targetNodeId);if(!t)throw new Error(`Source node ${this.sourceId} not found`);if(!s)throw new Error(`Target node ${this.targetNodeId} not found`);const n=e.selectedLinks.includes(this);ps(e,t,s,n)}}const wn="#5b5b5b",qe=18;class j{constructor(e){S(this,"dto");this.dto=e}addLinkTo(e,t){const s=fe.from(this.type,this.id,{id:Ke(),label:"",targetPath:t.id,targetType:t.type});return e.addLink(s),s}get id(){return this.dto.id}get type(){return this.dto.type}get title(){return this.dto.label}static from(e){return new j(e)}static new(e){return new j({type:e,id:Ke(),position:[0,0],label:`New ${e.slice(0,-1)}`,transitions:[]})}static async getSavedState(){const e=await q.getInitialData(),t=e.map(n=>j.from(n)),s=e.flatMap(n=>n.transitions.map(a=>fe.from(n.type,n.id,a)));return{nodes:t,links:s}}get position(){return{x:this.dto.position[0],y:this.dto.position[1],referential:"world"}}set position(e){this.dto.position=[e.x,e.y]}projectedCenter(e){const t=e.camera.worldPoint2screen(this.position);if(e.mouseState.state==="MOVING"&&e.selectedNodes.includes(this))return ve(t,G(e.mouseState.initialMousePos,e.mouseState.mousePos));if(e.mouseState.state==="ADDING_NEW_NODES"&&e.mouseState.nodes.includes(this)){const s=le(e.mouseState.nodes.map(a=>a.screenRect(e)));if(!s)throw new Error("No hull found");const n=Ye(s);return ve(t,G(n,e.mouseState.mousePos))}else return t}get icon(){return{scripts:qt,forms:Yt,jobs:Xt,hooks:Qt}[this.dto.type]}screenRect(e){const t=e.camera.worldPoint2screen(this.position),n=this.getTextSize(e).width+50*e.camera.zoom,a=e.camera.zoom*(qe+22);return{x:t.x-n/2,y:t.y-a/2,width:n,height:a,referential:"screen"}}projectedRect(e){const t=this.projectedCenter(e),n=this.getTextSize(e).width+50*e.camera.zoom,a=e.camera.zoom*(qe+22);return{x:t.x-n/2,y:t.y-a/2,width:n,height:a,referential:"screen"}}renderIcon(e,t){e.ctx.fillStyle=wn,e.ctx.save(),e.ctx.translate(t.x+8*e.camera.zoom,t.y+8*e.camera.zoom),e.ctx.scale(e.camera.zoom,e.camera.zoom),e.ctx.fill(new Path2D(this.icon)),e.ctx.restore()}setTextRenderingCtx(e){e.ctx.textAlign="left",e.ctx.textBaseline="middle",e.ctx.fillStyle="black";const t=(qe*e.camera.zoom).toFixed(0);e.ctx.font=`${t}px sans-serif`}getTextSize(e){return this.setTextRenderingCtx(e),e.ctx.measureText(this.dto.label)}renderLabel(e,t){const s=Ye(t),n=t.x;this.setTextRenderingCtx(e),!(e.ctx.measureText(this.dto.label).width>t.width)&&e.ctx.fillText(this.dto.label,n+40*e.camera.zoom,s.y)}renderCard(e,t){e.ctx.save(),e.ctx.fillStyle="white",e.ctx.shadowBlur=15,e.ctx.shadowColor="rgba(0,0,0,0.1)",e.ctx.fillRect(t.x,t.y,t.width,t.height),e.ctx.restore(),e.ctx.strokeStyle="gray",this.renderIcon(e,t),this.renderLabel(e,t)}renderSelf(e){const t=this.projectedRect(e);this.renderCard(e,t)}renderDuplicating(e){if(e.mouseState.state==="MOVING"&&e.mouseState.duplicating&&e.selectedNodes.includes(this)){const t=this.projectedRect(e),s=G(e.mouseState.mousePos,e.mouseState.initialMousePos),n=As(t,s);this.renderCard(e,n)}}renderLinking(e){var t;e.mouseState.state!=="LINKING"||!e.selectedNodes.includes(this)||ps(e,this,(t=e.mouseState.snappedTarget)!=null?t:e.mouseState.mousePos)}render(e){this.renderLinking(e),this.renderSelf(e),this.renderDuplicating(e)}isHovering(e,t){return es(t,this.projectedRect(e))}translate(e){const t=ve(this.position,e);this.dto.position=[t.x,t.y]}clone(){return j.from({...this.dto,label:`${this.dto.label} (copy)`,id:Ke()})}}async function Kt(r,e,t){const s=e.selectedNodes[0];if(s.type==="forms")r.inspector={runtimeType:"forms",model:Re(await Jt.get(s.id)),inspectorMode:t};else if(s.type==="jobs")r.inspector={runtimeType:"jobs",model:Re(await ss.get(s.id)),inspectorMode:t};else if(s.type==="hooks")r.inspector={runtimeType:"hooks",model:Re(await $s.get(s.id)),inspectorMode:t};else if(s.type==="scripts")r.inspector={runtimeType:"scripts",model:Re(await _e.get(s.id)),inspectorMode:t};else throw new Error(`Unknown type ${s.type}`)}class ge{constructor(e){S(this,"canvasGui");S(this,"_inspector");S(this,"logService");this.canvasGui=e,window.__canvasGui=e,this._inspector=xe(null),this.logService=Bs.create()}static async init(e){const t=nt.create(e),s=new ge(t),a=navigator.userAgent.indexOf("Mac OS X")?"Option":"Alt";t.pubsub.subscribe("node:dblclick",()=>{Kt(s,t,"edit")});const i=at.create([{icon:Is,label:"Options (Double click/Enter)",click:async()=>{Kt(s,t,"edit")}},{icon:Es,label:"Add transition (T)",click:()=>{t.addTransition()}},{icon:Cs,label:`Duplicate (${a} + Drag)`,click:()=>{t.duplicateSelection()}},{icon:Os,label:"Delete (Delete/Backspace)",click:()=>{t.deleteSelection()}}]);t.setFloatingMenu(i);let o=null;return addEventListener("mousemove",c=>o=c),e.parentElement.addEventListener("keydown",c=>{!o||(c.key==="f"?t.dragstart(j.new("forms"),o):c.key==="h"?t.dragstart(j.new("hooks"),o):c.key==="j"?t.dragstart(j.new("jobs"),o):c.key==="s"&&t.dragstart(j.new("scripts"),o))}),await this.reload(t),t.init(),q.pubsub.subscribe("error",({message:c})=>{vs.error({message:c}),this.reload(t)}),t.pubsub.subscribe("nodes:moved",c=>q.move(c.map(d=>({type:d.node.type,id:d.node.id,position:[d.to.x,d.to.y]})))),t.pubsub.subscribe("deleted",c=>q.delete([...c.nodes.map(d=>({id:d.id,type:d.type})),...c.links.map(d=>({id:d.id,type:"transitions"}))])),t.pubsub.subscribe("nodes:added",c=>q.addNodes(c.nodes.map(d=>({position:[d.position.x,d.position.y],type:d.type,id:d.id,title:d.title})))),t.pubsub.subscribe("nodes:duplicated",c=>q.duplicateNodes(c.map(({duplicate:d,original:l})=>({original_id:l.id,new_id:d.id,type:l.type,position:[d.position.x,d.position.y],title:d.title})))),t.pubsub.subscribe("transition:added",c=>q.addTransition(c.links.map(d=>({source:{type:d.sourceNodeType,id:d.sourceNodeId},target:{id:d.targetNodeId,type:d.targetNodeType},id:d.id})))),s}static async reload(e){const t=await q.getInitialData();e.clear(),t.forEach(s=>{e.addNode(j.from(s)),s.transitions.forEach(n=>{e.addLink(fe.from(s.type,s.id,n))})})}get inspector(){return this._inspector.value}set inspector(e){this._inspector.value=e}async closeInspector(){var t;const e=async()=>new Promise(s=>Hs.confirm({title:"You have unsaved changes. Do you ",okText:"Save",cancelText:"Continue without saving",okButtonProps:{type:"primary"},cancelButtonProps:{danger:!0},onOk:async()=>{var n;await((n=this._inspector.value)==null?void 0:n.model.save()),await ge.reload(this.canvasGui),s()},onCancel:()=>s()}));(t=this._inspector.value)!=null&&t.model.hasChanges()&&await e(),this._inspector.value=null,ge.reload(this.canvasGui)}async dragstart(e,t){this.canvasGui.dragstart(j.new(e),t)}}const bn=We({__name:"ScriptSettings",props:{script:{}},setup(r){return(e,t)=>(I(),E(g(sr),{layout:"vertical"},{default:w(()=>[b(g(Ks),{label:"Name",required:""},{default:w(()=>[b(g(_s),{value:e.script.title,"onUpdate:value":t[0]||(t[0]=s=>e.script.title=s)},null,8,["value"])]),_:1}),b(Ws,{runtime:e.script},null,8,["runtime"])]),_:1}))}}),kn=We({__name:"ScriptTester",props:{script:{},logService:{}},setup(r,{expose:e}){const t=r,s=xe(!1);async function n(){s.value=!0;try{const{stdout:a,stderr:i}=await t.script.test();t.logService.log({type:"stdout",log:a}),t.logService.log({type:"stderr",log:i})}finally{s.value=!1}}return e({test:n}),(a,i)=>(I(),E(g(rr),{"show-icon":"",message:"Scripts should be intermediate tasks in the workflow and can't be run directly."}))}}),Sn=We({__name:"StageInspector",props:{runtime:{}},setup(r){const e=r;function t(a){switch(a.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"}}}const{result:s,loading:n}=rs(()=>nr.list(e.runtime instanceof ss?e.runtime.identifier:e.runtime.path));return(a,i)=>{var o;return I(),E(g(ar),{loading:g(n),"data-source":(o=g(s))!=null?o:[]},{header:w(()=>[b(g(Ut),null,{default:w(()=>[b(g(W),null,{default:w(()=>[L("ID")]),_:1}),b(g(W),null,{default:w(()=>[L("Status")]),_:1}),b(g(W),null,{default:w(()=>[L("Assignee")]),_:1}),b(g(W),null,{default:w(()=>[L("Data")]),_:1})]),_:1})]),renderItem:w(({item:c})=>[b(g(Ut),null,{default:w(()=>[b(g(W),null,{default:w(()=>[L(se(c.id.slice(0,8)),1)]),_:2},1024),b(g(ir),{color:t(c).color},{default:w(()=>[L(se(t(c).text),1)]),_:2},1032,["color"]),b(g(W),null,{default:w(()=>{var d;return[L(se((d=c.assignee)!=null?d:"Anyone"),1)]}),_:2},1024),b(g(gs),{"tree-data":g(Vs)(c.data)},null,8,["tree-data"])]),_:2},1024)]),_:1},8,["loading","data-source"])}}}),Nn={class:"workflow-editor"},Tn={class:"title"},In={href:"/_editor/style"},En={class:"workflow-editor-content"},Cn={class:"workflow-toolbar"},On=["onDragstart"],Pn={class:"canvas-container",tabindex:"0"},Mn=We({__name:"WorkflowEditor",setup(r){const e=xe(null),t=He(()=>{var O,K,k;const T=(k=(K=(O=l.value)==null?void 0:O.inspector)==null?void 0:K.model.title)!=null?k:"";return T.length>30?T.slice(0,30)+"...":T}),{result:s}=rs(()=>Ts.get()),n=He(()=>{var T;return(T=s.value)==null?void 0:T.makeRunnerData().logoUrl}),a=He(()=>{var T;return(T=s.value)==null?void 0:T.makeRunnerData().brandName}),i=xs();function o(){i.push({name:"workspace"})}const c=[{icon:Yt,title:"Forms",type:"forms",description:"Wait for a user input",key:"F"},{icon:Qt,title:"Hooks",type:"hooks",description:"Wait for an external API call",key:"H"},{icon:Xt,title:"Jobs",type:"jobs",description:"Scheduled tasks",key:"J"},{icon:qt,title:"Scripts",type:"scripts",description:"Run a script",key:"S"}],d=xe(null),l=ce(null),C=(T,O)=>{var K,k;(K=O.dataTransfer)==null||K.setData("type",T),(k=l.value)==null||k.dragstart(T,O)};return ws(async()=>{if(!d.value)throw new Error("Canvas not found");l.value=await ge.init(d.value)}),(T,O)=>{var K;return I(),jt("div",Nn,[b(g(Bt),{style:{padding:"5px 10px"},onBack:o},{extra:w(()=>[b(qs),b(or)]),avatar:w(()=>[n.value?(I(),E(g(cr),{key:0,src:n.value},null,8,["src"])):D("",!0),te("span",Tn,[b(g(W),null,{default:w(()=>[L(se(a.value||"New Workflow"),1)]),_:1}),te("a",In,[b(Lt,{path:g(Ps),class:"edit-icon"},null,8,["path"])])])]),_:1}),te("div",En,[te("div",Cn,[(I(),jt(bs,null,ks(c,k=>b(g(Ss),{key:k.type,placement:"right"},{title:w(()=>[b(g(lr),null,{default:w(()=>[b(g(W),null,{default:w(()=>[L(se(k.title),1)]),_:2},1024),b(g(W),{keyboard:""},{default:w(()=>[L(se(k.key),1)]),_:2},1024)]),_:2},1024)]),content:w(()=>[L(se(k.description),1)]),default:w(()=>[te("span",{draggable:"true",onDragstart:M=>C(k.type,M)},[b(Lt,{class:"toolbar-item",path:k.icon},null,8,["path"])],40,On)]),_:2},1024)),64))]),te("div",Pn,[te("canvas",{ref_key:"canvas",ref:d,class:"workflow-canvas"},null,512)])]),b(g(dr),{class:"workflow-inspector",open:!!((K=l.value)!=null&&K.inspector),width:640,"footer-style":{padding:0},onClose:O[1]||(O[1]=k=>{var M;return(M=l.value)==null?void 0:M.closeInspector()})},{title:w(()=>[b(g(Bt),{title:t.value,style:{padding:"5px 10px"}},{footer:w(()=>{var k;return[(k=l.value)!=null&&k.inspector?(I(),E(g(ur),{key:0,"active-key":l.value.inspector.inspectorMode,"onUpdate:activeKey":O[0]||(O[0]=M=>l.value.inspector.inspectorMode=M)},{rightExtra:w(()=>[]),default:w(()=>[b(g(Je),{key:"edit",tab:"Settings"}),b(g(Je),{key:"list-stage-runs",tab:"Task Queue"}),b(g(Je),{key:"start-abuble",tab:"Test"})]),_:1},8,["active-key"])):D("",!0)]}),extra:w(()=>{var k,M,J,me;return[((M=(k=l.value)==null?void 0:k.inspector)==null?void 0:M.model)instanceof g(Jt)?(I(),E(Js,{key:0,path:l.value.inspector.model.path},null,8,["path"])):D("",!0),((me=(J=l.value)==null?void 0:J.inspector)==null?void 0:me.inspectorMode)==="edit"?(I(),E(Ys,{key:1,model:l.value.inspector.model},null,8,["model"])):D("",!0)]}),_:1},8,["title"])]),default:w(()=>{var k,M,J,me,it,ot,ct,dt,lt,ut,ht,pt,ft,mt,yt,vt,_t,gt,xt,wt,bt,kt,St,Nt,Tt,It,Et,Ct,Ot,Pt,Mt,Rt,Dt,Zt;return[((M=(k=l.value)==null?void 0:k.inspector)==null?void 0:M.inspectorMode)==="list-stage-runs"?(I(),E(Sn,{key:0,runtime:l.value.inspector.model},null,8,["runtime"])):D("",!0),((me=(J=l.value)==null?void 0:J.inspector)==null?void 0:me.runtimeType)==="forms"&&((ot=(it=l.value)==null?void 0:it.inspector)==null?void 0:ot.inspectorMode)==="edit"?(I(),E(Ms,{key:1,form:l.value.inspector.model},null,8,["form"])):D("",!0),((dt=(ct=l.value)==null?void 0:ct.inspector)==null?void 0:dt.runtimeType)==="jobs"&&((ut=(lt=l.value)==null?void 0:lt.inspector)==null?void 0:ut.inspectorMode)==="edit"?(I(),E(er,{key:2,job:l.value.inspector.model},null,8,["job"])):D("",!0),((pt=(ht=l.value)==null?void 0:ht.inspector)==null?void 0:pt.runtimeType)==="hooks"&&((mt=(ft=l.value)==null?void 0:ft.inspector)==null?void 0:mt.inspectorMode)==="edit"?(I(),E(Xs,{key:3,hook:l.value.inspector.model},null,8,["hook"])):D("",!0),((vt=(yt=l.value)==null?void 0:yt.inspector)==null?void 0:vt.runtimeType)==="scripts"&&((gt=(_t=l.value)==null?void 0:_t.inspector)==null?void 0:gt.inspectorMode)==="edit"?(I(),E(bn,{key:4,script:l.value.inspector.model},null,8,["script"])):D("",!0),((wt=(xt=l.value)==null?void 0:xt.inspector)==null?void 0:wt.runtimeType)==="hooks"&&((kt=(bt=l.value)==null?void 0:bt.inspector)==null?void 0:kt.inspectorMode)==="start-abuble"?(I(),E(Qs,{key:5,hook:l.value.inspector.model,"log-service":l.value.logService},null,8,["hook","log-service"])):D("",!0),((Nt=(St=l.value)==null?void 0:St.inspector)==null?void 0:Nt.runtimeType)==="forms"&&((It=(Tt=l.value)==null?void 0:Tt.inspector)==null?void 0:It.inspectorMode)==="start-abuble"?(I(),E(Rs,{key:6,ref_key:"formTester",ref:e,form:l.value.inspector.model,"log-service":l.value.logService},null,8,["form","log-service"])):D("",!0),((Ct=(Et=l.value)==null?void 0:Et.inspector)==null?void 0:Ct.runtimeType)==="jobs"&&((Pt=(Ot=l.value)==null?void 0:Ot.inspector)==null?void 0:Pt.inspectorMode)==="start-abuble"?(I(),E(tr,{key:7,job:l.value.inspector.model,"log-service":l.value.logService},null,8,["job","log-service"])):D("",!0),((Rt=(Mt=l.value)==null?void 0:Mt.inspector)==null?void 0:Rt.runtimeType)==="scripts"&&((Zt=(Dt=l.value)==null?void 0:Dt.inspector)==null?void 0:Zt.inspectorMode)==="start-abuble"?(I(),E(kn,{key:8,script:l.value.inspector.model,"log-service":l.value.logService},null,8,["script","log-service"])):D("",!0)]}),footer:w(()=>{var k,M,J;return[((M=(k=l.value)==null?void 0:k.inspector)==null?void 0:M.inspectorMode)==="start-abuble"?(I(),E(Fs,{key:0,runtime:l.value.inspector.runtimeType,"log-service":l.value.logService,onRestart:(J=e.value)==null?void 0:J.restart},null,8,["runtime","log-service","onRestart"])):D("",!0)]}),_:1},8,["open"])])}}});const Ra=Ns(Mn,[["__scopeId","data-v-99bae5ed"]]);export{Ra as default};
//# sourceMappingURL=WorkflowEditor.0e8d87b3.js.map

var re=Object.defineProperty;var ue=(m,e,a)=>e in m?re(m,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[e]=a;var E=(m,e,a)=>(ue(m,typeof e!="symbol"?e+"":e,a),a);import{_ as de}from"./DocsButton.vue_vue_type_script_setup_true_lang.108b18e1.js";import{_ as Q}from"./AbstraButton.vue_vue_type_script_setup_true_lang.13670ae7.js";import{d as D,at as B,c as x,o as s,ac as b,ae as pe,h as $,ed as ge,e as z,r as M,M as G,w as ae,a as v,b as l,ej as P,u as t,cE as ye,bQ as O,cW as he,aY as A,cU as fe,g as _,t as C,cA as me,bT as ve,aI as _e,cJ as Ce,dg as ke,f as i,i as f,df as H,cD as we,dj as U,de as q,c$ as be,d9 as Ie,eh as Te,_ as ie,ei as Ue,Z as oe,cM as J,A as W,bW as je,bE as Ae,bD as le,es as Se,et as $e}from"./jwt-decode.esm.3348bca5.js";import{G as Ne}from"./PhDotsThreeVertical.vue.9d76c4de.js";import{k as F,o as Ve}from"./router.c6e27700.js";import{U as Ke}from"./UploadOutlined.64837788.js";import{_ as Ee}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.1035457c.js";import{L as Le}from"./Logo.fc8ace6c.js";import{A as se}from"./index.b91afb03.js";import{C as ce}from"./Card.4a8a30bb.js";import{A as Fe}from"./index.5197afb2.js";import"./constants.be8ad36c.js";import"./index.015caad7.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[e]="901fb57d-c9fe-402c-9176-fed2c7d562d5",m._sentryDebugIdIdentifier="sentry-dbid-901fb57d-c9fe-402c-9176-fed2c7d562d5")}catch{}})();const He=["width","height","fill","transform"],ze={key:0},xe=z("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),Re=[xe],Me={key:1},Pe=z("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),De=z("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Ze=[Pe,De],Be={key:2},qe=z("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),Ge=[qe],Oe={key:3},Je=z("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),We=[Je],Ye={key:4},Qe=z("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Xe=[Qe],en={key:5},nn=z("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),tn=[nn],an={name:"PhArrowsLeftRight"},on=D({...an,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(m){const e=m,a=B("weight","regular"),n=B("size","1em"),r=B("color","currentColor"),y=B("mirrored",!1),c=x(()=>{var I;return(I=e.weight)!=null?I:a}),k=x(()=>{var I;return(I=e.size)!=null?I:n}),S=x(()=>{var I;return(I=e.color)!=null?I:r}),N=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(I,d)=>(s(),b("svg",ge({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:S.value,transform:N.value},I.$attrs),[pe(I.$slots,"default"),c.value==="bold"?(s(),b("g",ze,Re)):c.value==="duotone"?(s(),b("g",Me,Ze)):c.value==="fill"?(s(),b("g",Be,Ge)):c.value==="light"?(s(),b("g",Oe,We)):c.value==="regular"?(s(),b("g",Ye,Xe)):c.value==="thin"?(s(),b("g",en,tn)):$("",!0)],16,He))}});class ln{async generateEcdsaKey(e){const{projectId:a,connectionName:n,connectorType:r}=e;return F.post(`projects/${a}/connectors/${r}/connections/${n}/ecdsa-key`,{})}async createEcdsaConnection(e){const{projectId:a,connectionName:n,connectorType:r,publicKey:y,privateKey:c,accessId:k}=e;return F.post(`projects/${a}/connectors/${r}/connections/${n}/create-ecdsa`,{publicKey:y,privateKey:c,accessId:k})}async generateRsaKey(e){const{projectId:a,connectionName:n,connectorType:r}=e;return F.post(`projects/${a}/connectors/${r}/connections/${n}/rsa-key`,{})}async createRsaConnection(e){const{projectId:a,connectionName:n,connectorType:r,publicKey:y,privateKey:c,apiToken:k}=e;return F.post(`projects/${a}/connectors/${r}/connections/${n}/create-rsa`,{publicKey:y,privateKey:c,apiToken:k})}async getLoginUrl(e,a,n,r,y){return F.get(`projects/${e}/connectors/${n}/connections/${a}/login-url`,{scopeIds:r.join(","),...y})}async listConnectors(e){return F.get(`projects/${e}/connectors`)}async createTokenConnection(e){const{projectId:a,connectionName:n,connectorType:r,tokens:y}=e,c={type:"tokens",tokens:y};return F.post(`projects/${a}/connectors/${r}/connections/${n}`,c)}async listConnections(e){return F.get(`projects/${e}/connections`)}async deleteConnection(e){const{projectId:a,connectionName:n,connectorType:r}=e;return F.delete(`projects/${a}/connectors/${r}/connections/${n}`)}async renameConnection(e){const{projectId:a,connectionName:n,connectorType:r,newConnectionName:y}=e;return F.patch(`projects/${a}/connectors/${r}/connections/${n}`,{newConnectionName:y})}}class sn{constructor(e,a){E(this,"state");E(this,"hasChanges",x(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));E(this,"handleDeletionClick",async e=>{G.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(e)})});E(this,"handleDeleteConnection",async e=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});E(this,"handleAddConnectionSubmit",async()=>{var y,c,k,S;const e=(y=this.state.value.addingConnection)==null?void 0:y.connector.metadata.key,a=(c=this.state.value.addingConnection)==null?void 0:c.selectedScopeIds,n=(S=(k=this.state.value.addingConnection)==null?void 0:k.tokenValues)!=null?S:{};if(!e||!a)throw new Error("No connector or scope selected");const{url:r}=await this.getLoginUrl(e,this.getUniqueName(e),a,n);window.location.href=r});E(this,"handleAddTokenConnectionSubmit",async()=>{const e=this.state.value.addingConnection;if(!e)throw new Error("No connection is being added");const a=e.connector.metadata.key,n=this.getUniqueName(a);await this.api.createTokenConnection({projectId:this.projectId,connectionName:n,connectorType:a,tokens:e.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()});E(this,"handleAddEcdsaConnectionSubmit",async(e,a)=>{const n=this.state.value.addingConnection;if(!n||!e)throw new Error("No connection is being added or public key is missing");if(!n.connectionName||!n.ecdsaKeys)throw new Error("Keys or connection name not found");const r=n.connector.metadata.key;if(r==="iugu"){if(!a)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:n.connectionName,connectorType:r,publicKey:n.ecdsaKeys.publicKey,privateKey:n.ecdsaKeys.privateKey,apiToken:a})}else{if(!a)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:n.connectionName,connectorType:r,publicKey:n.ecdsaKeys.publicKey,privateKey:n.ecdsaKeys.privateKey,accessId:a})}this.state.value.addingConnection=null,await this.refetchConnections()});E(this,"renameConnection",async()=>{const{editingConnection:e}=this.state.value;if(!e)throw new Error("No connection is being edited");const a=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType,newConnectionName:e.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};G.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:a})});E(this,"showAddConfirmationModal",e=>{this.state.value.addingConnection={selectedScopeIds:e.auth.type==="oauth2"?e.auth.scopes.map(a=>a.key):[],connector:e,tokenValues:{}}});E(this,"handleScopeToggle",(e,a)=>{a?this.state.value.addingConnection.selectedScopeIds.push(e):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(n=>n!==e)});this.projectId=e,this.api=a,this.state=M({connectors:[],connections:[],addingConnection:null,editingConnection:null})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchInitialState(){await this.fetchConnectors(),await this.refetchConnections()}async refetchConnections(){const e=await this.api.listConnections(this.projectId);this.state.value.connections=e.map(a=>{const n=this.state.value.connectors.find(r=>r.metadata.key===a.connectionType);return n?{name:a.name,connectorTitle:n.metadata.label,connectorType:a.connectionType,icon:n.metadata.logoUrl}:null}).filter(a=>a!==null)}handleEditConnectionClick(e){this.state.value.editingConnection={...e,newName:e.name}}async getLoginUrl(e,a,n,r){return this.api.getLoginUrl(this.projectId,a,e,n,r)}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(e){const a=this.state.value.connections.filter(n=>n.connectorType===e).length;return a===0?e:`${e}-${a}`}async generateEcdsaKey(){const e=this.state.value.addingConnection;if(!e)throw new Error("No connection is being added");const a=e.connector.metadata.key,n=this.getUniqueName(a),y=a==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:n,connectorType:a}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:n,connectorType:a});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=n,this.state.value.addingConnection.ecdsaKeys=y),y.publicKey}}function cn(m){return new Promise((e,a)=>{const n=new FileReader;n.onload=()=>{const y=n.result.split(",")[1];e(y)},n.onerror=()=>a(n.error),n.readAsDataURL(m)})}const rn={key:6,style:{"margin-top":"16px"}},Y=D({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(m,{emit:e}){const a=m,n=M(a.uploadedFiles||{});function r(u){const p=c.value[u];return p?p.split(",").map(o=>o.trim()):[]}function y(u,p){Array.isArray(p)?k(u,p.join(",")):console.error("Expected array for checkbox/select value")}const c=M({...a.tokenValues});ae(()=>a.tokenValues,u=>{c.value={...u}},{deep:!0}),ae(()=>a.uploadedFiles,u=>{n.value=u||{}},{deep:!0});function k(u,p){c.value[u]=p;const o={...c.value};e("update:tokenValues",o),e("tokenChange")}function S(u){var o,j;const p=[];return u.key&&p.push({required:!0,message:f.translate("i18n_auth_form_field_required",null,u.label||u.key)}),(o=u.input)!=null&&o.minSize&&p.push({min:u.input.minSize,message:f.translate("i18n_auth_form_field_min_length",null,u.input.minSize)}),(j=u.input)!=null&&j.maxSize&&p.push({max:u.input.maxSize,message:f.translate("i18n_auth_form_field_max_length",null,u.input.maxSize)}),p}async function N(u,p){try{const o=await cn(u),j={...n.value,[p]:{file:u,base64:o}};n.value=j,e("update:uploadedFiles",j),c.value[p]=o;const g={...c.value};e("update:tokenValues",g),e("tokenChange")}catch(o){console.error("Error converting file to base64:",o)}return!1}function I(u){const p={...n.value};delete p[u],n.value=p,e("update:uploadedFiles",p),c.value[u]="";const o={...c.value};e("update:tokenValues",o),e("tokenChange")}function d(u){const p=n.value[u];return p?[{uid:u,name:p.file.name,status:"done",size:p.file.size}]:[]}return(u,p)=>(s(),v(t(we),{model:c.value,layout:"vertical"},{default:l(()=>[(s(!0),b(A,null,P(u.tokens,o=>(s(),v(t(ye),{key:o.key,label:o.label,name:o.key,rules:S(o)},{default:l(()=>{var j,g,T,h,L,V,R,K,Z,X,ee,ne,te;return[((j=o.input)==null?void 0:j.type)==="small-string"?(s(),v(t(O),{key:0,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,placeholder:o.description,maxlength:(g=o.input)==null?void 0:g.maxSize,minlength:(T=o.input)==null?void 0:T.minSize,type:"password",onInput:()=>k(o.key,c.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((h=o.input)==null?void 0:h.type)==="radiobox"?(s(),v(t(he),{key:1,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,onChange:()=>k(o.key,c.value[o.key]||"")},{default:l(()=>[(s(!0),b(A,null,P(o.input.options,w=>(s(),v(t(fe),{key:w.value,value:w.value},{default:l(()=>[_(C(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):((L=o.input)==null?void 0:L.type)==="checkbox"?(s(),b(A,{key:2},[((K=(R=(V=o.input)==null?void 0:V.options)==null?void 0:R.length)!=null?K:0)<=10?(s(),v(t(me),{key:0,value:r(o.key),onChange:w=>y(o.key,w)},{default:l(()=>[(s(!0),b(A,null,P(o.input.options,w=>(s(),v(t(ve),{key:w.value,value:w.value},{default:l(()=>[_(C(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(s(),v(t(_e),{key:1,mode:"multiple",style:{width:"100%"},value:r(o.key),options:(Z=o.input.options)!=null?Z:[],onChange:w=>y(o.key,w)},null,8,["value","options","onChange"]))],64)):((X=o.input)==null?void 0:X.type)==="large-text"?(s(),v(t(Ce),{key:3,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,placeholder:o.description,maxlength:(ee=o.input)==null?void 0:ee.maxSize,minlength:(ne=o.input)==null?void 0:ne.minSize,rows:4,onInput:()=>k(o.key,c.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((te=o.input)==null?void 0:te.type)==="file"?(s(),v(t(ke),{key:4,"file-list":d(o.key),"before-upload":w=>N(w,o.key),"max-count":1,"show-upload-list":!0,onRemove:()=>I(o.key)},{default:l(()=>[i(Q,null,{default:l(()=>[i(t(Ke)),_(" "+C(t(f).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:2},1032,["file-list","before-upload","onRemove"])):(s(),v(t(O),{key:5,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,placeholder:o.description,type:"password",onInput:()=>k(o.key,c.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),o.instructions?(s(),b("div",rn,[i(t(H),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:l(()=>[_(C(o.instructions),1)]),_:2},1024)])):$("",!0),o.description&&!o.instructions?(s(),v(t(H),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:l(()=>[_(C(o.description),1)]),_:2},1024)):$("",!0)]}),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"]))}}),un=D({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(m){return(e,a)=>(s(),v(t(U),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:l(()=>[i(Ee,{"hide-text":"",size:"large"}),i(t(on),{size:24}),i(Le,{"image-url":e.connectorLogoUrl,"brand-name":e.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),dn=D({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(m,{emit:e}){const a=m,n=x(()=>{var u,p,o;switch((u=a.addingConnection)==null?void 0:u.connector.auth.type){case"oauth2":return f.translate("i18n_connection_modal_button_authorize",null);case"tokens":return f.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!a.ecdsaPublicKey)return f.translate("i18n_connection_modal_button_ok",null);const j=((p=a.addingConnection)==null?void 0:p.connector.auth.params)||[],g=((o=a.addingConnection)==null?void 0:o.tokenValues)||{};return j.every(h=>g[h.key]&&g[h.key].trim().length>0)?f.translate("i18n_connection_modal_button_create",null):f.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return f.translate("i18n_connection_modal_button_ok",null)}});function r(){e("cancel")}function y(){e("submit")}function c(d,u){e("scope-toggle",d,u)}function k(){e("generate-ecdsa-key")}function S(d){e("update:token-values",d)}function N(d){e("update:uploaded-files",d)}function I(){e("token-change")}return(d,u)=>(s(),v(t(G),{open:!!d.addingConnection,title:d.addingConnection?t(f).translate("i18n_connection_modal_title_add",null,d.addingConnection.connector.metadata.label):"","ok-text":n.value,"ok-button-props":{disabled:n.value.includes("Required")},"confirm-loading":d.loading,"wrap-class-name":"full-modal",onCancel:r,onOk:y},{default:l(()=>[d.addingConnection?(s(),b(A,{key:0},[i(un,{"connector-logo-url":d.addingConnection.connector.metadata.logoUrl,"connector-label":d.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),d.addingConnection.connector.auth.type==="oauth2"?(s(),b(A,{key:0},[i(t(q),null,{default:l(()=>[_(C(t(f).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),i(t(U),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:l(()=>{var p;return[(s(!0),b(A,null,P(d.addingConnection.connector.auth.scopes,o=>(s(),v(t(U),{key:o.key,justify:"space-between",align:"center"},{default:l(()=>[i(t(U),{vertical:""},{default:l(()=>[i(t(H),null,{default:l(()=>[_(C(o.description),1)]),_:2},1024),i(t(H),{type:"secondary"},{default:l(()=>[_(C(o.key),1)]),_:2},1024)]),_:2},1024),i(t(be),{checked:d.addingConnection.selectedScopeIds.includes(o.key),onChange:j=>c(o.key,j)},null,8,["checked","onChange"])]),_:2},1024))),128)),(p=d.addingConnection.connector.auth.params)!=null&&p.length?(s(),v(Y,{key:0,tokens:d.addingConnection.connector.auth.params,"token-values":d.addingConnection.tokenValues,"uploaded-files":d.uploadedFiles,"onUpdate:tokenValues":S,"onUpdate:uploadedFiles":N,onTokenChange:I},null,8,["tokens","token-values","uploaded-files"])):$("",!0)]}),_:1})],64)):$("",!0),d.addingConnection.connector.auth.type==="tokens"?(s(),b(A,{key:1},[i(t(q),null,{default:l(()=>[_(C(t(f).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),i(Y,{tokens:d.addingConnection.connector.auth.tokens,"token-values":d.addingConnection.tokenValues,"uploaded-files":d.uploadedFiles,"onUpdate:tokenValues":S,"onUpdate:uploadedFiles":N,onTokenChange:I},null,8,["tokens","token-values","uploaded-files"])],64)):$("",!0),d.addingConnection.connector.auth.type==="ecdsa"?(s(),b(A,{key:2},[d.ecdsaPublicKey?(s(),v(t(U),{key:1,vertical:"",gap:"16"},{default:l(()=>[i(t(H),{strong:""},{default:l(()=>[_(C(t(f).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),i(t(H),{strong:""},{default:l(()=>[_(C(t(f).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),i(t(O),{value:d.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),i(Y,{tokens:d.addingConnection.connector.auth.params,"token-values":d.addingConnection.tokenValues,"uploaded-files":d.uploadedFiles,"onUpdate:tokenValues":S,"onUpdate:uploadedFiles":N,onTokenChange:I},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(s(),b(A,{key:0},[i(t(q),null,{default:l(()=>[_(C(t(f).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),i(t(U),{vertical:"",gap:"16"},{default:l(()=>[i(Q,{loading:d.ecdsaKeyLoading,onClick:k},{default:l(()=>[_(C(t(f).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):$("",!0)],64)):$("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),pn=D({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{}},setup(m){return(e,a)=>(s(),v(t(ce),{class:Te({"connector-card":!0,unavailable:e.unavailable})},{default:l(()=>[i(t(U),{style:{width:"100%"},vertical:"",gap:12},{default:l(()=>[i(t(U),{justify:"space-between"},{default:l(()=>[i(t(se),{src:e.logoUrl,shape:"square",size:"large"},null,8,["src"]),i(t(U),{gap:8},{default:l(()=>[e.unavailable?(s(),v(t(Ie),{key:0,style:{height:"fit-content"}},{default:l(()=>[_(C(t(f).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):$("",!0)]),_:1})]),_:1}),i(t(U),{vertical:""},{default:l(()=>[i(t(H),{strong:""},{default:l(()=>[_(C(e.title),1)]),_:1}),i(t(H),{type:"secondary"},{default:l(()=>[_(C(e.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const gn=ie(pn,[["__scopeId","data-v-9ae431f9"]]),yn=m=>(Se("data-v-6a424100"),m=m(),$e(),m),hn=yn(()=>z("div",{style:{"flex-grow":"1"}},null,-1)),fn={class:"connectors-grid"},mn=D({__name:"ConnectorsView",setup(m){const a=Ue().params.projectId,n=new sn(a,new ln),r=M(null),y=M(!1),c=M({}),k=M(!1),S=x(()=>[...n.state.value.connectors.filter(g=>g.auth.type==="oauth2"),...n.state.value.connectors.filter(g=>g.auth.type==="tokens"),...n.state.value.connectors.filter(g=>g.auth.type==="ecdsa"),...n.state.value.connectors.filter(g=>g.auth.type==="manual")]),N=x(()=>n.state.value.connections.filter(g=>g&&g.name&&g.connectorTitle&&g.connectorType));n.fetchInitialState();function I(g){n.state.value.addingConnection&&(n.state.value.addingConnection.tokenValues=g)}function d(g){c.value=g}function u(){r.value=null,y.value=!1,c.value={}}async function p(){y.value=!0;try{const T=(await n.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");r.value=T}finally{y.value=!1}}async function o(){var T,h,L;const g=(T=n.state.value.addingConnection)==null?void 0:T.connector.auth.type;k.value=!0;try{switch(g){case"oauth2":return await n.handleAddConnectionSubmit();case"tokens":return await n.handleAddTokenConnectionSubmit();case"ecdsa":{const V=((h=n.state.value.addingConnection)==null?void 0:h.tokenValues)||{},R=(L=n.state.value.addingConnection)==null?void 0:L.connector.metadata.key;let K="";R==="starkbank"?K=V.projectId||"":R==="iugu"&&(K=V.apiToken||"");const Z=await n.handleAddEcdsaConnectionSubmit(r.value,K);return u(),Z}default:break}}catch(V){const R=K=>{try{return JSON.parse(K),!0}catch{return!1}};if(V instanceof Error&&R(V.message)){const K=oe.object({error:oe.string()}).safeParse(JSON.parse(V.message));if(K.success){J.error(K.data.error);return}else{J.error(f.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:V instanceof Error?V.message:"Unknown error"}));return}}else J.error(f.translate("i18n_connectorsview_failed_to_create"))}finally{k.value=!1}}function j(g){g.auth.type==="manual"?Ve.showNewMessage(f.translate("i18n_connectors_ask_for_access",null,g.metadata.label)):n.showAddConfirmationModal(g)}return(g,T)=>(s(),b(A,null,[i(t(Fe),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:l(()=>[i(t(U),{align:"center",justify:"space-between"},{default:l(()=>[i(t(W),null,{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),i(t(q),null,{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_description"))+" ",1),i(de)]),_:1}),N.value.length?(s(),v(t(U),{key:0,vertical:""},{default:l(()=>[i(t(W),{level:2},{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_installed")),1)]),_:1}),i(t(U),{vertical:"",gap:10},{default:l(()=>[(s(!0),b(A,null,P(N.value,h=>(s(),v(t(ce),{key:h.name},{default:l(()=>[i(t(U),{align:"center",gap:20},{default:l(()=>[i(t(se),{src:h.icon,height:"40px",shape:"square"},null,8,["src"]),i(t(H),{strong:""},{default:l(()=>[_(C(h.connectorTitle),1)]),_:2},1024),hn,i(t(H),{content:h.name,copyable:"",code:""},null,8,["content"]),i(t(je),null,{overlay:l(()=>[i(t(Ae),null,{default:l(()=>[i(t(le),{onClick:L=>t(n).handleEditConnectionClick(h)},{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_rename")),1)]),_:2},1032,["onClick"]),i(t(le),{danger:"",onClick:L=>t(n).handleDeletionClick(h)},{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:l(()=>[i(t(Ne))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):$("",!0),i(t(U),{vertical:""},{default:l(()=>[N.value.length?(s(),v(t(W),{key:0,level:2},{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_available")),1)]),_:1})):$("",!0),z("div",fn,[(s(!0),b(A,null,P(S.value,h=>(s(),v(gn,{key:h.metadata.key,title:h.metadata.label,"logo-url":h.metadata.logoUrl,description:h.metadata.description,unavailable:h.auth.type==="manual",connector:h,onClick:L=>j(h)},null,8,["title","logo-url","description","unavailable","connector","onClick"]))),128))])]),_:1})]),_:1}),i(t(G),{open:!!t(n).state.value.editingConnection,title:t(n).state.value.editingConnection?t(f).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:t(n).state.value.editingConnection.connectorTitle}):"",onCancel:T[2]||(T[2]=h=>t(n).state.value.editingConnection=null)},{footer:l(()=>[i(t(U),{justify:"end"},{default:l(()=>[i(Q,{disabled:!t(n).hasChanges.value,onClick:T[1]||(T[1]=h=>t(n).renameConnection())},{default:l(()=>[_(C(t(f).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:l(()=>[t(n).state.value.editingConnection?(s(),v(t(O),{key:0,value:t(n).state.value.editingConnection.newName,"onUpdate:value":T[0]||(T[0]=h=>t(n).state.value.editingConnection.newName=h)},null,8,["value"])):$("",!0)]),_:1},8,["open","title"]),i(dn,{"adding-connection":t(n).state.value.addingConnection,"ecdsa-public-key":r.value,"ecdsa-key-loading":y.value,"uploaded-files":c.value,loading:k.value,onCancel:T[3]||(T[3]=()=>{t(n).state.value.addingConnection=null,u()}),onSubmit:o,onScopeToggle:T[4]||(T[4]=(h,L)=>t(n).handleScopeToggle(h,L)),onGenerateEcdsaKey:p,"onUpdate:tokenValues":I,"onUpdate:uploadedFiles":d},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}});const Vn=ie(mn,[["__scopeId","data-v-6a424100"]]);export{Vn as default};
//# sourceMappingURL=ConnectorsView.d4b67e2e.js.map

import{C as F}from"./CrudView-omtinu6s.js";import{a as I,i as P,c as A,b as y,e as o,f as R,g as v,h as k,m as H,j as s,I as j,c9 as q,ad as U,p as m,u as e,w as i,ak as h,S as g,U as b,be as Q,bf as W,bg as J,ae as f,bt as X,ac as Y,D as ee,k as te,r as ae,aO as le,bd as ne,bm as re,K as ie,aQ as se,A as oe,b7 as ue,a8 as ce,M as de,aN as pe}from"./jwt-decode.esm-X_JHyrHe.js";import{a as V}from"./asyncComputed-CZ6DC1Cs.js";import{g as me}from"./datetime-7sgYCmSw.js";import{u as fe}from"./polling-BCWbcVpw.js";import{G as ge}from"./PhArrowCounterClockwise.vue-C99cnywc.js";import{H as be}from"./PhCube.vue-Gyi4tAda.js";import{G as _e}from"./PhDownloadSimple.vue-x2_SHRxu.js";import{L as ye,g as ve,r as he}from"./router-BfX34XLs.js";import{B as ke,a as Ce}from"./build-BBu8uuN_.js";import{P as we}from"./project-Di93b8x1.js";import"./tables-DRvslhiY.js";import{G as Ae}from"./PhClockCounterClockwise.vue-BTkZasXK.js";import{F as Oe,a as Se,G as Pe,I as xe}from"./PhWebhooksLogo.vue-7jG68_x7.js";import{S as x}from"./index-D_wdY2um.js";import{E as Ze}from"./ExclamationCircleOutlined-BxtQtvFx.js";import{C as Me}from"./CloseCircleOutlined-C_9cf9D2.js";import{L as M}from"./LoadingOutlined-CkwIdRXe.js";import"./DocsButton.vue_vue_type_script_setup_true_lang-DoAQCamW.js";import"./constants-BpBRrK-g.js";import"./url-D2MDCvfR.js";import"./PhDotsThreeVertical.vue-CMiDmYDS.js";import"./ts.worker-BwKuk5mh.js";import"./record-BoeAoZE0.js";import"./string-DXA1IHkK.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[t]="d6b8364a-c979-4689-9485-d550ae078a88",l._sentryDebugIdIdentifier="sentry-dbid-d6b8364a-c979-4689-9485-d550ae078a88")}catch{}})();var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};const $e=["width","height","fill","transform"],ze={key:0},Be=k("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-16-84a16,16,0,1,1-16-16A16,16,0,0,1,112,128Zm64,0a16,16,0,1,1-16-16A16,16,0,0,1,176,128Z"},null,-1),De=[Be],Ne={key:1},Ve=k("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),Ee=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm56-88a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm-44,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Ge=[Ve,Ee],Le={key:2},Te=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.13,104.13,0,0,0,128,24ZM84,140a12,12,0,1,1,12-12A12,12,0,0,1,84,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm44,0a12,12,0,1,1,12-12A12,12,0,0,1,172,140Z"},null,-1),Ke=[Te],Fe={key:3},Re=k("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm10-90a10,10,0,1,1-10-10A10,10,0,0,1,138,128Zm-44,0a10,10,0,1,1-10-10A10,10,0,0,1,94,128Zm88,0a10,10,0,1,1-10-10A10,10,0,0,1,182,128Z"},null,-1),He=[Re],qe={key:4},Ue=k("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm12-88a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm44,0a12,12,0,1,1-12-12A12,12,0,0,1,184,128Zm-88,0a12,12,0,1,1-12-12A12,12,0,0,1,96,128Z"},null,-1),Qe=[Ue],We={key:5},Je=k("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm8-92a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-44,0a8,8,0,1,1-8-8A8,8,0,0,1,92,128Zm88,0a8,8,0,1,1-8-8A8,8,0,0,1,180,128Z"},null,-1),Xe=[Je],Ye={name:"PhDotsThreeCircle"},et=I({...Ye,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const t=l,n=P("weight","regular"),c=P("size","1em"),u=P("color","currentColor"),O=P("mirrored",!1),p=A(()=>t.weight??n),w=A(()=>t.size??c),_=A(()=>t.color??u),C=A(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:O?"scale(-1, 1)":void 0);return(S,D)=>(o(),y("svg",H({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:_.value,transform:C.value},S.$attrs),[R(S.$slots,"default"),p.value==="bold"?(o(),y("g",ze,De)):p.value==="duotone"?(o(),y("g",Ne,Ge)):p.value==="fill"?(o(),y("g",Le,Ke)):p.value==="light"?(o(),y("g",Fe,He)):p.value==="regular"?(o(),y("g",qe,Qe)):p.value==="thin"?(o(),y("g",We,Xe)):v("",!0)],16,$e))}});function E(l){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},c=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),c.forEach(function(u){tt(l,u,n[u])})}return l}function tt(l,t,n){return t in l?Object.defineProperty(l,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):l[t]=n,l}var $=function(t,n){var c=E({},t,n.attrs);return s(j,E({},c,{icon:q}),null)};$.displayName="CheckCircleOutlined";$.inheritAttrs=!1;function G(l){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},c=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),c.forEach(function(u){at(l,u,n[u])})}return l}function at(l,t,n){return t in l?Object.defineProperty(l,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):l[t]=n,l}var z=function(t,n){var c=G({},t,n.attrs);return s(j,G({},c,{icon:Ie}),null)};z.displayName="MinusCircleOutlined";z.inheritAttrs=!1;function L(l){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},c=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),c.forEach(function(u){lt(l,u,n[u])})}return l}function lt(l,t,n){return t in l?Object.defineProperty(l,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):l[t]=n,l}var B=function(t,n){var c=L({},t,n.attrs);return s(j,L({},c,{icon:je}),null)};B.displayName="PauseCircleOutlined";B.inheritAttrs=!1;const nt={style:{display:"flex","align-items":"center",gap:"5px"}},rt={key:1},it=I({__name:"BuildInspector",props:{buildSpec:{}},setup(l){const t=U(),n=l,c=u=>{t.push({name:"logs",params:{projectId:n.buildSpec.projectId},query:u.logQuery})};return(u,O)=>l.buildSpec.runtimes.length>0?(o(),m(e(ye),{key:0,"item-layout":"horizontal","data-source":l.buildSpec.runtimes},{renderItem:i(({item:p})=>[s(e(ve),null,{actions:i(()=>[s(e(Q),null,{overlay:i(()=>[s(e(W),null,{default:i(()=>[s(e(J),{onClick:w=>c(p)},{default:i(()=>[k("div",nt,[s(e(Ae)),s(e(h),null,{default:i(()=>[g(b(e(f).translate("i18n_build_inspector_view_logs",null)),1)]),_:1})])]),_:1},8,["onClick"])]),_:2},1024)]),default:i(()=>[s(e(et),{style:{cursor:"pointer"}})]),_:2},1024)]),default:i(()=>[p.type=="form"?(o(),m(e(x),{key:0,size:"large"},{default:i(()=>[s(e(Oe)),s(e(h),{strong:""},{default:i(()=>[g(b(p.title),1)]),_:2},1024),s(e(h),{type:"secondary",code:""},{default:i(()=>[g("/"+b(p.path),1)]),_:2},1024)]),_:2},1024)):v("",!0),p.type=="job"?(o(),m(e(x),{key:1,size:"large"},{default:i(()=>[s(e(Se)),s(e(h),{strong:""},{default:i(()=>[g(b(p.title),1)]),_:2},1024),s(e(h),{type:"secondary",code:""},{default:i(()=>[g(b(p.schedule),1)]),_:2},1024)]),_:2},1024)):v("",!0),p.type=="hook"?(o(),m(e(x),{key:2,size:"large"},{default:i(()=>[s(e(Pe)),s(e(h),{strong:""},{default:i(()=>[g(b(p.title),1)]),_:2},1024),s(e(h),{type:"secondary",code:""},{default:i(()=>[g("/_hooks/"+b(p.path),1)]),_:2},1024)]),_:2},1024)):v("",!0),p.type=="script"?(o(),m(e(x),{key:3,size:"large"},{default:i(()=>[s(e(xe)),s(e(h),{strong:""},{default:i(()=>[g(b(p.title),1)]),_:2},1024)]),_:2},1024)):v("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(o(),y("div",rt,[s(e(X),{description:e(f).translate("i18n_build_inspector_no_runtimes",null)},null,8,["description"])]))}}),st=I({__name:"Builds",setup(l){const n=Y().params.projectId,{loading:c,result:u,refetch:O}=V(async()=>{const[a,r]=await Promise.all([ke.list(n),we.getStatus(n)]);return{b:a.map(N=>({build:N,status:r.filter(Z=>Z.buildId==N.id).map(Z=>Z.status)})),status:r}}),{startPolling:p,endPolling:w}=fe({task:O,interval:1e4});ee(()=>p()),te(()=>w());const _=ae(null),C=V(async()=>_.value?await Ce.get(_.value):null),S=()=>{const a=u.value?.b.find(d=>d.build.id===_.value);return`Version ${a?.build.id.slice(0,8)} - ${a?.build.createdAt.toLocaleString()}`},D=[{translationKey:"i18n_builds_deploying",tagColor:"blue",check:a=>(a.build.latest&&a.status.some(r=>r=="Running")&&u.value?.status.some(r=>r.buildId!==a.build.id))??!1,loading:!0},{translationKey:"i18n_builds_deactivating",tagColor:"orange",check:a=>a.build.status==="success"&&!a.build.latest&&a.status.some(r=>r=="Running"),loading:!0},{translationKey:"i18n_builds_live",tagColor:"green",check:a=>a.build.latest&&a.status.some(r=>r=="Running")},{translationKey:"i18n_builds_sleeping",tagColor:"cyan",check:a=>a.build.latest&&a.status.length===0},{translationKey:"i18n_builds_failed",tagColor:"red",check:a=>a.build.latest&&a.status.some(r=>r=="Failed")},{translationKey:"i18n_builds_inactive",tagColor:"default",check:a=>a.build.status==="success"},{translationKey:"i18n_builds_aborted",tagColor:"default",check:a=>a.build.status==="aborted"||a.build.status==="aborted-by-user"},{translationKey:"i18n_builds_failed",tagColor:"orange",check:a=>a.build.status==="failure"},{translationKey:"i18n_builds_deploying",tagColor:"blue",check:a=>a.build.status==="in-progress",loading:!0},{translationKey:"i18n_builds_uploading",tagColor:"yellow",check:a=>a.build.status==="pending"}];function T(a){const r=D.find(d=>d.check(a));return{text:r?f.translate(r.translationKey):"unknown",tagColor:r?.tagColor??"default",hover:a.build.log??void 0}}const K=A(()=>{const a=[{title:f.translate("i18n_builds_id")},{title:f.translate("i18n_builds_date")},{title:f.translate("i18n_builds_abstra_version")},{title:f.translate("i18n_builds_status")},{title:"",align:"right"}];return u.value?{columns:a,rows:u.value.b.map(r=>({key:r.build.id,cells:[{type:"text",text:r.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:me(r.build.createdAt,{weekday:void 0}),distance:le(r.build.createdAt)}},{type:"text",text:r.build.abstraVersion??"-"},{key:"status",type:"slot",payload:T(r)},{type:"actions",actions:[{icon:be,label:f.translate("i18n_builds_inspect_version"),onClick:async()=>{_.value=r.build.id,C.refetch()}},{icon:ge,label:f.translate("i18n_builds_view_application_logs"),onClick:()=>{he.push({name:"logs",params:{projectId:n},query:{buildId:r.build.id}})}},{icon:_e,label:f.translate("i18n_builds_download_files"),onClick:()=>r.build.download()}]}]}))}:{columns:a,rows:[]}});return(a,r)=>(o(),y(de,null,[s(F,{"entity-name":"build",loading:e(c),title:e(f).translate("i18n_builds_version_history"),description:e(f).translate("i18n_builds_description"),"empty-title":e(f).translate("i18n_builds_empty_title"),table:K.value,live:""},{date:i(({payload:d})=>[s(e(oe),null,{title:i(()=>[g(b(d.distance),1)]),default:i(()=>[g(b(d.date)+" ",1)]),_:2},1024)]),status:i(({payload:d})=>[s(e(ne),{open:d.hover?void 0:!1},{content:i(()=>[s(e(se),{style:{width:"300px",overflow:"auto","font-family":"monospace"},content:d.hover,copyable:""},null,8,["content"])]),default:i(()=>[d.text!=="unknown"?(o(),m(e(re),{key:0,color:d.tagColor,style:ie({cursor:d.hover?"pointer":"default"})},{default:i(()=>[d.text==="Live"?(o(),m(e($),{key:0})):d.text==="Inactive"?(o(),m(e(z),{key:1})):d.text==="Failed"?(o(),m(e(Ze),{key:2})):d.text==="Aborted"?(o(),m(e(Me),{key:3})):d.text==="Sleeping"?(o(),m(e(B),{key:4})):d.text==="Uploading"?(o(),m(e(M),{key:5})):d.text==="Deploying"?(o(),m(e(M),{key:6})):d.text==="Deactivating"?(o(),m(e(M),{key:7})):v("",!0),g(" "+b(d.text),1)]),_:2},1032,["color","style"])):v("",!0)]),_:2},1032,["open"])]),_:1},8,["loading","title","description","empty-title","table"]),_.value?(o(),m(e(ce),{key:0,footer:null,open:!!_.value,size:"large",width:"80%",title:S(),onCancel:r[0]||(r[0]=d=>_.value=null)},{default:i(()=>[!e(C).result.value||e(C).loading.value?(o(),m(e(ue),{key:0})):e(C).result.value?(o(),m(it,{key:1,"build-spec":e(C).result.value},null,8,["build-spec"])):v("",!0)]),_:1},8,["open","title"])):v("",!0)],64))}}),$t=pe(st,[["__scopeId","data-v-cfc16bae"]]);export{$t as default};
//# sourceMappingURL=Builds-zjl6AatP.js.map

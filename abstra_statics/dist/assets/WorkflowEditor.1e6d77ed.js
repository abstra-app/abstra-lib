var tt=Object.defineProperty;var at=(a,e,s)=>e in a?tt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var $e=(a,e,s)=>(at(a,typeof e!="symbol"?e+"":e,s),s);import{g as ot,W as nt,w as st}from"./controller.a4b04c0b.js";import{o as ge,u as lt}from"./omniChatStore.e2a2ad30.js";import{a as Se}from"./asyncComputed.3aa6bfc4.js";import{d as P,af as W,g as M,o,K as k,O as L,F as I,e5 as ye,a as A,e as it,f as z,b as c,w as u,u as t,aL as X,ea as de,c as b,da as K,d5 as oe,az as N,eb as Z,d3 as Ue,eh as Y,cH as rt,bM as xe,Q as ne,h as he,bu as Ce,aP as Ze,ec as De,N as J,J as ke,a8 as Ee,bE as pe,cs as ve,cr as Oe,cE as ut,ex as dt,B as ie,eo as Re,bs as ct,bq as Le,bK as pt,au as Ae,e3 as gt,d2 as ft,eG as vt,eH as mt,ek as yt,aj as ht,el as kt,em as _t}from"./index.79dc3613.js";import{u as G,P as wt,_ as bt,a as $t,b as Ct,g as Xe,c as ce,N as At,d as St,M as It,e as Mt}from"./vue-flow-core.11cfc463.js";import"./linters.a2a3c525.js";import{W as fe}from"./workspaces.9b8d8b61.js";import{U as xt,G as Dt}from"./UnsavedChangesHandler.2bfc84ae.js";import{w as me,s as Et}from"./metadata.f9b15aa3.js";import{A as zt}from"./index.e2ee6248.js";import{A as Ie}from"./index.745c1115.js";import{_ as Vt,a as Ht}from"./vue-flow-minimap.5b6efa39.js";import{G as Bt}from"./PhArrowCounterClockwise.vue.802f97a4.js";import{T as Tt}from"./TasksManager.88945fe2.js";import{a as Pt,b as Ft,n as Lt}from"./validations.6a3e760f.js";import{u as Nt}from"./editor.53929e78.js";import{A as jt}from"./index.62b0dfd5.js";import{t as Ye}from"./index.5bc82b4b.js";import{B as Ut}from"./Badge.2ec6bac1.js";import{G as Ne}from"./PhArrowDown.vue.da37fae2.js";import"./uuid.99cfae1b.js";import"./record.fadf5b09.js";import"./workspaceStore.527cc49d.js";import"./userStore.d0fdc011.js";import"./url.c29c9736.js";import"./colorHelpers.473bf6ef.js";import"./ExclamationCircleOutlined.bccf1344.js";import"./PhWebhooksLogo.vue.3b2d5a30.js";import"./tasksController.62d84b3f.js";import"./gateway.2413dea4.js";import"./popupNotifcation.31410171.js";import"./scripts.d3d21022.js";import"./polling.29f699a6.js";import"./string.5e94f9fd.js";import"./ant-design.ac026d59.js";import"./PhArrowSquareOut.vue.9d53934e.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.fbebc325.js";import"./Card.b1519b39.js";import"./TabPane.1571cc7a.js";import"./CollapsePanel.270e1387.js";import"./index.1ba25178.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="115f2621-402d-434c-baf6-a9ba42e643d6",a._sentryDebugIdIdentifier="sentry-dbid-115f2621-402d-434c-baf6-a9ba42e643d6")}catch{}})();const Zt=["width","height","fill","transform"],Ot={key:0},Rt=A("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Xt=[Rt],Yt={key:1},Wt=A("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Gt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),qt=[Wt,Gt],Kt={key:2},Jt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),Qt=[Jt],ea={key:3},ta=A("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),aa=[ta],oa={key:4},na=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),sa=[na],la={key:5},ia=A("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),ra=[ia],ua={name:"PhArrowClockwise"},da=P({...ua,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(a){const e=a,s=W("weight","regular"),n=W("size","1em"),i=W("color","currentColor"),v=W("mirrored",!1),p=M(()=>{var l;return(l=e.weight)!=null?l:s}),m=M(()=>{var l;return(l=e.size)!=null?l:n}),_=M(()=>{var l;return(l=e.color)!=null?l:i}),f=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:v?"scale(-1, 1)":void 0);return(l,g)=>(o(),k("svg",ye({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:m.value,height:m.value,fill:_.value,transform:f.value},l.$attrs),[L(l.$slots,"default"),p.value==="bold"?(o(),k("g",Ot,Xt)):p.value==="duotone"?(o(),k("g",Yt,qt)):p.value==="fill"?(o(),k("g",Kt,Qt)):p.value==="light"?(o(),k("g",ea,aa)):p.value==="regular"?(o(),k("g",oa,sa)):p.value==="thin"?(o(),k("g",la,ra)):I("",!0)],16,Zt))}}),ca=["width","height","fill","transform"],pa={key:0},ga=A("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),fa=[ga],va={key:1},ma=A("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),ya=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),ha=[ma,ya],ka={key:2},_a=A("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),wa=[_a],ba={key:3},$a=A("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Ca=[$a],Aa={key:4},Sa=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Ia=[Sa],Ma={key:5},xa=A("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Da=[xa],Ea={name:"PhFunnel"},za=P({...Ea,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(a){const e=a,s=W("weight","regular"),n=W("size","1em"),i=W("color","currentColor"),v=W("mirrored",!1),p=M(()=>{var l;return(l=e.weight)!=null?l:s}),m=M(()=>{var l;return(l=e.size)!=null?l:n}),_=M(()=>{var l;return(l=e.color)!=null?l:i}),f=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:v?"scale(-1, 1)":void 0);return(l,g)=>(o(),k("svg",ye({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:m.value,height:m.value,fill:_.value,transform:f.value},l.$attrs),[L(l.$slots,"default"),p.value==="bold"?(o(),k("g",pa,fa)):p.value==="duotone"?(o(),k("g",va,ha)):p.value==="fill"?(o(),k("g",ka,wa)):p.value==="light"?(o(),k("g",ba,Ca)):p.value==="regular"?(o(),k("g",Aa,Ia)):p.value==="thin"?(o(),k("g",Ma,Da)):I("",!0)],16,ca))}});class We{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const q=a=>We.isMac?a.metaKey:a.ctrlKey,Va=a=>a.shiftKey;class Ha{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const je=new Ha;class _e{constructor(e){this.dto=e}static async listConnections(){return(await je.listConnections()).map(s=>new _e(s))}static async getIsUsageMode(){return await je.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const Ge=it("agents-usage-mode",()=>{const a=z(!1);return(async()=>{a.value=await _e.getIsUsageMode()})(),{agentUsageMode:a}}),Ba=["onDragstart"],Ta={style:{display:"flex","flex-direction":"column","max-width":"250px"}},Pa=P({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(a,{emit:e}){const s=Ge(),n=M(()=>s.agentUsageMode?me.stages:me.stages.filter(i=>!["agents","clients"].includes(i.typeName)));return(i,v)=>(o(),k(X,null,[c(t(K),{class:"toolbar",align:"center"},{default:u(()=>[(o(!0),k(X,null,de(n.value,p=>(o(),b(t(rt),{key:p.key,placement:"top"},{title:u(()=>[c(t(K),{gap:"small"},{default:u(()=>[c(t(oe),null,{default:u(()=>[N(Z(p.title),1)]),_:2},1024),c(t(oe),{keyboard:""},{default:u(()=>[N(Z(p.key),1)]),_:2},1024)]),_:2},1024)]),content:u(()=>[A("div",Ta,[c(t(oe),null,{default:u(()=>[N(Z(p.description),1)]),_:2},1024),p.beta?(o(),b(t(Ie),{key:0,type:"warning",class:"beta-alert"},{description:u(()=>[c(t(oe),null,{default:u(()=>[N(" This is a beta feature, "),c(t(Ue),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:u(()=>[N(" click here ")]),_:1}),N(" to learn more about it ")]),_:1})]),_:1})):I("",!0)])]),default:u(()=>[A("div",{draggable:!0,class:"toolbar__item",onDragstart:m=>e("drag-start",m.dataTransfer,p.typeName)},[(o(),b(Y(p.icon),{size:18}))],40,Ba)]),_:2},1024))),128)),c(t(zt),{type:"vertical"}),c(t(xe),{disabled:!i.controller.hasChanges(),onClick:v[0]||(v[0]=p=>i.controller.save())},{default:u(()=>[c(t(K),{align:"center",gap:"small"},{default:u(()=>[c(t(Dt),{size:16}),N(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),c(xt,{"has-changes":i.controller.hasChanges()},null,8,["has-changes"])],64))}});const Fa=ne(Pa,[["__scopeId","data-v-d855dff0"]]);function qe(){let a;const e={draggedType:z(null),isDragOver:z(!1),isAdding:z(!1),isDragging:z(!1),mousePosition:z(null)},{draggedType:s,isDragOver:n,isDragging:i,isAdding:v}=e,p=C=>{a=C,document.addEventListener("mousemove",x)},{screenToFlowCoordinate:m}=G();he(v,C=>{document.body.style.userSelect=C?"none":""});function _(C,B){v.value=!0,C?(C.setData("application/vueflow",B),C.effectAllowed="move",s.value=B,i.value=!0,document.addEventListener("drop",g)):(s.value=B,document.addEventListener("click",w))}function f(C){C.preventDefault(),s.value&&(n.value=!0,C.dataTransfer&&(C.dataTransfer.dropEffect="move"))}function l(){n.value=!1}function g(){v.value=!1,i.value=!1,n.value=!1,s.value=null,document.removeEventListener("drop",g)}function x(C){const B={x:C.pageX-200,y:C.pageY-80};e.mousePosition.value=B}function d(C){if(!s.value)throw new Error("No dragged type");return m({x:C.clientX-70,y:C.clientY-25})}function w(C){if(!a)return;if(!s.value)throw new Error("No dragged type");const B=d(C);a.addStages([{type:s.value,position:B}]),g()}function H(){document.removeEventListener("mousemove",x)}return{init:p,tearDown:H,draggedType:s,isDragOver:n,isAdding:v,isDragging:i,mousePosition:e.mousePosition,onDragStart:_,onDragLeave:l,onDragOver:f,onDrop:w}}const La={name:"ControlButton",compatConfig:{MODE:3}},Na=(a,e)=>{const s=a.__vccOpts||a;for(const[n,i]of e)s[n]=i;return s},ja={class:"vue-flow__controls-button"};function Ua(a,e,s,n,i,v){return o(),k("button",ja,[L(a.$slots,"default")])}const ue=Na(La,[["render",Ua]]),Za={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Oa=A("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),Ra=[Oa];function Xa(a,e){return o(),k("svg",Za,Ra)}const Ya={render:Xa},Wa={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Ga=A("path",{d:"M0 0h32v4.2H0z"},null,-1),qa=[Ga];function Ka(a,e){return o(),k("svg",Wa,qa)}const Ja={render:Ka},Qa={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},eo=A("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),to=[eo];function ao(a,e){return o(),k("svg",Qa,to)}const oo={render:ao},no={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},so=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),lo=[so];function io(a,e){return o(),k("svg",no,lo)}const ro={render:io},uo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},co=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),po=[co];function go(a,e){return o(),k("svg",uo,po)}const fo={render:go},vo={name:"Controls",compatConfig:{MODE:3}},mo=P({...vo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>wt.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(a,{emit:e}){const{nodesDraggable:s,nodesConnectable:n,elementsSelectable:i,setInteractive:v,zoomIn:p,zoomOut:m,fitView:_,viewport:f,minZoom:l,maxZoom:g}=G(),x=Ce(()=>s.value||n.value||i.value),d=Ce(()=>f.value.zoom<=l.value),w=Ce(()=>f.value.zoom>=g.value);function H(){p(),e("zoomIn")}function C(){m(),e("zoomOut")}function B(){_(a.fitViewParams),e("fitView")}function T(){v(!x.value),e("interactionChange",!x.value)}return(S,j)=>(o(),b(t(bt),{class:"vue-flow__controls",position:S.position},{default:u(()=>[L(S.$slots,"top"),S.showZoom?(o(),k(X,{key:0},[L(S.$slots,"control-zoom-in",{},()=>[c(ue,{class:"vue-flow__controls-zoomin",disabled:w.value,onClick:H},{default:u(()=>[L(S.$slots,"icon-zoom-in",{},()=>[(o(),b(Y(t(Ya))))])]),_:3},8,["disabled"])]),L(S.$slots,"control-zoom-out",{},()=>[c(ue,{class:"vue-flow__controls-zoomout",disabled:d.value,onClick:C},{default:u(()=>[L(S.$slots,"icon-zoom-out",{},()=>[(o(),b(Y(t(Ja))))])]),_:3},8,["disabled"])])],64)):I("",!0),S.showFitView?L(S.$slots,"control-fit-view",{key:1},()=>[c(ue,{class:"vue-flow__controls-fitview",onClick:B},{default:u(()=>[L(S.$slots,"icon-fit-view",{},()=>[(o(),b(Y(t(oo))))])]),_:3})]):I("",!0),S.showInteractive?L(S.$slots,"control-interactive",{key:2},()=>[S.showInteractive?(o(),b(ue,{key:0,class:"vue-flow__controls-interactive",onClick:T},{default:u(()=>[x.value?L(S.$slots,"icon-unlock",{key:0},()=>[(o(),b(Y(t(fo))))]):I("",!0),x.value?I("",!0):L(S.$slots,"icon-lock",{key:1},()=>[(o(),b(Y(t(ro))))])]),_:3})):I("",!0)]):I("",!0),L(S.$slots,"default")]),_:3},8,["position"]))}}),yo=P({__name:"ControlButtons",props:{workflow:{}},setup(a){return(e,s)=>(o(),b(t(mo),{position:"top-left","show-interactive":!1},{default:u(()=>[c(t(ue),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:s[0]||(s[0]=n=>e.workflow.history.undo())},{default:u(()=>[c(t(Bt))]),_:1},8,["disabled"]),c(t(ue),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:s[1]||(s[1]=n=>e.workflow.history.redo())},{default:u(()=>[c(t(da))]),_:1},8,["disabled"])]),_:1}))}});class ho{constructor(e,s){$e(this,"dx");$e(this,"dy");this.dx=s.x-e.x,this.dy=s.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function ko(a,e,s=0){const{x:n,y:i}=e.center,{width:v,height:p}=e,m=new ho(a,e.center),_=s*(m.x/m.length),f=s*(m.y/m.length),l=p/v;let g,x;if(Math.abs(m.m)>Math.abs(l)){const d=p/2*(1/m.m);g=n-(m.y>0?d:-d),x=i+(m.y>0?-p/2:p/2)}else{const d=v/2*m.m;g=n+(m.x>0?-v/2:v/2),x=i-(m.x>0?d:-d)}return{x:g+_,y:x+f}}const _o=(a,e=0,s=0)=>{const n=Math.atan2(a.ty-a.sy,a.tx-a.sx),i=e*Math.sin(n),v=e*Math.cos(n),p=s*Math.cos(n),m=s*Math.sin(n);return{sourceX:a.sx-i+p,sourceY:a.sy+v+m,targetX:a.tx-i-p,targetY:a.ty+v-m}};function Me(a,e,s=0){const n={x:a.computedPosition.x+a.dimensions.width/2,y:a.computedPosition.y+a.dimensions.height/2},v={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return ko(n,v,s)}function Ke(a,e){const s=Me(a,e,-10),n=Me(e,a,-10);return{sx:n.x,sy:n.y,tx:s.x,ty:s.y}}const wo=P({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(a){return(e,s)=>(o(),b(t(K),{vertical:"",gap:"small",style:J({marginBottom:`-${16*e.menuOptions.length}%`})},{default:u(()=>[(o(!0),k(X,null,de(e.menuOptions,n=>(o(),b(t(Ze),{key:n.label,title:n.tooltip,placement:"right"},{default:u(()=>[c(t(xe),{class:De([{"warning-button":n.warning}]),disabled:n.disabled,style:J({backgroundColor:n.disabled?"#f5f5f5":void 0}),onClick:i=>n.click(i)},{default:u(()=>[c(t(K),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:u(()=>[N(Z(n.label)+" ",1),n.key?(o(),b(t(oe),{key:0,keyboard:"",disabled:n.disabled},{default:u(()=>[N(Z(n.key),1)]),_:2},1032,["disabled"])):I("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const bo=P({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(a){const e=a,s=[{label:"Edit task type",key:"E",click:()=>i.value="editing"},{label:"Delete",key:"Del",click:()=>x(e.data.id)}],n=z(e.data.props.taskType||""),i=z("idle"),v=()=>{i.value!=="idle"&&(n.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:n.value}),i.value="idle")},{onEdgeClick:p,onPaneClick:m,getSelectedEdges:_}=G();p(d=>{d.edge.id===e.id&&i.value==="idle"&&(i.value="selected")}),m(()=>v());const f=M(()=>Ke(e.sourceNode,e.targetNode)),l=M(()=>Xe(_o(f.value))),g=d=>{!_.value.map(w=>w.id).includes(e.data.id)||(d.key==="Enter"&&v(),(d.key==="e"||d.key==="E")&&(i.value="editing"))},{removeEdges:x}=G();return ke(()=>window.addEventListener("keydown",g)),Ee(()=>window.removeEventListener("keydown",g)),(d,w)=>(o(),k(X,null,[c(t($t),{path:l.value[0],"marker-end":d.markerEnd},null,8,["path","marker-end"]),c(t(Ct),null,{default:u(()=>[i.value==="idle"?(o(),k("div",{key:0,style:J({transform:`translate(-50%, -50%) translate(${l.value[1]}px,${l.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(o(),b(t(oe),{key:1},{default:u(()=>[N(Z(e.data.props.taskType),1)]),_:1})):(o(),b(t(za),{key:0,size:16}))],4)):i.value==="selected"?(o(),k("div",{key:1,style:J({transform:`translate(-50%, -120%) translate(${l.value[1]}px,${l.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[c(wo,{"is-connecting":!0,"is-editing":!0,"menu-options":s})],4)):i.value==="editing"?(o(),k("div",{key:2,style:J({transform:`translate(-50%, -50%) translate(${l.value[1]}px,${l.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[c(t(pe),{value:n.value,"onUpdate:value":w[0]||(w[0]=H=>n.value=H),placeholder:"Task type"},null,8,["value"])],4)):I("",!0)]),_:1})],64))}});const $o=ne(bo,[["__scopeId","data-v-aceb9f72"]]),Co={key:0},Ao=A("defs",null,[A("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[A("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),So=["d"],Io=P({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(a){const e=a,s=z(!0),{onNodeMouseEnter:n,onNodeMouseLeave:i}=G();n(_=>{_.node.id===e.sourceNode.id&&(s.value=!1)}),i(_=>{_.node.id===e.sourceNode.id&&(s.value=!0)});const v=M(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),p=M(()=>Ke(e.sourceNode,v.value)),m=M(()=>Xe({sourceX:p.value.sx,sourceY:p.value.sy,targetX:p.value.tx,targetY:p.value.ty}));return(_,f)=>s.value?(o(),k("g",Co,[Ao,A("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:m.value[0],"marker-end":"url(#arrowhead)"},null,8,So)])):I("",!0)}}),Mo=P({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(a,{emit:e}){const s=a,n=M(()=>{const i=Pt(s.filename);return i.valid?s.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:i});return(i,v)=>(o(),b(t(ut),{open:i.creatingFileStatus==="prompting"||i.creatingFileStatus==="creating",closable:!1,"confirm-loading":i.creatingFileStatus==="creating",onOk:v[1]||(v[1]=p=>e("create-file",i.filename)),onCancel:v[2]||(v[2]=p=>e("cancel"))},{default:u(()=>[c(t(Oe),{layout:"vertical",disabled:i.creatingFileStatus=="creating"},{default:u(()=>[c(t(ve),{label:"You're creating a new file. What should it be called?","validate-status":n.value.valid?"success":"error",help:n.value.valid?n.value.help:n.value.reason},{default:u(()=>[c(t(pe),{value:i.filename,onChange:v[0]||(v[0]=p=>e("update-filename",p.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),xo={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},Do=P({...xo,props:{nodeId:null,isVisible:{type:Boolean},position:{default:ce.Top},offset:{default:10},align:{default:"center"}},setup(a){const e=a,s=W(At,null),{viewportRef:n,viewport:i,getSelectedNodes:v,findNode:p}=G();function m(d,w,H,C,B){let T=.5;B==="start"?T=0:B==="end"&&(T=1);let S=[(d.x+d.width*T)*w.zoom+w.x,d.y*w.zoom+w.y-C],j=[-100*T,-100];switch(H){case ce.Right:S=[(d.x+d.width)*w.zoom+w.x+C,(d.y+d.height*T)*w.zoom+w.y],j=[0,-100*T];break;case ce.Bottom:S[1]=(d.y+d.height)*w.zoom+w.y+C,j[1]=0;break;case ce.Left:S=[d.x*w.zoom+w.x-C,(d.y+d.height*T)*w.zoom+w.y],j=[-100,-100*T];break}return`translate(${S[0]}px, ${S[1]}px) translate(${j[0]}%, ${j[1]}%)`}const _=M(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||s||""]).reduce((d,w)=>{const H=p(w);return H&&d.push(H),d},[])),f=M(()=>typeof e.isVisible=="boolean"?e.isVisible:_.value.length===1&&_.value[0].selected&&v.value.length===1),l=M(()=>St(_.value)),g=M(()=>Math.max(..._.value.map(d=>(d.computedPosition.z||1)+1))),x=M(()=>({position:"absolute",transform:m(l.value,i.value,e.position,e.offset,e.align),zIndex:g.value}));return(d,w)=>(o(),b(dt,{to:t(n),disabled:!t(n)},[t(f)&&t(_).length?(o(),k("div",ye({key:0},d.$attrs,{style:t(x),class:"vue-flow__node-toolbar"}),[L(d.$slots,"default")],16)):I("",!0)],8,["to","disabled"]))}}),Eo=P({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(a){return(e,s)=>(o(),b(t(Do),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:t(ce).Right},{default:u(()=>[c(t(K),{vertical:"",gap:"small",style:J({marginBottom:`-${16*e.menuOptions.length}%`})},{default:u(()=>[(o(!0),k(X,null,de(e.menuOptions,n=>(o(),b(t(Ze),{key:n.label,title:n.tooltip,placement:"right"},{default:u(()=>[c(t(xe),{class:De([{"warning-button":n.warning}]),disabled:n.disabled,style:J({backgroundColor:n.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:i=>n.click(i)},{default:u(()=>[c(t(K),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:u(()=>[N(Z(n.label)+" ",1),n.key?(o(),b(t(oe),{key:0,keyboard:"",disabled:n.disabled},{default:u(()=>[N(Z(n.key),1)]),_:2},1032,["disabled"])):I("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const zo=P({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(a,{emit:e}){var O;const s=a,n=z(!1),v=Ge().agentUsageMode,p=ie.object({title:ie.string(),clientStageId:ie.string().uuid(),inputSchemas:ie.any(),outputSchemas:ie.any()});he(()=>s.stageProps.projectId,()=>{n.value=!0,S()});const m=Nt(),_=()=>{var E;const $=(E=m.cloudProject)==null?void 0:E.id;return $?`https://cloud.abstra.io/projects/${$}/agents`:""},f=ie.array(p),l=z((O=s.stageProps.projectId)!=null?O:""),g=z(!1),x=$=>d.loading.value||!d.result.value?null:d.result.value.find(E=>E.agentConnection.id===$),d=Se(async()=>_e.listConnections()),w=M(()=>d.loading.value||!d.result.value?[]:d.result.value.map($=>({label:$.agentConnection.connectionName,key:$.agentConnection.id,value:$.agent.projectId}))),{result:H,loading:C,refetch:B,error:T}=Se(async()=>{const $=s.stageProps.projectId;if(!$)return[];const U=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${$}`)).json();return f.parse(U)}),S=Re.exports.debounce(()=>{n.value=!1,B()},500),j=M(()=>C.value||!H.value?[]:H.value.map($=>({label:$.title,value:$.clientStageId})));function Q($){e("update:stage-props",{...s.stageProps,projectId:$,clientStageId:null})}function ee($){const E=x($.key);!E||(Q(E.agent.projectId),l.value=E.agent.projectId,g.value=!1)}function h($){const E=$.target;l.value=E.value,Q(E.value),g.value=!0}function D($){g.value=$}function V($){const E=String($);!H.value||e("update:stage-props",{...s.stageProps,clientStageId:E})}return($,E)=>(o(),k(X,null,[c(t(ve),{label:"Project ID"},{default:u(()=>{var U;return[t(v)?(o(),b(t(pt),{key:0,trigger:"click",visible:g.value,onVisibleChange:D},{overlay:u(()=>[c(t(ct),{onClick:ee},{default:u(()=>[(o(!0),k(X,null,de(w.value,se=>(o(),b(t(Le),{key:se.key},{default:u(()=>[N(Z(se.label),1)]),_:2},1024))),128)),c(t(Le),null,{default:u(()=>[c(t(Ue),{class:"cloud-link",href:_(),target:"_blank"},{default:u(()=>[N(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:u(()=>[c(t(pe),{value:l.value,"onUpdate:value":E[0]||(E[0]=se=>l.value=se),autofocus:"","allow-clear":"",onInput:h},null,8,["value"])]),_:1},8,["visible"])):(o(),b(t(pe),{key:1,value:(U=$.stageProps.projectId)!=null?U:"",placeholder:"Project ID",autofocus:"","onUpdate:value":Q},null,8,["value"]))]}),_:1}),c(t(ve),{label:"Client entrypoint"},{default:u(()=>{var U;return[n.value||t(C)?(o(),b(t(Ae),{key:0,disabled:"",loading:""})):t(T)?(o(),b(t(Ie),{key:1,type:"error",message:"Invalid project id"})):$.stageProps.projectId?t(H).length===0?(o(),b(t(Ie),{key:3,type:"warning",message:"The project has no entrypoints"})):(o(),b(t(Ae),{key:4,class:"entrypoint-select",options:j.value,value:(U=$.stageProps.clientStageId)!=null?U:void 0,"onUpdate:value":V},null,8,["options","value"])):(o(),b(t(Ae),{key:2,disabled:""}))]}),_:1})],64))}});const Vo=ne(zo,[["__scopeId","data-v-f4d2a34d"]]),Ho=P({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(a){var Fe;const e=a,{useToken:s}=Ye,{token:n}=s(),i=n.value.colorText,v=[{label:"Add transition",key:"C",click:r=>Ve(r)},{label:"Rename",key:"R",click:()=>R.value=!0},{label:"Go to editor",key:"Enter",click:()=>ze()},{label:"Tasks",key:"M",click:()=>m.value=!0},{label:"Delete",key:"Del",click:()=>h(e.stage)}],p=M(()=>{let r=[...v];return _.value||r.unshift({label:"Create missing file",warning:!0,click:()=>B()}),e.controller.hasChanges()&&(r=r.map(y=>y.label==="Go to editor"?{...y,disabled:!0,tooltip:"Save it to allow editing"}:y.label==="Tasks"?{...y,disabled:!0,tooltip:"Save it to allow managing tasks"}:y)),(e.stage.type==="agents"||e.stage.type==="clients")&&(r=r.filter(y=>!["Create missing file","Go to editor","Tasks"].includes(y.label))),e.stage.type==="agents"&&(r=r.map(y=>y.label==="Rename"?{...y,label:"Edit"}:y)),r}),m=z(!1),_=z(e.initialFileCheck);he(()=>e.initialFileCheck,r=>{_.value=r});const f=r=>{d.value=r,x()},l=r=>{e.controller.updateStageProps(e.stage.id,r)},g=()=>{var r;w.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(d.value=(r=e.stage.props.filename)!=null?r:"",x())},x=Re.exports.debounce(async()=>{const r=d.value;if(!r){_.value=!0;return}fe.checkFile(r).then(y=>{_.value=y.exists})},500),d=z((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Fe=e.stage.props.filename)!=null?Fe:""),w=z("idle"),H=async()=>{w.value="creating",await fe.initFile(d.value,e.stage.type),_.value=!0;const r=await fe.checkFile(d.value);if(_.value=r.exists,w.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:d.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:d.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},C=M(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!_.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),B=()=>{w.value="prompting"},{startConnection:T,updateConnection:S,onNodeClick:j,addEdges:Q,endConnection:ee,removeNodes:h,onPaneClick:D,getSelectedNodes:V,flowToScreenCoordinate:O,onNodeMouseEnter:$,onNodeMouseLeave:E,getNodes:U,onNodesChange:se,applyNodeChanges:Qe}=G(),et=gt(),te=z(!1),R=z(!1),ae=z(e.stage.title),we=z(!1),be=z(!1);se(async r=>{var F;const y=[];for(const le of r)le.type==="remove"?R.value||((F=e.controller)==null||F.delete([le.id]),y.push(le)):y.push(le);Qe(y)});const ze=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);be.value?window.open(`/_editor/${r}/${e.stage.id}`,"_blank"):et.push({path:`/_editor/${r}/${e.stage.id}`})},Ve=(r,y=!0)=>{T({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:y?r.pageX:r.pageX-90,y:y?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",He),te.value=!0},He=r=>{te.value&&!we.value&&S({x:r.pageX,y:r.pageY-52})};j(r=>{if(r.node.id===e.stage.id&&x(),te.value&&r.node.id!==e.stage.id){const y={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:ot(),props:{taskType:null}};try{e.controller.connect([y]),document.removeEventListener("mousemove",He),Q({id:y.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:It.Arrow,width:24,height:24},data:y}),ee(),te.value=!1}catch(F){console.error(F)}}}),$(r=>{if(te.value&&r.node.id!==e.stage.id){we.value=!0;const y=U.value.find(le=>le.id===e.stage.id);if(!y)return;const F=Me(y,r.node,-10);S(O({x:F.x,y:F.y-52}))}}),E(()=>{we.value=!1});const Be=()=>{if(!_.value){const r=Ft(ae.value+".py");d.value=r;let y={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const F=Lt(ae.value);y={...y,path:F}}e.controller.updateStageProps(e.stage.id,y)}};D(()=>{R.value=!1,e.stage.title!==ae.value&&(e.controller.updateStageTitle(e.stage.id,ae.value),Be()),te.value=!1,ee()});const Te=r=>{if(be.value=q(r),!!V.value.map(y=>y.id).includes(e.stage.id)&&w.value==="idle"){if(r.key==="Enter")if(R.value)R.value=!1,e.controller.updateStageTitle(e.stage.id,ae.value),Be();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;ze()}if(!R.value){if(r.key==="c"||r.key==="C"){const y=O(e.stage.position);Ve({pageX:y.x,pageY:y.y},!1)}if((r.key==="r"||r.key==="R")&&(R.value=!0),r.key==="m"||r.key==="M"){if(e.controller.hasChanges())return;m.value=!0}}}},Pe=r=>{be.value=q(r)};return ke(()=>{window.addEventListener("keydown",Te),window.addEventListener("keyup",Pe)}),Ee(()=>{window.removeEventListener("keydown",Te),window.removeEventListener("keyup",Pe)}),(r,y)=>(o(),k(X,null,[c(Eo,{"is-connecting":te.value,"is-editing":R.value,"menu-options":p.value},null,8,["is-connecting","is-editing","menu-options"]),A("div",{class:"stage",onDblclick:y[1]||(y[1]=F=>R.value=!0)},[c(t(K),{vertical:R.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:u(()=>[(o(),b(Y(t(Et)(r.stage.type)),{size:18,color:t(i)},null,8,["color"])),R.value?(o(),b(t(Oe),{key:1,layout:"vertical"},{default:u(()=>[c(t(ve),{label:"Title"},{default:u(()=>[c(t(pe),{value:ae.value,"onUpdate:value":y[0]||(y[0]=F=>ae.value=F),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),r.stage.type==="agents"?(o(),b(Vo,{key:0,"stage-props":r.stage.props,"onUpdate:stageProps":l},null,8,["stage-props"])):I("",!0)]),_:1})):(o(),b(t(ft),{key:0,class:"title"},{default:u(()=>[N(Z(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),C.value?(o(),b(t(Ut),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):I("",!0),w.value==="prompting"||w.value==="creating"?(o(),b(Mo,{key:1,filename:d.value,"file-exists":_.value,"creating-file-status":w.value,onCreateFile:H,onCancel:g,onUpdateFilename:f},null,8,["filename","file-exists","creating-file-status"])):I("",!0),c(t(jt),{visible:m.value,"onUpdate:visible":y[2]||(y[2]=F=>m.value=F),title:"Tasks",width:"500",onClose:y[3]||(y[3]=F=>m.value=!1)},{default:u(()=>[c(Tt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const re=ne(Ho,[["__scopeId","data-v-3342d51f"]]),Je=a=>(vt("data-v-f4278104"),a=a(),mt(),a),Bo={class:"empty-hint"},To={key:0,class:"drag-hint"},Po=Je(()=>A("div",{class:"title"},"Start here",-1)),Fo={key:1,class:"drop-hint"},Lo=Je(()=>A("div",{class:"title"},"Drop here",-1)),No={key:2,class:"stages-hint"},jo={class:"header"},Uo={class:"title"},Zo={class:"description"},Oo=P({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(a){return(e,s)=>(o(),k("div",Bo,[e.showDragHint?(o(),k("div",To,[Po,c(t(Ne),{size:32,class:"arrow"})])):I("",!0),e.showDragHint?I("",!0):(o(),k("div",Fo,[Lo,c(t(Ne),{size:32,class:"arrow"})])),e.showDragHint?(o(),k("div",No,[(o(!0),k(X,null,de(t(me).stages,n=>(o(),k("div",{key:n.key,class:"stage-hint"},[A("div",jo,[(o(),b(Y(n.icon))),A("span",Uo,Z(n.title),1)]),A("div",Zo,Z(n.description),1)]))),128))])):I("",!0)]))}});const Ro=ne(Oo,[["__scopeId","data-v-f4278104"]]),Xo=P({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(a){const e=a;yt(f=>({"064bffb1":t(p),"8ade8628":t(v)}));const s=qe(),{useToken:n}=Ye,{token:i}=n(),v=i.value.colorPrimaryBorder,p=i.value.colorBgElevated,{onInit:m}=G();m(f=>{f.fitView()});const _=f=>{var l;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:f&&(l=e.initialFileCheckStatus[f])!=null?l:!1};return ke(()=>{const f=ge.subscribe("stageCreated",()=>{e.workflow.refetch()}),l=ge.subscribe("transitionCreated",()=>{e.workflow.refetch()});ht(()=>{ge.unsubscribe(f),ge.unsubscribe(l)})}),(f,l)=>f.workflow?(o(),b(t(Mt),{key:0,nodes:f.workflow.vueFlowNodes.value,edges:f.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":f.editable,"pan-on-scroll":t(We).isMac,"elements-selectable":f.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":["delete","backspace"],onDragover:t(s).onDragOver,onDragleave:t(s).onDragLeave},{"connection-line":u(g=>[c(Io,kt(_t(g)),null,16)]),"edge-task":u(g=>[c($o,ye(g,{controller:f.workflow}),null,16,["controller"])]),"node-forms":u(g=>[c(re,{stage:g.data,node:g,controller:f.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":u(g=>[c(re,{stage:g.data,node:g,controller:f.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":u(g=>[c(re,{stage:g.data,node:g,controller:f.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":u(g=>[c(re,{stage:g.data,node:g,controller:f.workflow,"initial-file-check":_(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":u(g=>[c(re,{stage:g.data,node:g,controller:f.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":u(g=>[c(re,{stage:g.data,node:g,controller:f.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:u(()=>[c(t(Vt)),f.editable&&!f.workflow.vueFlowNodes.value.length?(o(),b(Ro,{key:0,"show-drag-hint":f.showDragHint},null,8,["show-drag-hint"])):I("",!0),c(t(Ht),{pannable:"",zoomable:""}),f.editable?(o(),b(yo,{key:1,workflow:f.workflow},null,8,["workflow"])):I("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):I("",!0)}});const Yo=ne(Xo,[["__scopeId","data-v-953e32fd"]]),Wo=P({__name:"WorkflowEditor",setup(a){const e=lt(),{init:s,tearDown:n,onDragStart:i,onDrop:v,isDragging:p,isAdding:m,draggedType:_,mousePosition:f}=qe(),{result:l}=Se(async()=>await nt.init(st,!0)),g=z(null),x=async()=>{if(!l.value)return;const h=l.value.vueFlowNodes.value.map(D=>{var V,O,$,E,U;return((V=D.data)==null?void 0:V.type)==="forms"||((O=D.data)==null?void 0:O.type)==="hooks"||(($=D.data)==null?void 0:$.type)==="scripts"||((E=D.data)==null?void 0:E.type)==="jobs"?(U=D.data)==null?void 0:U.props.filename:null});g.value=await fe.checkFiles(h.filter(D=>typeof D=="string"))};he(()=>l.value,()=>{l.value&&(s(l.value),x())});const{onNodeDragStop:d,onEdgesChange:w,getSelectedElements:H,getNodes:C,addSelectedNodes:B,zoomIn:T,fitView:S,zoomOut:j,applyEdgeChanges:Q}=G();d(h=>{var D;(D=l.value)==null||D.move(h.nodes.map(V=>({id:V.id,position:V.position})))}),w(h=>{var D;for(const V of h)V.type==="remove"&&((D=l.value)==null||D.delete([V.id]));Q(h)});const ee=h=>{var D,V;e.isInputFocused||!l.value||((h.key==="z"||h.key==="Z")&&q(h)&&(Va(h)?l.value.history.redo():(D=l.value)==null||D.history.undo(),h.preventDefault()),q(h)&&(h.key==="s"||h.key==="S")&&((V=l.value)==null||V.save(),h.preventDefault()),!H.value.length&&(h.key==="f"||h.key==="F"?i(null,"forms"):h.key==="h"||h.key==="H"?i(null,"hooks"):h.key==="j"||h.key==="J"?i(null,"jobs"):h.key==="t"||h.key==="T"?i(null,"scripts"):(h.key==="a"||h.key==="A")&&q(h)?(B(C.value),h.preventDefault()):h.key==="0"&&q(h)?(S(),h.preventDefault()):(h.key==="="||h.key==="+")&&q(h)?(h.preventDefault(),T()):h.key==="-"&&q(h)&&(h.preventDefault(),j())))};return ke(()=>{window.addEventListener("keydown",ee)}),Ee(()=>{window.removeEventListener("keydown",ee),n()}),(h,D)=>t(l)?(o(),k("div",{key:0,class:De(["workflow-container",{dragging:t(m)}]),onDrop:D[0]||(D[0]=(...V)=>t(v)&&t(v)(...V))},[c(Yo,{workflow:t(l),editable:"","show-drag-hint":!t(m),"check-file-status":!0,"initial-file-check-status":g.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),c(Fa,{controller:t(l),onDragStart:t(i)},null,8,["controller","onDragStart"]),(o(!0),k(X,null,de(t(me).stages,V=>{var O,$;return o(),k("div",{key:V.key},[t(m)&&!t(p)&&V.typeName===t(_)?(o(),k("div",{key:0,class:"dragging-node",style:J({left:`${(O=t(f))==null?void 0:O.x}px`,top:`${($=t(f))==null?void 0:$.y}px`,position:"absolute",cursor:t(m)?"grabbing":"grab"})},[(o(),b(Y(V.icon),{size:18}))],4)):I("",!0)])}),128))],34)):I("",!0)}});const Fn=ne(Wo,[["__scopeId","data-v-c0a709dc"]]);export{Fn as default};
//# sourceMappingURL=WorkflowEditor.1e6d77ed.js.map

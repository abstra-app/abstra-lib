var Ns=Object.defineProperty;var Cs=(e,t,s)=>t in e?Ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var le=(e,t,s)=>(Cs(e,typeof t!="symbol"?t+"":t,s),s);import{r as xs}from"./index.e104c322.js";import{T as Ms,B as Ws,a as Nt}from"./BackButton.fe1ad1ce.js";import{p as Bs,i as Jt,y as tt,z as st,A as Gs,k as Qt,B as Fs}from"./icons.ea1ef9e9.js";import{d as Z,b,c as O,x as w,V as Ie,W as ft,e as T,O as ze,Q as Ke,q as J,p as q,r as G,K as H,R as ve,a7 as vt,N as F,z as g,F as ke,L as Te,A as Ne,D as U,v as gt,U as mt,a as Oe,$ as Hs,G as ge,t as pe,X as yt,o as qt,ad as Us,E as zs,ae as Ks,af as Vs,w as we,S as Be,ag as js,H as Zs,J as Js}from"./registerWidgets.81004098.js";import{i as Qs,w as be,l as it,v as qs,r as Xt,a as Yt,s as Pe,p as Xs,b as X,c as _,d as De,e as Ys,f as A,D as eo,g as Ct,C as to,h as xt,j as so,k as Mt,m as ot,n as Wt}from"./DashPlayer.6b0e40bf.js";import{R as oo,S as ao}from"./SmartConsole.41690e74.js";import{L as ro}from"./CircularLoading.cef8a22f.js";import{i as z,g as B,a as Ge,b as he,f as _e,w as re,c as wt,e as no,h as io,s as lo,j as co,k as uo}from"./runnerData.a1d2b4df.js";import{u as Ve}from"./log.1679837e.js";import{a as Bt}from"./asyncComputed.841de1fc.js";import{D as po}from"./dashes.b38d2459.js";import{W as ho}from"./workspaces.32af92db.js";import{S as fo}from"./SaveButton.39be38fc.js";import"./passwordlessManager.d8088db9.js";import"./WidgetsFrame.47768dce.js";import"./Modal.bc20d9b5.js";import"./Passwordless.1696a947.js";import"./forms.a8d20ba7.js";import"./utils.f91c500c.js";import"./pubsub.a0411919.js";import"./hooks.2479f4f4.js";import"./jobs.9a947645.js";const vo=e=>(ze("data-v-e0f3144d"),e=e(),Ke(),e),go={class:"dash-settings"},mo={class:"dash-property"},yo=vo(()=>w("label",{class:"property-label"},"Name",-1)),wo=Z({__name:"DashSettings",props:{dash:null},setup(e){return(t,s)=>(b(),O("div",go,[w("div",mo,[yo,Ie(w("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.dash.title=o),class:"property-input",placeholder:"Enter a name"},null,512),[[ft,e.dash.title]])]),T(oo,{runtime:e.dash},null,8,["runtime"])]))}});const _o=J(wo,[["__scopeId","data-v-e0f3144d"]]);class _t{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const So=e=>_t.isMac&&e.ctrlKey,$e=e=>_t.isMac?e.metaKey:e.ctrlKey,lt=e=>e.altKey,de=e=>e.shiftKey,at={alt:lt,"arrow-up":e=>e.code==="ArrowUp","arrow-down":e=>e.code==="ArrowDown","arrow-left":e=>e.code==="ArrowLeft","arrow-right":e=>e.code==="ArrowRight",ctrl:$e,delete:e=>_t.isMac?e.code==="Backspace":e.code==="Delete",enter:e=>e.code==="Enter",escape:e=>e.code==="Escape",shift:de,space:e=>e.code==="Space",a:e=>e.code==="KeyA",b:e=>e.code==="KeyB",c:e=>e.code==="KeyC",d:e=>e.code==="KeyD",f:e=>e.code==="KeyF",g:e=>e.code==="KeyG",h:e=>e.code==="KeyH",k:e=>e.code==="KeyK",p:e=>e.code==="KeyP",v:e=>e.code==="KeyV",x:e=>e.code==="KeyX",z:e=>e.code==="KeyZ",0:e=>e.code==="Digit0","[":e=>e.code==="BracketLeft","]":e=>e.code==="BracketRight"};class Eo{constructor(t){le(this,"pressedKeys");le(this,"evt");this.evt=t,this.pressedKeys={};const s=o=>a=>{Object.keys(at).forEach(n=>{at[n](a)&&this.setPressed(n,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(t,s){this.pressedKeys[t]=s}isPressed(t){var s;return this.evt?at[t](this.evt):(s=this.pressedKeys[t])!=null?s:!1}}const bo=new Eo;/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Po=globalThis&&globalThis.__extends||function(){var e=function(t,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var n in a)a.hasOwnProperty(n)&&(o[n]=a[n])},e(t,s)};return function(t,s){e(t,s);function o(){this.constructor=t}t.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}(),Io=Object.prototype.hasOwnProperty;function ct(e,t){return Io.call(e,t)}function ut(e){if(Array.isArray(e)){for(var t=new Array(e.length),s=0;s<t.length;s++)t[s]=""+s;return t}if(Object.keys)return Object.keys(e);var o=[];for(var a in e)ct(e,a)&&o.push(a);return o}function K(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function dt(e){for(var t=0,s=e.length,o;t<s;){if(o=e.charCodeAt(t),o>=48&&o<=57){t++;continue}return!1}return!0}function fe(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function es(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function pt(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,s=e.length;t<s;t++)if(pt(e[t]))return!0}else if(typeof e=="object"){for(var o=ut(e),a=o.length,n=0;n<a;n++)if(pt(e[o[n]]))return!0}}return!1}function Gt(e,t){var s=[e];for(var o in t){var a=typeof t[o]=="object"?JSON.stringify(t[o],null,2):t[o];typeof a<"u"&&s.push(o+": "+a)}return s.join(`
`)}var ts=function(e){Po(t,e);function t(s,o,a,n,i){var c=this.constructor,h=e.call(this,Gt(s,{name:o,index:a,operation:n,tree:i}))||this;return h.name=o,h.index=a,h.operation=n,h.tree=i,Object.setPrototypeOf(h,c.prototype),h.message=Gt(s,{name:o,index:a,operation:n,tree:i}),h}return t}(Error),C=ts,Oo=K,Se={add:function(e,t,s){return e[t]=this.value,{newDocument:s}},remove:function(e,t,s){var o=e[t];return delete e[t],{newDocument:s,removed:o}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:function(e,t,s){var o=Fe(s,this.path);o&&(o=K(o));var a=me(s,{op:"remove",path:this.from}).removed;return me(s,{op:"add",path:this.path,value:a}),{newDocument:s,removed:o}},copy:function(e,t,s){var o=Fe(s,this.from);return me(s,{op:"add",path:this.path,value:K(o)}),{newDocument:s}},test:function(e,t,s){return{newDocument:s,test:Ce(e[t],this.value)}},_get:function(e,t,s){return this.value=e[t],{newDocument:s}}},Ao={add:function(e,t,s){return dt(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:s,index:t}},remove:function(e,t,s){var o=e.splice(t,1);return{newDocument:s,removed:o[0]}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:Se.move,copy:Se.copy,test:Se.test,_get:Se._get};function Fe(e,t){if(t=="")return e;var s={op:"_get",path:t};return me(e,s),s.value}function me(e,t,s,o,a,n){if(s===void 0&&(s=!1),o===void 0&&(o=!0),a===void 0&&(a=!0),n===void 0&&(n=0),s&&(typeof s=="function"?s(t,0,e,t.path):He(t,0)),t.path===""){var i={newDocument:e};if(t.op==="add")return i.newDocument=t.value,i;if(t.op==="replace")return i.newDocument=t.value,i.removed=e,i;if(t.op==="move"||t.op==="copy")return i.newDocument=Fe(e,t.from),t.op==="move"&&(i.removed=e),i;if(t.op==="test"){if(i.test=Ce(e,t.value),i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument=e,i}else{if(t.op==="remove")return i.removed=e,i.newDocument=null,i;if(t.op==="_get")return t.value=e,i;if(s)throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e);return i}}else{o||(e=K(e));var c=t.path||"",h=c.split("/"),l=e,v=1,f=h.length,p=void 0,d=void 0,S=void 0;for(typeof s=="function"?S=s:S=He;;){if(d=h[v],d&&d.indexOf("~")!=-1&&(d=es(d)),a&&(d=="__proto__"||d=="prototype"&&v>0&&h[v-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(s&&p===void 0&&(l[d]===void 0?p=h.slice(0,v).join("/"):v==f-1&&(p=t.path),p!==void 0&&S(t,0,e,p)),v++,Array.isArray(l)){if(d==="-")d=l.length;else{if(s&&!dt(d))throw new C("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);dt(d)&&(d=~~d)}if(v>=f){if(s&&t.op==="add"&&d>l.length)throw new C("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);var i=Ao[t.op].call(t,l,d,e);if(i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}}else if(v>=f){var i=Se[t.op].call(t,l,d,e);if(i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}if(l=l[d],s&&v<f&&(!l||typeof l!="object"))throw new C("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function M(e,t,s,o,a){if(o===void 0&&(o=!0),a===void 0&&(a=!0),s&&!Array.isArray(t))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=K(e));for(var n=new Array(t.length),i=0,c=t.length;i<c;i++)n[i]=me(e,t[i],s,!0,a,i),e=n[i].newDocument;return n.newDocument=e,n}function Lo(e,t,s){var o=me(e,t);if(o.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument}function He(e,t,s,o){if(typeof e!="object"||e===null||Array.isArray(e))throw new C("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,s);if(Se[e.op]){if(typeof e.path!="string")throw new C("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,s);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new C('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,s);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new C("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&pt(e.value))throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,s);if(s){if(e.op=="add"){var a=e.path.split("/").length,n=o.split("/").length;if(a!==n+1&&a!==n)throw new C("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,s)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==o)throw new C("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,s)}else if(e.op==="move"||e.op==="copy"){var i={op:"_get",path:e.from,value:void 0},c=ss([i],s);if(c&&c.name==="OPERATION_PATH_UNRESOLVABLE")throw new C("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,s)}}}else throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,s)}function ss(e,t,s){try{if(!Array.isArray(e))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)M(K(t),K(e),s||!0);else{s=s||He;for(var o=0;o<e.length;o++)s(e[o],o,t,void 0)}}catch(a){if(a instanceof C)return a;throw a}}function Ce(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var s=Array.isArray(e),o=Array.isArray(t),a,n,i;if(s&&o){if(n=e.length,n!=t.length)return!1;for(a=n;a--!==0;)if(!Ce(e[a],t[a]))return!1;return!0}if(s!=o)return!1;var c=Object.keys(e);if(n=c.length,n!==Object.keys(t).length)return!1;for(a=n;a--!==0;)if(!t.hasOwnProperty(c[a]))return!1;for(a=n;a--!==0;)if(i=c[a],!Ce(e[i],t[i]))return!1;return!0}return e!==e&&t!==t}const Ro=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:C,deepClone:Oo,getValueByPointer:Fe,applyOperation:me,applyPatch:M,applyReducer:Lo,validator:He,validate:ss,_areEquals:Ce},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var St=new WeakMap,Do=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),$o=function(){function e(t,s){this.callback=t,this.observer=s}return e}();function ko(e){return St.get(e)}function To(e,t){return e.observers.get(t)}function No(e,t){e.observers.delete(t.callback)}function Co(e,t){t.unobserve()}function xo(e,t){var s=[],o,a=ko(e);if(!a)a=new Do(e),St.set(e,a);else{var n=To(a,t);o=n&&n.observer}if(o)return o;if(o={},a.value=K(e),t){o.callback=t,o.next=null;var i=function(){ht(o)},c=function(){clearTimeout(o.next),o.next=setTimeout(i)};typeof window<"u"&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return o.patches=s,o.object=e,o.unobserve=function(){ht(o),clearTimeout(o.next),No(a,o),typeof window<"u"&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new $o(t,o)),o}function ht(e,t){t===void 0&&(t=!1);var s=St.get(e.object);Et(s.value,e.object,e.patches,"",t),e.patches.length&&M(s.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function Et(e,t,s,o,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var n=ut(t),i=ut(e),c=!1,h=i.length-1;h>=0;h--){var l=i[h],v=e[l];if(ct(t,l)&&!(t[l]===void 0&&v!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof v=="object"&&v!=null&&typeof f=="object"&&f!=null&&Array.isArray(v)===Array.isArray(f)?Et(v,f,s,o+"/"+fe(l),a):v!==f&&(a&&s.push({op:"test",path:o+"/"+fe(l),value:K(v)}),s.push({op:"replace",path:o+"/"+fe(l),value:K(f)}))}else Array.isArray(e)===Array.isArray(t)?(a&&s.push({op:"test",path:o+"/"+fe(l),value:K(v)}),s.push({op:"remove",path:o+"/"+fe(l)}),c=!0):(a&&s.push({op:"test",path:o,value:e}),s.push({op:"replace",path:o,value:t}))}if(!(!c&&n.length==i.length))for(var h=0;h<n.length;h++){var l=n[h];!ct(e,l)&&t[l]!==void 0&&s.push({op:"add",path:o+"/"+fe(l),value:K(t[l])})}}}function Mo(e,t,s){s===void 0&&(s=!1);var o=[];return Et(e,t,o,"",s),o}const Wo=Object.freeze(Object.defineProperty({__proto__:null,unobserve:Co,observe:xo,generate:ht,compare:Mo},Symbol.toStringTag,{value:"Module"}));Object.assign({},Ro,Wo,{JsonPatchError:ts,deepClone:K,escapePathComponent:fe,unescapePathComponent:es});function bt(e,t,s){const{selectedWidgets:o,grid:a}=e,n=[...o,...s||[]],i=Math.min(...n.map(f=>{var p,d;return(d=(p=he(f,t))==null?void 0:p.colStart)!=null?d:null}).filter(f=>f!==null)),c=Math.max(...n.map(f=>{var p,d;return(d=(p=he(f,t))==null?void 0:p.colEnd)!=null?d:null}).filter(f=>f!==null)),h=Math.min(...n.map(f=>{var p,d;return(d=(p=he(f,t))==null?void 0:p.rowStart)!=null?d:null}).filter(f=>f!==null)),l=c>a.columns-1?a.columns-1-c:i<0?-i:0,v=h<0?-h:0;return n.flatMap(f=>{const p=he(f,t);if(l===0&&v===0)return[];if(!p||!z(p))return[];const d=ee(Y(f,B(t)),t);return[{op:"replace",path:`${d}/${f}/colStart`,backup:p,value:p.colStart+l},{op:"replace",path:`${d}/${f}/colEnd`,backup:p,value:p.colEnd+l},{op:"replace",path:`${d}/${f}/rowStart`,backup:p,value:p.rowStart+v},{op:"replace",path:`${d}/${f}/rowEnd`,backup:p,value:p.rowEnd+v}]})}const Y=(e,t,s=null)=>{for(const o in t){const a=t[o];if(z(a)){if(o==e)return s}else{const n=Y(e,a.slot,o);if(n)return n}}return null},Bo=(e,t)=>e.rowStart>=t.row&&e.rowStart<t.row+t.height,os=(e,t)=>{var s;return(s=Object.keys(t.slottables).find(o=>Bo(e,t.slottables[o].position)))!=null?s:null},Ft=(e,t)=>{const s=B(t),o=(n,i,c)=>{for(const h in i){if(h==n)return c;const l=i[h];if(z(l))continue;const v=o(n,l.slot,`${c}/${h}/slot`);if(v)return v}return null},a=o(e,s,Ge(t));if(!a)throw new Error("Widget not found in layout");return a},ee=(e,t)=>e?`${Ge(t)}/${e}/slot`:Ge(t),Ue=(e,t,s)=>{if(s){const a=t.slottables[s];return{...e,rowStart:e.rowStart-a.position.row,rowEnd:e.rowEnd-a.position.row}}const o=Object.values(t.slottables).reduce((a,n)=>a+(n.position.row<e.rowStart?n.position.height:0),0);return{...e,rowStart:e.rowStart-o,rowEnd:e.rowEnd-o}};function Go(e){const{grid:t,mouseState:s,workingLayout:o,calculatedPositions:a}=e;if(s.state!=="MOVING_SLOTTABLE")return[];const n=t.cellAt(s.mousePos.x,s.mousePos.y),i=[],c=s.slottableId,h=o.getSlottable(c);if(!h)throw new Error("Slottable not found");const l=ns(rs(n,h.height),a,c);return i.push({op:"replace",path:`/slot/${c}/row`,backup:h.row,value:l.row}),i.push({op:"replace",path:`/slot/${c}/order`,backup:h.order,value:l.order}),i}function Fo(e,t){const{grid:s,mouseState:o,selectedWidgets:a,calculatedPositions:n,workingLayout:i}=e;if(o.state!=="MOVING")return[];const c=s.cellAt(o.initialMousePos.x,o.initialMousePos.y),h=s.cellAt(o.mousePos.x,o.mousePos.y),l={deltaI:h.i-c.i,deltaJ:h.j-c.j},v=[];for(const f of a){const p=n.widgets[f],d={colStart:p.position.colStart+l.deltaI,colEnd:p.position.colEnd+l.deltaI,rowStart:p.position.rowStart+l.deltaJ,rowEnd:p.position.rowEnd+l.deltaJ},S=ee(Y(f,B(i.layout)),i.layout),I=os(d,n),k=ee(I,i.layout),R=_e(f,B(t));!R||!z(R)||(S===k?v.push({op:"replace",path:`${S}/${f}`,backup:R,value:{...R,...Ue(d,n,I)}}):(v.push({op:"remove",path:`${S}/${f}`,backup:R}),v.push({op:"add",path:`${k}/${f}`,value:{...R,...Ue(d,n,I)}})))}return v}function Ho(e,t,s,o){const a=[];for(const n of e.selectedWidgets){const i=ee(Y(n,B(o)),o),c=he(n,o);!z(c)||(a.push({op:"replace",path:`${i}/${n}/colStart`,backup:c,value:c.colStart+t}),a.push({op:"replace",path:`${i}/${n}/colEnd`,backup:c,value:c.colEnd+t}),a.push({op:"replace",path:`${i}/${n}/rowStart`,backup:c,value:c.rowStart+s}),a.push({op:"replace",path:`${i}/${n}/rowEnd`,backup:c,value:c.rowEnd+s}))}return a}function as(e,t,s,o){const{camera:a,mouseState:n,grid:i}=e;if(!a)throw new Error("No camera value yet");if(n.state!=="RESIZING"&&n.state!=="SLOTTABLE_RESIZING")return null;const c=n.side,h=a.screenPoint2world(n.mousePos),l=c==="bottom"||c==="right"?"bottom-right":"top-left",v=i.snap(h,l),f=c.includes("left")?v.x:t.x,p=c.includes("top")?v.y:t.y,d=c.includes("right")?v.x:t.x+t.width,S=c.includes("bottom")?v.y:t.y+t.height,I=Math.abs(d-f),k=Math.abs(S-p);let R={x:Math.min(f,d),y:Math.min(p,S),width:I,height:k,referential:v.referential};return I<s&&(R={...R,width:s}),k<o&&(R={...R,height:o}),R}const Uo=({selectedWidgets:e,grid:t,calculatedPositions:s})=>Xt(Object.entries(s.widgets).filter(([o])=>e.has(o)).map(([o,a])=>be(s.widgets[o].position,t)).filter(o=>o!==null));function zo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="SLOTTABLE_RESIZING")return[];const a=o.slottables[t.slottableId],n={colStart:0,rowStart:a.position.row,colEnd:s.columns,rowEnd:a.position.row+a.position.height},i=s.rectFromArea(n);if(!i)return[];const c=as(e,i,s.width,s.cellHeight);if(!c)return[];const h=s.areaFromRect(c);return[{op:"replace",path:`/slot/${t.slottableId}/height`,backup:a.position.height,value:h.rowEnd-h.rowStart+1}]}function Ko(e){const{mouseState:t,selectedWidgets:s,grid:o,workingLayout:a,calculatedPositions:n}=e;if(t.state!=="RESIZING")return[];const i=t.side,c=Uo(e);if(!c)return[];const h=Array.from(s).filter(f=>{const p=n.widgets[f];return Qs(be(p.position,o),c,i)}),{minWidth:l,minHeight:v}=re[t.type].dashProperties;return h.flatMap(f=>{const p=n.widgets[f],d=be(p.position,o),S=as(e,d,l,v);if(!S)return[];const I=Y(f,B(a.layout)),k=ee(I,a.layout),R=o.areaFromRect(d),ne=Ue(o.areaFromRect(S),n,I);return[{op:"replace",path:`${k}/${f}/colStart`,backup:R.colStart,value:Math.max(ne.colStart,0)},{op:"replace",path:`${k}/${f}/colEnd`,backup:R.colEnd,value:Math.min(ne.colEnd,it.columns-1)},{op:"replace",path:`${k}/${f}/rowStart`,backup:R.rowStart,value:Math.max(ne.rowStart,0)},{op:"replace",path:`${k}/${f}/rowEnd`,backup:R.rowEnd,value:ne.rowEnd}]})}function Vo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING")return{operations:[]};const a=Object.values(re[t.type].pythonAPI.params).reduce((d,S)=>(S.isKwarg||!S.dashesInitialValue||(d[S.argName]=S.dashesInitialValue),d),{}),{initialWidth:n,initialHeight:i}=re[t.type].dashProperties,c=s.areaFromRect({x:t.x,y:t.y,width:n,height:i,referential:"world"}),h=os(c,o),l=ee(h,e.workingLayout.layout),v=Ve(),f={id:v,type:t.type,props:{...a},...Ue(c,o,h),events:{}};return{operations:[{op:"add",path:`${l}/${v}`,value:f}],widgetId:v}}const rs=({j:e},t)=>({row:e,height:t,order:0}),jo=(e,t)=>Object.keys(e).reduce((s,o)=>(o===t||(s[o]=e[o]),s),{}),ns=(e,t,s)=>{const o=s?{...t,slottables:jo(t.slottables,s)}:t,a=Math.max(Object.values(o.slottables).reduce((i,c)=>c.position.row>=e.row?i:c.position.row+c.position.height<=e.row?i-c.position.height:i-(e.row-c.position.row),e.row),0),n=Zo(e,o);return{...e,row:a,order:n}},Ht=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).find(o=>e.row>=o.position.row+o.position.height/2&&e.row<=o.position.row+o.position.height),Ut=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).filter(o=>o.position.row+o.position.height/2>e.row&&o.position.row<=e.row+e.height).reduce((o,a)=>!o||a.position.order<o.position.order?a:o,null),Zo=(e,t)=>{var v,f;const s=Ht(e,t),o=Ut(e,t),a=s?Ut(s.position,t,s.id):null,n=o?Ht(o.position,t,o.id):null,i=[s,n].reduce((p,d)=>p?d&&p.position.order>d.position.order?d:p:d,null),c=[o,a].reduce((p,d)=>p?d&&p.position.order<d.position.order?d:p:d,null);if(!i&&!c)return 0;const h=(v=i==null?void 0:i.position.order)!=null?v:c.position.order-2,l=(f=c==null?void 0:c.position.order)!=null?f:i.position.order+2;return(h+l)/2};function Jo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING_SLOTTABLE")return{operations:[]};const a=s.cellAt(t.x,t.y),n=Ve(),i={id:n,type:t.type,props:{condition:"True"},slot:{},...ns(rs(a,1),o)};return{operations:[{op:"add",path:`/slot/${n}`,value:i}],widgetId:n}}function Qo(e,t){const{mouseState:s,selectedWidgets:o}=e;if(s.state!=="MOVING"||!s.duplicating)return[];const a=[];for(const n of o){const i=ee(Y(n,B(t)),t),c=he(n,t);if(!c)continue;const h=Ve();a.push({op:"add",path:`${i}/${h}`,value:{...q.exports.cloneDeep(c),id:h}})}return a}function is(e,t,s){const o=e.selectedWidgets,a=o.keys().next().value,n=Y(a,B(t)),i=n?wt(n,t).slot:B(t),h=Object.keys(i).filter(f=>!o.has(f)&&!(s!=null&&s.some(p=>f==p))&&z(i[f])).sort((f,p)=>qs(_e(f,B(t)),_e(p,B(t)))),l=[...o,...s||[]].map(f=>_e(f,B(t))).filter(f=>f!=null),v=[];return h.forEach(f=>{const p=_e(f,B(t));if(!p||!z(p))return;let d=0,S={...p};const I=()=>l.some(k=>Yt(S,k));for(;I();)d++,S={...p,rowStart:p.rowStart+d,rowEnd:p.rowEnd+d};if(d){const k=ee(n,t);v.push({op:"replace",path:`${k}/${f}/rowStart`,backup:p.rowStart,value:p.rowStart+d}),v.push({op:"replace",path:`${k}/${f}/rowEnd`,backup:p.rowEnd,value:p.rowEnd+d})}l.push(S)}),v}function qo(e,t,s,o){const a=e.selectedWidgets;if(!a.size)return[];const n=[...a],i=[];return n.some(h=>{const l=Y(h,B(o)),v=l?wt(l,o).slot:B(o),f=Object.keys(v).filter(d=>!a.has(d)&&z(v[d])),p=he(h,o);return f.some(d=>Yt(p,v[d]))})&&a.forEach(h=>{const l=_e(h,B(o)),v=ee(Y(h,B(o)),o);!l||!z(l)||(i.push({op:"replace",path:`${v}/${h}/rowStart`,backup:l.rowStart,value:l.rowStart-s}),i.push({op:"replace",path:`${v}/${h}/rowEnd`,backup:l.rowEnd,value:l.rowEnd-s}),i.push({op:"replace",path:`${v}/${h}/colStart`,backup:l.colStart,value:l.colStart-t}),i.push({op:"replace",path:`${v}/${h}/colEnd`,backup:l.colEnd,value:l.colEnd-t}))}),i}function Xo(e,t){const s=[],o=[];for(const a of t){const n=Ve();s.push({op:"add",path:`/slot/${n}`,value:{...q.exports.cloneDeep(a),id:n}}),o.push(n)}return{operations:s,widgetsId:o}}function Yo(e){const t=K(e.workingLayout.layout),s=Qo(e,t);M(t,s);const o=Go(e);M(t,o);const a=Fo(e,t);M(t,a);const n=Ko(e);M(t,n);const i=zo(e);M(t,i);const c=Vo(e);M(t,c.operations);const h=Jo(e);M(t,h.operations);const l=bt(e,t,c.widgetId?[c.widgetId]:[]);M(t,l);const v=is(e,t,c.widgetId?[c.widgetId]:[]);return M(t,v),{layout:t,operations:[...s,...a,...o,...n,...i,...c.operations,...l,...v,...h.operations]}}function ea(e,t,s){const o=e.workingLayout.layout,a=Ho(e,t,s,o);M(o,a);const n=qo(e,t,s,o);M(o,n);const i=bt(e,o);return M(o,i),[...a,...n,...i]}function ta(e,t){const s=e.workingLayout.layout,o=Xo(e,t);M(s,o.operations);const a=bt(e,s,o.widgetsId);M(s,a);const n=is(e,s,o.widgetsId);return M(s,n),[...o.operations,...a,...n]}const sa={class:"zoom-bar"},oa={class:"zoom-value"},aa=Z({__name:"ZoomBar",props:{camera:null},emits:["hover","leave"],setup(e,{emit:t}){const s=e,o=G(!1),a=G(null),n=()=>{var l;(l=s.camera)==null||l.zoomIn(1.1,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},i=()=>{var l;(l=s.camera)==null||l.zoomIn(.9,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},c=H(()=>{var h,l;return`${Math.floor(((l=(h=s.camera)==null?void 0:h.zoom)!=null?l:1)*100)}%`});return ve(()=>{var h;return(h=s.camera)==null?void 0:h.zoom},()=>{clearTimeout(a.value),o.value=!0,a.value=setTimeout(()=>o.value=!1,3e3)}),(h,l)=>Ie((b(),O("div",{class:"zoom-bar-wrapper",onMouseover:l[0]||(l[0]=v=>t("hover")),onMouseleave:l[1]||(l[1]=v=>t("leave"))},[w("div",sa,[w("span",{class:"zoom-control",onClick:i},"-"),w("span",oa,F(g(c)),1),w("span",{class:"zoom-control",onClick:n},"+")])],544)),[[vt,e.camera&&o.value]])}});const ra=J(aa,[["__scopeId","data-v-f937a967"]]),na=()=>window.location.href.startsWith("vscode-webview://"),ia=(e,t)=>{!na()||window.vscode.postMessage({type:"usage-event",event:{type:e,payload:t}})},la=async({operations:e,name:t})=>{ia("widgets_updated",{checkpoint:t,operations:K(e)})};class Pt{constructor(t,s){le(this,"checkpointHistory",{undos:[],redos:[]});le(this,"_save",null);this.workingLayout=t,this.appState=s}static create(t,s){return new Pt(t,s)}setWorkingLayout(t){this.workingLayout=t}undo(){if(this.appState.isPreview||!this.checkpointHistory.undos.length)return;const t=this.checkpointHistory.undos.pop();if(t)return M(this.workingLayout,t.operations),this.checkpointHistory.redos.push(rt(t)),t}redo(){if(this.appState.isPreview)return;const t=this.checkpointHistory.redos.pop();if(t)return M(this.workingLayout,t.operations),this.checkpointHistory.undos.push(rt(t)),t}execute(t){this.appState.isPreview||(M(this.workingLayout,t.operations),this.checkpointHistory.undos.push(rt(t)),this.checkpointHistory.redos=[],this.save(),la(t))}onSave(t){this._save=t}save(){var t;this.appState.isPreview||(t=this._save)==null||t.call(this)}}const rt=e=>({selection:e.selection,name:`RE: ${e.name}`,operations:e.operations.slice().reverse().map(t=>ca(t))}),ca=e=>{switch(e.op){case"add":return{op:"remove",backup:e.value,path:e.path};case"remove":return{op:"add",path:e.path,value:e.backup};case"replace":return{op:"replace",backup:e.value,path:e.path,value:e.backup}}};class It{constructor(t,s){le(this,"operationQueue");this.layout=t,this.operationQueue=Pt.create(t,s)}getRootSlot(){return B(this.layout)}getRootSlotPath(){return Ge(this.layout)}setLayout(t){this.operationQueue.setWorkingLayout(t)}static create(t,s){return new It(t,s)}getWidget(t){return he(t,this.layout)}getWidgetOrSlottable(t){const s=no(t,this.layout);if(!s)throw new Error(`Could not find widget or slottable with id ${t}`);return s}get widgets(){return this.getRootSlot()}get allWidgets(){const t=s=>Object.entries(s).reduce((o,[a,n])=>z(n)?{...o,[a]:n}:{...o,...t(n.slot)},{});return t(this.widgets)}getSlottable(t){return wt(t,this.layout)}redo(){let t=this.operationQueue.redo();for(;t&&t.operations.length===0;)t=this.operationQueue.redo();return this.operationQueue.save(),t}undo(){let t=this.operationQueue.undo();for(;t&&t.operations.length===0;)t=this.operationQueue.undo();return this.operationQueue.save(),t}updateVariable(t,s){const o=this.getWidget(s);if(!z(o))return;const a=ee(Y(s,this.getRootSlot()),this.layout);this.operationQueue.execute({name:"update variable",selection:new Set([s]),operations:[{op:"replace",backup:o.variable,value:t,path:`${a}/${s}/variable`}]})}updateProp({param:t,value:s},o){const a=i=>this.getWidgetOrSlottable(i).props,n=(i,c,h)=>{const l=Ft(i,this.layout);return[{op:"replace",backup:a(i)[c],value:h,path:`${l}/${i}/props/${c}`}]};this.operationQueue.execute({name:"update props",operations:o.flatMap(i=>n(i,t.argName,s)),selection:new Set(o)})}updateEvent({event:t,value:s},o){const a=i=>this.getWidget(i).events,n=(i,c,h)=>{const l=ee(Y(i,this.getRootSlot()),this.layout);return[{op:"replace",backup:a(i)[c],value:h,path:`${l}/${i}/events/${c}`}]};this.operationQueue.execute({name:"update events",operations:o.flatMap(i=>n(i,t.key,s)),selection:new Set(o)})}delete(t){this.operationQueue.execute({name:"widgets deleted",operations:t.map(s=>{const o=Ft(s,this.layout);return{op:"remove",backup:this.getWidgetOrSlottable(s),path:`${o}/${s}`}}),selection:new Set(t)})}onSave(t){this.operationQueue.onSave(t)}updateVersion(){this.layout.version!=="0.2"&&this.operationQueue.execute({name:"Version updated",operations:[{op:"replace",backup:this.layout.version,value:"0.2",path:"/version"},{op:"add",value:this.layout.widgets,path:"/slot"},{op:"remove",path:"/widgets",backup:this.layout.widgets}],selection:new Set})}}const zt={PandasDataFrame:"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html",PlotlyFigure:"https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html","datetime.time":"https://docs.python.org/3/library/datetime.html#datetime.time","datetime.date":"https://docs.python.org/3/library/datetime.html#datetime.date","io.IOBase":"https://docs.python.org/3/library/io.html#io.IOBase","time.struct_time":"https://docs.python.org/3/library/time.html#time.struct_time"},ua="#E286A3",da="#EF9542",pa="#B462DB",ha="#40B6D3",fa="#6FB96E",va=[ua,da,pa,ha,fa];function Kt(e){let t=e;return Object.keys(zt).forEach(s=>{if(e.includes(s)){const o=zt[s];t=t.replace(s,`<a href="${o}" target="_blank">${s}</a>`)}}),t}const Ee={},ga=e=>t=>{if(Ee[t])return Ee[t];const s=Object.keys(Ee).length%e.length;return Ee[t]=e[s],e[s]},Vt=ga([...va]),ma=()=>{Object.keys(Ee).forEach(e=>delete Ee[e])};class ya{constructor(){le(this,"globalEventListeners",[])}addGlobalEventListener(t,s){addEventListener(t,s),this.globalEventListeners.find(o=>o.evt===t)||this.globalEventListeners.push({evt:t,handler:s})}removeGlobalEventListeners(){this.globalEventListeners.forEach(({evt:t,handler:s})=>{removeEventListener(t,s)}),this.globalEventListeners=[]}}const wa={class:"param-types"},_a=["innerHTML"],Sa={key:1,class:"prop-type"},Ea=["innerHTML"],ba=Z({__name:"ParamTypes",props:{param:null},setup(e){return(t,s)=>(b(),O("div",wa,[e.param&&e.param.typeDescription?(b(!0),O(ke,{key:0},Te(e.param.typeDescription,o=>(b(),O("div",{key:o,class:"prop-type"},[w("p",{class:"type",style:Ne({color:g(Vt)(o)}),innerHTML:g(Kt)(o)},null,12,_a)]))),128)):e.param&&e.param.typeName?(b(),O("div",Sa,[w("p",{class:"type",style:Ne({color:g(Vt)(e.param.typeName)}),innerHTML:g(Kt)(e.param.typeName)},null,12,Ea)])):U("",!0)]))}});const jt=J(ba,[["__scopeId","data-v-d6aed39d"]]),Pa=["value","placeholder"],Ia=["value","placeholder"],Oa=Z({__name:"PythonPropInputRaw",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input","change","clearSuggestions"],setup(e,{emit:t}){const s=e,o=gt({isActive:!1,hasChanges:!1}),a=h=>{t("input",h),o.hasChanges=!0},n=()=>{o.isActive=!1,t("clearSuggestions")},i=h=>{h.preventDefault();const l=h.target,v=l.selectionStart,f=l.selectionEnd,p=l.value;l.value=p.substring(0,v)+"	"+p.substring(f),l.selectionStart=l.selectionEnd=v+1,l.dispatchEvent(new Event("input"))},c=h=>{s.commit(h),o.hasChanges=!1};return mt(()=>{o.hasChanges&&s.commit(s.value)}),(h,l)=>{var f,p;const v=Oe("icon");return b(),O("div",{class:ge(["input-container",{error:e.hasError}])},[T(v,{path:g(Bs),class:"icon",fill:e.hasError?"#D35249":o.isActive?"#3482E5":void 0},null,8,["path","fill"]),e.isCode?(b(),O("textarea",{key:0,value:e.value,class:"prop-input",placeholder:(f=e.placeholder)!=null?f:void 0,onInput:l[0]||(l[0]=d=>a(d.target.value)),onClick:l[1]||(l[1]=d=>o.isActive=!0),onBlur:n,onKeydown:l[2]||(l[2]=Hs(d=>i(d),["tab"])),onChange:l[3]||(l[3]=d=>c(d.target.value))},null,40,Pa)):(b(),O("input",{key:1,value:e.value,class:"prop-input",placeholder:(p=e.placeholder)!=null?p:void 0,onInput:l[4]||(l[4]=d=>a(d.target.value)),onClick:l[5]||(l[5]=d=>o.isActive=!0),onBlur:n,onChange:l[6]||(l[6]=d=>c(d.target.value))},null,40,Ia))],2)}}});const Aa=J(Oa,[["__scopeId","data-v-1159e0c0"]]),La={class:"suggestions"},Ra=["onMousedown"],Da=Z({__name:"PythonAutoCompleteSuggestions",props:{suggestions:null},emits:["select"],setup(e,{emit:t}){return(s,o)=>Ie((b(),O("div",La,[(b(!0),O(ke,null,Te(e.suggestions,a=>(b(),O("div",{key:a,class:"suggestion",onMousedown:n=>t("select",a)},F(a),41,Ra))),128))],512)),[[vt,e.suggestions.length]])}});const $a=J(Da,[["__scopeId","data-v-afec000d"]]),ka={class:"python-wrapper"},Ta=Z({__name:"PythonPropInput",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,dashPlayerState:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input"],setup(e,{emit:t}){const s=e,o=H(()=>s.dashPlayerState.suggestionsFor),a=H(()=>s.dashPlayerState.suggestions),n=l=>{c(s.paramName,l),t("input",l)},i=l=>{h(),t("input",l),s.commit(l)},c=async(l,v)=>{!v||s.dashPlayerState.getAutocompleteSuggestions(l,v)},h=async()=>{await yt(),s.dashPlayerState.clearSuggestions()};return(l,v)=>(b(),O("div",ka,[T(Aa,{value:e.value,commit:e.commit,"is-code":e.isCode,"param-name":e.paramName,"dash-player-state":e.dashPlayerState,onInput:n,onClearSuggestions:h},null,8,["value","commit","is-code","param-name","dash-player-state"]),g(o)===e.paramName?(b(),pe($a,{key:0,suggestions:g(a),onSelect:i},null,8,["suggestions"])):U("",!0)]))}});const nt=J(Ta,[["__scopeId","data-v-5e99cdec"]]),te=e=>(ze("data-v-772fa7a8"),e=e(),Ke(),e),Na={class:"wrapper"},Ca={class:"title"},xa={key:0,class:"widget-prop"},Ma=te(()=>w("h2",null,"Error",-1)),Wa=te(()=>w("p",{class:"section-description"}," Some errors were found while computing the widget. ",-1)),Ba=["textContent"],Ga={key:1,class:"section"},Fa=te(()=>w("h2",null,"VARIABLE",-1)),Ha={key:0,class:"section-content"},Ua={class:"widget-prop"},za=te(()=>w("p",{class:"prop-label"},"Bind a variable",-1)),Ka=te(()=>w("p",{class:"prop-description"}," Create a variable to be controlled by this widget. ",-1)),Va={class:"input-container"},ja={key:0,class:"variable-error prop-error"},Za=te(()=>w("pre",null,"Variable not defined",-1)),Ja={key:1,class:"prop-error",textContent:"SyntaxError: This field must be a variable name"},Qa=["textContent"],qa={key:2,class:"section"},Xa=te(()=>w("h2",null,"EVENTS",-1)),Ya={key:0,class:"section-content"},er=te(()=>w("p",{class:"section-description"}," Each event is a Python code that runs on specified situations ",-1)),tr={class:"prop-label"},sr={class:"prop-description"},or={class:"section"},ar=te(()=>w("h2",null,"PROPERTIES",-1)),rr={key:0,class:"section-content"},nr=te(()=>w("p",{class:"section-description"}," Each property is a Python expression, make sure to use the correct syntax. ",-1)),ir={class:"prop-label"},lr={class:"prop-description"},cr=["textContent"],ur=te(()=>w("div",{class:"feedback"},null,-1)),dr=[ur],pr=Z({__name:"WidgetEditor",props:{selectedWidgetErrors:null,layoutModel:null,selectedWidgets:null,dashPlayerState:null},emits:["close","create-variable"],setup(e,{emit:t}){const s=e,o=G(null);ve(()=>s.selectedWidgetErrors,()=>{o.value=null});const a=E=>{I.openedSections.includes(E)?I.openedSections=I.openedSections.filter(P=>P!==E):I.openedSections.push(E)},n=E=>I.openedSections.includes(E),i=E=>z(E)?re[E.type].name:Pe[E.type].name,c=H(()=>o.value===null?s.selectedWidgetErrors:o.value==="variable"?q.exports.omit(s.selectedWidgetErrors,"variable"):{...s.selectedWidgetErrors,props:q.exports.omit(s.selectedWidgetErrors.props,o.value)}),h=H(()=>l.value.type.includes("-input")&&l.value.type!=="click-input"),l=H(()=>s.selectedWidgets[0]),v=H(()=>{var L;if(!z(l.value))return;const P=((L=re[l.value.type].pythonAPI.params)!=null?L:[]).find(N=>N.argName==="initial_value");return P||null});function f(E){this.style.height="0",this.style.height=this.scrollHeight-24+"px"}const p=new ya,d=G(null),S=402,I=gt({isActive:!1,resizing:!1,width:S,openedSections:["properties","variable"]});qt(()=>{d.value&&(p.addGlobalEventListener("mouseup",()=>I.resizing=!1),p.addGlobalEventListener("mousemove",L=>k(L))),document.querySelectorAll(".widget-props-editor textarea").forEach(L=>{!L||(L.setAttribute("style","height:"+(L.scrollHeight-24)+"px;overflow-y:hidden;"),L.addEventListener("input",f,!1))})}),Us(()=>{ma(),p.removeGlobalEventListeners()});const k=E=>{I.resizing&&(I.width=Math.max(I.width-E.movementX,S))},R=H(()=>({width:`${I.width}px`})),ne=E=>Pe[E.type].params,je=H(()=>{const E=(N,V)=>N.argName===V.argName&&N.typeName===V.typeName,P=(N,V,D)=>D.findIndex(ce=>E(N,ce))===V,L=N=>!N.formOnly;return s.selectedWidgets.flatMap(N=>{var V;return z(N)?(V=re[N.type])==null?void 0:V.pythonAPI.params:ne(N)}).filter(Boolean).filter(L).filter(P)}),ye=H(()=>{const E=(L,N)=>L.key===N.key,P=(L,N,V)=>V.findIndex(D=>E(L,D))===N;return s.selectedWidgets.flatMap(L=>{var N;return z(L)?(N=re[L.type])==null?void 0:N.events:[]}).filter(Boolean).filter(P).filter(L=>L.key!=="change")}),Ze=E=>{s.layoutModel.updateVariable(E,l.value.id),o.value="variable"},xe=E=>P=>{s.layoutModel.updateProp({param:E,value:P},s.selectedWidgets.map(L=>L.id)),o.value=E.argName},Je=E=>P=>{s.layoutModel.updateEvent({event:E,value:P},s.selectedWidgets.map(L=>L.id))},Qe=()=>{var E,P;return(P=(E=c.value.variable)==null?void 0:E.repr)==null?void 0:P.includes("SyntaxError")},qe=()=>{var E,P;return(P=(E=c.value.variable)==null?void 0:E.repr)==null?void 0:P.includes("NameError")},y=E=>{var P;!E||((P=s.dashPlayerState.broker)==null||P.send({name:E,value:null,type:"variable-created",state:s.dashPlayerState.apiPageState}),t("create-variable",E))},x=()=>{var E,P;return((E=c.value.widget)==null?void 0:E.repr)&&!Object.values((P=c.value.props)!=null?P:{}).some(L=>L.repr)},Q=E=>{var P,L;return(L=(P=c.value.props)==null?void 0:P[E])==null?void 0:L.repr},se=E=>q.exports.upperFirst(E.replace(/_/g," "));return(E,P)=>{var N,V;const L=Oe("icon");return b(),O("div",{class:"widget-props-editor",style:Ne(g(R))},[w("div",Na,[w("div",Ca,[w("h1",null,F(i(g(l))),1),T(L,{path:g(Jt),fill:"#414A58",class:"close-icon",width:"16",height:"16",onClick:P[0]||(P[0]=D=>t("close"))},null,8,["path"])]),x()?(b(),O("div",xa,[Ma,Wa,w("pre",{class:"prop-error",textContent:F(x())},null,8,Ba)])):U("",!0),g(h)?(b(),O("div",Ga,[w("div",{class:"section-header",onClick:P[1]||(P[1]=D=>a("variable"))},[T(L,{path:n("variable")?g(tt):g(st),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Fa]),n("variable")?(b(),O("div",Ha,[w("div",Ua,[za,Ka,w("div",Va,[T(nt,{placeholder:"variable_name","param-name":"variable","dash-player-state":e.dashPlayerState,value:(N=g(l).variable)!=null?N:"",commit:Ze,"is-code":!1,onInput:P[2]||(P[2]=D=>g(l).variable=D)},null,8,["dash-player-state","value"])]),qe()&&g(l).variable?(b(),O("div",ja,[Za,w("button",{onClick:P[3]||(P[3]=D=>y(g(l).variable))}," Create ")])):Qe()?(b(),O("pre",Ja)):(V=g(c).variable)!=null&&V.repr?(b(),O("pre",{key:2,class:"prop-error",textContent:F(g(c).variable.repr)},null,8,Qa)):U("",!0),T(jt,{param:g(v)},null,8,["param"])])])):U("",!0)])):U("",!0),g(ye).length?(b(),O("div",qa,[w("div",{class:"section-header",onClick:P[4]||(P[4]=D=>a("events"))},[T(L,{path:n("events")?g(tt):g(st),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Xa]),n("events")?(b(),O("div",Ya,[er,(b(!0),O(ke,null,Te(g(ye),D=>(b(),O("div",{key:D.key,class:"widget-prop"},[w("label",tr,"On "+F(D.key),1),w("p",sr,"Executed after "+F(D.key),1),T(nt,{"param-name":D.key,"dash-player-state":e.dashPlayerState,value:g(l).events[D.key],commit:Je(D),"is-code":!0,onInput:ce=>g(l).events[D.key]=ce},null,8,["param-name","dash-player-state","value","commit","onInput"])]))),128))])):U("",!0)])):U("",!0),w("div",or,[w("div",{class:"section-header",onClick:P[5]||(P[5]=D=>a("properties"))},[T(L,{path:n("properties")?g(tt):g(st),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),ar]),n("properties")?(b(),O("div",rr,[nr,(b(!0),O(ke,null,Te(g(je),D=>{var ce;return b(),O("div",{key:D.argName,class:"widget-prop"},[w("p",ir,F(se(D.argName)),1),w("p",lr,F(D.description),1),T(nt,{"has-error":!!Q(D.argName),placeholder:(ce=D.default)!=null?ce:void 0,"param-name":D.argName,"dash-player-state":e.dashPlayerState,value:g(l).props[D.argName],commit:xe(D),"is-code":!0,onInput:ue=>g(l).props[D.argName]=ue},null,8,["has-error","placeholder","param-name","dash-player-state","value","commit","onInput"]),Q(D.argName)?(b(),O("pre",{key:0,class:"prop-error",textContent:F(Q(D.argName))},null,8,cr)):U("",!0),T(jt,{param:D},null,8,["param"])])}),128))])):U("",!0)])]),w("div",{ref_key:"handlerRef",ref:d,class:"handler",onMousedown:P[6]||(P[6]=zs(D=>I.resizing=!0,["stop"]))},dr,544)],4)}}});const hr=J(pr,[["__scopeId","data-v-772fa7a8"]]),ls=e=>(ze("data-v-0d595f79"),e=e(),Ke(),e),fr={class:"interact-menu"},vr={class:"icon-container"},gr=ls(()=>w("span",{class:"edit"},"Edit [Shift + P]",-1)),mr={class:"icon-container"},yr=ls(()=>w("span",null,"Interact [Shift + P]",-1)),wr=Z({__name:"InteractMenu",props:{isPreview:{type:Boolean}},emits:["changePreview"],setup(e,{emit:t}){return(s,o)=>{const a=Oe("icon");return b(),O("div",fr,[w("div",vr,[T(a,{class:ge(["icon",{active:!e.isPreview}]),path:g(Gs),fill:"#5A677A",onClick:o[0]||(o[0]=n=>t("changePreview",!1))},null,8,["class","path"]),gr]),w("div",mr,[T(a,{class:ge(["icon",{active:e.isPreview}]),path:g(Qt),fill:"#5A677A",onClick:o[1]||(o[1]=n=>t("changePreview",!0))},null,8,["class","path"]),yr])])}}});const _r=J(wr,[["__scopeId","data-v-0d595f79"]]),Sr={class:"header"},Er={key:0},br={key:1},Pr=Z({__name:"RuntimeHeader",props:{title:{type:String},path:{type:String,required:!0}},setup(e){return(t,s)=>(b(),O("div",Sr,[e.title?(b(),O("p",Er,F(e.title),1)):(b(),O("p",br,F(e.path),1))]))}});const Ir=J(Pr,[["__scopeId","data-v-c8a406b2"]]);function Or(e){var s;const t=(s=document.getSelection())==null?void 0:s.toString();return(e==null?void 0:e.selectionStart)!==void 0||!!t}const Ar={key:0,class:"widget-metadata-card"},Lr=["src"],Rr={class:"metadata-title"},Dr={class:"metadata-description"},$r={key:1,class:"collapsed-widget-metadata-card"},kr=["src"],Tr=Z({__name:"WidgetMetadataCard",props:{metadata:null,collapsed:{type:Boolean}},setup(e){const t=window.__baseURL?`${window.__baseURL}/media`:"",s=a=>a in Pe?`${t}/${Pe[a].thumbname}`:`${t}/widget-thumbs/${io(a)}.svg`,o=window.__vscodeTheme===2?"dark":"light";return(a,n)=>e.collapsed?(b(),O("div",$r,[w("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:Ne(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,kr)])):(b(),O("div",Ar,[w("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:Ne(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,Lr),w("div",Rr,F(e.metadata.name),1),w("div",Dr,F(e.metadata.description),1)]))}});const Nr=J(Tr,[["__scopeId","data-v-2b654c57"]]),We={"click-input":-1,"text-output":0,"number-input":1,"text-input":2,"link-output":3,"multiple-choice-input":4,"file-input":5,"email-input":6,"markdown-output":7,"dropdown-input":8,"date-input":9,"cards-input":10,"textarea-input":11,"list-input":12,"file-output":13,"html-output":14,"pandas-output":15,"checkbox-input":16,"cnpj-input":17,"code-input":18,"progress-output":19,"pandas-row-selection-input":20,"image-input":21,"password-input":22,"currency-input":23,"iframe-output":24,"checklist-input":25,"image-output":26,"nps-input":27,"phone-input":28},Cr=Z({__name:"WidgetsMetadataList",emits:["dragstart","hover","leave"],setup(e,{emit:t}){const s=G(""),o=G(),a=G(!0),n=()=>{a.value=!1},i=()=>{a.value=!0,h()},c=async()=>{await yt(),o.value&&o.value.focus()},h=()=>{s.value=""},l=Object.values(re).concat(Object.entries(Pe).map(([p,d])=>({type:p,...d}))).reduce((p,d)=>d.formOnly?p:{...p,[d.type]:d},{}),v=H(()=>s.value?Object.values(l).map(p=>({widget:p,score:lo(p,s.value.split(" "))})).filter(({score:p})=>p>0).sort(({score:p},{score:d})=>d-p).map(({widget:p})=>p):Object.values(l).sort((p,d)=>{const S=p.type,I=d.type;if(S in We){if(!(I in We))return-1}else return 1;return We[S]-We[I]}));function f(p,d){t("dragstart",p,d)}return(p,d)=>{const S=Oe("icon");return b(),O("div",{class:"widgets-metadata",onMouseover:n,onMouseleave:i},[w("div",Ks({class:["search",{collapsed:a.value}]},Vs(a.value?{click:c}:{},!0)),[T(S,{path:g(Fs),class:"search-icon"},null,8,["path"]),a.value?U("",!0):Ie((b(),O("input",{key:0,ref_key:"searchInput",ref:o,"onUpdate:modelValue":d[0]||(d[0]=I=>s.value=I),type:"search",class:"widgets-metadata-filter",placeholder:"Find widgets"},null,512)),[[ft,s.value]])],16),w("div",{class:ge(["widgets-metadata-list",{collapsed:a.value}])},[(b(!0),O(ke,null,Te(g(v),I=>(b(),pe(Nr,{key:I.type,metadata:I,draggable:!0,collapsed:a.value,onDragstart:k=>f(k,I.type)},{default:we(()=>[Be(F(I.type),1)]),_:2},1032,["metadata","collapsed","onDragstart"]))),128))],2)],32)}}});const xr=J(Cr,[["__scopeId","data-v-cb0151ea"]]),Mr=e=>t=>q.exports.uniq(e.map(Xs(t))).length===1,Wr=e=>e.some(t=>re[t.type].autoHeight);function Br(e,t){const s=Mr(e),o=Wr(e),a=[],n=16,i=6;return s("colStart")&&a.push({rect:{x:t.x-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"left"}),s("colEnd")&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"right"}),s("colStart")&&s("rowStart")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-left"}),s("colEnd")&&s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-right"}),s("colStart")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-left"}),s("colEnd")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-right"}),s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y-i/2,width:n,height:i,referential:"screen"},side:"top"}),s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y+t.height-i/2,width:n,height:i,referential:"screen"},side:"bottom"}),a}const Gr=e=>({type:"copyAndPaste",selectedWidgets:e});function Fr(e,t){return e.setData("text/plain",JSON.stringify(Gr(t))),!0}function Hr(e,t,s){const o=e.getData("text/plain");try{const a=o&&JSON.parse(o);if(!(a&&"type"in a&&a.type==="copyAndPaste"&&"selectedWidgets"in a&&Array.isArray(a.selectedWidgets)))return!1;const i=ta(t,a.selectedWidgets);return s.operationQueue.execute({name:"paste",operations:i,selection:t.selectedWidgets}),!0}catch{return!1}}const cs=e=>(ze("data-v-2c14d939"),e=e(),Ke(),e),Ur={class:"runtime-editor"},zr={class:"title"},Kr=cs(()=>w("br",null,null,-1)),Vr={class:"properties"},jr={class:"property"},Zr=cs(()=>w("p",{class:"property-name"},"Title",-1)),Jr=Z({__name:"RuntimePropertiesEditor",props:{runtime:{type:Object,required:!0}},emits:["close"],setup(e,{emit:t}){return(s,o)=>{const a=Oe("icon");return b(),O("div",Ur,[w("div",zr,[w("h1",null,[Be(F(e.runtime.title),1),Kr,Be(" properties ")]),T(a,{path:g(Jt),fill:"#414A58",class:"close-icon",onClick:o[0]||(o[0]=n=>t("close"))},null,8,["path"])]),w("div",Vr,[w("div",jr,[Zr,Ie(w("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>e.runtime.title=n),type:"text",class:"property-input"},null,512),[[ft,e.runtime.title]])])])])}}});const Qr=J(Jr,[["__scopeId","data-v-2c14d939"]]);class qr{constructor(t){le(this,"event");this.event=t}setData(t,s){var o;(o=this.event.clipboardData)==null||o.setData(t,s)}getData(t){var s,o;return(o=(s=this.event.clipboardData)==null?void 0:s.getData(t))!=null?o:null}getTransferItems(){var t,s;return Object.values((s=(t=this.event.clipboardData)==null?void 0:t.items)!=null?s:[]).map(Yr)}}class Xr{constructor(t){le(this,"item");this.item=t}get type(){return this.item.type}getAsString(){return new Promise(t=>this.item.getAsString(s=>t(s)))}getJSONValue(){return this.getAsString().then(t=>{try{return t?JSON.parse(t):null}catch{return null}})}getAsFile(){return this.item.getAsFile()}}function Yr(e){return new Xr(e)}function Zt(e){return new qr(e)}const en={class:"dash-layout-editor"},tn=Z({__name:"DashLayoutEditor",props:{dash:null,params:null,dashPlayerState:null,workspace:null},emits:["navigate","change-preview","create-variable"],setup(e,{emit:t}){const s=e,o=()=>R.updateVersion(),a=G(null),n=G(null),i=r=>t("navigate",r),c=r=>t("create-variable",r),h=r=>t("change-preview",r),l=()=>{var r;return(r=A)==null?void 0:r.correct()},v=r=>{if(!A)return;const u={x:r.pageX,y:r.pageY,referential:"screen"},m=A.screenPoint2world(u);if(y.value.state==="PANNING"){const $={dx:-r.movementX,dy:-r.movementY},W=A.screenDelta2world({dx:$.dx,dy:$.dy,referential:"screen"});A.translate(W),r.preventDefault(),r.stopPropagation();return}y.value.state==="MOVING"&&(y.value.mousePos=m,y.value.duplicating=lt(r)),y.value.state==="MOVING_SLOTTABLE"&&(y.value.mousePos=m),y.value.state==="JUST_CLICKED"&&Ct(y.value.pos,m)*A.zoom>5&&(_.has(y.value.widgetId)||(de(r)?_.addToSelectedWidgets(y.value.widgetId):(_.resetSelection(),_.addToSelectedWidgets(y.value.widgetId))),y.value={state:"MOVING",initialMousePos:y.value.pos,mousePos:m,duplicating:lt(r)}),y.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&Ct(y.value.mousePos,m)*A.zoom>5&&(y.value={state:"MOVING_SLOTTABLE",initialMousePos:A.screenPoint2world(y.value.mousePos),mousePos:m,slottableId:y.value.slottableId}),y.value.state==="SELECTING"&&(y.value.mousePos=u),y.value.state==="RESIZING"&&(y.value.mousePos=u),y.value.state==="SLOTTABLE_RESIZING"&&(y.value.mousePos=u),Dt(u)},f=r=>{Or(r==null?void 0:r.target)||Fr(Zt(r),_.selectedWidgets)&&r.preventDefault()},p=r=>{Hr(Zt(r),ue(),R)&&r.preventDefault()},d=gt({active:!1,hoverZoomBar:!1}),S=()=>{d.hoverZoomBar=!0},I=()=>{d.hoverZoomBar=!1},k=G(null),R=It.create(q.exports.cloneDeep(s.dash.layout),X);ve(s.dash.layout,()=>{R.setLayout(s.dash.layout)});const ne=H(()=>X.isPreview),je=H(()=>Object.keys(s.dash.rootSlot).reduce((r,u)=>{const m=s.dash.rootSlot[u];return m.position&&(r[u]=m),r},{}));let ye=null;const Ze=q.exports.throttle(()=>{q.exports.isEqual(s.dash.rootSlot,ye)||(ye=q.exports.cloneDeep(s.dash.rootSlot),ds())},500),xe=()=>{R.onSave(async()=>{!s.workspace||(s.dash.layout=R.layout,s.dashPlayerState.updateDashData(s.dash.makeRunnerData(s.workspace)),Ze())})};xe(),ve(R,xe);const Je=H(()=>Object.keys(R.widgets).reduce((r,u)=>{var j,oe,ae;const m=(j=s.dashPlayerState.computedErrors.props)==null?void 0:j[u],$=(oe=s.dashPlayerState.computedErrors.variables)==null?void 0:oe[u],W=(ae=s.dashPlayerState.computedErrors.widgets)==null?void 0:ae[u];return!m&&!$&&!W||!Object.keys({...m,...$,...W}).length?r:r?[...r,u]:[u]},[])),Qe=H(()=>{var r,u,m,$,W,j;return{props:(u=s.dashPlayerState.computedErrors.props)==null?void 0:u[(r=_.selectedSlottableId)!=null?r:_.selectedWidgetId],widget:($=s.dashPlayerState.computedErrors.widgets)==null?void 0:$[(m=_.selectedSlottableId)!=null?m:_.selectedWidgetId],variable:(j=s.dashPlayerState.computedErrors.variables)==null?void 0:j[(W=_.selectedSlottableId)!=null?W:_.selectedWidgetId]}});function qe(r,u){if(!A)return;const m=A.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});_.resetSelection(),u in Pe?y.value={state:"DRAGGING_SLOTTABLE",...m,type:u}:y.value={state:"DRAGGING",...m,type:u}}const y=G({state:"IDLE"});let x={state:"NONE"};const Q=H(()=>(it.setDashRunnerData(s.dashPlayerState.navbarVisible,s.dashPlayerState.hasSidebar),it));ve(Q,()=>{var r;return(r=A)==null?void 0:r.updateGrid(Q.value)});const se=G(null),E=G(null),P=G(null),L=G(null);function N(){var $,W;const r=E.value,u=L.value;if(!r)throw new Error(`canvas = ${r}`);if(!u)throw new Error(`editor = ${u}`);A.setProjectedCanvas(r),A.correct(),u.addEventListener("wheel",V),r.addEventListener("mousedown",ce),r.addEventListener("drop",Rt),r.addEventListener("dragover",ps),($=r.parentElement)==null||$.addEventListener("keydown",bs),(W=r.parentElement)==null||W.addEventListener("keyup",Ps);const m=r.getContext("2d");if(!m)throw new Error(`I can't get no context 2d ${r}`);k.value=to.create(r),Xe(m)}function V(r){if(!A)return;const u={x:r.pageX,y:r.pageY,referential:"screen"};if($e(r)||So(r))A.zoomIn(Math.exp(-Math.sign(r.deltaY)*.05),u),r.preventDefault();else{const m=de(r)?{dx:r.deltaY,dy:0}:{dx:r.deltaX,dy:r.deltaY},$=A.screenDelta2world({dx:m.dx,dy:m.dy,referential:"screen"});A.translate($)}r.stopPropagation()}function D(r){var u;De.overrideProps(r,{condition:!((u=De.props)!=null&&u[r].condition)})}function ce(r){var $;if(!A)return;const u={x:r.pageX,y:r.pageY,referential:"screen"};if(r.button==1||r.button==0&&bo.isPressed("space")){y.value={state:"PANNING",initialMousePos:u,mousePos:u};return}const m=A.screenPoint2world(u);x.state==="HOVERING_WIDGET"?y.value={state:"JUST_CLICKED",pos:m,widgetId:x.widgetId}:x.state==="HOVERING_RESIZE_HANDLER"?y.value={state:"RESIZING",side:x.side,initialMousePos:u,mousePos:u,type:($=_.selectedWidget)==null?void 0:$.type}:x.state==="HOVERING_TOGGLE"?y.value={state:"JUST_CLICKED_TOGGLE",mousePos:u,slottable:x.slottable}:x.state==="HOVERING_SLOTTABLE_RESIZE_HANDLER"?y.value={state:"SLOTTABLE_RESIZING",initialMousePos:u,mousePos:u,slottableId:x.slottableId,side:"bottom"}:x.state==="HOVERING_SLOTTABLE_SELECTOR"?y.value={state:"JUST_CLICKED_SLOTTABLE_SELECTOR",slottableId:x.slottableId,mousePos:u}:(de(r)||_.resetSelection(),y.value={state:"SELECTING",initialMousePos:u,mousePos:u})}const ue=()=>{var r;return{mouseState:y.value,grid:Q.value,camera:A,workingLayout:R,hoverState:x,resizeHandlerRects:At(),widgetsInRectangularSelection:Ye(),selectedWidgets:new Set(_.selectedWidgetsIds),dash:s.dash,calculatedPositions:xt(s.dashPlayerState.runnerData.layout.slot,(r=De.props)!=null?r:{},Q.value),selectedSlottable:_.selectedSlottableId}},us=()=>{var W,j,oe,ae,Ae,Le,Re,$t,kt,Tt;const r=A.screenRect2world(A.canvasRect),u=A.screenDelta2world({dx:8,dy:8,referential:"screen"}),m=A.screenRect2world({x:(W=n.value)==null?void 0:W.$el.getBoundingClientRect().x,y:(j=n.value)==null?void 0:j.$el.getBoundingClientRect().y,width:(oe=n.value)==null?void 0:oe.$el.getBoundingClientRect().width,height:(ae=n.value)==null?void 0:ae.$el.getBoundingClientRect().height,referential:"screen"});et({origin:{x:Math.min(Q.value.width+u.dx,r.x+r.width-m.width-u.dx),y:Math.max(r.y+u.dy,0),referential:"world"},element:(Ae=n==null?void 0:n.value)==null?void 0:Ae.$el,ignoreZoom:!0});const $=A.screenRect2world({x:(Le=se.value)==null?void 0:Le.$el.getBoundingClientRect().x,y:(Re=se.value)==null?void 0:Re.$el.getBoundingClientRect().y,width:($t=se.value)==null?void 0:$t.$el.getBoundingClientRect().width,height:(kt=se.value)==null?void 0:kt.$el.getBoundingClientRect().height,referential:"screen"});et({origin:{x:0,y:-$.height-u.dy,referential:"world"},element:(Tt=se==null?void 0:se.value)==null?void 0:Tt.$el,ignoreZoom:!0})},ds=()=>{var r;(r=s.dashPlayerState.broker)==null||r.send({type:"widgets-changed",state:s.dashPlayerState.apiPageState,dashDefinition:{slot:s.dash.rootSlot}})},ie=G(null);function Xe(r){var j,oe,ae,Ae,Le,Re;if(!A||!s.workspace)return;et({origin:{x:0,y:0,referential:"world"},element:(j=a==null?void 0:a.value)==null?void 0:j.$el}),us();const u=r.canvas.getBoundingClientRect();if(r.canvas.width=r.canvas.offsetWidth,r.canvas.height=r.canvas.offsetHeight,r.clearRect(0,0,r.canvas.width,r.canvas.height),r.translate(-u.x,-u.y),r.canvas.style.cursor=(ae=(oe=k.value)==null?void 0:oe.cursor(y.value,x))!=null?ae:"default",!k.value){requestAnimationFrame(()=>Xe(r));return}const m=ue(),$=Yo(m);(!q.exports.isEqual($.operations,(Ae=ie.value)==null?void 0:Ae.operations)||!q.exports.isEqual($.layout,(Le=ie.value)==null?void 0:Le.layout))&&(ie.value=$,s.dashPlayerState.updateRunnerData(s.dash.makeRunnerData(s.workspace,ie.value.layout))),ie.value&&k.value.render({...m,computedState:ie.value,isPreview:X.isPreview,calculatedPositions:xt(s.dash.makeRunnerData(s.workspace,ie.value.layout).layout.slot,(Re=De.props)!=null?Re:{},Q.value)}),requestAnimationFrame(()=>Xe(r))}s.dashPlayerState.onWidgetsComputedMessage(r=>{var $;const u=Object.keys(s.dashPlayerState.runnerData.layout.slot),m=Object.keys(($=r.props)!=null?$:{});co(u,m)}),qt(()=>{o(),ye=q.exports.cloneDeep(uo(je.value,re)),De.setInitialEditProps(s.dash.rootSlot),_.setLayoutModel(R),addEventListener("resize",l),addEventListener("copy",f),addEventListener("paste",p),addEventListener("mousemove",v),yt(()=>{N()})}),mt(()=>{removeEventListener("resize",l),removeEventListener("copy",f),removeEventListener("paste",p),removeEventListener("mousemove",v),Ys()});function ps(r){if(!A)return;r.preventDefault();const u=A.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});y.value={...y.value,...u}}const hs=()=>{y.value.state==="IDLE"&&_.resetSelection(),Lt({referential:"screen",x:0,y:0})},Ot=()=>{_.selectedSlottableId?R.delete([_.selectedSlottableId]):R.delete(_.selectedWidgetsIds),_.resetSelection()},fs=r=>{if($e(r)&&de(r)){r.preventDefault(),r.stopPropagation();const u=R.redo();if(u){if(u.operations.some(m=>m.op==="remove")){_.resetSelection();return}_.selectedWidgetsIds=[...new Set(u.selection)]}return}else if($e(r)){r.preventDefault(),r.stopPropagation();const u=R.undo();if(u){if(u.operations.some(m=>m.op==="remove")){_.resetSelection();return}_.selectedWidgetsIds=[...new Set(u.selection)]}return}},Me=(r,u)=>{const[m,$]={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}[u],W=ea(r,m,$);R.operationQueue.execute({name:`move ${u}`,operations:W,selection:r.selectedWidgets})},vs=()=>{Me(ue(),"up")},gs=()=>{Me(ue(),"down")},ms=()=>{Me(ue(),"left")},ys=()=>{Me(ue(),"right")},ws=r=>{$e(r)&&(r.preventDefault(),r.stopPropagation(),_.selectAll())};ve(()=>s.dashPlayerState.authenticating,r=>{r&&(X.isPreview=!0)});const _s=r=>{de(r)&&h(!X.isPreview)},Ss=()=>{y.value.state!=="PANNING"&&(y.value.state="START_PANNING")},Es=r=>({escape:()=>hs(),backspace:()=>Ot(),delete:()=>Ot(),z:()=>fs(r),arrowup:()=>vs(),arrowdown:()=>gs(),arrowleft:()=>ms(),arrowright:()=>ys(),a:()=>ws(r),p:()=>_s(r),space:()=>Ss()}),bs=r=>{var u,m;return(m=(u=Es(r))[r.key.toLowerCase().trim()?r.key.toLowerCase():r.code.toLowerCase()])==null?void 0:m.call(u)},Ps=()=>{y.value.state="IDLE"};function Is(){if(y.value.state!=="SELECTING")return null;const{x:r,y:u}=y.value.initialMousePos,{x:m,y:$}=y.value.mousePos;return{x:Math.min(r,m),y:Math.min(u,$),width:Math.abs(r-m),height:Math.abs(u-$),referential:"screen"}}function Ye(){if(!A)throw new Error("No camera value yet");const r=Is();return r?new Set(Object.keys(s.dashPlayerState.widgets).filter(u=>so(A.worldRect2screen(be(s.dashPlayerState.getWidgetPosition(u),Q.value)),r))):new Set}function Os(){return _.selectedWidgetsIds.every(r=>Object.keys(s.dashPlayerState.widgets).includes(r))}const As=()=>Xt(Object.entries(s.dashPlayerState.widgets).filter(([r])=>_.has(r)).map(([r,u])=>be(u.position,Q.value)));function At(){if(!A)throw new Error("No camera value yet");const r=As();return!r||!Os()?[]:Br(_.selectedWidgets,A.worldRect2screen(r))}function Lt(r){y.value={state:"IDLE"},Dt(r)}const Ls=r=>{y.value=y.value,de(r)?Ye().forEach(u=>{_.toggleWidgetSelection(u)}):(_.resetSelection(),Ye().forEach(u=>{_.addToSelectedWidgets(u)}))};function Rt(r){var m;(m=ie.value)!=null&&m.operations.length&&R.operationQueue.execute({name:"mouse up",operations:ie.value.operations,selection:new Set(_.selectedWidgetsIds)}),y.value.state==="SELECTING"&&Ls(r),y.value.state==="JUST_CLICKED"&&(_.isDashSelected=!1,de(r)?_.toggleWidgetSelection(y.value.widgetId):(_.clearWidgetSelection(),_.selectedSlottableId=null,_.addToSelectedWidgets(y.value.widgetId))),y.value.state==="JUST_CLICKED_TOGGLE"&&D(y.value.slottable),y.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&(_.isDashSelected=!1,_.selectedSlottableId=y.value.slottableId);const u={x:r.pageX,y:r.pageY,referential:"screen"};Lt(u)}addEventListener("mouseup",Rt);const Rs=r=>{for(const u of At())if(Mt(r,u.rect)){x={state:"HOVERING_RESIZE_HANDLER",side:u.side};return}},Ds=r=>{var m;const u=(m=Object.keys(s.dashPlayerState.widgets).find($=>Mt(A.screenPoint2world(r),be(s.dashPlayerState.getWidgetPosition($),Q.value))))!=null?m:null;u?x={state:"HOVERING_WIDGET",widgetId:u}:x={state:"NONE"}},$s=r=>{const u=ot.getToggleUnderCursor(r);u&&(x={state:"HOVERING_TOGGLE",slottable:u.id})},ks=r=>{const u=ot.getSelectorUnderCursor(r);u&&(x={state:"HOVERING_SLOTTABLE_SELECTOR",slottableId:u.id})},Ts=r=>{const u=ot.getResizerUnderCursor(r);u&&(x={state:"HOVERING_SLOTTABLE_RESIZE_HANDLER",slottableId:u.id})};function Dt(r){!A||(Ds(r),Rs(r),$s(r),ks(r),Ts(r))}const et=r=>{const{origin:u,element:m,ignoreZoom:$}=r;if(!A||!m||!m.style)return;const W=A.worldPoint2screen(u),j=E.value.getBoundingClientRect(),oe=[`translate(${W.x-j.x}px, ${W.y-j.y}px)`,$?null:`scale(${A.zoom})`].filter(ae=>ae).join(" ");Object.assign(m.style,{transform:oe,transformOrigin:"top left"})};return(r,u)=>(b(),O("div",en,[Ie(T(xr,{onDragstart:qe},null,512),[[vt,!g(ne)]]),w("div",{ref_key:"editor",ref:P,class:ge(["editor"]),onDblclick:u[1]||(u[1]=(...m)=>g(_).selectDash&&g(_).selectDash(...m))},[w("div",{ref_key:"listeners",ref:L,class:"listeners",tabindex:"0"},[T(eo,{ref_key:"player",ref:a,class:ge(["player",{preview:g(X).isPreview},{selected:g(_).isDashSelected}]),style:{top:0,left:0,height:"unset"},"is-preview":!0,params:e.params,camera:g(A),"editing-mode":!g(X).isPreview,"force-responsivity":"desktop","widgets-with-errors":g(Je),"dash-player-state":e.dashPlayerState,onNavigate:i},null,8,["class","params","camera","editing-mode","widgets-with-errors","dash-player-state"]),w("canvas",{ref_key:"canvas",ref:E,class:ge(["layout-canvas",{hide:g(ne)}])},null,2)],512),T(Ir,{ref_key:"runtimeHeader",ref:se,title:e.dashPlayerState.runnerData.title,path:e.dashPlayerState.runnerData.path,onClick:u[0]||(u[0]=m=>g(_).selectDash())},null,8,["title","path"]),T(_r,{ref_key:"interactMenu",ref:n,class:"interact-menu","is-preview":g(X).isPreview,onChangePreview:h},null,8,["is-preview"])],544),(g(_).selectedWidgetsIds.length>0||g(_).selectedSlottableId)&&!g(X).isPreview&&y.value.state==="IDLE"?(b(),pe(hr,{key:0,"selected-widget-errors":g(Qe),"layout-model":g(R),"selected-widgets":g(_).selectedSlottable?[g(_).selectedSlottable]:g(_).selectedWidgets,"dash-player-state":e.dashPlayerState,onClose:u[2]||(u[2]=m=>g(_).clearWidgetSelection()),onCreateVariable:c},null,8,["selected-widget-errors","layout-model","selected-widgets","dash-player-state"])):U("",!0),g(_).isDashSelected&&!g(X).isPreview?(b(),pe(Qr,{key:1,runtime:e.dash,"runtime-type":"dash",onClose:u[3]||(u[3]=m=>g(_).isDashSelected=!1)},null,8,["runtime"])):U("",!0),T(ra,{camera:g(A),class:"zoom-bar",onHover:S,onLeave:I},null,8,["camera"])]))}});const sn=J(tn,[["__scopeId","data-v-b89ca24c"]]),on={class:"dash-editor"},an=Z({__name:"DashEditor",setup(e){const t=Zs(),{result:s}=Bt(()=>ho.get()),o=({id:S,type:I})=>{I==="dash"?(t.push({name:"dashEditor",params:{dashId:S},query:n.query}),h()):t.push({name:"editor",params:{formId:S},query:n.query})},a=()=>{var S;!((S=c.value)!=null&&S.path)||t.push(`/_editor/dash/${encodeURIComponent(c.value.path)}/preview`)},n=Js(),{loading:i,result:c,refetch:h}=Bt(()=>po.get(n.params.dashPath)),l=S=>{X.isPreview=S},v=S=>{var I;return(I=c.value)==null?void 0:I.addVariableToCode(S)};let f=js(null);const p=()=>{var S;if(!(!c.value||!s.value)){if(c.value.path===((S=f.value)==null?void 0:S.runnerData.path)){f.value.updateDashData(c.value.makeRunnerData(s.value));return}console.log(f),f.value=Wt.create(c.value.makeRunnerData(s.value),!0),f.value.onRedirect(({url:I,queryParams:k})=>xs(t,I,k))}},d=()=>{var S;!f.value||(S=f.value)==null||S.resetState()};return ve(c,p),mt(()=>{var S;!c.value||!s.value||Wt.delete((S=c.value)==null?void 0:S.makeRunnerData(s.value).idOrPath)}),(S,I)=>{const k=Oe("icon");return b(),O("div",on,[g(i)||!g(c)||!g(s)?(b(),pe(ro,{key:0,class:"loading",justify:"center"})):(b(),pe(Ms,{key:1},{left:we(()=>[T(Ws,{link:"/_editor/dashes"})]),right:we(()=>[w("button",{class:"preview-button",onClick:a},[T(k,{class:"icon",path:g(Qt),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),Be(" Preview ")]),T(fo,{model:g(c)},null,8,["model"])]),default:we(()=>[T(Nt,{title:"Layout editor"},{default:we(()=>[g(f)?(b(),pe(sn,{key:0,workspace:g(s),dash:g(c),"dash-player-state":g(f),params:g(n).query,onNavigate:o,onChangePreview:l,onCreateVariable:v},null,8,["workspace","dash","dash-player-state","params"])):U("",!0)]),_:1}),T(Nt,{title:"Settings"},{default:we(()=>[T(_o,{dash:g(c)},null,8,["dash"])]),_:1})]),_:1})),g(c)?(b(),pe(ao,{key:2,"dash-player-state":g(f)||void 0,runtime:"dashes",onRestart:d},null,8,["dash-player-state"])):U("",!0)])}}});const Rn=J(an,[["__scopeId","data-v-291f1611"]]);export{Rn as default};
//# sourceMappingURL=DashEditor.d496431b.js.map

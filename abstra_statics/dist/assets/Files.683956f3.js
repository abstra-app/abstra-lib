import{_ as z}from"./DocsButton.vue_vue_type_script_setup_true_lang.3826034f.js";import{C as M}from"./ContentLayout.60bdf180.js";import{p as S}from"./popupNotifcation.587e3b7a.js";import{a as L}from"./ant-design.8c3b48f3.js";import{a as V}from"./asyncComputed.d9d83dd3.js";import{b as G,U,D as H,a as R,G as q}from"./files.8cecda71.js";import{d as K,e3 as Q,g as x,f as Z,o as c,c as y,w as n,b as s,az as f,u as t,d6 as J,O as W,d4 as A,bM as k,a as h,ea as v,K as T,F as _,cZ as X,bK as Y,bs as ee,bq as N,d5 as B,cq as te,eF as oe,eG as ae,Q as ne}from"./index.6ad9d4dd.js";import{C as b}from"./gateway.42a226ec.js";import"./columns.ba378f95.js";import{C as se}from"./Card.2be8eb7f.js";import"./record.f93f9ce1.js";import"./string.75153ea3.js";import"./TabPane.d6fe8eae.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[o]="eb16bb6b-5b33-4e62-a563-b7d534e89d51",r._sentryDebugIdIdentifier="sentry-dbid-eb16bb6b-5b33-4e62-a563-b7d534e89d51")}catch{}})();class g{constructor(o){this.projectId=o}static fromProjectId(o){return new g(o)}async list(){return b.get(`projects/${this.projectId}/files`)}async DEPRECATED_upload(o,i=""){const u={"Content-Type":"multipart/form-data"};return b.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(i+"/"+o.name)}`,o,u)}async upload(o,i){const u={"Content-Type":"multipart/form-data"},C=new File([new Blob(i?[i]:[])],G(o));return b.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(o)}`,C,u)}async download(o){return b.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(o)}`)}async delete(o){return b.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(o)}`)}async move(o,i){return b.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(o)}&newPath=${encodeURIComponent(i)}`,{})}}const le=r=>(oe("data-v-c7bfa309"),r=r(),ae(),r),re=le(()=>h("br",null,null,-1)),ie={key:0},de={key:0,class:"file-size"},ce={class:"action-item"},ue={class:"action-item"},pe=K({__name:"Files",setup(r){const i=Q().params.projectId,u=g.fromProjectId(i),{loading:C,result:O,refetch:j}=V(()=>u.list());function F(e){var a,l;return{key:e.path,title:e.name,isLeaf:e.type==="file",file:e,children:e.type==="file"?[]:(l=(a=e.children)==null?void 0:a.map(F))!=null?l:[]}}const m=x(()=>{var e;return(e=O.value)==null?void 0:e.map(F)}),D=e=>{var a,l;return e.isLeaf?1:(l=(a=e.children)==null?void 0:a.reduce((d,p)=>d+D(p),0))!=null?l:0},w=x(()=>m.value?m==null?void 0:m.value.reduce((e,a)=>e+D(a),0):0),I=Z(!1);function $(e){if(e&&e.type==="file")return;const a=document.createElement("input");a.type="file",a.onchange=async()=>{var d;const l=(d=a.files)==null?void 0:d[0];if(!!l)try{I.value=!0,await u.DEPRECATED_upload(l,e==null?void 0:e.path),await j()}catch{S("Failed to upload file","File already exists")}finally{I.value=!1}},a.click()}async function P(e){if(!e)return;const a=await u.download(e.path),l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=e.name,l.click()}async function E(e){if(!e)return;const a="Are you sure you want to delete this "+(e.type==="file"?"file":"directory and all its contents")+"?";await L(a)&&(await u.delete(e.path),await j())}return(e,a)=>(c(),y(M,null,{default:n(()=>[s(t(J),null,{default:n(()=>[f("Files")]),_:1}),s(t(A),null,{default:n(()=>[f(" Here you can upload, download and delete files in your persistent dir."),re,f(" Files can be used in your scripts. "),s(z,{path:"cloud/files"}),W(e.$slots,"description",{},void 0,!0)]),_:3}),s(t(k),{type:"primary",loading:I.value,onClick:a[0]||(a[0]=l=>$())},{default:n(()=>[s(t(U)),f(" Upload ")]),_:1},8,["loading"]),s(t(se),{class:"files"},{default:n(()=>[w.value>0?(c(),y(t(A),{key:0},{default:n(()=>[h("b",null,[f(v(w.value)+" file",1),w.value!==1?(c(),T("span",ie,"s")):_("",!0)])]),_:1})):_("",!0),m.value&&m.value.length>0?(c(),y(t(X),{key:1,"tree-data":m.value,selectable:!1},{title:n(({title:l,isLeaf:d,file:p})=>[h("span",null,[f(v(l)+" ",1),d?(c(),T("span",de,"("+v(p.size)+")",1)):_("",!0)]),d?(c(),y(t(k),{key:0,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>P(p)},{default:n(()=>[s(t(H))]),_:2},1032,["onClick"])):_("",!0),d?(c(),y(t(k),{key:1,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>E(p)},{default:n(()=>[s(t(R))]),_:2},1032,["onClick"])):_("",!0),d?_("",!0):(c(),y(t(Y),{key:2},{overlay:n(()=>[s(t(ee),{disabled:t(C)},{default:n(()=>[s(t(N),{danger:!1,onClick:()=>$(p)},{default:n(()=>[h("div",ce,[s(t(U)),s(t(B),null,{default:n(()=>[f(" Upload ")]),_:1})])]),_:2},1032,["onClick"]),s(t(N),{danger:!1,onClick:()=>E(p)},{default:n(()=>[h("div",ue,[s(t(R)),s(t(B),null,{default:n(()=>[f(" Delete ")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1032,["disabled"])]),default:n(()=>[s(t(q),{style:{cursor:"pointer",float:"inline-end"},size:"25px"})]),_:2},1024))]),_:1},8,["tree-data"])):(c(),y(t(te),{key:2,description:t(C)?"Loading...":"No files"},null,8,["description"]))]),_:1})]),_:3}))}});const Fe=ne(pe,[["__scopeId","data-v-c7bfa309"]]);export{Fe as default};
//# sourceMappingURL=Files.683956f3.js.map

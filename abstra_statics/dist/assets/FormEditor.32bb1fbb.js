import{d as H,r as F,G as N,u as $,b as p,c as h,v as e,F as T,J as B,H as C,V as L,Y as M,B as W,y as t,e as u,T as j,N as z,O as G,q as D,t as I,w as _,K as J,L as O,a as Y,R as V,E as Q}from"./registerWidgets.fff064a1.js";import{a as q,L as X}from"./CircularLoading.59d7fd3d.js";import{E as Z}from"./Error.de2ae46c.js";import{R as ee,F as te}from"./broker.64603716.js";import{R as ae,T as se,B as oe,a as A}from"./BackButton.e9f71cf5.js";import{j as re,i as le}from"./icons.907f45d7.js";import{l as ne}from"./WidgetsFrame.cebd6d3d.js";import{F as ie}from"./forms.7bc6baea.js";import{W as ce}from"./workspaces.32af92db.js";import"./dashes.f5f65b41.js";import"./utils.3371dfe5.js";import"./runnerData.81f4c073.js";import"./hooks.039c0cd9.js";import"./jobs.af366134.js";import"./index.314cf40a.js";import"./Modal.2ceba592.js";const ue="forms_workspace_id_path_key",S=v=>(z("data-v-83062094"),v=v(),G(),v),pe={class:"form-settings"},de={class:"content"},me={class:"subsection-label"},he={class:"property-label"},ve=["value","placeholder","onChange"],fe={class:"content"},_e={class:"property"},ye=S(()=>e("div",{class:"property-label"},"Start smart form automatically",-1)),ge={class:"property"},be=S(()=>e("div",{class:"property-label"}," Allow the user to restart the smart form after it is over ",-1)),ke={class:"property column"},we=S(()=>e("div",{class:"property-label"},"Smart Form Path",-1)),xe={key:0,class:"error"},Ce={class:"path-input"},Se=["value","disabled"],Ee=S(()=>e("div",{class:"home-label"},"Home Form",-1)),Fe=["checked"],Pe=H({__name:"FormSettings",props:{form:null},setup(v){const n=v,s=F(n.form),d=[{label:"Welcome Screen",props:[{label:"Title",fallbackKey:"title",valueKey:"welcomeTitle"},{label:"Subtitle",valueKey:"startMessage"},{label:"Start button text",valueKey:"startButtonText"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"endMessage"},{label:"Restart button text",valueKey:"restartButtonText"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"errorMessage"}]}],y=r=>{const o=r.value;if(o===""){j.error("Path must not be empty"),r.value=n.form.path;return}f(o)},g=N(()=>n.form.path===""),i=r=>{f(r?"":n.form.path)},f=async r=>{if(!n.form)return;m.pathError=null,(n.form.path=r)||(m.pathError=k)},m=$({pathError:null,sectionsShown:[!0,!1,!1]}),b=r=>{r.detail.includes(ue)&&(m.pathError=k)},k="This path is already being used by another form or dash on your workspace";return addEventListener("hasura-error",b),(r,o)=>(p(),h("div",pe,[e("div",de,[(p(),h(T,null,B(d,l=>e("div",{key:l.label,class:"subsection"},[e("div",me,C(l.label),1),(p(!0),h(T,null,B(l.props,c=>{var w;return p(),h("div",{key:c.label,class:"property column"},[e("div",he,C(c.label),1),e("input",{class:"property-input",type:"text",value:s.value[c.valueKey],placeholder:(w=c.fallbackKey?s.value[c.fallbackKey]:null)!=null?w:"Enter message",onChange:E=>s.value[c.valueKey]=E.target.value},null,40,ve)])}),128))])),64))]),e("div",fe,[e("div",_e,[L(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.value.autoStart=l),class:"checkbox-input",type:"checkbox"},null,512),[[M,s.value.autoStart]]),ye]),e("div",ge,[L(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>s.value.allowRestart=l),class:"checkbox-input",type:"checkbox"},null,512),[[M,s.value.allowRestart]]),be]),e("div",ke,[we,m.pathError?(p(),h("div",xe,C(m.pathError),1)):W("",!0),e("div",Ce,[e("input",{value:s.value.path,class:"property-input",type:"text",disabled:t(g),onChange:o[2]||(o[2]=l=>y(l.target))},null,40,Se),Ee,e("input",{type:"checkbox",checked:t(g),onChange:o[3]||(o[3]=l=>i(l.target.checked))},null,40,Fe)])])]),u(ae,{runtime:s.value},null,8,["runtime"])]))}});const Re=D(Pe,[["__scopeId","data-v-83062094"]]),Ke={class:"page"},Te={key:1,class:"error"},Be=H({__name:"FormEditor",setup(v){const n=J(),s=O(),d=$({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});addEventListener("keydown",a=>{(a.ctrlKey||a.metaKey)&&a.key==="s"&&(a.preventDefault(),o())});const y=F(null),{loading:g,result:i,error:f,refetch:m}=q(async()=>{const a=await ie.get(s.params.formPath);return c(),a}),{result:b}=q(()=>ce.get()),k=()=>{i.value&&n.push(`/_editor/form/${encodeURIComponent(i.value.path)}/preview`)},r=F(!1);async function o(){var a;r.value=!0;try{await((a=i.value)==null?void 0:a.save())}finally{r.value=!1}}const l=N(()=>ee.create({isLocal:!1,formPath:s.params.formPath,isPreview:!0})),c=async()=>{var a;if(d.rightPanelCollapsed=!1,d.hasChanges=!1,!d.started){(a=y.value)==null||a.run();return}ne.log({type:"restart"}),d.started=!1},w=({path:a,type:x})=>{x==="dash"?n.push({name:"dashEditor",params:{dashPath:a},query:s.query}):(n.push({name:"editor",params:{formPath:a},query:s.query}),m())},E=()=>{d.started=!0},U=()=>{d.started=!1};return(a,x)=>{const P=Y("icon");return p(),h("div",Ke,[t(g)||!t(i)||!t(b)?(p(),I(X,{key:0})):t(f)?(p(),h("div",Te,[u(Z,{error:t(f),onReload:t(m)},null,8,["error","onReload"])])):(p(),I(se,{key:2},{left:_(()=>[u(oe,{link:"/_editor/forms"})]),right:_(()=>{var R,K;return[e("button",{class:"preview-button",onClick:k},[u(P,{class:"icon",path:t(re),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),V(" Preview ")]),e("button",{class:Q(["save-button",{changes:(R=t(i))==null?void 0:R.hasChanges()}]),onClick:x[0]||(x[0]=Le=>o())},[u(P,{class:"icon",path:t(le),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),V(" "+C(r.value?"Saving ...":(K=t(i))!=null&&K.hasChanges()?"Save":"Saved"),1)],2)]}),default:_(()=>[u(A,{title:"Preview"},{default:_(()=>[u(te,{ref_key:"runner",ref:y,form:t(i).makeRunnerData(t(b)),params:t(s).query,"is-preview":!0,"enable-auto-focus":!1,broker:t(l),style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:w,onLogout:c,onExit:U,onStart:E},null,8,["form","params","broker"])]),_:1}),u(A,{title:"Settings"},{default:_(()=>[u(Re,{form:t(i)},null,8,["form"])]),_:1})]),_:1}))])}}});const Ye=D(Be,[["__scopeId","data-v-21a1e910"]]);export{Ye as default};
//# sourceMappingURL=FormEditor.32bb1fbb.js.map

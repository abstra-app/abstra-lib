import{a as T}from"./asyncComputed.fa173b5a.js";import{d as C,r as A,b as m,c as g,w as o,u as e,f as a,cG as R,cD as $,au as v,ah as V,am as re,bI as b,N as O,bB as N,D as q,eS as j,ey as M,eH as ie,eJ as se,aG as H,ct as J,eG as ue,o as pe,eA as D}from"./outputWidgets.e2ed3ff5.js";import{A as ce}from"./index.91914483.js";import{_ as de}from"./DocsButton.vue_vue_type_script_setup_true_lang.2d176436.js";import{A as w,F as S}from"./Form.ba5a97c1.js";import{A as F}from"./index.981d8ca6.js";import{C as K}from"./CrudView.3cc8f3bd.js";import{G as z}from"./PhPencil.vue.fb0b79e7.js";import{A as me}from"./index.d93a0c04.js";import{C as ye,c as fe,d as ge}from"./repository.bccf7315.js";import{p as U}from"./popupNotifcation.d3f5b3fe.js";import{a as G}from"./ant-design.f084f103.js";import{A as ve}from"./Title.451e374d.js";import{A as _e}from"./Paragraph.96f9081a.js";import{A as L,T as be}from"./TabPane.5bdf986a.js";import"./BookOutlined.792f4595.js";import"./hasIn.ee0df185.js";import"./isNumeric.75337b1e.js";import"./router.a09506b3.js";import"./url.f4a27c06.js";import"./Modal.53b83c19.js";import"./index.7d888fea.js";import"./index.1107fb50.js";import"./Text.30cd4048.js";import"./Base.1e6a845e.js";/* empty css                                                                 */import"./fetch.59899a55.js";import"./record.c2b8598b.js";import"./pubsub.c137a732.js";import"./index.e205ca95.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new Error().stack;r&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[r]="6fc4acab-8eb1-44c9-b2ae-8ee7a4457772",c._sentryDebugIdIdentifier="sentry-dbid-6fc4acab-8eb1-44c9-b2ae-8ee7a4457772")}catch{}})();const we=C({__name:"View",props:{signupPolicy:{}},emits:["updated","save"],setup(c,{emit:r}){const l=c,t=A(l.signupPolicy.strategy),n=A(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns:[]),i=A(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns.map(s=>({label:s})):[]),y=s=>{const k=s;if(n.value=k,k.length===0){t.value="inviteOnly",f("inviteOnly");return}i.value=k.map(h=>({label:h})),l.signupPolicy.emailPatterns=s,r("updated",l.signupPolicy)},d=()=>{r("save")},f=s=>{t.value=s,s!=="patternOnly"&&(s==="inviteOnly"&&l.signupPolicy.allowOnlyInvited(),r("updated",l.signupPolicy))};return(s,k)=>(m(),g(e(ce),{style:{"padding-top":"8px",width:"100%"},justify:"space-between",align:"flex-end"},{default:o(()=>[a(e(re),{value:t.value,"onUpdate:value":f},{default:o(()=>[a(e(R),{direction:"vertical"},{default:o(()=>[a(e($),{value:"inviteOnly"},{default:o(()=>[v("Allow listed users only")]),_:1}),a(e(R),null,{default:o(()=>[a(e($),{value:"patternOnly"},{default:o(()=>[v("Allow everyone from this domain:")]),_:1}),a(e(V),{mode:"tags",value:s.signupPolicy.emailPatterns,style:{"min-width":"300px"},placeholder:"@domain.com or sub.domain.com",disabled:t.value!=="patternOnly",options:i.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":y},null,8,["value","disabled","options"])]),_:1})]),_:1})]),_:1},8,["value"]),a(e(b),{disabled:!s.signupPolicy.hasChanges,type:"primary",onClick:d},{default:o(()=>[v(" Save changes ")]),_:1},8,["disabled"])]),_:1}))}}),Ce=C({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(c,{emit:r}){const t=c.roleOptions.map(d=>({label:d.name,value:d.name})),n=O({email:"",roles:[]});function i(){r("cancel")}function y(){!n.email||r("created",n)}return(d,f)=>(m(),g(e(F),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:o(()=>[a(e(R),null,{default:o(()=>[a(e(b),{onClick:i},{default:o(()=>[v("Cancel")]),_:1}),a(e(b),{type:"primary",onClick:y},{default:o(()=>[v("Submit")]),_:1})]),_:1})]),default:o(()=>[a(e(S),{model:n,layout:"vertical"},{default:o(()=>[a(e(w),{key:"email",label:"Email",required:!0},{default:o(()=>[a(e(N),{value:n.email,"onUpdate:value":f[0]||(f[0]=s=>n.email=s)},null,8,["value"])]),_:1}),a(e(w),{key:"role",label:"Role"},{default:o(()=>[a(e(V),{value:n.roles,"onUpdate:value":f[1]||(f[1]=s=>n.roles=s),mode:"multiple",options:e(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),ke=C({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(c,{emit:r}){const l=c,t=l.roleOptions.map(d=>({label:d.name,value:d.name})),n=O({email:l.email,roles:l.roles});function i(){r("cancel")}function y(){r("updated",n)}return(d,f)=>(m(),g(e(F),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:o(()=>[a(e(R),null,{default:o(()=>[a(e(b),{onClick:i},{default:o(()=>[v("Cancel")]),_:1}),a(e(b),{type:"primary",onClick:y},{default:o(()=>[v("Submit")]),_:1})]),_:1})]),default:o(()=>[a(e(S),{model:n,layout:"vertical"},{default:o(()=>[a(e(w),{key:"email",label:"Email"},{default:o(()=>[a(e(N),{value:n.email,"onUpdate:value":f[0]||(f[0]=s=>n.email=s)},null,8,["value"])]),_:1}),a(e(w),{key:"role",label:"Role"},{default:o(()=>[a(e(V),{value:n.roles,"onUpdate:value":f[1]||(f[1]=s=>n.roles=s),mode:"multiple",options:e(t)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Ue=C({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(c){const r=c,l=q(()=>{var t;return{columns:[{name:"Email"},{name:"Roles"},{name:"",align:"right"}],rows:(t=r.users.map(n=>({key:n.email,cells:[{type:"text",text:n.email},{type:"slot",key:"roles",payload:{roles:n.roles}},{type:"actions",actions:[{icon:z,label:"Edit",onClick:()=>r.onEdit(n)},{icon:j,label:"Delete",onClick:()=>r.onDelete(n)}]}]})))!=null?t:[]}});return(t,n)=>(m(),g(K,{"entity-name":"users",title:"",loading:t.loading,description:"List all app users.","empty-title":"No users yet",table:l.value,"create-button-text":"Add users",onCreate:t.onCreate},{roles:o(({payload:i})=>[(m(!0),M(H,null,ie(i.roles,y=>(m(),g(e(me),{key:y,bordered:""},{default:o(()=>[v(se(y),1)]),_:2},1024))),128))]),_:1},8,["loading","table","onCreate"]))}}),he=C({__name:"NewRole",emits:["created","cancel"],setup(c,{emit:r}){const l=O({name:"",description:""});function t(){r("cancel")}function n(){!l.name||r("created",l)}return(i,y)=>(m(),g(e(F),{open:"",title:"New role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:t},{extra:o(()=>[a(e(R),null,{default:o(()=>[a(e(b),{onClick:t},{default:o(()=>[v("Cancel")]),_:1}),a(e(b),{type:"primary",onClick:n},{default:o(()=>[v("Submit")]),_:1})]),_:1})]),default:o(()=>[a(e(S),{model:l,layout:"vertical"},{default:o(()=>[a(e(w),{key:"name",label:"Name",required:!0},{default:o(()=>[a(e(N),{value:l.name,"onUpdate:value":y[0]||(y[0]=d=>l.name=d)},null,8,["value"])]),_:1}),a(e(w),{key:"description",label:"Description"},{default:o(()=>[a(e(J),{value:l.description,"onUpdate:value":y[1]||(y[1]=d=>l.description=d),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Re=C({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(c,{emit:r}){const l=c,t=O({description:l.description});function n(){r("cancel")}function i(){r("updated",t)}return(y,d)=>(m(),g(e(F),{open:"",title:"Update role",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:n},{extra:o(()=>[a(e(R),null,{default:o(()=>[a(e(b),{onClick:n},{default:o(()=>[v("Cancel")]),_:1}),a(e(b),{type:"primary",onClick:i},{default:o(()=>[v("Submit")]),_:1})]),_:1})]),default:o(()=>[a(e(S),{model:t,layout:"vertical"},{default:o(()=>[a(e(w),{key:"name",label:"Name"},{default:o(()=>[a(e(N),{value:l.name,disabled:""},null,8,["value"])]),_:1}),a(e(w),{key:"role",label:"Role"},{default:o(()=>[a(e(J),{value:t.description,"onUpdate:value":d[0]||(d[0]=f=>t.description=f),placeholder:"Optional description",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Ae=C({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(c){const r=c,l=q(()=>{var t;return{columns:[{name:"Name"},{name:"Description"},{name:"",align:"right"}],rows:(t=r.roles.map(n=>({key:n.id,cells:[{type:"text",text:n.name},{type:"text",text:n.description},{type:"actions",actions:[{icon:z,label:"Edit",onClick:()=>r.onEdit(n)},{icon:j,label:"Delete",onClick:()=>r.onDelete(n)}]}]})))!=null?t:[]}});return(t,n)=>(m(),g(K,{"entity-name":"roles",loading:t.loading,title:"",description:"List all app roles.","empty-title":"No roles yet",table:l.value,"create-button-text":"Add roles",onCreate:t.onCreate},null,8,["loading","table","onCreate"]))}}),ot=C({__name:"View",setup(c){const l=ue().params.projectId,t=A({type:"initial"}),n=A("users");pe(()=>{const p=new URLSearchParams(location.search).get("selected-panel")||"users",_=["roles","users"].includes(p)?p:"users";p&&(n.value=_)});const i=()=>{t.value.type="initial"},y=()=>{t.value.type="creatingUser"},d=u=>{t.value={type:"editingUser",payload:u}},f=()=>{t.value.type="creatingRole"},s=u=>{t.value={type:"editingRole",payload:u}},k=new ye(l),{result:h,refetch:Q}=T(()=>k.get()),W=async()=>{if(!!h.value)try{await k.update(h.value),Q()}catch(u){u instanceof Error&&U("Update Error",u.message)}},x=new fe(l),{loading:X,result:Y,refetch:E}=T(()=>x.list(100,0)),P=new ge(l),{loading:Z,result:B,refetch:I}=T(()=>P.list(100,0)),ee=async u=>{try{if(t.value.type!=="creatingUser")return;await x.create(u),i(),E()}catch(p){p instanceof Error&&U("Create Error",p.message)}},te=async u=>{try{if(t.value.type!=="editingUser")return;await x.update(t.value.payload.id,u),i(),E()}catch(p){p instanceof Error&&U("Update Error",p.message)}},ae=async u=>{if(!!await G("Deleteing users revoke their access to your application in case they aren't allowed to self sign-up. Are you sure you want to continue?"))try{await x.delete(u.id),E()}catch(_){_ instanceof Error&&U("Delete Error",_.message)}},oe=async u=>{try{if(t.value.type!=="creatingRole")return;await P.create(u),i(),I()}catch(p){p instanceof Error&&U("Create Error",p.message)}},ne=async u=>{try{if(t.value.type!=="editingRole")return;await P.update(t.value.payload.id,u),i(),I()}catch(p){p instanceof Error&&U("Update Error",p.message)}},le=async u=>{if(!!await G("Deleteing roles may revoke access to some features in your application. Are you sure you want to continue?"))try{await P.delete(u.id),I(),E()}catch(_){_ instanceof Error&&U("Delete Error",_.message)}};return(u,p)=>(m(),M(H,null,[a(e(ve),null,{default:o(()=>[v("Access Control")]),_:1}),a(e(_e),null,{default:o(()=>[v(" Manage how your end users interect with your application. "),a(de,{path:"concepts/access-control"})]),_:1}),a(e(be),{"active-key":n.value,"onUpdate:activeKey":p[0]||(p[0]=_=>n.value=_)},{default:o(()=>[a(e(L),{key:"users",tab:"Users"}),a(e(L),{key:"roles",tab:"Roles"})]),_:1},8,["active-key"]),n.value==="users"&&e(h)?(m(),g(we,{key:0,"signup-policy":e(h),onSave:W},null,8,["signup-policy"])):D("",!0),n.value==="users"?(m(),g(Ue,{key:1,loading:e(X),users:e(Y)||[],onCreate:y,onEdit:d,onDelete:ae},null,8,["loading","users"])):D("",!0),n.value==="roles"?(m(),g(Ae,{key:2,loading:e(Z),roles:e(B)||[],onCreate:f,onEdit:s,onDelete:le},null,8,["loading","roles"])):D("",!0),t.value.type==="creatingUser"?(m(),g(Ce,{key:3,"role-options":e(B)||[],onCancel:i,onCreated:ee},null,8,["role-options"])):t.value.type==="editingUser"?(m(),g(ke,{key:4,email:t.value.payload.email,roles:t.value.payload.roles||[],"role-options":e(B)||[],onUpdated:te,onCancel:i},null,8,["email","roles","role-options"])):t.value.type==="creatingRole"?(m(),g(he,{key:5,onCancel:i,onCreated:oe})):t.value.type==="editingRole"?(m(),g(Re,{key:6,name:t.value.payload.name,description:t.value.payload.description,onUpdated:ne,onCancel:i},null,8,["name","description"])):D("",!0)],64))}});export{ot as default};
//# sourceMappingURL=View.7653430b.js.map

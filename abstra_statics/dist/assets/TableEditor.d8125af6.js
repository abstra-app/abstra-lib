import{a as S}from"./asyncComputed.e0f43af3.js";import{d as B,G as z,b as t,c as l,v as e,U as y,X as T,E as D,e as p,y as u,I as C,F as f,K as k,q as x,B as V,V as G,L as $,a3 as H,R as M,N as X,O as J,p as P,r as U,ad as N,w as g,H as Q}from"./registerWidgets.04dc761e.js";import{T as A}from"./tables.1eeef4d2.js";import{L}from"./CircularLoading.78e37a70.js";import{T as W,B as Y,a as E}from"./BackButton.846cedef.js";import{j as K,E as Z,t as j,D as ee,g as te,i as ae}from"./icons.d4e872e2.js";import{D as le}from"./DocsButton.5c9fcb4f.js";import"./activeRecord.57c6bf02.js";const I=n=>(X("data-v-5812aa88"),n=n(),J(),n),ne={class:"table-settings"},se=I(()=>e("label",null,"Name",-1)),oe={class:"table-field"},ue={class:"columns"},de=I(()=>e("label",null,"Columns",-1)),ie=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],pe=["onUpdate:modelValue","disabled"],be=I(()=>e("label",null,"Not null",-1)),me=["onClick"],ve=["onClick"],_e=B({__name:"TableSettings",props:{table:null},setup(n){var s;const r=n,{result:m}=S(()=>A.dbTypes()),w=z();(s=r.table)==null||s.onUpdate(()=>{w.replace({name:"tableEditor",params:{tableName:r.table.name}})});function v(b){confirm(`Are you sure you want to delete column "${b.name}"?`)&&b.delete()}return(b,c)=>(t(),l("div",ne,[se,e("div",oe,[y(e("input",{"onUpdate:modelValue":c[0]||(c[0]=a=>n.table.name=a),class:"table-name"},null,512),[[T,n.table.name]]),e("button",{class:D(["button","save",{disabled:!n.table.hasChanges()}]),onClick:c[1]||(c[1]=a=>n.table.save())},[p(C,{path:u(K)},null,8,["path"])],2)]),e("div",ue,[de,(t(!0),l(f,null,k(n.table.columns,a=>(t(),l("div",{key:a.id,class:"column"},[a.primaryKey?(t(),x(C,{key:0,class:"column-primary-key",path:u(Z)},null,8,["path"])):V("",!0),u(m)?y((t(),l("select",{key:1,"onUpdate:modelValue":d=>a.type=d,class:"column-type"},[(t(!0),l(f,null,k(u(m),d=>(t(),l("option",{key:d.type},$(d.type),1))),128))],8,ie)),[[G,a.type]]):V("",!0),y(e("input",{"onUpdate:modelValue":d=>a.name=d,class:"column-name",placeholder:"Column name"},null,8,re),[[T,a.name]]),y(e("input",{"onUpdate:modelValue":d=>a.default=d,class:"column-default",placeholder:"Default value"},null,8,ce),[[T,a.default]]),y(e("input",{"onUpdate:modelValue":d=>a.notNull=d,type:"checkbox",disabled:!a.default},null,8,pe),[[H,a.notNull]]),be,a.primaryKey?V("",!0):(t(),l("button",{key:2,class:"button delete",onClick:d=>v(a)},[p(C,{path:u(j)},null,8,["path"])],8,me)),e("button",{class:D(["button","save",{disabled:!a.hasChanges()}]),onClick:d=>a.save()},[p(C,{path:u(K)},null,8,["path"])],10,ve)]))),128)),e("button",{class:"button add",onClick:c[2]||(c[2]=a=>n.table.createColumn())},[p(C,{path:u(ee)},null,8,["path"]),M(" Add Column ")])])]))}});const he=P(_e,[["__scopeId","data-v-5812aa88"]]),ye={class:"table-data"},fe={class:"column-header"},ke={class:"column-name"},we=e("th",null,null,-1),Ce={key:1},ge=["open"],$e={key:0,class:"editing-row-content"},Ve={class:"editing-row-header"},Re=["onUpdate:modelValue"],Te={key:0,class:"row-error"},xe=B({__name:"TableData",props:{table:null},setup(n){const r=n,{result:m,loading:w,refetch:v}=S(()=>r.table.select()),s=U(null),b=U(null),c=U(null);function a(){!r.table||(s.value={},c.value=null,b.value=null)}function d(i){return Object.keys(i).reduce((R,o)=>{var _;return(_=r.table.columns.find(h=>h.name===o))!=null&&_.primaryKey?{[o]:i[o]}:R},{})}async function F(){if(!(!r.table||!s.value))if(c.value){const i=await r.table.updateRow(d(c.value),s.value);i.type==="update-row:error"?b.value=i.reason:(s.value=null,c.value=null,b.value=null,v())}else{const i=await r.table.insertRow(s.value);i.type==="insert-row:error"?b.value=i.reason:(s.value=null,c.value=null,b.value=null,v())}}function O(i){!r.table||(s.value={...i},c.value={...i},b.value=null)}async function q(i){confirm("Are you sure you want to delete this row?")&&(await r.table.deleteRow(d(i)),v())}return(i,R)=>(t(),l("div",ye,[e("button",{class:"add-row",onClick:a},"Add Row"),e("table",null,[e("thead",null,[e("tr",null,[(t(!0),l(f,null,k(n.table.columns,o=>(t(),l("th",{key:o.id},[e("div",fe,[e("div",ke,$(o.name),1)])]))),128)),we])]),u(w)?(t(),x(L,{key:0})):(t(),l("tbody",Ce,[(t(!0),l(f,null,k(u(m),(o,_)=>(t(),l("tr",{key:_},[(t(!0),l(f,null,k(n.table.columns,h=>(t(),l("td",{key:h.id},$(o[h.name]),1))),128)),e("td",null,[p(N,{class:"delete-row",path:u(j),onClick:h=>q(o)},null,8,["path","onClick"]),p(N,{class:"edit-row",path:u(te),onClick:h=>O(o)},null,8,["path","onClick"])])]))),128))]))]),e("dialog",{class:"editing-row-container",open:!!s.value},[s.value?(t(),l("div",$e,[e("div",Ve,[M(" New Row "),p(N,{path:u(ae),class:"close",onClick:R[0]||(R[0]=o=>s.value=null)},null,8,["path"])]),(t(!0),l(f,null,k(n.table.columns,o=>(t(),l("div",{key:o.id,class:"column"},[e("label",null,$(o.name),1),y(e("input",{"onUpdate:modelValue":_=>s.value[o.name]=_,type:"text"},null,8,Re),[[T,s.value[o.name]]])]))),128)),e("button",{class:"button save",onClick:F},"Save"),b.value?(t(),l("div",Te,$(b.value),1)):V("",!0)])):V("",!0)],8,ge)]))}});const Me=B({__name:"TableEditor",setup(n){const r=Q(),{result:m,loading:w}=S(()=>A.get(r.params.tableName));return(v,s)=>u(w)||!u(m)?(t(),x(L,{key:0})):(t(),x(W,{key:1,class:"editor"},{left:g(()=>[p(Y,{link:"/_editor/tables"})]),right:g(()=>[p(le,{path:"tables"})]),default:g(()=>[p(E,{title:"Table data"},{default:g(()=>[p(xe,{table:u(m)},null,8,["table"])]),_:1}),p(E,{title:"Settings"},{default:g(()=>[p(he,{table:u(m)},null,8,["table"])]),_:1})]),_:1}))}});export{Me as default};
//# sourceMappingURL=TableEditor.d8125af6.js.map

import{a as S}from"./asyncComputed.8fa1d416.js";import{d as B,H as q,b as e,c as n,x as t,W as h,Z as x,F as k,L as w,t as I,z as d,I as R,D as T,X as z,N as $,a3 as H,e as m,U as M,O as J,Q as K,q as Q,r as D,ad as U,w as C,J as W}from"./registerWidgets.9796e1ef.js";import{T as A}from"./tables.0d9ad853.js";import{L}from"./CircularLoading.c1af5350.js";import{T as X,a as E}from"./Tab.553fd73e.js";import{B as Z}from"./BackButton.3f2a1bf1.js";import{D as G,r as F,C as P,g as Y,i as ee}from"./icons.ef8111c1.js";import{D as te}from"./DocsButton.b0c09551.js";import{S as ae}from"./SaveButton.f25db7ad.js";import"./activeRecord.c82d3135.js";import"./pubsub.b7af8716.js";import"./lottie.5511c17b.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[o]="e436f8e9-8e8d-4334-beba-f1dac4b2f8ea",a._sentryDebugIdIdentifier="sentry-dbid-e436f8e9-8e8d-4334-beba-f1dac4b2f8ea")}catch{}})();const N=a=>(J("data-v-36a6e10a"),a=a(),K(),a),le={class:"table-settings"},ne=N(()=>t("label",null,"Name",-1)),oe={class:"table-field"},se={class:"columns"},ue=N(()=>t("label",null,"Columns",-1)),de=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ie=["onUpdate:modelValue"],ce=["onUpdate:modelValue","disabled"],pe=N(()=>t("label",null,"Not null",-1)),me=["onClick"],be=B({__name:"TableSettings",props:{table:null},setup(a){var b;const o=a,{result:c}=S(()=>A.dbTypes()),g=q();(b=o.table)==null||b.onUpdate(()=>{g.replace({name:"tableEditor",params:{tableName:o.table.name}})});function f(p){confirm(`Are you sure you want to delete column "${p}"?`)&&o.table.deleteColumn(p)}function u(){if(!c.value)return;const p=c.value[0].type,_=prompt("Enter column name");!_||o.table.addColumn(_,p)}return(p,_)=>(e(),n("div",le,[ne,t("div",oe,[h(t("input",{"onUpdate:modelValue":_[0]||(_[0]=l=>a.table.name=l),class:"table-name"},null,512),[[x,a.table.name]])]),t("div",se,[ue,(e(!0),n(k,null,w(a.table.getColumns(),l=>(e(),n("div",{key:l.id,class:"column"},[l.primary_key?(e(),I(R,{key:0,class:"column-primary-key",path:d(G)},null,8,["path"])):T("",!0),d(c)?h((e(),n("select",{key:1,"onUpdate:modelValue":i=>l.type=i,class:"column-type"},[(e(!0),n(k,null,w(d(c),i=>(e(),n("option",{key:i.type},$(i.type),1))),128))],8,de)),[[z,l.type]]):T("",!0),h(t("input",{"onUpdate:modelValue":i=>l.name=i,class:"column-name",placeholder:"Column name"},null,8,re),[[x,l.name]]),h(t("input",{"onUpdate:modelValue":i=>l.default=i,class:"column-default",placeholder:"Default value"},null,8,ie),[[x,l.default]]),h(t("input",{"onUpdate:modelValue":i=>l.not_null=i,type:"checkbox",disabled:!l.default},null,8,ce),[[H,l.not_null]]),pe,l.primary_key?T("",!0):(e(),n("button",{key:2,class:"button delete",onClick:i=>f(l.name)},[m(R,{path:d(F)},null,8,["path"])],8,me))]))),128)),t("button",{class:"button add",onClick:_[1]||(_[1]=l=>u())},[m(R,{path:d(P)},null,8,["path"]),M(" Add Column")])])]))}});const _e=Q(be,[["__scopeId","data-v-36a6e10a"]]),fe={class:"table-data"},ve={class:"column-header"},ye={class:"column-name"},he=t("th",null,null,-1),ke={key:1},we=["open"],ge={key:0,class:"editing-row-content"},Ce={class:"editing-row-header"},$e=["onUpdate:modelValue"],Te={key:0,class:"row-error"},Ve=B({__name:"TableData",props:{table:null},setup(a){const o=a,{result:c,loading:g,refetch:f}=S(()=>o.table.select()),u=D(null),b=D(null),p=D(null);function _(){!o.table||(u.value={},p.value=null,b.value=null)}function l(r){return Object.keys(r).reduce((V,s)=>{var v;return(v=o.table.getColumns().find(y=>y.name===s))!=null&&v.primary_key?{[s]:r[s]}:V},{})}async function i(){if(!(!o.table||!u.value))if(p.value){const r=await o.table.updateRow(l(p.value),u.value);r.type==="update-row:error"?b.value=r.reason:(u.value=null,p.value=null,b.value=null,f())}else{const r=await o.table.insertRow(u.value);r.type==="insert-row:error"?b.value=r.reason:(u.value=null,p.value=null,b.value=null,f())}}function O(r){!o.table||(u.value={...r},p.value={...r},b.value=null)}async function j(r){confirm("Are you sure you want to delete this row?")&&(await o.table.deleteRow(l(r)),f())}return(r,V)=>(e(),n("div",fe,[t("button",{class:"add-row",onClick:_},"Add Row"),t("table",null,[t("thead",null,[t("tr",null,[(e(!0),n(k,null,w(a.table.getColumns(),s=>(e(),n("th",{key:s.id},[t("div",ve,[t("div",ye,$(s.name),1)])]))),128)),he])]),d(g)?(e(),I(L,{key:0})):(e(),n("tbody",ke,[(e(!0),n(k,null,w(d(c),(s,v)=>(e(),n("tr",{key:v},[(e(!0),n(k,null,w(a.table.getColumns(),y=>(e(),n("td",{key:y.id},$(s[y.name]),1))),128)),t("td",null,[m(U,{class:"delete-row",path:d(F),onClick:y=>j(s)},null,8,["path","onClick"]),m(U,{class:"edit-row",path:d(Y),onClick:y=>O(s)},null,8,["path","onClick"])])]))),128))]))]),t("dialog",{class:"editing-row-container",open:!!u.value},[u.value?(e(),n("div",ge,[t("div",Ce,[M(" New Row "),m(U,{path:d(ee),class:"close",onClick:V[0]||(V[0]=s=>u.value=null)},null,8,["path"])]),(e(!0),n(k,null,w(a.table.getColumns(),s=>(e(),n("div",{key:s.id,class:"column"},[t("label",null,$(s.name),1),h(t("input",{"onUpdate:modelValue":v=>u.value[s.name]=v,type:"text"},null,8,$e),[[x,u.value[s.name]]])]))),128)),t("button",{class:"button save",onClick:i},"Save"),b.value?(e(),n("div",Te,$(b.value),1)):T("",!0)])):T("",!0)],8,we)]))}});const Fe=B({__name:"TableEditor",setup(a){const o=W(),{result:c,loading:g}=S(()=>A.get(o.params.tableName));return(f,u)=>d(g)||!d(c)?(e(),I(L,{key:0})):(e(),I(X,{key:1,class:"editor"},{left:C(()=>[m(Z,{link:"/_editor/tables"})]),right:C(()=>[m(te,{path:"tables/overview"}),m(ae,{model:d(c)},null,8,["model"])]),default:C(()=>[m(E,{title:"Table data"},{default:C(()=>[m(Ve,{table:d(c)},null,8,["table"])]),_:1}),m(E,{title:"Settings"},{default:C(()=>[m(_e,{table:d(c)},null,8,["table"])]),_:1})]),_:1}))}});export{Fe as default};
//# sourceMappingURL=TableEditor.5966cc1f.js.map

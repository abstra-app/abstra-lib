var w=Object.defineProperty;var y=(r,e,t)=>e in r?w(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>(y(r,typeof e!="symbol"?e+"":e,t),t);import{C as I}from"./CrudView.408a4461.js";import{e as l,f as p,ej as E,ep as C,d as T,ea as x,eo as k,o as b,Y as z,b as s,u as a,w as c,aS as _,c as A,cz as g,cS as O,aB as R,dh as S,S as V,cL as D}from"./index.0f630b70.js";import{a as M}from"./gateway.50cd3949.js";import{M as P}from"./member.60d3de62.js";import"./tables.78c50568.js";import{a as v}from"./ant-design.7d916c63.js";import{T as B,G as j}from"./tagColorProvider.3e96974a.js";import"./router.0f31f3f1.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.bf268869.js";import"./BookOutlined.89f2a8c6.js";import"./url.90c69b58.js";import"./PhDotsThreeVertical.vue.e2e73559.js";import"./Badge.ada44968.js";import"./index.1eaf0cd2.js";import"./popupNotifcation.dd76a56c.js";import"./record.f729e500.js";import"./string.532e13bb.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="170e3ac2-bb8c-4f30-b44f-c1138c5f64c1",r._sentryDebugIdIdentifier="sentry-dbid-170e3ac2-bb8c-4f30-b44f-c1138c5f64c1")}catch{}})();const F=[{key:"email",label:"Email"}],L=[{label:"Admin",value:"admin"},{label:"Editor",value:"editor"}],N={admin:"Has full access to the organization, projects and editors",editor:"Can only manage projects within their teams"};class G{constructor({authorEmail:e,organizationId:t,api:n,handlers:m}){i(this,"members",l([]));i(this,"teamOptions",l([]));i(this,"selectedMember",l(null));i(this,"draftMember",l(null));i(this,"createButtonText",p(()=>{var e;return((e=this.currentMember.value)==null?void 0:e.role)==="editor"?void 0:"Invite Editor"}));i(this,"table");i(this,"loading",l(!1));i(this,"authorEmail");i(this,"organizationId");i(this,"api");i(this,"handlers");i(this,"currentMember",l(null));i(this,"teamColorProvider",new B);i(this,"addMember",async e=>{await this.api.create({organizationId:this.organizationId,email:e.email}),await this.fetchMembers()});i(this,"openEditMemberModal",e=>{this.draftMember.value=E.exports.cloneDeep(e),this.selectedMember.value=e,this.fetchTeamOptions()});i(this,"commitEditMember",async()=>{var e,t;this.loading.value=!0,this.draftMember.value&&(await this.api.update(this.organizationId,this.draftMember.value.authorId,{role:(e=this.draftMember.value)==null?void 0:e.role,teams:(t=this.draftMember.value)==null?void 0:t.teams}),await this.fetchInitialState(),this.draftMember.value=null,this.selectedMember.value=null,this.loading.value=!1)});i(this,"cancelEditMember",()=>{this.draftMember.value=null,this.selectedMember.value=null});this.authorEmail=e,this.organizationId=t,this.api=n,this.handlers=m,this.table=p(()=>this.makeCrudViewTable())}async fetchInitialState(){await this.fetchMembers(),this.setCurrentMember()}setCurrentMember(){var e;this.currentMember.value=(e=this.members.value.find(t=>t.email===this.authorEmail))!=null?e:null}async fetchMembers(){this.members.value=await this.api.list(this.organizationId)}async fetchTeamOptions(){const e=await this.api.fetchTeamOptions(this.organizationId);this.teamOptions.value=e.map(t=>({label:t,value:t}))}async removeMember(e){var n;if(((n=M.getAuthor())==null?void 0:n.claims.email)===e.email){await v("Removing your own access will block you from this organization. Are you sure?",{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),this.handlers.onSelfRemove());return}await v(`Are you sure you want to remove ${e.email} access?`,{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),await this.fetchMembers())}makeCrudViewActions(e){var t;return((t=this.currentMember.value)==null?void 0:t.role)==="editor"?[]:[{icon:j,label:"Edit Permissions",onClick:()=>this.openEditMemberModal(e)},{icon:C,label:"Remove access",onClick:()=>this.removeMember(e),dangerous:!0}]}getTeamTags(e){const t=e.teams.map(n=>({text:n,color:this.teamColorProvider.getColor(n)}));return e.role==="admin"&&t.unshift({text:"Admin",color:"red"}),t}makeColumns(){var e;return((e=this.currentMember.value)==null?void 0:e.role)==="editor"?[{title:"Email",align:"center"},{title:"Teams",align:"center"}]:[{title:"Email",align:"center"},{title:"Teams",align:"center"},{title:"",align:"right"}]}makeCrudViewTable(){return{columns:this.makeColumns(),rows:this.members.value.map(e=>({key:e.email,cells:[{type:"text",text:e.email},{type:"tags",tags:this.getTeamTags(e)},{type:"actions",actions:this.makeCrudViewActions(e)}]}))}}}const se=T({__name:"EditorsView",setup(r){var f;const e=x(),t=k(),n=e.params.organizationId,m=new P,h=(f=M.getAuthor())==null?void 0:f.claims.email;if(!h)throw new Error("Author email is not available");const o=new G({organizationId:n,api:m,authorEmail:h,handlers:{onSelfRemove:()=>{t.push("organizations")}}});return o.fetchInitialState(),(U,d)=>(b(),z(_,null,[s(I,{"entity-name":"editors",loading:a(o).loading.value,title:"Organization Editors",description:"Manage the editors and their permissions for this organization.","empty-title":"No editors yet",table:a(o).table.value,"create-button-text":a(o).createButtonText.value,fields:a(F),create:a(o).addMember},null,8,["loading","table","create-button-text","fields","create"]),s(a(D),{open:!!a(o).draftMember.value,title:"Editor Permissions","ok-text":"Apply","cancel-text":"Cancel","confirm-loading":a(o).loading.value,onOk:a(o).commitEditMember,onCancel:a(o).cancelEditMember},{default:c(()=>[a(o).draftMember.value?(b(),A(a(S),{key:0,vertical:"",justify:"center",gap:"0",style:{padding:"15px 0px 0px 0px"}},{default:c(()=>[s(a(g),{colon:!1,label:"Role",help:a(N)[a(o).draftMember.value.role]},{default:c(()=>[s(a(O),{value:a(o).draftMember.value.role,"onUpdate:value":d[0]||(d[0]=u=>a(o).draftMember.value.role=u),options:a(L)},null,8,["value","options"])]),_:1},8,["help"]),s(a(g),{colon:!1,label:"Teams",tooltip:"Editor will have access to projects within these teams"},{default:c(()=>[s(a(R),{value:a(o).draftMember.value.teams,"onUpdate:value":d[1]||(d[1]=u=>a(o).draftMember.value.teams=u),options:a(o).teamOptions.value,mode:"tags",placeholder:"Select or type new team name"},null,8,["value","options"])]),_:1})]),_:1})):V("",!0)]),_:1},8,["open","confirm-loading","onOk","onCancel"])],64))}});export{se as default};
//# sourceMappingURL=EditorsView.1150ab07.js.map

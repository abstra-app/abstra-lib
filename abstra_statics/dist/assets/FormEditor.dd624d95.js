import{F as ae,r as z,R as re}from"./FormRunner.8c0d0f71.js";import{f as a,eG as oe,d as O,r as A,G as P,b as f,c as b,w as r,aq as m,eD as le,u as e,bO as R,cy as ne,ev as I,eC as se,cC as ue,bH as h,bq as G,F as ie,H,eA as W,a as de,ex as T,bg as ce,v as pe,bI as E,eB as me,eJ as fe,e as N}from"./outputWidgets.7bf30641.js";import{R as ve,S as ge,a as ye,L as be}from"./SourceCode.ec93db69.js";import{B as he}from"./BaseLayout.b24bc90f.js";import{a as Y}from"./asyncComputed.cf41ff13.js";import{F as _e}from"./forms.80f9d79c.js";import{W as J}from"./workspaces.cd9dd466.js";import{l as Q,N as ke}from"./NavbarControls.99275b88.js";import{r as we}from"./icons.0dd46489.js";import{a as Se}from"./Text.85465eb9.js";import{A as y}from"./FormItem.e2824bfb.js";import{A as B}from"./index.ae5e0684.js";import{M as Pe,a as $}from"./Title.c96c9fa7.js";import{A as xe}from"./index.e3ede662.js";import{F as K}from"./Form.b21cc552.js";import{_ as Ce}from"./SaveButton.vue_vue_type_script_setup_true_lang.e5e0cbb9.js";import{A as j,T as Re}from"./TabPane.3daa7032.js";import"./index.3d31b05f.js";import{E as Ae}from"./ExpandOutlined.b74228b1.js";import{c as Fe}from"./index.6734c8d7.js";import"./url.fb476188.js";import"./index.09993339.js";import"./pubsub.a4e44688.js";import"./CircularLoading.9152615d.js";import"./PlayerNavbar.20995956.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.ecb52a16.js";import"./WidgetsFrame.e2f36696.js";import"./uuid.bed1e96a.js";import"./validations.3a482a06.js";import"./record.476a0b13.js";import"./string.576e6875.js";import"./toggleHighContrast.d0cc24eb.js";import"./popupNotifcation.9127857b.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.2e64fa00.js";import"./index.7d2d6618.js";import"./Link.c33ff4f4.js";import"./hasIn.8de9ce1e.js";import"./ant-design.a887cdff.js";import"./index.11ada48b.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[n]="224d80d6-1d10-4dec-a59f-b15772b2fd68",i._sentryDebugIdIdentifier="sentry-dbid-224d80d6-1d10-4dec-a59f-b15772b2fd68")}catch{}})();var Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const Te=Le;function V(i){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},l=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),l.forEach(function(o){$e(i,o,t[o])})}return i}function $e(i,n,t){return n in i?Object.defineProperty(i,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[n]=t,i}var M=function(n,t){var l=V({},n,t.attrs);return a(oe,V({},l,{icon:Te}),null)};M.displayName="LinkOutlined";M.inheritAttrs=!1;const Be=M,Oe=O({__name:"LaunchButton",props:{path:{}},setup(i){const n=i,t=A({state:"loading"}),l=P(()=>t.value.state!=="found"),o=P(()=>t.value.state==="loading"),s=P(()=>t.value.state==="found"?t.value.url:void 0),d=P(()=>{switch(t.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${t.value}`)}}),F=P(()=>{switch(t.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${t.value}`)}});async function c(_){const v=`https://${_}.abstra.app/_version`;return(await fetch(v)).ok}async function L(_){const v=`https://${_}.abstra.app/_pages/${n.path}`;return(await fetch(v)).ok}async function x(){if(!(await Q.get()).logged){t.value={state:"not-logged"};return}const v=await Q.getProjectInfo().catch(()=>null);if(!v){t.value={state:"error"};return}if(!await c(v.subdomain).catch(()=>null)){t.value={state:"not-deployed"};return}if(!await L(v.subdomain).catch(()=>null)){t.value={state:"not-found"};return}const S=`https://${v.subdomain}.abstra.app/${n.path}`;t.value={state:"found",url:S}}return x(),(_,v)=>(f(),b(e(ne),{title:d.value},{content:r(()=>[m(le(F.value),1)]),default:r(()=>[a(e(R),{href:s.value,target:"_blank",disabled:l.value,loading:o.value,size:"small",type:"link"},{icon:r(()=>[a(e(Be))]),default:r(()=>[m(" Open Deployed ")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),De="abstra-run-id",Ue=O({__name:"QueryParamsModal",props:{open:{type:Boolean},close:{type:Function},state:{},addQueryParam:{type:Function},removeQueryParam:{type:Function}},setup(i){return(n,t)=>(f(),b(e(Pe),{open:n.open,onCancel:n.close},{footer:r(()=>[a(e(R),{type:"primary",onClick:n.close},{default:r(()=>[m("OK")]),_:1},8,["onClick"])]),default:r(()=>[a(e(B),{vertical:"",gap:"20"},{default:r(()=>[a(e(Se),null,{default:r(()=>[m("Query params")]),_:1}),(f(!0),I(G,null,se(n.state.queryParams,(l,o)=>(f(),b(e(y),{key:o},{default:r(()=>[a(e(ue),null,{default:r(()=>[a(e(h),{value:l.name,"onUpdate:value":s=>l.name=s,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),a(e(h),{value:l.value,"onUpdate:value":s=>l.value=s,type:"text",placeholder:"value",disabled:l.name===De},null,8,["value","onUpdate:value","disabled"]),a(e(R),{danger:"",onClick:s=>n.removeQueryParam(o)},{default:r(()=>[m("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(e(y),null,{default:r(()=>[a(e(R),{type:"dashed",style:{width:"100%"},onClick:n.addQueryParam},{default:r(()=>[m(" Add Query Param ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["open","onCancel"]))}}),Ie={key:2,class:"form-preview-container"},U="abstra-run-id",Me=O({__name:"FormTester",props:{form:{},logService:{},broker:{}},emits:["redirect"],setup(i,{expose:n,emit:t}){const l=i,o=A(!1),s=()=>{o.value=!0},d=()=>{o.value=!1},F=P(()=>`/${l.form.path}?${Z.value.query}`),c=ie({queryParams:[{name:"foo",value:"bar"}],url:`${l.form.path}`,stageRunId:null}),L=u=>{c.stageRunId=u},{result:x,loading:_}=Y(()=>J.get()),v=()=>{c.queryParams.push({name:"",value:""})},p=u=>{c.queryParams=c.queryParams.filter((C,g)=>g!==u)};H([()=>c.stageRunId,()=>c.queryParams],([u,C])=>{const g=C.find(w=>w.name===U);if(u&&!g){c.queryParams.push({name:U,value:u});return}if(!u&&g){c.queryParams=c.queryParams.filter(w=>w.name!==U);return}u&&g&&u!==g.value&&(g.value=u)}),l.broker.on("stdout",u=>{l.logService.log({type:"stdout",log:u.log})}),l.broker.on("stderr",u=>{l.logService.log({type:"stderr",log:u.log})}),l.broker.onClose(()=>{l.logService.log({type:"stderr",log:"Program closed"})}),l.broker.on("files:changed",()=>{l.logService.log({type:"files-changed",log:"Files changed"})});const k=W(),S=({path:u})=>{z("editor",k,u)};function X(u,C){t("redirect",u,C)}const q=A(null);async function D(){var u;return l.logService.log({type:"restart"}),(u=q.value)==null?void 0:u.run()}const Z=P(()=>{const u=new URLSearchParams(c.queryParams.filter(g=>g.name.trim()).reduce((g,w)=>({...g,[w.name]:w.value}),{})).toString();return{subdomain:"[your-subdomain]",path:l.form.path,query:u}});return n({restart:D}),(u,C)=>{const g=de("icon");return f(),I(G,null,[a(e(K),{layout:"vertical"},{default:r(()=>[T("",!0),a(e(B),{gap:"small"},{default:r(()=>[a(e(R),{onClick:D},{default:r(()=>[a(g,{path:e(we),width:"20"},null,8,["path"])]),_:1}),a(e(h),{value:F.value,onClick:s},null,8,["value"])]),_:1}),e(_)||!e(x)?(f(),b(e(ce),{key:1})):c.stageRunId||l.form.isInitial?(f(),I("div",Ie,[a(ae,{ref_key:"runner",ref:q,form:u.form.makeRunnerData(e(x)),params:{...c.queryParams.reduce((w,{name:ee,value:te})=>({...w,[ee]:te}),{})},"is-preview":"","enable-auto-focus":"",broker:u.broker,onNavigate:S,onRedirect:X,onLogout:D},null,8,["form","params","broker"])])):(f(),b(e(xe),{key:3,message:"This form is an intermediate task within the workflow. Please select a thread to initiate the form.",type:"warning","show-icon":""}))]),_:1}),a(Ue,{open:o.value,close:d,state:c,"add-query-param":v,"remove-query-param":p},null,8,["open","state"])],64)}}});const qe=pe(Me,[["__scopeId","data-v-a9007866"]]),Ee=O({__name:"FormSettings",props:{form:{}},setup(i){const t=A(i.form);return(l,o)=>(f(),b(e(K),{layout:"vertical"},{default:r(()=>[a(ve,{runtime:t.value},null,8,["runtime"]),a(e(y),{label:"Form name"},{default:r(()=>[a(e(h),{value:t.value.title,"onUpdate:value":o[0]||(o[0]=s=>t.value.title=s),type:"text",onChange:o[1]||(o[1]=s=>{var d;return t.value.title=(d=s.target.value)!=null?d:""})},null,8,["value"])]),_:1}),a(e($),{level:3},{default:r(()=>[m(" Texts ")]),_:1}),a(e($),{level:4},{default:r(()=>[m(" Welcome Screen ")]),_:1}),a(e(y),{label:"Title"},{default:r(()=>[a(e(h),{value:t.value.welcomeTitle,"onUpdate:value":o[2]||(o[2]=s=>t.value.welcomeTitle=s),type:"text",placeholder:t.value.title,disabled:t.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),a(e(y),{label:"Description"},{default:r(()=>[a(e(h),{value:t.value.startMessage,"onUpdate:value":o[3]||(o[3]=s=>t.value.startMessage=s),type:"text",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(y),{label:"Start button label"},{default:r(()=>[a(e(h),{value:t.value.startButtonText,"onUpdate:value":o[4]||(o[4]=s=>t.value.startButtonText=s),type:"text",placeholder:"Start",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(y),null,{default:r(()=>[a(e(E),{checked:t.value.autoStart,"onUpdate:checked":o[5]||(o[5]=s=>t.value.autoStart=s)},{default:r(()=>[m("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),a(e($),{level:4},{default:r(()=>[m(" End Screen ")]),_:1}),a(e(y),{label:"End text"},{default:r(()=>[a(e(h),{value:t.value.endMessage,"onUpdate:value":o[6]||(o[6]=s=>t.value.endMessage=s),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),a(e(y),{label:"Restart button label"},{default:r(()=>[a(e(h),{value:t.value.restartButtonText,"onUpdate:value":o[7]||(o[7]=s=>t.value.restartButtonText=s),placeholder:"Restart",type:"text",disabled:!t.value.allowRestart},null,8,["value","disabled"])]),_:1}),a(e(y),null,{default:r(()=>[a(e(E),{checked:t.value.allowRestart,"onUpdate:checked":o[8]||(o[8]=s=>t.value.allowRestart=s)},{default:r(()=>[m("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),a(e($),{level:4},{default:r(()=>[m(" Alert Messages ")]),_:1}),a(e(y),{label:"Error message"},{default:r(()=>[a(e(h),{value:t.value.errorMessage,"onUpdate:value":o[9]||(o[9]=s=>t.value.errorMessage=s),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),Ne={style:{width:"50%"}},Qe={style:{width:"50%"}},At=O({__name:"FormEditor",setup(i){const n=W(),t=me(),l=A(null),o=A("source-code");function s(){n.push({name:"home"})}const{result:d,refetch:F}=Y(()=>Promise.all([J.get(),_e.get(t.params.id)]).then(([p,k])=>fe({workspace:p,form:k}))),c=p=>{!d.value||(d.value.form.file=p)},L=be.create(),x=P(()=>re.create(t.params.id));function _(p,k){z("editor",n,p,k)}const v=()=>{var p;n.push({name:"formPreview",query:t.query,params:{id:(p=d.value)==null?void 0:p.form.id}})};return H(()=>t.params.id,()=>{F()}),(p,k)=>(f(),b(he,null,{navbar:r(()=>[e(d)?(f(),b(e(Fe),{key:0,title:e(d).form.title,style:{padding:"5px 25px"},onBack:s},{extra:r(()=>[a(ke,{"docs-path":"forms/overview","show-v-s-code-button":"","show-save-button":!1,"editing-model":e(d).form},null,8,["editing-model"])]),_:1},8,["title"])):T("",!0)]),content:r(()=>[e(d)?(f(),b(e(B),{key:0,gap:"40",style:{width:"calc(100% - 80px)"}},{default:r(()=>[N("div",Ne,[a(e(Re),{"active-key":o.value,"onUpdate:activeKey":k[0]||(k[0]=S=>o.value=S)},{rightExtra:r(()=>[a(Ce,{model:e(d).form},null,8,["model"])]),default:r(()=>[a(e(j),{key:"source-code",tab:"Source code"}),a(e(j),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"]),o.value==="source-code"?(f(),b(ge,{key:0,script:e(d).form,workspace:e(d).workspace,broker:x.value,onUpdateFile:c},null,8,["script","workspace","broker"])):T("",!0),o.value==="settings"?(f(),b(Ee,{key:1,form:e(d).form},null,8,["form"])):T("",!0)]),N("div",Qe,[a(e(B),{justify:"space-between"},{default:r(()=>[a(e($),{level:4,style:{margin:"10px 0 24px 0"}},{default:r(()=>[m("Form preview")]),_:1}),a(e(B),{gap:"8",align:"center",style:{height:"fit-content","margin-top":"10px"}},{default:r(()=>[a(Oe,{path:e(d).form.path},null,8,["path"]),a(e(R),{target:"_blank",onClick:v},{icon:r(()=>[a(e(Ae))]),default:r(()=>[m(" Preview ")]),_:1})]),_:1})]),_:1}),a(qe,{ref_key:"tester",ref:l,form:e(d).form,"log-service":e(L),broker:x.value,onRedirect:_},null,8,["form","log-service","broker"])])]),_:1})):T("",!0)]),footer:r(()=>{var S;return[a(ye,{runtime:"forms","log-service":e(L),onRestart:(S=l.value)==null?void 0:S.restart},null,8,["log-service","onRestart"])]}),_:1}))}});export{At as default};
//# sourceMappingURL=FormEditor.dd624d95.js.map

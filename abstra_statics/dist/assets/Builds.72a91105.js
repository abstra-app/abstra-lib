import{r as q}from"./router.c5eb5658.js";import{f as s,eG as k,f9 as Y,fa as G,d as V,eA as Q,b as d,c as p,w as c,u as a,bE as J,bh as W,bf as X,e as Z,I as C,ar as g,cE as w,eD as b,ex as v,ev as T,cm as K,eB as ee,o as te,L as ne,r as re,H as ae,aD as le,eP as oe,aH as ie,cA as ue,ew as se,bg as ce,v as de}from"./outputWidgets.c8053a9d.js";import{a as $}from"./asyncComputed.f7e207a4.js";import{B as pe,a as fe}from"./build.f2927bf7.js";import"./index.7b750cfc.js";import{P as me}from"./project.9955b3f2.js";import{C as ge}from"./CrudView.81651cd0.js";import{V as R,l as be,f as ye,j as he,h as ve,R as Oe,Y as _e}from"./icons.9e4059c8.js";import{A as h}from"./Text.d464b589.js";import{a as Ce,A as ke}from"./index.95f22817.js";import{g as xe}from"./datetime.07733c55.js";import{A as we}from"./Paragraph.68b1de18.js";import{C as Se}from"./CloseCircleOutlined.9eb44b59.js";import{L as S}from"./LoadingOutlined.3a35deda.js";import{A as Pe}from"./index.b514db2b.js";import{M as Ie}from"./Modal.63744d77.js";import"./Form.034d9295.js";import"./hasIn.7ae70fa0.js";import"./popupNotifcation.b87aeac6.js";import"./index.cf4c23b9.js";import"./record.c60a7475.js";import"./pubsub.231a79a7.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.f912e8a7.js";import"./url.d8c088a2.js";import"./index.5905e3dd.js";import"./Title.ed86be86.js";import"./Base.d9fc6eef.js";import"./Typography.e5f51e32.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="b97ea3b1-2ce0-4029-a2b9-0486d318fc22",r._sentryDebugIdIdentifier="sentry-dbid-b97ea3b1-2ce0-4029-a2b9-0486d318fc22")}catch{}})();var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const Ae=je;var De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z"}}]},name:"pause-circle",theme:"outlined"};const Me=De;function E(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),i.forEach(function(l){Be(r,l,t[l])})}return r}function Be(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var P=function(e,t){var i=E({},e,t.attrs);return s(k,E({},i,{icon:Y}),null)};P.displayName="CheckCircleOutlined";P.inheritAttrs=!1;const $e=P;function z(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),i.forEach(function(l){Ee(r,l,t[l])})}return r}function Ee(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var I=function(e,t){var i=z({},e,t.attrs);return s(k,z({},i,{icon:G}),null)};I.displayName="ExclamationCircleOutlined";I.inheritAttrs=!1;const ze=I;function L(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),i.forEach(function(l){Le(r,l,t[l])})}return r}function Le(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var j=function(e,t){var i=L({},e,t.attrs);return s(k,L({},i,{icon:Ae}),null)};j.displayName="MinusCircleOutlined";j.inheritAttrs=!1;const Ne=j;function N(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),i.forEach(function(l){Ve(r,l,t[l])})}return r}function Ve(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var A=function(e,t){var i=N({},e,t.attrs);return s(k,N({},i,{icon:Me}),null)};A.displayName="PauseCircleOutlined";A.inheritAttrs=!1;const Te=A,Re={style:{display:"flex","align-items":"center",gap:"5px"}},Fe={key:1},He=V({__name:"BuildInspector",props:{buildSpec:{}},setup(r){const e=r,t=Q(),i=l=>{t.push({name:"logs",params:{projectId:e.buildSpec.projectId},query:l.logQuery})};return(l,D)=>l.buildSpec.runtimes.length>0?(d(),p(a(ke),{key:0,"item-layout":"horizontal","data-source":l.buildSpec.runtimes},{renderItem:c(({item:f})=>[s(a(Ce),null,{actions:c(()=>[s(a(J),null,{overlay:c(()=>[s(a(W),null,{default:c(()=>[s(a(X),{onClick:y=>i(f)},{default:c(()=>[Z("div",Re,[s(C,{path:a(R)},null,8,["path"]),s(a(h),null,{default:c(()=>[g(" View Logs")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1024)]),default:c(()=>[s(C,{path:a(be),style:{cursor:"pointer"}},null,8,["path"])]),_:2},1024)]),default:c(()=>[f.type=="form"?(d(),p(a(w),{key:0,size:"large"},{default:c(()=>[s(C,{path:a(ye)},null,8,["path"]),s(a(h),{strong:""},{default:c(()=>[g(b(f.title),1)]),_:2},1024),s(a(h),{type:"secondary",code:""},{default:c(()=>[g("/"+b(f.path),1)]),_:2},1024)]),_:2},1024)):v("",!0),f.type=="job"?(d(),p(a(w),{key:1,size:"large"},{default:c(()=>[s(C,{path:a(he)},null,8,["path"]),s(a(h),{strong:""},{default:c(()=>[g(b(f.title),1)]),_:2},1024),s(a(h),{type:"secondary",code:""},{default:c(()=>[g(b(f.schedule),1)]),_:2},1024)]),_:2},1024)):v("",!0),f.type=="hook"?(d(),p(a(w),{key:2,size:"large"},{default:c(()=>[s(C,{path:a(ve)},null,8,["path"]),s(a(h),{strong:""},{default:c(()=>[g(b(f.title),1)]),_:2},1024),s(a(h),{type:"secondary",code:""},{default:c(()=>[g("/_hooks/"+b(f.path),1)]),_:2},1024)]),_:2},1024)):v("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(d(),T("div",Fe,[s(a(K),{description:"No runtimes found. Make sure your project has forms, hooks or jobs before deploying it"})]))}}),Ue=V({__name:"Builds",setup(r){const t=ee().params.projectId,{loading:i,result:l,refetch:D}=$(async()=>{const[n,u]=await Promise.all([pe.list(t),me.getStatus(t)]);return{b:n.map(m=>({build:m,status:u.filter(O=>O.buildId==m.id).map(O=>O.status)})),status:u}});let f;te(()=>{f=setInterval(D,1e4)}),ne(()=>{clearInterval(f)});const y=re(null),_=$(async()=>y.value?await fe.get(y.value):null),F=()=>{var o;const n=(o=l.value)==null?void 0:o.b.find(m=>m.build.id===y.value);return`Build ${n==null?void 0:n.build.id.slice(0,8)} - ${n==null?void 0:n.build.createdAt.toLocaleString()}`},M=[{text:"Deploying",tagColor:"blue",check:n=>{var u,o;return(o=n.build.latest&&n.status.some(m=>m=="Running")&&((u=l.value)==null?void 0:u.status.some(m=>m.buildId!==n.build.id)))!=null?o:!1},loading:!0},{text:"Deactivating",tagColor:"orange",check:n=>n.build.status==="success"&&!n.build.latest&&n.status.some(u=>u=="Running"),loading:!0},{text:"Live",tagColor:"green",check:n=>n.build.latest&&n.status.some(u=>u=="Running")},{text:"Sleeping",tagColor:"cyan",check:n=>n.build.latest&&n.status.length===0},{text:"Failed",tagColor:"red",check:n=>n.build.latest&&n.status.some(u=>u=="Failed")},{text:"Inactive",tagColor:"default",check:n=>n.build.status==="success"},{text:"Aborted",tagColor:"default",check:n=>n.build.status==="aborted"||n.build.status==="aborted-by-user"},{text:"Failed",tagColor:"orange",check:n=>n.build.status==="failure"},{text:"Deploying",tagColor:"blue",check:n=>n.build.status==="in-progress",loading:!0},{text:"Uploading",tagColor:"yellow",check:n=>n.build.status==="pending"}];function H(n){var u,o,m,O,B;return{text:(o=(u=M.find(x=>x.check(n)))==null?void 0:u.text)!=null?o:"unknown",tagColor:(O=(m=M.find(x=>x.check(n)))==null?void 0:m.tagColor)!=null?O:"default",hover:(B=n.build.log)!=null?B:void 0}}const U=ae(()=>{const n=[{name:"Id"},{name:"Date"},{name:"Status"},{name:"",align:"right"}];return l.value?{columns:n,rows:l.value.b.map(u=>({key:u.build.id,cells:[{type:"text",text:u.build.id.slice(0,8)},{key:"date",type:"slot",payload:{date:xe(u.build.createdAt,{weekday:void 0}),distance:oe(u.build.createdAt)}},{key:"status",type:"slot",payload:H(u)},{type:"actions",actions:[{icon:Oe,label:"Inspect build",onClick:async()=>{y.value=u.build.id,_.refetch()}},{icon:R,label:"View application logs",onClick:()=>q.push({name:"logs",params:{projectId:t},query:{buildId:u.build.id}})},{icon:_e,label:"Download files",onClick:()=>u.build.download()}]}]}))}:{columns:n,rows:[]}});return(n,u)=>(d(),T(le,null,[s(ge,{"entity-name":"build",loading:a(i),title:"Builds",description:"Each build is a version of your app. You can create a new build by deploying your app from the local editor.","empty-title":"No builds here yet",table:U.value,live:""},{date:c(({payload:o})=>[s(a(ie),null,{title:c(()=>[g(b(o.distance),1)]),default:c(()=>[g(b(o.date)+" ",1)]),_:2},1024)]),status:c(({payload:o})=>[s(a(ue),{open:o.hover?void 0:!1},{content:c(()=>[s(a(we),{style:{width:"300px",overflow:"auto","font-family":"monospace"},content:o.hover,copyable:""},null,8,["content"])]),default:c(()=>[o.text!=="unknown"?(d(),p(a(Pe),{key:0,color:o.tagColor,style:se({cursor:o.hover?"pointer":"default"})},{default:c(()=>[o.text==="Live"?(d(),p(a($e),{key:0})):o.text==="Inactive"?(d(),p(a(Ne),{key:1})):o.text==="Failed"?(d(),p(a(ze),{key:2})):o.text==="Aborted"?(d(),p(a(Se),{key:3})):o.text==="Sleeping"?(d(),p(a(Te),{key:4})):o.text==="Uploading"?(d(),p(a(S),{key:5})):o.text==="Deploying"?(d(),p(a(S),{key:6})):o.text==="Deactivating"?(d(),p(a(S),{key:7})):v("",!0),g(" "+b(o.text),1)]),_:2},1032,["color","style"])):v("",!0)]),_:2},1032,["open"])]),_:1},8,["loading","table"]),y.value?(d(),p(a(Ie),{key:0,footer:null,open:!!y.value,size:"large",width:"80%",title:F(),onCancel:u[0]||(u[0]=o=>y.value=null)},{default:c(()=>[!a(_).result.value||a(_).loading.value?(d(),p(a(ce),{key:0})):a(_).result.value?(d(),p(He,{key:1,"build-spec":a(_).result.value},null,8,["build-spec"])):v("",!0)]),_:1},8,["open","title"])):v("",!0)],64))}});const vt=de(Ue,[["__scopeId","data-v-9acaeb9b"]]);export{vt as default};
//# sourceMappingURL=Builds.72a91105.js.map

import{d as P,D as H,f as m,o as h,Y as v,$ as B,S as $,e8 as O,a as g,e as E,X as J,ej as A,g as D,E as z,b as u,w as p,u as l,cz as F,aB as W,cy as U,aG as R,c as q,dh as I,bT as k,e9 as G,aS as X,em as Y,en as K,a0 as Q}from"./index.494ee3d6.js";import"./editor.c4ee4641.js";import{W as T}from"./workspaces.22dd8bda.js";import{v as aa}from"./string.c25cb15f.js";import{e as ea}from"./toggleHighContrast.3282556b.js";import{f as j}from"./index.25a2ed98.js";import{A as ta}from"./index.c1c6186c.js";import{A as na}from"./index.c89dbcbf.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="caab4c5b-3dc1-4a5c-91b5-4e88c69aa722",s._sentryDebugIdIdentifier="sentry-dbid-caab4c5b-3dc1-4a5c-91b5-4e88c69aa722")}catch{}})();const oa=["width","height","fill","transform"],sa={key:0},ia=g("path",{d:"M252,152a12,12,0,0,1-12,12H228v12a12,12,0,0,1-24,0V164H192a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,252,152ZM56,76H68V88a12,12,0,0,0,24,0V76h12a12,12,0,1,0,0-24H92V40a12,12,0,0,0-24,0V52H56a12,12,0,0,0,0,24ZM184,188h-4v-4a12,12,0,0,0-24,0v4h-4a12,12,0,0,0,0,24h4v4a12,12,0,0,0,24,0v-4h4a12,12,0,0,0,0-24ZM222.14,82.83,82.82,222.14a20,20,0,0,1-28.28,0L33.85,201.46a20,20,0,0,1,0-28.29L173.17,33.86a20,20,0,0,1,28.28,0l20.69,20.68A20,20,0,0,1,222.14,82.83ZM159,112,144,97,53.65,187.31l15,15Zm43.31-43.31-15-15L161,80l15,15Z"},null,-1),ra=[ia],da={key:1},la=g("path",{d:"M176,112,74.34,213.66a8,8,0,0,1-11.31,0L42.34,193a8,8,0,0,1,0-11.31L144,80Z",opacity:"0.2"},null,-1),ca=g("path",{d:"M248,152a8,8,0,0,1-8,8H224v16a8,8,0,0,1-16,0V160H192a8,8,0,0,1,0-16h16V128a8,8,0,0,1,16,0v16h16A8,8,0,0,1,248,152ZM56,72H72V88a8,8,0,0,0,16,0V72h16a8,8,0,0,0,0-16H88V40a8,8,0,0,0-16,0V56H56a8,8,0,0,0,0,16ZM184,192h-8v-8a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0v-8h8a8,8,0,0,0,0-16ZM219.31,80,80,219.31a16,16,0,0,1-22.62,0L36.68,198.63a16,16,0,0,1,0-22.63L176,36.69a16,16,0,0,1,22.63,0l20.68,20.68A16,16,0,0,1,219.31,80Zm-54.63,32L144,91.31l-96,96L68.68,208ZM208,68.69,187.31,48l-32,32L176,100.69Z"},null,-1),ua=[la,ca],ha={key:2},ga=g("path",{d:"M248,152a8,8,0,0,1-8,8H224v16a8,8,0,0,1-16,0V160H192a8,8,0,0,1,0-16h16V128a8,8,0,0,1,16,0v16h16A8,8,0,0,1,248,152ZM56,72H72V88a8,8,0,0,0,16,0V72h16a8,8,0,0,0,0-16H88V40a8,8,0,0,0-16,0V56H56a8,8,0,0,0,0,16ZM184,192h-8v-8a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0v-8h8a8,8,0,0,0,0-16ZM219.31,80,80,219.31a16,16,0,0,1-22.62,0L36.68,198.63a16,16,0,0,1,0-22.63L176,36.69a16,16,0,0,1,22.63,0l20.68,20.68A16,16,0,0,1,219.31,80ZM208,68.69,187.31,48l-32,32L176,100.69Z"},null,-1),fa=[ga],pa={key:3},va=g("path",{d:"M246,152a6,6,0,0,1-6,6H222v18a6,6,0,0,1-12,0V158H192a6,6,0,0,1,0-12h18V128a6,6,0,0,1,12,0v18h18A6,6,0,0,1,246,152ZM56,70H74V88a6,6,0,0,0,12,0V70h18a6,6,0,0,0,0-12H86V40a6,6,0,0,0-12,0V58H56a6,6,0,0,0,0,12ZM184,194H174V184a6,6,0,0,0-12,0v10H152a6,6,0,0,0,0,12h10v10a6,6,0,0,0,12,0V206h10a6,6,0,0,0,0-12ZM217.9,78.59,78.58,217.9a14,14,0,0,1-19.8,0L38.09,197.21a14,14,0,0,1,0-19.8L177.41,38.1a14,14,0,0,1,19.8,0L217.9,58.79A14,14,0,0,1,217.9,78.59ZM167.51,112,144,88.49,46.58,185.9a2,2,0,0,0,0,2.83l20.69,20.68a2,2,0,0,0,2.82,0h0Zm41.9-44.73L188.73,46.59a2,2,0,0,0-2.83,0L152.48,80,176,103.52,209.41,70.1A2,2,0,0,0,209.41,67.27Z"},null,-1),ma=[va],wa={key:4},Sa=g("path",{d:"M48,64a8,8,0,0,1,8-8H72V40a8,8,0,0,1,16,0V56h16a8,8,0,0,1,0,16H88V88a8,8,0,0,1-16,0V72H56A8,8,0,0,1,48,64ZM184,192h-8v-8a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0v-8h8a8,8,0,0,0,0-16Zm56-48H224V128a8,8,0,0,0-16,0v16H192a8,8,0,0,0,0,16h16v16a8,8,0,0,0,16,0V160h16a8,8,0,0,0,0-16ZM219.31,80,80,219.31a16,16,0,0,1-22.62,0L36.68,198.63a16,16,0,0,1,0-22.63L176,36.69a16,16,0,0,1,22.63,0l20.68,20.68A16,16,0,0,1,219.31,80Zm-54.63,32L144,91.31l-96,96L68.68,208ZM208,68.69,187.31,48l-32,32L176,100.69Z"},null,-1),Va=[Sa],ya={key:5},ba=g("path",{d:"M244,152a4,4,0,0,1-4,4H220v20a4,4,0,0,1-8,0V156H192a4,4,0,0,1,0-8h20V128a4,4,0,0,1,8,0v20h20A4,4,0,0,1,244,152ZM56,68H76V88a4,4,0,0,0,8,0V68h20a4,4,0,0,0,0-8H84V40a4,4,0,0,0-8,0V60H56a4,4,0,0,0,0,8ZM184,196H172V184a4,4,0,0,0-8,0v12H152a4,4,0,0,0,0,8h12v12a4,4,0,0,0,8,0V204h12a4,4,0,0,0,0-8ZM216.48,77.17,77.17,216.49a12,12,0,0,1-17,0L39.51,195.8a12,12,0,0,1,0-17L178.83,39.51a12,12,0,0,1,17,0L216.48,60.2A12,12,0,0,1,216.48,77.17ZM170.34,112,144,85.66,45.17,184.49a4,4,0,0,0,0,5.65l20.68,20.69a4,4,0,0,0,5.66,0Zm40.49-46.14L190.14,45.17a4,4,0,0,0-5.66,0L149.65,80,176,106.34l34.83-34.83A4,4,0,0,0,210.83,65.86Z"},null,-1),xa=[ba],Za={name:"PhMagicWand"},Ma=P({...Za,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(s){const e=s,t=H("weight","regular"),c=H("size","1em"),V=H("color","currentColor"),_=H("mirrored",!1),r=m(()=>{var i;return(i=e.weight)!=null?i:t}),x=m(()=>{var i;return(i=e.size)!=null?i:c}),Z=m(()=>{var i;return(i=e.color)!=null?i:V}),L=m(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:_?"scale(-1, 1)":void 0);return(i,C)=>(h(),v("svg",O({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:x.value,height:x.value,fill:Z.value,transform:L.value},i.$attrs),[B(i.$slots,"default"),r.value==="bold"?(h(),v("g",sa,ra)):r.value==="duotone"?(h(),v("g",da,ua)):r.value==="fill"?(h(),v("g",ha,fa)):r.value==="light"?(h(),v("g",pa,ma)):r.value==="regular"?(h(),v("g",wa,Va)):r.value==="thin"?(h(),v("g",ya,xa)):$("",!0)],16,oa))}});class Ha{async list(e){const t=new URLSearchParams({stage:e});return await(await fetch(`/_editor/api/stage_runs?${t}`)).json()}async listPast(e){const t=new URLSearchParams({stage:e});return await(await fetch(`/_editor/api/stage_runs/past?${t}`)).json()}}const N=new Ha;class b{constructor(e){this.dto=e}static async list(e){return(await N.list(e)).map(c=>new b(c))}static async listPast(e){return(await N.listPast(e)).map(c=>new b(c))}get id(){return this.dto.id}get data(){return this.dto.data}get assignee(){return this.dto.assignee}get stage(){return this.dto.stage}get status(){return this.dto.status}get createdAt(){return new Date(this.dto.createdAt)}}const _a=s=>(Y("data-v-061ac7eb"),s=s(),K(),s),La=_a(()=>g("span",null," Fix with AI ",-1)),Ca=P({__name:"ThreadSelector",props:{stage:{},executionConfig:{}},emits:["fix-invalid-json","update:execution-config","update:show-thread-modal"],setup(s,{emit:e}){const t=s,c=m(()=>t.executionConfig.attached?"Select a thread to continue the workflow":"Choose a thread to copy the data from"),V=m(()=>t.executionConfig.attached?"Select thread":"Use this thread data"),_=m(()=>t.executionConfig.attached?!t.executionConfig.stageRunId:!1),r=m(()=>{if(!a.threadData)return{valid:!0,parsed:{}};const n=aa(a.threadData);return n.valid&&!A.exports.isObject(n.parsed)?{valid:!1,message:"Thread data must be an object."}:n});function x(){r.value.valid||e("fix-invalid-json",a.threadData,r.value.message)}const Z=E(null),L=n=>{const d=a.waitingStageRuns.find(S=>S.id===n),w=a.pastStageRuns.find(S=>S.id===n),y=d!=null?d:w;if(!y)throw new Error("Stage run not found");const o=JSON.stringify(y.data,null,2);f.setValue(o),a.threadData=o,a.selectedStageRunId=n,e("update:execution-config",{...t.executionConfig,stageRunId:n})},i=()=>{e("update:execution-config",{...t.executionConfig,stageRunId:null})},C=()=>{e("update:show-thread-modal",!1),T.writeTestData(a.threadData)};let f;J(async()=>{var y;a.threadData=await T.readTestData(),a.selectedStageRunId=(y=t.executionConfig.stageRunId)!=null?y:void 0;const n=await b.list(t.stage.id),d=await b.listPast(t.stage.id);a.waitingStageRuns=n.filter(o=>o.status==="waiting"),a.pastStageRuns=[...d,...n.filter(o=>o.status!=="waiting")],a.options=[],a.waitingStageRuns.length>0&&a.options.push({label:"Waiting threads",options:a.waitingStageRuns.map(o=>({value:o.id,label:`Started ${j(o.createdAt,{addSuffix:!0})} (${o.status})`}))}),a.pastStageRuns.length>0&&a.options.push({label:"Past threads",options:a.pastStageRuns.map(o=>({value:o.id,label:`Started ${j(o.createdAt,{addSuffix:!0})} (${o.status})`}))}),f=ea.create(Z.value,{language:"json",value:a.threadData,fontFamily:"monospace",lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",horizontal:"visible"},readOnly:t.executionConfig.attached});const w=f.getContribution("editor.contrib.messageController");f.onDidAttemptReadOnlyEdit(()=>{w.showMessage("Can't edit thread data with workflow on",f.getPosition())}),f.onDidChangeModelContent(()=>{const o=f.getValue();if(a.threadData=o,t.executionConfig.attached&&a.selectedStageRunId){const S=[...a.waitingStageRuns,...a.pastStageRuns].find(M=>M.id===a.selectedStageRunId);if(!S){e("update:execution-config",{...t.executionConfig});return}try{const M=JSON.parse(o);A.exports.isEqual(S.data,M)?e("update:execution-config",{...t.executionConfig}):e("update:execution-config",{...t.executionConfig})}catch{e("update:execution-config",{...t.executionConfig})}}})}),D(()=>t.executionConfig.stageRunId,n=>{n?a.selectedStageRunId=n:a.selectedStageRunId=void 0}),D(()=>t.executionConfig.attached,n=>{f.updateOptions({readOnly:n})});const a=z({waitingStageRuns:[],pastStageRuns:[],options:[],loading:!1,threadData:"{}",selectedStageRunId:void 0});return(n,d)=>(h(),v(X,null,[u(l(U),{layout:"vertical"},{default:p(()=>[u(l(F),{label:c.value},{default:p(()=>[u(l(W),{placeholder:"No thread selected","filter-option":"",style:{width:"100%"},"allow-clear":!0,options:a.options,value:a.selectedStageRunId,"not-found-content":"There are no threads",onSelect:d[0]||(d[0]=w=>L(w)),onClear:d[1]||(d[1]=w=>i())},null,8,["options","value"])]),_:1},8,["label"])]),_:1}),u(l(ta),{orientation:"left"},{default:p(()=>[R("Data")]),_:1}),g("div",{ref_key:"dataJson",ref:Z,class:"data-container"},null,512),r.value.valid===!1?(h(),q(l(na),{key:0,type:"error",message:"Invalid JSON",description:r.value.message},{action:p(()=>[u(l(k),{onClick:x},{default:p(()=>[u(l(I),{align:"center",gap:"small"},{default:p(()=>[u(l(Ma)),La]),_:1})]),_:1})]),_:1},8,["description"])):$("",!0),u(l(I),{justify:"end",gap:"middle",style:{"margin-top":"12px"}},{default:p(()=>[u(l(k),{type:"primary",disabled:_.value,onClick:C},{default:p(()=>[R(G(V.value),1)]),_:1},8,["disabled"])]),_:1})],64))}});const Pa=Q(Ca,[["__scopeId","data-v-061ac7eb"]]);export{Pa as T};
//# sourceMappingURL=ThreadSelector.1fa3bb73.js.map

import{N as Z}from"./Navbar.f3f3c9ec.js";import{a as A}from"./asyncComputed.91dd9b14.js";import{m as H}from"./url.23e7d6b6.js";import{d as X,f as y,e as k,ed as $,X as h,b as u,a as ee,u as a,c as s,w as i,o as r,bx as C,aF as c,ec as p,eV as l,d9 as ae,aA as K,cP as f,cQ as m,aR as R,ee as V,R as z,cv as g,bH as D,ej as te,bP as ne,cu as oe,$ as ie}from"./vue-router.663e4641.js";import{A as re}from"./apiKey.6c4e52f3.js";import"./gateway.b2447a0d.js";import{O as T}from"./organization.8f1038ad.js";import{P as B}from"./project.5ce04779.js";import"./tables.302d4487.js";import"./PhChats.vue.3f1564b1.js";import"./PhSignOut.vue.33e46852.js";import"./router.d3a61be6.js";import"./index.108b4fb6.js";import"./Avatar.082b8820.js";import"./index.824a0c1a.js";import"./index.8428cf9b.js";import"./BookOutlined.a08e774b.js";import"./popupNotifcation.83d36381.js";import"./record.48f7790f.js";import"./string.3b77754c.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_=new Error().stack;_&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[_]="1565d0f5-1eba-4670-a675-e0947faf0f13",d._sentryDebugIdIdentifier="sentry-dbid-1565d0f5-1eba-4670-a675-e0947faf0f13")}catch{}})();const le={class:"container"},se={class:"content"},N="NEW_ORGANIZATION_KEY",I="NEW_PROJECT_KEY",ue=X({__name:"EditorLogin",setup(d){const{result:_,loading:E}=A(()=>T.list()),{result:F,loading:j,refetch:L}=A(async()=>{const t=e.value;return t.type!=="selected-organization"?[]:B.list(t.organizationId)}),x=y(()=>{var t,n;return(n=(t=_.value)==null?void 0:t.map(o=>({key:o.id,label:o.name})))!=null?n:[]}),O=y(()=>{var t,n;return(n=(t=F.value)==null?void 0:t.map(o=>({key:o.id,label:o.name})))!=null?n:[]}),U=y(()=>e.value.type==="initial"?!0:e.value.type==="new-organization"?!e.value.organizationName||!e.value.project.projectName:e.value.type==="selected-organization"&&e.value.project.type==="new"?!e.value.project.projectName:e.value.type==="selected-organization"&&e.value.project.type==="initial"),W=async t=>await T.create(t.name),P=async(t,n)=>await B.create({organizationId:n,name:t.name}),w=async t=>await re.create({projectId:t,name:"default"}),e=k({type:"initial"}),Y=y(()=>{if(e.value.type!=="initial")return e.value.type==="new-organization"?N:e.value.organizationId}),G=y(()=>e.value.type==="selected-organization"&&e.value.project.type==="new"?I:e.value.type==="selected-organization"&&e.value.project.type==="selected"?e.value.project.projectId:void 0);function M(t){t||(e.value={type:"initial"}),t===N?e.value={type:"new-organization",organizationName:"",project:{type:"new",projectName:""}}:(e.value={type:"selected-organization",organizationId:String(t),project:{type:"initial"}},L())}function q(t){e.value.type==="selected-organization"&&(t||(e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"initial"}}),t===I?e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"new",projectName:""}}:e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"selected",projectId:String(t)}})}const v=k(!1);async function J(){if(!v.value){v.value=!0;try{if(e.value.type==="initial")return;if(e.value.type==="new-organization"){const t=await W({name:e.value.organizationName}),n=await P({name:e.value.project.projectName},t.id),o=await w(n.id);o.value&&b(o.value)}if(e.value.type==="selected-organization"&&e.value.project.type==="new"){const t=await P({name:e.value.project.projectName},e.value.organizationId),n=await w(t.id);n.value&&b(n.value)}if(e.value.type==="selected-organization"&&e.value.project.type==="selected"){const t=await w(e.value.project.projectId);t.value&&b(t.value)}}finally{v.value=!1}}}const S=$(),Q=k(null);async function b(t){if(S.query.redirect){const n=S.query.redirect;if(!n.match(/http:\/\/localhost:\d+/))throw new Error("Invalid redirect");const o=decodeURIComponent(n);location.href=H(o,{"api-key":t})}else Q.value=t}return(t,n)=>(r(),h("div",le,[u(Z),ee("div",se,[a(E)||!a(_)?(r(),s(a(C),{key:0})):(r(),s(a(oe),{key:1,layout:"vertical",class:"card"},{default:i(()=>[u(a(ae),{level:3,style:{padding:"0px",margin:"0px","margin-bottom":"30px"}},{default:i(()=>[c(p(a(l).translate("i18n_create_or_choose_project")),1)]),_:1}),u(a(g),{label:a(l).translate("i18n_get_api_key_organization")},{default:i(()=>[u(a(K),{style:{width:"100%"},placeholder:a(l).translate("i18n_get_api_key_choose_organization"),size:"large",value:Y.value,"onUpdate:value":M},{default:i(()=>[u(a(f),{label:a(l).translate("i18n_get_api_key_new_organization")},{default:i(()=>[(r(),s(a(m),{key:N},{default:i(()=>[c(p(a(l).translate("i18n_get_api_key_create_new_organization")),1)]),_:1}))]),_:1},8,["label"]),x.value.length>0?(r(),s(a(f),{key:0,label:a(l).translate("i18n_get_api_key_existing_organizations")},{default:i(()=>[(r(!0),h(R,null,V(x.value,o=>(r(),s(a(m),{key:o.key},{default:i(()=>[c(p(o.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):z("",!0)]),_:1},8,["placeholder","value"])]),_:1},8,["label"]),e.value.type=="new-organization"?(r(),s(a(g),{key:0,label:a(l).translate("i18n_get_api_key_organization_name")},{default:i(()=>[u(a(D),{value:e.value.organizationName,"onUpdate:value":n[0]||(n[0]=o=>e.value.organizationName=o),placeholder:a(l).translate("i18n_get_api_key_choose_organization_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):(r(),s(a(g),{key:1,label:a(l).translate("i18n_get_api_key_project")},{default:i(()=>[u(a(K),{style:{width:"100%"},disabled:e.value.type!="selected-organization",placeholder:a(l).translate("i18n_get_api_key_choose_project"),size:"large",value:G.value,"onUpdate:value":q},te({default:i(()=>[a(j)?z("",!0):(r(),s(a(f),{key:0,label:a(l).translate("i18n_get_api_key_new_project")},{default:i(()=>[(r(),s(a(m),{key:I},{default:i(()=>[c(p(a(l).translate("i18n_get_api_key_create_new_project")),1)]),_:1}))]),_:1},8,["label"])),O.value.length>0&&!a(j)?(r(),s(a(f),{key:1,label:a(l).translate("i18n_get_api_key_existing_projects")},{default:i(()=>[(r(!0),h(R,null,V(O.value,o=>(r(),s(a(m),{key:o.key},{default:i(()=>[c(p(o.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):z("",!0)]),_:2},[a(j)?{name:"notFoundContent",fn:i(()=>[u(a(C),{size:"small"})]),key:"0"}:void 0]),1032,["disabled","placeholder","value"])]),_:1},8,["label"])),(e.value.type=="new-organization"||e.value.type=="selected-organization")&&e.value.project.type=="new"?(r(),s(a(g),{key:2,label:"Project name"},{default:i(()=>[u(a(D),{value:e.value.project.projectName,"onUpdate:value":n[1]||(n[1]=o=>e.value.project.projectName=o),placeholder:a(l).translate("i18n_get_api_key_choose_project_name"),size:"large"},null,8,["value","placeholder"])]),_:1})):z("",!0),u(a(g),{style:{"margin-top":"40px"}},{default:i(()=>[u(a(ne),{type:"primary",disabled:U.value,loading:v.value,style:{width:"100%"},onClick:J},{default:i(()=>[c(p(a(l).translate("i18n_login_with_this_project")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))])]))}});const Pe=ie(ue,[["__scopeId","data-v-11f078da"]]);export{Pe as default};
//# sourceMappingURL=EditorLogin.2cf8f0fa.js.map

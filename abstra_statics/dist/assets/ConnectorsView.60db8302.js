var de=Object.defineProperty;var pe=(l,t,a)=>t in l?de(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var E=(l,t,a)=>(pe(l,typeof t!="symbol"?t+"":t,a),a);import{_ as ge}from"./DocsButton.vue_vue_type_script_setup_true_lang.aa961e05.js";import{_ as Q}from"./AbstraButton.vue_vue_type_script_setup_true_lang.7233552b.js";import{d as M,at as Z,c as H,o as c,ac as w,ae as ye,h as U,ew as he,e as F,z as me,r as B,M as G,w as oe,a as v,b as i,eB as P,u as n,cE as fe,bQ as O,cW as ve,aY as A,cU as Ce,g as C,t as k,cA as _e,bT as ke,aI as be,cJ as we,dg as Ie,f as s,i as h,df as L,cD as Te,dj as T,de as q,c$ as xe,d9 as le,ez as Se,_ as ce,eA as Ae,Z as ie,cM as J,A as W,bW as Ue,bE as je,bD as se}from"./jwt-decode.esm.5fdd9ab8.js";import{G as $e}from"./PhDotsThreeVertical.vue.bd6f36a4.js";import{k as K,o as Ne}from"./router.2629d009.js";import{U as Ve}from"./UploadOutlined.ba6abc32.js";import{_ as Ee}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.65297b0c.js";import{L as Ke}from"./Logo.d427a9e2.js";import{A as re}from"./index.09f8eaf6.js";import{C as ue}from"./Card.96c1b24d.js";import{b as Le}from"./index.496095e7.js";import"./constants.874c73ce.js";import"./index.b04050c9.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[t]="fa8962cf-0103-4c89-bdfb-61ac0522ec37",l._sentryDebugIdIdentifier="sentry-dbid-fa8962cf-0103-4c89-bdfb-61ac0522ec37")}catch{}})();const Fe=["width","height","fill","transform"],ze={key:0},He=F("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),Re=[He],Be={key:1},Pe=F("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),Me=F("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),De=[Pe,Me],Ze={key:2},qe=F("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),Ge=[qe],Oe={key:3},Je=F("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),We=[Je],Ye={key:4},Qe=F("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Xe=[Qe],en={key:5},nn=F("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),tn=[nn],an={name:"PhArrowsLeftRight"},on=M({...an,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const t=l,a=Z("weight","regular"),e=Z("size","1em"),r=Z("color","currentColor"),y=Z("mirrored",!1),_=H(()=>{var I;return(I=t.weight)!=null?I:a}),u=H(()=>{var I;return(I=t.size)!=null?I:e}),S=H(()=>{var I;return(I=t.color)!=null?I:r}),N=H(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(I,z)=>(c(),w("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:u.value,height:u.value,fill:S.value,transform:N.value},I.$attrs),[ye(I.$slots,"default"),_.value==="bold"?(c(),w("g",ze,Re)):_.value==="duotone"?(c(),w("g",Be,De)):_.value==="fill"?(c(),w("g",Ze,Ge)):_.value==="light"?(c(),w("g",Oe,We)):_.value==="regular"?(c(),w("g",Ye,Xe)):_.value==="thin"?(c(),w("g",en,tn)):U("",!0)],16,Fe))}});class ln{async generateEcdsaKey(t){const{projectId:a,connectionName:e,connectorType:r}=t;return K.post(`projects/${a}/connectors/${r}/connections/${e}/ecdsa-key`,{})}async createEcdsaConnection(t){const{projectId:a,connectionName:e,connectorType:r,publicKey:y,privateKey:_,accessId:u}=t;return K.post(`projects/${a}/connectors/${r}/connections/${e}/create-ecdsa`,{publicKey:y,privateKey:_,accessId:u})}async generateRsaKey(t){const{projectId:a,connectionName:e,connectorType:r}=t;return K.post(`projects/${a}/connectors/${r}/connections/${e}/rsa-key`,{})}async createRsaConnection(t){const{projectId:a,connectionName:e,connectorType:r,publicKey:y,privateKey:_,apiToken:u}=t;return K.post(`projects/${a}/connectors/${r}/connections/${e}/create-rsa`,{publicKey:y,privateKey:_,apiToken:u})}async getLoginUrl(t,a,e,r,y){return K.get(`projects/${t}/connectors/${e}/connections/${a}/login-url`,{scopeIds:r.join(","),...y})}async listConnectors(t){return K.get(`projects/${t}/connectors`)}async getConnectorsBetaStatus(){const{EnvURL:t}=await me(()=>import("./router.2629d009.js").then(a=>a.q),["assets/router.2629d009.js","assets/jwt-decode.esm.5fdd9ab8.js","assets/jwt-decode.6e4bcae0.css","assets/index.b04050c9.js"]);try{const a=await fetch(`${t.cloudApi}/public/connectors/beta-status`);if(!a.ok){if(a.status===404)return console.warn("Beta status endpoint not available yet, returning empty status"),{};throw new Error("Failed to fetch connectors beta status")}return a.json()}catch(a){return console.error("Error fetching beta status:",a),{}}}async createTokenConnection(t){const{projectId:a,connectionName:e,connectorType:r,tokens:y}=t,_={type:"tokens",tokens:y};return K.post(`projects/${a}/connectors/${r}/connections/${e}`,_)}async listConnections(t){return K.get(`projects/${t}/connections`)}async deleteConnection(t){const{projectId:a,connectionName:e,connectorType:r}=t;return K.delete(`projects/${a}/connectors/${r}/connections/${e}`)}async renameConnection(t){const{projectId:a,connectionName:e,connectorType:r,newConnectionName:y}=t;return K.patch(`projects/${a}/connectors/${r}/connections/${e}`,{newConnectionName:y})}}class sn{constructor(t,a){E(this,"state");E(this,"hasChanges",H(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));E(this,"handleDeletionClick",async t=>{G.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(t)})});E(this,"handleDeleteConnection",async t=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});E(this,"handleAddConnectionSubmit",async()=>{var y,_,u,S;const t=(y=this.state.value.addingConnection)==null?void 0:y.connector.metadata.key,a=(_=this.state.value.addingConnection)==null?void 0:_.selectedScopeIds,e=(S=(u=this.state.value.addingConnection)==null?void 0:u.tokenValues)!=null?S:{};if(!t||!a)throw new Error("No connector or scope selected");const{url:r}=await this.getLoginUrl(t,this.getUniqueName(t),a,e);window.location.href=r});E(this,"handleAddTokenConnectionSubmit",async()=>{const t=this.state.value.addingConnection;if(!t)throw new Error("No connection is being added");const a=t.connector.metadata.key,e=this.getUniqueName(a);await this.api.createTokenConnection({projectId:this.projectId,connectionName:e,connectorType:a,tokens:t.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()});E(this,"handleAddEcdsaConnectionSubmit",async(t,a)=>{const e=this.state.value.addingConnection;if(!e||!t)throw new Error("No connection is being added or public key is missing");if(!e.connectionName||!e.ecdsaKeys)throw new Error("Keys or connection name not found");const r=e.connector.metadata.key;if(r==="iugu"){if(!a)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:e.connectionName,connectorType:r,publicKey:e.ecdsaKeys.publicKey,privateKey:e.ecdsaKeys.privateKey,apiToken:a})}else{if(!a)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:e.connectionName,connectorType:r,publicKey:e.ecdsaKeys.publicKey,privateKey:e.ecdsaKeys.privateKey,accessId:a})}this.state.value.addingConnection=null,await this.refetchConnections()});E(this,"renameConnection",async()=>{const{editingConnection:t}=this.state.value;if(!t)throw new Error("No connection is being edited");const a=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType,newConnectionName:t.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};G.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:a})});E(this,"showAddConfirmationModal",t=>{this.state.value.addingConnection={selectedScopeIds:t.auth.type==="oauth2"?t.auth.scopes.map(a=>a.key):[],connector:t,tokenValues:{}}});E(this,"handleScopeToggle",(t,a)=>{a?this.state.value.addingConnection.selectedScopeIds.push(t):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(e=>e!==t)});this.projectId=t,this.api=a,this.state=B({connectors:[],connections:[],addingConnection:null,editingConnection:null,betaStatus:{}})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchBetaStatus(){this.state.value.betaStatus=await this.api.getConnectorsBetaStatus()}async fetchInitialState(){await Promise.all([this.fetchConnectors(),this.fetchBetaStatus(),this.refetchConnections()])}async refetchConnections(){const t=await this.api.listConnections(this.projectId);this.state.value.connections=t.map(a=>{const e=this.state.value.connectors.find(r=>r.metadata.key===a.connectionType);return e?{name:a.name,connectorTitle:e.metadata.label,connectorType:a.connectionType,icon:e.metadata.logoUrl}:null}).filter(a=>a!==null)}handleEditConnectionClick(t){this.state.value.editingConnection={...t,newName:t.name}}async getLoginUrl(t,a,e,r){return this.api.getLoginUrl(this.projectId,a,t,e,r)}slugify(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(t){const a=this.state.value.connections.filter(e=>e.connectorType===t).length;return a===0?t:`${t}-${a}`}async generateEcdsaKey(){const t=this.state.value.addingConnection;if(!t)throw new Error("No connection is being added");const a=t.connector.metadata.key,e=this.getUniqueName(a),y=a==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:e,connectorType:a}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:e,connectorType:a});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=e,this.state.value.addingConnection.ecdsaKeys=y),y.publicKey}}function cn(l){return new Promise((t,a)=>{const e=new FileReader;e.onload=()=>{const y=e.result.split(",")[1];t(y)},e.onerror=()=>a(e.error),e.readAsDataURL(l)})}const rn={key:6,style:{"margin-top":"16px"}},Y=M({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(l,{emit:t}){const a=l,e=t,r=B(a.uploadedFiles||{});function y(d){const g=u.value[d];return g?g.split(",").map(o=>o.trim()):[]}function _(d,g){Array.isArray(g)?S(d,g.join(",")):console.error("Expected array for checkbox/select value")}const u=B({...a.tokenValues});oe(()=>a.tokenValues,d=>{u.value={...d}},{deep:!0}),oe(()=>a.uploadedFiles,d=>{r.value=d||{}},{deep:!0});function S(d,g){u.value[d]=g;const o={...u.value};e("update:tokenValues",o),e("tokenChange")}function N(d){var o,p;const g=[];return d.key&&g.push({required:!0,message:h.translate("i18n_auth_form_field_required",null,d.label||d.key)}),(o=d.input)!=null&&o.minSize&&g.push({min:d.input.minSize,message:h.translate("i18n_auth_form_field_min_length",null,d.input.minSize)}),(p=d.input)!=null&&p.maxSize&&g.push({max:d.input.maxSize,message:h.translate("i18n_auth_form_field_max_length",null,d.input.maxSize)}),g}async function I(d,g){try{const o=await cn(d),p={...r.value,[g]:{file:d,base64:o}};r.value=p,e("update:uploadedFiles",p),u.value[g]=o;const f={...u.value};e("update:tokenValues",f),e("tokenChange")}catch(o){console.error("Error converting file to base64:",o)}return!1}function z(d){const g={...r.value};delete g[d],r.value=g,e("update:uploadedFiles",g),u.value[d]="";const o={...u.value};e("update:tokenValues",o),e("tokenChange")}function j(d){const g=r.value[d];return g?[{uid:d,name:g.file.name,status:"done",size:g.file.size}]:[]}return(d,g)=>(c(),v(n(Te),{model:u.value,layout:"vertical"},{default:i(()=>[(c(!0),w(A,null,P(l.tokens,o=>(c(),v(n(fe),{key:o.key,label:o.label,name:o.key,rules:N(o)},{default:i(()=>{var p,f,m,x,$,R,V,D,X,ee,ne,te,ae;return[((p=o.input)==null?void 0:p.type)==="small-string"?(c(),v(n(O),{key:0,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,placeholder:o.description,maxlength:(f=o.input)==null?void 0:f.maxSize,minlength:(m=o.input)==null?void 0:m.minSize,type:"password",onInput:()=>S(o.key,u.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((x=o.input)==null?void 0:x.type)==="radiobox"?(c(),v(n(ve),{key:1,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,onChange:()=>S(o.key,u.value[o.key]||"")},{default:i(()=>[(c(!0),w(A,null,P(o.input.options,b=>(c(),v(n(Ce),{key:b.value,value:b.value},{default:i(()=>[C(k(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):(($=o.input)==null?void 0:$.type)==="checkbox"?(c(),w(A,{key:2},[((D=(V=(R=o.input)==null?void 0:R.options)==null?void 0:V.length)!=null?D:0)<=10?(c(),v(n(_e),{key:0,value:y(o.key),onChange:b=>_(o.key,b)},{default:i(()=>[(c(!0),w(A,null,P(o.input.options,b=>(c(),v(n(ke),{key:b.value,value:b.value},{default:i(()=>[C(k(b.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(c(),v(n(be),{key:1,mode:"multiple",style:{width:"100%"},value:y(o.key),options:(X=o.input.options)!=null?X:[],onChange:b=>_(o.key,b)},null,8,["value","options","onChange"]))],64)):((ee=o.input)==null?void 0:ee.type)==="large-text"?(c(),v(n(we),{key:3,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,placeholder:o.description,maxlength:(ne=o.input)==null?void 0:ne.maxSize,minlength:(te=o.input)==null?void 0:te.minSize,rows:4,onInput:()=>S(o.key,u.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((ae=o.input)==null?void 0:ae.type)==="file"?(c(),v(n(Ie),{key:4,"file-list":j(o.key),"before-upload":b=>I(b,o.key),"max-count":1,"show-upload-list":!0,onRemove:()=>z(o.key)},{default:i(()=>[s(Q,null,{default:i(()=>[s(n(Ve)),C(" "+k(n(h).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:1},8,["file-list","before-upload","onRemove"])):(c(),v(n(O),{key:5,value:u.value[o.key],"onUpdate:value":b=>u.value[o.key]=b,placeholder:o.description,type:"password",onInput:()=>S(o.key,u.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),o.instructions?(c(),w("div",rn,[s(n(L),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:i(()=>[C(k(o.instructions),1)]),_:2},1024)])):U("",!0),o.description&&!o.instructions?(c(),v(n(L),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:i(()=>[C(k(o.description),1)]),_:2},1024)):U("",!0)]}),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"]))}}),un=M({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(l){return(t,a)=>(c(),v(n(T),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:i(()=>[s(Ee,{"hide-text":"",size:"large"}),s(n(on),{size:24}),s(Ke,{"image-url":l.connectorLogoUrl,"brand-name":l.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),dn=M({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(l,{emit:t}){const a=l,e=t,r=H(()=>{var d,g,o;switch((d=a.addingConnection)==null?void 0:d.connector.auth.type){case"oauth2":return h.translate("i18n_connection_modal_button_authorize",null);case"tokens":return h.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!a.ecdsaPublicKey)return h.translate("i18n_connection_modal_button_ok",null);const p=((g=a.addingConnection)==null?void 0:g.connector.auth.params)||[],f=((o=a.addingConnection)==null?void 0:o.tokenValues)||{};return p.every(x=>f[x.key]&&f[x.key].trim().length>0)?h.translate("i18n_connection_modal_button_create",null):h.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return h.translate("i18n_connection_modal_button_ok",null)}});function y(){e("cancel")}function _(){e("submit")}function u(j,d){e("scope-toggle",j,d)}function S(){e("generate-ecdsa-key")}function N(j){e("update:token-values",j)}function I(j){e("update:uploaded-files",j)}function z(){e("token-change")}return(j,d)=>(c(),v(n(G),{open:!!l.addingConnection,title:l.addingConnection?n(h).translate("i18n_connection_modal_title_add",null,l.addingConnection.connector.metadata.label):"","ok-text":r.value,"ok-button-props":{disabled:r.value.includes("Required")},"confirm-loading":l.loading,"wrap-class-name":"full-modal",onCancel:y,onOk:_},{default:i(()=>[l.addingConnection?(c(),w(A,{key:0},[s(un,{"connector-logo-url":l.addingConnection.connector.metadata.logoUrl,"connector-label":l.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),l.addingConnection.connector.auth.type==="oauth2"?(c(),w(A,{key:0},[s(n(q),null,{default:i(()=>[C(k(n(h).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),s(n(T),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:i(()=>{var g;return[(c(!0),w(A,null,P(l.addingConnection.connector.auth.scopes,o=>(c(),v(n(T),{key:o.key,justify:"space-between",align:"center"},{default:i(()=>[s(n(T),{vertical:""},{default:i(()=>[s(n(L),null,{default:i(()=>[C(k(o.description),1)]),_:2},1024),s(n(L),{type:"secondary"},{default:i(()=>[C(k(o.key),1)]),_:2},1024)]),_:2},1024),s(n(xe),{checked:l.addingConnection.selectedScopeIds.includes(o.key),onChange:p=>u(o.key,p)},null,8,["checked","onChange"])]),_:2},1024))),128)),(g=l.addingConnection.connector.auth.params)!=null&&g.length?(c(),v(Y,{key:0,tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":N,"onUpdate:uploadedFiles":I,onTokenChange:z},null,8,["tokens","token-values","uploaded-files"])):U("",!0)]}),_:1})],64)):U("",!0),l.addingConnection.connector.auth.type==="tokens"?(c(),w(A,{key:1},[s(n(q),null,{default:i(()=>[C(k(n(h).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),s(Y,{tokens:l.addingConnection.connector.auth.tokens,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":N,"onUpdate:uploadedFiles":I,onTokenChange:z},null,8,["tokens","token-values","uploaded-files"])],64)):U("",!0),l.addingConnection.connector.auth.type==="ecdsa"?(c(),w(A,{key:2},[l.ecdsaPublicKey?(c(),v(n(T),{key:1,vertical:"",gap:"16"},{default:i(()=>[s(n(L),{strong:""},{default:i(()=>[C(k(n(h).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),s(n(L),{strong:""},{default:i(()=>[C(k(n(h).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),s(n(O),{value:l.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),s(Y,{tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":N,"onUpdate:uploadedFiles":I,onTokenChange:z},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(c(),w(A,{key:0},[s(n(q),null,{default:i(()=>[C(k(n(h).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),s(n(T),{vertical:"",gap:"16"},{default:i(()=>[s(Q,{loading:l.ecdsaKeyLoading,onClick:S},{default:i(()=>[C(k(n(h).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):U("",!0)],64)):U("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),pn=M({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{},isBeta:{type:Boolean}},setup(l){return(t,a)=>(c(),v(n(ue),{class:Se({"connector-card":!0,unavailable:l.unavailable})},{default:i(()=>[s(n(T),{style:{width:"100%"},vertical:"",gap:12},{default:i(()=>[s(n(T),{justify:"space-between"},{default:i(()=>[s(n(re),{src:l.logoUrl,shape:"square",size:"large"},null,8,["src"]),s(n(T),{gap:8},{default:i(()=>[l.isBeta?(c(),v(n(le),{key:0,color:"orange",style:{height:"fit-content"}},{default:i(()=>[...a[0]||(a[0]=[C("BETA",-1)])]),_:1})):U("",!0),l.unavailable?(c(),v(n(le),{key:1,style:{height:"fit-content"}},{default:i(()=>[C(k(n(h).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):U("",!0)]),_:1})]),_:1}),s(n(T),{vertical:""},{default:i(()=>[s(n(L),{strong:""},{default:i(()=>[C(k(l.title),1)]),_:1}),s(n(L),{type:"secondary"},{default:i(()=>[C(k(l.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const gn=ce(pn,[["__scopeId","data-v-86187920"]]),yn={class:"connectors-grid"},hn=M({__name:"ConnectorsView",setup(l){const a=Ae().params.projectId,e=new sn(a,new ln),r=B(null),y=B(!1),_=B({}),u=B(!1),S=H(()=>[...e.state.value.connectors.filter(p=>p.auth.type==="oauth2"),...e.state.value.connectors.filter(p=>p.auth.type==="tokens"),...e.state.value.connectors.filter(p=>p.auth.type==="ecdsa"),...e.state.value.connectors.filter(p=>p.auth.type==="manual")]),N=H(()=>e.state.value.connections.filter(p=>p&&p.name&&p.connectorTitle&&p.connectorType));e.fetchInitialState();function I(p){e.state.value.addingConnection&&(e.state.value.addingConnection.tokenValues=p)}function z(p){_.value=p}function j(){r.value=null,y.value=!1,_.value={}}async function d(){y.value=!0;try{const f=(await e.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");r.value=f}finally{y.value=!1}}async function g(){var f,m,x;const p=(f=e.state.value.addingConnection)==null?void 0:f.connector.auth.type;u.value=!0;try{switch(p){case"oauth2":return await e.handleAddConnectionSubmit();case"tokens":return await e.handleAddTokenConnectionSubmit();case"ecdsa":{const $=((m=e.state.value.addingConnection)==null?void 0:m.tokenValues)||{},R=(x=e.state.value.addingConnection)==null?void 0:x.connector.metadata.key;let V="";R==="starkbank"?V=$.projectId||"":R==="iugu"&&(V=$.apiToken||"");const D=await e.handleAddEcdsaConnectionSubmit(r.value,V);return j(),D}default:break}}catch($){const R=V=>{try{return JSON.parse(V),!0}catch{return!1}};if($ instanceof Error&&R($.message)){const V=ie.object({error:ie.string()}).safeParse(JSON.parse($.message));if(V.success){J.error(V.data.error);return}else{J.error(h.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:$ instanceof Error?$.message:"Unknown error"}));return}}else J.error(h.translate("i18n_connectorsview_failed_to_create"))}finally{u.value=!1}}function o(p){p.auth.type==="manual"?Ne.showNewMessage(h.translate("i18n_connectors_ask_for_access",null,p.metadata.label)):e.showAddConfirmationModal(p)}return(p,f)=>(c(),w(A,null,[s(n(Le),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:i(()=>[s(n(T),{align:"center",justify:"space-between"},{default:i(()=>[s(n(W),null,{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),s(n(q),null,{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_description"))+" ",1),s(ge)]),_:1}),N.value.length?(c(),v(n(T),{key:0,vertical:""},{default:i(()=>[s(n(W),{level:2},{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_installed")),1)]),_:1}),s(n(T),{vertical:"",gap:10},{default:i(()=>[(c(!0),w(A,null,P(N.value,m=>(c(),v(n(ue),{key:m.name},{default:i(()=>[s(n(T),{align:"center",gap:20},{default:i(()=>[s(n(re),{src:m.icon,height:"40px",shape:"square"},null,8,["src"]),s(n(L),{strong:""},{default:i(()=>[C(k(m.connectorTitle),1)]),_:2},1024),f[5]||(f[5]=F("div",{style:{"flex-grow":"1"}},null,-1)),s(n(L),{content:m.name,copyable:"",code:""},null,8,["content"]),s(n(Ue),null,{overlay:i(()=>[s(n(je),null,{default:i(()=>[s(n(se),{onClick:x=>n(e).handleEditConnectionClick(m)},{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_rename")),1)]),_:1},8,["onClick"]),s(n(se),{danger:"",onClick:x=>n(e).handleDeletionClick(m)},{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:i(()=>[s(n($e))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):U("",!0),s(n(T),{vertical:""},{default:i(()=>[N.value.length?(c(),v(n(W),{key:0,level:2},{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_available")),1)]),_:1})):U("",!0),F("div",yn,[(c(!0),w(A,null,P(S.value,m=>{var x;return c(),v(gn,{key:m.metadata.key,title:m.metadata.label,"logo-url":m.metadata.logoUrl,description:m.metadata.description,unavailable:m.auth.type==="manual",connector:m,"is-beta":(x=n(e).state.value.betaStatus[m.metadata.key])!=null?x:!1,onClick:$=>o(m)},null,8,["title","logo-url","description","unavailable","connector","is-beta","onClick"])}),128))])]),_:1})]),_:1}),s(n(G),{open:!!n(e).state.value.editingConnection,title:n(e).state.value.editingConnection?n(h).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:n(e).state.value.editingConnection.connectorTitle}):"",onCancel:f[2]||(f[2]=m=>n(e).state.value.editingConnection=null)},{footer:i(()=>[s(n(T),{justify:"end"},{default:i(()=>[s(Q,{disabled:!n(e).hasChanges.value,onClick:f[1]||(f[1]=m=>n(e).renameConnection())},{default:i(()=>[C(k(n(h).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[n(e).state.value.editingConnection?(c(),v(n(O),{key:0,value:n(e).state.value.editingConnection.newName,"onUpdate:value":f[0]||(f[0]=m=>n(e).state.value.editingConnection.newName=m)},null,8,["value"])):U("",!0)]),_:1},8,["open","title"]),s(dn,{"adding-connection":n(e).state.value.addingConnection,"ecdsa-public-key":r.value,"ecdsa-key-loading":y.value,"uploaded-files":_.value,loading:u.value,onCancel:f[3]||(f[3]=()=>{n(e).state.value.addingConnection=null,j()}),onSubmit:g,onScopeToggle:f[4]||(f[4]=(m,x)=>n(e).handleScopeToggle(m,x)),onGenerateEcdsaKey:d,"onUpdate:tokenValues":I,"onUpdate:uploadedFiles":z},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}});const jn=ce(hn,[["__scopeId","data-v-1458922f"]]);export{jn as default};
//# sourceMappingURL=ConnectorsView.60db8302.js.map

import{f as c,e7 as L,d as D,eb as N,O as $,L as _,r as f,em as B,k as P,a5 as V,b as m,u as i,aR as z,o as A,e as F,bR as S,g as O,de as h,cX as M,cL as C,_ as T}from"./jwt-decode.esm.f89dd07c.js";import{G}from"./PhDownloadSimple.vue.406157a6.js";import{e as H}from"./toggleHighContrast.65a90f2d.js";import"./router.346b4e1f.js";import{a as J}from"./project.8e4e11ef.js";import"./tables.fdeb573c.js";import{_ as U}from"./TablesTabs.vue_vue_type_script_setup_true_lang.bf20f39c.js";import"./index.dcf621f4.js";import"./record.72cfe869.js";import"./string.82d6ea4e.js";import"./Card.382a6738.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2a81735f-0426-4b09-89ff-e79b16b55dbd",e._sentryDebugIdIdentifier="sentry-dbid-2a81735f-0426-4b09-89ff-e79b16b55dbd")}catch{}})();var X={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};const W=X;function I(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),r.forEach(function(u){Y(e,u,t[u])})}return e}function Y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var x=function(n,t){var r=I({},n,t.attrs);return c(L,I({},r,{icon:W}),null)};x.displayName="CaretRightOutlined";x.inheritAttrs=!1;const Z=x,Q=e=>{if(e==null)return"";const n=String(e);return n.includes(";")||n.includes(`
`)||n.includes('"')?`"${n.replace(/"/g,'""')}"`:n},K=e=>{let n=e.columns.map(Q).join(";")+`
`;e.rows.forEach(r=>{n+=r.map(Q).join(";")+`
`});const t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURIComponent(n),t.target="_blank",t.download=`${e.fileName}.csv`,t.click()};function ee(e){const n={};for(const t in e)if(e.hasOwnProperty(t)){if(typeof e[t]=="object"&&e[t]!==null){n[t]=JSON.stringify(e[t]);continue}n[t]=String(e[t])}return n}const te=D({__name:"Sql",setup(e){const t=N().params.projectId,r=new $(_.array(_.object({projectId:_.string(),lastQuery:_.string()})),"lastQueries"),u=f(null),d=f(""),v=f([]),y=f([]),j=f([]),b=f(!1),w=()=>{const a=r.get();if(!a)r.set([{projectId:t,lastQuery:d.value}]);else{const o=a.findIndex(l=>l.projectId===t);o===-1?a.push({projectId:t,lastQuery:d.value}):a[o].lastQuery=d.value,r.set(a)}},k=async()=>{b.value=!0;const a=await J.executeQuery(t,d.value,[]);if(w(),b.value=!1,!a)return;const{returns:o,errors:l}=a;j.value=l;for(const s of l)C.error({message:"SQL Execution Failed",description:s});l.length||C.success({message:"SQL Execution Succeeded"}),y.value=o.fields.map(s=>({title:s.name,key:s.name,dataIndex:s.name})),v.value=o.result.map((s,p)=>ee({key:`${p+1}`,...s}))},R=()=>{const a=y.value.map(g=>g.dataIndex),o=y.value.map(g=>g.title),l=v.value.map(g=>a.map(E=>g[E])),p=`data-${new Date().toISOString()}`;K({fileName:p,columns:o,rows:l})},q=B.exports.debounce(w,1e3);return P(()=>{var l;const a=H.create(u.value,{language:"sql",value:d.value,fontFamily:"monospace",lineNumbers:"on",minimap:{enabled:!1},scrollbar:{vertical:"hidden",horizontal:"visible"},fontSize:14,scrollBeyondLastLine:!1,lineHeight:20});a.onDidChangeModelContent(()=>{d.value=a.getValue(),q()});const o=r.get();if(o){const s=(l=o.find(p=>p.projectId===t))==null?void 0:l.lastQuery;s&&(d.value=s,a.setValue(s))}}),(a,o)=>(A(),V(z,null,[c(U),c(i(h),{gap:"large",class:"sql-container",align:"center"},{default:m(()=>[F("div",{ref_key:"sqlEditor",ref:u,class:"sql-editor"},null,512),c(i(S),{type:"primary",loading:b.value,onClick:k},{icon:m(()=>[c(i(Z))]),default:m(()=>[O(" Run ")]),_:1},8,["loading"])]),_:1}),c(i(h),{justify:"end",style:{margin:"30px 0 10px 0"}},{default:m(()=>[c(i(S),{disabled:!v.value.length,onClick:R},{default:m(()=>[c(i(h),{align:"center",gap:"small"},{default:m(()=>[O(" Export to CSV "),c(i(G))]),_:1})]),_:1},8,["disabled"])]),_:1}),c(i(M),{style:{width:"100%"},scroll:{x:100},"data-source":v.value,columns:y.value},null,8,["data-source","columns"])],64))}});const me=T(te,[["__scopeId","data-v-3629dc62"]]);export{me as default};
//# sourceMappingURL=Sql.762f6a6d.js.map

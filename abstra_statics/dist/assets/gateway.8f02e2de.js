var w=Object.defineProperty;var y=(s,t,o)=>t in s?w(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o;var h=(s,t,o)=>(y(s,typeof t!="symbol"?t+"":t,o),o);import{l,L as g,B as b,D as E}from"./index.7923872d.js";import{p as T}from"./popupNotifcation.34f1e459.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="989a20b4-c7fe-4c44-8790-f61cf544fa44",s._sentryDebugIdIdentifier="sentry-dbid-989a20b4-c7fe-4c44-8790-f61cf544fa44")}catch{}})();const A=()=>window.location.host.includes(".abstra.io"),m={"cloud-api":"/api/cloud-api",onboarding:"https://onboarding.abstra.app"},C={"cloud-api":"https://cloud-api.abstra.cloud",onboarding:"https://onboarding.abstra.app"},f=s=>{const t="VITE_"+l.toUpper(l.snakeCase(s)),o={VITE_SENTRY_RELEASE:"c1371535ca1e4945d28eb79a387f458105ce2159",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}[t];return o||(A()?m[s]:C[s])},r={cloudApi:f("cloud-api"),onboarding:f("onboarding")};class O{constructor(){h(this,"storage");this.storage=new g(b.string(),"auth:jwt")}async authenticate(t){d.post("authn/authenticate",{email:t})}async verify(t,o){const n=await d.post("authn/verify",{email:t,token:o});if(!(n&&"jwt"in n))throw new Error("Invalid token");return this.saveJWT(n.jwt),this.getAuthor()}saveJWT(t){this.storage.set(t)}getAuthor(){const t=this.storage.get();if(t)try{const o=E(t);if(o.exp&&o.exp>Date.now()/1e3)return{jwt:t,claims:o}}catch{console.warn("Invalid JWT")}return null}removeAuthor(){this.storage.remove()}get headers(){const t=this.getAuthor();return t?{"Author-Authorization":`Bearer ${t.jwt}`}:{}}}const c=new O;class p extends Error{constructor(t,o){super(t),this.status=o}static async fromResponse(t){const o=await t.text();return new p(o,t.status)}}class d{static async get(t,o){const n=Object.fromEntries(Object.entries(o!=null?o:{}).filter(([,u])=>u!=null)),e=Object.keys(n).length>0?`?${new URLSearchParams(n).toString()}`:"",a=await fetch(`${r.cloudApi}/console/${t}${e}`,{headers:{...c.headers}});if(a.status===403){T("You are not authorized to access this resource","Click here to go back to the home page.",()=>{window.location.href="/"});return}const i=await a.text();return i?JSON.parse(i):null}static async getBlob(t){return await(await fetch(`${r.cloudApi}/console/${t}`,{headers:{...c.headers}})).blob()}static async post(t,o,n){const e=!!(n!=null&&n["Content-Type"])&&n["Content-Type"]!=="application/json",a=await fetch(`${r.cloudApi}/console/${t}`,{method:"POST",headers:{"Content-Type":"application/json",...c.headers,...n},body:e?o:JSON.stringify(o)});if(!a.ok)throw await p.fromResponse(a);const i=await a.text();return i?JSON.parse(i):null}static async postRaw(t,o,n){const e=!!(n!=null&&n["Content-Type"])&&n["Content-Type"]!=="application/json";return await fetch(`${r.cloudApi}/console/${t}`,{method:"POST",headers:{"Content-Type":"application/json",...c.headers,...n},body:e?o:JSON.stringify(o)})}static async patch(t,o){const n=await fetch(`${r.cloudApi}/console/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",...c.headers},body:JSON.stringify(o)});if(!n.ok)throw await p.fromResponse(n);const e=await n.text();return e?JSON.parse(e):null}static async delete(t){const o=await fetch(`${r.cloudApi}/console/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",...c.headers}});if(!o.ok)throw await p.fromResponse(o)}}export{d as C,r as E,c as a};
//# sourceMappingURL=gateway.8f02e2de.js.map

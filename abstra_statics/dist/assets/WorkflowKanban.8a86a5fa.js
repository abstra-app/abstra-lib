var ue=Object.defineProperty;var ie=(n,t,a)=>t in n?ue(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var U=(n,t,a)=>(ie(n,typeof t!="symbol"?t+"":t,a),a);import{t as de}from"./ant-design.5b99d5ae.js";import{f as i,eG as te,f1 as ce,r as $,G as j,E as fe,o as pe,K as me,d as M,F as ge,b as o,c as d,w as r,u as e,aq as y,eD as k,ex as b,ev as h,bq as S,eC as w,ci as ye,bg as ve,cC as F,bO as q,bH as _e,ad as E,cB as N,a as he,co as be,dm as X,e as V,cK as Se,ck as ke,v as we}from"./outputWidgets.4dca5506.js";import{a as B}from"./asyncComputed.c4b429e1.js";import{L as Ce,a as Oe}from"./log.3b3e7b78.js";import"./authorManager.a800075c.js";import"./index.78568e24.js";import{T as Ae}from"./index.2ae00943.js";import{A as ae}from"./index.9a994fbd.js";import{A as ne}from"./index.7d0729b5.js";import{A as z,a as Re}from"./Text.207bda18.js";import{D as xe,A as Ie}from"./index.4787c3b8.js";import{A as De}from"./Title.c9e508fd.js";import{_ as Pe}from"./SaveButton.vue_vue_type_script_setup_true_lang.c69d148f.js";import{A as re,C as le}from"./CollapsePanel.2b27d182.js";import{F as se}from"./Form.81f19b00.js";import{A as L}from"./FormItem.64e623f3.js";import{W as Te}from"./workspaces.c9a13f7f.js";import{F as Fe}from"./index.6bd85097.js";import{C as Ee}from"./Card.0106a046.js";import{E as Ne}from"./ExpandOutlined.3233739f.js";import{A as $e}from"./index.7f88509c.js";import"./index.154b4e51.js";import"./Modal.a47ec0ab.js";import"./gateway.c9180c86.js";import"./index.cf4c23b9.js";import"./record.7d38c825.js";import"./pubsub.8d119a65.js";import"./isNumeric.75337b1e.js";import"./hasIn.190f5047.js";import"./url.2dba12d6.js";import"./index.5dd92019.js";import"./index.894235cc.js";import"./TabPane.cc2d993c.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="35e39492-fa9a-43ef-b24e-cd24f7ac0b10",n._sentryDebugIdIdentifier="sentry-dbid-35e39492-fa9a-43ef-b24e-cd24f7ac0b10")}catch{}})();var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM641.7 520.8L442.3 677.6c-7.4 5.8-18.3.6-18.3-8.8V355.3c0-9.4 10.9-14.7 18.3-8.8l199.4 156.7a11.2 11.2 0 010 17.6z"}}]},name:"play-square",theme:"filled"};const Le=je;function Y(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(f){return Object.getOwnPropertyDescriptor(a,f).enumerable}))),l.forEach(function(f){Ue(n,f,a[f])})}return n}function Ue(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var W=function(t,a){var l=Y({},t,a.attrs);return i(te,Y({},l,{icon:ce}),null)};W.displayName="EyeOutlined";W.inheritAttrs=!1;const Ve=W;function Z(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(f){return Object.getOwnPropertyDescriptor(a,f).enumerable}))),l.forEach(function(f){ze(n,f,a[f])})}return n}function ze(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var J=function(t,a){var l=Z({},t,a.attrs);return i(te,Z({},l,{icon:Le}),null)};J.displayName="PlaySquareFilled";J.inheritAttrs=!1;const qe=J;function Be(n){switch(n.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"};case"abandoned":return{color:"warning",text:"Abandoned"}}}function Me(){const n=$({state:"closed"});function t(){n.value={state:"closed"}}function a(){n.value={state:"visualizations"}}function l(c,s){n.value={state:"stage-run",stageRun:s}}const f=j(()=>"stageRun"in n.value?n.value.stageRun:null);return{closeDrawer:t,openVisualizationEditor:a,inspectStageRun:l,drawerState:n,selectedStageRunForDrawer:f}}function We({getKanbanData:n,storage:t,getWorkspace:a}){const l=t!=null?t:localStorage;function f(){const m=l.getItem("kanban-selected-stage-ids");if(m)try{return JSON.parse(m)}catch{return[]}else return[]}const c=fe(f()),s=B(async()=>{try{const m=await n(c.value);return l.setItem("kanban-selected-stage-ids",JSON.stringify(c.value)),m}catch{return l.setItem("kanban-selected-stage-ids",JSON.stringify([])),{columns:[],next_stage_options:[]}}finally{c.value=f()}}),C=B(()=>a());async function A(m,u){m?c.value=[...c.value.slice(0,u),m]:c.value=c.value.slice(0,u),await s.refetch()}function R(m,u){var p;const _=(p=m.stages)==null?void 0:p.find(D=>D.id===m.selected_stage.id);if((_==null?void 0:_.type)==="form"){const D=(u==null?void 0:u.status)==="waiting"?{"abstra-run-id":u.id}:{};return{path:`/${_.path}`,query:D}}else return null}let O=null;function x(){pe(()=>{O=setInterval(()=>{s.refetch()},1e3)}),me(()=>{O&&clearInterval(O)})}const I=j(()=>{var u,_,p;const m=(_=(u=s.result.value)==null?void 0:u.columns)!=null?_:[];return(p=m[m.length-1])==null?void 0:p.selected_stage});return{kanbanAsyncComputed:s,selectedStageIds:c,setNewSelectedStageId:A,workspaceAsyncComputed:C,launchLink:R,lastSelectedStage:I,init:x}}const Je={key:2},Ge={key:3},Ke=M({__name:"StageRunInspector",props:{stageRun:{}},setup(n){const t=n,a=j(()=>t.stageRun?Array.from(new Set(t.stageRun.logs.map(s=>s.event))):[]),l=ge({filters:a.value}),f=j(()=>t.stageRun?t.stageRun.logs.filter(s=>s.payload&&l.filters.includes(s.event)):[]),c=s=>Oe.fromDTO({executionId:s.executionId,runtimeType:s.runtimeType,runtimeName:s.runtimeName,payload:s.payload,event:s.event,createdAt:new Date(s.createdAt*1e3),buildId:""});return(s,C)=>(o(),d(e(ae),{open:"",title:"Stage Run Inspector",size:"large"},{default:r(()=>{var A,R,O,x,I,m;return[i(e(z),null,{default:r(()=>[y(" Status: "),i(e(ne),{style:{"font-weight":"600"}},{default:r(()=>{var u;return[y(k((u=s.stageRun)==null?void 0:u.status),1)]}),_:1})]),_:1}),(A=s.stageRun)!=null&&A.assignee?(o(),d(e(z),{key:0},{default:r(()=>{var u;return[y(" Assignee: "+k((u=s.stageRun)==null?void 0:u.assignee),1)]}),_:1})):b("",!0),(R=s.stageRun)!=null&&R.created_at?(o(),d(e(z),{key:1},{default:r(()=>{var u;return[y(" Created at: "+k((u=s.stageRun)==null?void 0:u.created_at),1)]}),_:1})):b("",!0),((O=s.stageRun)==null?void 0:O.content)&&((x=s.stageRun)==null?void 0:x.content.length)>0?(o(),h("div",Je,[i(e(Ie),{title:"Stored data",size:"small",layout:"vertical",column:1},{default:r(()=>{var u;return[(o(!0),h(S,null,w((u=s.stageRun)==null?void 0:u.content,_=>(o(),d(e(xe),{key:_.key,label:_.key},{default:r(()=>{var p;return[y(k((p=_.value)!=null?p:"null"),1)]}),_:2},1032,["label"]))),128))]}),_:1})])):b("",!0),((I=s.stageRun)==null?void 0:I.logs)&&((m=s.stageRun)==null?void 0:m.logs.length)>0?(o(),h("div",Ge,[i(e(De),{level:4},{default:r(()=>[y("Logs")]),_:1}),i(e(ye),{value:l.filters,"onUpdate:value":C[0]||(C[0]=u=>l.filters=u),options:a.value},null,8,["value","options"]),i(e(Ae),null,{default:r(()=>[(o(!0),h(S,null,w(f.value,u=>(o(),d(Ce,{key:u.executionId,log:c(u)},null,8,["log"]))),128))]),_:1})])):b("",!0)]}),_:1}))}}),He=[{value:"text",label:"Text"},{value:"image",label:"Image"},{value:"table",label:"Table"},{value:"progress-bar",label:"Progress Bar"}];class ee{static async get(){return(await fetch("/_editor/api/visualizations")).json()}static async put(t){const a=await fetch("/_editor/api/visualizations",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return Object.freeze(a.json())}}function Qe(n,t){const a=n.length;if(a!==t.length)return!1;for(let l=0;l<a;l++)if(n[l].name!==t[l].name||n[l].type!==t[l].type)return!1;return!0}function T(n,t){var a;return{...n,id:(a=t==null?void 0:t.toString())!=null?a:Math.random().toString(36).slice(2)}}class G{constructor(t){U(this,"initialItems");U(this,"_items");this.initialItems=t.map((a,l)=>T(a,l)),this._items=$(t.map((a,l)=>T(a,l)))}get items(){return this._items.value}hasChanges(){return!Qe(this.initialItems,this.items)}async save(){const t=await ee.put(this.items);this.initialItems=t.map((a,l)=>T(a,l)),this._items.value=t.map((a,l)=>T(a,l))}static async get(){const t=await ee.get();return new G(t)}add(){this.items.push(T({name:"New var",type:"text"}))}remove(t){const a=this.items.findIndex(l=>l.id===t);a!==-1&&this.items.splice(a,1)}}const Xe=M({__name:"VisualizationEditor",setup(n){const{result:t,loading:a}=B(()=>G.get());return(l,f)=>(o(),d(e(ae),{open:"",title:"Visualization settings"},{extra:r(()=>[e(t)?(o(),d(Pe,{key:0,model:e(t),disabled:!e(t).hasChanges()},null,8,["model","disabled"])):b("",!0)]),default:r(()=>[e(a)||!e(t)?(o(),d(e(ve),{key:0})):(o(),d(e(F),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>[i(e(q),{onClick:f[0]||(f[0]=c=>e(t).add())},{default:r(()=>[y("Add")]),_:1}),i(e(le),{bordered:!1},{default:r(()=>[(o(!0),h(S,null,w(e(t).items,c=>(o(),d(e(re),{key:c.id},{header:r(()=>[c.name?(o(),d(e(Re),{key:0,strong:!0},{default:r(()=>[y(k(c.name),1)]),_:2},1024)):b("",!0)]),extra:r(()=>[i(e(q),{danger:"",onClick:s=>e(t).remove(c.id)},{default:r(()=>[y(" Remove ")]),_:2},1032,["onClick"])]),default:r(()=>[i(e(se),{layout:"vertical"},{default:r(()=>[i(e(L),{label:"Property name"},{default:r(()=>[i(e(_e),{value:c.name,"onUpdate:value":s=>c.name=s},null,8,["value","onUpdate:value"])]),_:2},1024),i(e(L),null,{default:r(()=>[i(e(E),{value:c.type,"onUpdate:value":s=>c.type=s,label:"Visualization type"},{default:r(()=>[(o(!0),h(S,null,w(e(He),s=>(o(),d(e(N),{key:s.value,value:s.value},{default:r(()=>[y(k(s.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1}))}}),oe=["waiting","running","finished","failed"];function Ye(){const n=$([...oe]),t=$("");return{filterStatus:n,filterSearch:t}}async function Ze(n){return(await fetch("/_editor/api/kanban",{method:"POST",body:JSON.stringify({selected_stages_ids:n}),headers:{"Content-Type":"application/json"}})).json()}const et={class:"stages-container"},tt={class:"stages-content"},at={style:{"max-height":"200px","overflow-y":"hidden"}},nt=M({__name:"WorkflowKanban",setup(n){const{kanbanAsyncComputed:t,launchLink:a,setNewSelectedStageId:l,lastSelectedStage:f,init:c}=We({getKanbanData:Ze,getWorkspace:()=>Te.get()}),{filterSearch:s,filterStatus:C}=Ye(),{closeDrawer:A,inspectStageRun:R,openVisualizationEditor:O,drawerState:x,selectedStageRunForDrawer:I}=Me();return c(),(m,u)=>{const _=he("router-link");return o(),h(S,null,[i(e($e),{vertical:"",style:{height:"100%"}},{default:r(()=>[i(e(le),{ghost:""},{default:r(()=>[i(e(re),{header:"Filters"},{default:r(()=>[i(e(se),null,{default:r(()=>[i(e(L),{label:"Search"},{default:r(()=>[i(e(be),{value:e(s),"onUpdate:value":u[0]||(u[0]=p=>X(s)?s.value=p:null),placeholder:"Search",style:{width:"400px"}},null,8,["value"])]),_:1}),i(e(L),{label:"Status"},{default:r(()=>[i(e(E),{value:e(C),"onUpdate:value":u[1]||(u[1]=p=>X(C)?C.value=p:null),mode:"multiple",style:{width:"400px"}},{default:r(()=>[(o(!0),h(S,null,w(e(oe),p=>(o(),d(e(N),{key:p,value:p},{default:r(()=>[y(k(e(Be)({status:p}).text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),V("div",et,[V("div",tt,[i(e(F),{align:"start"},{default:r(()=>{var p,D,K;return[(o(!0),h(S,null,w((D=(p=e(t).result.value)==null?void 0:p.columns)!=null?D:[],(g,H)=>(o(),d(e(F),{key:H,direction:"vertical"},{default:r(()=>[i(e(E),{style:{width:"100%","min-width":"200px"},"allow-clear":"",value:g.selected_stage.id,"onUpdate:value":v=>e(l)(v,H)},{default:r(()=>[(o(!0),h(S,null,w(g.stages,v=>(o(),d(e(N),{key:v.id,value:v.id},{default:r(()=>[y(k(v.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),g.selected_stage.id?(o(),d(e(F),{key:0,direction:"vertical",style:{width:"100%"}},{default:r(()=>[(o(!0),h(S,null,w(g.stage_run_cards,v=>{var Q;return o(),d(e(Ee),{key:v.id,size:"small",style:{"max-width":"250px",cursor:"pointer"},"body-style":{display:((Q=v.content)==null?void 0:Q.length)>0?"block":"none"},onClick:P=>e(R)(g,v)},{title:r(()=>[i(e(ne),null,{default:r(()=>[y(k(v.status),1)]),_:2},1024)]),default:r(()=>[V("div",at,[(o(!0),h(S,null,w(v.content,P=>(o(),d(e(Se),{key:P.key,"tree-data":e(de)(P.value)},null,8,["tree-data"]))),128))]),y(" "+k(v.assignee),1)]),actions:r(()=>[e(a)(g,v)?(o(),d(_,{key:0,to:e(a)(g,v),target:"_blank",onClick:u[2]||(u[2]=P=>P.stopPropagation())},{default:r(()=>[i(e(qe))]),_:2},1032,["to"])):b("",!0)]),extra:r(()=>[i(e(Ne),{onClick:P=>e(R)(g,v)},null,8,["onClick"])]),_:2},1032,["body-style","onClick"])}),128)),g.stage_run_cards.length===0?(o(),d(e(ke),{key:0})):b("",!0),g.selected_stage.can_be_started&&e(a)(g)!==null?(o(),d(_,{key:1,target:"_blank",to:e(a)(g)},{default:r(()=>[i(e(q),{style:{width:"100%"}},{default:r(()=>[y(" Start ")]),_:1})]),_:2},1032,["to"])):b("",!0)]),_:2},1024)):b("",!0)]),_:2},1024))),128)),e(t).result.value&&e(t).result.value.next_stage_options.length>0?(o(),d(e(E),{key:(K=e(f))==null?void 0:K.id,style:{width:"100%","min-width":"200px"},"allow-clear":"","onUpdate:value":u[3]||(u[3]=g=>e(l)(g,e(t).result.value.columns.length))},{default:r(()=>[(o(!0),h(S,null,w(e(t).result.value.next_stage_options,g=>(o(),d(e(N),{key:g.id,value:g.id},{default:r(()=>[y(k(g.title),1)]),_:2},1032,["value"]))),128))]),_:1})):b("",!0)]}),_:1})])])]),_:1}),e(x).state==="stage-run"&&e(I)?(o(),d(Ke,{key:0,"stage-run":e(I),onClose:e(A)},null,8,["stage-run","onClose"])):e(x).state==="visualizations"?(o(),d(Xe,{key:1,onClose:e(A)},null,8,["onClose"])):b("",!0),i(e(Fe),{onClick:e(O)},{icon:r(()=>[i(e(Ve))]),_:1},8,["onClick"])],64)}}});const Lt=we(nt,[["__scopeId","data-v-8cc79f02"]]);export{Lt as default};
//# sourceMappingURL=WorkflowKanban.8a86a5fa.js.map

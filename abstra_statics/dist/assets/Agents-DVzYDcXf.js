import{a as X,i as H,c as S,b as k,e as d,f as $e,g as P,h as m,m as De,db as z,dc as V,dd as je,de as ve,df as Ce,dg as Ie,dh as ce,di as Ze,ca as Se,dj as Ue,dk as Ee,r as T,H as Q,j as s,M as ae,W as ne,u as e,aL as ue,af as i,w as l,aP as Pe,S as D,U as A,aN as me,D as Ne,ak as U,p as R,b8 as J,aK as E,R as Fe,v as B,d1 as de,d as He,P as Oe,bk as ee,ac as Be,dl as Ye,k as qe,E as le,aj as re,aJ as Ge,bj as Je,b6 as Ke,bp as We,be as Qe,bf as Xe,bg as te,dm as et,bm as ye,aQ as oe,dn as tt,bt as at,a8 as nt}from"./jwt-decode.esm-DA54l3WF.js";import{_ as q}from"./AbstraButton.vue_vue_type_script_setup_true_lang-DLmrnZuN.js";import{C as st}from"./contracts.generated-BjtLxAmT.js";import{u as lt}from"./omniChatStore-56QDkVpg.js";import{I as Re}from"./PhDatabase.vue-DEBDld07.js";import{F as ie}from"./PhRocketLaunch.vue-pW4qblWP.js";import{G as rt}from"./PhSparkle.vue-B9T53x79.js";import{I as ot}from"./PhStop.vue-CO0kugpn.js";import{C as he}from"./connectors-Dkk3v9cL.js";import{T as it}from"./tables-CjMI_ziA.js";import{C as pe}from"./index-D4RDyKTV.js";import{C as K,l as ct,m as be}from"./router-CXcU3dXl.js";import{t as F,f as ut,a as we,l as dt}from"./index-Cl_mYw-u.js";import{L as pt,a as mt,A as ft}from"./index-Cm7fYbgP.js";import{S as xe}from"./index-CxirumsZ.js";import{L as gt}from"./LoadingOutlined-DhLvK0YL.js";import"./record-BEQm09bV.js";import"./uuid-DkUWzilU.js";import"./PhCopySimple.vue-jMjYEaPo.js";import"./string-BMTNQ0oa.js";import"./ts.worker-CaO7L5Fl.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[t]="8fc2f242-c97c-4258-8b13-027e8f702974",r._sentryDebugIdIdentifier="sentry-dbid-8fc2f242-c97c-4258-8b13-027e8f702974")}catch{}})();const _t=["width","height","fill","transform"],vt={key:0},yt=m("path",{d:"M137,168l11.52-11.51a12,12,0,0,0-17-17L120,151l-15-15,11.52-11.51a12,12,0,0,0-17-17L88,119,72.49,103.51a12,12,0,0,0-17,17L59,124,38.54,144.49a36,36,0,0,0,0,50.91l2.55,2.54L15.51,223.51a12,12,0,0,0,17,17l25.57-25.58,2.54,2.55a36.06,36.06,0,0,0,50.91,0L132,197l3.51,3.52a12,12,0,0,0,17-17ZM94.54,200.49a12,12,0,0,1-17,0L55.51,178.43a12,12,0,0,1,0-17L76,141l39,39Zm146-185a12,12,0,0,0-17,0L197.94,41.09l-2.54-2.55a36.05,36.05,0,0,0-50.91,0L124,59l-3.51-3.52a12,12,0,0,0-17,17l80,80a12,12,0,0,0,17-17L197,132l20.49-20.49a36,36,0,0,0,0-50.91l-2.55-2.54,25.58-25.57A12,12,0,0,0,240.49,15.51Zm-40,79L180,115,141,76l20.49-20.49a12,12,0,0,1,17,0l22.06,22.06a12,12,0,0,1,0,17Z"},null,-1),ht=[yt],bt={key:1},wt=m("path",{d:"M76,124l56,56-29,29a24,24,0,0,1-33.94,0L47,186.91A24,24,0,0,1,47,153ZM209,69.09,186.91,47A24,24,0,0,0,153,47L124,76l56,56,29-29A24,24,0,0,0,209,69.09Z",opacity:"0.2"},null,-1),xt=m("path",{d:"M149.66,138.34a8,8,0,0,0-11.32,0L120,156.69,99.31,136l18.35-18.34a8,8,0,0,0-11.32-11.32L88,124.69,69.66,106.34a8,8,0,0,0-11.32,11.32L64.69,124,41.37,147.31a32,32,0,0,0,0,45.26l5.38,5.37-28.41,28.4a8,8,0,0,0,11.32,11.32l28.4-28.41,5.37,5.38a32,32,0,0,0,45.26,0L132,191.31l6.34,6.35a8,8,0,0,0,11.32-11.32L131.31,168l18.35-18.34A8,8,0,0,0,149.66,138.34Zm-52.29,65a16,16,0,0,1-22.62,0L52.69,181.25a16,16,0,0,1,0-22.62L76,135.31,120.69,180Zm140.29-185a8,8,0,0,0-11.32,0l-28.4,28.41-5.37-5.38a32.05,32.05,0,0,0-45.26,0L124,64.69l-6.34-6.35a8,8,0,0,0-11.32,11.32l80,80a8,8,0,0,0,11.32-11.32L191.31,132l23.32-23.31a32,32,0,0,0,0-45.26l-5.38-5.37,28.41-28.4A8,8,0,0,0,237.66,18.34Zm-34.35,79L180,120.69,135.31,76l23.32-23.31a16,16,0,0,1,22.62,0l22.06,22A16,16,0,0,1,203.31,97.37Z"},null,-1),kt=[wt,xt],Lt={key:2},At=m("path",{d:"M149.66,149.66,131.31,168l18.35,18.34a8,8,0,0,1-11.32,11.32L132,191.31l-23.31,23.32a32.06,32.06,0,0,1-45.26,0l-5.37-5.38-28.4,28.41a8,8,0,0,1-11.32-11.32l28.41-28.4-5.38-5.37a32,32,0,0,1,0-45.26L64.69,124l-6.35-6.34a8,8,0,0,1,11.32-11.32L88,124.69l18.34-18.35a8,8,0,0,1,11.32,11.32L99.31,136,120,156.69l18.34-18.35a8,8,0,0,1,11.32,11.32Zm88-131.32a8,8,0,0,0-11.32,0l-28.4,28.41-5.37-5.38a32.05,32.05,0,0,0-45.26,0L124,64.69l-6.34-6.35a8,8,0,0,0-11.32,11.32l80,80a8,8,0,0,0,11.32-11.32L191.31,132l23.32-23.31a32,32,0,0,0,0-45.26l-5.38-5.37,28.41-28.4A8,8,0,0,0,237.66,18.34Z"},null,-1),Mt=[At],$t={key:3},Dt=m("path",{d:"M148.24,139.76a6,6,0,0,0-8.48,0L120,159.51,96.49,136l19.75-19.76a6,6,0,0,0-8.48-8.48L88,127.51,68.24,107.76a6,6,0,0,0-8.48,8.48L67.51,124,42.79,148.73a30,30,0,0,0,0,42.42l6.78,6.79L19.76,227.76a6,6,0,1,0,8.48,8.48l29.82-29.81,6.79,6.78a30,30,0,0,0,42.42,0L132,188.49l7.76,7.75a6,6,0,0,0,8.48-8.48L128.49,168l19.75-19.76A6,6,0,0,0,148.24,139.76Zm-49.45,65a18,18,0,0,1-25.46,0L51.27,182.67a18,18,0,0,1,0-25.46L76,132.49,123.51,180Zm137.45-185a6,6,0,0,0-8.48,0L197.94,49.57l-6.79-6.78a30,30,0,0,0-42.42,0L124,67.51l-7.76-7.75a6,6,0,0,0-8.48,8.48l80,80a6,6,0,0,0,8.48-8.48L188.49,132l24.72-24.73a30,30,0,0,0,0-42.42l-6.78-6.79,29.81-29.82A6,6,0,0,0,236.24,19.76Zm-31.51,79L180,123.51,132.49,76l24.72-24.73a18,18,0,0,1,25.46,0l22.06,22.06a18,18,0,0,1,0,25.46Z"},null,-1),Ct=[Dt],It={key:4},St=m("path",{d:"M149.66,138.34a8,8,0,0,0-11.32,0L120,156.69,99.31,136l18.35-18.34a8,8,0,0,0-11.32-11.32L88,124.69,69.66,106.34a8,8,0,0,0-11.32,11.32L64.69,124,41.37,147.31a32,32,0,0,0,0,45.26l5.38,5.37-28.41,28.4a8,8,0,0,0,11.32,11.32l28.4-28.41,5.37,5.38a32,32,0,0,0,45.26,0L132,191.31l6.34,6.35a8,8,0,0,0,11.32-11.32L131.31,168l18.35-18.34A8,8,0,0,0,149.66,138.34Zm-52.29,65a16,16,0,0,1-22.62,0L52.69,181.25a16,16,0,0,1,0-22.62L76,135.31,120.69,180Zm140.29-185a8,8,0,0,0-11.32,0l-28.4,28.41-5.37-5.38a32.05,32.05,0,0,0-45.26,0L124,64.69l-6.34-6.35a8,8,0,0,0-11.32,11.32l80,80a8,8,0,0,0,11.32-11.32L191.31,132l23.32-23.31a32,32,0,0,0,0-45.26l-5.38-5.37,28.41-28.4A8,8,0,0,0,237.66,18.34Zm-34.35,79L180,120.69,135.31,76l23.32-23.31a16,16,0,0,1,22.62,0l22.06,22A16,16,0,0,1,203.31,97.37Z"},null,-1),Pt=[St],Nt={key:5},Rt=m("path",{d:"M146.83,141.17a4,4,0,0,0-5.66,0L120,162.34,93.66,136l21.17-21.17a4,4,0,0,0-5.66-5.66L88,130.34,66.83,109.17a4,4,0,0,0-5.66,5.66L70.34,124,44.2,150.14a28,28,0,0,0,0,39.6l8.2,8.2L21.17,229.17a4,4,0,0,0,5.66,5.66L58.06,203.6l8.2,8.2a28,28,0,0,0,39.6,0L132,185.66l9.17,9.17a4,4,0,0,0,5.66-5.66L125.66,168l21.17-21.17A4,4,0,0,0,146.83,141.17Zm-46.63,65a20,20,0,0,1-28.28,0L49.86,184.08a20,20,0,0,1,0-28.28L76,129.66,126.34,180Zm134.63-185a4,4,0,0,0-5.66,0L197.94,52.4l-8.2-8.2a28,28,0,0,0-39.6,0L124,70.34l-9.17-9.17a4,4,0,0,0-5.66,5.66l80,80a4,4,0,0,0,5.66-5.66L185.66,132l26.14-26.14a28,28,0,0,0,0-39.6l-8.2-8.2,31.23-31.23A4,4,0,0,0,234.83,21.17ZM212,86.06a19.86,19.86,0,0,1-5.86,14.14L180,126.34,129.66,76,155.8,49.86a20,20,0,0,1,28.28,0l22.06,22.06A19.85,19.85,0,0,1,212,86.06Z"},null,-1),Tt=[Rt],Vt={name:"PhPlugs"},Te=X({...Vt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const t=r,n=H("weight","regular"),a=H("size","1em"),c=H("color","currentColor"),u=H("mirrored",!1),f=S(()=>t.weight??n),w=S(()=>t.size??a),y=S(()=>t.color??c),p=S(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(x,h)=>(d(),k("svg",De({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:y.value,transform:p.value},x.$attrs),[$e(x.$slots,"default"),f.value==="bold"?(d(),k("g",vt,ht)):f.value==="duotone"?(d(),k("g",bt,kt)):f.value==="fill"?(d(),k("g",Lt,Mt)):f.value==="light"?(d(),k("g",$t,Ct)):f.value==="regular"?(d(),k("g",It,Pt)):f.value==="thin"?(d(),k("g",Nt,Tt)):P("",!0)],16,_t))}}),zt=["width","height","fill","transform"],jt={key:0},Zt=m("path",{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},null,-1),Ut=[Zt],Et={key:1},Ft=m("path",{d:"M216,56V200a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V56A16,16,0,0,1,56,40H200A16,16,0,0,1,216,56Z",opacity:"0.2"},null,-1),Ht=m("path",{d:"M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"},null,-1),Ot=[Ft,Ht],Bt={key:2},Yt=m("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM184,136H136v48a8,8,0,0,1-16,0V136H72a8,8,0,0,1,0-16h48V72a8,8,0,0,1,16,0v48h48a8,8,0,0,1,0,16Z"},null,-1),qt=[Yt],Gt={key:3},Jt=m("path",{d:"M222,128a6,6,0,0,1-6,6H134v82a6,6,0,0,1-12,0V134H40a6,6,0,0,1,0-12h82V40a6,6,0,0,1,12,0v82h82A6,6,0,0,1,222,128Z"},null,-1),Kt=[Jt],Wt={key:4},Qt=m("path",{d:"M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"},null,-1),Xt=[Qt],ea={key:5},ta=m("path",{d:"M220,128a4,4,0,0,1-4,4H132v84a4,4,0,0,1-8,0V132H40a4,4,0,0,1,0-8h84V40a4,4,0,0,1,8,0v84h84A4,4,0,0,1,220,128Z"},null,-1),aa=[ta],na={name:"PhPlus"},Ve=X({...na,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const t=r,n=H("weight","regular"),a=H("size","1em"),c=H("color","currentColor"),u=H("mirrored",!1),f=S(()=>t.weight??n),w=S(()=>t.size??a),y=S(()=>t.color??c),p=S(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(x,h)=>(d(),k("svg",De({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:y.value,transform:p.value},x.$attrs),[$e(x.$slots,"default"),f.value==="bold"?(d(),k("g",jt,Ut)):f.value==="duotone"?(d(),k("g",Et,Ot)):f.value==="fill"?(d(),k("g",Bt,qt)):f.value==="light"?(d(),k("g",Gt,Kt)):f.value==="regular"?(d(),k("g",Wt,Xt)):f.value==="thin"?(d(),k("g",ea,aa)):P("",!0)],16,zt))}});function sa(r,t){z(2,arguments);var n=V(r),a=F(t);return isNaN(a)?new Date(NaN):(a&&n.setDate(n.getDate()+a),n)}function la(r,t){z(2,arguments);var n=V(r),a=F(t);if(isNaN(a))return new Date(NaN);if(!a)return n;var c=n.getDate(),u=new Date(n.getTime());u.setMonth(n.getMonth()+a+1,0);var f=u.getDate();return c>=f?u:(n.setFullYear(u.getFullYear(),u.getMonth(),c),n)}function W(r,t){if(z(2,arguments),!t||je(t)!=="object")return new Date(NaN);var n=t.years?F(t.years):0,a=t.months?F(t.months):0,c=t.weeks?F(t.weeks):0,u=t.days?F(t.days):0,f=t.hours?F(t.hours):0,w=t.minutes?F(t.minutes):0,y=t.seconds?F(t.seconds):0,p=V(r),x=a||n?la(p,a+n*12):p,h=u||c?sa(x,u+c*7):x,I=w+f*60,j=y+I*60,N=j*1e3,Z=new Date(h.getTime()+N);return Z}function ke(r){z(1,arguments);var t=V(r);return t.setHours(0,0,0,0),t}var ra=864e5;function oa(r,t){z(2,arguments);var n=ke(r),a=ke(t),c=n.getTime()-ve(n),u=a.getTime()-ve(a);return Math.round((c-u)/ra)}var ia=6e4,ca=36e5;function ua(r,t){z(2,arguments);var n=V(r),a=V(t);return n.getFullYear()-a.getFullYear()}function Le(r,t){var n=r.getFullYear()-t.getFullYear()||r.getMonth()-t.getMonth()||r.getDate()-t.getDate()||r.getHours()-t.getHours()||r.getMinutes()-t.getMinutes()||r.getSeconds()-t.getSeconds()||r.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function da(r,t){z(2,arguments);var n=V(r),a=V(t),c=Le(n,a),u=Math.abs(oa(n,a));n.setDate(n.getDate()-c*u);var f=+(Le(n,a)===-c),w=c*(u-f);return w===0?0:w}function pa(r,t,n){z(2,arguments);var a=Ce(r,t)/ca;return Ie()(a)}function ma(r,t,n){z(2,arguments);var a=Ce(r,t)/ia;return Ie()(a)}function fa(r,t){z(2,arguments);var n=V(r),a=V(t),c=ce(n,a),u=Math.abs(ua(n,a));n.setFullYear(1584),a.setFullYear(1584);var f=ce(n,a)===-c,w=c*(u-Number(f));return w===0?0:w}var ga=["years","months","weeks","days","hours","minutes","seconds"];function _a(r,t){var n,a,c,u,f;if(arguments.length<1)throw new TypeError("1 argument required, but only ".concat(arguments.length," present"));var w=Ze(),y=(n=(a=t?.locale)!==null&&a!==void 0?a:w.locale)!==null&&n!==void 0?n:Se,p=(c=t?.format)!==null&&c!==void 0?c:ga,x=(u=t?.zero)!==null&&u!==void 0?u:!1,h=(f=t?.delimiter)!==null&&f!==void 0?f:" ";if(!y.formatDistance)return"";var I=p.reduce(function(j,N){var Z="x".concat(N.replace(/(^.)/,function(v){return v.toUpperCase()})),C=r[N];return typeof C=="number"&&(x||r[N])?j.concat(y.formatDistance(Z,C)):j},[]).join(h);return I}function va(r){z(1,arguments);var t=V(r.start),n=V(r.end);if(isNaN(t.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(n.getTime()))throw new RangeError("End Date is invalid");var a={};a.years=Math.abs(fa(n,t));var c=ce(n,t),u=W(t,{years:c*a.years});a.months=Math.abs(Ue(n,u));var f=W(u,{months:c*a.months});a.days=Math.abs(da(n,f));var w=W(f,{days:c*a.days});a.hours=Math.abs(pa(n,w));var y=W(w,{hours:c*a.hours});a.minutes=Math.abs(ma(n,y));var p=W(y,{minutes:c*a.minutes});return a.seconds=Math.abs(Ee(n,p)),a}class ya{async listAgents(t){return await K.get(`projects/${t}/agents`)}async runAgent(t,n,a,c){return await K.post(`projects/${t}/agents/${n}/runs`,{prompt:a,permissions:c})}async listRuns(t,n){return await K.get(`projects/${t}/agents/${n}/runs`)}async getRun(t,n,a){return await K.get(`projects/${t}/agents/${n}/runs/${a}`)}async cancelRun(t,n,a){await K.delete(`projects/${t}/agents/${n}/runs/${a}`)}}const Ae={type:"array",description:"List of permissions for the agent",items:{oneOf:[{type:"object",title:"TablesPermission",properties:{type:{const:"tables"},action:{type:"string",enum:["insert","update","delete","select"]},tableName:{type:"string"},condition:{type:"object",additionalProperties:{type:"string"}}},required:["type","action","tableName"]},{type:"object",title:"FilesPermission",properties:{type:{const:"files"},action:{type:"string",enum:["read","write","delete"]},condition:{type:"string",description:"Glob pattern to match file paths"}},required:["type","action"]},{type:"object",title:"ConnectorsPermission",properties:{type:{const:"connections"},connectionName:{type:"string"},connectorType:{type:"string"},action:{type:"string"},condition:{type:"object",additionalProperties:{type:"string"}}},required:["type","connectionName","action"]}]}};function ha(r){return{name:"getPrompt",description:"Get the current prompt text that the user has entered in the agent form. Use this to understand what the user wants the agent to do.",payloadSchema:{type:"object",properties:{},required:[]},execute:async()=>({prompt:r.getPrompt()})}}function ba(r){return{name:"updatePermissions",description:`Update the agent permissions based on the user's prompt. Call this after reading the prompt to set appropriate permissions for the agent task. The permissions schema is: ${JSON.stringify(Ae)}`,payloadSchema:{type:"object",properties:{permissions:Ae},required:["permissions"]},execute:async t=>{const n=t.permissions;return r.setPermissions(n),{success:!0,permissionsCount:n.length,permissions:n}}}}function wa(r){return[ha(r),ba(r)]}const xa={class:"key-value-editor"},ka=X({__name:"KeyValueEditor",props:{modelValue:{}},emits:["update:modelValue"],setup(r,{emit:t}){const n=r,a=t,c=T([]);Q(()=>n.modelValue,y=>{if(!y){c.value=[];return}const p=c.value.reduce((x,h)=>(h.key&&(x[h.key]=h.value),x),{});JSON.stringify(p)!==JSON.stringify(y)&&(c.value=Object.entries(y).map(([x,h])=>({key:x,value:h})))},{immediate:!0,deep:!0}),Q(c,()=>{w()},{deep:!0});function u(){c.value.push({key:"",value:""})}function f(y){c.value.splice(y,1)}function w(){const y=c.value.reduce((p,x)=>(x.key&&(p[x.key]=x.value),p),{});a("update:modelValue",y)}return(y,p)=>(d(),k("div",xa,[(d(!0),k(ae,null,ne(c.value,(x,h)=>(d(),k("div",{key:h,class:"kv-row"},[s(e(ue),{value:x.key,"onUpdate:value":I=>x.key=I,placeholder:e(i).translate("i18n_agents_placeholder_key"),size:"small",style:{flex:"1"}},null,8,["value","onUpdate:value","placeholder"]),p[0]||(p[0]=m("span",{class:"separator"},":",-1)),s(e(ue),{value:x.value,"onUpdate:value":I=>x.value=I,placeholder:e(i).translate("i18n_agents_placeholder_value"),size:"small",style:{flex:"1"}},null,8,["value","onUpdate:value","placeholder"]),s(q,{type:"text",size:"small",danger:"",class:"remove-btn",onClick:I=>f(h)},{default:l(()=>[s(e(Pe))]),_:1},8,["onClick"])]))),128)),s(q,{type:"dashed",size:"small",block:"",onClick:u},{default:l(()=>[s(e(Ve)),D(" "+A(e(i).translate("i18n_agents_add_condition")),1)]),_:1})]))}}),Me=me(ka,[["__scopeId","data-v-30962401"]]),La={class:"permissions-editor"},Aa={key:0,class:"header"},Ma={class:"permissions-list"},$a={style:{"text-transform":"capitalize"}},Da={key:0,class:"permission-body"},Ca={key:1,class:"permission-body"},Ia={key:2,class:"permission-body"},Sa=X({__name:"PermissionsEditor",props:{modelValue:{},projectId:{}},emits:["update:modelValue"],setup(r,{expose:t,emit:n}){const a=r,c=n,u=T([]),f=T([]),w=T([]),y=T({}),p=T([]);Q(()=>a.modelValue,v=>{JSON.stringify(v)!==JSON.stringify(u.value)&&(u.value=JSON.parse(JSON.stringify(v||[])),u.value.forEach(M=>{M.type==="connections"&&M.connectionName&&N(M.connectionName,M.connectorType)}))},{immediate:!0,deep:!0}),Ne(async()=>{try{const v=await it.list(a.projectId);f.value=v.map(M=>({label:M.name,value:M.name})).sort((M,o)=>M.label.localeCompare(o.label))}catch(v){console.error("Failed to load tables",v)}try{const M=await new he().listConnections(a.projectId);p.value=M,w.value=M.map(o=>({label:o.name,value:o.name})).sort((o,b)=>o.label.localeCompare(b.label))}catch(v){console.error("Failed to load connections",v)}});function x(v){switch(v){case"tables":return Re;case"files":return de;case"connections":return Te;default:return de}}function h(v){switch(v){case"tables":return i.translate("i18n_agents_perm_type_table");case"files":return i.translate("i18n_agents_perm_type_file");case"connections":return i.translate("i18n_agents_perm_type_connection");default:return v}}function I(v){let M;if(v==="tables")M={type:"tables",action:void 0,tableName:"",condition:{}};else if(v==="files")M={type:"files",action:void 0,condition:""};else if(v==="connections")M={type:"connections",action:"",connectionName:"",connectorType:"",condition:{}};else return;u.value.push(M),C()}function j(v,M){M.action="";const o=p.value.find(b=>b.name===v);o&&(M.connectorType=o.connectionType,N(v,o.connectionType)),C()}async function N(v,M){if(!v||y.value[v])return;let o=M;if(o||(o=p.value.find(_=>_.name===v)?.connectionType),!!o)try{const _=await new he().getConnection(a.projectId,o,v);_.actions&&(y.value[v]=_.actions.map(O=>({label:O.name,value:O.name})).sort((O,se)=>O.label.localeCompare(se.label)))}catch(b){console.error("Failed to load connection actions",b)}}function Z(v){u.value.splice(v,1),C()}function C(){c("update:modelValue",u.value)}return t({addPermission:I}),(v,M)=>(d(),k("div",La,[u.value.length>0?(d(),k("div",Aa,[s(e(U),{strong:""},{default:l(()=>[D(A(e(i).translate("i18n_agents_permissions_title")),1)]),_:1})])):P("",!0),m("div",Ma,[(d(!0),k(ae,null,ne(u.value,(o,b)=>(d(),R(e(pe),{key:b,size:"small",class:"permission-card"},{title:l(()=>[s(e(B),{align:"center",gap:"8"},{default:l(()=>[(d(),R(Fe(x(o.type)),{class:"type-icon"})),m("span",$a,A(h(o.type)),1)]),_:2},1024)]),extra:l(()=>[s(q,{type:"text",danger:"",size:"small",onClick:_=>Z(b)},{default:l(()=>[s(e(Pe))]),_:1},8,["onClick"])]),default:l(()=>[o.type==="tables"?(d(),k("div",Da,[s(e(E),{label:e(i).translate("i18n_agents_label_table"),class:"mb-2"},{default:l(()=>[s(e(J),{value:o.tableName,"onUpdate:value":_=>o.tableName=_,options:f.value,placeholder:e(i).translate("i18n_agents_placeholder_select_table"),"show-search":"","option-filter-prop":"label",onChange:C},null,8,["value","onUpdate:value","options","placeholder"])]),_:2},1032,["label"]),s(e(E),{label:e(i).translate("i18n_agents_label_action"),class:"mb-2"},{default:l(()=>[s(e(J),{value:o.action,"onUpdate:value":_=>o.action=_,options:[{value:"select",label:e(i).translate("i18n_agents_perm_action_select")},{value:"insert",label:e(i).translate("i18n_agents_perm_action_insert")},{value:"update",label:e(i).translate("i18n_agents_perm_action_update")},{value:"delete",label:e(i).translate("i18n_agents_perm_action_delete")}],placeholder:e(i).translate("i18n_agents_placeholder_select_action"),"show-search":"","option-filter-prop":"label"},null,8,["value","onUpdate:value","options","placeholder"])]),_:2},1032,["label"]),s(e(E),{label:e(i).translate("i18n_agents_label_conditions"),class:"mb-0"},{default:l(()=>[s(Me,{modelValue:o.condition,"onUpdate:modelValue":[_=>o.condition=_,C]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])])):o.type==="files"?(d(),k("div",Ca,[s(e(E),{label:e(i).translate("i18n_agents_label_action"),class:"mb-2"},{default:l(()=>[s(e(J),{value:o.action,"onUpdate:value":_=>o.action=_,options:[{value:"read",label:e(i).translate("i18n_agents_perm_action_read")},{value:"write",label:e(i).translate("i18n_agents_perm_action_write")},{value:"delete",label:e(i).translate("i18n_agents_perm_action_delete")}],placeholder:e(i).translate("i18n_agents_placeholder_select_action"),"show-search":"","option-filter-prop":"label"},null,8,["value","onUpdate:value","options","placeholder"])]),_:2},1032,["label"]),s(e(E),{label:e(i).translate("i18n_agents_label_path_pattern"),class:"mb-0"},{default:l(()=>[s(e(ue),{value:o.condition,"onUpdate:value":_=>o.condition=_,placeholder:e(i).translate("i18n_agents_placeholder_glob_example"),onChange:C},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label"])])):o.type==="connections"?(d(),k("div",Ia,[s(e(E),{label:e(i).translate("i18n_agents_label_connection"),class:"mb-2"},{default:l(()=>[s(e(J),{value:o.connectionName,"onUpdate:value":_=>o.connectionName=_,options:w.value,placeholder:e(i).translate("i18n_agents_placeholder_select_connection"),"show-search":"","option-filter-prop":"label",onChange:_=>j(_,o)},null,8,["value","onUpdate:value","options","placeholder","onChange"])]),_:2},1032,["label"]),s(e(E),{label:e(i).translate("i18n_agents_label_action"),class:"mb-2"},{default:l(()=>[s(e(J),{value:o.action,"onUpdate:value":_=>o.action=_,options:y.value[o.connectionName]||[],placeholder:e(i).translate("i18n_agents_placeholder_select_action"),disabled:!o.connectionName,"show-search":"","option-filter-prop":"label",onChange:C},null,8,["value","onUpdate:value","options","placeholder","disabled"])]),_:2},1032,["label"]),s(e(E),{label:e(i).translate("i18n_agents_label_conditions"),class:"mb-0"},{default:l(()=>[s(Me,{modelValue:o.condition,"onUpdate:modelValue":[_=>o.condition=_,C]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])])):P("",!0)]),_:2},1024))),128))])]))}}),Pa=me(Sa,[["__scopeId","data-v-8765ad8b"]]),Y="new-run",Na=He("agents",()=>{const r=new ya,t="browser",n=T([]),a=T(null),c=T(null),u=T(!1),f=T(!1),w=Oe({prompt:"",permissions:[]});let y=null,p=null;async function x(o){f.value=!0;try{const b=await r.listRuns(o,t);n.value=b.runs||[]}catch(b){console.error("Failed to load runs",b)}finally{f.value=!1}}async function h(o,b){if(!b||b===Y){c.value=null;return}try{const _=await r.getRun(o,t,b);c.value=_}catch(_){console.error("Failed to fetch run details",_)}}function I(o){y||(x(o),y=window.setInterval(()=>x(o),1e4))}function j(){y&&(clearInterval(y),y=null)}function N(o){if(p)return;const b=()=>{a.value&&a.value!==Y&&h(o,a.value)};b(),p=window.setInterval(b,3e3)}function Z(){p&&(clearInterval(p),p=null)}async function C(o){if(w.prompt.trim()){u.value=!0;try{const b=await r.runAgent(o,t,w.prompt,w.permissions);ee.success({message:i.translate("i18n_agents_create_run_success")}),w.prompt="",await x(o),b.runId&&M(b.runId)}catch(b){ee.error({message:i.translate("i18n_agents_create_run_error"),description:b instanceof Error?b.message:String(b)})}finally{u.value=!1}}}async function v(o,b){try{await r.cancelRun(o,t,b),ee.success({message:i.translate("i18n_agents_cancel_run_success")}),await x(o),a.value===b&&await h(o,b)}catch(_){ee.error({message:i.translate("i18n_agents_cancel_run_error"),description:_ instanceof Error?_.message:String(_)})}}function M(o){a.value=o}return{runs:n,selectedRunId:a,selectedRunDetails:c,creatingRun:u,loadingRuns:f,createFormState:w,loadRuns:x,loadRunDetails:h,createRun:C,cancelRun:v,selectRun:M,startRunsPolling:I,stopRunsPolling:j,startDetailsPolling:N,stopDetailsPolling:Z}}),Ra={style:{padding:"16px"}},Ta={class:"icon-wrapper"},Va={style:{"font-weight":"500","font-size":"14px"}},za={class:"sidebar-runs-container",style:{flex:"1",overflow:"auto",padding:"0 8px 16px 8px",height:"100%"}},ja=["onClick"],Za={style:{display:"flex","align-items":"center",gap:"10px",overflow:"hidden"}},Ua={class:"run-title"},Ea={class:"run-time"},Fa={key:0,style:{flex:"1","overflow-y":"auto","overflow-x":"hidden",padding:"24px",background:"#fafafa","min-height":"0"}},Ha={style:{"max-width":"800px",margin:"0 auto"}},Oa={style:{"text-align":"center","margin-bottom":"32px"}},Ba={style:{background:"#fdeef0",width:"64px",height:"64px","border-radius":"16px",display:"flex","align-items":"center","justify-content":"center",margin:"0 auto 16px"}},Ya={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-top":"8px"}},qa={style:{display:"flex","align-items":"center",gap:"12px"}},Ga={style:{"font-size":"13px","margin-left":"4px"}},Ja={style:{"margin-top":"8px"}},Ka={key:1,style:{height:"100%",display:"flex","flex-direction":"column"}},Wa={style:{padding:"24px","border-bottom":"1px solid #f0f0f0","flex-shrink":"0"}},Qa={style:{display:"flex","justify-content":"space-between","align-items":"flex-start","margin-bottom":"16px"}},Xa={style:{flex:"1","overflow-y":"auto","overflow-x":"hidden",padding:"24px",background:"#fafafa","min-height":"0",height:"0"}},en={key:0,style:{"text-align":"center",color:"#999",padding:"40px"}},tn={class:"step-card"},an={class:"step-header"},nn={key:0,class:"step-body"},sn={key:0,class:"step-screenshot"},ln={key:2,style:{height:"100%",display:"flex","align-items":"center","justify-content":"center"}},rn=X({__name:"Agents",setup(r){const n=Be().params.projectId,a=Na(),c=T(null),u=lt();u.init("console",n);function f(){return i.getLocale()==="pt"?dt:Se}const{runs:w,selectedRunId:y,selectedRunDetails:p,creatingRun:x,createFormState:h}=Ye(a),I=S(()=>h.value.prompt.trim().length<40||!st.safeParse(h.value.permissions).success?!1:h.value.permissions.every(L=>L.type==="tables"?!!L.tableName:L.type==="connections"?!!L.connectionName&&!!L.action:!0));Ne(()=>{a.selectRun(Y),a.startRunsPolling(n)}),qe(()=>{a.stopRunsPolling(),a.stopDetailsPolling()}),Q(y,async g=>{g&&g!==Y?await a.loadRunDetails(n,g):a.stopDetailsPolling()});const j=()=>({getPrompt:()=>h.value.prompt,getPermissions:()=>h.value.permissions,setPermissions:g=>{h.value.permissions=g}});function N(g){const L=g.key;L==="generate-ai"?Z():c.value?.addPermission(L)}async function Z(){if(!h.value.prompt.trim()){nt.warning({title:i.translate("i18n_agents_generate_ai_no_prompt_title"),content:i.translate("i18n_agents_generate_ai_no_prompt_content")});return}const g=u.controller;if(!g){console.error("SmartChatController not available");return}try{const L=j(),$=wa(L);g.clearBrowserTools(),g.registerBrowserTools($);const G=`Você deve analisar o prompt de um agente e gerar as permissões necessárias para ele executar a tarefa.

IMPORTANTE: Siga estes passos na ordem:

1. Use a ferramenta "getPrompt" para ler o prompt atual do agente.

2. Use a ferramenta "list_connections" para ver quais conexões estão disponíveis no projeto.

3. Se o prompt mencionar integrações (Slack, Salesforce, Google, etc), use "search_connection_actions" para encontrar as ações relevantes para cada conexão.

4. Baseado no prompt e nas conexões/ações disponíveis, use a ferramenta "updatePermissions" para configurar as permissões.

As permissões podem ser do tipo:
- tables: para acessar tabelas (ações: insert, update, delete, select)
- files: para acessar arquivos (ações: read, write, delete)
- connections: para usar conexões externas - use o nome exato da conexão retornado por list_connections

Comece agora usando a ferramenta getPrompt para ler o prompt do agente.`;u.open(),g.setInput(G),await g.send()}catch(L){console.error("Error generating permissions with AI:",L)}}function C(){a.createRun(n)}function v(g){a.cancelRun(n,g)}function M(g){switch(g){case"running":return"#3b82f6";case"completed":return"#10b981";case"failed":return"#ef4444";case"pending":return"#f59e0b";default:return"#9ca3af"}}function o(g){switch(g){case"running":return i.translate("i18n_agents_status_running");case"completed":return i.translate("i18n_agents_status_completed");case"failed":return i.translate("i18n_agents_status_failed");case"pending":return i.translate("i18n_agents_status_pending");default:return i.translate("i18n_agents_status_unknown")}}function b(g){switch(g){case"success":return"#10b981";case"error":return"#ef4444";case"running":return"#3b82f6";case"tool_call":return"#8b5cf6";case"cancelled":case"timeout":return"#f59e0b";default:return"#9ca3af"}}const _=S(()=>p.value?w.value?.find(L=>L.runId===p.value?.runId)?.status||p.value.status:"unknown"),O=S(()=>["running","pending"].includes(_.value));Q(_,g=>{g&&["running","pending"].includes(g)?a.startDetailsPolling(n):a.stopDetailsPolling()},{immediate:!0});const se=S(()=>p.value?.prompt||""),fe=S(()=>{const g=p.value?.result;return g?typeof g=="string"?g:JSON.stringify(g,null,2):""}),ge=S(()=>p.value?.steps||[]),_e=S(()=>{if(!p.value)return"";const g=new Date(p.value.startedAt),L=p.value.completedAt?new Date(p.value.completedAt):new Date,$=va({start:g,end:L});return _a($,{format:["minutes","seconds"]})||"< 1s"});function ze(g){return g.startsWith("data:image")?g:`data:image/png;base64,${g}`}return(g,L)=>(d(),R(e(ft),{class:"agents-view",style:{height:"100%"}},{default:l(()=>[e(w)&&e(w).length>0?(d(),R(e(pt),{key:0,width:"260",theme:"light",style:{"border-right":"1px solid #f0f0f0",display:"flex","flex-direction":"column",overflow:"hidden"}},{default:l(()=>[m("div",Ra,[m("div",{class:le(["new-run-button",{active:e(y)===e(Y)}]),onClick:L[0]||(L[0]=$=>e(a).selectRun(e(Y)))},[s(e(B),{align:"center",gap:12},{default:l(()=>[m("div",Ta,[s(e(ie),{size:16})]),m("span",Va,A(e(i).translate("i18n_agents_create_button")),1)]),_:1})],2)]),m("div",za,[(d(!0),k(ae,null,ne(e(w)||[],$=>(d(),k("div",{key:$.runId,class:le(["sidebar-run-item",{active:e(y)===$.runId}]),onClick:G=>e(a).selectRun($.runId)},[s(e(B),{align:"center",justify:"space-between",style:{width:"100%"}},{default:l(()=>[m("div",Za,[m("div",{class:le(["status-dot",$.status])},null,2),m("span",Ua,A($.prompt),1)]),m("span",Ea,A($.startedAt?e(ut)(new Date($.startedAt),{addSuffix:!0,locale:f()}):""),1)]),_:2},1024)],10,ja))),128))])]),_:1})):P("",!0),s(e(mt),{style:{background:"#fff",display:"flex","flex-direction":"column",overflow:"hidden","min-height":"0"}},{default:l(()=>[e(y)===e(Y)?(d(),k("div",Fa,[m("div",Ha,[m("div",Oa,[m("div",Ba,[s(e(ie),{style:{"font-size":"32px",color:"#ea576a"}})]),s(e(re),{level:2,style:{"margin-bottom":"8px","margin-top":"0"}},{default:l(()=>[D(A(e(i).translate("i18n_agents_create_button")),1)]),_:1}),s(e(U),{type:"secondary",style:{"font-size":"15px"}},{default:l(()=>[D(A(e(i).translate("i18n_agents_description")),1)]),_:1})]),s(e(Ge),{layout:"vertical"},{default:l(()=>[s(e(E),null,{default:l(()=>[s(e(Je),{value:e(h).prompt,"onUpdate:value":L[1]||(L[1]=$=>e(h).prompt=$),rows:6,placeholder:e(i).translate("i18n_agents_field_prompt_placeholder"),style:{"border-radius":"8px","font-size":"15px","border-color":"#d9d9d9",padding:"12px"},onKeydown:L[2]||(L[2]=Ke(We($=>I.value&&C(),["ctrl"]),["enter"]))},null,8,["value","placeholder"]),m("div",Ya,[m("div",qa,[s(e(Qe),{trigger:["click"]},{overlay:l(()=>[s(e(Xe),{onClick:N},{default:l(()=>[s(e(te),{key:"tables"},{default:l(()=>[s(e(B),{gap:"8",align:"center"},{default:l(()=>[s(e(Re)),D(" "+A(e(i).translate("i18n_agents_perm_type_table")),1)]),_:1})]),_:1}),s(e(te),{key:"files"},{default:l(()=>[s(e(B),{gap:"8",align:"center"},{default:l(()=>[s(e(de)),D(" "+A(e(i).translate("i18n_agents_perm_type_file")),1)]),_:1})]),_:1}),s(e(te),{key:"connections"},{default:l(()=>[s(e(B),{gap:"8",align:"center"},{default:l(()=>[s(e(Te)),D(" "+A(e(i).translate("i18n_agents_perm_type_connection")),1)]),_:1})]),_:1}),s(e(et)),s(e(te),{key:"generate-ai"},{default:l(()=>[s(e(B),{gap:"8",align:"center"},{default:l(()=>[s(e(rt)),D(" "+A(e(i).translate("i18n_agents_generate_with_ai")),1)]),_:1})]),_:1})]),_:1})]),default:l(()=>[s(q,{type:"text",size:"small"},{default:l(()=>[s(e(Ve)),m("span",Ga,A(e(i).translate("i18n_agents_add_permission")),1)]),_:1})]),_:1}),e(h).prompt.length>0&&e(h).prompt.length<40?(d(),R(e(U),{key:0,type:"secondary",style:{"font-size":"12px"}},{default:l(()=>[D(A(e(h).prompt.length)+"/40 ",1)]),_:1})):P("",!0)]),s(e(U),{type:"secondary",style:{"font-size":"12px"}},{default:l(()=>[s(e(U),{code:""},{default:l(()=>[...L[5]||(L[5]=[D("Ctrl + Enter",-1)])]),_:1}),L[6]||(L[6]=D(" para rodar ",-1))]),_:1})])]),_:1}),s(Pa,{ref_key:"permissionsEditorRef",ref:c,modelValue:e(h).permissions,"onUpdate:modelValue":L[3]||(L[3]=$=>e(h).permissions=$),"project-id":e(n)},null,8,["modelValue","project-id"]),m("div",Ja,[s(q,{type:"primary",size:"large",loading:e(x),disabled:!I.value,style:{width:"100%",height:"48px","border-radius":"8px","font-weight":"600"},onClick:C},{default:l(()=>[s(e(ie),{style:{"font-size":"20px"}}),D(" "+A(e(i).translate("i18n_agents_create_button")),1)]),_:1},8,["loading","disabled"])])]),_:1})])])):e(p)?(d(),k("div",Ka,[m("div",Wa,[m("div",Qa,[m("div",null,[s(e(re),{level:3,style:{"margin-bottom":"8px","margin-top":"0"}},{default:l(()=>[D(A(e(i).translate("i18n_agents_details_run_prefix"))+" #"+A(e(p).runId.slice(0,8)),1)]),_:1}),s(e(xe),null,{default:l(()=>[s(e(ye),{color:M(_.value)},{default:l(()=>[D(A(o(_.value)),1)]),_:1},8,["color"]),s(e(U),{type:"secondary"},{default:l(()=>[D(A(e(i).translate("i18n_agents_details_started"))+" "+A(e(we)(new Date(e(p).startedAt),"dd/MM/yyyy HH:mm:ss")),1)]),_:1}),_e.value?(d(),R(e(U),{key:0,type:"secondary"},{default:l(()=>[D(A(e(i).translate("i18n_agents_details_duration"))+" "+A(_e.value),1)]),_:1})):P("",!0)]),_:1})]),["running","pending"].includes(_.value)?(d(),R(q,{key:0,danger:"",onClick:L[4]||(L[4]=$=>v(e(p).runId))},{default:l(()=>[s(e(ot)),D(" "+A(e(i).translate("i18n_agents_action_cancel")),1)]),_:1})):P("",!0)])]),m("div",Xa,[s(e(xe),{direction:"vertical",size:"large",style:{width:"100%"}},{default:l(()=>[s(e(pe),{title:e(i).translate("i18n_agents_section_prompt"),size:"small",bordered:!1},{default:l(()=>[s(e(oe),{style:{"white-space":"pre-wrap","font-family":"monospace","margin-bottom":"0"}},{default:l(()=>[D(A(se.value),1)]),_:1})]),_:1},8,["title"]),fe.value?(d(),R(e(pe),{key:0,title:e(i).translate("i18n_agents_section_response"),size:"small",bordered:!1,style:{border:"1px solid #b7eb8f",background:"#f6ffed"}},{default:l(()=>[s(e(oe),{style:{"white-space":"pre-wrap","font-family":"monospace","margin-bottom":"0",color:"#333"}},{default:l(()=>[D(A(fe.value),1)]),_:1})]),_:1},8,["title"])):P("",!0),m("div",null,[s(e(re),{level:5,style:{"margin-bottom":"16px","margin-top":"0"}},{default:l(()=>[D(A(e(i).translate("i18n_agents_section_messages")),1)]),_:1}),ge.value.length===0&&!O.value?(d(),k("div",en,A(e(i).translate("i18n_agents_empty_messages")),1)):(d(),R(e(ct),{key:1,mode:"alternate"},{default:l(()=>[(d(!0),k(ae,null,ne(ge.value,($,G)=>(d(),R(e(be),{key:G,color:b($.status)},{default:l(()=>[m("div",tn,[m("div",an,[s(e(ye),{color:b($.status),size:"small"},{default:l(()=>[D(" STEP "+A(G+1),1)]),_:2},1032,["color"]),s(e(U),{type:"secondary",style:{"font-size":"11px"}},{default:l(()=>[D(A(e(we)(new Date($.timestamp),"HH:mm:ss")),1)]),_:2},1024)]),$.screenshotBase64||$.message?(d(),k("div",nn,[$.screenshotBase64?(d(),k("div",sn,[s(e(tt),{src:ze($.screenshotBase64),alt:"Screenshot"},null,8,["src"])])):P("",!0),$.message?(d(),R(e(oe),{key:1,ellipsis:{rows:4,expandable:!0,symbol:"ver mais"},class:"step-message"},{default:l(()=>[D(A($.message),1)]),_:2},1024)):P("",!0)])):P("",!0)])]),_:2},1032,["color"]))),128)),O.value?(d(),R(e(be),{key:0,color:"blue"},{dot:l(()=>[s(e(gt),{spin:"",style:{"font-size":"16px"}})]),default:l(()=>[s(e(U),{type:"secondary"},{default:l(()=>[D(A(e(i).translate("i18n_agents_processing")),1)]),_:1})]),_:1})):P("",!0)]),_:1}))])]),_:1})])])):(d(),k("div",ln,[s(e(at),{description:e(i).translate("i18n_agents_select_run_hint")},null,8,["description"])]))]),_:1})]),_:1}))}}),Cn=me(rn,[["__scopeId","data-v-d88e23d2"]]);export{Cn as default};
//# sourceMappingURL=Agents-DVzYDcXf.js.map

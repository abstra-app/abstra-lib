var ye=Object.defineProperty;var me=(n,e,t)=>e in n?ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var D=(n,e,t)=>(me(n,typeof e!="symbol"?e+"":e,t),t);import{u as U}from"./uuid.7380841a.js";import{F as se,d as F,r as g,S as H,G as O,b as d,eu as y,e as r,ey as B,eE as ne,eF as ae,t as z,eB as we,H as be,a3 as Ce,o as oe,K as re,a as ie,f as i,u as s,I as x,aq as _,eD as R,ew as T,ev as ke,a_ as le,eC as Se,c as I,eQ as Ie,eV as Ee,w as c,bU as L,cF as J,cB as xe,bN as q}from"./outputWidgets.ee623de8.js";import{s as G,n as Y,o as Q,g as Te,q as Ae,e as Re}from"./icons.2279e506.js";import{l as $e}from"./DocsButton.vue_vue_type_script_setup_true_lang.c1b2b7d1.js";import{b as je,c as X,A as De}from"./Text.c71af019.js";import{a as Z}from"./asyncComputed.fd0b57c5.js";import{J as Le}from"./jobs.bba04e51.js";import{W as Be}from"./workspaces.d1b5ba34.js";import{A as Oe}from"./record.5f64c9de.js";import{A as ee}from"./Base.9d7d2b7a.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="53d10820-d711-4a45-8792-ae6a46400db1",n._sentryDebugIdIdentifier="sentry-dbid-53d10820-d711-4a45-8792-ae6a46400db1")}catch{}})();class Fe{async list(){return await(await fetch("/_editor/api/scripts")).json()}async create(){return await(await fetch("/_editor/api/scripts",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}async get(e){return await(await fetch(`/_editor/api/scripts/${e}`)).json()}async update(e,t){return await(await fetch(`/_editor/api/scripts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async delete(e){await fetch(`/_editor/api/scripts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async test(e){return(await fetch(`/_editor/api/scripts/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()}}const S=new Fe;class A{constructor(e){D(this,"record");this.record=Oe.create(S,e)}static async list(){return(await S.list()).map(t=>new A(t))}static async create(){const e=await S.create();return new A(e)}static async get(e){const t=await S.get(e);return new A(t)}async delete(){await S.delete(this.id)}async duplicate(){return this}async save(){await this.record.save()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(e){return this.record.hasChanges(e)}get id(){return this.record.get("id")}get schedule(){return this.record.get("schedule")}set schedule(e){this.record.set("schedule",e)}get title(){return this.record.get("title")}set title(e){this.record.set("title",e)}get file(){return this.record.get("file")}set file(e){this.record.set("file",e)}get path(){return this.record.get("path")}set path(e){this.record.set("path",e)}async test(){return S.test(this.id)}get position(){const[e,t]=this.record.get("workflow_position");return{x:e,y:t,referential:"world"}}get isInitial(){return!1}}class ce{constructor(){D(this,"logState",se({log:[]}));D(this,"_listeners",{})}static create(){return new ce}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const a=t?this.logs.find(u=>u.id===t):null;return a?Object.assign(a,e):this.logs.push({...e,id:t||U()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=U();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class Ne{static async*sendMessage(e,t){var h;const u=(h=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:h.getReader();if(!u)throw new Error("No response body");for(;;){const l=await u.read();if(l.done)break;yield new TextDecoder().decode(l.value)}}}const Pe=n=>(ne("data-v-59ca7295"),n=n(),ae(),n),Ve=Pe(()=>r("div",{class:"text"}," Changes were made in your code. Click Restart to refresh the preview window. ",-1)),te="ignoreCodeChangesWarning",Ue=F({__name:"ChangesWarning",props:{hasChanges:{type:Boolean}},setup(n){var h;const e=n,t=g((h=H.get(te))!=null?h:!1),a=O(()=>e.hasChanges&&!t.value),u=()=>{H.set(te,!0),t.value=!0};return(l,v)=>(d(),y("div",{class:B(["changes-warning",{visible:a.value}])},[Ve,r("div",{class:"no-more-alert",onClick:u},"Do not show again")],2))}});const ze=z(Ue,[["__scopeId","data-v-59ca7295"]]),Me=n=>(ne("data-v-fa74f10a"),n=n(),ae(),n),We={class:"smart-console"},Ke={class:"header"},He={class:"left"},Je={class:"right"},qe={class:"changes-container"},Ge=["unseen-severity"],Ye={class:"cli"},Qe={class:"left"},Xe=Me(()=>r("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Ze={key:1,class:"local-entry"},et={class:"input"},tt=["pointer-events","onKeydown"],st={class:"right"},nt=F({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(n,{emit:e}){const t=n,a=g(""),u=g(null),h=we(),l=g({type:"seen"}),v=g(!1),p=g(!1),f=()=>{t.logService.clear(),e("restart")},$=()=>{E.value=E.value==="assistant"?"debugger":"assistant"};function b(o){switch(o.type){case"ai-input":return{role:"user",content:o.log};case"ai-output":return{role:"assistant",content:o.log};case"stderr":case"stdout":return{role:"user",content:o.log};case"restart":return{role:"user",content:"-- new session --"};case"files-changed":return{role:"user",content:"-- files changed --"};default:throw new Error(`Unknown log type: ${o.type}`)}}const ue=O(()=>t.logService.logs.some(o=>o.type==="files-changed"));function de(){C.value=!C.value,C.value&&(l.value={type:"seen"})}be(h,()=>{t.logService.clear(),e("clear-terminal")});const j=g(null),E=g("assistant"),pe=async o=>{var w;if(o.preventDefault(),a.value=((w=j.value)==null?void 0:w.innerText)||"",o.shiftKey){document.execCommand("insertLineBreak");return}j.value&&(j.value.innerText=""),E.value==="assistant"?await he():await ge()},he=async()=>{var w;if(e("enter",a.value),t.logService.log({type:"ai-input",log:a.value}),a.value="",!p.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}v.value=!0;const o={role:"user",content:(w=t.formCode)!=null?w:""};try{const k=U();let m="";const P=Ne.sendMessage([o,...t.logService.logs.map(V=>b(V)),{role:"user",content:a.value}],t.runtime);for await(const V of P)m+=V,t.logService.log({type:"ai-output",log:m},k)}catch(k){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(k),Ee(k)}finally{v.value=!1}},ge=async()=>{a.value&&(t.logService.log({type:"eval-input",log:`>>> ${a.value}`}),e("eval-request",a.value),a.value="")},ve=()=>{t.logService.clear()};t.logService.listen(async o=>{C.value||(l.value={type:"unseen",count:l.value.type==="unseen"?l.value.count+1:1,severity:o.type==="stderr"?"error":"info"}),o.type!=="restart"&&(await Ce(),u.value&&(u.value.scrollTop=u.value.scrollHeight))});const C=g(!1),M=g(400),fe=O(()=>({height:`${M.value}px`})),N=g(!1),_e=()=>N.value=!0,W=o=>{!N.value||(M.value=document.body.clientHeight-o.clientY)},K=()=>N.value=!1;return oe(()=>{document.addEventListener("mousemove",W),document.addEventListener("mouseup",K),$e.get().then(o=>{p.value=!!o.logged})}),re(()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",K)}),(o,w)=>{const k=ie("Markdown");return d(),y("div",We,[r("div",Ke,[r("div",He,[i(x,{path:E.value==="assistant"?s(G):s(Y)},null,8,["path"]),_(" Smart Console ")]),r("div",Je,[r("div",qe,[i(ze,{"has-changes":ue.value},null,8,["has-changes"]),r("button",{class:"header-button",onClick:f},"Restart")]),r("div",{class:"toggle-button",onClick:de},[i(x,{class:B(["icon",{open:C.value}]),path:s(Q),fill:"#fff"},null,8,["class","path"]),l.value.type==="unseen"?(d(),y("div",{key:0,class:"unseen-count","unseen-severity":l.value.severity},R(l.value.count),9,Ge)):T("",!0)])])]),C.value?(d(),y("div",{key:0,class:"terminal",style:ke(fe.value)},[r("div",{class:"resize-handler",onMousedown:_e},null,32),r("div",Ye,[r("div",Qe,[r("div",{ref_key:"entriesContainer",ref:u,class:"entries"},[Xe,(d(!0),y(le,null,Se(t.logService.logs,(m,P)=>(d(),y("div",{key:P,class:B([m.type,"entry"])},[m.type==="ai-output"?(d(),I(k,{key:0,source:m.log},null,8,["source"])):(d(),y("div",Ze,R(m.type==="restart"?"-- restarted --":m.log),1))],2))),128))],512),r("div",et,[i(x,{class:B(["icon",{open:C.value}]),path:s(Q)},null,8,["class","path"]),r("div",{ref_key:"inputRef",ref:j,class:"input-text",contenteditable:"","pointer-events":v.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:Ie(pe,["enter"])},null,40,tt)])]),r("div",st,[r("div",{class:"icons",onClick:ve},[i(x,{class:"icon",path:s(Te)},null,8,["path"])]),r("div",null,[i(x,{class:"icon clickable",path:E.value==="assistant"?s(G):s(Y),onClick:w[0]||(w[0]=m=>$())},null,8,["path"])])])])],4)):T("",!0)])}}});const yt=z(nt,[["__scopeId","data-v-fa74f10a"]]),mt=F({__name:"Debugger",setup(n){async function e(){const l=await fetch("/_editor/api/debugger",{method:"GET"});if(!l.ok)throw new Error("Failed to check debugger connection");return await l.json()}async function t(){await fetch("/_editor/api/debugger/vscode-launch",{method:"POST"}),u()}const a=g({connected:!1,port:0,is_launch_json_configured:!1});async function u(){a.value=await e()}let h=null;return oe(()=>{h=setInterval(u,1e3)}),re(()=>{h&&clearInterval(h)}),(l,v)=>a.value.connected?(d(),I(s(L),{key:0,disabled:""},{default:c(()=>[_("VSCode connected")]),_:1})):(d(),I(s(xe),{key:1},{content:c(()=>[i(s(J),{direction:"vertical"},{default:c(()=>[i(s(je),null,{default:c(()=>[_(" Abstra allows you to connect to your VSCode debugger ")]),_:1}),i(s(X),null,{default:c(()=>[_(" You're not connected ")]),_:1}),a.value.is_launch_json_configured?(d(),I(s(J),{key:0,direction:"vertical"},{default:c(()=>[i(s(X),{style:{"font-size":"24px"},copyable:"",code:""},{default:c(()=>[_(R(a.value.port),1)]),_:1}),i(s(L),{href:"https://docs.abstra.io/debug/vscode",target:"_blank"},{default:c(()=>[_(" Learn how to connect to vscode ")]),_:1})]),_:1})):(d(),I(s(L),{key:1,onClick:t},{default:c(()=>[_("Configure launch.json")]),_:1}))]),_:1})]),default:c(()=>[i(s(L),null,{default:c(()=>[_("Connect to VSCode")]),_:1})]),_:1}))}}),at={class:"file-path"},ot={key:1},rt=F({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(n){const e=n,t=se({pathError:null}),{result:a}=Z(()=>Be.get()),u=()=>{!a.value||!e.runtime.file||a.value.openFile(e.runtime.file)},h=O(()=>{var p;return(p=e.runtime.file)!=null&&p.endsWith(".py")?e.runtime.hasChanges("file")?"The original file will be renamed after saving":null:"It should be a .py file"}),l=()=>{!a.value||!v.value||a.value.openFile(".")},{result:v}=Z(()=>fetch("/_editor/api/workspace/root").then(p=>p.text()));return(p,f)=>{const $=ie("icon");return d(),y(le,null,[i(s(De),null,{default:c(()=>[i(s(ee),{label:"Source code",help:h.value},{default:c(()=>[i(s(q),{value:p.runtime.file,"onUpdate:value":f[2]||(f[2]=b=>p.runtime.file=b),type:"text"},{addonBefore:c(()=>[s(v)?(d(),y("span",{key:0,class:"clickable",onClick:f[0]||(f[0]=b=>l())},[i($,{class:"clickable",path:s(Ae)},null,8,["path"]),r("p",at,R(s(v)),1)])):T("",!0)]),addonAfter:c(()=>[r("span",{class:"clickable",onClick:f[1]||(f[1]=b=>u())},[i($,{class:"clickable",path:s(Re)},null,8,["path"]),_(" Open file ")])]),_:1},8,["value"])]),_:1},8,["help"])]),_:1}),p.runtime instanceof s(Le)||p.runtime instanceof s(A)?T("",!0):(d(),I(s(ee),{key:0,label:"URL path"},{default:c(()=>[i(s(q),{value:p.runtime.path,"onUpdate:value":f[3]||(f[3]=b=>p.runtime.path=b),type:"text"},{addonBefore:c(()=>[_(" https://[your-subdomain].abstra.app/ ")]),_:1},8,["value"])]),_:1})),t.pathError?(d(),y("div",ot,R(t.pathError),1)):T("",!0)],64)}}});const wt=z(rt,[["__scopeId","data-v-8d4a9d51"]]);export{ce as L,wt as R,yt as S,mt as _};
//# sourceMappingURL=RuntimeCommonSettings.0444ce22.js.map

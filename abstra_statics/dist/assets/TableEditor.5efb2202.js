import{B as je}from"./BaseLayout.2dfc1571.js";import{a as me}from"./asyncComputed.fdcbda70.js";import{G as Be}from"./PhPencil.vue.96b75d83.js";import{d as ae,B as oe,f as O,o as r,W as T,Z as Re,R as A,ez as Me,a as $,b as l,eF as Pe,fj as Ve,eB as ie,e as N,g as ve,eM as ee,c as g,w as a,u as e,bL as V,ax as U,co as E,bD as H,bp as Ae,cn as ye,V as Fe,as as Ke,$ as Se,eN as Ie,D as Je,r as Le,eY as Ge,c_ as re,eA as Y,bJ as He,bq as We,bo as we,aJ as pe,cA as Qe,aN as Ye,cJ as Xe,eD as $e,eH as et,bG as tt,y as at}from"./vue-router.e3a418ab.js";import"./gateway.ab7d8bad.js";import{p as xe,T as Q,d as lt}from"./tables.662e288a.js";import{O as nt}from"./organization.5b413f8a.js";import{P as ge}from"./project.00b85d24.js";import{C as ut}from"./ContentLayout.6e51b931.js";import{p as se}from"./popupNotifcation.3097ef22.js";import{a as ot}from"./ant-design.4a2a6761.js";import{H as ze}from"./PhCheckCircle.vue.f6244f8e.js";import{A as Ne}from"./index.509d5909.js";import{A as be}from"./index.f3298670.js";import{A as te}from"./index.8b2e1b6c.js";import{A as he}from"./index.37a84606.js";import{G as rt}from"./PhCaretRight.vue.090da46e.js";import{L as st}from"./LoadingOutlined.eb9aa966.js";import{D as it}from"./DeleteOutlined.cafcfe1f.js";import{D as dt}from"./DownOutlined.46b655fe.js";import{A as ct}from"./index.7c2d2e59.js";import{B as ft,A as pt,b as mt}from"./index.f739e027.js";import"./record.3f1cee06.js";import"./string.5385dc37.js";import"./isNumeric.75337b1e.js";import"./index.50c0a0e5.js";(function(){try{var b=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new Error().stack;m&&(b._sentryDebugIds=b._sentryDebugIds||{},b._sentryDebugIds[m]="018edd42-7839-4b4e-95e5-f6fad34f43b0",b._sentryDebugIdIdentifier="sentry-dbid-018edd42-7839-4b4e-95e5-f6fad34f43b0")}catch{}})();const vt=["width","height","fill","transform"],yt={key:0},gt=$("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},null,-1),bt=[gt],ht={key:1},kt=$("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),Ct=$("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"},null,-1),_t=[kt,Ct],wt={key:2},Dt=$("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm-8,56a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm8,104a12,12,0,1,1,12-12A12,12,0,0,1,128,184Z"},null,-1),At=[Dt],St={key:3},It=$("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm-6-82V80a6,6,0,0,1,12,0v56a6,6,0,0,1-12,0Zm16,36a10,10,0,1,1-10-10A10,10,0,0,1,138,172Z"},null,-1),Lt=[It],$t={key:4},xt=$("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"},null,-1),zt=[xt],Nt={key:5},Ot=$("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm-4-84V80a4,4,0,0,1,8,0v56a4,4,0,0,1-8,0Zm12,36a8,8,0,1,1-8-8A8,8,0,0,1,136,172Z"},null,-1),Ut=[Ot],qt={name:"PhWarningCircle"},Oe=ae({...qt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(b){const m=b,t=oe("weight","regular"),S=oe("size","1em"),h=oe("color","currentColor"),q=oe("mirrored",!1),D=O(()=>{var C;return(C=m.weight)!=null?C:t}),k=O(()=>{var C;return(C=m.size)!=null?C:S}),i=O(()=>{var C;return(C=m.color)!=null?C:h}),R=O(()=>m.mirrored!==void 0?m.mirrored?"scale(-1, 1)":void 0:q?"scale(-1, 1)":void 0);return(C,Z)=>(r(),T("svg",Me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:i.value,transform:R.value},C.$attrs),[Re(C.$slots,"default"),D.value==="bold"?(r(),T("g",yt,bt)):D.value==="duotone"?(r(),T("g",ht,_t)):D.value==="fill"?(r(),T("g",wt,At)):D.value==="light"?(r(),T("g",St,Lt)):D.value==="regular"?(r(),T("g",$t,zt)):D.value==="thin"?(r(),T("g",Nt,Ut)):A("",!0)],16,vt))}});function De(b){for(var m=1;m<arguments.length;m++){var t=arguments[m]!=null?Object(arguments[m]):{},S=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(S=S.concat(Object.getOwnPropertySymbols(t).filter(function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),S.forEach(function(h){Et(b,h,t[h])})}return b}function Et(b,m,t){return m in b?Object.defineProperty(b,m,{value:t,enumerable:!0,configurable:!0,writable:!0}):b[m]=t,b}var ke=function(m,t){var S=De({},m,t.attrs);return l(Pe,De({},S,{icon:Ve}),null)};ke.displayName="EditOutlined";ke.inheritAttrs=!1;const Tt=ke,Ue=(b,m)=>m.includes(b)?{status:"error",help:"There already is a column with this name in the table"}:{status:""},Zt=ae({__name:"NewColumn",props:{open:{type:Boolean},table:{}},emits:["created","cancel"],setup(b,{emit:m}){const t=b,h=ie().params.projectId,q=O(()=>{var p;return((p=t.table)==null?void 0:p.getColumns().map(c=>c.name))||[]}),D=O(()=>Ue(i.value.name,q.value)),k={name:"",type:"varchar",default:"",nullable:!0,unique:!1},i=N(k),R=()=>{i.value={...k}},C=N([{value:"reference",label:"reference",isLeaf:!1},...xe.map(p=>({value:p,label:p,isLeaf:!0}))]),Z=p=>{if(!p)return;const c=p[p.length-1];switch(p.length){case 0:return;case 1:c.loading=!0,Q.list(h).then(_=>{c.children=_.map(B=>({value:B.id,label:B.name,isLeaf:!1})),c.loading=!1});return;case 2:c.loading=!0,Q.get(h,c.value).then(_=>{c.children=_.getColumns().map(B=>({type:B.type,value:B.id,label:B.name,isLeaf:!0})),c.loading=!1});return}},y=(p,c)=>{if(!!p){if(p.length===1){i.value.type=p[0],i.value.foreignKey=void 0;return}if(p.length===3){const _=c[c.length-1];i.value.type=_.type,i.value.foreignKey={columnId:_.value}}}},I=p=>{const c=p.selectedOptions;return c?c.length===1?c[0].label:c.length===3?`reference to ${c[1].label}(${c[2].label})`:"":"Select type"},v=N({...{status:"success",message:"",fakeLoading:!1}}),F=()=>{v.value.fakeLoading=!0,X()};ve(()=>i.value.type,()=>{i.value.default=lt[i.value.type]||"",F()});const X=ee.exports.debounce(async()=>{if(!i.value.default){v.value.status="success",v.value.message="",v.value.fakeLoading=!1;return}const p=`select (${i.value.default})::${i.value.type} `;ge.executeQuery(h,p,[]).then(c=>{v.value.status=c.errors.length>0?"error":"success",v.value.message=c.errors[0]||"",v.value.fakeLoading=!1})},500);function J(){m("cancel")}async function x(){if(!!t.table&&!(!i.value.name||!i.value.type))try{await t.table.addColumn(i.value),R(),m("created")}catch(p){p instanceof Error&&se("Database error",p.message)}}return(p,c)=>(r(),g(e(he),{title:"New column",width:720,open:t.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:J},{extra:a(()=>[l(e(be),null,{default:a(()=>[l(e(V),{onClick:J},{default:a(()=>[U("Cancel")]),_:1}),l(e(V),{type:"primary",onClick:x},{default:a(()=>[U("Submit")]),_:1})]),_:1})]),default:a(()=>[l(e(ye),{model:i.value,layout:"vertical"},{default:a(()=>[l(e(E),{key:"name",label:"Name",required:"","validate-status":D.value.status,help:D.value.help},{default:a(()=>[l(e(H),{value:i.value.name,"onUpdate:value":c[0]||(c[0]=_=>i.value.name=_)},null,8,["value"])]),_:1},8,["validate-status","help"]),l(e(E),{key:"type",label:"Type",required:""},{default:a(()=>[l(e(Ne),{options:C.value,"load-data":Z,"display-render":I,"allow-clear":!1,onChange:y},null,8,["options"])]),_:1}),l(e(E),{key:"default-value",label:"Default value","validate-status":v.value.status,help:v.value.message},{default:a(()=>[l(e(H),{value:i.value.default,"onUpdate:value":c[1]||(c[1]=_=>i.value.default=_),onInput:F},{suffix:a(()=>[v.value.fakeLoading?(r(),g(e(Ae),{key:0})):A("",!0),!v.value.fakeLoading&&v.value.status==="success"?(r(),g(e(ze),{key:1,size:"18"})):A("",!0),!v.value.fakeLoading&&v.value.status==="error"?(r(),g(e(Oe),{key:2,size:"18"})):A("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),l(e(E),{key:"nullable",label:"Nullable"},{default:a(()=>[l(e(te),{checked:i.value.nullable,"onUpdate:checked":c[2]||(c[2]=_=>i.value.nullable=_)},null,8,["checked"])]),_:1}),l(e(E),{key:"unique",label:"Unique"},{default:a(()=>[l(e(te),{checked:i.value.unique,"onUpdate:checked":c[3]||(c[3]=_=>i.value.unique=_)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]))}}),jt={class:"twin-container"},Bt={class:"fullwidth-input"},Rt={class:"fullwidth-input"},Mt={class:"using-container"},Pt={class:"fullwidth-input"},Vt=ae({__name:"UpdateColumn",props:{open:{type:Boolean},table:{},column:{}},emits:["updated","cancel"],setup(b,{emit:m}){const t=b,h=ie().params.projectId,q=N(t.column.type);Fe(async()=>{if(!t.column.foreignKey)return;q.value="loading...";const n=await Q.fromColumnId(h,t.column.foreignKey.columnId),u=n.getColumn(t.column.foreignKey.columnId);q.value=`reference to ${n.name}(${u.name})`});const D=O(()=>{var n;return((n=t.table)==null?void 0:n.getColumns().map(u=>u.record.initialState.name))||[]}),k=O(()=>t.column.name===t.column.record.initialState.name?{status:"",help:""}:Ue(t.column.name,D.value)),{result:i,loading:R}=me(async()=>t.table.select({},10,0).then(({total:n})=>n));function C(){t.column.record.resetChanges(),m("cancel")}const y=N({status:"success",message:"",fakeLoading:!1}),I=()=>{y.value.fakeLoading=!0,j()},j=ee.exports.debounce(async()=>{if(!t.column.default){y.value.status="success",y.value.message="",y.value.fakeLoading=!1;return}const n=`select (${t.column.default})::${t.column.type} `,u=await ge.executeQuery(h,n,[]);y.value.status=u.errors.length>0?"error":"success",y.value.message=u.errors[0]||"",y.value.fakeLoading=!1},500),v=N([{value:"reference",label:"reference",isLeaf:!1},...xe.filter(n=>n!==t.column.type).map(n=>({value:n,label:n,isLeaf:!0}))]),F=n=>{if(!n)return;const u=n[n.length-1];switch(n.length){case 0:return;case 1:u.loading=!0,Q.list(h).then(s=>{u.children=s.map(M=>({value:M.id,label:M.name,isLeaf:!1})),u.loading=!1});return;case 2:u.loading=!0,Q.get(h,u.value).then(s=>{u.children=s.getColumns().map(M=>({type:M.type,value:M.id,label:M.name,isLeaf:!0})),u.loading=!1});return}},le=n=>{const u=n.selectedOptions;return u?u.length===1?u[0].label:u.length===3?`reference to ${u[1].label}(${u[2].label})`:"":"Select type"},X=(n,u)=>{if(!!n){if(n.length===1){t.column.type=n[0],t.column.foreignKey=null;return}if(n.length===3){if(t.column.foreignKey&&t.column.foreignKey.columnId===n[2])return;const s=u[u.length-1];t.column.type=s.type,t.column.foreignKey={columnId:s.value}}}},J=()=>i.value===0||R.value?!1:t.column.record.hasChangesDeep("type"),x=N({type:"default"}),p=()=>{t.column.type=t.column.record.initialState.type,x.value={type:"default"}};function c(n,u){return u==="varchar"||n==="int"&&u==="boolean"||n==="boolean"&&u==="int"}ve(()=>t.column.type,()=>{I(),B.value||(x.value={type:"user-defined",using:W.value,mandatory:!0})});const B=O(()=>x.value.type==="default"&&c(t.column.record.initialState.type,t.column.type)),ne=O(()=>!c(t.column.record.initialState.type,t.column.type));function ue(n){n?x.value={type:"default"}:x.value={type:"user-defined",using:W.value,mandatory:!1}}function de(n){if(x.value.type==="default")throw new Error("Can't change using when using default casting");x.value.using=n!=null?n:""}const G=()=>ne.value?!0:J()&&x.value.type==="user-defined",W=O(()=>`${t.column.record.initialState.name}::${t.column.type}`);async function ce(){if(!t.column)return;let n=x.value.type==="default"?W.value:x.value.using;i.value===0&&(n=`${t.column.name}::text::${t.column.type}`);try{await t.column.update(n),m("updated")}catch(u){u instanceof Error&&se("Database error",u.message)}}return(n,u)=>(r(),g(e(he),{title:"Edit column",width:720,open:n.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:C},{extra:a(()=>[l(e(be),null,{default:a(()=>[l(e(V),{onClick:C},{default:a(()=>[U("Cancel")]),_:1}),l(e(V),{type:"primary",onClick:ce},{default:a(()=>[U("Submit")]),_:1})]),_:1})]),default:a(()=>[l(e(ye),{model:n.column,layout:"vertical"},{default:a(()=>[l(e(E),{key:"name",label:"Name","validate-status":k.value.status,help:k.value.help},{default:a(()=>[l(e(H),{value:n.column.name,"onUpdate:value":u[0]||(u[0]=s=>n.column.name=s)},null,8,["value"])]),_:1},8,["validate-status","help"]),$("div",jt,[$("span",Bt,[l(e(E),{key:"type",label:"Current Type"},{default:a(()=>[l(e(Ke),{value:q.value,"onUpdate:value":u[1]||(u[1]=s=>q.value=s),"default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),l(e(rt),{class:"right-arrow"}),$("span",Rt,[l(e(E),{key:"new-type",label:"New Type"},{default:a(()=>[l(e(Ne),{options:v.value,"load-data":F,"display-render":le,"allow-clear":!0,onClear:p,onChange:X},null,8,["options"])]),_:1})])]),l(e(E),{key:"default-value",label:"Default value","validate-status":y.value.status,help:y.value.message},{default:a(()=>[l(e(H),{value:n.column.default,"onUpdate:value":u[2]||(u[2]=s=>n.column.default=s),onInput:I},{suffix:a(()=>[y.value.fakeLoading?(r(),g(e(Ae),{key:0,size:"small"})):A("",!0),!y.value.fakeLoading&&y.value.status==="success"?(r(),g(e(ze),{key:1,size:18})):A("",!0),!y.value.fakeLoading&&y.value.status==="error"?(r(),g(e(Oe),{key:2,size:18})):A("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),$("div",Mt,[J()?(r(),g(e(E),{key:"default-casting",label:"Use default casting"},{default:a(()=>[l(e(te),{checked:B.value,disabled:ne.value,"onUpdate:checked":u[3]||(u[3]=s=>ue(!!s))},null,8,["checked","disabled"])]),_:1})):A("",!0),$("span",Pt,[J()?(r(),g(e(E),{key:"using",label:"Using"},{default:a(()=>[l(e(H),{value:x.value.type==="user-defined"?x.value.using:W.value,disabled:!G(),onInput:u[4]||(u[4]=s=>de(s.target.value))},null,8,["value","disabled"])]),_:1})):A("",!0)])]),l(e(E),{key:"nullable",label:"Nullable"},{default:a(()=>[l(e(te),{checked:n.column.nullable,"onUpdate:checked":u[5]||(u[5]=s=>n.column.nullable=s)},null,8,["checked"])]),_:1}),l(e(E),{key:"unique",label:"Unique"},{default:a(()=>[l(e(te),{checked:n.column.unique,"onUpdate:checked":u[6]||(u[6]=s=>n.column.unique=s)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]))}});const Ft=Se(Vt,[["__scopeId","data-v-5d191276"]]),Kt={style:{overflow:"hidden","white-space":"wrap"}},Jt={key:1},Gt={key:1},Ht={key:1},Wt=["onClick"],Qt=$("a",null,"Delete",-1),Yt=ae({__name:"TableData",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(b,{emit:m}){var Ce;const t=b,S=N(1),h=N(10),q=O(()=>{var o,f;return{total:(f=(o=p.value)==null?void 0:o.total)!=null?f:0,current:S.value,pageSize:h.value,totalBoundaryShowSizeChanger:10,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],onChange:async(w,d)=>{S.value=w,h.value=d,await _()}}}),D=ie(),k=Ie(),i=N(typeof D.query.q=="string"?D.query.q:""),R=O(()=>{try{return JSON.parse(D.query.where)}catch{return{}}});ve(i,()=>{k.replace({query:{...D.query,where:JSON.stringify(D.query.value),q:i.value}})});const C=N(!1),Z=N({type:"idle"}),y=()=>{C.value=!0,I()},I=ee.exports.debounce(()=>{_(),C.value=!1},500);function j(){Z.value={type:"idle"}}async function v(){j(),m("refresh"),await _(),W()}function F(){Z.value={type:"creating"}}const le=o=>{if(!t.table)throw new Error("Table not found");Z.value={type:"editing",column:t.table.getColumn(o)}};async function X(o){await ot("Are you sure you want to delete this column?")&&await J(o)}async function J(o){var f,w;await((w=(f=t.table)==null?void 0:f.getColumn(o))==null?void 0:w.delete()),m("refresh"),await _(),W()}const x=O(()=>{var o;return((o=p.value)==null?void 0:o.rows.length)===1}),{result:p,loading:c,refetch:_}=me(()=>Promise.all([t.table.select(R.value,(S.value-1)*h.value,h.value,i.value),Promise.all(t.table.getColumns().filter(o=>o.foreignKey).map(o=>Q.fromColumnId(D.params.projectId,o.foreignKey.columnId).then(f=>[o.name,f])))]).then(([{rows:o,total:f},w])=>({rows:o,total:f,columns:w.reduce((d,[z,P])=>({...d,[z]:P}),{})}))),B=(o,f)=>{var P,L;const w=(P=t.table)==null?void 0:P.getColumns().find(K=>K.name===o);if(!w)return"";const d=(L=p.value)==null?void 0:L.columns[w.name],z=d==null?void 0:d.getColumns().find(K=>{var _e;return K.id===((_e=w.foreignKey)==null?void 0:_e.columnId)});return!d||!z?"":{name:"tableEditor",params:{projectId:D.params.projectId,tableId:d.id},query:{where:JSON.stringify({[z.name]:f})}}},ne=(o,f)=>w=>{if(o==="json"&&w==""){s.value[f]="null";return}s.value[f]=w},ue=()=>[...t.table.getColumns().map(o=>{var f;return{key:(f=o.id)!=null?f:"",title:o.name,dataIndex:o.name,width:220,resizable:!0,ellipsis:!1}}),{key:"action",title:"",fixed:"right",width:100,align:"center",resizable:!1,ellipsis:!1}],de=ue(),G=N(de),W=()=>G.value=ue();function ce(o,f){G.value=G.value.map(w=>w.key===f.key?{...w,width:o}:w)}const n=O(()=>{var o;return((o=p.value)==null?void 0:o.rows.map(f=>({key:f.id,...f})))||[]}),u=N(!1),s=N({}),M=()=>{u.value=!0},fe=()=>{s.value={},u.value=!1};let qe=Je((Ce=t.table)==null?void 0:Ce.getUnprotectedColumns().reduce((o,f)=>({...o,[f.name]:""}),{}));async function Ee(){if(!(!t.table||!qe))try{s.value.id?await t.table.updateRow(s.value.id,s.value):await t.table.insertRow(s.value),s.value={},_(),fe()}catch(o){o instanceof Error&&se("Database error",o.message)}}const Te=async o=>{if(!(!p.value||!p.value.rows.find(f=>f.id===o)))try{await t.table.deleteRow(o),x.value&&(S.value=Math.max(1,S.value-1)),_()}catch(f){f instanceof Error&&se("Database error",f.message)}},Ze=o=>{var P;const f=(P=n.value)==null?void 0:P.filter(L=>o===L.key)[0],w=t.table.getColumns(),d=w.map(L=>L.name),z=w.filter(L=>L.type==="json").map(L=>L.name);s.value=ee.exports.pick(ee.exports.cloneDeep(f),d),z.forEach(L=>{s.value[L]&&(s.value[L]=JSON.stringify(s.value[L]))}),M()};return(o,f)=>{const w=Le("RouterLink");return r(),g(ut,{"full-width":""},{default:a(()=>[l(e(re),{justify:"space-between",style:{"margin-bottom":"16px"},gap:"middle"},{default:a(()=>[l(e(H),{value:i.value,"onUpdate:value":[f[0]||(f[0]=d=>i.value=d),y],placeholder:"Search",style:{width:"400px"},"allow-clear":""},{prefix:a(()=>[l(e(Ge))]),suffix:a(()=>[C.value?(r(),g(e(st),{key:0})):A("",!0)]),_:1},8,["value"]),l(e(V),{type:"primary",onClick:F},{default:a(()=>[U("+ Add new column")]),_:1})]),_:1}),l(e(Xe),{columns:G.value,"data-source":n.value,pagination:q.value,bordered:"",loading:e(c)||o.loading,scroll:{x:1e3,y:720},size:"small",onResizeColumn:ce},{headerCell:a(({column:d})=>[d.title!=="id"&&d.title!=="created_at"&&d.key!=="action"?(r(),g(e(re),{key:0,align:"center",justify:"space-between",gap:"small"},{default:a(()=>[$("span",Kt,Y(d.title),1),l(e(He),{placement:"bottomRight",trigger:"click"},{overlay:a(()=>[l(e(We),null,{default:a(()=>[l(e(we),{onClick:z=>le(String(d.key))},{icon:a(()=>[l(e(Tt))]),default:a(()=>[U(" Edit ")]),_:2},1032,["onClick"]),l(e(we),{danger:"",onClick:z=>X(String(d.key))},{icon:a(()=>[l(e(it))]),default:a(()=>[U(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[l(e(dt))]),_:2},1024)]),_:2},1024)):(r(),T("span",Jt,Y(d.title),1))]),bodyCell:a(({column:d,text:z,record:P})=>{var L;return[G.value.map(K=>K.title).includes(d.dataIndex)?(r(),T(pe,{key:0},[(L=o.table.getColumns().find(K=>K.name===d.dataIndex))!=null&&L.foreignKey?(r(),g(w,{key:0,to:B(d.dataIndex,z),target:"_blank"},{default:a(()=>[U(Y(z),1)]),_:2},1032,["to"])):(r(),T("span",Gt,Y(z),1))],64)):A("",!0),d.key==="action"?(r(),T("div",Ht,[$("span",null,[$("a",{onClick:K=>Ze(P.id)},"Edit",8,Wt)]),l(e(ct),{type:"vertical"}),l(e(Qe),{title:"Sure to delete?",onConfirm:K=>Te(P.id)},{default:a(()=>[Qt]),_:2},1032,["onConfirm"])])):A("",!0)]}),footer:a(()=>[G.value.length===3?(r(),g(e(Ye),{key:0,title:"Add a first column prior to data entry",placement:"right"},{default:a(()=>[l(e(V),{type:"primary",disabled:!0,onClick:M},{default:a(()=>[U(" + Add New Data ")]),_:1})]),_:1})):(r(),g(e(V),{key:1,type:"primary",onClick:M},{default:a(()=>[U("+ Add New Data")]),_:1}))]),_:1},8,["columns","data-source","pagination","loading"]),l(e(he),{title:"Data",width:720,open:u.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:fe},{extra:a(()=>[l(e(be),null,{default:a(()=>[l(e(V),{onClick:fe},{default:a(()=>[U("Cancel")]),_:1}),l(e(V),{type:"primary",onClick:Ee},{default:a(()=>[U("Submit")]),_:1})]),_:1})]),default:a(()=>[l(e(ye),{model:s.value,layout:"vertical"},{default:a(()=>[(r(!0),T(pe,null,$e(o.table.getUnprotectedColumns(),d=>(r(),g(e(E),{key:d.id,label:d.name,required:!d.nullable},{default:a(()=>[s.value?(r(),g(e(H),{key:0,placeholder:d.type,value:s.value[d.name],disabled:s.value[d.name]===null,"onUpdate:value":z=>ne(d.type,d.name)(z)},et({_:2},[d.nullable?{name:"addonAfter",fn:a(()=>[l(e(tt),{checked:s.value[d.name]===null,"onUpdate:checked":z=>s.value[d.name]=z?null:""},{default:a(()=>[U(" NULL ")]),_:2},1032,["checked","onUpdate:checked"])]),key:"0"}:void 0]),1032,["placeholder","value","disabled","onUpdate:value"])):A("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])]),_:1},8,["open"]),o.table&&Z.value.type==="creating"?(r(),g(Zt,{key:0,open:"",table:t.table,onClose:j,onCancel:j,onCreated:v},null,8,["table"])):A("",!0),o.table&&Z.value.type==="editing"?(r(),g(Ft,{key:1,column:Z.value.column,open:"",table:o.table,onUpdated:v,onClose:j,onCancel:j},null,8,["column","table"])):A("",!0)]),_:1})}}});const Xt={style:{"font-size":"20px"}},ea=ae({__name:"TableEditor",setup(b){const m=Ie(),t=ie(),S=t.params.tableId,h=t.params.projectId,q=N(!1),D=()=>{var y;q.value=!1,(y=k.value)==null||y.table.save(),R()},{result:k,loading:i,refetch:R}=me(()=>Promise.all([ge.get(h).then(async y=>{const I=await nt.get(y.organizationId);return{project:y,organization:I}}),Q.get(h,S)]).then(([{project:y,organization:I},j])=>at({project:y,organization:I,table:j}))),C=O(()=>!i.value&&k.value?[{label:"My organizations",path:"/organizations"},{label:k.value.organization.name,path:`/organizations/${k.value.organization.id}`},{label:k.value.project.name,path:`/projects/${k.value.project.id}/tables`}]:void 0);function Z(){m.push({name:"tables",params:{projectId:h}})}return(y,I)=>{const j=Le("RouterLink");return r(),g(je,null,{navbar:a(()=>[l(e(mt),{style:{padding:"5px 25px"},onBack:Z},{title:a(()=>[q.value?(r(),g(e(re),{key:1,align:"center",gap:"large"},{default:a(()=>[e(k)?(r(),g(e(H),{key:0,value:e(k).table.name,"onUpdate:value":I[1]||(I[1]=v=>e(k).table.name=v),class:"borderless-input"},null,8,["value"])):A("",!0),l(e(V),{onClick:D},{default:a(()=>[U("Save")]),_:1})]),_:1})):(r(),g(e(re),{key:0,align:"center",gap:"small"},{default:a(()=>{var v;return[$("span",Xt,Y((v=e(k))==null?void 0:v.table.name),1),l(e(Be),{size:"22",style:{cursor:"pointer"},onClick:I[0]||(I[0]=F=>q.value=!0)})]}),_:1}))]),subTitle:a(()=>[C.value?(r(),g(e(ft),{key:0,style:{margin:"0px 20px"}},{default:a(()=>[(r(!0),T(pe,null,$e(C.value,(v,F)=>(r(),g(e(pt),{key:F},{default:a(()=>[l(j,{to:v.path},{default:a(()=>[U(Y(v.label),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):A("",!0)]),_:1})]),content:a(()=>[e(k)?(r(),g(Yt,{key:0,loading:e(i),table:e(k).table,onRefresh:I[2]||(I[2]=v=>e(R)())},null,8,["loading","table"])):A("",!0)]),_:1})}}});const Ia=Se(ea,[["__scopeId","data-v-fb9e75a3"]]);export{Ia as default};
//# sourceMappingURL=TableEditor.5efb2202.js.map

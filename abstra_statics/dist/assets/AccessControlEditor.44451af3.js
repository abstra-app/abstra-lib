var he=Object.defineProperty;var ve=(r,e,t)=>e in r?he(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var R=(r,e,t)=>(ve(r,typeof e!="symbol"?e+"":e,t),t);import{C as be}from"./ContentLayout.d2a2c2dc.js";import{l as K}from"./fetch.93c6ea0d.js";import{E as ee}from"./record.61319bc5.js";import{d as C,Z as P,J as v,b as d,ew as y,dn as te,ey as V,eB as ae,e as b,f as l,eI as we,c as h,w as s,u as a,bG as $,as as g,eF as j,cD as _e,eH as D,aE as S,af as E,eG as Ce,aI as Ae,ak as le,aj as Y,r as U,cE as Z,cB as N,eS as Ve,I as Pe,bz as se,dl as Q}from"./outputWidgets.3684b02e.js";import{E as He,a as ke}from"./repository.75ac045e.js";import{a as x}from"./asyncComputed.0b5889fd.js";import{S as Oe}from"./SaveButton.2d117722.js";import{I as $e,F as Xt}from"./PhKey.vue.be2b4e99.js";import"./workspaces.a5b73d30.js";import{l as z}from"./login.57297de2.js";import"./envVars.1ffaa13c.js";import{P as Se,A as G,T as Ue}from"./TabPane.c89f20d8.js";import{A as Ze}from"./index.7d77457c.js";import{s as Me}from"./metadata.13d10e60.js";import{G as ra}from"./PhIdentificationBadge.vue.60b97f8c.js";import{G as Re}from"./PhKanban.vue.b4d61102.js";import{a as xe}from"./Base.bd471b11.js";import{A as k}from"./index.29d826c7.js";import{A as oe}from"./Text.5dac8cf1.js";import{A as re}from"./index.430b4d30.js";import{A as ne}from"./index.737e6b98.js";import{A as F}from"./Paragraph.9e2afa41.js";import{C as Ie}from"./CrudView.6dc448bb.js";import{G as Te}from"./PhPencil.vue.c89ecdda.js";import{A as I,F as ie}from"./Form.d0db370f.js";import{A as ue}from"./index.7be900c7.js";import{A as je}from"./Title.bbdcc9ae.js";import"./pubsub.b5f35f9d.js";import"./router.fc1eef1c.js";import"./popupNotifcation.a2296f07.js";import"./UnsavedChangesHandler.c18b2ae6.js";import"./ExclamationCircleOutlined.525f560d.js";import"./Modal.1dcf8df8.js";import"./Link.4b7e85fb.js";import"./runnerData.b419b5b2.js";import"./url.c248eb9f.js";import"./hasIn.11c840ae.js";import"./PhCheckCircle.vue.142c1510.js";import"./PhScroll.vue.6f237551.js";import"./PhWebhooksLogo.vue.e967c3f1.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.a9cd2191.js";import"./BookOutlined.bb4b2010.js";import"./isNumeric.75337b1e.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="ba46774a-ffa8-402c-9499-6ca1ea2fcb0b",r._sentryDebugIdIdentifier="sentry-dbid-ba46774a-ffa8-402c-9499-6ca1ea2fcb0b")}catch{}})();const De=["width","height","fill","transform"],Ee={key:0},Be=b("path",{d:"M222.14,105.85l-80-80a20,20,0,0,0-28.28,0l-80,80A19.86,19.86,0,0,0,28,120v96a12,12,0,0,0,12,12h64a12,12,0,0,0,12-12V164h24v52a12,12,0,0,0,12,12h64a12,12,0,0,0,12-12V120A19.86,19.86,0,0,0,222.14,105.85ZM204,204H164V152a12,12,0,0,0-12-12H104a12,12,0,0,0-12,12v52H52V121.65l76-76,76,76Z"},null,-1),qe=[Be],Ne={key:1},ze=b("path",{d:"M216,120v96H152V152H104v64H40V120a8,8,0,0,1,2.34-5.66l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,216,120Z",opacity:"0.2"},null,-1),Ge=b("path",{d:"M219.31,108.68l-80-80a16,16,0,0,0-22.62,0l-80,80A15.87,15.87,0,0,0,32,120v96a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V160h32v56a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V120A15.87,15.87,0,0,0,219.31,108.68ZM208,208H160V152a8,8,0,0,0-8-8H104a8,8,0,0,0-8,8v56H48V120l80-80,80,80Z"},null,-1),Fe=[ze,Ge],Le={key:2},We=b("path",{d:"M224,120v96a8,8,0,0,1-8,8H160a8,8,0,0,1-8-8V164a4,4,0,0,0-4-4H108a4,4,0,0,0-4,4v52a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V120a16,16,0,0,1,4.69-11.31l80-80a16,16,0,0,1,22.62,0l80,80A16,16,0,0,1,224,120Z"},null,-1),Je=[We],Ye={key:3},Qe=b("path",{d:"M217.9,110.1l-80-80a14,14,0,0,0-19.8,0l-80,80A13.92,13.92,0,0,0,34,120v96a6,6,0,0,0,6,6h64a6,6,0,0,0,6-6V158h36v58a6,6,0,0,0,6,6h64a6,6,0,0,0,6-6V120A13.92,13.92,0,0,0,217.9,110.1ZM210,210H158V152a6,6,0,0,0-6-6H104a6,6,0,0,0-6,6v58H46V120a2,2,0,0,1,.58-1.42l80-80a2,2,0,0,1,2.84,0l80,80A2,2,0,0,1,210,120Z"},null,-1),Xe=[Qe],Ke={key:4},et=b("path",{d:"M219.31,108.68l-80-80a16,16,0,0,0-22.62,0l-80,80A15.87,15.87,0,0,0,32,120v96a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V160h32v56a8,8,0,0,0,8,8h64a8,8,0,0,0,8-8V120A15.87,15.87,0,0,0,219.31,108.68ZM208,208H160V152a8,8,0,0,0-8-8H104a8,8,0,0,0-8,8v56H48V120l80-80,80,80Z"},null,-1),tt=[et],at={key:5},lt=b("path",{d:"M216.49,111.51l-80-80a12,12,0,0,0-17,0l-80,80A12,12,0,0,0,36,120v96a4,4,0,0,0,4,4h64a4,4,0,0,0,4-4V156h40v60a4,4,0,0,0,4,4h64a4,4,0,0,0,4-4V120A12,12,0,0,0,216.49,111.51ZM212,212H156V152a4,4,0,0,0-4-4H104a4,4,0,0,0-4,4v60H44V120a4,4,0,0,1,1.17-2.83l80-80a4,4,0,0,1,5.66,0l80,80A4,4,0,0,1,212,120Z"},null,-1),st=[lt],ot={name:"PhHouse"},rt=C({...ot,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const e=r,t=P("weight","regular"),f=P("size","1em"),i=P("color","currentColor"),m=P("mirrored",!1),o=v(()=>{var c;return(c=e.weight)!=null?c:t}),u=v(()=>{var c;return(c=e.size)!=null?c:f}),p=v(()=>{var c;return(c=e.color)!=null?c:i}),n=v(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:m?"scale(-1, 1)":void 0);return(c,w)=>(d(),y("svg",ae({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:u.value,height:u.value,fill:p.value,transform:n.value},c.$attrs),[te(c.$slots,"default"),o.value==="bold"?(d(),y("g",Ee,qe)):o.value==="duotone"?(d(),y("g",Ne,Fe)):o.value==="fill"?(d(),y("g",Le,Je)):o.value==="light"?(d(),y("g",Ye,Xe)):o.value==="regular"?(d(),y("g",Ke,tt)):o.value==="thin"?(d(),y("g",at,st)):V("",!0)],16,De))}}),nt=["width","height","fill","transform"],it={key:0},ut=b("path",{d:"M208,76H180V56A52,52,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76ZM100,56a28,28,0,0,1,56,0V76H100ZM204,204H52V100H204Z"},null,-1),ct=[ut],dt={key:1},pt=b("path",{d:"M216,96V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V96a8,8,0,0,1,8-8H208A8,8,0,0,1,216,96Z",opacity:"0.2"},null,-1),mt=b("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"},null,-1),ft=[pt,mt],gt={key:2},yt=b("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},null,-1),ht=[yt],vt={key:3},bt=b("path",{d:"M208,82H174V56a46,46,0,0,0-92,0V82H48A14,14,0,0,0,34,96V208a14,14,0,0,0,14,14H208a14,14,0,0,0,14-14V96A14,14,0,0,0,208,82ZM94,56a34,34,0,0,1,68,0V82H94ZM210,208a2,2,0,0,1-2,2H48a2,2,0,0,1-2-2V96a2,2,0,0,1,2-2H208a2,2,0,0,1,2,2Z"},null,-1),wt=[bt],_t={key:4},Ct=b("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"},null,-1),At=[Ct],Vt={key:5},Pt=b("path",{d:"M208,84H172V56a44,44,0,0,0-88,0V84H48A12,12,0,0,0,36,96V208a12,12,0,0,0,12,12H208a12,12,0,0,0,12-12V96A12,12,0,0,0,208,84ZM92,56a36,36,0,0,1,72,0V84H92ZM212,208a4,4,0,0,1-4,4H48a4,4,0,0,1-4-4V96a4,4,0,0,1,4-4H208a4,4,0,0,1,4,4Z"},null,-1),Ht=[Pt],kt={name:"PhLockSimple"},Ot=C({...kt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const e=r,t=P("weight","regular"),f=P("size","1em"),i=P("color","currentColor"),m=P("mirrored",!1),o=v(()=>{var c;return(c=e.weight)!=null?c:t}),u=v(()=>{var c;return(c=e.size)!=null?c:f}),p=v(()=>{var c;return(c=e.color)!=null?c:i}),n=v(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:m?"scale(-1, 1)":void 0);return(c,w)=>(d(),y("svg",ae({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:u.value,height:u.value,fill:p.value,transform:n.value},c.$attrs),[te(c.$slots,"default"),o.value==="bold"?(d(),y("g",it,ct)):o.value==="duotone"?(d(),y("g",dt,ft)):o.value==="fill"?(d(),y("g",gt,ht)):o.value==="light"?(d(),y("g",vt,wt)):o.value==="regular"?(d(),y("g",_t,At)):o.value==="thin"?(d(),y("g",Vt,Ht)):V("",!0)],16,nt))}});function X(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},f=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(t).filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),f.forEach(function(i){$t(r,i,t[i])})}return r}function $t(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var L=function(e,t){var f=X({},e,t.attrs);return l(we,X({},f,{icon:Se}),null)};L.displayName="PlusOutlined";L.inheritAttrs=!1;const St=L;class W{constructor(e){R(this,"record");this.record=ee.from(e)}get id(){return this.record.get("id")}get type(){return this.record.get("type")}get title(){return this.record.get("title")}get isPublic(){return this.record.get("is_public")}set isPublic(e){e&&this.record.set("required_roles",[]),this.record.set("is_public",e)}get requiredRoles(){return this.record.get("required_roles")}set requiredRoles(e){e.length!==0&&this.record.set("is_public",!1),this.record.set("required_roles",e)}makePublic(){this.isPublic=!0}makeProtected(){this.isPublic=!1,this.requiredRoles=[]}require(e){e.length!==0&&(this.isPublic=!1),this.requiredRoles=e}get visibility(){return this.isPublic?"public":"private"}hasChanges(){return this.record.hasChanges("is_public")||this.record.hasChangesDeep("required_roles")}get changes(){return this.record.changes}get initialState(){return this.record.initialState}toUpdateDTO(){return{id:this.id,is_public:this.isPublic,required_roles:this.requiredRoles}}commit(){this.record.commit()}static from(e){return new W(e)}}class Ut{constructor(e=K){this.fetch=e}async list(){return(await(await this.fetch("/_editor/api/access-control",{method:"GET",headers:{"Content-Type":"application/json"}})).json()).map(W.from)}async update(e){const t=e.reduce((i,m)=>(m.hasChanges()&&i.push({id:m.id,...m.changes}),i),[]);return await(await fetch("/_editor/api/access-control",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}}const T=class{constructor(e){R(this,"record");this.dto=e,this.record=ee.from(e)}static from(e){return new T(e)}toDTO(){return this.record.toDTO()}get id(){return this.record.get("id")}get projectId(){return this.record.get("projectId")}get emailPatterns(){return this.record.get("emailPatterns")}set emailPatterns(e){this.record.set("emailPatterns",e)}get hasChanges(){return this.record.hasChangesDeep("emailPatterns")}get strategy(){return this.dto.emailPatterns.length===0?"inviteOnly":this.dto.emailPatterns.length==1&&this.dto.emailPatterns[0]=="*"?"anyone":"patternOnly"}get changes(){return this.record.changes}allowAnyone(){this.record.set("emailPatterns",["*"])}allowOnlyInvited(){this.record.set("emailPatterns",[])}static validate(e){let t="";return e.startsWith("@")&&(t=e.slice(1)),e.startsWith("*@")&&(t=e.slice(2)),t.match(T.pattern)!==null}};let M=T;R(M,"pattern",/^[a-z0-9.-]+\.[a-z]{2,}$/);class Zt{constructor(e=K){this.fetch=e}async update(e){const{emailPatterns:t}=e.changes;return t?(await this.fetch("/_editor/api/users/signup-policy",{method:"PUT",body:JSON.stringify({email_patterns:t}),headers:{"Content-Type":"application/json"}}),M.from({...e.toDTO(),emailPatterns:t})):e}async get(){const t=await(await this.fetch("/_editor/api/users/signup-policy")).json();return M.from({emailPatterns:t.email_patterns,id:t.id,projectId:t.project_id,createdAt:t.created_at})}}const Mt=C({__name:"RoleSelector",props:{value:{},roleOptions:{},disabled:{type:Boolean}},emits:["update:value"],setup(r,{emit:e}){const t=r,f=()=>{var p,n;if(!((p=z.asyncComputed.result.value)!=null&&p.logged))return;const u=(n=z.asyncComputed.result.value)==null?void 0:n.project_id;window.open(`https://cloud.abstra.io/projects/${u}/access-control?selected-panel=roles`,"__roles")},i=u=>{e("update:value",u)},m=v(()=>t.disabled?"":"All users listed in the cloud"),o=C({props:{vnodes:{type:Object,required:!0}},render(){return this.vnodes}});return(u,p)=>(d(),h(a(E),{value:u.value,mode:"multiple",placeholder:m.value,disabled:u.disabled,"onUpdate:value":i},{dropdownRender:s(({menuNode:n})=>{var c;return[l(a(o),{vnodes:n},null,8,["vnodes"]),l(a(Ze),{style:{margin:"4px 0"}}),(c=a(z).asyncComputed.result.value)!=null&&c.logged?(d(),h(a($),{key:0,type:"default",style:{width:"100%"},onClick:f},{icon:s(()=>[l(a(St))]),default:s(()=>[g(" Create a new role ")]),_:1})):V("",!0)]}),default:s(()=>[(d(!0),y(S,null,j(u.roleOptions,n=>(d(),h(a(_e),{key:n,value:n},{default:s(()=>[g(D(n),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","disabled"]))}}),Rt=r=>r==="kanban"?Re:r==="home"?rt:Me(r);const xt=C({__name:"AccessControlItem",props:{accessControl:{},roles:{}},emits:["update:access-control"],setup(r,{emit:e}){const t=r,f=v(()=>t.roles.map(o=>o.name)),i=o=>{o?t.accessControl.makePublic():t.accessControl.makeProtected(),e("update:access-control",t.accessControl)},m=o=>{t.accessControl.require(o),o.length!==0&&(t.accessControl.isPublic=!1),e("update:access-control",t.accessControl)};return(o,u)=>(d(),h(a(k),{justify:"space-between",align:"center",gap:"small"},{default:s(()=>[(d(),h(Ce(a(Rt)(o.accessControl.type)),{style:{"flex-shrink":"0",width:"22px",height:"18px"}})),l(a(xe),{style:{width:"300px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}},{default:s(()=>[l(a(Ae),{title:o.accessControl.title,placement:"left",open:o.accessControl.title.length>36?void 0:!1},{default:s(()=>[g(D(o.accessControl.title),1)]),_:1},8,["title","open"])]),_:1}),l(a(k),{gap:"large",align:"center"},{default:s(()=>[l(Mt,{disabled:o.accessControl.visibility==="public",style:{width:"320px"},value:o.accessControl.requiredRoles||[],"role-options":f.value||[],"onUpdate:value":u[0]||(u[0]=p=>m(p))},null,8,["disabled","value","role-options"]),l(a(le),{value:o.accessControl.visibility},{default:s(()=>[l(a(Y),{value:"public",onChange:u[1]||(u[1]=p=>i(!0))},{default:s(()=>[l(a(k),{align:"center",gap:"small"},{default:s(()=>[g(" Public "),l(a($e),{size:14})]),_:1})]),_:1}),l(a(Y),{value:"private",onChange:u[2]||(u[2]=p=>i(!1))},{default:s(()=>[l(a(k),{align:"center",gap:"small"},{default:s(()=>[g(" Private "),l(a(Ot),{size:14})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}))}}),It=C({__name:"DanglingRolesAlert",props:{danglingRoles:{}},setup(r){return(e,t)=>(d(),h(a(ne),{type:"warning","show-icon":"",closable:""},{description:s(()=>[l(a(oe),null,{default:s(()=>[g("The following roles are not defined in the Cloud Console:")]),_:1}),(d(!0),y(S,null,j(e.danglingRoles,f=>(d(),h(a(re),{key:f,style:{margin:"2px"},color:"red"},{default:s(()=>[g(D(f),1)]),_:2},1024))),128))]),_:1}))}}),Tt=C({__name:"View",props:{accessControls:{},roles:{},loading:{type:Boolean}},emits:["update:access-controls","save"],setup(r,{emit:e}){const t=r,f=n=>{const c=t.accessControls.findIndex(w=>w.id===n.id);c!==-1&&(t.accessControls[c]=n,e("update:access-controls",[...t.accessControls]))},i=v(()=>{var n;return((n=t.accessControls)==null?void 0:n.filter(c=>c.hasChanges()))||[]}),m=v(()=>i.value.length>0),u={save:async()=>{e("save")},hasChanges:()=>m.value},p=v(()=>{const n=t.accessControls.flatMap(w=>w.requiredRoles)||[],c=t.roles.map(w=>w.name)||[];return(n==null?void 0:n.filter(w=>!c.includes(w)))||[]});return(n,c)=>(d(),y(S,null,[l(a(k),{justify:"flex-end"},{default:s(()=>[l(Oe,{model:u})]),_:1}),!n.loading&&p.value.length>0?(d(),h(It,{key:0,"dangling-roles":p.value},null,8,["dangling-roles"])):V("",!0),l(a(k),{vertical:"",gap:"small",style:{"margin-top":"10px"}},{default:s(()=>[(d(!0),y(S,null,j(n.accessControls,w=>(d(),h(a(k),{key:w.id},{default:s(()=>[l(xt,{"access-control":w,roles:n.roles,"onUpdate:accessControl":f},null,8,["access-control","roles"])]),_:2},1024))),128))]),_:1})],64))}}),jt={style:{padding:"30px"}},Dt=C({__name:"View",props:{signupPolicy:{}},emits:["update:signup-policy","save"],setup(r,{emit:e}){const t=r,f=U(t.signupPolicy.strategy),i=U(t.signupPolicy.strategy==="patternOnly"?t.signupPolicy.emailPatterns:[]),m=U(t.signupPolicy.strategy==="patternOnly"?t.signupPolicy.emailPatterns.map(p=>({label:p})):[]),o=p=>{const n=p;if(i.value=n,n.length===0){u("inviteOnly");return}m.value=n.map(c=>({label:c})),t.signupPolicy.emailPatterns=p,e("update:signup-policy",t.signupPolicy)},u=p=>{f.value=p,p!=="patternOnly"&&(p==="anyone"&&t.signupPolicy.allowAnyone(),p==="inviteOnly"&&t.signupPolicy.allowOnlyInvited(),e("update:signup-policy",t.signupPolicy))};return(p,n)=>(d(),h(a(Z),{direction:"vertical",style:{"padding-top":"8px"}},{default:s(()=>[l(a(F),null,{default:s(()=>[g(" Control which end users may sign-up to your app. ")]),_:1}),l(a($),{disabled:!p.signupPolicy.hasChanges,type:"primary",onClick:n[0]||(n[0]=c=>e("save"))},{default:s(()=>[g(" Save changes ")]),_:1},8,["disabled"]),b("div",jt,[l(a(F),{strong:""},{default:s(()=>[g(" Allow self sign-up? ")]),_:1}),l(a(le),{value:f.value,"onUpdate:value":u},{default:s(()=>[l(a(Z),{direction:"vertical"},{default:s(()=>[l(a(N),{value:"inviteOnly"},{default:s(()=>[g("No, users must be added by me.")]),_:1}),l(a(Z),null,{default:s(()=>[l(a(N),{value:"patternOnly"},{default:s(()=>[g("Yes, but only for users in")]),_:1}),l(a(E),{mode:"tags",value:i.value,style:{"min-width":"250px"},placeholder:"@domain.com or sub.domain.com",disabled:f.value!=="patternOnly",options:m.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":o},null,8,["value","disabled","options"])]),_:1}),l(a(N),{value:"anyone"},{default:s(()=>[g("Yes, for anyone")]),_:1})]),_:1})]),_:1},8,["value"])])]),_:1}))}}),Et=C({__name:"View",props:{loading:{type:Boolean},users:{}},emits:["create","edit","delete"],setup(r,{emit:e}){const t=r,f=v(()=>{var i;return{columns:[{name:"Email"},{name:"Roles"},{name:"",align:"right"}],rows:(i=t.users.map(m=>({key:m.email,cells:[{type:"text",text:m.email},{type:"slot",key:"roles",payload:{roles:m.roles}},{type:"actions",actions:[{icon:Te,label:"Edit",onClick:()=>e("edit",m)},{icon:Ve,label:"Delete",onClick:()=>e("delete",m)}]}]})))!=null?i:[]}});return(i,m)=>(d(),y(S,null,[l(Ie,{"entity-name":"users",title:"",loading:i.loading,description:"List all user profiles to be used for testing purposes.","empty-title":"No users yet",table:f.value,"create-button-text":"Add users",onCreate:m[0]||(m[0]=o=>e("create",o))},{roles:s(({payload:o})=>[(d(!0),y(S,null,j(o.roles,u=>(d(),h(a(re),{key:u,bordered:""},{default:s(()=>[g(D(u),1)]),_:2},1024))),128))]),_:1},8,["loading","table"]),l(a(ne),{type:"info","show-icon":"",closable:""},{description:s(()=>[l(a(oe),null,{default:s(()=>[g("Configurations made here only affect your local environment. To manage real users, please access the Cloud Console.")]),_:1})]),_:1})],64))}}),Bt=C({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(r,{emit:e}){const f=r.roleOptions.map(u=>({label:u.name,value:u.name})),i=Pe({email:"",roles:[]});function m(){e("cancel")}function o(){!i.email||e("created",i)}return(u,p)=>(d(),h(a(ue),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:m},{extra:s(()=>[l(a(Z),null,{default:s(()=>[l(a($),{onClick:m},{default:s(()=>[g("Cancel")]),_:1}),l(a($),{type:"primary",onClick:o},{default:s(()=>[g("Submit")]),_:1})]),_:1})]),default:s(()=>[l(a(ie),{model:i,layout:"vertical"},{default:s(()=>[l(a(I),{key:"email",label:"Email",required:!0},{default:s(()=>[l(a(se),{value:i.email,"onUpdate:value":p[0]||(p[0]=n=>i.email=n)},null,8,["value"])]),_:1}),l(a(I),{key:"role",label:"Role"},{default:s(()=>[l(a(E),{value:i.roles,"onUpdate:value":p[1]||(p[1]=n=>i.roles=n),mode:"multiple",options:a(f)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),qt=C({__name:"UpdateUser",props:{roleOptions:{},value:{}},emits:["updated","cancel"],setup(r,{emit:e}){const t=r,f=t.roleOptions.map(o=>({label:o.name,value:o.name}));function i(){e("cancel")}function m(){e("updated",t.value)}return(o,u)=>(d(),h(a(ue),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:s(()=>[l(a(Z),null,{default:s(()=>[l(a($),{onClick:i},{default:s(()=>[g("Cancel")]),_:1}),l(a($),{type:"primary",onClick:m},{default:s(()=>[g("Submit")]),_:1})]),_:1})]),default:s(()=>[l(a(ie),{layout:"vertical"},{default:s(()=>[l(a(I),{key:"email",label:"Email"},{default:s(()=>[l(a(se),{value:o.value.email,"onUpdate:value":u[0]||(u[0]=p=>o.value.email=p),disabled:""},null,8,["value"])]),_:1}),l(a(I),{key:"role",label:"Role"},{default:s(()=>[l(a(E),{value:o.value.roles,"onUpdate:value":u[1]||(u[1]=p=>o.value.roles=p),mode:"multiple",options:a(f)},null,8,["value","options"])]),_:1})]),_:1})]),_:1}))}}),xa=C({__name:"AccessControlEditor",setup(r){const e=()=>{t.value={type:"initial"}},t=U({type:"initial"}),f=U("enforcement"),i=new Ut,{result:m,refetch:o}=x(async()=>await i.list()),u=v(()=>{var A;return((A=m.value)==null?void 0:A.filter(_=>_.hasChanges()))||[]}),p=async()=>{await i.update(u.value),await o()},n=new He,{result:c,loading:w,refetch:B}=x(()=>n.list()),ce=async A=>{await n.create(A),await B(),e()},de=async A=>{await n.update(A.id,A.changes),await B(),e()},pe=async A=>{await n.delete(A.id),await B(),e()},J=new Zt,{result:O,refetch:me}=x(()=>J.get()),fe=async()=>{!O.value||(await J.update(O.value),await me())},ge=new ke,{result:q,loading:ye}=x(()=>ge.list(100,0));return(A,_)=>(d(),h(be,null,{default:s(()=>[l(a(je),null,{default:s(()=>[g("Access Control")]),_:1}),l(a(F),null,{default:s(()=>[g(" Configure the security level of your application. You can define which pages are accessible to signed-in users, which pages are accessible to users with specific roles, and which pages are accessible to everyone. ")]),_:1}),l(a(Ue),{"active-key":f.value,"onUpdate:activeKey":_[0]||(_[0]=H=>f.value=H)},{default:s(()=>[l(a(G),{key:"enforcement",tab:"Security Level"}),l(a(G),{key:"signup-policy",tab:"Sign-Up Policy"}),l(a(G),{key:"users",tab:"Test Users"})]),_:1},8,["active-key"]),f.value==="enforcement"&&a(m)?(d(),h(Tt,{key:0,"access-controls":a(m),"onUpdate:accessControls":_[1]||(_[1]=H=>Q(m)?m.value=H:null),roles:a(q)||[],loading:a(ye),onSave:p},null,8,["access-controls","roles","loading"])):V("",!0),f.value==="users"?(d(),h(a(Et),{key:1,loading:a(w),users:a(c)||[],onDelete:pe,onCreate:_[2]||(_[2]=()=>t.value={type:"user-create"}),onEdit:_[3]||(_[3]=H=>t.value={type:"user-update",user:H})},null,8,["loading","users"])):V("",!0),f.value==="signup-policy"&&a(O)?(d(),h(Dt,{key:2,"signup-policy":a(O),"onUpdate:signupPolicy":_[4]||(_[4]=H=>Q(O)?O.value=H:null),onSave:fe},null,8,["signup-policy"])):V("",!0),t.value.type==="user-create"?(d(),h(a(Bt),{key:3,"role-options":a(q)||[],onCreated:ce,onCancel:e},null,8,["role-options"])):V("",!0),t.value.type==="user-update"?(d(),h(a(qt),{key:4,value:t.value.user,"role-options":a(q)||[],onUpdated:de,onCancel:e},null,8,["value","role-options"])):V("",!0)]),_:1}))}});export{xa as default};
//# sourceMappingURL=AccessControlEditor.44451af3.js.map

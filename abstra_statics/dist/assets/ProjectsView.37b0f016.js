var y=Object.defineProperty;var I=(n,e,t)=>e in n?y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(I(n,typeof e!="symbol"?e+"":e,t),t);import{C}from"./CrudView.408a4461.js";import{e as u,f as w,cM as T,ep as k,d as z,ea as E,eo as _,o as g,Y as O,u as a,c as j,S as v,b as c,w as m,aS as S,cz as P,bL as N,aB as A,cy as D,cL as R}from"./index.0f630b70.js";import"./gateway.50cd3949.js";import{M as V}from"./member.60d3de62.js";import{P as b,a as x}from"./project.79269899.js";import"./tables.78c50568.js";import{a as F}from"./ant-design.7d916c63.js";import{T as M,G as U}from"./tagColorProvider.3e96974a.js";import{I as B}from"./PhCopy.vue.5635ce6e.js";import{O as L}from"./organization.54ff4f89.js";import"./router.0f31f3f1.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.bf268869.js";import"./BookOutlined.89f2a8c6.js";import"./url.90c69b58.js";import"./PhDotsThreeVertical.vue.e2e73559.js";import"./Badge.ada44968.js";import"./index.1eaf0cd2.js";import"./popupNotifcation.dd76a56c.js";import"./record.f729e500.js";import"./string.532e13bb.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="60aeb91a-237e-49b8-b710-252e60a12d3e",n._sentryDebugIdIdentifier="sentry-dbid-60aeb91a-237e-49b8-b710-252e60a12d3e")}catch{}})();const $=[{key:"name",label:"Project Name"}];class G{constructor(e,t,r){o(this,"projects",u(null));o(this,"organization",u(null));o(this,"editingProject",u(null));o(this,"teamColorProvider",new M);o(this,"teamOptions",u([]));o(this,"table",w(()=>this.makeCrudViewTable()));o(this,"loading",w(()=>!this.projects.value||!this.organization.value));o(this,"createProject",async e=>{const t=await b.create({organizationId:this.organizationId,name:e.name});this.handlers.navigateToProject(t.id)});o(this,"deleteProject",async({key:e})=>{var r,s;if(!!await F("Are you sure you want to delete this project?")){try{await((s=(r=this.projects.value)==null?void 0:r.find(l=>l.id===e))==null?void 0:s.delete())}catch(l){T.error({message:"Error deleting project",description:String(l)})}await this.fetchInitialState()}});o(this,"duplicateProject",async({key:e})=>{var r;const t=(r=this.projects.value)==null?void 0:r.find(s=>s.id===e);if(t){const s=await t.duplicate();this.handlers.navigateToProject(s.id)}});o(this,"saveEdit",async()=>{if(!this.editingProject.value)return;const{projectId:e,newName:t,newTeam:r}=this.editingProject.value;await this.apis.project.update(e,{name:t,team:r}),await this.fetchInitialState(),this.editingProject.value=null});o(this,"cancelEdit",()=>{this.editingProject.value=null});o(this,"getActions",e=>{var t;return[{icon:U,label:"Edit project",onClick:()=>this.startEditingProject(e)},{icon:B,label:"Duplicate",onClick:()=>this.duplicateProject({key:e.id}),hide:!!((t=this.organization.value)!=null&&t.featureFlags.DUPLICATE_PROJECTS)},{icon:k,label:"Delete",onClick:()=>this.deleteProject({key:e.id}),dangerous:!0}]});o(this,"getRows",()=>this.projects.value?this.projects.value.map(e=>({key:e.id,cells:[{type:"link",text:e.name,to:`/projects/${encodeURIComponent(e.id)}`},{type:"tag",text:e.team||"No team",tagColor:e.team?this.teamColorProvider.getColor(e.team):"default"},{type:"actions",actions:this.getActions(e)}]})):[]);this.organizationId=e,this.handlers=t,this.apis=r}async fetchInitialState(){this.projects.value=await b.list(this.organizationId),this.organization.value=await L.get(this.organizationId),this.teamOptions.value=await this.fetchTeamOptions()}async fetchTeamOptions(){return(await this.apis.member.fetchTeamOptions(this.organizationId)).map(t=>({label:t,value:t}))}startEditingProject(e){var t;this.editingProject.value={projectId:e.id,newName:e.name,newTeam:(t=e.team)!=null?t:""}}makeCrudViewTable(){return{columns:[{title:"Project",align:"left"},{title:"Team",align:"center"},{title:"",align:"right"}],rows:this.getRows()}}}const me=z({__name:"ProjectsView",setup(n){const t=E().params.organizationId,r=_(),s={navigateToProject:h=>r.push({name:"project",params:{organizationId:t,projectId:h}})},l={member:new V,project:new x},i=new G(t,s,l);return i.fetchInitialState(),(h,d)=>{var f;return g(),O(S,null,[a(i).table.value?(g(),j(C,{key:0,"entity-name":"project",loading:a(i).loading.value,title:`${(f=a(i).organization.value)==null?void 0:f.name}'s Projects`,description:"Organize your team\u2019s work into different Projects, each with it\u2019s own environment settings and authorized users.","create-button-text":"Create Project","empty-title":"No projects here yet",table:a(i).table.value,fields:a($),create:a(i).createProject},null,8,["loading","title","table","fields","create"])):v("",!0),c(a(R),{open:!!a(i).editingProject.value,title:"Edit project",onCancel:a(i).cancelEdit,onOk:a(i).saveEdit},{default:m(()=>[a(i).editingProject.value?(g(),j(a(D),{key:0,layout:"vertical"},{default:m(()=>[c(a(P),{label:"Name"},{default:m(()=>[c(a(N),{value:a(i).editingProject.value.newName,"onUpdate:value":d[0]||(d[0]=p=>a(i).editingProject.value.newName=p)},null,8,["value"])]),_:1}),c(a(P),{label:"Team",tooltip:"Create Teams by adding them on the Editors page",help:a(i).editingProject.value.newTeam?`Only editors within '${a(i).editingProject.value.newTeam}' or organization Admins can view the project`:"Project will be visible to all editors"},{default:m(()=>[c(a(A),{value:a(i).editingProject.value.newTeam,"onUpdate:value":d[1]||(d[1]=p=>a(i).editingProject.value.newTeam=p),"allow-clear":"",options:a(i).teamOptions.value,placeholder:"Select or type new team name","not-found-content":"Create a team first on the Editors page"},null,8,["value","options"])]),_:1},8,["help"])]),_:1})):v("",!0)]),_:1},8,["open","onCancel","onOk"])],64)}}});export{me as default};
//# sourceMappingURL=ProjectsView.37b0f016.js.map

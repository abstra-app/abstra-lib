var st=Object.defineProperty;var nt=(t,e,a)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var ge=(t,e,a)=>(nt(t,typeof e!="symbol"?e+"":e,a),a);import{a as lt}from"./editor.cc0fbe0b.js";import{g as it,W as rt,w as ut}from"./controller.242dbe0f.js";import{o as R,u as dt}from"./omniChatStore.b69b1ac5.js";import{a as ct}from"./asyncComputed.82e95638.js";import{d as B,al as N,c as x,o as i,W as h,Y as T,h as M,e6 as ue,e as b,f as v,b as f,u as l,aQ as G,eb as de,a as C,db as Q,d7 as oe,g as Z,ec as Y,ej as U,cK as pt,_ as le,r as S,w as he,by as He,as as Ze,aU as Pe,ed as Ce,X as K,bQ as me,k as ye,j as Ve,bI as xe,cw as Ne,cv as Ye,M as Xe,eB as ft,e4 as gt,ek as vt,T as ht,bL as mt,eP as yt,eQ as wt,ep as kt,ap as _t,eq as bt,er as $t}from"./jwt-decode.esm.d8763b5b.js";import{u as O,P as Ht,_ as Ct,g as Oe,a as Vt,b as xt,c as ie,N as At,e as Mt,M as St,f as Dt}from"./index.22f12f6c.js";import"./linters.17034461.js";import{W as re}from"./workspaces.de471929.js";import{U as Et}from"./UnsavedChangesHandler.b5421034.js";import{w as Ae,s as zt}from"./metadata.513bbe10.js";import{_ as Ft,a as It}from"./vue-flow-minimap.1425aced.js";import{G as Tt}from"./PhArrowCounterClockwise.vue.93ba5f3a.js";import{F as Bt,C as Lt}from"./filesController.f9a12522.js";import{T as Zt}from"./TasksManager.b4528bc3.js";import{n as Pt}from"./string.3420fdec.js";import{a as Nt,b as Yt,n as Xt}from"./validations.4e5a0aba.js";import"./index.32f2ed41.js";import{A as Ot}from"./index.3866206c.js";import{t as We}from"./index.0a72ee32.js";import{B as Wt}from"./Badge.8e0c0079.js";import{G as Be}from"./PhArrowDown.vue.afd39d20.js";import"./userStore.3dd5baf4.js";import"./workspaceStore.e29351e7.js";import"./runnerData.8197ed0d.js";import"./url.b9e61201.js";import"./colorHelpers.aaea5d39.js";import"./constants.a1417080.js";import"./uuid.6121747a.js";import"./record.19092615.js";import"./ExclamationCircleOutlined.663513a4.js";import"./PhWebhooksLogo.vue.709f8213.js";import"./tasksController.510288e4.js";import"./gateway.ecde0932.js";import"./popupNotifcation.7f1daeb6.js";import"./scripts.f1def2fe.js";import"./polling.92851069.js";import"./ant-design.45c13f7b.js";import"./PhArrowSquareOut.vue.c07b32d9.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.3bb0a359.js";import"./index.2741bd9e.js";import"./Card.d9d1f8ed.js";import"./TabPane.382e7070.js";import"./CollapsePanel.b73b2806.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="c1abea70-2cf0-4772-a1cc-78d3d57d6122",t._sentryDebugIdIdentifier="sentry-dbid-c1abea70-2cf0-4772-a1cc-78d3d57d6122")}catch{}})();const jt=["width","height","fill","transform"],Ut={key:0},Gt=b("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),qt=[Gt],Rt={key:1},Kt=b("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Qt=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Jt=[Kt,Qt],ea={key:2},ta=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),aa=[ta],oa={key:3},sa=b("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),na=[sa],la={key:4},ia=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ra=[ia],ua={key:5},da=b("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),ca=[da],pa={name:"PhArrowClockwise"},fa=B({...pa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=N("weight","regular"),s=N("size","1em"),o=N("color","currentColor"),u=N("mirrored",!1),c=x(()=>{var n;return(n=e.weight)!=null?n:a}),_=x(()=>{var n;return(n=e.size)!=null?n:s}),w=x(()=>{var n;return(n=e.color)!=null?n:o}),g=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(n,k)=>(i(),h("svg",ue({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:w.value,transform:g.value},n.$attrs),[T(n.$slots,"default"),c.value==="bold"?(i(),h("g",Ut,qt)):c.value==="duotone"?(i(),h("g",Rt,Jt)):c.value==="fill"?(i(),h("g",ea,aa)):c.value==="light"?(i(),h("g",oa,na)):c.value==="regular"?(i(),h("g",la,ra)):c.value==="thin"?(i(),h("g",ua,ca)):M("",!0)],16,jt))}}),ga=["width","height","fill","transform"],va={key:0},ha=b("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),ma=[ha],ya={key:1},wa=b("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),ka=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),_a=[wa,ka],ba={key:2},$a=b("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),Ha=[$a],Ca={key:3},Va=b("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),xa=[Va],Aa={key:4},Ma=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Sa=[Ma],Da={key:5},Ea=b("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),za=[Ea],Fa={name:"PhFunnel"},Ia=B({...Fa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=N("weight","regular"),s=N("size","1em"),o=N("color","currentColor"),u=N("mirrored",!1),c=x(()=>{var n;return(n=e.weight)!=null?n:a}),_=x(()=>{var n;return(n=e.size)!=null?n:s}),w=x(()=>{var n;return(n=e.color)!=null?n:o}),g=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(n,k)=>(i(),h("svg",ue({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:w.value,transform:g.value},n.$attrs),[T(n.$slots,"default"),c.value==="bold"?(i(),h("g",va,ma)):c.value==="duotone"?(i(),h("g",ya,_a)):c.value==="fill"?(i(),h("g",ba,Ha)):c.value==="light"?(i(),h("g",Ca,xa)):c.value==="regular"?(i(),h("g",Aa,Sa)):c.value==="thin"?(i(),h("g",Da,za)):M("",!0)],16,ga))}}),Ta=["width","height","fill","transform"],Ba={key:0},La=b("path",{d:"M160,116h48a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20V60H128a28,28,0,0,0-28,28v28H76v-4A20,20,0,0,0,56,92H24A20,20,0,0,0,4,112v32a20,20,0,0,0,20,20H56a20,20,0,0,0,20-20v-4h24v28a28,28,0,0,0,28,28h12v12a20,20,0,0,0,20,20h48a20,20,0,0,0,20-20V160a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20v12H128a4,4,0,0,1-4-4V88a4,4,0,0,1,4-4h12V96A20,20,0,0,0,160,116ZM52,140H28V116H52Zm112,24h40v40H164Zm0-112h40V92H164Z"},null,-1),Za=[La],Pa={key:1},Na=b("path",{d:"M64,112v32a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V112a8,8,0,0,1,8-8H56A8,8,0,0,1,64,112ZM208,40H160a8,8,0,0,0-8,8V96a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V48A8,8,0,0,0,208,40Zm0,112H160a8,8,0,0,0-8,8v48a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152Z",opacity:"0.2"},null,-1),Ya=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),Xa=[Na,Ya],Oa={key:2},Wa=b("path",{d:"M144,96V80H128a8,8,0,0,0-8,8v80a8,8,0,0,0,8,8h16V160a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16v48a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V192H128a24,24,0,0,1-24-24V136H72v8a16,16,0,0,1-16,16H24A16,16,0,0,1,8,144V112A16,16,0,0,1,24,96H56a16,16,0,0,1,16,16v8h32V88a24,24,0,0,1,24-24h16V48a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16V96a16,16,0,0,1-16,16H160A16,16,0,0,1,144,96Z"},null,-1),ja=[Wa],Ua={key:3},Ga=b("path",{d:"M160,110h48a14,14,0,0,0,14-14V48a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14V66H128a22,22,0,0,0-22,22v34H70V112A14,14,0,0,0,56,98H24a14,14,0,0,0-14,14v32a14,14,0,0,0,14,14H56a14,14,0,0,0,14-14V134h36v34a22,22,0,0,0,22,22h18v18a14,14,0,0,0,14,14h48a14,14,0,0,0,14-14V160a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14v18H128a10,10,0,0,1-10-10V88a10,10,0,0,1,10-10h18V96A14,14,0,0,0,160,110ZM58,144a2,2,0,0,1-2,2H24a2,2,0,0,1-2-2V112a2,2,0,0,1,2-2H56a2,2,0,0,1,2,2Zm100,16a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2v48a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Zm0-112a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2V96a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Z"},null,-1),qa=[Ga],Ra={key:4},Ka=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),Qa=[Ka],Ja={key:5},eo=b("path",{d:"M160,108h48a12,12,0,0,0,12-12V48a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12V68H128a20,20,0,0,0-20,20v36H68V112a12,12,0,0,0-12-12H24a12,12,0,0,0-12,12v32a12,12,0,0,0,12,12H56a12,12,0,0,0,12-12V132h40v36a20,20,0,0,0,20,20h20v20a12,12,0,0,0,12,12h48a12,12,0,0,0,12-12V160a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12v20H128a12,12,0,0,1-12-12V88a12,12,0,0,1,12-12h20V96A12,12,0,0,0,160,108ZM60,144a4,4,0,0,1-4,4H24a4,4,0,0,1-4-4V112a4,4,0,0,1,4-4H56a4,4,0,0,1,4,4Zm96,16a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4v48a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Zm0-112a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V96a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Z"},null,-1),to=[eo],ao={name:"PhTreeStructure"},oo=B({...ao,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=N("weight","regular"),s=N("size","1em"),o=N("color","currentColor"),u=N("mirrored",!1),c=x(()=>{var n;return(n=e.weight)!=null?n:a}),_=x(()=>{var n;return(n=e.size)!=null?n:s}),w=x(()=>{var n;return(n=e.color)!=null?n:o}),g=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:u?"scale(-1, 1)":void 0);return(n,k)=>(i(),h("svg",ue({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:w.value,transform:g.value},n.$attrs),[T(n.$slots,"default"),c.value==="bold"?(i(),h("g",Ba,Za)):c.value==="duotone"?(i(),h("g",Pa,Xa)):c.value==="fill"?(i(),h("g",Oa,ja)):c.value==="light"?(i(),h("g",Ua,qa)):c.value==="regular"?(i(),h("g",Ra,Qa)):c.value==="thin"?(i(),h("g",Ja,to)):M("",!0)],16,Ta))}});class je{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const W=t=>je.isMac?t.metaKey:t.ctrlKey,so=t=>t.shiftKey,no=["onDragstart"],lo={style:{display:"flex","flex-direction":"column","max-width":"250px"}},io=B({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){return(a,s)=>(i(),h(G,null,[v(l(Q),{class:"toolbar",align:"center"},{default:f(()=>[(i(!0),h(G,null,de(l(Ae).stages,o=>(i(),C(l(pt),{key:o.key,placement:"top"},{title:f(()=>[v(l(Q),{gap:"small"},{default:f(()=>[v(l(oe),null,{default:f(()=>[Z(Y(o.title),1)]),_:2},1024),v(l(oe),{keyboard:""},{default:f(()=>[Z(Y(o.key),1)]),_:2},1024)]),_:2},1024)]),content:f(()=>[b("div",lo,[v(l(oe),null,{default:f(()=>[Z(Y(o.description),1)]),_:2},1024)])]),default:f(()=>[b("div",{draggable:!0,class:"toolbar__item",onDragstart:u=>e("drag-start",u.dataTransfer,o.typeName)},[(i(),C(U(o.icon),{size:18}))],40,no)]),_:2},1024))),128))]),_:1}),v(Et,{"has-changes":a.controller.hasChanges()},null,8,["has-changes"])],64))}});const ro=le(io,[["__scopeId","data-v-376981bb"]]);function Ue(){let t;const e={draggedType:S(null),isDragOver:S(!1),isAdding:S(!1),isDragging:S(!1),mousePosition:S(null)},{draggedType:a,isDragOver:s,isDragging:o,isAdding:u}=e,c=V=>{t=V,document.addEventListener("mousemove",d)},{screenToFlowCoordinate:_}=O();he(u,V=>{document.body.style.userSelect=V?"none":""});function w(V,E){u.value=!0,V?(V.setData("application/vueflow",E),V.effectAllowed="move",a.value=E,o.value=!0,document.addEventListener("drop",k)):(a.value=E,document.addEventListener("click",H))}function g(V){V.preventDefault(),a.value&&(s.value=!0,V.dataTransfer&&(V.dataTransfer.dropEffect="move"))}function n(){s.value=!1}function k(){u.value=!1,o.value=!1,s.value=!1,a.value=null,document.removeEventListener("drop",k)}function d(V){const E={x:V.pageX-200,y:V.pageY-80};e.mousePosition.value=E}function p(V){if(!a.value)throw new Error("No dragged type");return _({x:V.clientX-70,y:V.clientY-25})}function H(V){if(!t)return;if(!a.value)throw new Error("No dragged type");const E=p(V);t.addStages([{type:a.value,position:E}]),k()}function L(){document.removeEventListener("mousemove",d)}return{init:c,tearDown:L,draggedType:a,isDragOver:s,isAdding:u,isDragging:o,mousePosition:e.mousePosition,onDragStart:w,onDragLeave:n,onDragOver:g,onDrop:H}}const uo={name:"ControlButton",compatConfig:{MODE:3}},co=(t,e)=>{const a=t.__vccOpts||t;for(const[s,o]of e)a[s]=o;return a},po={class:"vue-flow__controls-button"};function fo(t,e,a,s,o,u){return i(),h("button",po,[T(t.$slots,"default")])}const ae=co(uo,[["render",fo]]),go={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},vo=b("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),ho=[vo];function mo(t,e){return i(),h("svg",go,ho)}const yo={render:mo},wo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},ko=b("path",{d:"M0 0h32v4.2H0z"},null,-1),_o=[ko];function bo(t,e){return i(),h("svg",wo,_o)}const $o={render:bo},Ho={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Co=b("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Vo=[Co];function xo(t,e){return i(),h("svg",Ho,Vo)}const Ao={render:xo},Mo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},So=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Do=[So];function Eo(t,e){return i(),h("svg",Mo,Do)}const zo={render:Eo},Fo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Io=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),To=[Io];function Bo(t,e){return i(),h("svg",Fo,To)}const Lo={render:Bo},Zo={name:"Controls",compatConfig:{MODE:3}},Po=B({...Zo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>Ht.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:a,nodesConnectable:s,elementsSelectable:o,setInteractive:u,zoomIn:c,zoomOut:_,fitView:w,viewport:g,minZoom:n,maxZoom:k}=O(),d=He(()=>a.value||s.value||o.value),p=He(()=>g.value.zoom<=n.value),H=He(()=>g.value.zoom>=k.value);function L(){c(),e("zoomIn")}function V(){_(),e("zoomOut")}function E(){w(t.fitViewParams),e("fitView")}function F(){u(!d.value),e("interactionChange",!d.value)}return($,I)=>(i(),C(l(Ct),{class:"vue-flow__controls",position:$.position},{default:f(()=>[T($.$slots,"top"),$.showZoom?(i(),h(G,{key:0},[T($.$slots,"control-zoom-in",{},()=>[v(ae,{class:"vue-flow__controls-zoomin",disabled:H.value,onClick:L},{default:f(()=>[T($.$slots,"icon-zoom-in",{},()=>[(i(),C(U(l(yo))))])]),_:3},8,["disabled"])]),T($.$slots,"control-zoom-out",{},()=>[v(ae,{class:"vue-flow__controls-zoomout",disabled:p.value,onClick:V},{default:f(()=>[T($.$slots,"icon-zoom-out",{},()=>[(i(),C(U(l($o))))])]),_:3},8,["disabled"])])],64)):M("",!0),$.showFitView?T($.$slots,"control-fit-view",{key:1},()=>[v(ae,{class:"vue-flow__controls-fitview",onClick:E},{default:f(()=>[T($.$slots,"icon-fit-view",{},()=>[(i(),C(U(l(Ao))))])]),_:3})]):M("",!0),$.showInteractive?T($.$slots,"control-interactive",{key:2},()=>[$.showInteractive?(i(),C(ae,{key:0,class:"vue-flow__controls-interactive",onClick:F},{default:f(()=>[d.value?T($.$slots,"icon-unlock",{key:0},()=>[(i(),C(U(l(Lo))))]):M("",!0),d.value?M("",!0):T($.$slots,"icon-lock",{key:1},()=>[(i(),C(U(l(zo))))])]),_:3})):M("",!0)]):M("",!0),T($.$slots,"default")]),_:3},8,["position"]))}}),No=B({__name:"ControlButtons",props:{workflow:{}},setup(t){const e=t,{fitView:a}=O(),s=()=>{e.workflow.autoLayout(),Ze(()=>{a()})};return(o,u)=>(i(),C(l(Po),{position:"top-left","show-interactive":!1},{default:f(()=>[v(l(ae),{title:"Auto layout",onClick:u[0]||(u[0]=c=>s())},{default:f(()=>[v(l(oo))]),_:1}),v(l(ae),{title:"Undo",disabled:!o.workflow.history.canUndo(),onClick:u[1]||(u[1]=c=>o.workflow.history.undo())},{default:f(()=>[v(l(Tt))]),_:1},8,["disabled"]),v(l(ae),{title:"Redo",disabled:!o.workflow.history.canRedo(),onClick:u[2]||(u[2]=c=>o.workflow.history.redo())},{default:f(()=>[v(l(fa))]),_:1},8,["disabled"])]),_:1}))}});class P{constructor(e){ge(this,"angle");e=P.normalize(e),this.angle=e}static normalize(e){const a=Math.PI;return((e+a)%(2*a)+2*a)%(2*a)-a}static fromRadians(e){return new P(P.normalize(e))}static fromDegrees(e){const a=e*Math.PI/180;return new P(a)}static fromPoints(e,a){const s=a.x-e.x,o=a.y-e.y,u=Math.atan2(o,s);return new P(u)}get degrees(){return this.angle*180/Math.PI}get radians(){return this.angle}get isZero(){return this.angle===0}get isPositive(){return this.angle>0}get complementary(){return new P(Math.PI/2-this.angle)}get perpendicular(){return new P(Math.PI/2+this.angle)}get sin(){return Math.sin(this.angle)}get cos(){return Math.cos(this.angle)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new P(this.angle/e)}multiply(e){return new P(this.angle*e)}}class j{constructor(e,a){ge(this,"dx");ge(this,"dy");this.dx=e,this.dy=a}static fromPoints(e,a){const s=a.x-e.x,o=a.y-e.y;return new j(s,o)}static fromAngleAndLength(e,a){const s=a*e.cos,o=a*e.sin;return new j(s,o)}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}get opposite(){return new j(-this.dx,-this.dy)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new j(this.dx/e,this.dy/e)}add(e){return new j(this.dx+e.dx,this.dy+e.dy)}subtract(e){return new j(this.dx-e.dx,this.dy-e.dy)}}function Yo(t,e,a=1e-10){const s=e.center.x-e.width/2,o=e.center.x+e.width/2,u=e.center.y-e.height/2,c=e.center.y+e.height/2;return t.x>=s-a&&t.x<=o+a&&t.y>=u-a&&t.y<=c+a}function Le(t,e,a,s=1e-10){const o=a.center.x-a.width/2,u=a.center.x+a.width/2,c=a.center.y-a.height/2,_=a.center.y+a.height/2,w=e.x-t.x,g=e.y-t.y;let n=1/0,k=null;if(Yo(t,a,s))return null;if(Math.abs(w)>s){const d=(o-t.x)/w;if(d>0&&d<n){const p=t.y+d*g;p>=c-s&&p<=_+s&&(n=d,k={x:o,y:p})}}if(Math.abs(w)>s){const d=(u-t.x)/w;if(d>0&&d<n){const p=t.y+d*g;p>=c-s&&p<=_+s&&(n=d,k={x:u,y:p})}}if(Math.abs(g)>s){const d=(c-t.y)/g;if(d>0&&d<n){const p=t.x+d*w;p>=o-s&&p<=u+s&&(n=d,k={x:p,y:c})}}if(Math.abs(g)>s){const d=(_-t.y)/g;if(d>0&&d<n){const p=t.x+d*w;p>=o-s&&p<=u+s&&(n=d,k={x:p,y:_})}}return k}function Xo(t,e,a=0,s=0){a=Math.abs(a),t.height+=a*2,t.width+=a*2,e.height+=a*2,e.width+=a*2;const o=P.fromPoints(t.center,e.center),u=s*o.perpendicular.cos,c=s*o.perpendicular.sin,_={x:t.center.x+u,y:t.center.y+c},w={x:e.center.x+u,y:e.center.y+c};let g=Le(_,w,e);g||(g=e.center);let n=Le(w,_,t);return n||(n=t.center),{sourceX:n.x,sourceY:n.y,targetX:g.x,targetY:g.y}}function Oo(t,e=0){const a=P.fromPoints({x:t.sourceX,y:t.sourceY},{x:t.targetX,y:t.targetY}),s=Math.sqrt(Math.pow(t.targetX-t.sourceX,2)+Math.pow(t.targetY-t.sourceY,2)),o=P.fromRadians(Math.atan(2*e/s)).multiply(4),u=s/2/o.divide(2).sin,c=new j(t.sourceX+t.targetX,t.sourceY+t.targetY).divide(2),_=u*(1+(o.isPositive?-1:1)*o.divide(2).cos),w=j.fromAngleAndLength(a.perpendicular,_),g=e>0===o.isPositive?c.add(w):c.subtract(w);return{sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,labelX:g.x,labelY:g.y,radius:u,largeArcFlag:o.isPositive?0:1,sweepFlag:0}}function Ge(t,e,a=0,s=0){const u={center:{x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},width:t.dimensions.width,height:t.dimensions.height},_={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return Xo(u,_,a,s)}function qe(t,e,a=0){return Ge(t,e,10,a)}function Wo(t,e,a=0){a=Math.abs(a);const s=qe(t,e,a/2);if(a===0)return Oe(s);const o=Oo(s,a);return[`M${o.sourceX},${o.sourceY} A${o.radius},${o.radius} 0 ${o.largeArcFlag},${o.sweepFlag} ${o.targetX},${o.targetY}`,o.labelX,o.labelY,0,0]}const jo=B({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(i(),C(l(Q),{vertical:"",gap:"small",style:K({marginBottom:`-${16*e.menuOptions.length}%`})},{default:f(()=>[(i(!0),h(G,null,de(e.menuOptions,s=>(i(),C(l(Pe),{key:s.label,title:s.tooltip,placement:"right"},{default:f(()=>[v(l(me),{class:Ce([{"warning-button":s.warning}]),disabled:s.disabled,style:K({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:o=>s.click(o)},{default:f(()=>[v(l(Q),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:f(()=>[Z(Y(s.label)+" ",1),s.key?(i(),C(l(oe),{key:0,keyboard:"",disabled:s.disabled},{default:f(()=>[Z(Y(s.key),1)]),_:2},1032,["disabled"])):M("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const Uo=B({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,a=[{label:"Edit task type",key:"E",click:()=>o.value="editing"},{label:"Delete",key:"Del",click:()=>d(e.data.id)}],s=S(e.data.props.taskType||""),o=S("idle"),u=()=>{o.value!=="idle"&&(s.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:s.value}),o.value="idle")},{onEdgeClick:c,onPaneClick:_,getSelectedEdges:w}=O();c(p=>{p.edge.id===e.id&&o.value==="idle"&&(o.value="selected")}),_(()=>u());const g=x(()=>e.controller.edgeIsLonely(e.id)?0:20),n=x(()=>Wo(e.sourceNode,e.targetNode,g.value)),k=p=>{if(!!w.value.map(H=>H.id).includes(e.data.id)&&(p.key==="Enter"&&u(),(p.key==="e"||p.key==="E")&&(o.value="editing"),p.key==="Backspace"||p.key==="Delete")){if(o.value==="editing")return;d(e.data.id)}},{removeEdges:d}=O();return ye(()=>window.addEventListener("keydown",k)),Ve(()=>window.removeEventListener("keydown",k)),(p,H)=>(i(),h(G,null,[v(l(Vt),{path:n.value[0],"marker-end":p.markerEnd},null,8,["path","marker-end"]),v(l(xt),null,{default:f(()=>[o.value==="idle"?(i(),h("div",{key:0,style:K({transform:`translate(-50%, -50%) translate(${n.value[1]}px,${n.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(i(),C(l(oe),{key:1},{default:f(()=>[Z(Y(e.data.props.taskType),1)]),_:1})):(i(),C(l(Ia),{key:0,size:16}))],4)):o.value==="selected"?(i(),h("div",{key:1,style:K({transform:`translate(-50%, -120%) translate(${n.value[1]}px,${n.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[v(jo,{"is-connecting":!0,"is-editing":!0,"menu-options":a})],4)):o.value==="editing"?(i(),h("div",{key:2,style:K({transform:`translate(-50%, -50%) translate(${n.value[1]}px,${n.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[v(l(xe),{value:s.value,"onUpdate:value":H[0]||(H[0]=L=>s.value=L),placeholder:"Task type"},null,8,["value"])],4)):M("",!0)]),_:1})],64))}});const Go=le(Uo,[["__scopeId","data-v-dd919c09"]]),qo={key:0},Ro=b("defs",null,[b("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[b("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),Ko=["d"],Qo=B({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,a=S(!0),{onNodeMouseEnter:s,onNodeMouseLeave:o}=O();s(w=>{w.node.id===e.sourceNode.id&&(a.value=!1)}),o(w=>{w.node.id===e.sourceNode.id&&(a.value=!0)});const u=x(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),c=x(()=>qe(e.sourceNode,u.value)),_=x(()=>Oe(c.value));return(w,g)=>a.value?(i(),h("g",qo,[Ro,b("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:_.value[0],"marker-end":"url(#arrowhead)"},null,8,Ko)])):M("",!0)}}),Jo=B({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const a=t,s=x(()=>{const o=Nt(a.filename);return o.valid?a.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:o});return(o,u)=>(i(),C(l(Xe),{open:o.creatingFileStatus==="prompting"||o.creatingFileStatus==="creating",closable:!1,"confirm-loading":o.creatingFileStatus==="creating",onOk:u[1]||(u[1]=c=>e("create-file",o.filename)),onCancel:u[2]||(u[2]=c=>e("cancel"))},{default:f(()=>[v(l(Ye),{layout:"vertical",disabled:o.creatingFileStatus=="creating"},{default:f(()=>[v(l(Ne),{label:"You're creating a new file. What should it be called?","validate-status":s.value.valid?"success":"error",help:s.value.valid?s.value.help:s.value.reason},{default:f(()=>[v(l(xe),{value:o.filename,onChange:u[0]||(u[0]=c=>e("update-filename",c.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),es={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},ts=B({...es,props:{nodeId:null,isVisible:{type:Boolean},position:{default:ie.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,a=N(At,null),{viewportRef:s,viewport:o,getSelectedNodes:u,findNode:c}=O();function _(p,H,L,V,E){let F=.5;E==="start"?F=0:E==="end"&&(F=1);let $=[(p.x+p.width*F)*H.zoom+H.x,p.y*H.zoom+H.y-V],I=[-100*F,-100];switch(L){case ie.Right:$=[(p.x+p.width)*H.zoom+H.x+V,(p.y+p.height*F)*H.zoom+H.y],I=[0,-100*F];break;case ie.Bottom:$[1]=(p.y+p.height)*H.zoom+H.y+V,I[1]=0;break;case ie.Left:$=[p.x*H.zoom+H.x-V,(p.y+p.height*F)*H.zoom+H.y],I=[-100,-100*F];break}return`translate(${$[0]}px, ${$[1]}px) translate(${I[0]}%, ${I[1]}%)`}const w=x(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||a||""]).reduce((p,H)=>{const L=c(H);return L&&p.push(L),p},[])),g=x(()=>typeof e.isVisible=="boolean"?e.isVisible:w.value.length===1&&w.value[0].selected&&u.value.length===1),n=x(()=>Mt(w.value)),k=x(()=>Math.max(...w.value.map(p=>(p.computedPosition.z||1)+1))),d=x(()=>({position:"absolute",transform:_(n.value,o.value,e.position,e.offset,e.align),zIndex:k.value}));return(p,H)=>(i(),C(ft,{to:l(s),disabled:!l(s)},[l(g)&&l(w).length?(i(),h("div",ue({key:0},p.$attrs,{style:l(d),class:"vue-flow__node-toolbar"}),[T(p.$slots,"default")],16)):M("",!0)],8,["to","disabled"]))}}),as=B({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(i(),C(l(ts),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:l(ie).Right},{default:f(()=>[v(l(Q),{vertical:"",gap:"small",style:K({marginBottom:`-${16*e.menuOptions.length}%`})},{default:f(()=>[(i(!0),h(G,null,de(e.menuOptions,s=>(i(),C(l(Pe),{key:s.label,title:s.tooltip,placement:"right"},{default:f(()=>[v(l(me),{class:Ce([{"warning-button":s.warning}]),disabled:s.disabled,style:K({backgroundColor:s.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:o=>s.click(o)},{default:f(()=>[v(l(Q),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:f(()=>[Z(Y(s.label)+" ",1),s.key?(i(),C(l(oe),{key:0,keyboard:"",disabled:s.disabled},{default:f(()=>[Z(Y(s.key),1)]),_:2},1032,["disabled"])):M("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const os=B({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Te;const e=t,{useToken:a}=We,s=gt(),{token:o}=a(),u=o.value.colorText,c=[{label:"Add transition",key:"C",click:r=>De(r)},{label:"Rename",key:"R",click:()=>X.value=!0},{label:"Go to editor",key:"Enter",click:()=>Se()},{label:"Tasks",key:"M",click:()=>w.value=!0},{label:"Delete",key:"Del",click:()=>n.value=!0}],_=x(()=>{let r=[...c];return g.value||r.unshift({label:"Create missing file",warning:!0,click:()=>ce()}),e.controller.hasChanges()&&(r=r.map(y=>y.label==="Go to editor"?{...y,disabled:!0,tooltip:"Save it to allow editing"}:y.label==="Tasks"?{...y,disabled:!0,tooltip:"Save it to allow managing tasks"}:y)),r}),w=S(!1),g=S(!0);he(()=>e.initialFileCheck,r=>{E.value||(g.value=r)});const n=S(!1),k=()=>{n.value=!1,se(e.stage)},d=new Lt,p=new Bt(d,{separator:"/"}),H=async()=>{if(n.value=!1,"filename"in e.stage.props&&e.stage.props.filename){const r=e.stage.props.filename;(await re.checkFile(r)).exists&&await p.deleteFile([r])}se(e.stage)},L=r=>{$.value=r,F()},V=()=>{var r;I.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&($.value=(r=e.stage.props.filename)!=null?r:"",F())},E=x(()=>e.controller.getUnsavedFilenameStages().some(r=>r.id===e.stage.id)),F=vt.exports.debounce(async()=>{if(E.value){g.value=!0;return}const r=$.value;if(!r){g.value=!0;return}re.checkFile(r).then(y=>{g.value=y.exists})},500),$=S((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Te=e.stage.props.filename)!=null?Te:""),I=S("idle"),we=async()=>{I.value="creating",await re.initFile($.value,e.stage.type),g.value=!0;const r=await re.checkFile($.value);if(g.value=r.exists,I.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:$.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:$.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},ke=x(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!g.value:!1),ce=()=>{I.value="prompting"},{startConnection:m,updateConnection:A,onNodeClick:D,addEdges:J,endConnection:q,removeNodes:se,onPaneClick:pe,getSelectedNodes:Ke,flowToScreenCoordinate:Me,onNodeMouseEnter:Qe,onNodeMouseLeave:Je,getNodes:et,onNodesChange:tt,applyNodeChanges:at}=O(),ee=S(!1),X=S(!1),te=S(e.stage.title),_e=S(!0),fe=x(()=>{const y=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Pt(te.value,!1,!0)}.py`;return y!==$.value?y:null}),be=S(!1),$e=S(!1);tt(async r=>{var z;const y=[];for(const ne of r)ne.type==="remove"?X.value||((z=e.controller)==null||z.delete([ne.id]),y.push(ne)):y.push(ne);at(y)});const Se=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);$e.value?window.open(`/_editor/${r}/${e.stage.id}`,"_blank"):s.push({path:`/_editor/${r}/${e.stage.id}`})},De=(r,y=!0)=>{m({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:y?r.pageX:r.pageX-90,y:y?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",Ee),ee.value=!0},Ee=r=>{ee.value&&!be.value&&A({x:r.pageX,y:r.pageY-52})};D(r=>{if(r.node.id===e.stage.id&&F(),ee.value&&r.node.id!==e.stage.id){const y={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:it(),props:{taskType:null}};try{e.controller.connect([y]),document.removeEventListener("mousemove",Ee),J({id:y.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:St.Arrow,width:24,height:24},data:y}),q(),ee.value=!1}catch(z){console.error(z)}}}),Qe(r=>{if(ee.value&&r.node.id!==e.stage.id){be.value=!0;const y=et.value.find(ne=>ne.id===e.stage.id);if(!y)return;const z=Ge(y,r.node,10);A(Me({x:z.targetX,y:z.targetY-52}))}}),Je(()=>{be.value=!1});const ot=()=>{if(!g.value){const r=Yt(te.value+".py");$.value=r;let y={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const z=Xt(te.value);y={...y,path:z}}e.controller.updateStageProps(e.stage.id,y)}},ze=async()=>{e.stage.title!==te.value&&(e.controller.updateStageTitle(e.stage.id,te.value),_e.value&&fe.value&&($.value=fe.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:$.value})),ot()),F()};pe(()=>{X.value&&ze(),X.value=!1,ee.value=!1,q()});const Fe=r=>{if($e.value=W(r),!!Ke.value.map(y=>y.id).includes(e.stage.id)&&I.value==="idle"){if(r.key==="Enter")if(X.value)X.value=!1,ze();else{if(e.controller.hasChanges())return;Se()}if(!X.value){if(r.key==="c"||r.key==="C"){const y=Me(e.stage.position);De({pageX:y.x,pageY:y.y},!1)}if((r.key==="r"||r.key==="R")&&(X.value=!0),r.key==="m"||r.key==="M"){if(e.controller.hasChanges())return;w.value=!0}(r.key==="Backspace"||r.key==="Delete")&&("filename"in e.stage.props&&e.stage.props.filename?n.value=!0:se(e.stage))}}},Ie=r=>{$e.value=W(r)};return ye(()=>{E.value||(g.value=e.initialFileCheck),window.addEventListener("keydown",Fe),window.addEventListener("keyup",Ie)}),Ve(()=>{window.removeEventListener("keydown",Fe),window.removeEventListener("keyup",Ie)}),(r,y)=>(i(),h(G,null,[v(as,{"is-connecting":ee.value,"is-editing":X.value,"menu-options":_.value},null,8,["is-connecting","is-editing","menu-options"]),v(l(Xe),{open:n.value,title:"Delete file",onCancel:y[0]||(y[0]=z=>n.value=!1)},{footer:f(()=>[v(l(Q),{justify:"space-between",gap:"small"},{default:f(()=>[v(l(me),{onClick:k},{default:f(()=>[Z("Delete only stage")]),_:1}),v(l(me),{type:"primary",danger:"",onClick:H},{default:f(()=>[Z("Yes, delete file")]),_:1})]),_:1})]),default:f(()=>[Z(" Do you also want to delete the file associated with the stage "+Y(r.stage.title)+"? ",1)]),_:1},8,["open"]),b("div",{class:"stage",onDblclick:y[3]||(y[3]=z=>X.value=!0)},[v(l(Q),{vertical:X.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:f(()=>[(i(),C(U(l(zt)(r.stage.type)),{size:18,color:l(u)},null,8,["color"])),X.value?(i(),C(l(Ye),{key:1,layout:"vertical"},{default:f(()=>[v(l(Ne),{label:"Title"},{default:f(()=>[v(l(xe),{value:te.value,"onUpdate:value":y[1]||(y[1]=z=>te.value=z),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),fe.value?(i(),C(l(mt),{key:0,checked:_e.value,"onUpdate:checked":y[2]||(y[2]=z=>_e.value=z),style:{"margin-bottom":"12px"}},{default:f(()=>[Z(" Update filename to "),v(l(oe),{code:""},{default:f(()=>[Z(Y(fe.value),1)]),_:1})]),_:1},8,["checked"])):M("",!0)]),_:1})):(i(),C(l(ht),{key:0,class:"title"},{default:f(()=>[Z(Y(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),ke.value?(i(),C(l(Wt),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):M("",!0),I.value==="prompting"||I.value==="creating"?(i(),C(Jo,{key:1,filename:$.value,"file-exists":g.value,"creating-file-status":I.value,onCreateFile:we,onCancel:V,onUpdateFilename:L},null,8,["filename","file-exists","creating-file-status"])):M("",!0),v(l(Ot),{visible:w.value,"onUpdate:visible":y[4]||(y[4]=z=>w.value=z),title:"Tasks",width:"500",onClose:y[5]||(y[5]=z=>w.value=!1)},{default:f(()=>[v(Zt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const ve=le(os,[["__scopeId","data-v-b6e56379"]]),Re=t=>(yt("data-v-f4278104"),t=t(),wt(),t),ss={class:"empty-hint"},ns={key:0,class:"drag-hint"},ls=Re(()=>b("div",{class:"title"},"Start here",-1)),is={key:1,class:"drop-hint"},rs=Re(()=>b("div",{class:"title"},"Drop here",-1)),us={key:2,class:"stages-hint"},ds={class:"header"},cs={class:"title"},ps={class:"description"},fs=B({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,a)=>(i(),h("div",ss,[e.showDragHint?(i(),h("div",ns,[ls,v(l(Be),{size:32,class:"arrow"})])):M("",!0),e.showDragHint?M("",!0):(i(),h("div",is,[rs,v(l(Be),{size:32,class:"arrow"})])),e.showDragHint?(i(),h("div",us,[(i(!0),h(G,null,de(l(Ae).stages,s=>(i(),h("div",{key:s.key,class:"stage-hint"},[b("div",ds,[(i(),C(U(s.icon))),b("span",cs,Y(s.title),1)]),b("div",ps,Y(s.description),1)]))),128))])):M("",!0)]))}});const gs=le(fs,[["__scopeId","data-v-f4278104"]]),vs=B({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;kt(n=>({"78afe136":l(c),"924fbe90":l(u)}));const a=Ue(),{useToken:s}=We,{token:o}=s(),u=o.value.colorPrimaryBorder,c=o.value.colorBgElevated,{onInit:_,fitView:w}=O();_(n=>{n.fitView()});const g=n=>{var k;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:n&&(k=e.initialFileCheckStatus[n])!=null?k:!1};return ye(()=>{const n=R.subscribe("stageCreated",async()=>{await e.workflow.forceServerState(),e.workflow.autoLayout()}),k=R.subscribe("stageEdited",async()=>{await e.workflow.forceServerState(),e.workflow.autoLayout()}),d=R.subscribe("transitionCreated",async()=>{await e.workflow.forceServerState(),e.workflow.autoLayout()}),p=R.subscribe("finishActions",async()=>{Ze(()=>{w()})});_t(()=>{R.unsubscribe(n),R.unsubscribe(d),R.unsubscribe(k),R.unsubscribe(p)})}),(n,k)=>n.workflow?(i(),C(l(Dt),{key:0,nodes:n.workflow.vueFlowNodes.value,edges:n.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":n.editable,"pan-on-scroll":l(je).isMac,"elements-selectable":n.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":[],onDragover:l(a).onDragOver,onDragleave:l(a).onDragLeave},{"connection-line":f(d=>[v(Qo,bt($t(d)),null,16)]),"edge-task":f(d=>[v(Go,ue(d,{controller:n.workflow}),null,16,["controller"])]),"node-forms":f(d=>[v(ve,{stage:d.data,node:d,controller:n.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":f(d=>[v(ve,{stage:d.data,node:d,controller:n.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":f(d=>[v(ve,{stage:d.data,node:d,controller:n.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":f(d=>[v(ve,{stage:d.data,node:d,controller:n.workflow,"initial-file-check":g(d.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),default:f(()=>[v(l(Ft)),n.editable&&!n.workflow.vueFlowNodes.value.length?(i(),C(gs,{key:0,"show-drag-hint":n.showDragHint},null,8,["show-drag-hint"])):M("",!0),v(l(It),{pannable:"",zoomable:""}),n.editable?(i(),C(No,{key:1,workflow:n.workflow},null,8,["workflow"])):M("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):M("",!0)}});const hs=le(vs,[["__scopeId","data-v-f251c860"]]),ms=B({__name:"WorkflowEditor",setup(t){const e=dt(),{init:a,tearDown:s,onDragStart:o,onDrop:u,isDragging:c,isAdding:_,draggedType:w,mousePosition:g}=Ue(),n=lt();he(n.lastEvent,async()=>{var m,A;(m=n.lastEvent.value)!=null&&m.filepath.endsWith("abstra.json")&&await((A=k.value)==null?void 0:A.syncState())});const{result:k}=ct(async()=>await rt.init(ut)),d=S(null),p=async()=>{if(!k.value)return;const m=k.value.vueFlowNodes.value.map(A=>{var D,J,q,se,pe;return((D=A.data)==null?void 0:D.type)==="forms"||((J=A.data)==null?void 0:J.type)==="hooks"||((q=A.data)==null?void 0:q.type)==="scripts"||((se=A.data)==null?void 0:se.type)==="jobs"?(pe=A.data)==null?void 0:pe.props.filename:null});d.value=await re.checkFiles(m.filter(A=>typeof A=="string"))};he(()=>k.value,()=>{k.value&&(a(k.value),p())});const{onNodeDragStop:H,onEdgesChange:L,getSelectedElements:V,getNodes:E,addSelectedNodes:F,zoomIn:$,fitView:I,zoomOut:we,applyEdgeChanges:ke}=O();H(m=>{var A;(A=k.value)==null||A.move(m.nodes.map(D=>({id:D.id,position:D.position})))}),L(m=>{var A;for(const D of m)D.type==="remove"&&((A=k.value)==null||A.delete([D.id]));ke(m)});const ce=m=>{var A,D;e.isInputFocused||!k.value||((m.key==="z"||m.key==="Z")&&W(m)&&(so(m)?k.value.history.redo():(A=k.value)==null||A.history.undo(),m.preventDefault()),W(m)&&(m.key==="s"||m.key==="S")&&((D=k.value)==null||D.save(),m.preventDefault()),!(W(m)&&(m.key==="f"||m.key==="F"))&&(V.value.length||(m.key==="f"||m.key==="F"?o(null,"forms"):m.key==="h"||m.key==="H"?o(null,"hooks"):m.key==="j"||m.key==="J"?o(null,"jobs"):m.key==="t"||m.key==="T"?o(null,"scripts"):(m.key==="a"||m.key==="A")&&W(m)?(F(E.value),m.preventDefault()):m.key==="0"&&W(m)?(I(),m.preventDefault()):(m.key==="="||m.key==="+")&&W(m)?(m.preventDefault(),$()):m.key==="-"&&W(m)&&(m.preventDefault(),we()))))};return ye(()=>{window.addEventListener("keydown",ce)}),Ve(()=>{window.removeEventListener("keydown",ce),s()}),(m,A)=>l(k)?(i(),h("div",{key:0,class:Ce(["workflow-container",{dragging:l(_)}]),onDrop:A[0]||(A[0]=(...D)=>l(u)&&l(u)(...D))},[v(hs,{workflow:l(k),editable:"","show-drag-hint":!l(_),"check-file-status":!0,"initial-file-check-status":d.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),v(ro,{controller:l(k),onDragStart:l(o)},null,8,["controller","onDragStart"]),(i(!0),h(G,null,de(l(Ae).stages,D=>{var J,q;return i(),h("div",{key:D.key},[l(_)&&!l(c)&&D.typeName===l(w)?(i(),h("div",{key:0,class:"dragging-node",style:K({left:`${(J=l(g))==null?void 0:J.x}px`,top:`${(q=l(g))==null?void 0:q.y}px`,position:"absolute",cursor:l(_)?"grabbing":"grab"})},[(i(),C(U(D.icon),{size:18}))],4)):M("",!0)])}),128))],34)):M("",!0)}});const un=le(ms,[["__scopeId","data-v-c970c4cf"]]);export{un as default};
//# sourceMappingURL=WorkflowEditor.e16b4933.js.map

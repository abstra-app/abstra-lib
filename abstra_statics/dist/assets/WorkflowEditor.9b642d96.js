var Qe=Object.defineProperty;var et=(t,e,s)=>e in t?Qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var ue=(t,e,s)=>(et(t,typeof e!="symbol"?e+"":e,s),s);import{g as tt,W as at,w as ot}from"./controller.7d30accd.js";import{a as ge}from"./asyncComputed.43ea2068.js";import{d as H,D as Y,f as M,o as n,Y as h,$ as F,S as D,e8 as he,a as A,b as u,w as d,u as a,aS as U,eb as de,c as b,dh as G,dc as te,aG as N,e9 as O,da as Ne,ec as X,cO as st,bT as Ae,a0 as ae,e as B,g as me,bB as we,aW as je,ed as Ie,Z as q,X as Se,ah as De,bL as pe,cz as ve,cy as Ze,cL as nt,et as lt,O as le,en as Oe,bz as it,bx as He,bR as rt,aB as _e,eA as dt,d9 as ut,ey as ct,ez as pt,el as gt,eG as ft,eH as vt}from"./index.f3c8f0bd.js";import{u as W,P as yt,_ as ht,a as mt,b as kt,g as Re,c as ce,N as wt,d as _t,M as bt,e as $t}from"./vue-flow-core.46089656.js";import"./linters.d91dd72a.js";import{W as fe}from"./workspaces.172ba3d5.js";import{U as Ct,G as At}from"./UnsavedChangesHandler.202a8200.js";import{w as xe,s as It}from"./metadata.d8be5ea2.js";import{A as $e}from"./index.6b72fb4c.js";import{A as St}from"./index.c5495b52.js";import{_ as Dt,a as xt}from"./vue-flow-minimap.e5be7ad9.js";import{G as Mt}from"./PhArrowCounterClockwise.vue.d4191e7e.js";import{T as Et}from"./TasksManager.5eab4e26.js";import{a as zt,b as Bt,n as Vt}from"./validations.b9774558.js";import{u as Pt}from"./editor.60cc417b.js";import{A as Tt}from"./index.0764ee6e.js";import{t as Ue}from"./index.e4503151.js";import{B as Ht}from"./Badge.41495132.js";import{G as Le}from"./PhArrowDown.vue.c8a78e30.js";import"./uuid.f428292b.js";import"./workspaceStore.a9d10e56.js";import"./url.f792ff7c.js";import"./colorHelpers.98ceaf1a.js";import"./record.3d29baa1.js";import"./ExclamationCircleOutlined.b94f2dfe.js";import"./PhRobot.vue.acc7df5c.js";import"./PhWebhooksLogo.vue.982f3430.js";import"./tasksController.182fbd14.js";import"./gateway.2b0541c1.js";import"./popupNotifcation.06d25674.js";import"./scripts.7550ea3f.js";import"./polling.2e0e4e33.js";import"./string.538d1449.js";import"./ant-design.ddb9cdde.js";import"./PhArrowSquareOut.vue.14824ee3.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.75dac206.js";import"./Card.f2154f7b.js";import"./TabPane.aa83a8f1.js";import"./CollapsePanel.9afba98b.js";import"./index.357ab195.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="891c8f8a-a176-4470-be66-2a5b6283c36f",t._sentryDebugIdIdentifier="sentry-dbid-891c8f8a-a176-4470-be66-2a5b6283c36f")}catch{}})();const Lt=["width","height","fill","transform"],Ft={key:0},Nt=A("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),jt=[Nt],Zt={key:1},Ot=A("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Rt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Ut=[Ot,Rt],Kt={key:2},Xt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),Yt=[Xt],Wt={key:3},Gt=A("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),qt=[Gt],Jt={key:4},Qt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ea=[Qt],ta={key:5},aa=A("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),oa=[aa],sa={name:"PhArrowClockwise"},na=H({...sa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,s=Y("weight","regular"),o=Y("size","1em"),l=Y("color","currentColor"),f=Y("mirrored",!1),g=M(()=>{var c;return(c=e.weight)!=null?c:s}),w=M(()=>{var c;return(c=e.size)!=null?c:o}),_=M(()=>{var c;return(c=e.color)!=null?c:l}),i=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(c,v)=>(n(),h("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:_.value,transform:i.value},c.$attrs),[F(c.$slots,"default"),g.value==="bold"?(n(),h("g",Ft,jt)):g.value==="duotone"?(n(),h("g",Zt,Ut)):g.value==="fill"?(n(),h("g",Kt,Yt)):g.value==="light"?(n(),h("g",Wt,qt)):g.value==="regular"?(n(),h("g",Jt,ea)):g.value==="thin"?(n(),h("g",ta,oa)):D("",!0)],16,Lt))}}),la=["width","height","fill","transform"],ia={key:0},ra=A("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),da=[ra],ua={key:1},ca=A("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),pa=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),ga=[ca,pa],fa={key:2},va=A("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),ya=[va],ha={key:3},ma=A("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),ka=[ma],wa={key:4},_a=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),ba=[_a],$a={key:5},Ca=A("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Aa=[Ca],Ia={name:"PhFunnel"},Sa=H({...Ia,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,s=Y("weight","regular"),o=Y("size","1em"),l=Y("color","currentColor"),f=Y("mirrored",!1),g=M(()=>{var c;return(c=e.weight)!=null?c:s}),w=M(()=>{var c;return(c=e.size)!=null?c:o}),_=M(()=>{var c;return(c=e.color)!=null?c:l}),i=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(c,v)=>(n(),h("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:w.value,height:w.value,fill:_.value,transform:i.value},c.$attrs),[F(c.$slots,"default"),g.value==="bold"?(n(),h("g",ia,da)):g.value==="duotone"?(n(),h("g",ua,ga)):g.value==="fill"?(n(),h("g",fa,ya)):g.value==="light"?(n(),h("g",ha,ka)):g.value==="regular"?(n(),h("g",wa,ba)):g.value==="thin"?(n(),h("g",$a,Aa)):D("",!0)],16,la))}});class Me{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const ee=t=>Me.isMac?t.metaKey:t.ctrlKey,Da=t=>t.altKey,Ke=t=>t.shiftKey,be={alt:Da,"arrow-up":t=>t.code==="ArrowUp","arrow-down":t=>t.code==="ArrowDown","arrow-left":t=>t.code==="ArrowLeft","arrow-right":t=>t.code==="ArrowRight",ctrl:ee,delete:t=>Me.isMac?t.code==="Backspace":t.code==="Delete",enter:t=>t.code==="Enter",escape:t=>t.code==="Escape",shift:Ke,space:t=>t.code==="Space",a:t=>t.code==="KeyA",b:t=>t.code==="KeyB",c:t=>t.code==="KeyC",d:t=>t.code==="KeyD",f:t=>t.code==="KeyF",g:t=>t.code==="KeyG",h:t=>t.code==="KeyH",k:t=>t.code==="KeyK",p:t=>t.code==="KeyP",v:t=>t.code==="KeyV",x:t=>t.code==="KeyX",z:t=>t.code==="KeyZ",0:t=>t.code==="Digit0","[":t=>t.code==="BracketLeft","]":t=>t.code==="BracketRight"};class xa{constructor(e){ue(this,"pressedKeys");ue(this,"evt");this.evt=e,this.pressedKeys={};const s=o=>l=>{Object.keys(be).forEach(f=>{be[f](l)&&this.setPressed(f,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(e,s){this.pressedKeys[e]=s}isPressed(e){var s;return this.evt?be[e](this.evt):(s=this.pressedKeys[e])!=null?s:!1}}new xa;const Ma=["onDragstart"],Ea={style:{display:"flex","flex-direction":"column","max-width":"250px"}},za=H({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){return(s,o)=>(n(),h(U,null,[u(a(G),{class:"toolbar",align:"center"},{default:d(()=>[(n(!0),h(U,null,de(a(xe).stages,l=>(n(),b(a(st),{key:l.key,placement:"top"},{title:d(()=>[u(a(G),{gap:"small"},{default:d(()=>[u(a(te),null,{default:d(()=>[N(O(l.title),1)]),_:2},1024),u(a(te),{keyboard:""},{default:d(()=>[N(O(l.key),1)]),_:2},1024)]),_:2},1024)]),content:d(()=>[A("div",Ea,[u(a(te),null,{default:d(()=>[N(O(l.description),1)]),_:2},1024),l.beta?(n(),b(a($e),{key:0,type:"warning",class:"beta-alert"},{description:d(()=>[u(a(te),null,{default:d(()=>[N(" This is a beta feature, "),u(a(Ne),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:d(()=>[N(" click here ")]),_:1}),N(" to learn more about it ")]),_:1})]),_:1})):D("",!0)])]),default:d(()=>[A("div",{draggable:!0,class:"toolbar__item",onDragstart:f=>e("drag-start",f.dataTransfer,l.typeName)},[(n(),b(X(l.icon),{size:18}))],40,Ma)]),_:2},1024))),128)),u(a(St),{type:"vertical"}),u(a(Ae),{disabled:!s.controller.hasChanges(),onClick:o[0]||(o[0]=l=>s.controller.save())},{default:d(()=>[u(a(G),{align:"center",gap:"small"},{default:d(()=>[u(a(At),{size:16}),N(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),u(Ct,{"has-changes":s.controller.hasChanges()},null,8,["has-changes"])],64))}});const Ba=ae(za,[["__scopeId","data-v-8abfff78"]]);function Xe(){let t;const e={draggedType:B(null),isDragOver:B(!1),isAdding:B(!1),isDragging:B(!1),mousePosition:B(null)},{draggedType:s,isDragOver:o,isDragging:l,isAdding:f}=e,g=C=>{t=C,document.addEventListener("mousemove",S)},{screenToFlowCoordinate:w}=W();me(f,C=>{document.body.style.userSelect=C?"none":""});function _(C,V){f.value=!0,C?(C.setData("application/vueflow",V),C.effectAllowed="move",s.value=V,l.value=!0,document.addEventListener("drop",v)):(s.value=V,document.addEventListener("click",m))}function i(C){C.preventDefault(),s.value&&(o.value=!0,C.dataTransfer&&(C.dataTransfer.dropEffect="move"))}function c(){o.value=!1}function v(){f.value=!1,l.value=!1,o.value=!1,s.value=null,document.removeEventListener("drop",v)}function S(C){const V={x:C.pageX-200,y:C.pageY-80};e.mousePosition.value=V}function p(C){if(!s.value)throw new Error("No dragged type");return w({x:C.clientX-70,y:C.clientY-25})}function m(C){if(!t)return;if(!s.value)throw new Error("No dragged type");const V=p(C);t.addStages([{type:s.value,position:V}]),v()}function P(){document.removeEventListener("mousemove",S)}return{init:g,tearDown:P,draggedType:s,isDragOver:o,isAdding:f,isDragging:l,mousePosition:e.mousePosition,onDragStart:_,onDragLeave:c,onDragOver:i,onDrop:m}}const Va={name:"ControlButton",compatConfig:{MODE:3}},Pa=(t,e)=>{const s=t.__vccOpts||t;for(const[o,l]of e)s[o]=l;return s},Ta={class:"vue-flow__controls-button"};function Ha(t,e,s,o,l,f){return n(),h("button",Ta,[F(t.$slots,"default")])}const re=Pa(Va,[["render",Ha]]),La={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Fa=A("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),Na=[Fa];function ja(t,e){return n(),h("svg",La,Na)}const Za={render:ja},Oa={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Ra=A("path",{d:"M0 0h32v4.2H0z"},null,-1),Ua=[Ra];function Ka(t,e){return n(),h("svg",Oa,Ua)}const Xa={render:Ka},Ya={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Wa=A("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Ga=[Wa];function qa(t,e){return n(),h("svg",Ya,Ga)}const Ja={render:qa},Qa={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},eo=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),to=[eo];function ao(t,e){return n(),h("svg",Qa,to)}const oo={render:ao},so={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},no=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),lo=[no];function io(t,e){return n(),h("svg",so,lo)}const ro={render:io},uo={name:"Controls",compatConfig:{MODE:3}},co=H({...uo,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>yt.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:s,nodesConnectable:o,elementsSelectable:l,setInteractive:f,zoomIn:g,zoomOut:w,fitView:_,viewport:i,minZoom:c,maxZoom:v}=W(),S=we(()=>s.value||o.value||l.value),p=we(()=>i.value.zoom<=c.value),m=we(()=>i.value.zoom>=v.value);function P(){g(),e("zoomIn")}function C(){w(),e("zoomOut")}function V(){_(t.fitViewParams),e("fitView")}function T(){f(!S.value),e("interactionChange",!S.value)}return(I,j)=>(n(),b(a(ht),{class:"vue-flow__controls",position:I.position},{default:d(()=>[F(I.$slots,"top"),I.showZoom?(n(),h(U,{key:0},[F(I.$slots,"control-zoom-in",{},()=>[u(re,{class:"vue-flow__controls-zoomin",disabled:m.value,onClick:P},{default:d(()=>[F(I.$slots,"icon-zoom-in",{},()=>[(n(),b(X(a(Za))))])]),_:3},8,["disabled"])]),F(I.$slots,"control-zoom-out",{},()=>[u(re,{class:"vue-flow__controls-zoomout",disabled:p.value,onClick:C},{default:d(()=>[F(I.$slots,"icon-zoom-out",{},()=>[(n(),b(X(a(Xa))))])]),_:3},8,["disabled"])])],64)):D("",!0),I.showFitView?F(I.$slots,"control-fit-view",{key:1},()=>[u(re,{class:"vue-flow__controls-fitview",onClick:V},{default:d(()=>[F(I.$slots,"icon-fit-view",{},()=>[(n(),b(X(a(Ja))))])]),_:3})]):D("",!0),I.showInteractive?F(I.$slots,"control-interactive",{key:2},()=>[I.showInteractive?(n(),b(re,{key:0,class:"vue-flow__controls-interactive",onClick:T},{default:d(()=>[S.value?F(I.$slots,"icon-unlock",{key:0},()=>[(n(),b(X(a(ro))))]):D("",!0),S.value?D("",!0):F(I.$slots,"icon-lock",{key:1},()=>[(n(),b(X(a(oo))))])]),_:3})):D("",!0)]):D("",!0),F(I.$slots,"default")]),_:3},8,["position"]))}}),po=H({__name:"ControlButtons",props:{workflow:{}},setup(t){return(e,s)=>(n(),b(a(co),{position:"top-left","show-interactive":!1},{default:d(()=>[u(a(re),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:s[0]||(s[0]=o=>e.workflow.history.undo())},{default:d(()=>[u(a(Mt))]),_:1},8,["disabled"]),u(a(re),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:s[1]||(s[1]=o=>e.workflow.history.redo())},{default:d(()=>[u(a(na))]),_:1},8,["disabled"])]),_:1}))}});class go{constructor(e,s){ue(this,"dx");ue(this,"dy");this.dx=s.x-e.x,this.dy=s.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function fo(t,e,s=0){const{x:o,y:l}=e.center,{width:f,height:g}=e,w=new go(t,e.center),_=s*(w.x/w.length),i=s*(w.y/w.length),c=g/f;let v,S;if(Math.abs(w.m)>Math.abs(c)){const p=g/2*(1/w.m);v=o-(w.y>0?p:-p),S=l+(w.y>0?-g/2:g/2)}else{const p=f/2*w.m;v=o+(w.x>0?-f/2:f/2),S=l-(w.x>0?p:-p)}return{x:v+_,y:S+i}}const vo=(t,e=0,s=0)=>{const o=Math.atan2(t.ty-t.sy,t.tx-t.sx),l=e*Math.sin(o),f=e*Math.cos(o),g=s*Math.cos(o),w=s*Math.sin(o);return{sourceX:t.sx-l+g,sourceY:t.sy+f+w,targetX:t.tx-l-g,targetY:t.ty+f-w}};function Ce(t,e,s=0){const o={x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},f={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return fo(o,f,s)}function Ye(t,e){const s=Ce(t,e,-10),o=Ce(e,t,-10);return{sx:o.x,sy:o.y,tx:s.x,ty:s.y}}const yo=H({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,s)=>(n(),b(a(G),{vertical:"",gap:"small",style:q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:d(()=>[(n(!0),h(U,null,de(e.menuOptions,o=>(n(),b(a(je),{key:o.label,title:o.tooltip,placement:"right"},{default:d(()=>[u(a(Ae),{class:Ie([{"warning-button":o.warning}]),disabled:o.disabled,style:q({backgroundColor:o.disabled?"#f5f5f5":void 0}),onClick:l=>o.click(l)},{default:d(()=>[u(a(G),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:d(()=>[N(O(o.label)+" ",1),o.key?(n(),b(a(te),{key:0,keyboard:"",disabled:o.disabled},{default:d(()=>[N(O(o.key),1)]),_:2},1032,["disabled"])):D("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const ho=H({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,s=[{label:"Edit task type",key:"T",click:()=>l.value="editing"},{label:"Delete",key:"Del",click:()=>S(e.data.id)}],o=B(e.data.props.taskType||""),l=B("idle"),f=()=>{l.value!=="idle"&&(o.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:o.value}),l.value="idle")},{onEdgeClick:g,onPaneClick:w,getSelectedEdges:_}=W();g(p=>{p.edge.id===e.id&&l.value==="idle"&&(l.value="selected")}),w(()=>f());const i=M(()=>Ye(e.sourceNode,e.targetNode)),c=M(()=>Re(vo(i.value))),v=p=>{!_.value.map(m=>m.id).includes(e.data.id)||(p.key==="Enter"&&f(),(p.key==="t"||p.key==="T")&&(l.value="editing"))},{removeEdges:S}=W();return Se(()=>window.addEventListener("keydown",v)),De(()=>window.removeEventListener("keydown",v)),(p,m)=>(n(),h(U,null,[u(a(mt),{path:c.value[0],"marker-end":p.markerEnd},null,8,["path","marker-end"]),u(a(kt),null,{default:d(()=>[l.value==="idle"?(n(),h("div",{key:0,style:q({transform:`translate(-50%, -50%) translate(${c.value[1]}px,${c.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(n(),b(a(te),{key:1},{default:d(()=>[N(O(e.data.props.taskType),1)]),_:1})):(n(),b(a(Sa),{key:0,size:16}))],4)):l.value==="selected"?(n(),h("div",{key:1,style:q({transform:`translate(-50%, -120%) translate(${c.value[1]}px,${c.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[u(yo,{"is-connecting":!0,"is-editing":!0,"menu-options":s})],4)):l.value==="editing"?(n(),h("div",{key:2,style:q({transform:`translate(-50%, -50%) translate(${c.value[1]}px,${c.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[u(a(pe),{value:o.value,"onUpdate:value":m[0]||(m[0]=P=>o.value=P),placeholder:"Task type"},null,8,["value"])],4)):D("",!0)]),_:1})],64))}});const mo=ae(ho,[["__scopeId","data-v-48e71e28"]]),ko={key:0},wo=A("defs",null,[A("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[A("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),_o=["d"],bo=H({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,s=B(!0),{onNodeMouseEnter:o,onNodeMouseLeave:l}=W();o(_=>{_.node.id===e.sourceNode.id&&(s.value=!1)}),l(_=>{_.node.id===e.sourceNode.id&&(s.value=!0)});const f=M(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),g=M(()=>Ye(e.sourceNode,f.value)),w=M(()=>Re({sourceX:g.value.sx,sourceY:g.value.sy,targetX:g.value.tx,targetY:g.value.ty}));return(_,i)=>s.value?(n(),h("g",ko,[wo,A("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:w.value[0],"marker-end":"url(#arrowhead)"},null,8,_o)])):D("",!0)}}),$o=H({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const s=t,o=M(()=>{const l=zt(s.filename);return l.valid?s.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:l});return(l,f)=>(n(),b(a(nt),{open:l.creatingFileStatus==="prompting"||l.creatingFileStatus==="creating",closable:!1,"confirm-loading":l.creatingFileStatus==="creating",onOk:f[1]||(f[1]=g=>e("create-file",l.filename)),onCancel:f[2]||(f[2]=g=>e("cancel"))},{default:d(()=>[u(a(Ze),{layout:"vertical",disabled:l.creatingFileStatus=="creating"},{default:d(()=>[u(a(ve),{label:"You're creating a new file. What should it be called?","validate-status":o.value.valid?"success":"error",help:o.value.valid?o.value.help:o.value.reason},{default:d(()=>[u(a(pe),{value:l.filename,onChange:f[0]||(f[0]=g=>e("update-filename",g.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),Co={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},Ao=H({...Co,props:{nodeId:null,isVisible:{type:Boolean},position:{default:ce.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,s=Y(wt,null),{viewportRef:o,viewport:l,getSelectedNodes:f,findNode:g}=W();function w(p,m,P,C,V){let T=.5;V==="start"?T=0:V==="end"&&(T=1);let I=[(p.x+p.width*T)*m.zoom+m.x,p.y*m.zoom+m.y-C],j=[-100*T,-100];switch(P){case ce.Right:I=[(p.x+p.width)*m.zoom+m.x+C,(p.y+p.height*T)*m.zoom+m.y],j=[0,-100*T];break;case ce.Bottom:I[1]=(p.y+p.height)*m.zoom+m.y+C,j[1]=0;break;case ce.Left:I=[p.x*m.zoom+m.x-C,(p.y+p.height*T)*m.zoom+m.y],j=[-100,-100*T];break}return`translate(${I[0]}px, ${I[1]}px) translate(${j[0]}%, ${j[1]}%)`}const _=M(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||s||""]).reduce((p,m)=>{const P=g(m);return P&&p.push(P),p},[])),i=M(()=>typeof e.isVisible=="boolean"?e.isVisible:_.value.length===1&&_.value[0].selected&&f.value.length===1),c=M(()=>_t(_.value)),v=M(()=>Math.max(..._.value.map(p=>(p.computedPosition.z||1)+1))),S=M(()=>({position:"absolute",transform:w(c.value,l.value,e.position,e.offset,e.align),zIndex:v.value}));return(p,m)=>(n(),b(lt,{to:a(o),disabled:!a(o)},[a(i)&&a(_).length?(n(),h("div",he({key:0},p.$attrs,{style:a(S),class:"vue-flow__node-toolbar"}),[F(p.$slots,"default")],16)):D("",!0)],8,["to","disabled"]))}}),Io=H({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,s)=>(n(),b(a(Ao),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:a(ce).Right},{default:d(()=>[u(a(G),{vertical:"",gap:"small",style:q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:d(()=>[(n(!0),h(U,null,de(e.menuOptions,o=>(n(),b(a(je),{key:o.label,title:o.tooltip,placement:"right"},{default:d(()=>[u(a(Ae),{class:Ie([{"warning-button":o.warning}]),disabled:o.disabled,style:q({backgroundColor:o.disabled?"#f5f5f5":void 0}),onClick:l=>o.click(l)},{default:d(()=>[u(a(G),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:d(()=>[N(O(o.label)+" ",1),o.key?(n(),b(a(te),{key:0,keyboard:"",disabled:o.disabled},{default:d(()=>[N(O(o.key),1)]),_:2},1032,["disabled"])):D("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});class So{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const Fe=new So;class ye{constructor(e){this.dto=e}static async listConnections(){return(await Fe.listConnections()).map(s=>new ye(s))}static async getIsUsageMode(){return await Fe.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const Do=H({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(t,{emit:e}){var K;const s=t,o=B(!1),{result:l}=ge(async()=>ye.getIsUsageMode()),f=le.object({title:le.string(),clientStageId:le.string().uuid(),inputSchemas:le.any(),outputSchemas:le.any()});me(()=>s.stageProps.projectId,()=>{o.value=!0,T()});const g=Pt(),w=()=>{var E;const $=(E=g.cloudProject)==null?void 0:E.id;return $?`https://cloud.abstra.io/projects/${$}/agents`:""},_=le.array(f),i=B((K=s.stageProps.projectId)!=null?K:""),c=B(!1),v=$=>S.loading.value||!S.result.value?null:S.result.value.find(E=>E.agentConnection.id===$),S=ge(async()=>ye.listConnections()),p=M(()=>S.loading.value||!S.result.value?[]:S.result.value.map($=>({label:$.agentConnection.connectionName,key:$.agentConnection.id,value:$.agent.projectId}))),{result:m,loading:P,refetch:C,error:V}=ge(async()=>{const $=s.stageProps.projectId;if(!$)return[];const Z=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${$}`)).json();return _.parse(Z)}),T=Oe.exports.debounce(()=>{o.value=!1,C()},500),I=M(()=>P.value||!m.value?[]:m.value.map($=>({label:$.title,value:$.clientStageId})));function j($){e("update:stage-props",{...s.stageProps,projectId:$,clientStageId:null})}function oe($){const E=v($.key);!E||(j(E.agent.projectId),i.value=E.agent.projectId,c.value=!1)}function y($){const E=$.target;i.value=E.value,j(E.value),c.value=!0}function x($){c.value=$}function z($){const E=String($);!m.value||e("update:stage-props",{...s.stageProps,clientStageId:E})}return($,E)=>(n(),h(U,null,[u(a(ve),{label:"Project ID"},{default:d(()=>{var Z;return[a(l)?(n(),b(a(rt),{key:0,trigger:"click",visible:c.value,onVisibleChange:x},{overlay:d(()=>[u(a(it),{onClick:oe},{default:d(()=>[(n(!0),h(U,null,de(p.value,se=>(n(),b(a(He),{key:se.key},{default:d(()=>[N(O(se.label),1)]),_:2},1024))),128)),u(a(He),null,{default:d(()=>[u(a(Ne),{class:"cloud-link",href:w(),target:"_blank"},{default:d(()=>[N(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:d(()=>[u(a(pe),{value:i.value,"onUpdate:value":E[0]||(E[0]=se=>i.value=se),autofocus:"","allow-clear":"",onInput:y},null,8,["value"])]),_:1},8,["visible"])):(n(),b(a(pe),{key:1,value:(Z=$.stageProps.projectId)!=null?Z:"",placeholder:"Project ID",autofocus:"","onUpdate:value":j},null,8,["value"]))]}),_:1}),u(a(ve),{label:"Client entrypoint"},{default:d(()=>{var Z;return[o.value||a(P)?(n(),b(a(_e),{key:0,disabled:"",loading:""})):a(V)?(n(),b(a($e),{key:1,type:"error",message:"Invalid project id"})):$.stageProps.projectId?a(m).length===0?(n(),b(a($e),{key:3,type:"warning",message:"The project has no entrypoints"})):(n(),b(a(_e),{key:4,class:"entrypoint-select",options:I.value,value:(Z=$.stageProps.clientStageId)!=null?Z:void 0,"onUpdate:value":z},null,8,["options","value"])):(n(),b(a(_e),{key:2,disabled:""}))]}),_:1})],64))}});const xo=ae(Do,[["__scopeId","data-v-4c670f76"]]),Mo=H({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Te;const e=t,{useToken:s}=Ue,{token:o}=s(),l=o.value.colorText,f=[{label:"Add transition",key:"T",click:r=>ze(r)},{label:"Rename",key:"R",click:()=>R.value=!0},{label:"Go to editor",key:"Enter",click:()=>Ee()},{label:"Tasks",key:"M",click:()=>w.value=!0},{label:"Delete",key:"Del",click:()=>x(e.stage)}],g=M(()=>{let r=[...f];return _.value||r.unshift({label:"Create missing file",warning:!0,click:()=>V()}),e.controller.hasChanges()&&(r=r.map(k=>k.label==="Go to editor"?{...k,disabled:!0,tooltip:"Save it to allow editing"}:k)),(e.stage.type==="agents"||e.stage.type==="clients")&&(r=r.filter(k=>!["Create missing file","Go to editor","Tasks"].includes(k.label))),e.stage.type==="agents"&&(r=r.map(k=>k.label==="Rename"?{...k,label:"Edit"}:k)),r}),w=B(!1),_=B(e.initialFileCheck);me(()=>e.initialFileCheck,r=>{_.value=r});const i=r=>{p.value=r,S()},c=r=>{e.controller.updateStageProps(e.stage.id,r)},v=()=>{var r;m.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(p.value=(r=e.stage.props.filename)!=null?r:"",S())},S=Oe.exports.debounce(async()=>{const r=p.value;if(!r){_.value=!0;return}fe.checkFile(r).then(k=>{_.value=k.exists})},500),p=B((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Te=e.stage.props.filename)!=null?Te:""),m=B("idle"),P=async()=>{m.value="creating",await fe.initFile(p.value,e.stage.type),_.value=!0;const r=await fe.checkFile(p.value);if(_.value=r.exists,m.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:p.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:p.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},C=M(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!_.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),V=()=>{m.value="prompting"},{startConnection:T,updateConnection:I,onNodeClick:j,addEdges:oe,endConnection:y,removeNodes:x,onPaneClick:z,getSelectedNodes:K,flowToScreenCoordinate:$,onNodeMouseEnter:E,onNodeMouseLeave:Z,getNodes:se,onNodesChange:Ge,applyNodeChanges:qe}=W(),Je=dt(),J=B(!1),R=B(!1),Q=B(e.stage.title),ke=B(!1);Ge(async r=>{var L;const k=[];for(const ne of r)ne.type==="remove"?R.value||((L=e.controller)==null||L.delete([ne.id]),k.push(ne)):k.push(ne);qe(k)});const Ee=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Je.push({path:`/_editor/${r}/${e.stage.id}`})},ze=(r,k=!0)=>{T({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:k?r.pageX-180:r.pageX-90,y:k?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",Be),J.value=!0},Be=r=>{J.value&&!ke.value&&I({x:r.pageX-180,y:r.pageY-52})};j(r=>{if(r.node.id===e.stage.id&&S(),J.value&&r.node.id!==e.stage.id){const k={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:tt(),props:{taskType:null}};try{e.controller.connect([k]),document.removeEventListener("mousemove",Be),oe({id:k.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:bt.Arrow,width:24,height:24},data:k}),y(),J.value=!1}catch(L){console.error(L)}}}),E(r=>{if(J.value&&r.node.id!==e.stage.id){ke.value=!0;const k=se.value.find(ne=>ne.id===e.stage.id);if(!k)return;const L=Ce(k,r.node,-10);I($({x:L.x-180,y:L.y-52}))}}),Z(()=>{ke.value=!1});const Ve=()=>{if(!_.value){const r=Bt(Q.value+".py");p.value=r;let k={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const L=Vt(Q.value);k={...k,path:L}}e.controller.updateStageProps(e.stage.id,k)}};z(()=>{R.value=!1,e.stage.title!==Q.value&&(e.controller.updateStageTitle(e.stage.id,Q.value),Ve()),J.value=!1,y()});const Pe=r=>{if(!!K.value.map(k=>k.id).includes(e.stage.id)&&m.value==="idle"){if(r.key==="Enter")if(R.value)R.value=!1,e.controller.updateStageTitle(e.stage.id,Q.value),Ve();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;Ee()}if(!R.value){if(r.key==="t"||r.key==="T"){const k=$(e.stage.position);ze({pageX:k.x,pageY:k.y},!1)}(r.key==="r"||r.key==="R")&&(R.value=!0),(r.key==="m"||r.key==="M")&&(w.value=!0)}}};return Se(()=>{window.addEventListener("keydown",Pe)}),De(()=>{window.removeEventListener("keydown",Pe)}),(r,k)=>(n(),h(U,null,[u(Io,{"is-connecting":J.value,"is-editing":R.value,"menu-options":g.value},null,8,["is-connecting","is-editing","menu-options"]),A("div",{class:"stage",onDblclick:k[1]||(k[1]=L=>R.value=!0)},[u(a(G),{vertical:R.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:d(()=>[(n(),b(X(a(It)(r.stage.type)),{size:18,color:a(l)},null,8,["color"])),R.value?(n(),b(a(Ze),{key:1,layout:"vertical"},{default:d(()=>[u(a(ve),{label:"Title"},{default:d(()=>[u(a(pe),{value:Q.value,"onUpdate:value":k[0]||(k[0]=L=>Q.value=L),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),r.stage.type==="agents"?(n(),b(xo,{key:0,"stage-props":r.stage.props,"onUpdate:stageProps":c},null,8,["stage-props"])):D("",!0)]),_:1})):(n(),b(a(ut),{key:0,class:"title"},{default:d(()=>[N(O(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),C.value?(n(),b(a(Ht),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):D("",!0),m.value==="prompting"||m.value==="creating"?(n(),b($o,{key:1,filename:p.value,"file-exists":_.value,"creating-file-status":m.value,onCreateFile:P,onCancel:v,onUpdateFilename:i},null,8,["filename","file-exists","creating-file-status"])):D("",!0),u(a(Tt),{visible:w.value,"onUpdate:visible":k[2]||(k[2]=L=>w.value=L),title:"Tasks",width:"500",onClose:k[3]||(k[3]=L=>w.value=!1)},{default:d(()=>[u(Et,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const ie=ae(Mo,[["__scopeId","data-v-2beac249"]]),We=t=>(ct("data-v-f4278104"),t=t(),pt(),t),Eo={class:"empty-hint"},zo={key:0,class:"drag-hint"},Bo=We(()=>A("div",{class:"title"},"Start here",-1)),Vo={key:1,class:"drop-hint"},Po=We(()=>A("div",{class:"title"},"Drop here",-1)),To={key:2,class:"stages-hint"},Ho={class:"header"},Lo={class:"title"},Fo={class:"description"},No=H({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,s)=>(n(),h("div",Eo,[e.showDragHint?(n(),h("div",zo,[Bo,u(a(Le),{size:32,class:"arrow"})])):D("",!0),e.showDragHint?D("",!0):(n(),h("div",Vo,[Po,u(a(Le),{size:32,class:"arrow"})])),e.showDragHint?(n(),h("div",To,[(n(!0),h(U,null,de(a(xe).stages,o=>(n(),h("div",{key:o.key,class:"stage-hint"},[A("div",Ho,[(n(),b(X(o.icon))),A("span",Lo,O(o.title),1)]),A("div",Fo,O(o.description),1)]))),128))])):D("",!0)]))}});const jo=ae(No,[["__scopeId","data-v-f4278104"]]),Zo=H({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;gt(i=>({ecafe25e:a(g),"3094d9cc":a(f)}));const s=Xe(),{useToken:o}=Ue,{token:l}=o(),f=l.value.colorPrimaryBorder,g=l.value.colorBgElevated,{onInit:w}=W();w(i=>{i.fitView()});const _=i=>{var c;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:i&&(c=e.initialFileCheckStatus[i])!=null?c:!1};return(i,c)=>i.workflow?(n(),b(a($t),{key:0,nodes:i.workflow.vueFlowNodes.value,edges:i.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":i.editable,"pan-on-scroll":a(Me).isMac,"elements-selectable":i.editable,"snap-to-grid":"","apply-default":!1,onDragover:a(s).onDragOver,onDragleave:a(s).onDragLeave},{"connection-line":d(v=>[u(bo,ft(vt(v)),null,16)]),"edge-task":d(v=>[u(mo,he(v,{controller:i.workflow}),null,16,["controller"])]),"node-forms":d(v=>[u(ie,{stage:v.data,node:v,controller:i.workflow,"initial-file-check":_(v.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":d(v=>[u(ie,{stage:v.data,node:v,controller:i.workflow,"initial-file-check":_(v.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":d(v=>[u(ie,{stage:v.data,node:v,controller:i.workflow,"initial-file-check":_(v.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":d(v=>[u(ie,{stage:v.data,node:v,controller:i.workflow,"initial-file-check":_(v.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":d(v=>[u(ie,{stage:v.data,node:v,controller:i.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":d(v=>[u(ie,{stage:v.data,node:v,controller:i.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:d(()=>[u(a(Dt)),i.editable&&!i.workflow.vueFlowNodes.value.length?(n(),b(jo,{key:0,"show-drag-hint":i.showDragHint},null,8,["show-drag-hint"])):D("",!0),u(a(xt),{pannable:"",zoomable:""}),i.editable?(n(),b(po,{key:1,workflow:i.workflow},null,8,["workflow"])):D("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):D("",!0)}});const Oo=ae(Zo,[["__scopeId","data-v-d709f269"]]),Ro=H({__name:"WorkflowEditor",setup(t){const{init:e,tearDown:s,onDragStart:o,onDrop:l,isDragging:f,isAdding:g,draggedType:w,mousePosition:_}=Xe(),{result:i}=ge(async()=>await at.init(ot,!0)),c=B(null),v=async()=>{if(!i.value)return;const y=i.value.vueFlowNodes.value.map(x=>{var z,K,$,E,Z;return((z=x.data)==null?void 0:z.type)==="forms"||((K=x.data)==null?void 0:K.type)==="hooks"||(($=x.data)==null?void 0:$.type)==="scripts"||((E=x.data)==null?void 0:E.type)==="jobs"?(Z=x.data)==null?void 0:Z.props.filename:null});c.value=await fe.checkFiles(y.filter(x=>typeof x=="string"))};me(()=>i.value,()=>{i.value&&(e(i.value),v())});const{onNodeDragStop:S,onEdgesChange:p,getSelectedElements:m,getNodes:P,addSelectedNodes:C,zoomIn:V,fitView:T,zoomOut:I,applyEdgeChanges:j}=W();S(y=>{var x;(x=i.value)==null||x.move(y.nodes.map(z=>({id:z.id,position:z.position})))}),p(y=>{var x;for(const z of y)z.type==="remove"&&((x=i.value)==null||x.delete([z.id]));j(y)});const oe=y=>{var x,z;!i.value||((y.key==="z"||y.key==="Z")&&ee(y)&&(Ke(y)?i.value.history.redo():(x=i.value)==null||x.history.undo(),y.preventDefault()),ee(y)&&(y.key==="s"||y.key==="S")&&((z=i.value)==null||z.save(),y.preventDefault()),!m.value.length&&(y.key==="f"||y.key==="F"?o(null,"forms"):y.key==="h"||y.key==="H"?o(null,"hooks"):y.key==="j"||y.key==="J"?o(null,"jobs"):y.key==="o"||y.key==="O"?o(null,"scripts"):(y.key==="a"||y.key==="A")&&ee(y)?(C(P.value),y.preventDefault()):y.key==="0"&&ee(y)?(T(),y.preventDefault()):(y.key==="="||y.key==="+")&&ee(y)?(y.preventDefault(),V()):y.key==="-"&&ee(y)&&(y.preventDefault(),I())))};return Se(()=>{window.addEventListener("keydown",oe)}),De(()=>{window.removeEventListener("keydown",oe),s()}),(y,x)=>a(i)?(n(),h("div",{key:0,class:Ie(["workflow-container",{dragging:a(g)}]),onDrop:x[0]||(x[0]=(...z)=>a(l)&&a(l)(...z))},[u(Oo,{workflow:a(i),editable:"","show-drag-hint":!a(g),"check-file-status":!0,"initial-file-check-status":c.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),u(Ba,{controller:a(i),onDragStart:a(o)},null,8,["controller","onDragStart"]),(n(!0),h(U,null,de(a(xe).stages,z=>{var K,$;return n(),h("div",{key:z.key},[a(g)&&!a(f)&&z.typeName===a(w)?(n(),h("div",{key:0,class:"dragging-node",style:q({left:`${(K=a(_))==null?void 0:K.x}px`,top:`${($=a(_))==null?void 0:$.y}px`,position:"absolute",cursor:a(g)?"grabbing":"grab"})},[(n(),b(X(z.icon),{size:18}))],4)):D("",!0)])}),128))],34)):D("",!0)}});const zs=ae(Ro,[["__scopeId","data-v-5f802ac0"]]);export{zs as default};
//# sourceMappingURL=WorkflowEditor.9b642d96.js.map

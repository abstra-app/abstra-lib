import{d as x,G as k,a as se,b as p,c as f,w as t,f as a,u as e,az as u,eC as U,by as ge,bw as Z,ex as we,bV as be,ew as C,t as G,e as h,eD as Y,eE as K,eu as M,as as ke,b9 as z,ar as V,eK as H,H as Se,r as W,bQ as ee,bX as L,ad as Ce,eB as oe,cF as Fe,b6 as q,eL as Ie,ez as Te,c9 as xe}from"./outputWidgets.e350d8e4.js";import{F as N}from"./forms.18b318ed.js";import{H as $}from"./hooks.1b399665.js";import{S as E,J as D}from"./scripts.efa04b3e.js";import{W as le}from"./workspaces.d55c46a0.js";import{a as P}from"./asyncComputed.11f5ac08.js";import{a as te}from"./ant-design.7e214e2a.js";import{f as ne,h as ie,s as re,j as ce,b as Ne,d as $e}from"./icons.2c394e63.js";import{A as I}from"./index.4fdbc10f.js";import"./index.c5060daf.js";import{a as F}from"./Text.1223a40d.js";import{C as pe}from"./Card.b70ed900.js";import"./index.5f655278.js";import{a as Ae,M as Ue}from"./Title.f9a2b403.js";import{n as Me}from"./string.8a339053.js";import{A as O,F as ue}from"./Form.b043e834.js";import{A as Ee}from"./index.310b827e.js";import"./record.8c9e165d.js";import"./pubsub.dd4743a2.js";import"./url.958bb521.js";import"./index.7f484079.js";import"./index.e89916aa.js";import"./TabPane.2086b8e4.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[n]="6630a92e-716e-4618-834e-d25e2ef55225",l._sentryDebugIdIdentifier="sentry-dbid-6630a92e-716e-4618-834e-d25e2ef55225")}catch{}})();const De=x({__name:"ScriptCard",props:{script:{},workspace:{}},emits:["delete","go-to-script"],setup(l,{emit:n}){const s=l,d=async()=>{if(await te("Are you sure you want to delete this script?")){const r=await te("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});n("delete",s.script.id,r)}},v=()=>{s.script instanceof N&&n("go-to-script",s.script.id,"form"),s.script instanceof $&&n("go-to-script",s.script.id,"hook"),s.script instanceof E&&n("go-to-script",s.script.id,"script"),s.script instanceof D&&n("go-to-script",s.script.id,"job")},g=k(()=>{if(s.script instanceof N)return ne;if(s.script instanceof $)return ie;if(s.script instanceof E)return re;if(s.script instanceof D)return ce;throw new Error("Invalid script type")}),_=()=>{!s.script.file||!s.workspace||s.workspace.openFile(s.script.file)};return(r,m)=>{const w=se("icon");return p(),f(e(pe),{key:r.script.title,class:"script-card",onClick:v},{title:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(w,{path:g.value},null,8,["path"]),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[u(U(r.script.title),1)]),_:1})]),_:1})]),extra:t(()=>[a(e(be),{trigger:["click"],onClick:m[0]||(m[0]=we(()=>{},["stop"]))},{overlay:t(()=>[a(e(ge),null,{default:t(()=>[a(e(Z),{onClick:_},{default:t(()=>[u("Open .py file")]),_:1}),a(e(Z),{danger:"",onClick:d},{default:t(()=>[u("Delete")]),_:1})]),_:1})]),default:t(()=>[a(w,{path:e(Ne),style:{cursor:"pointer"}},null,8,["path"])]),_:1})]),default:t(()=>[r.script instanceof e(N)||r.script instanceof e($)?(p(),f(e(I),{key:0,gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[u("URL path:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[u("/"+U(r.script.path),1)]),_:1})]),_:1})):C("",!0),a(e(I),{gap:"12"},{default:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[u("Code:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"125px"}},{default:t(()=>[u(U(r.script.file),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const je=G(De,[["__scopeId","data-v-f082da55"]]),Be=l=>(Y("data-v-e7ad5242"),l=l(),K(),l),ze={class:"card-content"},Ve=Be(()=>h("span",null,"New script",-1)),He=x({__name:"NewScriptCard",setup(l){return(n,s)=>{const d=se("icon");return p(),f(e(pe),{class:"new-script-card"},{default:t(()=>[h("div",ze,[a(d,{path:e($e)},null,8,["path"]),Ve])]),_:1})}}});const Oe=G(He,[["__scopeId","data-v-e7ad5242"]]),R=l=>(Y("data-v-f04c0fce"),l=l(),K(),l),Pe={key:0,class:"choose-type"},Ge={class:"option-content"},Re=R(()=>h("span",null,"Forms",-1)),Je={class:"option-content"},Le=R(()=>h("span",null,"Hooks",-1)),We={class:"option-content"},qe=R(()=>h("span",null,"Scripts",-1)),Ye={class:"option-content"},Ke=R(()=>h("span",null,"Jobs",-1)),Qe=x({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(l,{emit:n}){const s=l,d=k(()=>s.state.type==="form"?"#fff":void 0),v=k(()=>s.state.type==="hook"?"#fff":void 0),g=k(()=>s.state.type==="script"?"#fff":void 0),_=k(()=>s.state.type==="job"?"#fff":void 0),r=m=>n("choose-type",m);return(m,w)=>m.state.state==="choosing-type"?(p(),M("div",Pe,[a(e(I),{vertical:"",gap:"30"},{default:t(()=>[a(e(Ae),null,{default:t(()=>[u("Choose your script type")]),_:1}),a(e(ke),{value:m.state.type,"onUpdate:value":[w[0]||(w[0]=o=>m.state.type=o),r],size:"large","button-style":"solid"},{default:t(()=>[a(e(I),{gap:"24",vertical:""},{default:t(()=>[a(e(I),{gap:"24"},{default:t(()=>[a(e(z),{placement:"left"},{title:t(()=>[u(" Use to collect user input via interaction with a form interface ")]),default:t(()=>[a(e(V),{value:"form",class:"option"},{default:t(()=>[h("div",Ge,[(p(),f(H,{key:d.value,path:e(ne),fill:d.value},null,8,["path","fill"])),Re])]),_:1})]),_:1}),a(e(z),{placement:"right"},{title:t(()=>[u("Use to build endpoints triggered by HTTP requests")]),default:t(()=>[a(e(V),{value:"hook",class:"option"},{default:t(()=>[h("div",Je,[(p(),f(H,{key:v.value,path:e(ie),fill:v.value},null,8,["path","fill"])),Le])]),_:1})]),_:1})]),_:1}),a(e(I),{gap:"24"},{default:t(()=>[a(e(z),{placement:"left"},{title:t(()=>[u("Use to write plain Python scripts")]),default:t(()=>[a(e(V),{value:"script",class:"option"},{default:t(()=>[h("div",We,[(p(),f(H,{key:g.value,path:e(re),fill:g.value},null,8,["path","fill"])),qe])]),_:1})]),_:1}),a(e(z),{placement:"right"},{title:t(()=>[u("Use to schedule your script execution periodically")]),default:t(()=>[a(e(V),{value:"job",class:"option"},{default:t(()=>[h("div",Ye,[(p(),f(H,{key:_.value,path:e(ce),fill:_.value},null,8,["path","fill"])),Ke])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):C("",!0)}});const Xe=G(Qe,[["__scopeId","data-v-f04c0fce"]]);function Q(l){return l.replace(/\.py$/,"").trim().length===0?{valid:!1,reason:"File name cannot be empty"}:l.length>255?{valid:!1,reason:"File name cannot be longer than 255 characters"}:l.includes("/")?{valid:!1,reason:"File name cannot contain slashes"}:l.endsWith(".py")?{valid:!0}:{valid:!1,reason:"File name must end with .py"}}function Ze(l){if(!Q(l).valid)throw new Error("Invalid filename");const n=l.slice(0,-3);return Me(n,!0,!0)+".py"}const et=h("br",null,null,-1),tt=x({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(l,{emit:n}){const s=l,{result:d}=P(()=>fetch("/_editor/api/workspace/root").then(S=>S.text()));Se(()=>s.state.stage.filename,()=>r.value=s.state.stage.filename);const v=k(()=>s.state.state!=="creating"?"":`${d.value}/${r.value}`),g=k(()=>s.state.state!=="creating"?"":`${s.state.stage.type[0].toUpperCase()+s.state.stage.type.slice(1)} title`),_=S=>n("update-name",S),r=W(s.state.stage.filename),{result:m,refetch:w}=P(()=>le.checkFile(r.value)),o=()=>{c.value.valid?n("update-file",Ze(r.value)):n("update-file",r.value),w()},c=k(()=>Q(r.value));return(S,A)=>(p(),f(e(ue),{layout:"vertical"},{default:t(()=>{var j;return[a(e(O),{label:g.value,required:!0},{default:t(()=>[a(e(ee),{value:S.state.stage.title,"onUpdate:value":_},null,8,["value"])]),_:1},8,["label"]),a(e(O),{label:"Generated file",required:!0,"validate-status":c.value.valid?"success":"error",help:c.value.valid?void 0:c.value.reason},{default:t(()=>[a(e(ee),{value:r.value,"onUpdate:value":A[0]||(A[0]=J=>r.value=J),onBlur:o},null,8,["value"])]),_:1},8,["validate-status","help"]),a(e(O),null,{default:t(()=>[a(e(F),null,{default:t(()=>[u(" Your script will be generated at: ")]),_:1}),et,a(e(F),{code:""},{default:t(()=>[u(U(v.value),1)]),_:1})]),_:1}),(j=e(m))!=null&&j.exists?(p(),f(e(Ee),{key:0,type:"warning"},{message:t(()=>[a(e(F),null,{default:t(()=>[a(e(F),{strong:""},{default:t(()=>[u("Warning:")]),_:1}),u(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):C("",!0)]}),_:1}))}}),at=x({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(l,{emit:n}){const s=l,d=c=>n("update-name",c),v=c=>n("update-file",c),g=()=>n("close"),_=c=>n("choose-type",c),r=()=>n("next-step"),m=()=>n("previous-step"),w=()=>n("create-script"),o=k(()=>!(s.state.state!=="creating"||!Q(s.state.stage.filename).valid||!s.state.stage.title));return(c,S)=>(p(),f(e(Ue),{open:c.open,title:"Create a new script",onCancel:g},{footer:t(()=>[c.state.state==="creating"?(p(),f(e(L),{key:0,onClick:m},{default:t(()=>[u("Previous")]),_:1})):C("",!0),c.state.state==="creating"?(p(),f(e(L),{key:1,type:"primary",disabled:!o.value,onClick:w},{default:t(()=>[u(" Create ")]),_:1},8,["disabled"])):C("",!0),c.state.state==="choosing-type"?(p(),f(e(L),{key:2,type:"primary",disabled:!c.state.type,onClick:r},{default:t(()=>[u(" Next ")]),_:1},8,["disabled"])):C("",!0)]),default:t(()=>[c.state.state==="choosing-type"?(p(),f(Xe,{key:0,state:c.state,onChooseType:_},null,8,["state"])):C("",!0),c.state.state==="creating"?(p(),f(tt,{key:1,state:c.state,onUpdateName:d,onUpdateFile:v},null,8,["state"])):C("",!0)]),_:1},8,["open"]))}}),st=x({__name:"FilterScripts",emits:["update-filter"],setup(l,{emit:n}){const s=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],d=v=>n("update-filter",v);return(v,g)=>(p(),f(e(ue),null,{default:t(()=>[a(e(O),{label:"Script type"},{default:t(()=>[a(e(Ce),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":d},{default:t(()=>[(p(),M(q,null,oe(s,_=>a(e(Fe),{key:_.value,value:_.value},{default:t(()=>[u(U(_.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),ot=l=>(Y("data-v-cdca4f3f"),l=l(),K(),l),lt={key:0},nt=ot(()=>h("span",null,"loading",-1)),it=[nt],ae=100,rt=x({__name:"Scripts",setup(l){Ie(i=>({"582f9454":me()}));const n=Te(),{loading:s,result:d,refetch:v}=P(async()=>Promise.all([N.list(),$.list(),D.list(),E.list()]).then(([i,b,y,T])=>[...i,...b,...y,...T])),g=i=>{if(i instanceof N)return"form";if(i instanceof $)return"hook";if(i instanceof D)return"job";if(i instanceof E)return"script";throw new Error("Invalid script type")},{result:_}=P(()=>le.get()),r=W([]),m=i=>{r.value=i},w=k(()=>d.value?r.value.length===0?d.value:d.value.filter(i=>r.value.includes(g(i))):[]),o=W({state:"idle"}),c=k(()=>o.value.state==="choosing-type"||o.value.state==="creating"),S=()=>{o.value={state:"choosing-type",type:null}},A=()=>{o.value={state:"idle"}},j=i=>{o.value.state==="choosing-type"&&(o.value={state:"choosing-type",type:i})},J=()=>{o.value.state==="choosing-type"&&o.value.type!==null&&(o.value={state:"creating",stage:{type:o.value.type,title:`Untitled ${o.value.type}`,filename:`untitled_${o.value.type}.py`}})},de=()=>{o.value.state==="creating"&&(o.value={state:"choosing-type",type:o.value.stage.type})},fe=i=>{o.value.state==="creating"&&(o.value.stage.title=i)},_e=i=>{o.value.state==="creating"&&(o.value.stage.filename=i)},ve=async(i,b)=>{var y,T;await((T=(y=d.value)==null?void 0:y.find(B=>B.id===i))==null?void 0:T.delete(b)),await v()},me=()=>(ae/1e3).toString()+"s",ye=async()=>{if(o.value.state!=="creating")return;let i;if(o.value.stage.type==="form"?i=await N.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="hook"?i=await $.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="job"?i=await D.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="script"&&(i=await E.create(o.value.stage.title,o.value.stage.filename)),!i)throw new Error("Failed to create script");const b=i.id,y=o.value.stage.type;A(),await v(),setTimeout(()=>{X(b,y)},ae)},X=(i,b)=>{var y,T;if(b==="form"&&n.push({name:"formEditor",params:{id:i}}),b==="hook"&&n.push({name:"hookEditor",params:{id:i}}),b==="script"){const B=(y=d.value)==null?void 0:y.find(he=>he.id===i);if(!B)return;(T=_.value)==null||T.openFile(B.file)}b==="job"&&n.push({name:"jobEditor",params:{id:i}})};return(i,b)=>(p(),M(q,null,[e(s)?(p(),M("span",lt,it)):C("",!0),a(st,{onUpdateFilter:m}),a(e(I),{wrap:"wrap",gap:"large",class:"scripts-container"},{default:t(()=>[a(xe,null,{default:t(()=>[(p(!0),M(q,null,oe(w.value,y=>(p(),f(je,{key:y.title,script:y,workspace:e(_),onDelete:ve,onGoToScript:X},null,8,["script","workspace"]))),128))]),_:1}),a(Oe,{onClick:S})]),_:1}),a(at,{open:c.value,state:o.value,onClose:A,onChooseType:j,onNextStep:J,onPreviousStep:de,onCreateScript:ye,onUpdateName:fe,onUpdateFile:_e},null,8,["open","state"])],64))}});const Ut=G(rt,[["__scopeId","data-v-cdca4f3f"]]);export{Ut as default};
//# sourceMappingURL=Scripts.c58514ac.js.map

var ks=Object.defineProperty;var $s=(e,t,s)=>t in e?ks(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var ce=(e,t,s)=>($s(e,typeof t!="symbol"?t+"":t,s),s);import{r as Ns}from"./index.82e1a6b3.js";import{T as Cs,B as xs,a as $t}from"./BackButton.1811d14c.js";import{p as Ms,i as Ws,z as Ye,A as et,B as Bs,k as Zt,C as Gs}from"./icons.97625e56.js";import{d as Q,b,c as L,x as S,V as Ne,W as Jt,e as $,O as pt,Q as ht,q,p as J,r as G,K as F,R as he,aa as ft,N as H,z as g,F as De,L as Te,A as ke,D as j,v as vt,U as gt,a as Ce,a2 as Fs,G as ve,t as fe,X as mt,o as Qt,ag as Hs,E as Us,ah as zs,ai as Ks,w as ye,S as qt,aj as Vs,H as js,J as Zs}from"./registerWidgets.bb4c7eff.js";import{i as Js,w as Ee,l as rt,v as Qs,r as Xt,a as Yt,s as be,p as qs,b as re,c as P,d as Le,e as Xs,f as A,D as Ys,g as Nt,C as eo,h as Ct,j as to,k as xt,m as tt,n as Mt}from"./DashPlayer.21334f89.js";import{R as so,S as oo,_ as ao}from"./UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.63f69ce1.js";import{L as ro}from"./CircularLoading.8dab92fc.js";import{i as U,g as B,a as Be,b as de,f as we,w as ne,c as yt,e as no,h as io,s as lo,j as co,k as uo}from"./runnerData.891fce22.js";import{u as Ue}from"./log.6e68571d.js";import{a as Wt}from"./asyncComputed.0adffaf6.js";import{D as po}from"./dashes.922bdf25.js";import{W as ho}from"./workspaces.4c177a35.js";import{S as fo}from"./SaveButton.4505bcbe.js";import"./passwordlessManager.a806df6a.js";import"./WidgetsFrame.2804aa92.js";import"./Modal.bf534f7d.js";import"./Passwordless.7dbc83c1.js";import"./forms.91463966.js";import"./utils.95f0e9e8.js";import"./pubsub.a0411919.js";import"./hooks.911e43af.js";import"./jobs.cb7d0efd.js";import"./login.29b4c1f1.js";import"./sentry.2692e5c6.js";const vo=e=>(pt("data-v-e0f3144d"),e=e(),ht(),e),go={class:"dash-settings"},mo={class:"dash-property"},yo=vo(()=>S("label",{class:"property-label"},"Name",-1)),wo=Q({__name:"DashSettings",props:{dash:null},setup(e){return(t,s)=>(b(),L("div",go,[S("div",mo,[yo,Ne(S("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.dash.title=o),class:"property-input",placeholder:"Enter a name"},null,512),[[Jt,e.dash.title]])]),$(so,{runtime:e.dash},null,8,["runtime"])]))}});const _o=q(wo,[["__scopeId","data-v-e0f3144d"]]);class wt{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const So=e=>wt.isMac&&e.ctrlKey,Re=e=>wt.isMac?e.metaKey:e.ctrlKey,nt=e=>e.altKey,ue=e=>e.shiftKey,st={alt:nt,"arrow-up":e=>e.code==="ArrowUp","arrow-down":e=>e.code==="ArrowDown","arrow-left":e=>e.code==="ArrowLeft","arrow-right":e=>e.code==="ArrowRight",ctrl:Re,delete:e=>wt.isMac?e.code==="Backspace":e.code==="Delete",enter:e=>e.code==="Enter",escape:e=>e.code==="Escape",shift:ue,space:e=>e.code==="Space",a:e=>e.code==="KeyA",b:e=>e.code==="KeyB",c:e=>e.code==="KeyC",d:e=>e.code==="KeyD",f:e=>e.code==="KeyF",g:e=>e.code==="KeyG",h:e=>e.code==="KeyH",k:e=>e.code==="KeyK",p:e=>e.code==="KeyP",v:e=>e.code==="KeyV",x:e=>e.code==="KeyX",z:e=>e.code==="KeyZ",0:e=>e.code==="Digit0","[":e=>e.code==="BracketLeft","]":e=>e.code==="BracketRight"};class Eo{constructor(t){ce(this,"pressedKeys");ce(this,"evt");this.evt=t,this.pressedKeys={};const s=o=>a=>{Object.keys(st).forEach(n=>{st[n](a)&&this.setPressed(n,o)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(t,s){this.pressedKeys[t]=s}isPressed(t){var s;return this.evt?st[t](this.evt):(s=this.pressedKeys[t])!=null?s:!1}}const bo=new Eo;/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Po=globalThis&&globalThis.__extends||function(){var e=function(t,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var n in a)a.hasOwnProperty(n)&&(o[n]=a[n])},e(t,s)};return function(t,s){e(t,s);function o(){this.constructor=t}t.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}(),Io=Object.prototype.hasOwnProperty;function it(e,t){return Io.call(e,t)}function lt(e){if(Array.isArray(e)){for(var t=new Array(e.length),s=0;s<t.length;s++)t[s]=""+s;return t}if(Object.keys)return Object.keys(e);var o=[];for(var a in e)it(e,a)&&o.push(a);return o}function z(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ct(e){for(var t=0,s=e.length,o;t<s;){if(o=e.charCodeAt(t),o>=48&&o<=57){t++;continue}return!1}return!0}function pe(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function es(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function ut(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,s=e.length;t<s;t++)if(ut(e[t]))return!0}else if(typeof e=="object"){for(var o=lt(e),a=o.length,n=0;n<a;n++)if(ut(e[o[n]]))return!0}}return!1}function Bt(e,t){var s=[e];for(var o in t){var a=typeof t[o]=="object"?JSON.stringify(t[o],null,2):t[o];typeof a<"u"&&s.push(o+": "+a)}return s.join(`
`)}var ts=function(e){Po(t,e);function t(s,o,a,n,i){var c=this.constructor,h=e.call(this,Bt(s,{name:o,index:a,operation:n,tree:i}))||this;return h.name=o,h.index=a,h.operation=n,h.tree=i,Object.setPrototypeOf(h,c.prototype),h.message=Bt(s,{name:o,index:a,operation:n,tree:i}),h}return t}(Error),C=ts,Oo=z,_e={add:function(e,t,s){return e[t]=this.value,{newDocument:s}},remove:function(e,t,s){var o=e[t];return delete e[t],{newDocument:s,removed:o}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:function(e,t,s){var o=Ge(s,this.path);o&&(o=z(o));var a=ge(s,{op:"remove",path:this.from}).removed;return ge(s,{op:"add",path:this.path,value:a}),{newDocument:s,removed:o}},copy:function(e,t,s){var o=Ge(s,this.from);return ge(s,{op:"add",path:this.path,value:z(o)}),{newDocument:s}},test:function(e,t,s){return{newDocument:s,test:$e(e[t],this.value)}},_get:function(e,t,s){return this.value=e[t],{newDocument:s}}},Ao={add:function(e,t,s){return ct(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:s,index:t}},remove:function(e,t,s){var o=e.splice(t,1);return{newDocument:s,removed:o[0]}},replace:function(e,t,s){var o=e[t];return e[t]=this.value,{newDocument:s,removed:o}},move:_e.move,copy:_e.copy,test:_e.test,_get:_e._get};function Ge(e,t){if(t=="")return e;var s={op:"_get",path:t};return ge(e,s),s.value}function ge(e,t,s,o,a,n){if(s===void 0&&(s=!1),o===void 0&&(o=!0),a===void 0&&(a=!0),n===void 0&&(n=0),s&&(typeof s=="function"?s(t,0,e,t.path):Fe(t,0)),t.path===""){var i={newDocument:e};if(t.op==="add")return i.newDocument=t.value,i;if(t.op==="replace")return i.newDocument=t.value,i.removed=e,i;if(t.op==="move"||t.op==="copy")return i.newDocument=Ge(e,t.from),t.op==="move"&&(i.removed=e),i;if(t.op==="test"){if(i.test=$e(e,t.value),i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument=e,i}else{if(t.op==="remove")return i.removed=e,i.newDocument=null,i;if(t.op==="_get")return t.value=e,i;if(s)throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e);return i}}else{o||(e=z(e));var c=t.path||"",h=c.split("/"),l=e,v=1,f=h.length,p=void 0,u=void 0,w=void 0;for(typeof s=="function"?w=s:w=Fe;;){if(u=h[v],u&&u.indexOf("~")!=-1&&(u=es(u)),a&&(u=="__proto__"||u=="prototype"&&v>0&&h[v-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(s&&p===void 0&&(l[u]===void 0?p=h.slice(0,v).join("/"):v==f-1&&(p=t.path),p!==void 0&&w(t,0,e,p)),v++,Array.isArray(l)){if(u==="-")u=l.length;else{if(s&&!ct(u))throw new C("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);ct(u)&&(u=~~u)}if(v>=f){if(s&&t.op==="add"&&u>l.length)throw new C("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);var i=Ao[t.op].call(t,l,u,e);if(i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}}else if(v>=f){var i=_e[t.op].call(t,l,u,e);if(i.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}if(l=l[u],s&&v<f&&(!l||typeof l!="object"))throw new C("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function x(e,t,s,o,a){if(o===void 0&&(o=!0),a===void 0&&(a=!0),s&&!Array.isArray(t))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=z(e));for(var n=new Array(t.length),i=0,c=t.length;i<c;i++)n[i]=ge(e,t[i],s,!0,a,i),e=n[i].newDocument;return n.newDocument=e,n}function Lo(e,t,s){var o=ge(e,t);if(o.test===!1)throw new C("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument}function Fe(e,t,s,o){if(typeof e!="object"||e===null||Array.isArray(e))throw new C("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,s);if(_e[e.op]){if(typeof e.path!="string")throw new C("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,s);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new C('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,s);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new C("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,s);if((e.op==="add"||e.op==="replace"||e.op==="test")&&ut(e.value))throw new C("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,s);if(s){if(e.op=="add"){var a=e.path.split("/").length,n=o.split("/").length;if(a!==n+1&&a!==n)throw new C("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,s)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==o)throw new C("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,s)}else if(e.op==="move"||e.op==="copy"){var i={op:"_get",path:e.from,value:void 0},c=ss([i],s);if(c&&c.name==="OPERATION_PATH_UNRESOLVABLE")throw new C("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,s)}}}else throw new C("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,s)}function ss(e,t,s){try{if(!Array.isArray(e))throw new C("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)x(z(t),z(e),s||!0);else{s=s||Fe;for(var o=0;o<e.length;o++)s(e[o],o,t,void 0)}}catch(a){if(a instanceof C)return a;throw a}}function $e(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var s=Array.isArray(e),o=Array.isArray(t),a,n,i;if(s&&o){if(n=e.length,n!=t.length)return!1;for(a=n;a--!==0;)if(!$e(e[a],t[a]))return!1;return!0}if(s!=o)return!1;var c=Object.keys(e);if(n=c.length,n!==Object.keys(t).length)return!1;for(a=n;a--!==0;)if(!t.hasOwnProperty(c[a]))return!1;for(a=n;a--!==0;)if(i=c[a],!$e(e[i],t[i]))return!1;return!0}return e!==e&&t!==t}const Ro=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:C,deepClone:Oo,getValueByPointer:Ge,applyOperation:ge,applyPatch:x,applyReducer:Lo,validator:Fe,validate:ss,_areEquals:$e},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var _t=new WeakMap,Do=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),To=function(){function e(t,s){this.callback=t,this.observer=s}return e}();function ko(e){return _t.get(e)}function $o(e,t){return e.observers.get(t)}function No(e,t){e.observers.delete(t.callback)}function Co(e,t){t.unobserve()}function xo(e,t){var s=[],o,a=ko(e);if(!a)a=new Do(e),_t.set(e,a);else{var n=$o(a,t);o=n&&n.observer}if(o)return o;if(o={},a.value=z(e),t){o.callback=t,o.next=null;var i=function(){dt(o)},c=function(){clearTimeout(o.next),o.next=setTimeout(i)};typeof window<"u"&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return o.patches=s,o.object=e,o.unobserve=function(){dt(o),clearTimeout(o.next),No(a,o),typeof window<"u"&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new To(t,o)),o}function dt(e,t){t===void 0&&(t=!1);var s=_t.get(e.object);St(s.value,e.object,e.patches,"",t),e.patches.length&&x(s.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function St(e,t,s,o,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var n=lt(t),i=lt(e),c=!1,h=i.length-1;h>=0;h--){var l=i[h],v=e[l];if(it(t,l)&&!(t[l]===void 0&&v!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof v=="object"&&v!=null&&typeof f=="object"&&f!=null&&Array.isArray(v)===Array.isArray(f)?St(v,f,s,o+"/"+pe(l),a):v!==f&&(a&&s.push({op:"test",path:o+"/"+pe(l),value:z(v)}),s.push({op:"replace",path:o+"/"+pe(l),value:z(f)}))}else Array.isArray(e)===Array.isArray(t)?(a&&s.push({op:"test",path:o+"/"+pe(l),value:z(v)}),s.push({op:"remove",path:o+"/"+pe(l)}),c=!0):(a&&s.push({op:"test",path:o,value:e}),s.push({op:"replace",path:o,value:t}))}if(!(!c&&n.length==i.length))for(var h=0;h<n.length;h++){var l=n[h];!it(e,l)&&t[l]!==void 0&&s.push({op:"add",path:o+"/"+pe(l),value:z(t[l])})}}}function Mo(e,t,s){s===void 0&&(s=!1);var o=[];return St(e,t,o,"",s),o}const Wo=Object.freeze(Object.defineProperty({__proto__:null,unobserve:Co,observe:xo,generate:dt,compare:Mo},Symbol.toStringTag,{value:"Module"}));Object.assign({},Ro,Wo,{JsonPatchError:ts,deepClone:z,escapePathComponent:pe,unescapePathComponent:es});function Et(e,t,s){const{selectedWidgets:o,grid:a}=e,n=[...o,...s||[]],i=Math.min(...n.map(f=>{var p,u;return(u=(p=de(f,t))==null?void 0:p.colStart)!=null?u:null}).filter(f=>f!==null)),c=Math.max(...n.map(f=>{var p,u;return(u=(p=de(f,t))==null?void 0:p.colEnd)!=null?u:null}).filter(f=>f!==null)),h=Math.min(...n.map(f=>{var p,u;return(u=(p=de(f,t))==null?void 0:p.rowStart)!=null?u:null}).filter(f=>f!==null)),l=c>a.columns-1?a.columns-1-c:i<0?-i:0,v=h<0?-h:0;return n.flatMap(f=>{const p=de(f,t);if(l===0&&v===0)return[];if(!p||!U(p))return[];const u=te(ee(f,B(t)),t);return[{op:"replace",path:`${u}/${f}/colStart`,backup:p,value:p.colStart+l},{op:"replace",path:`${u}/${f}/colEnd`,backup:p,value:p.colEnd+l},{op:"replace",path:`${u}/${f}/rowStart`,backup:p,value:p.rowStart+v},{op:"replace",path:`${u}/${f}/rowEnd`,backup:p,value:p.rowEnd+v}]})}const ee=(e,t,s=null)=>{for(const o in t){const a=t[o];if(U(a)){if(o==e)return s}else{const n=ee(e,a.slot,o);if(n)return n}}return null},Bo=(e,t)=>e.rowStart>=t.row&&e.rowStart<t.row+t.height,os=(e,t)=>{var s;return(s=Object.keys(t.slottables).find(o=>Bo(e,t.slottables[o].position)))!=null?s:null},Gt=(e,t)=>{const s=B(t),o=(n,i,c)=>{for(const h in i){if(h==n)return c;const l=i[h];if(U(l))continue;const v=o(n,l.slot,`${c}/${h}/slot`);if(v)return v}return null},a=o(e,s,Be(t));if(!a)throw new Error("Widget not found in layout");return a},te=(e,t)=>e?`${Be(t)}/${e}/slot`:Be(t),He=(e,t,s)=>{if(s){const a=t.slottables[s];return{...e,rowStart:e.rowStart-a.position.row,rowEnd:e.rowEnd-a.position.row}}const o=Object.values(t.slottables).reduce((a,n)=>a+(n.position.row<e.rowStart?n.position.height:0),0);return{...e,rowStart:e.rowStart-o,rowEnd:e.rowEnd-o}};function Go(e){const{grid:t,mouseState:s,workingLayout:o,calculatedPositions:a}=e;if(s.state!=="MOVING_SLOTTABLE")return[];const n=t.cellAt(s.mousePos.x,s.mousePos.y),i=[],c=s.slottableId,h=o.getSlottable(c);if(!h)throw new Error("Slottable not found");const l=ns(rs(n,h.height),a,c);return i.push({op:"replace",path:`/slot/${c}/row`,backup:h.row,value:l.row}),i.push({op:"replace",path:`/slot/${c}/order`,backup:h.order,value:l.order}),i}function Fo(e,t){const{grid:s,mouseState:o,selectedWidgets:a,calculatedPositions:n,workingLayout:i}=e;if(o.state!=="MOVING")return[];const c=s.cellAt(o.initialMousePos.x,o.initialMousePos.y),h=s.cellAt(o.mousePos.x,o.mousePos.y),l={deltaI:h.i-c.i,deltaJ:h.j-c.j},v=[];for(const f of a){const p=n.widgets[f],u={colStart:p.position.colStart+l.deltaI,colEnd:p.position.colEnd+l.deltaI,rowStart:p.position.rowStart+l.deltaJ,rowEnd:p.position.rowEnd+l.deltaJ},w=te(ee(f,B(i.layout)),i.layout),I=os(u,n),k=te(I,i.layout),O=we(f,B(t));!O||!U(O)||(w===k?v.push({op:"replace",path:`${w}/${f}`,backup:O,value:{...O,...He(u,n,I)}}):(v.push({op:"remove",path:`${w}/${f}`,backup:O}),v.push({op:"add",path:`${k}/${f}`,value:{...O,...He(u,n,I)}})))}return v}function Ho(e,t,s,o){const a=[];for(const n of e.selectedWidgets){const i=te(ee(n,B(o)),o),c=de(n,o);!U(c)||(a.push({op:"replace",path:`${i}/${n}/colStart`,backup:c,value:c.colStart+t}),a.push({op:"replace",path:`${i}/${n}/colEnd`,backup:c,value:c.colEnd+t}),a.push({op:"replace",path:`${i}/${n}/rowStart`,backup:c,value:c.rowStart+s}),a.push({op:"replace",path:`${i}/${n}/rowEnd`,backup:c,value:c.rowEnd+s}))}return a}function as(e,t,s,o){const{camera:a,mouseState:n,grid:i}=e;if(!a)throw new Error("No camera value yet");if(n.state!=="RESIZING"&&n.state!=="SLOTTABLE_RESIZING")return null;const c=n.side,h=a.screenPoint2world(n.mousePos),l=c==="bottom"||c==="right"?"bottom-right":"top-left",v=i.snap(h,l),f=c.includes("left")?v.x:t.x,p=c.includes("top")?v.y:t.y,u=c.includes("right")?v.x:t.x+t.width,w=c.includes("bottom")?v.y:t.y+t.height,I=Math.abs(u-f),k=Math.abs(w-p);let O={x:Math.min(f,u),y:Math.min(p,w),width:I,height:k,referential:v.referential};return I<s&&(O={...O,width:s}),k<o&&(O={...O,height:o}),O}const Uo=({selectedWidgets:e,grid:t,calculatedPositions:s})=>Xt(Object.entries(s.widgets).filter(([o])=>e.has(o)).map(([o,a])=>Ee(s.widgets[o].position,t)).filter(o=>o!==null));function zo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="SLOTTABLE_RESIZING")return[];const a=o.slottables[t.slottableId],n={colStart:0,rowStart:a.position.row,colEnd:s.columns,rowEnd:a.position.row+a.position.height},i=s.rectFromArea(n);if(!i)return[];const c=as(e,i,s.width,s.cellHeight);if(!c)return[];const h=s.areaFromRect(c);return[{op:"replace",path:`/slot/${t.slottableId}/height`,backup:a.position.height,value:h.rowEnd-h.rowStart+1}]}function Ko(e){const{mouseState:t,selectedWidgets:s,grid:o,workingLayout:a,calculatedPositions:n}=e;if(t.state!=="RESIZING")return[];const i=t.side,c=Uo(e);if(!c)return[];const h=Array.from(s).filter(f=>{const p=n.widgets[f];return Js(Ee(p.position,o),c,i)}),{minWidth:l,minHeight:v}=ne[t.type].dashProperties;return h.flatMap(f=>{const p=n.widgets[f],u=Ee(p.position,o),w=as(e,u,l,v);if(!w)return[];const I=ee(f,B(a.layout)),k=te(I,a.layout),O=o.areaFromRect(u),ie=He(o.areaFromRect(w),n,I);return[{op:"replace",path:`${k}/${f}/colStart`,backup:O.colStart,value:Math.max(ie.colStart,0)},{op:"replace",path:`${k}/${f}/colEnd`,backup:O.colEnd,value:Math.min(ie.colEnd,rt.columns-1)},{op:"replace",path:`${k}/${f}/rowStart`,backup:O.rowStart,value:Math.max(ie.rowStart,0)},{op:"replace",path:`${k}/${f}/rowEnd`,backup:O.rowEnd,value:ie.rowEnd}]})}function Vo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING")return{operations:[]};const a=Object.values(ne[t.type].pythonAPI.params).reduce((u,w)=>(w.isKwarg||!w.dashesInitialValue||(u[w.argName]=w.dashesInitialValue),u),{}),{initialWidth:n,initialHeight:i}=ne[t.type].dashProperties,c=s.areaFromRect({x:t.x,y:t.y,width:n,height:i,referential:"world"}),h=os(c,o),l=te(h,e.workingLayout.layout),v=Ue(),f={id:v,type:t.type,props:{...a},...He(c,o,h),events:{}};return{operations:[{op:"add",path:`${l}/${v}`,value:f}],widgetId:v}}const rs=({j:e},t)=>({row:e,height:t,order:0}),jo=(e,t)=>Object.keys(e).reduce((s,o)=>(o===t||(s[o]=e[o]),s),{}),ns=(e,t,s)=>{const o=s?{...t,slottables:jo(t.slottables,s)}:t,a=Math.max(Object.values(o.slottables).reduce((i,c)=>c.position.row>=e.row?i:c.position.row+c.position.height<=e.row?i-c.position.height:i-(e.row-c.position.row),e.row),0),n=Zo(e,o);return{...e,row:a,order:n}},Ft=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).find(o=>e.row>=o.position.row+o.position.height/2&&e.row<=o.position.row+o.position.height),Ht=(e,t,s)=>Object.values(t.slottables).filter(o=>o.id!==s).filter(o=>o.position.row+o.position.height/2>e.row&&o.position.row<=e.row+e.height).reduce((o,a)=>!o||a.position.order<o.position.order?a:o,null),Zo=(e,t)=>{var v,f;const s=Ft(e,t),o=Ht(e,t),a=s?Ht(s.position,t,s.id):null,n=o?Ft(o.position,t,o.id):null,i=[s,n].reduce((p,u)=>p?u&&p.position.order>u.position.order?u:p:u,null),c=[o,a].reduce((p,u)=>p?u&&p.position.order<u.position.order?u:p:u,null);if(!i&&!c)return 0;const h=(v=i==null?void 0:i.position.order)!=null?v:c.position.order-2,l=(f=c==null?void 0:c.position.order)!=null?f:i.position.order+2;return(h+l)/2};function Jo(e){const{mouseState:t,grid:s,calculatedPositions:o}=e;if(t.state!=="DRAGGING_SLOTTABLE")return{operations:[]};const a=s.cellAt(t.x,t.y),n=Ue(),i={id:n,type:t.type,props:{condition:"True"},slot:{},...ns(rs(a,1),o)};return{operations:[{op:"add",path:`/slot/${n}`,value:i}],widgetId:n}}function Qo(e,t){const{mouseState:s,selectedWidgets:o}=e;if(s.state!=="MOVING"||!s.duplicating)return[];const a=[];for(const n of o){const i=te(ee(n,B(t)),t),c=de(n,t);if(!c)continue;const h=Ue();a.push({op:"add",path:`${i}/${h}`,value:{...J.exports.cloneDeep(c),id:h}})}return a}function is(e,t,s){const o=e.selectedWidgets,a=o.keys().next().value,n=ee(a,B(t)),i=n?yt(n,t).slot:B(t),h=Object.keys(i).filter(f=>!o.has(f)&&!(s!=null&&s.some(p=>f==p))&&U(i[f])).sort((f,p)=>Qs(we(f,B(t)),we(p,B(t)))),l=[...o,...s||[]].map(f=>we(f,B(t))).filter(f=>f!=null),v=[];return h.forEach(f=>{const p=we(f,B(t));if(!p||!U(p))return;let u=0,w={...p};const I=()=>l.some(k=>Yt(w,k));for(;I();)u++,w={...p,rowStart:p.rowStart+u,rowEnd:p.rowEnd+u};if(u){const k=te(n,t);v.push({op:"replace",path:`${k}/${f}/rowStart`,backup:p.rowStart,value:p.rowStart+u}),v.push({op:"replace",path:`${k}/${f}/rowEnd`,backup:p.rowEnd,value:p.rowEnd+u})}l.push(w)}),v}function qo(e,t,s,o){const a=e.selectedWidgets;if(!a.size)return[];const n=[...a],i=[];return n.some(h=>{const l=ee(h,B(o)),v=l?yt(l,o).slot:B(o),f=Object.keys(v).filter(u=>!a.has(u)&&U(v[u])),p=de(h,o);return f.some(u=>Yt(p,v[u]))})&&a.forEach(h=>{const l=we(h,B(o)),v=te(ee(h,B(o)),o);!l||!U(l)||(i.push({op:"replace",path:`${v}/${h}/rowStart`,backup:l.rowStart,value:l.rowStart-s}),i.push({op:"replace",path:`${v}/${h}/rowEnd`,backup:l.rowEnd,value:l.rowEnd-s}),i.push({op:"replace",path:`${v}/${h}/colStart`,backup:l.colStart,value:l.colStart-t}),i.push({op:"replace",path:`${v}/${h}/colEnd`,backup:l.colEnd,value:l.colEnd-t}))}),i}function Xo(e,t){const s=[],o=[];for(const a of t){const n=Ue();s.push({op:"add",path:`/slot/${n}`,value:{...J.exports.cloneDeep(a),id:n}}),o.push(n)}return{operations:s,widgetsId:o}}function Yo(e){const t=z(e.workingLayout.layout),s=Qo(e,t);x(t,s);const o=Go(e);x(t,o);const a=Fo(e,t);x(t,a);const n=Ko(e);x(t,n);const i=zo(e);x(t,i);const c=Vo(e);x(t,c.operations);const h=Jo(e);x(t,h.operations);const l=Et(e,t,c.widgetId?[c.widgetId]:[]);x(t,l);const v=is(e,t,c.widgetId?[c.widgetId]:[]);return x(t,v),{layout:t,operations:[...s,...a,...o,...n,...i,...c.operations,...l,...v,...h.operations]}}function ea(e,t,s){const o=e.workingLayout.layout,a=Ho(e,t,s,o);x(o,a);const n=qo(e,t,s,o);x(o,n);const i=Et(e,o);return x(o,i),[...a,...n,...i]}function ta(e,t){const s=e.workingLayout.layout,o=Xo(e,t);x(s,o.operations);const a=Et(e,s,o.widgetsId);x(s,a);const n=is(e,s,o.widgetsId);return x(s,n),[...o.operations,...a,...n]}const sa={class:"zoom-bar"},oa={class:"zoom-value"},aa=Q({__name:"ZoomBar",props:{camera:null},emits:["hover","leave"],setup(e,{emit:t}){const s=e,o=G(!1),a=G(null),n=()=>{var l;(l=s.camera)==null||l.zoomIn(1.1,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},i=()=>{var l;(l=s.camera)==null||l.zoomIn(.9,{x:document.body.offsetWidth/2,y:document.body.offsetHeight/2,referential:"screen"})},c=F(()=>{var h,l;return`${Math.floor(((l=(h=s.camera)==null?void 0:h.zoom)!=null?l:1)*100)}%`});return he(()=>{var h;return(h=s.camera)==null?void 0:h.zoom},()=>{clearTimeout(a.value),o.value=!0,a.value=setTimeout(()=>o.value=!1,3e3)}),(h,l)=>Ne((b(),L("div",{class:"zoom-bar-wrapper",onMouseover:l[0]||(l[0]=v=>t("hover")),onMouseleave:l[1]||(l[1]=v=>t("leave"))},[S("div",sa,[S("span",{class:"zoom-control",onClick:i},"-"),S("span",oa,H(g(c)),1),S("span",{class:"zoom-control",onClick:n},"+")])],544)),[[ft,e.camera&&o.value]])}});const ra=q(aa,[["__scopeId","data-v-f937a967"]]),na=()=>window.location.href.startsWith("vscode-webview://"),ia=(e,t)=>{!na()||window.vscode.postMessage({type:"usage-event",event:{type:e,payload:t}})},la=async({operations:e,name:t})=>{ia("widgets_updated",{checkpoint:t,operations:z(e)})};class bt{constructor(t,s){ce(this,"checkpointHistory",{undos:[],redos:[]});ce(this,"_save",null);this.workingLayout=t,this.appState=s}static create(t,s){return new bt(t,s)}setWorkingLayout(t){this.workingLayout=t}undo(){if(this.appState.isPreview||!this.checkpointHistory.undos.length)return;const t=this.checkpointHistory.undos.pop();if(t)return x(this.workingLayout,t.operations),this.checkpointHistory.redos.push(ot(t)),t}redo(){if(this.appState.isPreview)return;const t=this.checkpointHistory.redos.pop();if(t)return x(this.workingLayout,t.operations),this.checkpointHistory.undos.push(ot(t)),t}execute(t){this.appState.isPreview||(x(this.workingLayout,t.operations),this.checkpointHistory.undos.push(ot(t)),this.checkpointHistory.redos=[],this.save(),la(t))}onSave(t){this._save=t}save(){var t;this.appState.isPreview||(t=this._save)==null||t.call(this)}}const ot=e=>({selection:e.selection,name:`RE: ${e.name}`,operations:e.operations.slice().reverse().map(t=>ca(t))}),ca=e=>{switch(e.op){case"add":return{op:"remove",backup:e.value,path:e.path};case"remove":return{op:"add",path:e.path,value:e.backup};case"replace":return{op:"replace",backup:e.value,path:e.path,value:e.backup}}};class Pt{constructor(t,s){ce(this,"operationQueue");this.layout=t,this.operationQueue=bt.create(t,s)}getRootSlot(){return B(this.layout)}getRootSlotPath(){return Be(this.layout)}setLayout(t){this.operationQueue.setWorkingLayout(t)}static create(t,s){return new Pt(t,s)}getWidget(t){return de(t,this.layout)}getWidgetOrSlottable(t){const s=no(t,this.layout);if(!s)throw new Error(`Could not find widget or slottable with id ${t}`);return s}get widgets(){return this.getRootSlot()}get allWidgets(){const t=s=>Object.entries(s).reduce((o,[a,n])=>U(n)?{...o,[a]:n}:{...o,...t(n.slot)},{});return t(this.widgets)}getSlottable(t){return yt(t,this.layout)}redo(){let t=this.operationQueue.redo();for(;t&&t.operations.length===0;)t=this.operationQueue.redo();return this.operationQueue.save(),t}undo(){let t=this.operationQueue.undo();for(;t&&t.operations.length===0;)t=this.operationQueue.undo();return this.operationQueue.save(),t}updateVariable(t,s){const o=this.getWidget(s);if(!U(o))return;const a=te(ee(s,this.getRootSlot()),this.layout);this.operationQueue.execute({name:"update variable",selection:new Set([s]),operations:[{op:"replace",backup:o.variable,value:t,path:`${a}/${s}/variable`}]})}updateProp({param:t,value:s},o){const a=i=>this.getWidgetOrSlottable(i).props,n=(i,c,h)=>{const l=Gt(i,this.layout);return[{op:"replace",backup:a(i)[c],value:h,path:`${l}/${i}/props/${c}`}]};this.operationQueue.execute({name:"update props",operations:o.flatMap(i=>n(i,t.argName,s)),selection:new Set(o)})}updateEvent({event:t,value:s},o){const a=i=>this.getWidget(i).events,n=(i,c,h)=>{const l=te(ee(i,this.getRootSlot()),this.layout);return[{op:"replace",backup:a(i)[c],value:h,path:`${l}/${i}/events/${c}`}]};this.operationQueue.execute({name:"update events",operations:o.flatMap(i=>n(i,t.key,s)),selection:new Set(o)})}delete(t){this.operationQueue.execute({name:"widgets deleted",operations:t.map(s=>{const o=Gt(s,this.layout);return{op:"remove",backup:this.getWidgetOrSlottable(s),path:`${o}/${s}`}}),selection:new Set(t)})}onSave(t){this.operationQueue.onSave(t)}updateVersion(){this.layout.version!=="0.2"&&this.operationQueue.execute({name:"Version updated",operations:[{op:"replace",backup:this.layout.version,value:"0.2",path:"/version"},{op:"add",value:this.layout.widgets,path:"/slot"},{op:"remove",path:"/widgets",backup:this.layout.widgets}],selection:new Set})}}const Ut={PandasDataFrame:"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html",PlotlyFigure:"https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html","datetime.time":"https://docs.python.org/3/library/datetime.html#datetime.time","datetime.date":"https://docs.python.org/3/library/datetime.html#datetime.date","io.IOBase":"https://docs.python.org/3/library/io.html#io.IOBase","time.struct_time":"https://docs.python.org/3/library/time.html#time.struct_time"},ua="#E286A3",da="#EF9542",pa="#B462DB",ha="#40B6D3",fa="#6FB96E",va=[ua,da,pa,ha,fa];function zt(e){let t=e;return Object.keys(Ut).forEach(s=>{if(e.includes(s)){const o=Ut[s];t=t.replace(s,`<a href="${o}" target="_blank">${s}</a>`)}}),t}const Se={},ga=e=>t=>{if(Se[t])return Se[t];const s=Object.keys(Se).length%e.length;return Se[t]=e[s],e[s]},Kt=ga([...va]),ma=()=>{Object.keys(Se).forEach(e=>delete Se[e])};class ya{constructor(){ce(this,"globalEventListeners",[])}addGlobalEventListener(t,s){addEventListener(t,s),this.globalEventListeners.find(o=>o.evt===t)||this.globalEventListeners.push({evt:t,handler:s})}removeGlobalEventListeners(){this.globalEventListeners.forEach(({evt:t,handler:s})=>{removeEventListener(t,s)}),this.globalEventListeners=[]}}const wa={class:"param-types"},_a=["innerHTML"],Sa={key:1,class:"prop-type"},Ea=["innerHTML"],ba=Q({__name:"ParamTypes",props:{param:null},setup(e){return(t,s)=>(b(),L("div",wa,[e.param&&e.param.typeDescription?(b(!0),L(De,{key:0},Te(e.param.typeDescription,o=>(b(),L("div",{key:o,class:"prop-type"},[S("p",{class:"type",style:ke({color:g(Kt)(o)}),innerHTML:g(zt)(o)},null,12,_a)]))),128)):e.param&&e.param.typeName?(b(),L("div",Sa,[S("p",{class:"type",style:ke({color:g(Kt)(e.param.typeName)}),innerHTML:g(zt)(e.param.typeName)},null,12,Ea)])):j("",!0)]))}});const Vt=q(ba,[["__scopeId","data-v-d6aed39d"]]),Pa=["value","placeholder"],Ia=["value","placeholder"],Oa=Q({__name:"PythonPropInputRaw",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input","change","clearSuggestions"],setup(e,{emit:t}){const s=e,o=vt({isActive:!1,hasChanges:!1}),a=h=>{t("input",h),o.hasChanges=!0},n=()=>{o.isActive=!1,t("clearSuggestions")},i=h=>{h.preventDefault();const l=h.target,v=l.selectionStart,f=l.selectionEnd,p=l.value;l.value=p.substring(0,v)+"	"+p.substring(f),l.selectionStart=l.selectionEnd=v+1,l.dispatchEvent(new Event("input"))},c=h=>{s.commit(h),o.hasChanges=!1};return gt(()=>{o.hasChanges&&s.commit(s.value)}),(h,l)=>{var f,p;const v=Ce("icon");return b(),L("div",{class:ve(["input-container",{error:e.hasError}])},[$(v,{path:g(Ms),class:"icon",fill:e.hasError?"#D35249":o.isActive?"#3482E5":void 0},null,8,["path","fill"]),e.isCode?(b(),L("textarea",{key:0,value:e.value,class:"prop-input",placeholder:(f=e.placeholder)!=null?f:void 0,onInput:l[0]||(l[0]=u=>a(u.target.value)),onClick:l[1]||(l[1]=u=>o.isActive=!0),onBlur:n,onKeydown:l[2]||(l[2]=Fs(u=>i(u),["tab"])),onChange:l[3]||(l[3]=u=>c(u.target.value))},null,40,Pa)):(b(),L("input",{key:1,value:e.value,class:"prop-input",placeholder:(p=e.placeholder)!=null?p:void 0,onInput:l[4]||(l[4]=u=>a(u.target.value)),onClick:l[5]||(l[5]=u=>o.isActive=!0),onBlur:n,onChange:l[6]||(l[6]=u=>c(u.target.value))},null,40,Ia))],2)}}});const Aa=q(Oa,[["__scopeId","data-v-1159e0c0"]]),La={class:"suggestions"},Ra=["onMousedown"],Da=Q({__name:"PythonAutoCompleteSuggestions",props:{suggestions:null},emits:["select"],setup(e,{emit:t}){return(s,o)=>Ne((b(),L("div",La,[(b(!0),L(De,null,Te(e.suggestions,a=>(b(),L("div",{key:a,class:"suggestion",onMousedown:n=>t("select",a)},H(a),41,Ra))),128))],512)),[[ft,e.suggestions.length]])}});const Ta=q(Da,[["__scopeId","data-v-afec000d"]]),ka={class:"python-wrapper"},$a=Q({__name:"PythonPropInput",props:{hasError:{type:Boolean},placeholder:null,value:null,paramName:null,dashPlayerState:null,isCode:{type:Boolean},commit:{type:Function}},emits:["input"],setup(e,{emit:t}){const s=e,o=F(()=>s.dashPlayerState.suggestionsFor),a=F(()=>s.dashPlayerState.suggestions),n=l=>{c(s.paramName,l),t("input",l)},i=l=>{h(),t("input",l),s.commit(l)},c=async(l,v)=>{!v||s.dashPlayerState.getAutocompleteSuggestions(l,v)},h=async()=>{await mt(),s.dashPlayerState.clearSuggestions()};return(l,v)=>(b(),L("div",ka,[$(Aa,{value:e.value,commit:e.commit,"is-code":e.isCode,"param-name":e.paramName,"dash-player-state":e.dashPlayerState,onInput:n,onClearSuggestions:h},null,8,["value","commit","is-code","param-name","dash-player-state"]),g(o)===e.paramName?(b(),fe(Ta,{key:0,suggestions:g(a),onSelect:i},null,8,["suggestions"])):j("",!0)]))}});const at=q($a,[["__scopeId","data-v-5e99cdec"]]),se=e=>(pt("data-v-d52bbf5a"),e=e(),ht(),e),Na={class:"wrapper"},Ca={class:"title"},xa={key:0,class:"widget-prop"},Ma=se(()=>S("h2",null,"Error",-1)),Wa=se(()=>S("p",{class:"section-description"}," Some errors were found while computing the widget. ",-1)),Ba=["textContent"],Ga={key:1,class:"section"},Fa=se(()=>S("h2",null,"VARIABLE",-1)),Ha={key:0,class:"section-content"},Ua={class:"widget-prop"},za=se(()=>S("p",{class:"prop-label"},"Bind a variable",-1)),Ka=se(()=>S("p",{class:"prop-description"}," Create a variable to be controlled by this widget. ",-1)),Va={class:"input-container"},ja={key:0,class:"variable-error prop-error"},Za=se(()=>S("pre",null,"Variable not defined",-1)),Ja={key:1,class:"prop-error",textContent:"SyntaxError: This field must be a variable name"},Qa=["textContent"],qa={key:2,class:"section"},Xa=se(()=>S("h2",null,"EVENTS",-1)),Ya={key:0,class:"section-content"},er=se(()=>S("p",{class:"section-description"}," Each event is a Python code that runs on specified situations ",-1)),tr={class:"prop-label"},sr={class:"prop-description"},or={class:"section"},ar=se(()=>S("h2",null,"PROPERTIES",-1)),rr={key:0,class:"section-content"},nr=se(()=>S("p",{class:"section-description"}," Each property is a Python expression, make sure to use the correct syntax. ",-1)),ir={class:"prop-label"},lr={class:"prop-description"},cr=["textContent"],ur=se(()=>S("div",{class:"feedback"},null,-1)),dr=[ur],pr=Q({__name:"WidgetEditor",props:{selectedWidgetErrors:null,layoutModel:null,selectedWidgets:null,dashPlayerState:null},emits:["close","create-variable"],setup(e,{emit:t}){const s=e,o=G(null);he(()=>s.selectedWidgetErrors,()=>{o.value=null});const a=_=>{I.openedSections.includes(_)?I.openedSections=I.openedSections.filter(E=>E!==_):I.openedSections.push(_)},n=_=>I.openedSections.includes(_),i=_=>U(_)?ne[_.type].name:be[_.type].name,c=F(()=>o.value===null?s.selectedWidgetErrors:o.value==="variable"?J.exports.omit(s.selectedWidgetErrors,"variable"):{...s.selectedWidgetErrors,props:J.exports.omit(s.selectedWidgetErrors.props,o.value)}),h=F(()=>l.value.type.includes("-input")&&l.value.type!=="click-input"),l=F(()=>s.selectedWidgets[0]),v=F(()=>{var R;if(!U(l.value))return;const E=((R=ne[l.value.type].pythonAPI.params)!=null?R:[]).find(N=>N.argName==="initial_value");return E||null});function f(_){this.style.height="0",this.style.height=this.scrollHeight-24+"px"}const p=new ya,u=G(null),w=402,I=vt({isActive:!1,resizing:!1,width:w,openedSections:["properties","variable"]});Qt(()=>{u.value&&(p.addGlobalEventListener("mouseup",()=>I.resizing=!1),p.addGlobalEventListener("mousemove",R=>k(R))),document.querySelectorAll(".widget-props-editor textarea").forEach(R=>{!R||(R.setAttribute("style","height:"+(R.scrollHeight-24)+"px;overflow-y:hidden;"),R.addEventListener("input",f,!1))})}),Hs(()=>{ma(),p.removeGlobalEventListeners()});const k=_=>{I.resizing&&(I.width=Math.max(I.width-_.movementX,w))},O=F(()=>({width:`${I.width}px`})),ie=_=>be[_.type].params,ze=F(()=>{const _=(N,K)=>N.argName===K.argName&&N.typeName===K.typeName,E=(N,K,D)=>D.findIndex(Z=>_(N,Z))===K,R=N=>!N.formOnly;return s.selectedWidgets.flatMap(N=>{var K;return U(N)?(K=ne[N.type])==null?void 0:K.pythonAPI.params:ie(N)}).filter(Boolean).filter(R).filter(E)}),me=F(()=>{const _=(R,N)=>R.key===N.key,E=(R,N,K)=>K.findIndex(D=>_(R,D))===N;return s.selectedWidgets.flatMap(R=>{var N;return U(R)?(N=ne[R.type])==null?void 0:N.events:[]}).filter(Boolean).filter(E).filter(R=>R.key!=="change")}),Ke=_=>{s.layoutModel.updateVariable(_,l.value.id),o.value="variable"},xe=_=>E=>{s.layoutModel.updateProp({param:_,value:E},s.selectedWidgets.map(R=>R.id)),o.value=_.argName},Ve=_=>E=>{s.layoutModel.updateEvent({event:_,value:E},s.selectedWidgets.map(R=>R.id))},je=()=>{var _,E;return(E=(_=c.value.variable)==null?void 0:_.repr)==null?void 0:E.includes("SyntaxError")},Ze=()=>{var _,E;return(E=(_=c.value.variable)==null?void 0:_.repr)==null?void 0:E.includes("NameError")},m=_=>{var E;!_||((E=s.dashPlayerState.broker)==null||E.send({name:_,value:null,type:"variable-created",state:s.dashPlayerState.apiPageState}),t("create-variable",_))},M=()=>{var _,E;return((_=c.value.widget)==null?void 0:_.repr)&&!Object.values((E=c.value.props)!=null?E:{}).some(R=>R.repr)},Y=()=>{var _;return(_=c.value.widget)==null?void 0:_.repr},X=_=>{var E,R;return(R=(E=c.value.props)==null?void 0:E[_])==null?void 0:R.repr},Pe=_=>J.exports.upperFirst(_.replace(/_/g," "));return(_,E)=>{var N,K;const R=Ce("icon");return b(),L("div",{class:"widget-props-editor",style:ke(g(O))},[S("div",Na,[S("div",Ca,[S("h1",null,H(i(g(l))),1),$(R,{path:g(Ws),fill:"#414A58",class:"close-icon",width:"16",height:"16",onClick:E[0]||(E[0]=D=>t("close"))},null,8,["path"])]),M()?(b(),L("div",xa,[Ma,Wa,S("pre",{class:"prop-error",textContent:H(Y())},null,8,Ba)])):j("",!0),g(h)?(b(),L("div",Ga,[S("div",{class:"section-header",onClick:E[1]||(E[1]=D=>a("variable"))},[$(R,{path:n("variable")?g(Ye):g(et),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Fa]),n("variable")?(b(),L("div",Ha,[S("div",Ua,[za,Ka,S("div",Va,[$(at,{placeholder:"variable_name","param-name":"variable","dash-player-state":e.dashPlayerState,value:(N=g(l).variable)!=null?N:"",commit:Ke,"is-code":!1,onInput:E[2]||(E[2]=D=>g(l).variable=D)},null,8,["dash-player-state","value"])]),Ze()&&g(l).variable?(b(),L("div",ja,[Za,S("button",{onClick:E[3]||(E[3]=D=>m(g(l).variable))}," Create ")])):je()?(b(),L("pre",Ja)):(K=g(c).variable)!=null&&K.repr?(b(),L("pre",{key:2,class:"prop-error",textContent:H(g(c).variable.repr)},null,8,Qa)):j("",!0),$(Vt,{param:g(v)},null,8,["param"])])])):j("",!0)])):j("",!0),g(me).length?(b(),L("div",qa,[S("div",{class:"section-header",onClick:E[4]||(E[4]=D=>a("events"))},[$(R,{path:n("events")?g(Ye):g(et),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),Xa]),n("events")?(b(),L("div",Ya,[er,(b(!0),L(De,null,Te(g(me),D=>(b(),L("div",{key:D.key,class:"widget-prop"},[S("label",tr,"On "+H(D.key),1),S("p",sr,"Executed after "+H(D.key),1),$(at,{"param-name":D.key,"dash-player-state":e.dashPlayerState,value:g(l).events[D.key],commit:Ve(D),"is-code":!0,onInput:Z=>g(l).events[D.key]=Z},null,8,["param-name","dash-player-state","value","commit","onInput"])]))),128))])):j("",!0)])):j("",!0),S("div",or,[S("div",{class:"section-header",onClick:E[5]||(E[5]=D=>a("properties"))},[$(R,{path:n("properties")?g(Ye):g(et),fill:"#414A58",class:"chevron-icon",width:"16",height:"16"},null,8,["path"]),ar]),n("properties")?(b(),L("div",rr,[nr,(b(!0),L(De,null,Te(g(ze),D=>{var Z;return b(),L("div",{key:D.argName,class:"widget-prop"},[S("p",ir,H(Pe(D.argName)),1),S("p",lr,H(D.description),1),$(at,{"has-error":!!X(D.argName),placeholder:(Z=D.default)!=null?Z:void 0,"param-name":D.argName,"dash-player-state":e.dashPlayerState,value:g(l).props[D.argName],commit:xe(D),"is-code":!0,onInput:Je=>g(l).props[D.argName]=Je},null,8,["has-error","placeholder","param-name","dash-player-state","value","commit","onInput"]),X(D.argName)?(b(),L("pre",{key:0,class:"prop-error",textContent:H(X(D.argName))},null,8,cr)):j("",!0),$(Vt,{param:D},null,8,["param"])])}),128))])):j("",!0)])]),S("div",{ref_key:"handlerRef",ref:u,class:"handler",onMousedown:E[6]||(E[6]=Us(D=>I.resizing=!0,["stop"]))},dr,544)],4)}}});const hr=q(pr,[["__scopeId","data-v-d52bbf5a"]]),ls=e=>(pt("data-v-0d595f79"),e=e(),ht(),e),fr={class:"interact-menu"},vr={class:"icon-container"},gr=ls(()=>S("span",{class:"edit"},"Edit [Shift + P]",-1)),mr={class:"icon-container"},yr=ls(()=>S("span",null,"Interact [Shift + P]",-1)),wr=Q({__name:"InteractMenu",props:{isPreview:{type:Boolean}},emits:["changePreview"],setup(e,{emit:t}){return(s,o)=>{const a=Ce("icon");return b(),L("div",fr,[S("div",vr,[$(a,{class:ve(["icon",{active:!e.isPreview}]),path:g(Bs),fill:"#5A677A",onClick:o[0]||(o[0]=n=>t("changePreview",!1))},null,8,["class","path"]),gr]),S("div",mr,[$(a,{class:ve(["icon",{active:e.isPreview}]),path:g(Zt),fill:"#5A677A",onClick:o[1]||(o[1]=n=>t("changePreview",!0))},null,8,["class","path"]),yr])])}}});const _r=q(wr,[["__scopeId","data-v-0d595f79"]]),Sr={class:"header"},Er={key:0},br={key:1},Pr=Q({__name:"RuntimeHeader",props:{title:{type:String},path:{type:String,required:!0}},setup(e){return(t,s)=>(b(),L("div",Sr,[e.title?(b(),L("p",Er,H(e.title),1)):(b(),L("p",br,H(e.path),1))]))}});const Ir=q(Pr,[["__scopeId","data-v-615748d7"]]);function Or(e){var s;const t=(s=document.getSelection())==null?void 0:s.toString();return(e==null?void 0:e.selectionStart)!==void 0||!!t}const Ar={key:0,class:"widget-metadata-card"},Lr=["src"],Rr={class:"metadata-title"},Dr={class:"metadata-description"},Tr={key:1,class:"collapsed-widget-metadata-card"},kr=["src"],$r=Q({__name:"WidgetMetadataCard",props:{metadata:null,collapsed:{type:Boolean}},setup(e){const t=window.__baseURL?`${window.__baseURL}/media`:"",s=a=>a in be?`${t}/${be[a].thumbname}`:`${t}/widget-thumbs/${io(a)}.svg`,o=window.__vscodeTheme===2?"dark":"light";return(a,n)=>e.collapsed?(b(),L("div",Tr,[S("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:ke(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,kr)])):(b(),L("div",Ar,[S("img",{class:"metadata-thumbnail",src:s(e.metadata.type),style:ke(g(o)==="dark"?{filter:"invert(1)"}:"")},null,12,Lr),S("div",Rr,H(e.metadata.name),1),S("div",Dr,H(e.metadata.description),1)]))}});const Nr=q($r,[["__scopeId","data-v-2b654c57"]]),We={"click-input":-1,"text-output":0,"number-input":1,"text-input":2,"link-output":3,"multiple-choice-input":4,"file-input":5,"email-input":6,"markdown-output":7,"dropdown-input":8,"date-input":9,"cards-input":10,"textarea-input":11,"list-input":12,"file-output":13,"html-output":14,"pandas-output":15,"checkbox-input":16,"cnpj-input":17,"code-input":18,"progress-output":19,"pandas-row-selection-input":20,"image-input":21,"password-input":22,"currency-input":23,"iframe-output":24,"checklist-input":25,"image-output":26,"nps-input":27,"phone-input":28},Cr=Q({__name:"WidgetsMetadataList",emits:["dragstart","hover","leave"],setup(e,{emit:t}){const s=G(""),o=G(),a=G(!0),n=()=>{a.value=!1},i=()=>{a.value=!0,h()},c=async()=>{await mt(),o.value&&o.value.focus()},h=()=>{s.value=""},l=Object.values(ne).concat(Object.entries(be).map(([p,u])=>({type:p,...u}))).reduce((p,u)=>u.formOnly?p:{...p,[u.type]:u},{}),v=F(()=>s.value?Object.values(l).map(p=>({widget:p,score:lo(p,s.value.split(" "))})).filter(({score:p})=>p>0).sort(({score:p},{score:u})=>u-p).map(({widget:p})=>p):Object.values(l).sort((p,u)=>{const w=p.type,I=u.type;if(w in We){if(!(I in We))return-1}else return 1;return We[w]-We[I]}));function f(p,u){t("dragstart",p,u)}return(p,u)=>{const w=Ce("icon");return b(),L("div",{class:"widgets-metadata",onMouseover:n,onMouseleave:i},[S("div",zs({class:["search",{collapsed:a.value}]},Ks(a.value?{click:c}:{},!0)),[$(w,{path:g(Gs),class:"search-icon"},null,8,["path"]),a.value?j("",!0):Ne((b(),L("input",{key:0,ref_key:"searchInput",ref:o,"onUpdate:modelValue":u[0]||(u[0]=I=>s.value=I),type:"search",class:"widgets-metadata-filter",placeholder:"Find widgets"},null,512)),[[Jt,s.value]])],16),S("div",{class:ve(["widgets-metadata-list",{collapsed:a.value}])},[(b(!0),L(De,null,Te(g(v),I=>(b(),fe(Nr,{key:I.type,metadata:I,draggable:!0,collapsed:a.value,onDragstart:k=>f(k,I.type)},{default:ye(()=>[qt(H(I.type),1)]),_:2},1032,["metadata","collapsed","onDragstart"]))),128))],2)],32)}}});const xr=q(Cr,[["__scopeId","data-v-cb0151ea"]]),Mr=e=>t=>J.exports.uniq(e.map(qs(t))).length===1,Wr=e=>e.some(t=>ne[t.type].autoHeight);function Br(e,t){const s=Mr(e),o=Wr(e),a=[],n=16,i=6;return s("colStart")&&a.push({rect:{x:t.x-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"left"}),s("colEnd")&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height/2-n/2,width:i,height:n,referential:"screen"},side:"right"}),s("colStart")&&s("rowStart")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-left"}),s("colEnd")&&s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y-i/2,width:i,height:i,referential:"screen"},side:"top-right"}),s("colStart")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-left"}),s("colEnd")&&s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width-i/2,y:t.y+t.height-i/2,width:i,height:i,referential:"screen"},side:"bottom-right"}),s("rowStart")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y-i/2,width:n,height:i,referential:"screen"},side:"top"}),s("rowEnd")&&!o&&a.push({rect:{x:t.x+t.width/2-n/2,y:t.y+t.height-i/2,width:n,height:i,referential:"screen"},side:"bottom"}),a}const Gr=e=>({type:"copyAndPaste",selectedWidgets:e});function Fr(e,t){return e.setData("text/plain",JSON.stringify(Gr(t))),!0}function Hr(e,t,s){const o=e.getData("text/plain");try{const a=o&&JSON.parse(o);if(!(a&&"type"in a&&a.type==="copyAndPaste"&&"selectedWidgets"in a&&Array.isArray(a.selectedWidgets)))return!1;const i=ta(t,a.selectedWidgets);return s.operationQueue.execute({name:"paste",operations:i,selection:t.selectedWidgets}),!0}catch{return!1}}class Ur{constructor(t){ce(this,"event");this.event=t}setData(t,s){var o;(o=this.event.clipboardData)==null||o.setData(t,s)}getData(t){var s,o;return(o=(s=this.event.clipboardData)==null?void 0:s.getData(t))!=null?o:null}getTransferItems(){var t,s;return Object.values((s=(t=this.event.clipboardData)==null?void 0:t.items)!=null?s:[]).map(Kr)}}class zr{constructor(t){ce(this,"item");this.item=t}get type(){return this.item.type}getAsString(){return new Promise(t=>this.item.getAsString(s=>t(s)))}getJSONValue(){return this.getAsString().then(t=>{try{return t?JSON.parse(t):null}catch{return null}})}getAsFile(){return this.item.getAsFile()}}function Kr(e){return new zr(e)}function jt(e){return new Ur(e)}const Vr={class:"dash-layout-editor"},jr=Q({__name:"DashLayoutEditor",props:{dash:null,params:null,dashPlayerState:null,workspace:null},emits:["navigate","change-preview","create-variable"],setup(e,{emit:t}){const s=e,o=()=>O.updateVersion(),a=G(null),n=G(null),i=r=>t("navigate",r),c=r=>t("create-variable",r),h=r=>t("change-preview",r),l=()=>{var r;return(r=A)==null?void 0:r.correct()},v=r=>{if(!A)return;const d={x:r.pageX,y:r.pageY,referential:"screen"},y=A.screenPoint2world(d);if(m.value.state==="PANNING"){const T={dx:-r.movementX,dy:-r.movementY},W=A.screenDelta2world({dx:T.dx,dy:T.dy,referential:"screen"});A.translate(W),r.preventDefault(),r.stopPropagation();return}m.value.state==="MOVING"&&(m.value.mousePos=y,m.value.duplicating=nt(r)),m.value.state==="MOVING_SLOTTABLE"&&(m.value.mousePos=y),m.value.state==="JUST_CLICKED"&&Nt(m.value.pos,y)*A.zoom>5&&(P.has(m.value.widgetId)||(ue(r)?P.addToSelectedWidgets(m.value.widgetId):(P.resetSelection(),P.addToSelectedWidgets(m.value.widgetId))),m.value={state:"MOVING",initialMousePos:m.value.pos,mousePos:y,duplicating:nt(r)}),m.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&Nt(m.value.mousePos,y)*A.zoom>5&&(m.value={state:"MOVING_SLOTTABLE",initialMousePos:A.screenPoint2world(m.value.mousePos),mousePos:y,slottableId:m.value.slottableId}),m.value.state==="SELECTING"&&(m.value.mousePos=d),m.value.state==="RESIZING"&&(m.value.mousePos=d),m.value.state==="SLOTTABLE_RESIZING"&&(m.value.mousePos=d),Rt(d)},f=r=>{Or(r==null?void 0:r.target)||Fr(jt(r),P.selectedWidgets)&&r.preventDefault()},p=r=>{Hr(jt(r),Z(),O)&&r.preventDefault()},u=vt({active:!1,hoverZoomBar:!1}),w=()=>{u.hoverZoomBar=!0},I=()=>{u.hoverZoomBar=!1},k=G(null),O=Pt.create(J.exports.cloneDeep(s.dash.layout),re);he(s.dash.layout,()=>{O.setLayout(s.dash.layout)});const ie=F(()=>re.isPreview),ze=F(()=>Object.keys(s.dash.rootSlot).reduce((r,d)=>{const y=s.dash.rootSlot[d];return y.position&&(r[d]=y),r},{}));let me=null;const Ke=J.exports.throttle(()=>{J.exports.isEqual(s.dash.rootSlot,me)||(me=J.exports.cloneDeep(s.dash.rootSlot),cs())},500),xe=()=>{O.onSave(async()=>{!s.workspace||(s.dash.layout=O.layout,s.dashPlayerState.updateDashData(s.dash.makeRunnerData(s.workspace)),Ke())})};xe(),he(O,xe);const Ve=F(()=>Object.keys(O.widgets).reduce((r,d)=>{var V,oe,ae;const y=(V=s.dashPlayerState.computedErrors.props)==null?void 0:V[d],T=(oe=s.dashPlayerState.computedErrors.variables)==null?void 0:oe[d],W=(ae=s.dashPlayerState.computedErrors.widgets)==null?void 0:ae[d];return!y&&!T&&!W||!Object.keys({...y,...T,...W}).length?r:r?[...r,d]:[d]},[])),je=F(()=>{var r,d,y,T,W,V;return{props:(d=s.dashPlayerState.computedErrors.props)==null?void 0:d[(r=P.selectedSlottableId)!=null?r:P.selectedWidgetId],widget:(T=s.dashPlayerState.computedErrors.widgets)==null?void 0:T[(y=P.selectedSlottableId)!=null?y:P.selectedWidgetId],variable:(V=s.dashPlayerState.computedErrors.variables)==null?void 0:V[(W=P.selectedSlottableId)!=null?W:P.selectedWidgetId]}});function Ze(r,d){if(!A)return;const y=A.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});P.resetSelection(),d in be?m.value={state:"DRAGGING_SLOTTABLE",...y,type:d}:m.value={state:"DRAGGING",...y,type:d}}const m=G({state:"IDLE"});let M={state:"NONE"};const Y=F(()=>(rt.setDashRunnerData(s.dashPlayerState.navbarVisible,s.dashPlayerState.hasSidebar),rt));he(Y,()=>{var r;return(r=A)==null?void 0:r.updateGrid(Y.value)});const X=G(null),Pe=G(null),_=G(null),E=G(null);function R(){var T,W;const r=Pe.value,d=E.value;if(!r)throw new Error(`canvas = ${r}`);if(!d)throw new Error(`editor = ${d}`);A.setProjectedCanvas(r),A.correct(),d.addEventListener("wheel",N),r.addEventListener("mousedown",D),r.addEventListener("drop",Lt),r.addEventListener("dragover",us),(T=r.parentElement)==null||T.addEventListener("keydown",Ss),(W=r.parentElement)==null||W.addEventListener("keyup",Es);const y=r.getContext("2d");if(!y)throw new Error(`I can't get no context 2d ${r}`);k.value=eo.create(r),Qe(y)}function N(r){if(!A)return;const d={x:r.pageX,y:r.pageY,referential:"screen"};if(Re(r)||So(r))A.zoomIn(Math.exp(-Math.sign(r.deltaY)*.05),d),r.preventDefault();else{const y=ue(r)?{dx:r.deltaY,dy:0}:{dx:r.deltaX,dy:r.deltaY},T=A.screenDelta2world({dx:y.dx,dy:y.dy,referential:"screen"});A.translate(T)}r.stopPropagation()}function K(r){var d;Le.overrideProps(r,{condition:!((d=Le.props)!=null&&d[r].condition)})}function D(r){var T;if(!A)return;const d={x:r.pageX,y:r.pageY,referential:"screen"};if(r.button==1||r.button==0&&bo.isPressed("space")){m.value={state:"PANNING",initialMousePos:d,mousePos:d};return}const y=A.screenPoint2world(d);M.state==="HOVERING_WIDGET"?m.value={state:"JUST_CLICKED",pos:y,widgetId:M.widgetId}:M.state==="HOVERING_RESIZE_HANDLER"?m.value={state:"RESIZING",side:M.side,initialMousePos:d,mousePos:d,type:(T=P.selectedWidget)==null?void 0:T.type}:M.state==="HOVERING_TOGGLE"?m.value={state:"JUST_CLICKED_TOGGLE",mousePos:d,slottable:M.slottable}:M.state==="HOVERING_SLOTTABLE_RESIZE_HANDLER"?m.value={state:"SLOTTABLE_RESIZING",initialMousePos:d,mousePos:d,slottableId:M.slottableId,side:"bottom"}:M.state==="HOVERING_SLOTTABLE_SELECTOR"?m.value={state:"JUST_CLICKED_SLOTTABLE_SELECTOR",slottableId:M.slottableId,mousePos:d}:(ue(r)||P.resetSelection(),m.value={state:"SELECTING",initialMousePos:d,mousePos:d})}const Z=()=>{var r;return{mouseState:m.value,grid:Y.value,camera:A,workingLayout:O,hoverState:M,resizeHandlerRects:Ot(),widgetsInRectangularSelection:qe(),selectedWidgets:new Set(P.selectedWidgetsIds),dash:s.dash,calculatedPositions:Ct(s.dashPlayerState.runnerData.layout.slot,(r=Le.props)!=null?r:{},Y.value),selectedSlottable:P.selectedSlottableId}},Je=()=>{var W,V,oe,ae,Ie,Oe,Ae,Dt,Tt,kt;const r=A.screenRect2world(A.canvasRect),d=A.screenDelta2world({dx:8,dy:8,referential:"screen"}),y=A.screenRect2world({x:(W=n.value)==null?void 0:W.$el.getBoundingClientRect().x,y:(V=n.value)==null?void 0:V.$el.getBoundingClientRect().y,width:(oe=n.value)==null?void 0:oe.$el.getBoundingClientRect().width,height:(ae=n.value)==null?void 0:ae.$el.getBoundingClientRect().height,referential:"screen"});Xe({origin:{x:Math.min(Y.value.width+d.dx,r.x+r.width-y.width-d.dx),y:Math.max(r.y+d.dy,0),referential:"world"},element:(Ie=n==null?void 0:n.value)==null?void 0:Ie.$el,ignoreZoom:!0});const T=A.screenRect2world({x:(Oe=X.value)==null?void 0:Oe.$el.getBoundingClientRect().x,y:(Ae=X.value)==null?void 0:Ae.$el.getBoundingClientRect().y,width:(Dt=X.value)==null?void 0:Dt.$el.getBoundingClientRect().width,height:(Tt=X.value)==null?void 0:Tt.$el.getBoundingClientRect().height,referential:"screen"});Xe({origin:{x:0,y:-T.height-d.dy,referential:"world"},element:(kt=X==null?void 0:X.value)==null?void 0:kt.$el,ignoreZoom:!0})},cs=()=>{var r;(r=s.dashPlayerState.broker)==null||r.send({type:"widgets-changed",state:s.dashPlayerState.apiPageState,dashDefinition:{slot:s.dash.rootSlot}})},le=G(null);function Qe(r){var V,oe,ae,Ie,Oe,Ae;if(!A||!s.workspace)return;Xe({origin:{x:0,y:0,referential:"world"},element:(V=a==null?void 0:a.value)==null?void 0:V.$el}),Je();const d=r.canvas.getBoundingClientRect();if(r.canvas.width=r.canvas.offsetWidth,r.canvas.height=r.canvas.offsetHeight,r.clearRect(0,0,r.canvas.width,r.canvas.height),r.translate(-d.x,-d.y),r.canvas.style.cursor=(ae=(oe=k.value)==null?void 0:oe.cursor(m.value,M))!=null?ae:"default",!k.value){requestAnimationFrame(()=>Qe(r));return}const y=Z(),T=Yo(y);(!J.exports.isEqual(T.operations,(Ie=le.value)==null?void 0:Ie.operations)||!J.exports.isEqual(T.layout,(Oe=le.value)==null?void 0:Oe.layout))&&(le.value=T,s.dashPlayerState.updateRunnerData(s.dash.makeRunnerData(s.workspace,le.value.layout))),le.value&&k.value.render({...y,computedState:le.value,isPreview:re.isPreview,calculatedPositions:Ct(s.dash.makeRunnerData(s.workspace,le.value.layout).layout.slot,(Ae=Le.props)!=null?Ae:{},Y.value)}),requestAnimationFrame(()=>Qe(r))}s.dashPlayerState.onWidgetsComputedMessage(r=>{var T;const d=Object.keys(s.dashPlayerState.runnerData.layout.slot),y=Object.keys((T=r.props)!=null?T:{});co(d,y)}),Qt(()=>{o(),me=J.exports.cloneDeep(uo(ze.value,ne)),Le.setInitialEditProps(s.dash.rootSlot),P.setLayoutModel(O),addEventListener("resize",l),addEventListener("copy",f),addEventListener("paste",p),addEventListener("mousemove",v),mt(()=>{R()})}),gt(()=>{removeEventListener("resize",l),removeEventListener("copy",f),removeEventListener("paste",p),removeEventListener("mousemove",v),Xs()});function us(r){if(!A)return;r.preventDefault();const d=A.screenPoint2world({x:r.pageX,y:r.pageY,referential:"screen"});m.value={...m.value,...d}}const ds=()=>{m.value.state==="IDLE"&&P.resetSelection(),At({referential:"screen",x:0,y:0})},It=()=>{P.selectedSlottableId?O.delete([P.selectedSlottableId]):O.delete(P.selectedWidgetsIds),P.resetSelection()},ps=r=>{if(Re(r)&&ue(r)){r.preventDefault(),r.stopPropagation();const d=O.redo();if(d){if(d.operations.some(y=>y.op==="remove")){P.resetSelection();return}P.selectedWidgetsIds=[...new Set(d.selection)]}return}else if(Re(r)){r.preventDefault(),r.stopPropagation();const d=O.undo();if(d){if(d.operations.some(y=>y.op==="remove")){P.resetSelection();return}P.selectedWidgetsIds=[...new Set(d.selection)]}return}},Me=(r,d)=>{const[y,T]={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}[d],W=ea(r,y,T);O.operationQueue.execute({name:`move ${d}`,operations:W,selection:r.selectedWidgets})},hs=()=>{Me(Z(),"up")},fs=()=>{Me(Z(),"down")},vs=()=>{Me(Z(),"left")},gs=()=>{Me(Z(),"right")},ms=r=>{Re(r)&&(r.preventDefault(),r.stopPropagation(),P.selectAll())};he(()=>s.dashPlayerState.authenticating,r=>{r&&(re.isPreview=!0)});const ys=r=>{ue(r)&&h(!re.isPreview)},ws=()=>{m.value.state!=="PANNING"&&(m.value.state="START_PANNING")},_s=r=>({escape:()=>ds(),backspace:()=>It(),delete:()=>It(),z:()=>ps(r),arrowup:()=>hs(),arrowdown:()=>fs(),arrowleft:()=>vs(),arrowright:()=>gs(),a:()=>ms(r),p:()=>ys(r),space:()=>ws()}),Ss=r=>{var d,y;return(y=(d=_s(r))[r.key.toLowerCase().trim()?r.key.toLowerCase():r.code.toLowerCase()])==null?void 0:y.call(d)},Es=()=>{m.value.state="IDLE"};function bs(){if(m.value.state!=="SELECTING")return null;const{x:r,y:d}=m.value.initialMousePos,{x:y,y:T}=m.value.mousePos;return{x:Math.min(r,y),y:Math.min(d,T),width:Math.abs(r-y),height:Math.abs(d-T),referential:"screen"}}function qe(){if(!A)throw new Error("No camera value yet");const r=bs();return r?new Set(Object.keys(s.dashPlayerState.widgets).filter(d=>to(A.worldRect2screen(Ee(s.dashPlayerState.getWidgetPosition(d),Y.value)),r))):new Set}function Ps(){return P.selectedWidgetsIds.every(r=>Object.keys(s.dashPlayerState.widgets).includes(r))}const Is=()=>Xt(Object.entries(s.dashPlayerState.widgets).filter(([r])=>P.has(r)).map(([r,d])=>Ee(d.position,Y.value)));function Ot(){if(!A)throw new Error("No camera value yet");const r=Is();return!r||!Ps()?[]:Br(P.selectedWidgets,A.worldRect2screen(r))}function At(r){m.value={state:"IDLE"},Rt(r)}const Os=r=>{m.value=m.value,ue(r)?qe().forEach(d=>{P.toggleWidgetSelection(d)}):(P.resetSelection(),qe().forEach(d=>{P.addToSelectedWidgets(d)}))};function Lt(r){var y;(y=le.value)!=null&&y.operations.length&&O.operationQueue.execute({name:"mouse up",operations:le.value.operations,selection:new Set(P.selectedWidgetsIds)}),m.value.state==="SELECTING"&&Os(r),m.value.state==="JUST_CLICKED"&&(ue(r)?P.toggleWidgetSelection(m.value.widgetId):(P.clearWidgetSelection(),P.selectedSlottableId=null,P.addToSelectedWidgets(m.value.widgetId))),m.value.state==="JUST_CLICKED_TOGGLE"&&K(m.value.slottable),m.value.state==="JUST_CLICKED_SLOTTABLE_SELECTOR"&&(P.selectedSlottableId=m.value.slottableId);const d={x:r.pageX,y:r.pageY,referential:"screen"};At(d)}addEventListener("mouseup",Lt);const As=r=>{for(const d of Ot())if(xt(r,d.rect)){M={state:"HOVERING_RESIZE_HANDLER",side:d.side};return}},Ls=r=>{var y;const d=(y=Object.keys(s.dashPlayerState.widgets).find(T=>xt(A.screenPoint2world(r),Ee(s.dashPlayerState.getWidgetPosition(T),Y.value))))!=null?y:null;d?M={state:"HOVERING_WIDGET",widgetId:d}:M={state:"NONE"}},Rs=r=>{const d=tt.getToggleUnderCursor(r);d&&(M={state:"HOVERING_TOGGLE",slottable:d.id})},Ds=r=>{const d=tt.getSelectorUnderCursor(r);d&&(M={state:"HOVERING_SLOTTABLE_SELECTOR",slottableId:d.id})},Ts=r=>{const d=tt.getResizerUnderCursor(r);d&&(M={state:"HOVERING_SLOTTABLE_RESIZE_HANDLER",slottableId:d.id})};function Rt(r){!A||(Ls(r),As(r),Rs(r),Ds(r),Ts(r))}const Xe=r=>{const{origin:d,element:y,ignoreZoom:T}=r;if(!A||!y||!y.style)return;const W=A.worldPoint2screen(d),V=Pe.value.getBoundingClientRect(),oe=[`translate(${W.x-V.x}px, ${W.y-V.y}px)`,T?null:`scale(${A.zoom})`].filter(ae=>ae).join(" ");Object.assign(y.style,{transform:oe,transformOrigin:"top left"})};return(r,d)=>(b(),L("div",Vr,[Ne($(xr,{onDragstart:Ze},null,512),[[ft,!g(ie)]]),S("div",{ref_key:"editor",ref:_,class:ve(["editor"])},[S("div",{ref_key:"listeners",ref:E,class:"listeners",tabindex:"0"},[$(Ys,{ref_key:"player",ref:a,class:ve(["player",{preview:g(re).isPreview}]),style:{top:0,left:0,height:"unset"},"is-preview":!0,params:e.params,camera:g(A),"editing-mode":!g(re).isPreview,"force-responsivity":"desktop","widgets-with-errors":g(Ve),"dash-player-state":e.dashPlayerState,onNavigate:i},null,8,["class","params","camera","editing-mode","widgets-with-errors","dash-player-state"]),S("canvas",{ref_key:"canvas",ref:Pe,class:ve(["layout-canvas",{hide:g(ie)}])},null,2)],512),$(Ir,{ref_key:"runtimeHeader",ref:X,title:e.dashPlayerState.runnerData.title,path:e.dashPlayerState.runnerData.path},null,8,["title","path"]),$(_r,{ref_key:"interactMenu",ref:n,class:"interact-menu","is-preview":g(re).isPreview,onChangePreview:h},null,8,["is-preview"])],512),(g(P).selectedWidgetsIds.length>0||g(P).selectedSlottableId)&&!g(re).isPreview&&m.value.state==="IDLE"?(b(),fe(hr,{key:0,"selected-widget-errors":g(je),"layout-model":g(O),"selected-widgets":g(P).selectedSlottable?[g(P).selectedSlottable]:g(P).selectedWidgets,"dash-player-state":e.dashPlayerState,onClose:d[0]||(d[0]=y=>g(P).clearWidgetSelection()),onCreateVariable:c},null,8,["selected-widget-errors","layout-model","selected-widgets","dash-player-state"])):j("",!0),$(ra,{camera:g(A),class:"zoom-bar",onHover:w,onLeave:I},null,8,["camera"])]))}});const Zr=q(jr,[["__scopeId","data-v-fd5c9d77"]]),Jr={class:"dash-editor"},Qr=Q({__name:"DashEditor",setup(e){const t=js(),{result:s}=Wt(()=>ho.get()),o=({id:w,type:I})=>{I==="dash"?(t.push({name:"dashEditor",params:{dashId:w},query:n.query}),h()):t.push({name:"editor",params:{formId:w},query:n.query})},a=()=>{var w;!((w=c.value)!=null&&w.path)||t.push(`/_editor/dash/${encodeURIComponent(c.value.path)}/preview`)},n=Zs(),{loading:i,result:c,refetch:h}=Wt(()=>po.get(n.params.dashPath)),l=w=>{re.isPreview=w},v=w=>{var I;return(I=c.value)==null?void 0:I.addVariableToCode(w)};let f=Vs(null);const p=()=>{var w;if(!(!c.value||!s.value)){if(c.value.path===((w=f.value)==null?void 0:w.runnerData.path)){f.value.updateDashData(c.value.makeRunnerData(s.value));return}console.log(f),f.value=Mt.create(c.value.makeRunnerData(s.value),!0),f.value.onRedirect(({url:I,queryParams:k})=>Ns(t,I,k))}},u=()=>{var w;!f.value||(w=f.value)==null||w.resetState()};return he(c,p),gt(()=>{var w;!c.value||!s.value||Mt.delete((w=c.value)==null?void 0:w.makeRunnerData(s.value).idOrPath)}),(w,I)=>{var O;const k=Ce("icon");return b(),L("div",Jr,[g(i)||!g(c)||!g(s)?(b(),fe(ro,{key:0,class:"loading",justify:"center"})):(b(),fe(Cs,{key:1},{left:ye(()=>[$(xs,{link:"/_editor/dashes"})]),right:ye(()=>[S("button",{class:"preview-button",onClick:a},[$(k,{class:"icon",path:g(Zt),width:"20",height:"20",fill:"#5A677A"},null,8,["path"]),qt(" Preview ")]),$(fo,{model:g(c)},null,8,["model"])]),default:ye(()=>[$($t,{title:"Layout editor"},{default:ye(()=>[g(f)?(b(),fe(Zr,{key:0,workspace:g(s),dash:g(c),"dash-player-state":g(f),params:g(n).query,onNavigate:o,onChangePreview:l,onCreateVariable:v},null,8,["workspace","dash","dash-player-state","params"])):j("",!0)]),_:1}),$($t,{title:"Settings"},{default:ye(()=>[$(_o,{dash:g(c)},null,8,["dash"])]),_:1})]),_:1})),g(c)?(b(),fe(oo,{key:2,"dash-player-state":g(f)||void 0,runtime:"dashes",onRestart:u},null,8,["dash-player-state"])):j("",!0),$(ao,{"has-changes":(O=g(c))==null?void 0:O.hasChanges()},null,8,["has-changes"])])}}});const bn=q(Qr,[["__scopeId","data-v-da31a497"]]);export{bn as default};
//# sourceMappingURL=DashEditor.5e27fde9.js.map

import{d as Y,r as N,H as U,G as E,eB as q,F as J,eH as K,b as i,c as v,w as r,u as e,eG as Q,f as a,aq as F,ad as T,cr as W,bu as X,cF as S,eu as b,eC as Z,ew as P,eD as c,e as C,cN as ee,a_ as te,bR as ae,cn as le,t as se}from"./outputWidgets.bf2ccc30.js";import{A as I}from"./router.724280b3.js";import{B as ne}from"./build.0450eb53.js";import"./columns.6b6e9690.js";import{C as j}from"./gateway.e97424ce.js";import{a as re}from"./asyncComputed.89463d98.js";import{t as oe}from"./ant-design.f5a19e75.js";import{R as ue}from"./dayjs.a4712fc6.js";import{f as ie}from"./index.b048d0fb.js";import{A as de}from"./Title.b201b493.js";import{A as z,a as pe}from"./Text.733c8136.js";import{A as g,F as ce}from"./Base.08a90b2d.js";import{A as me,C as fe}from"./CollapsePanel.180f103d.js";import{A as k}from"./index.9df52947.js";import"./index.99b6e0a0.js";import"./record.72c168c7.js";import"./pubsub.4417aa45.js";import"./transButton.4ff5a2f3.js";import"./index.bb2e4f26.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[t]="8bc8a2f9-42bf-4ec4-8ebc-78d602b8f2c0",y._sentryDebugIdIdentifier="sentry-dbid-8bc8a2f9-42bf-4ec4-8ebc-78d602b8f2c0")}catch{}})();class ve{list(t){return j.post(`projects/${t.projectId}/builds/${t.buildId}/logs`,t)}filters(t){return j.get(`projects/${t}/log-filters`)}}const O=new ve;class A{constructor(t,d,m,h,w,x,_){this.executionId=t,this.runtimeType=d,this.runtimeName=m,this.payload=h,this.event=w,this.buildId=x,this.createdAt=_}static fromDTO(t){return new A(t.executionId,t.runtimeType,t.runtimeName,t.payload,t.event,t.buildId,new Date(t.createdAt))}static async list(t){const d=await O.list(t);return{total:d.total,logs:d.logs.map(A.fromDTO)}}static async filters(t){return O.filters(t)}}const ye={key:0},be=["textContent"],_e=["textContent"],ge=["textContent"],Ae=["textContent"],he=Y({__name:"Logs",setup(y){function t(n){return ie(n,new Date,{addSuffix:!0})}const d=N(1),m=N(10);U([d,m],([n,s])=>{d.value=n,m.value=s,B()});function h(n){return(n.event==="stderr"||n.event==="stdout")&&typeof n.payload.log=="string"&&n.payload.log.trim().length===0}const w=E(()=>{var n,s;return{runtimes:(n=f.value)==null?void 0:n.filters.runtimes.map(({runtimeName:p,runtimeType:u})=>({label:`[${u}] ${p}`,value:p})),events:(s=f.value)==null?void 0:s.filters.events.map(p=>({label:`[${p.runtimeType}] ${p.event}`,value:p.event}))}}),x=q(),_=x.params.projectId,o=J({selectedBuild:x.query.buildId||"latest",dateRange:void 0,search:"",runtimeNames:[],events:[]}),V=K.exports.debounce(async()=>{await B(),D.value=!1},500),D=N(!1);U(o,()=>{D.value=!0,d.value=1,V()});const G=E(()=>f.value?[{label:"Latest",value:"latest"},{label:"All",value:"all"},...f.value.builds.map(n=>({label:`${t(n.createdAt)} (${n.id.slice(0,8)})`,value:n.id}))]:[{label:"Latest",value:"latest"},{label:"All",value:"all"}]),H=n=>{o.selectedBuild=n,B()},{loading:M,result:f,refetch:B}=re(()=>{var n,s;return Promise.all([A.list({projectId:_,limit:m.value,offset:(d.value-1)*m.value,buildId:o.selectedBuild,from:(n=o.dateRange)==null?void 0:n[0].toDate(),to:(s=o.dateRange)==null?void 0:s[1].toDate(),search:o.search,runtimeNames:o.runtimeNames,events:o.events}),ne.list(_),A.filters(_)]).then(([{total:p,logs:u},l,R])=>Q({total:p,logs:u,builds:l,filters:R}))});return(n,s)=>(i(),v(e(S),{direction:"vertical"},{default:r(()=>{var p;return[a(e(de),null,{default:r(()=>[F("Logs")]),_:1}),a(e(ce),{layout:"vertical"},{default:r(()=>[a(e(z),{gutter:10},{default:r(()=>[a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Build"},{default:r(()=>[a(e(T),{value:o.selectedBuild,"onUpdate:value":s[0]||(s[0]=u=>o.selectedBuild=u),options:G.value,"option-label":"label","option-value":"value",filter:!1,onChange:H},null,8,["value","options"])]),_:1})]),_:1}),a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Date"},{default:r(()=>[a(e(ue),{value:o.dateRange,"onUpdate:value":s[1]||(s[1]=u=>o.dateRange=u),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(z),{gutter:10},{default:r(()=>[a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Runtimes"},{default:r(()=>[a(e(T),{value:o.runtimeNames,"onUpdate:value":s[2]||(s[2]=u=>o.runtimeNames=u),options:w.value.runtimes,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1}),a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Events"},{default:r(()=>[a(e(T),{value:o.events,"onUpdate:value":s[3]||(s[3]=u=>o.events=u),options:w.value.events,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),a(e(g),{label:"Search"},{default:r(()=>[a(e(W),{value:o.search,"onUpdate:value":s[4]||(s[4]=u=>o.search=u),type:"search"},null,8,["value"])]),_:1})]),_:1}),e(M)||D.value?(i(),v(e(X),{key:0,style:{width:"100%"}})):(p=e(f))!=null&&p.logs.length?(i(),v(e(S),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>{var u;return[a(e(fe),{"data-source":(u=e(f))==null?void 0:u.logs},{default:r(()=>[(i(!0),b(te,null,Z(e(f).logs,(l,R)=>(i(),v(e(me),{key:R,disabled:h(l)},{extra:r(()=>[h(l)?(i(),v(e(pe),{key:0},{default:r(()=>[F(" EMPTY ")]),_:1})):P("",!0)]),header:r(()=>[a(e(S),null,{default:r(()=>[o.selectedBuild=="all"?(i(),b("span",ye,c(l.buildId.split("-")[0]),1)):P("",!0),a(e(k),{type:"vertical"}),C("span",null,c(t(l.createdAt)),1),a(e(k),{type:"vertical"}),C("span",null," ["+c(l.runtimeType)+"] "+c(l.runtimeName),1),a(e(k),{type:"vertical"}),C("span",null,c(l.executionId.slice(0,8)),1),a(e(k),{type:"vertical"}),C("span",null,c(l.event),1)]),_:2},1024)]),default:r(()=>{var $,L;return[l.event==="stdout"?(i(),b("pre",{key:0,class:"stdio-log",textContent:c(l.payload.log)},null,8,be)):l.event==="stderr"?(i(),b("pre",{key:1,class:"stdio-log",textContent:c(l.payload.log)},null,8,_e)):l.event==="program-start-failed"?(i(),b("pre",{key:2,textContent:c(l.payload.error)},null,8,ge)):l.event==="widgets-computed"&&((L=($=l.payload.errors)==null?void 0:$.general)==null?void 0:L.repr)?(i(),b("pre",{key:3,textContent:c(l.payload.errors.general.repr)},null,8,Ae)):(i(),v(e(ee),{key:4,"tree-data":e(oe)(l.payload)},null,8,["tree-data"]))]}),_:2},1032,["disabled"]))),128))]),_:1},8,["data-source"]),a(e(ae),{current:d.value,"onUpdate:current":s[5]||(s[5]=l=>d.value=l),"page-size":m.value,"onUpdate:pageSize":s[6]||(s[6]=l=>m.value=l),"show-size-changer":"",total:e(f).total},null,8,["current","page-size","total"])]}),_:1})):(i(),v(e(le),{key:2}))]}),_:1}))}});const Oe=se(he,[["__scopeId","data-v-a66b47d0"]]);export{Oe as default};
//# sourceMappingURL=Logs.e6fea006.js.map

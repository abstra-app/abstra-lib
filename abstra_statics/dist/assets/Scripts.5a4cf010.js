import{d as x,G as k,a as se,b as p,c as f,w as t,f as a,u as e,aq as u,eD as M,bh as ge,bf as Z,ey as we,bM as be,ex as C,v as z,e as h,eE as Y,eF as K,ev as U,ai as ke,br as H,ah as O,eL as P,H as Se,r as L,bH as ee,bO as J,ad as Ce,eC as oe,cB as Fe,bq as W,eM as Ie,eA as Te,c4 as xe}from"./outputWidgets.396f5ce1.js";import{F as N}from"./forms.946dd517.js";import{H as $}from"./hooks.c40c644f.js";import{S as E,J as D}from"./scripts.390d9638.js";import{W as le}from"./workspaces.784fafc7.js";import{a as q}from"./asyncComputed.95737324.js";import{a as te}from"./ant-design.e656dd24.js";import{f as ne,h as ie,s as re,j as ce,b as Ne,d as $e}from"./icons.37b6f90f.js";import{A as I}from"./index.42fe3563.js";import"./index.03f66284.js";import{a as F}from"./Text.4e180dc2.js";import{C as pe}from"./Card.a208895c.js";import"./index.8b4185b0.js";import{a as Ae}from"./Base.ee1dde08.js";import{n as Me}from"./string.db77e9d6.js";import{A as V}from"./FormItem.a8de7296.js";import{A as Ue}from"./index.f0384574.js";import{F as ue}from"./Form.716e7fa5.js";import{M as Ee}from"./Modal.c02a2840.js";import"./record.1aff3d29.js";import"./pubsub.06faa612.js";import"./url.4e42e1d0.js";import"./index.b703167a.js";import"./index.e0b9f0d4.js";import"./TabPane.1f8c84b2.js";import"./hasIn.63a13365.js";import"./Link.70d4fc5a.js";import"./Title.819eb0fe.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[n]="831fd43e-ac45-4a30-830f-4670cde7cc4b",l._sentryDebugIdIdentifier="sentry-dbid-831fd43e-ac45-4a30-830f-4670cde7cc4b")}catch{}})();const De=x({__name:"ScriptCard",props:{script:{},workspace:{}},emits:["delete","go-to-script"],setup(l,{emit:n}){const s=l,d=async()=>{if(await te("Are you sure you want to delete this script?")){const r=await te("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});n("delete",s.script.id,r)}},v=()=>{s.script instanceof N&&n("go-to-script",s.script.id,"form"),s.script instanceof $&&n("go-to-script",s.script.id,"hook"),s.script instanceof E&&n("go-to-script",s.script.id,"script"),s.script instanceof D&&n("go-to-script",s.script.id,"job")},g=k(()=>{if(s.script instanceof N)return ne;if(s.script instanceof $)return ie;if(s.script instanceof E)return re;if(s.script instanceof D)return ce;throw new Error("Invalid script type")}),_=()=>{!s.script.file||!s.workspace||s.workspace.openFile(s.script.file)};return(r,m)=>{const w=se("icon");return p(),f(e(pe),{key:r.script.title,class:"script-card",onClick:v},{title:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(w,{path:g.value},null,8,["path"]),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[u(M(r.script.title),1)]),_:1})]),_:1})]),extra:t(()=>[a(e(be),{trigger:["click"],onClick:m[0]||(m[0]=we(()=>{},["stop"]))},{overlay:t(()=>[a(e(ge),null,{default:t(()=>[a(e(Z),{onClick:_},{default:t(()=>[u("Open .py file")]),_:1}),a(e(Z),{danger:"",onClick:d},{default:t(()=>[u("Delete")]),_:1})]),_:1})]),default:t(()=>[a(w,{path:e(Ne),style:{cursor:"pointer"}},null,8,["path"])]),_:1})]),default:t(()=>[r.script instanceof e(N)||r.script instanceof e($)?(p(),f(e(I),{key:0,gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[u("URL path:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[u("/"+M(r.script.path),1)]),_:1})]),_:1})):C("",!0),a(e(I),{gap:"12"},{default:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[u("Code:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"125px"}},{default:t(()=>[u(M(r.script.file),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const je=z(De,[["__scopeId","data-v-f082da55"]]),Be=l=>(Y("data-v-e7ad5242"),l=l(),K(),l),He={class:"card-content"},Oe=Be(()=>h("span",null,"New script",-1)),Pe=x({__name:"NewScriptCard",setup(l){return(n,s)=>{const d=se("icon");return p(),f(e(pe),{class:"new-script-card"},{default:t(()=>[h("div",He,[a(d,{path:e($e)},null,8,["path"]),Oe])]),_:1})}}});const Ve=z(Pe,[["__scopeId","data-v-e7ad5242"]]),G=l=>(Y("data-v-f04c0fce"),l=l(),K(),l),qe={key:0,class:"choose-type"},ze={class:"option-content"},Ge=G(()=>h("span",null,"Forms",-1)),Re={class:"option-content"},Je=G(()=>h("span",null,"Hooks",-1)),Le={class:"option-content"},We=G(()=>h("span",null,"Scripts",-1)),Ye={class:"option-content"},Ke=G(()=>h("span",null,"Jobs",-1)),Qe=x({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(l,{emit:n}){const s=l,d=k(()=>s.state.type==="form"?"#fff":void 0),v=k(()=>s.state.type==="hook"?"#fff":void 0),g=k(()=>s.state.type==="script"?"#fff":void 0),_=k(()=>s.state.type==="job"?"#fff":void 0),r=m=>n("choose-type",m);return(m,w)=>m.state.state==="choosing-type"?(p(),U("div",qe,[a(e(I),{vertical:"",gap:"30"},{default:t(()=>[a(e(Ae),null,{default:t(()=>[u("Choose your script type")]),_:1}),a(e(ke),{value:m.state.type,"onUpdate:value":[w[0]||(w[0]=o=>m.state.type=o),r],size:"large","button-style":"solid"},{default:t(()=>[a(e(I),{gap:"24",vertical:""},{default:t(()=>[a(e(I),{gap:"24"},{default:t(()=>[a(e(H),{placement:"left"},{title:t(()=>[u(" Use to collect user input via interaction with a form interface ")]),default:t(()=>[a(e(O),{value:"form",class:"option"},{default:t(()=>[h("div",ze,[(p(),f(P,{key:d.value,path:e(ne),fill:d.value},null,8,["path","fill"])),Ge])]),_:1})]),_:1}),a(e(H),{placement:"right"},{title:t(()=>[u("Use to build endpoints triggered by HTTP requests")]),default:t(()=>[a(e(O),{value:"hook",class:"option"},{default:t(()=>[h("div",Re,[(p(),f(P,{key:v.value,path:e(ie),fill:v.value},null,8,["path","fill"])),Je])]),_:1})]),_:1})]),_:1}),a(e(I),{gap:"24"},{default:t(()=>[a(e(H),{placement:"left"},{title:t(()=>[u("Use to write plain Python scripts")]),default:t(()=>[a(e(O),{value:"script",class:"option"},{default:t(()=>[h("div",Le,[(p(),f(P,{key:g.value,path:e(re),fill:g.value},null,8,["path","fill"])),We])]),_:1})]),_:1}),a(e(H),{placement:"right"},{title:t(()=>[u("Use to schedule your script execution periodically")]),default:t(()=>[a(e(O),{value:"job",class:"option"},{default:t(()=>[h("div",Ye,[(p(),f(P,{key:_.value,path:e(ce),fill:_.value},null,8,["path","fill"])),Ke])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):C("",!0)}});const Xe=z(Qe,[["__scopeId","data-v-f04c0fce"]]);function Q(l){return l.replace(/\.py$/,"").trim().length===0?{valid:!1,reason:"File name cannot be empty"}:l.length>255?{valid:!1,reason:"File name cannot be longer than 255 characters"}:l.includes("/")?{valid:!1,reason:"File name cannot contain slashes"}:l.endsWith(".py")?{valid:!0}:{valid:!1,reason:"File name must end with .py"}}function Ze(l){if(!Q(l).valid)throw new Error("Invalid filename");const n=l.slice(0,-3);return Me(n,!0,!0)+".py"}const et=h("br",null,null,-1),tt=x({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(l,{emit:n}){const s=l,{result:d}=q(()=>fetch("/_editor/api/workspace/root").then(S=>S.text()));Se(()=>s.state.stage.filename,()=>r.value=s.state.stage.filename);const v=k(()=>s.state.state!=="creating"?"":`${d.value}/${r.value}`),g=k(()=>s.state.state!=="creating"?"":`${s.state.stage.type[0].toUpperCase()+s.state.stage.type.slice(1)} title`),_=S=>n("update-name",S),r=L(s.state.stage.filename),{result:m,refetch:w}=q(()=>le.checkFile(r.value)),o=()=>{c.value.valid?n("update-file",Ze(r.value)):n("update-file",r.value),w()},c=k(()=>Q(r.value));return(S,A)=>(p(),f(e(ue),{layout:"vertical"},{default:t(()=>{var j;return[a(e(V),{label:g.value,required:!0},{default:t(()=>[a(e(ee),{value:S.state.stage.title,"onUpdate:value":_},null,8,["value"])]),_:1},8,["label"]),a(e(V),{label:"Generated file",required:!0,"validate-status":c.value.valid?"success":"error",help:c.value.valid?void 0:c.value.reason},{default:t(()=>[a(e(ee),{value:r.value,"onUpdate:value":A[0]||(A[0]=R=>r.value=R),onBlur:o},null,8,["value"])]),_:1},8,["validate-status","help"]),a(e(V),null,{default:t(()=>[a(e(F),null,{default:t(()=>[u(" Your script will be generated at: ")]),_:1}),et,a(e(F),{code:""},{default:t(()=>[u(M(v.value),1)]),_:1})]),_:1}),(j=e(m))!=null&&j.exists?(p(),f(e(Ue),{key:0,type:"warning"},{message:t(()=>[a(e(F),null,{default:t(()=>[a(e(F),{strong:""},{default:t(()=>[u("Warning:")]),_:1}),u(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):C("",!0)]}),_:1}))}}),at=x({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(l,{emit:n}){const s=l,d=c=>n("update-name",c),v=c=>n("update-file",c),g=()=>n("close"),_=c=>n("choose-type",c),r=()=>n("next-step"),m=()=>n("previous-step"),w=()=>n("create-script"),o=k(()=>!(s.state.state!=="creating"||!Q(s.state.stage.filename).valid||!s.state.stage.title));return(c,S)=>(p(),f(e(Ee),{open:c.open,title:"Create a new script",onCancel:g},{footer:t(()=>[c.state.state==="creating"?(p(),f(e(J),{key:0,onClick:m},{default:t(()=>[u("Previous")]),_:1})):C("",!0),c.state.state==="creating"?(p(),f(e(J),{key:1,type:"primary",disabled:!o.value,onClick:w},{default:t(()=>[u(" Create ")]),_:1},8,["disabled"])):C("",!0),c.state.state==="choosing-type"?(p(),f(e(J),{key:2,type:"primary",disabled:!c.state.type,onClick:r},{default:t(()=>[u(" Next ")]),_:1},8,["disabled"])):C("",!0)]),default:t(()=>[c.state.state==="choosing-type"?(p(),f(Xe,{key:0,state:c.state,onChooseType:_},null,8,["state"])):C("",!0),c.state.state==="creating"?(p(),f(tt,{key:1,state:c.state,onUpdateName:d,onUpdateFile:v},null,8,["state"])):C("",!0)]),_:1},8,["open"]))}}),st=x({__name:"FilterScripts",emits:["update-filter"],setup(l,{emit:n}){const s=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],d=v=>n("update-filter",v);return(v,g)=>(p(),f(e(ue),null,{default:t(()=>[a(e(V),{label:"Script type"},{default:t(()=>[a(e(Ce),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":d},{default:t(()=>[(p(),U(W,null,oe(s,_=>a(e(Fe),{key:_.value,value:_.value},{default:t(()=>[u(M(_.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),ot=l=>(Y("data-v-cdca4f3f"),l=l(),K(),l),lt={key:0},nt=ot(()=>h("span",null,"loading",-1)),it=[nt],ae=100,rt=x({__name:"Scripts",setup(l){Ie(i=>({"582f9454":me()}));const n=Te(),{loading:s,result:d,refetch:v}=q(async()=>Promise.all([N.list(),$.list(),D.list(),E.list()]).then(([i,b,y,T])=>[...i,...b,...y,...T])),g=i=>{if(i instanceof N)return"form";if(i instanceof $)return"hook";if(i instanceof D)return"job";if(i instanceof E)return"script";throw new Error("Invalid script type")},{result:_}=q(()=>le.get()),r=L([]),m=i=>{r.value=i},w=k(()=>d.value?r.value.length===0?d.value:d.value.filter(i=>r.value.includes(g(i))):[]),o=L({state:"idle"}),c=k(()=>o.value.state==="choosing-type"||o.value.state==="creating"),S=()=>{o.value={state:"choosing-type",type:null}},A=()=>{o.value={state:"idle"}},j=i=>{o.value.state==="choosing-type"&&(o.value={state:"choosing-type",type:i})},R=()=>{o.value.state==="choosing-type"&&o.value.type!==null&&(o.value={state:"creating",stage:{type:o.value.type,title:`Untitled ${o.value.type}`,filename:`untitled_${o.value.type}.py`}})},de=()=>{o.value.state==="creating"&&(o.value={state:"choosing-type",type:o.value.stage.type})},fe=i=>{o.value.state==="creating"&&(o.value.stage.title=i)},_e=i=>{o.value.state==="creating"&&(o.value.stage.filename=i)},ve=async(i,b)=>{var y,T;await((T=(y=d.value)==null?void 0:y.find(B=>B.id===i))==null?void 0:T.delete(b)),await v()},me=()=>(ae/1e3).toString()+"s",ye=async()=>{if(o.value.state!=="creating")return;let i;if(o.value.stage.type==="form"?i=await N.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="hook"?i=await $.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="job"?i=await D.create(o.value.stage.title,o.value.stage.filename):o.value.stage.type==="script"&&(i=await E.create(o.value.stage.title,o.value.stage.filename)),!i)throw new Error("Failed to create script");const b=i.id,y=o.value.stage.type;A(),await v(),setTimeout(()=>{X(b,y)},ae)},X=(i,b)=>{var y,T;if(b==="form"&&n.push({name:"formEditor",params:{id:i}}),b==="hook"&&n.push({name:"hookEditor",params:{id:i}}),b==="script"){const B=(y=d.value)==null?void 0:y.find(he=>he.id===i);if(!B)return;(T=_.value)==null||T.openFile(B.file)}b==="job"&&n.push({name:"jobEditor",params:{id:i}})};return(i,b)=>(p(),U(W,null,[e(s)?(p(),U("span",lt,it)):C("",!0),a(st,{onUpdateFilter:m}),a(e(I),{wrap:"wrap",gap:"large",class:"scripts-container"},{default:t(()=>[a(xe,null,{default:t(()=>[(p(!0),U(W,null,oe(w.value,y=>(p(),f(je,{key:y.title,script:y,workspace:e(_),onDelete:ve,onGoToScript:X},null,8,["script","workspace"]))),128))]),_:1}),a(Ve,{onClick:S})]),_:1}),a(at,{open:c.value,state:o.value,onClose:A,onChooseType:j,onNextStep:R,onPreviousStep:de,onCreateScript:ye,onUpdateName:fe,onUpdateFile:_e},null,8,["open","state"])],64))}});const Bt=z(rt,[["__scopeId","data-v-cdca4f3f"]]);export{Bt as default};
//# sourceMappingURL=Scripts.5a4cf010.js.map

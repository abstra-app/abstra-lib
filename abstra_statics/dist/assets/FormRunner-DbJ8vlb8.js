import{u as useUserStore}from"./userStore-8KWLNEVR.js";import{a as defineComponent,c as computed,i as inject,b as createElementBlock,f as renderSlot,g as createCommentVNode,h as createBaseVNode,m as mergeProps,e as openBlock,a9 as lodashExports,ae as i18nProvider,p as createBlock,R as resolveDynamicComponent,aN as _export_sfc,u as unref,w as withCtx,S as createTextVNode,U as toDisplayString,r as ref,H as watch,j as createVNode,E as normalizeClass,ct as StartWidget,cu as EndWidget,cv as ErrorWidget,M as Fragment,W as renderList,bP as StyleProvider,B as Button,b6 as withKeys}from"./jwt-decode.esm-X_JHyrHe.js";import{_ as _sfc_main$3}from"./Login.vue_vue_type_script_setup_true_lang-Deo0-Qn1.js";import{u as useWorkspaceStore}from"./workspaceStore-CdgowxsI.js";import{L as LoadingIndicator}from"./CircularLoading-BTQsHatp.js";import{S as Steps}from"./Steps-D5sbEdud.js";import{W as Watermark}from"./Watermark-DwCQYBZS.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="7ed9d1cd-ad61-4398-8c49-d6e429832163",a._sentryDebugIdIdentifier="sentry-dbid-7ed9d1cd-ad61-4398-8c49-d6e429832163")}catch{}})();const Z=["width","height","fill","transform"],g={key:0},m=createBaseVNode("path",{d:"M112,36a12,12,0,0,0-12,12V60H24A20,20,0,0,0,4,80v96a20,20,0,0,0,20,20h76v12a12,12,0,0,0,24,0V48A12,12,0,0,0,112,36ZM28,172V84h72v88ZM252,80v96a20,20,0,0,1-20,20H152a12,12,0,0,1,0-24h76V84H152a12,12,0,0,1,0-24h80A20,20,0,0,1,252,80ZM88,112a12,12,0,0,1-12,12v20a12,12,0,0,1-24,0V124a12,12,0,0,1,0-24H76A12,12,0,0,1,88,112Z"},null,-1),y=[m],f={key:1},w=createBaseVNode("path",{d:"M240,80v96a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H232A8,8,0,0,1,240,80Z",opacity:"0.2"},null,-1),k=createBaseVNode("path",{d:"M112,40a8,8,0,0,0-8,8V64H24A16,16,0,0,0,8,80v96a16,16,0,0,0,16,16h80v16a8,8,0,0,0,16,0V48A8,8,0,0,0,112,40ZM24,176V80h80v96ZM248,80v96a16,16,0,0,1-16,16H144a8,8,0,0,1,0-16h88V80H144a8,8,0,0,1,0-16h88A16,16,0,0,1,248,80ZM88,112a8,8,0,0,1-8,8H72v24a8,8,0,0,1-16,0V120H48a8,8,0,0,1,0-16H80A8,8,0,0,1,88,112Z"},null,-1),x=[w,k],S={key:2},z=createBaseVNode("path",{d:"M248,80v96a16,16,0,0,1-16,16H140a4,4,0,0,1-4-4V68a4,4,0,0,1,4-4h92A16,16,0,0,1,248,80ZM120,48V208a8,8,0,0,1-16,0V192H24A16,16,0,0,1,8,176V80A16,16,0,0,1,24,64h80V48a8,8,0,0,1,16,0ZM88,112a8,8,0,0,0-8-8H48a8,8,0,0,0,0,16h8v24a8,8,0,0,0,16,0V120h8A8,8,0,0,0,88,112Z"},null,-1),C=[z],B={key:3},b=createBaseVNode("path",{d:"M112,42a6,6,0,0,0-6,6V66H24A14,14,0,0,0,10,80v96a14,14,0,0,0,14,14h82v18a6,6,0,0,0,12,0V48A6,6,0,0,0,112,42ZM24,178a2,2,0,0,1-2-2V80a2,2,0,0,1,2-2h82V178ZM246,80v96a14,14,0,0,1-14,14H144a6,6,0,0,1,0-12h88a2,2,0,0,0,2-2V80a2,2,0,0,0-2-2H144a6,6,0,0,1,0-12h88A14,14,0,0,1,246,80ZM86,112a6,6,0,0,1-6,6H70v26a6,6,0,0,1-12,0V118H48a6,6,0,0,1,0-12H80A6,6,0,0,1,86,112Z"},null,-1),N=[b],E={key:4},P=createBaseVNode("path",{d:"M112,40a8,8,0,0,0-8,8V64H24A16,16,0,0,0,8,80v96a16,16,0,0,0,16,16h80v16a8,8,0,0,0,16,0V48A8,8,0,0,0,112,40ZM24,176V80h80v96ZM248,80v96a16,16,0,0,1-16,16H144a8,8,0,0,1,0-16h88V80H144a8,8,0,0,1,0-16h88A16,16,0,0,1,248,80ZM88,112a8,8,0,0,1-8,8H72v24a8,8,0,0,1-16,0V120H48a8,8,0,0,1,0-16H80A8,8,0,0,1,88,112Z"},null,-1),W=[P],$={key:5},j=createBaseVNode("path",{d:"M112,44a4,4,0,0,0-4,4V68H24A12,12,0,0,0,12,80v96a12,12,0,0,0,12,12h84v20a4,4,0,0,0,8,0V48A4,4,0,0,0,112,44ZM24,180a4,4,0,0,1-4-4V80a4,4,0,0,1,4-4h84V180ZM244,80v96a12,12,0,0,1-12,12H144a4,4,0,0,1,0-8h88a4,4,0,0,0,4-4V80a4,4,0,0,0-4-4H144a4,4,0,0,1,0-8h88A12,12,0,0,1,244,80ZM84,112a4,4,0,0,1-4,4H68v28a4,4,0,0,1-8,0V116H48a4,4,0,0,1,0-8H80A4,4,0,0,1,84,112Z"},null,-1),T=[j],q={name:"PhTextbox"},G=defineComponent({...q,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(a){const e=a,t=inject("weight","regular"),n=inject("size","1em"),o=inject("color","currentColor"),r=inject("mirrored",!1),l=computed(()=>e.weight??t),h=computed(()=>e.size??n),p=computed(()=>e.color??o),u=computed(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:r?"scale(-1, 1)":void 0);return(v,M)=>(openBlock(),createElementBlock("svg",mergeProps({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:p.value,transform:u.value},v.$attrs),[renderSlot(v.$slots,"default"),l.value==="bold"?(openBlock(),createElementBlock("g",g,y)):l.value==="duotone"?(openBlock(),createElementBlock("g",f,x)):l.value==="fill"?(openBlock(),createElementBlock("g",S,C)):l.value==="light"?(openBlock(),createElementBlock("g",B,N)):l.value==="regular"?(openBlock(),createElementBlock("g",E,W)):l.value==="thin"?(openBlock(),createElementBlock("g",$,T)):createCommentVNode("",!0)],16,Z))}}),WS_CLOSING_STATES=[WebSocket.CLOSING,WebSocket.CLOSED],WS_CUSTOM_CLOSING_REASONS={FRONTEND_FORM_RESTART:4e3};class FormConnectionManager{constructor(e,t,n){this.formId=e,this.environment=t,this.userQueryParams=n}ws=null;heartbeatInterval;isConnecting=!1;onOpen=null;onMessage=null;onClose=null;get url(){const e=location.protocol==="https:"?"wss:":"ws:",t=this.environment=="editor"?"_editor/api/forms/socket":"_socket",n=new URLSearchParams({id:this.formId,...this.userQueryParams});return`${e}//${location.host}/${t}?${n}`}handleOpen(e){if(!this.onOpen)throw new Error("onOpen is not set");this.onOpen(),e()}handleClose(e){(e.code===1006||!e.wasClean)&&clearInterval(this.heartbeatInterval),this.onClose&&!this.isConnecting&&this.onClose(e)}handleMessage(e){if(!this.onMessage)throw new Error("onMessage is not set");const t=JSON.parse(e.data);this.onMessage(t)}sendHeartbeat(){!this.ws||this.ws.readyState!==this.ws.OPEN||this.send({type:"execution:heartbeat"})}async waitForConnection(e=5e3){const t=Date.now();for(;;){if(Date.now()-t>e)throw new Error("WebSocket connection timeout");if(!this.ws)throw new Error("WebSocket connection lost");if(this.ws.readyState===WebSocket.OPEN)return;if(this.ws.readyState===WebSocket.CLOSED||this.ws.readyState===WebSocket.CLOSING)throw new Error("WebSocket connection failed");await new Promise(n=>setTimeout(n,100))}}async send(e){if(!this.ws)throw new Error(`[FormRunnerController] failed sending msg ${e.type}: websocket is not connected`);if(WS_CLOSING_STATES.includes(this.ws.readyState)&&await this.newConnection(),this.ws.readyState===WebSocket.CONNECTING&&await this.waitForConnection(),this.ws&&this.ws.readyState===WebSocket.OPEN)this.ws.send(JSON.stringify(e));else throw new Error(`[FormRunnerController] failed sending msg ${e.type}: websocket is not in open state`)}async close(e){this.ws&&this.ws.close(WS_CUSTOM_CLOSING_REASONS[e],e)}async forceClose(){this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(JSON.stringify({type:"kill"})),this.ws.close())}async newConnection(e=3,t){if(e!=0)return this.isConnecting=!0,new Promise((n,o)=>{clearInterval(this.heartbeatInterval),this.ws=new WebSocket(this.url,t),this.ws.onopen=()=>this.handleOpen(n),this.ws.onclose=r=>{this.handleClose(r),o(r)},this.ws.onmessage=r=>this.handleMessage(r),this.heartbeatInterval=setInterval(()=>this.sendHeartbeat(),2e3)}).catch(()=>new Promise(n=>setTimeout(n,1e3)).then(()=>this.newConnection(e-1,t))).finally(()=>{this.isConnecting=!1})}isEditorConnection(){return this.environment==="editor"}}function isInputWidget(a){return"key"in a&&"value"in a&&"errors"in a}const executeCode=($context,code)=>{let evaluatedCode;try{evaluatedCode=eval(code)}catch(a){throw console.error(`[Error: execute_js]: ${a.message}, context: ${$context}`),a}return isSerializable(evaluatedCode)?evaluatedCode:null};async function executeJs(a){return{type:"execute-js:response",value:await executeCode(a.context,a.code)}}const isSerializable=a=>{try{return JSON.stringify(a),!0}catch{return!1}},FORM_END_STATES=["default-end","page-end","error"],FORM_RUNNING_STATES=["authenticating","page","loading"];class FormRunnerController{connectionManager;logService;formRunnerData;formState;touchedWidgets={};messageSeq=0;executionId=null;onFormStart;onFormEnd;onRedirect;onStackTraceUpdate;onStateUpdate;userStore;responseHistory=[];lastResponseHistory=[];handlers={"execution:started":[e=>this.handleExecutionStartedMessage(e)],"execution:ended":[e=>this.handleExecutionEndedMessage(e)],"form:render":[e=>this.handleRenderMessage(e)],"form:mount-page":[e=>this.handleMountPageMessage(e)],"form:update-page":[e=>this.handleUpdatePageMessage(e)],"auth:require-info":[e=>this.handleAuthRequireInfoMessage(e)],"auth:invalid-jwt":[e=>this.handleAuthInvalidJWTMessage(e)],"auth:valid-jwt":[e=>this.handleAuthValidTokenMessage(e)],"redirect:request":[e=>this.handleRedirectRequestMessage(e)],"execute-js:request":[e=>this.handleExecuteJSRequestMessage(e)]};constructor({formRunnerData:e,logService:t,connectionManager:n,onFormStart:o,onFormEnd:r,onRedirect:l,onStateUpdate:h,onStackTraceUpdate:p}){if(this.formRunnerData=e,this.logService=t,this.connectionManager=n,this.onFormStart=o,this.onFormEnd=r,this.onRedirect=l,this.onStateUpdate=h,this.onStackTraceUpdate=p,this.userStore=useUserStore(),this.connectionManager.onOpen=()=>this.handleConnectionOpen(),this.connectionManager.onMessage=u=>this.handleMessageReceived(u),this.connectionManager.onClose=u=>this.handleConnectionClose(u),this.formRunnerData.autoStart&&!this.connectionManager.isEditorConnection()){this.formState={type:"loading"},this.start();return}this.formState={type:"waiting",actions:[this.getStartAction()]}}get publicLogService(){return this.logService}start=async()=>{this.setFormState({type:"loading"}),await this.connectionManager.newConnection(3,this.userStore.wsAuthHeaders)};resetForm=async()=>{this.logService?.log({type:"stdout",log:"[Form reloaded]"}),await this.connectionManager.close("FRONTEND_FORM_RESTART"),this.resetState()};reconnect=async()=>{this.resetState(),await this.start()};stop=async()=>{await this.connectionManager.forceClose()};resetState=()=>{this.messageSeq=0,this.setFormState({type:"waiting",actions:[this.getStartAction()]})};debouncedFinishPageLoading=lodashExports.debounce(()=>{if(this.formState.type!=="page")throw new Error("Can't start loading while not in render-page state");this.setFormState({...this.formState,actions:this.formState.actions.map(e=>({...e,loading:!1}))})},500);getStartAction=()=>this.actionFromMessage({key:"start",label:this.formRunnerData.startButtonText||i18nProvider.translateIfFound("i18n_start_action",this.formRunnerData.language)});getEndStateActions=()=>[];getState=()=>({formState:this.formState});handleConnectionOpen=()=>{this.connectionManager.send({type:"execution:start"})};fullWidthFromMessage(e){return e.some(t=>"fullWidth"in t&&t.fullWidth)}widgetFromMessage=(e,t)=>{if(isInputWidget(e)){"value"in e&&e.value&&(this.touchedWidgets[e.key]=!0);const n=e.errors.map(o=>i18nProvider.translateIfFound(o,this.formRunnerData.language,e));return{...e,input:!0,_pythonErrors:n,errors:n}}return{...e,input:!1,_pythonErrors:[],errors:[],key:e.type+t}};actionFromMessage=({key:e,label:t})=>({key:e,label:i18nProvider.translateIfFound(t,this.formRunnerData.language,this.formRunnerData),disabled:!1,loading:!1});getAutofillVisibilty=e=>this.lastResponseHistory.length===0?!1:this.lastResponseHistory[0].some(t=>e.find(n=>n.key===t.key&&n.type===t.type&&"value"in n));handleAutofillClick=()=>{this.lastResponseHistory[0]&&this.formState.type==="page"&&(this.lastResponseHistory[0].forEach(t=>{"widgets"in this.formState&&this.formState.widgets.find(o=>o.key===t.key&&o.type===t.type)&&"value"in t&&this.updateWidgetValue(t.key,t.value)}),this.setFormState({...this.formState,showAutofill:!1}))};async handleExecutionStartedMessage(e){this.executionId=e.executionId,this.onFormStart()}handleRenderMessage(e){if(e.seq!==this.messageSeq)return;const t=e.widgets.map(this.widgetFromMessage);if(e.endPage){this.setFormState({...this.formState,type:"page-end",actions:this.getEndStateActions(),widgets:t,fullWidth:this.fullWidthFromMessage(e.widgets),stepsInfo:e.stepsInfo,refreshKey:e.stepsInfo.current.toString(),showAutofill:this.getAutofillVisibilty(t)});return}let n=[{key:"back",label:"i18n_back_action"},{key:"next",label:"i18n_next_action"}];e.actions&&(n=e.actions),this.setFormState({type:"page",widgets:t,actions:n.map(this.actionFromMessage),fullWidth:this.fullWidthFromMessage(e.widgets),stepsInfo:e.stepsInfo,refreshKey:e.stepsInfo.current.toString(),showAutofill:this.getAutofillVisibilty(t)})}handleAuthComplete=e=>{e&&this.formState.type==="authenticating"&&this.sendAuthSavedJWT(e)};async handleExecuteJSRequestMessage(e){const t=await executeJs(e);this.connectionManager.send(t)}async handleAuthRequireInfoMessage(e){const{jwt:t,isJWTValid:n}=this.userStore;if(t&&n()&&!e.refresh){this.sendAuthSavedJWT(t);return}this.setFormState({type:"authenticating"})}async handleAuthInvalidJWTMessage(e){this.setFormState({type:"authenticating"})}async handleAuthValidTokenMessage(e){}async handleRedirectRequestMessage(e){this.onRedirect(e.url,e.queryParams)}handleMountPageMessage(e){const t=e.widgets.map(this.widgetFromMessage);if(e.endProgram){this.setFormState({type:"page-end",actions:this.getEndStateActions(),widgets:t,fullWidth:this.fullWidthFromMessage(e.widgets),stepsInfo:e.steps,refreshKey:Date.now().toString(),showAutofill:this.getAutofillVisibilty(t),legacy:!0});return}this.setFormState({type:"page",widgets:t,actions:e.actions?.map(n=>this.actionFromMessage({key:n,label:n}))??[],fullWidth:this.fullWidthFromMessage(e.widgets),stepsInfo:e.steps,refreshKey:Date.now().toString(),showAutofill:this.getAutofillVisibilty(t),legacy:!0})}async handleUpdatePageMessage(e){if(e.seq===this.messageSeq){if(this.formState.type!=="page")throw new Error("Received form:update-page message while not in render-page state");this.setFormState({...this.formState,error:{message:e.validation.message,status:e.validation.status},widgets:e.widgets.map(this.widgetFromMessage),actions:this.formState.actions.map(t=>({...t,disabled:this.shouldDisableAction(t,e)}))}),this.debouncedFinishPageLoading()}}shouldDisableAction(e,t){if(e.key==="i18n_back_action"||this.formState.type!=="page")return!1;const o=t.widgets.map(this.widgetFromMessage).some(l=>l.errors.length>0),r=t.validation.status===!1||!!t.validation.message;return o||r}async handleExecutionEndedMessage(e){this.lastResponseHistory=[...this.responseHistory],this.responseHistory=[],!FORM_END_STATES.includes(this.formState.type)&&(e.exitStatus==="SUCCESS"&&(this.setFormState({type:"default-end",actions:this.getEndStateActions()}),this.logService?.log({type:"stdout",log:"[Form run finished]"})),e.exitStatus==="EXCEPTION"&&this.setFormState({type:"error",message:e.exception,executionId:this.executionId}),this.onFormEnd())}handleMessageReceived=e=>{const t=this.handlers[e.type];if(!t)throw new Error(`No handler for message type ${e.type}`);if(t.forEach(n=>n(e)),e.debug&&this.onStackTraceUpdate){const n=e.type==="execution:ended";this.onStackTraceUpdate(e.debug.stack,n)}};sendFormNavigation(e,t,n){this.connectionManager.send({type:"form:navigation",payload:e,secrets:n,action:t?.key,seq:++this.messageSeq})}sendInput(e,t){this.connectionManager.send({type:"form:input",payload:e,secrets:t,seq:++this.messageSeq})}sendAuthSavedJWT(e){this.connectionManager.send({type:"auth:saved-jwt",jwt:e})}handleCloseAttempt(){return FORM_END_STATES.includes(this.formState.type)||this.formState.type==="waiting"?!1:(this.connectionManager.send({type:"debug:close-attempt"}),!0)}handleConnectionClose(e){e.code!==WS_CUSTOM_CLOSING_REASONS.FRONTEND_FORM_RESTART&&FORM_RUNNING_STATES.includes(this.formState.type)&&this.reconnect()}setFormState(e){this.formState=Object.freeze(e),this.onStateUpdate(e)}getSecrets(){return this.formState.type!=="page"?[]:this.formState.widgets.filter(e=>"secret"in e).reduce((e,t)=>"key"in t&&"secret"in t?[...e,{key:t.key,secret:t.secret}]:e,[])}setWidgetValidationFunction(e,t){if(this.formState.type!=="page")return;const n=this.formState.widgets.find(o=>"key"in o&&o.key===e);!n||!isInputWidget(n)||(n.validationFunction=t)}hasErrors(){return this.formState.type!=="page"?!1:this.formState.error?.status===!1||this.formState.widgets.some(e=>e.errors.length>0)}handleActionClick=async e=>{if(this.formState.type==="waiting")return this.start();if(this.formState.type==="page"){const t=e.key==="i18n_back_action";return this.hasErrors()&&!t?void 0:(this.setFormState({...this.formState,actions:this.formState.actions.map(n=>n.label===e.label?{...n,loading:!0}:n)}),this.lastResponseHistory.shift(),this.responseHistory.push(this.formState.widgets),this.sendFormNavigation(this.getWidgetValues(),e))}if(this.formState.type==="default-end"||this.formState.type==="page-end"){await this.resetForm(),await this.start();return}};getWidgetValue(e){if(this.formState.type!=="page")return null;const t=this.formState.widgets.find(n=>"key"in n&&n.key===e);if(!t||!isInputWidget(t))return null}getWidgetValues(){return this.formState.type!=="page"?{}:this.formState.widgets.reduce((e,t)=>("value"in t&&(this.touchedWidgets[t.key]||this.formState.legacy)&&(e[t.key]=t.value),e),{})}updateWidgetValue=(e,t)=>{if(this.formState.type!=="page")return;const n=this.formState.widgets.find(r=>"key"in r&&r.key===e);if(!n||!isInputWidget(n))return;this.touchedWidgets[e]=!0;const o=this.formState.widgets.map(r=>r.key===e?{...r,value:t}:r);this.setFormState({...this.formState,widgets:o}),this.sendInput(this.getWidgetValues(),this.getSecrets())};updateWidgetFrontendErrors=(e,t)=>{if(this.formState.type!=="page"||!this.formState.widgets.find(r=>r.key===e))return;const o=this.formState.widgets.map(r=>r.key===e?{...r,errors:r._pythonErrors.concat(t.map(l=>i18nProvider.translateIfFound(l,this.formRunnerData.language,r)))}:r);this.setFormState({...this.formState,widgets:o})}}const _hoisted_1$1={class:"outline-button"},_sfc_main$2=defineComponent({__name:"OutlineButton",props:{icon:{},noShadow:{type:Boolean},status:{}},setup(a){return(e,t)=>(openBlock(),createElementBlock("button",_hoisted_1$1,[a.icon?(openBlock(),createBlock(resolveDynamicComponent(a.icon),{key:0,class:"icon",color:"#fff"})):createCommentVNode("",!0),renderSlot(e.$slots,"default",{},void 0,!0)]))}}),OutlineButton=_export_sfc(_sfc_main$2,[["__scopeId","data-v-2d3b9e41"]]),_sfc_main$1=defineComponent({__name:"FormAutoFill",emits:["click"],setup(a,{emit:e}){const t=e;return(n,o)=>(openBlock(),createBlock(OutlineButton,{icon:unref(G),class:"form-auto-fill-btn",onClick:o[0]||(o[0]=r=>t("click"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(i18nProvider).translate("i18n_form_auto_fill_repeat_last_answer")),1)]),_:1},8,["icon"]))}}),FormAutoFill=_export_sfc(_sfc_main$1,[["__scopeId","data-v-8885e98e"]]),_hoisted_1={class:"center"},_hoisted_2={key:0,class:"loading-wrapper"},_hoisted_3={class:"form-wrapper"},_hoisted_4=["id"],_hoisted_5={key:4,class:"span-error"},_hoisted_6={key:0,class:"buttons"},_sfc_main=defineComponent({__name:"FormRunner",props:{formRunnerData:{},formState:{},isPreview:{type:Boolean},disabled:{type:Boolean}},emits:["action-clicked","auto-fill-clicked","update-widget-value","update-widget-errors","auth-complete"],setup(a,{emit:e}){const t=useWorkspaceStore(),n=computed(()=>t.state.workspace?.logoUrl||""),o=a,r=e,l=ref(null),h=ref({}),p=computed(()=>!o.formState||o.formState.type==="loading"),u=computed(()=>o.formState?.type==="authenticating"),v=computed(()=>o.formState?.type==="waiting"),M=computed(()=>o.formState?.type==="default-end"),A=computed(()=>o.formState?.type==="error"),R=computed(()=>o.isPreview&&o.formState?.type==="page"&&o.formState.showAutofill),V=computed(()=>o.formState?.type==="page"&&"stepsInfo"in o.formState&&!o.formState.stepsInfo?.disabled),I=computed(()=>{if(o.formState?.type==="page"&&"stepsInfo"in o.formState)return o.formState.stepsInfo}),D=computed(()=>o.formState?.type==="error"&&"executionId"in o.formState?o.formState.executionId:null),F=computed(()=>o.formState?.type==="page"&&o.formState.error&&o.formState.error.status===!1),H=computed(()=>!o.formState||!("widgets"in o.formState)?[]:o.formState.widgets),O=computed(()=>!o.formState||!("actions"in o.formState)?[]:o.formState.actions),U=computed(()=>o.formState&&"actions"in o.formState),L=computed(()=>!F.value||!("error"in o.formState)||!o.formState.error?"":o.formState.error.message||i18nProvider.translateIfFound("i18n_generic_validation_error",o.formRunnerData.language)),K=computed(()=>({"full-width":Q()})),J=()=>{l.value&&(l.value.scrollTop=0)},Q=()=>o.formState?.type==="page"?o.formState.fullWidth:o.formState?.type==="page-end"?o.formState.fullWidth&&o.formState.widgets.length>0:!1,X=(s,c)=>"key"in s?s.key:s.type+c,Y=s=>{const c="refreshKey"in o.formState?o.formState.refreshKey:0;return"key"in s?s.key+"_"+c:s.type+"_"+c},ee=s=>isInputWidget(s)&&s.value,te=(s,c)=>{"key"in s&&(h.value[s.key]=c)},oe=s=>({"next-button__disabled":s.disabled||s.loading}),ne=s=>s.disabled||s.loading;return watch(()=>o.formState,(s,c)=>{s.type==="page"&&c?.type==="page"&&s.refreshKey!==c.refreshKey&&J()}),(s,c)=>(openBlock(),createElementBlock("div",_hoisted_1,[R.value?(openBlock(),createBlock(FormAutoFill,{key:0,class:"auto-fill-btn",form:a.formRunnerData,style:{"z-index":1},onClick:c[0]||(c[0]=i=>r("auto-fill-clicked"))},null,8,["form"])):createCommentVNode("",!0),V.value?(openBlock(),createBlock(Steps,{key:1,"steps-info":I.value,"is-preview":a.isPreview},null,8,["steps-info","is-preview"])):createCommentVNode("",!0),createBaseVNode("main",{ref_key:"scrollableContainer",ref:l,class:normalizeClass([{disabled:a.disabled}]),style:{padding:"50px 0px","box-sizing":"border-box"}},[p.value?(openBlock(),createElementBlock("div",_hoisted_2,[createVNode(LoadingIndicator)])):u.value?(openBlock(),createBlock(_sfc_main$3,{key:1,locale:a.formRunnerData.language,"logo-url":n.value??void 0,"brand-name":a.formRunnerData.brandName??void 0,onDone:c[1]||(c[1]=i=>r("auth-complete",i))},null,8,["locale","logo-url","brand-name"])):(openBlock(),createElementBlock("div",{key:2,class:normalizeClass(["form",K.value])},[createBaseVNode("div",_hoisted_3,[v.value?(openBlock(),createBlock(StartWidget,{key:0,form:a.formRunnerData},null,8,["form"])):M.value?(openBlock(),createBlock(EndWidget,{key:1,"end-message":a.formRunnerData.endMessage,locale:a.formRunnerData.language},null,8,["end-message","locale"])):A.value?(openBlock(),createBlock(ErrorWidget,{key:2,"error-message":a.formRunnerData.errorMessage,"execution-id":D.value,locale:a.formRunnerData.language},null,8,["error-message","execution-id","locale"])):(openBlock(!0),createElementBlock(Fragment,{key:3},renderList(H.value,(i,_)=>(openBlock(),createElementBlock("div",{id:i.type+_,key:X(i,_),class:"widget"},[(openBlock(),createBlock(resolveDynamicComponent(i.type),{ref_for:!0,ref:d=>te(i,d),key:Y(i),value:ee(i),errors:i.errors,"user-props":i,legacy:a.formState.legacy,locale:a.formRunnerData.language,"onUpdate:value":d=>r("update-widget-value",i.key,d),"onUpdate:errors":d=>r("update-widget-errors",i.key,d)},null,40,["value","errors","user-props","legacy","locale","onUpdate:value","onUpdate:errors"])),(openBlock(!0),createElementBlock(Fragment,null,renderList(i.errors,d=>(openBlock(),createElementBlock("span",{key:d,class:"span-error"},toDisplayString(d),1))),128))],8,_hoisted_4))),128)),F.value?(openBlock(),createElementBlock("span",_hoisted_5,toDisplayString(L.value),1)):createCommentVNode("",!0)]),U.value?(openBlock(),createElementBlock("div",_hoisted_6,[createVNode(unref(StyleProvider),null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(O.value,i=>(openBlock(),createBlock(unref(Button),{key:i.key,class:normalizeClass(["next-button",oe(i)]),loading:i.loading,disabled:ne(i),onClick:_=>r("action-clicked",i),onKeydown:withKeys(_=>r("action-clicked",i),["enter"])},{default:withCtx(()=>[createTextVNode(toDisplayString(i.label),1)]),_:2},1032,["class","loading","disabled","onClick","onKeydown"]))),128))]),_:1})])):createCommentVNode("",!0)],2))],2),createVNode(Watermark,{"page-id":a.formRunnerData.id,locale:a.formRunnerData.language},null,8,["page-id","locale"])]))}}),FormRunner=_export_sfc(_sfc_main,[["__scopeId","data-v-4266401f"]]);export{FormRunnerController as F,FormConnectionManager as a,FormRunner as b,FORM_END_STATES as c,FORM_RUNNING_STATES as d};
//# sourceMappingURL=FormRunner-DbJ8vlb8.js.map

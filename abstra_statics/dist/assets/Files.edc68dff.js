import{_ as z}from"./DocsButton.vue_vue_type_script_setup_true_lang.e21048fc.js";import{C as L}from"./ContentLayout.a837d946.js";import{p as T}from"./popupNotifcation.17b9c327.js";import{a as H}from"./ant-design.3e244f71.js";import{a as M}from"./asyncComputed.c7982027.js";import{b as c,eH as x,fg as G,d as q,eC as J,J as D,q as Q,o as u,c as m,w as d,ar as y,u as i,cR as W,dB as X,cP as F,bG as w,a as I,eG as O,eu as S,ew as h,cM as Y,ch as Z,eA as K,eB as ee,R as te}from"./vue-router.6b399b0b.js";import{C as _}from"./gateway.34f2a318.js";import"./index.c3b84c4d.js";import{D as ne}from"./DeleteOutlined.fcb2310c.js";import{C as ae}from"./Card.ddda3ab5.js";import"./BookOutlined.7993dbf1.js";import"./record.f5201a57.js";import"./string.79d7b0e1.js";import"./TabPane.dfa9c37c.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="fcbd767c-9a8d-400b-981f-ca0bbef399eb",n._sentryDebugIdIdentifier="sentry-dbid-fcbd767c-9a8d-400b-981f-ca0bbef399eb")}catch{}})();var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const oe=re;function A(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable}))),r.forEach(function(s){le(n,s,a[s])})}return n}function le(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var j=function(e,a){var r=A({},e,a.attrs);return c(x,A({},r,{icon:G}),null)};j.displayName="DownloadOutlined";j.inheritAttrs=!1;const ie=j;function R(n){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable}))),r.forEach(function(s){se(n,s,a[s])})}return n}function se(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}var C=function(e,a){var r=R({},e,a.attrs);return c(x,R({},r,{icon:oe}),null)};C.displayName="UploadOutlined";C.inheritAttrs=!1;const ce=C;class k{constructor(e){this.projectId=e}static fromProjectId(e){return new k(e)}async list(){return _.get(`projects/${this.projectId}/files`)}async upload(e){const a={"Content-Type":"multipart/form-data"};return _.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e.name)}`,e,a)}async download(e){return _.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return _.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,a){return _.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(a)}`,{})}}const de=n=>(K("data-v-d987b30a"),n=n(),ee(),n),ue=de(()=>I("br",null,null,-1)),pe={key:0},fe={key:0,class:"file-size"},me=q({__name:"Files",setup(n){const a=J().params.projectId,r=k.fromProjectId(a),{loading:s,result:B,refetch:$}=M(()=>r.list());function P(t){var l,o;return{key:t.path,title:t.name,isLeaf:t.type==="file",file:t,children:t.type==="file"?[]:(o=(l=t.children)==null?void 0:l.map(P))!=null?o:[]}}const p=D(()=>{var t;return(t=B.value)==null?void 0:t.map(P)}),U=t=>{var l,o;return t.isLeaf?1:(o=(l=t.children)==null?void 0:l.reduce((f,b)=>f+U(b),0))!=null?o:0},g=D(()=>p.value?p==null?void 0:p.value.reduce((t,l)=>t+U(l),0):0),v=Q(!1);function E(){const t=document.createElement("input");t.type="file",t.onchange=async()=>{var o;const l=(o=t.files)==null?void 0:o[0];if(!!l)try{v.value=!0,await r.upload(l),await $()}catch{T("Failed to upload file","File already exists")}finally{v.value=!1}},t.click()}async function N(t){if(!t)return;const l=await r.download(t.path),o=document.createElement("a");o.href=URL.createObjectURL(l),o.download=t.name,o.click()}async function V(t){!t||await H("Are you sure you want to delete this file?")&&(await r.delete(t.path),await $())}return(t,l)=>(u(),m(L,null,{default:d(()=>[c(i(W),null,{default:d(()=>[y("Files")]),_:1}),c(i(F),null,{default:d(()=>[y(" Here you can upload, download and delete files in your persistent dir."),ue,y(" Files can be used in your scripts. "),c(z,{path:"cloud/files"}),X(t.$slots,"description",{},void 0,!0)]),_:3}),c(i(w),{type:"primary",loading:v.value,onClick:E},{default:d(()=>[c(i(ce)),y(" Upload ")]),_:1},8,["loading"]),c(i(ae),null,{default:d(()=>[g.value>0?(u(),m(i(F),{key:0},{default:d(()=>[I("b",null,[y(O(g.value)+" file",1),g.value!==1?(u(),S("span",pe,"s")):h("",!0)])]),_:1})):h("",!0),p.value&&p.value.length>0?(u(),m(i(Y),{key:1,"tree-data":p.value,selectable:!1},{title:d(({title:o,isLeaf:f,file:b})=>[I("span",null,[y(O(o)+" ",1),f?(u(),S("span",fe,"("+O(b.size)+")",1)):h("",!0)]),f?(u(),m(i(w),{key:0,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>N(b)},{default:d(()=>[c(i(ie))]),_:2},1032,["onClick"])):h("",!0),f?(u(),m(i(w),{key:1,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>V(b)},{default:d(()=>[c(i(ne))]),_:2},1032,["onClick"])):h("",!0)]),_:1},8,["tree-data"])):(u(),m(i(Z),{key:2,description:i(s)?"Loading...":"No files"},null,8,["description"]))]),_:1})]),_:3}))}});const Ue=te(me,[["__scopeId","data-v-d987b30a"]]);export{Ue as default};
//# sourceMappingURL=Files.edc68dff.js.map

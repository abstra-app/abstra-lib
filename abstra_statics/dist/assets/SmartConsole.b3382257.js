import{d as q,v as A,K as J,H as te,b as a,c as i,z as p,V,W as B,x as e,D as S,N as I,e as R,ab as ne,S as se,O,Q as Y,q as G,r as v,R as oe,X as H,o as ae,U as re,G as L,I as x,A as le,F as ie,L as ce,a2 as ue,t as de,J as pe}from"./registerWidgets.802bba2f.js";import{p as me,o as K,q as he,r as ve}from"./icons.03f7ad73.js";import{a as N}from"./asyncComputed.1364aaa9.js";import{F as fe}from"./forms.91463966.js";import{D as ye}from"./dashes.ca1ade9b.js";import{H as _e}from"./hooks.911e43af.js";import{J as W}from"./jobs.cb7d0efd.js";import{W as ge}from"./workspaces.4c177a35.js";import{l as w}from"./log.8028a717.js";const Q=t=>(O("data-v-7d69f0ed"),t=t(),Y(),t),ke={class:"runtime-settings"},Se={key:0,class:"field"},Ce=Q(()=>e("div",{class:"label"},"Path",-1)),be={class:"field"},$e=Q(()=>e("div",{class:"label"},"Code",-1)),xe={class:"input-row"},we={key:1,class:"root-path loading"},Ie={class:"path-feedback"},Re={key:1,class:"error"},Pe=q({__name:"RuntimeCommonSettings",props:{runtime:null},setup(t){const n=t,r=A({pathError:null}),{result:c}=N(()=>ge.get()),m=()=>{!c.value||!n.runtime.file||c.value.openFile(n.runtime.file)},P=J(()=>{var f;return(f=n.runtime.file)!=null&&f.endsWith(".py")?null:"It should be a .py file"}),E=()=>{!c.value||!h.value||c.value.openFile(".")},C=te(),{result:h}=N(()=>fetch("/_editor/api/workspace/root-path").then(f=>f.text()));return n.runtime.onUpdate(()=>{if(!(n.runtime instanceof W))if(console.log("runtime updated",n.runtime.path),n.runtime instanceof fe)C.push({path:`/_editor/form/${encodeURIComponent(n.runtime.path)}`});else if(n.runtime instanceof _e)C.push({path:`/_editor/hook/${encodeURIComponent(n.runtime.path)}`});else if(n.runtime instanceof ye)C.push({path:`/_editor/dash/${encodeURIComponent(n.runtime.path)}`});else throw new Error(`Unknown runtime type ${n.runtime}`)}),(f,u)=>(a(),i("div",ke,[t.runtime instanceof p(W)?S("",!0):(a(),i("div",Se,[Ce,V(e("input",{"onUpdate:modelValue":u[0]||(u[0]=y=>t.runtime.path=y),class:"path-input",type:"text"},null,512),[[B,t.runtime.path]])])),e("div",be,[$e,e("div",xe,[p(h)?(a(),i("button",{key:0,class:"root-path",onClick:u[1]||(u[1]=y=>E())},I(p(h)),1)):(a(),i("span",we," Loading... ")),V(e("input",{"onUpdate:modelValue":u[2]||(u[2]=y=>t.runtime.file=y),type:"text"},null,512),[[B,t.runtime.file]]),e("button",{class:"open-file-icon",onClick:u[3]||(u[3]=y=>m())},[R(ne,{path:p(me)},null,8,["path"]),se(" Open in editor ")])]),e("div",Ie,I(p(P)),1)]),r.pathError?(a(),i("div",Re,I(r.pathError),1)):S("",!0)]))}});const et=G(Pe,[["__scopeId","data-v-7d69f0ed"]]),Ee=t=>(O("data-v-3f0fea4b"),t=t(),Y(),t),De={class:"smart-console"},Le={class:"header"},Ue=Ee(()=>e("div",{class:"left"},"Console",-1)),Fe={class:"right"},Me={class:"cli"},Te={class:"left"},ze={class:"entry ai-output"},Ve={key:0},Be={class:"local-entry"},He={key:0,class:"input"},Ke=["pointer-events","onKeydown"],Ne={class:"right"},We=q({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},dashPlayerState:null,formCode:null,runtime:null},emits:["clear-terminal","restart","enter"],setup(t,{emit:n}){const r=t,c=v(""),m=v(null),P=pe(),E=v(!1),C=()=>{w.clear(),n("restart")};oe(P,()=>{w.clear(),n("clear-terminal")});const h=v(null),f=v("assistant"),u=async s=>{var l;if(s.preventDefault(),c.value=((l=h.value)==null?void 0:l.innerText)||"",s.shiftKey){document.execCommand("insertLineBreak");return}h.value&&(h.value.innerText=""),await y()},y=async()=>{c.value&&(_({type:"eval-request",content:`>>> ${c.value}`}),X(c.value),c.value="")},b=A([]),_=async s=>{b.push(s),await H(),m.value&&(m.value.scrollTop=m.value.scrollHeight)},X=s=>{var l,d,g;(g=(l=r.dashPlayerState)==null?void 0:l.broker)==null||g.send({type:"eval",expression:s,state:(d=r.dashPlayerState)==null?void 0:d.apiPageState})};(()=>{var s,l,d,g,T,z;(s=r.dashPlayerState)==null||s.on("eval-return",o=>{o.repr&&_({type:"log",content:o.repr})}),(l=r.dashPlayerState)==null||l.on("eval-error",o=>{_({type:"error",content:o.repr})}),(d=r.dashPlayerState)==null||d.on("stderr",o=>{_({type:"error",content:o.log})}),(g=r.dashPlayerState)==null||g.on("stdout",o=>{_({type:"log",content:o.log})}),(T=r.dashPlayerState)==null||T.on("widgets-computed",o=>{var $;($=o.errors)!=null&&$.general&&_({type:"error",content:o.errors.general.repr})}),(z=r.dashPlayerState)==null||z.on("program-start-failed",o=>{var $;_({type:"error",content:($=o.error)!=null?$:""})})})();const j=()=>{f.value==="assistant"&&w.clear(),b.splice(0,b.length)};w.listen(async s=>{s.type!=="restart"&&(k.value=!0,await H(),m.value&&(m.value.scrollTop=m.value.scrollHeight))});const k=v(!1),U=v(400),Z=J(()=>({height:`${U.value}px`})),D=v(!1),ee=()=>D.value=!0,F=s=>{!D.value||(U.value=document.body.clientHeight-s.clientY)},M=()=>D.value=!1;return ae(()=>{document.addEventListener("mousemove",F),document.addEventListener("mouseup",M)}),re(()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",M)}),(s,l)=>(a(),i("div",De,[e("div",Le,[Ue,e("div",Fe,[e("div",{class:"changes-container"},[e("button",{class:"header-button",onClick:C},"Restart")]),e("div",{class:"toggle-button",onClick:l[0]||(l[0]=d=>k.value=!k.value)},[R(x,{class:L(["icon",{open:k.value}]),path:p(K),fill:"#fff"},null,8,["class","path"])])])]),k.value?(a(),i("div",{key:0,class:"terminal",style:le(p(Z))},[e("div",{class:"resize-handler",onMousedown:ee},null,32),e("div",Me,[e("div",Te,[e("div",{ref_key:"entriesContainer",ref:m,class:"entries"},[e("div",ze,[b.length===0?(a(),i("div",Ve," You can inspect your code here. ")):S("",!0),(a(!0),i(ie,null,ce(b,(d,g)=>(a(),i("div",{key:g,class:L([d.type,"entry"])},[e("div",Be,I(d.type==="restart"?"-- restarted --":d.content),1)],2))),128))])],512),t.runtime==="dashes"?(a(),i("div",He,[R(x,{class:L(["icon",{open:k.value}]),path:p(K)},null,8,["class","path"]),e("div",{ref_key:"inputRef",ref:h,class:"input-text",contenteditable:"","pointer-events":E.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:ue(u,["enter"])},null,40,Ke)])):S("",!0)]),e("div",Ne,[e("div",{class:"icons",onClick:j},[R(x,{class:"icon",path:p(he)},null,8,["path"])]),e("div",null,[t.runtime==="dashes"?(a(),de(x,{key:0,class:"icon",path:p(ve)},null,8,["path"])):S("",!0)])])])],4)):S("",!0)]))}});const tt=G(We,[["__scopeId","data-v-3f0fea4b"]]);export{et as R,tt as S};
//# sourceMappingURL=SmartConsole.b3382257.js.map

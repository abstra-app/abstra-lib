import{d as G,f as v,o as n,c as u,w as t,b as a,u as e,dh as o,dc as p,aG as d,e9 as g,eC as Y,bO as q,d5 as H,S as T,Y as h,eb as b,d9 as Q,d2 as W,aS as C,a0 as R,X as Z,ah as x,bT as U,el as ee,eD as z,F as te,cy as ae,cz as P,bL as se,cE as le,cL as ne,em as de,en as oe,a as re}from"./index.cadf41ce.js";import{T as ue,L as ie}from"./tasksController.c6ce6c42.js";import{t as pe}from"./ant-design.0a7918ec.js";import{F as E}from"./PhArrowSquareOut.vue.b7f258ba.js";import{_ as O}from"./AbstraButton.vue_vue_type_script_setup_true_lang.25d428fe.js";import{A as ce}from"./index.8e1a11b6.js";import{C as ge}from"./Card.16580343.js";import{A as B,C as fe}from"./CollapsePanel.c04e10c9.js";import"./index.3fe61194.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_=new Error().stack;_&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[_]="3ef5d121-1763-432b-a408-7b28b93a00f1",i._sentryDebugIdIdentifier="sentry-dbid-3ef5d121-1763-432b-a408-7b28b93a00f1")}catch{}})();const ke=G({__name:"TaskCard",props:{task:{},checked:{type:Boolean},type:{},map:{}},emits:["change"],setup(i,{emit:_}){const c=i,S=(l,r)=>{let y=`/_editor/${l}/${r}`;window.open(`${y}`,"_blank")},I=v(()=>c.task.targetStageTitle.length<16?c.task.targetStageTitle:c.task.targetStageTitle.slice(0,16)+"..."),A=v(()=>c.task.sourceStageTitle.length<16?c.task.sourceStageTitle:c.task.sourceStageTitle.slice(0,16)+"...");return(l,r)=>(n(),u(e(ge),{size:"small"},{default:t(()=>[a(e(o),{justify:"space-between",vertical:""},{default:t(()=>[a(e(o),{justify:"end",style:{height:"6px"}},{default:t(()=>[a(e(p),{type:"secondary",style:{"font-size":"10px","margin-top":"-5px"}},{default:t(()=>[d(g(e(Y)(new Date(l.task.created.at))),1)]),_:1})]),_:1}),a(e(o),{align:"start",justify:"space-between"},{default:t(()=>[a(e(o),{align:"center",gap:"middle"},{default:t(()=>[a(e(q),{checked:l.checked,disabled:l.type==="sent",onChange:r[0]||(r[0]=y=>_("change",l.task.id))},null,8,["checked","disabled"]),a(e(o),{align:"center"},{default:t(()=>[a(e(H),{color:l.map.get(l.task.type)},{default:t(()=>[d(g(l.task.type.length>18?l.task.type.slice(0,18)+"...":l.task.type),1)]),_:1},8,["color"]),a(e(ce),{type:"vertical"}),l.type==="received"&&l.task.sourceStageTitle?(n(),u(e(o),{key:0,align:"center"},{default:t(()=>[a(e(p),{type:"secondary"},{default:t(()=>[d("Sent by: ")]),_:1}),a(O,{type:"link",onClick:r[1]||(r[1]=y=>S(l.task.sourceStageType,l.task.created.byStageId))},{default:t(()=>[d(g(A.value)+" ",1),a(e(E),{size:16})]),_:1})]),_:1})):T("",!0),l.type==="received"&&!l.task.sourceStageTitle?(n(),u(e(o),{key:1,align:"center"},{default:t(()=>[a(e(p),{type:"secondary"},{default:t(()=>[d("Created manually")]),_:1})]),_:1})):T("",!0),l.type==="sent"?(n(),u(e(o),{key:2,align:"center"},{default:t(()=>[a(e(p),{type:"secondary"},{default:t(()=>[d("Sent to: ")]),_:1}),a(O,{type:"link",onClick:r[2]||(r[2]=y=>S(l.task.targetStageType,l.task.targetStageId))},{default:t(()=>[d(g(I.value)+" ",1),a(e(E),{size:16})]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),a(e(o),{vertical:"",style:{padding:"10px"}},{default:t(()=>[(n(!0),h(C,null,b(l.task.payload,(y,w)=>(n(),u(e(o),{key:w},{default:t(()=>[a(e(Q),{class:"center"},{default:t(()=>[d(g(w)+":",1)]),_:2},1024),a(e(W),{"tree-data":e(pe)(y),selectable:!1,style:{padding:"0"}},{title:t(({title:f})=>[a(e(p),{type:"secondary",style:{"max-width":"200px"},ellipsis:""},{default:t(()=>[d(g(f),1)]),_:2},1024)]),_:2},1032,["tree-data"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}});const F=R(ke,[["__scopeId","data-v-c67a9853"]]),ye=i=>(de("data-v-cec688d3"),i=i(),oe(),i),me=ye(()=>re("code",null,"send_task",-1)),_e=G({__name:"TasksManager",props:{stageId:{}},emits:["refetch-tasks"],setup(i,{emit:_}){const c=i,S=new ie,I=k=>{k(),_("refetch-tasks",c.stageId)},{setup:A,tearDown:l,state:r,createTask:y,startCreatingTask:w,creatingTaskState:f,cancelCreatingTask:J,isPayloadValid:V,collapseValue:$,getPossibleActions:K,checkTask:D}=ue({api:S,poll:!1,stageId:c.stageId,stages:null}),j=v(()=>r.tasks.filter(k=>k.status==="pending")),L=v(()=>r.tasks.filter(k=>k.status==="completed")),N=v(()=>{var k;return(k=r.sentTasks)!=null?k:[]}),X=v(()=>K());return Z(()=>A()),x(()=>l()),(k,m)=>(n(),u(e(o),{vertical:"",gap:"small",class:"tasks-manager"},{default:t(()=>[a(e(o),{justify:"end",gap:"small"},{default:t(()=>[(n(!0),h(C,null,b(X.value,s=>(n(),u(e(U),{key:s.name,onClick:M=>I(s.handler)},{default:t(()=>[d(g(s.label),1)]),_:2},1032,["onClick"]))),128)),a(e(U),{type:"primary",onClick:ee(e(w),["stop"])},{default:t(()=>[d("Add Task")]),_:1},8,["onClick"])]),_:1}),a(e(fe),{"active-key":e($),"onUpdate:activeKey":m[0]||(m[0]=s=>te($)?$.value=s:null),ghost:""},{default:t(()=>[a(e(B),{key:"pending"},{header:t(()=>[a(e(o),{justify:"space-between"},{default:t(()=>[a(e(p),null,{default:t(()=>[d("Pending tasks : "+g(j.value.length),1)]),_:1})]),_:1})]),default:t(()=>[a(e(o),{vertical:"",gap:"small"},{default:t(()=>[a(z,null,{default:t(()=>[(n(!0),h(C,null,b(j.value,s=>(n(),u(F,{key:s.id+"-pending",task:s,type:"received",map:e(r).colorMap,checked:!!s.checked,onChange:M=>e(D)(s.id)},null,8,["task","map","checked","onChange"]))),128))]),_:1})]),_:1})]),_:1}),a(e(B),{key:"completed"},{header:t(()=>[a(e(p),null,{default:t(()=>[d("Completed tasks : "+g(L.value.length),1)]),_:1})]),default:t(()=>[a(e(o),{vertical:"",gap:"small"},{default:t(()=>[a(z,null,{default:t(()=>[(n(!0),h(C,null,b(L.value,s=>(n(),u(F,{key:s.id+"-completed",task:s,checked:!!s.checked,type:"received",map:e(r).colorMap,onChange:M=>e(D)(s.id)},null,8,["task","checked","map","onChange"]))),128))]),_:1})]),_:1})]),_:1}),a(e(B),{key:"sent"},{header:t(()=>[a(e(p),null,{default:t(()=>[d("Sent tasks : "+g(N.value.length),1)]),_:1})]),default:t(()=>[a(e(o),{vertical:"",gap:"small"},{default:t(()=>[a(z,null,{default:t(()=>[(n(!0),h(C,null,b(N.value,s=>(n(),u(F,{key:s.id+"-sent",task:s,checked:!!s.checked,type:"sent",map:e(r).colorMap,onChange:M=>e(D)(s.id)},null,8,["task","checked","map","onChange"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["active-key"]),a(e(ne),{open:e(f).state==="creating","ok-button-props":{disabled:!e(V)},onCancel:e(J),onOk:m[3]||(m[3]=s=>I(e(y)))},{title:t(()=>[a(e(p),null,{default:t(()=>[d("Add Task")]),_:1})]),default:t(()=>[a(e(ae),{layout:"vertical"},{default:t(()=>[a(e(P),{label:"Task type"},{default:t(()=>[e(f).state==="creating"?(n(),u(e(se),{key:0,value:e(f).name,"onUpdate:value":m[1]||(m[1]=s=>e(f).name=s),"auto-size":""},null,8,["value"])):T("",!0)]),_:1}),a(e(P),{label:"Task data"},{default:t(()=>[e(f).state==="creating"?(n(),u(e(le),{key:0,value:e(f).payloadCode,"onUpdate:value":m[2]||(m[2]=s=>e(f).payloadCode=s),"auto-size":""},null,8,["value"])):T("",!0)]),_:1})]),_:1}),e(V)?T("",!0):(n(),u(e(p),{key:0,type:"danger"},{default:t(()=>[d("Invalid JSON")]),_:1}))]),_:1},8,["open","ok-button-props","onCancel"]),a(e(p),{type:"secondary"},{default:t(()=>[d(" Use "),me,d(" on previous stages to send tasks to this stage. ")]),_:1})]),_:1}))}});const $e=R(_e,[["__scopeId","data-v-cec688d3"]]);export{$e as T};
//# sourceMappingURL=TasksManager.b97d1aaa.js.map

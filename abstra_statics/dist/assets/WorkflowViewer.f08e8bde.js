var ve=Object.defineProperty;var ye=(p,t,u)=>t in p?ve(p,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[t]=u;var de=(p,t,u)=>(ye(p,typeof t!="symbol"?t+"":t,u),u);import{_ as G}from"./AbstraButton.vue_vue_type_script_setup_true_lang.d649a3b9.js";import{F as he,I as ke,O as be}from"./os.a34fde1d.js";import{d as X,at as O,c as k,o as l,ac as C,ae as Se,h as D,ed as Me,e as w,f as a,u as e,a as M,b as s,g as L,t as g,df as F,ad as Ae,aY as fe,_ as le,dj as j,ej as Ie,f6 as ce,de as q,i as h,cS as ge,cT as $e,ei as _e,ec as me,el as K,bE as Le,bD as Q,eh as ne,bW as Ce,cM as ze,eD as Ze,fa as je,r as W,w as xe,ax as Te,U as Pe,S as Be,A as R,dd as Ne,eG as De,eH as Ve,es as We,et as Ee}from"./jwt-decode.esm.2219a823.js";import{F as He}from"./PhArrowSquareOut.vue.28812d8e.js";import{I as ue}from"./PhCopy.vue.fb2a3a76.js";import{G as Fe}from"./PhPencilSimple.vue.b65eebfe.js";import{_ as Ye}from"./vue-flow-background.292cacd2.js";import{a as Xe,b as Ge,g as ee,u as Oe,e as qe,M as Je}from"./vue-flow-core.6b4e0428.js";import{k as te}from"./router.cc1f75df.js";import{a as ie,B as Ue,b as Ke}from"./build.aa45b7b0.js";import{a as Qe,P as Re}from"./project.0d8835a7.js";import"./tables.a7724452.js";import{a as ae}from"./asyncComputed.413e7b3b.js";import{G as et}from"./PhArrowCounterClockwise.vue.97f7d47a.js";import{I as tt}from"./PhCopySimple.vue.5eb5f19c.js";import{G as at}from"./PhDotsThreeVertical.vue.51326501.js";import{F as st,G as ot,I as rt,a as nt}from"./PhWebhooksLogo.vue.40a3f388.js";import{g as it}from"./datetime.467ed52a.js";import{_ as lt}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang.840ffe1e.js";import{u as dt}from"./polling.9e41fd98.js";import{C as se}from"./Card.0044ecba.js";import"./index.ff8cfc9e.js";import"./record.8cab547b.js";import"./string.bbe407f2.js";import"./LoadingOutlined.76a50387.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[t]="9f191310-14fe-47c9-bda5-f3fa67f0cdfc",p._sentryDebugIdIdentifier="sentry-dbid-9f191310-14fe-47c9-bda5-f3fa67f0cdfc")}catch{}})();const ct=["width","height","fill","transform"],ut={key:0},pt=w("path",{d:"M227.85,46.89a20,20,0,0,0-18.74-18.74c-13.13-.77-46.65.42-74.48,28.24L131,60H74.36a19.83,19.83,0,0,0-14.14,5.86L25.87,100.19a20,20,0,0,0,11.35,33.95l37.14,5.18,42.32,42.32,5.19,37.18A19.88,19.88,0,0,0,135.34,235a20.13,20.13,0,0,0,6.37,1,19.9,19.9,0,0,0,14.1-5.87l34.34-34.35A19.85,19.85,0,0,0,196,181.64V125l3.6-3.59C227.43,93.54,228.62,60,227.85,46.89ZM76,84h31L75.75,115.28l-27.23-3.8ZM151.6,73.37A72.27,72.27,0,0,1,204,52a72.17,72.17,0,0,1-21.38,52.41L128,159,97,128ZM172,180l-27.49,27.49-3.8-27.23L172,149Zm-72,22c-8.71,11.85-26.19,26-60,26a12,12,0,0,1-12-12c0-33.84,14.12-51.32,26-60A12,12,0,1,1,68.18,175.3C62.3,179.63,55.51,187.8,53,203c15.21-2.51,23.37-9.3,27.7-15.18A12,12,0,1,1,100,202Z"},null,-1),ft=[pt],gt={key:1},_t=w("path",{d:"M184,120v61.65a8,8,0,0,1-2.34,5.65l-34.35,34.35a8,8,0,0,1-13.57-4.53L128,176ZM136,72H74.35a8,8,0,0,0-5.65,2.34L34.35,108.69a8,8,0,0,0,4.53,13.57L80,128ZM40,216c37.65,0,50.69-19.69,54.56-28.18L68.18,161.44C59.69,165.31,40,178.35,40,216Z",opacity:"0.2"},null,-1),mt=w("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),wt=[_t,mt],vt={key:2},yt=w("path",{d:"M101.85,191.14C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Zm122-144a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.4,27.07h0L88,108.7A8,8,0,0,1,76.67,97.39l26.56-26.57A4,4,0,0,0,100.41,64H74.35A15.9,15.9,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A16,16,0,0,0,192,181.65V155.59a4,4,0,0,0-6.83-2.82l-26.57,26.56a8,8,0,0,1-11.71-.42,8.2,8.2,0,0,1,.6-11.1l49.27-49.27h0C223.45,91.86,224.6,59.71,223.85,47.12Z"},null,-1),ht=[yt],kt={key:3},bt=w("path",{d:"M221.86,47.24a14,14,0,0,0-13.11-13.1c-12.31-.73-43.77.39-69.88,26.5L133.52,66H74.35a13.9,13.9,0,0,0-9.89,4.1L30.11,104.44a14,14,0,0,0,7.94,23.76l39.13,5.46,45.16,45.16L127.8,218a14,14,0,0,0,23.76,7.92l34.35-34.35a13.91,13.91,0,0,0,4.1-9.89V122.48l5.35-5.35h0C221.46,91,222.59,59.56,221.86,47.24ZM38.11,115a2,2,0,0,1,.49-2L72.94,78.58A2,2,0,0,1,74.35,78h47.17L77.87,121.64l-38.14-5.32A1.93,1.93,0,0,1,38.11,115ZM178,181.65a2,2,0,0,1-.59,1.41L143.08,217.4a2,2,0,0,1-3.4-1.11l-5.32-38.16L178,134.48Zm8.87-73h0L128,167.51,88.49,128l58.87-58.88a78.47,78.47,0,0,1,60.69-23A2,2,0,0,1,209.88,48,78.47,78.47,0,0,1,186.88,108.64ZM100,190.31C95.68,199.84,81.13,222,40,222a6,6,0,0,1-6-6c0-41.13,22.16-55.68,31.69-60a6,6,0,1,1,5,10.92c-7,3.17-22.53,13.52-24.47,42.91,29.39-1.94,39.74-17.52,42.91-24.47a6,6,0,1,1,10.92,5Z"},null,-1),St=[bt],Mt={key:4},At=w("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),It=[At],$t={key:5},Lt=w("path",{d:"M219.86,47.36a12,12,0,0,0-11.22-11.22c-12-.71-42.82.38-68.35,25.91L134.35,68h-60a11.9,11.9,0,0,0-8.48,3.52L31.52,105.85a12,12,0,0,0,6.81,20.37l39.79,5.55,46.11,46.11,5.55,39.81a12,12,0,0,0,20.37,6.79l34.34-34.35a11.9,11.9,0,0,0,3.52-8.48v-60l5.94-5.94C219.48,90.18,220.57,59.41,219.86,47.36ZM36.21,115.6a3.94,3.94,0,0,1,1-4.09L71.53,77.17A4,4,0,0,1,74.35,76h52L78.58,123.76,39.44,118.3A3.94,3.94,0,0,1,36.21,115.6ZM180,181.65a4,4,0,0,1-1.17,2.83l-34.35,34.34a4,4,0,0,1-6.79-2.25l-5.46-39.15L180,129.65Zm-52-11.31L85.66,128l60.28-60.29c23.24-23.24,51.25-24.23,62.22-23.58a3.93,3.93,0,0,1,3.71,3.71c.65,11-.35,39-23.58,62.22ZM98.21,189.48C94,198.66,80,220,40,220a4,4,0,0,1-4-4c0-40,21.34-54,30.52-58.21a4,4,0,0,1,3.32,7.28c-7.46,3.41-24.43,14.66-25.76,46.85,32.19-1.33,43.44-18.3,46.85-25.76a4,4,0,1,1,7.28,3.32Z"},null,-1),Ct=[Lt],zt={name:"PhRocketLaunch"},Zt=X({...zt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(p){const t=p,u=O("weight","regular"),b=O("size","1em"),v=O("color","currentColor"),r=O("mirrored",!1),n=k(()=>{var f;return(f=t.weight)!=null?f:u}),o=k(()=>{var f;return(f=t.size)!=null?f:b}),d=k(()=>{var f;return(f=t.color)!=null?f:v}),c=k(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:r?"scale(-1, 1)":void 0);return(f,S)=>(l(),C("svg",Me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:o.value,height:o.value,fill:d.value,transform:c.value},f.$attrs),[Se(f.$slots,"default"),n.value==="bold"?(l(),C("g",ut,ft)):n.value==="duotone"?(l(),C("g",gt,wt)):n.value==="fill"?(l(),C("g",vt,ht)):n.value==="light"?(l(),C("g",kt,St)):n.value==="regular"?(l(),C("g",Mt,It)):n.value==="thin"?(l(),C("g",$t,Ct)):D("",!0)],16,ct))}}),jt=X({__name:"WorkflowEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(p){const t=p;function u(r,n,o=0){const d=n.center.x-r.center.x,c=n.center.y-r.center.y,f=Math.sqrt(d*d+c*c);if(f===0)return{sourceX:r.center.x,sourceY:r.center.y,targetX:n.center.x,targetY:n.center.y};const S=d/f,A=c/f,I=r.width/2,x=r.height/2;let T=r.center.x,P=r.center.y;Math.abs(S)*x>Math.abs(A)*I?(T=r.center.x+(S>0?I:-I),P=r.center.y+A*I/Math.abs(S)):(T=r.center.x+S*x/Math.abs(A),P=r.center.y+(A>0?x:-x));const z=n.width/2,B=n.height/2;let V=n.center.x,m=n.center.y;return Math.abs(S)*B>Math.abs(A)*z?(V=n.center.x-(S>0?z:-z),m=n.center.y-A*z/Math.abs(S)):(V=n.center.x-S*B/Math.abs(A),m=n.center.y-(A>0?B:-B)),T+=S*o,P+=A*o,V-=S*o,m-=A*o,{sourceX:T,sourceY:P,targetX:V,targetY:m}}function b(r,n){const d={center:{x:r.computedPosition.x+r.dimensions.width/2,y:r.computedPosition.y+r.dimensions.height/2},width:r.dimensions.width,height:r.dimensions.height},f={center:{x:n.computedPosition.x+n.dimensions.width/2,y:n.computedPosition.y+n.dimensions.height/2},width:n.dimensions.width,height:n.dimensions.height};return u(d,f,10)}const v=k(()=>{if(!t.sourceNode||!t.targetNode)return ee({sourceX:0,sourceY:0,targetX:0,targetY:0});if(!t.sourceNode.dimensions.width||!t.targetNode.dimensions.width||!t.sourceNode.dimensions.height||!t.targetNode.dimensions.height)return ee({sourceX:0,sourceY:0,targetX:0,targetY:0});const r=b(t.sourceNode,t.targetNode);return ee(r)});return(r,n)=>{var o,d;return l(),C(fe,null,[a(e(Xe),{path:v.value[0],"marker-end":t.markerEnd},null,8,["path","marker-end"]),(d=(o=t.data)==null?void 0:o.props)!=null&&d.taskType?(l(),M(e(Ge),{key:0},{default:s(()=>[w("div",{style:Ae({transform:`translate(-50%, -50%) translate(${v.value[1]}px,${v.value[2]}px)`}),class:"nodrag nopan edge-label"},[a(e(F),null,{default:s(()=>[L(g(t.data.props.taskType),1)]),_:1})],4)]),_:1})):D("",!0)],64)}}});const xt=le(jt,[["__scopeId","data-v-8f1859d4"]]);class Tt{async list(t){return te.get(`projects/${t}/disabled-stages`)}async disableStage({projectId:t,stageId:u}){return te.patch(`projects/${t}/disabled-stages/${u}`,{enable:!1})}async enableStage({projectId:t,stageId:u}){return te.patch(`projects/${t}/disabled-stages/${u}`,{enable:!0})}}const oe=new Tt;class Y{constructor(t){de(this,"id");this.dto=t,this.id=t}static async list(t){return(await oe.list(t)).map(b=>new Y(b))}static async disableStage({projectId:t,stageId:u}){return oe.disableStage({projectId:t,stageId:u})}static async enableStage({projectId:t,stageId:u}){return oe.enableStage({projectId:t,stageId:u})}}const Pt=X({__name:"WorkflowStageExecutions",props:{stageId:{},projectId:{},statistics:{}},setup(p){const t=p,u=o=>{if(!o.createdAt||!o.updatedAt)return 0;const d=new Date(o.createdAt).getTime(),c=new Date(o.updatedAt).getTime();return Math.round((c-d)/1e3)},b=k(()=>t.statistics?Math.round(t.statistics.completedTasks/t.statistics.totalTasks*100):0),v=k(()=>{const o=b.value;return o===100?"#52c41a":o>=50?"#1890ff":"#faad14"}),r=o=>it(o,{weekday:void 0}),n=o=>{if(o<60)return`${Math.round(o)}s`;const d=Math.floor(o/60);if(d<60)return`${d}m`;const c=Math.floor(d/60);return c<24?`${c}h`:`${Math.floor(c/24)}d`};return(o,d)=>(l(),M(e(j),{vertical:"",size:4,style:{width:"100%"}},{default:s(()=>[o.statistics.lastExecutions&&o.statistics.lastExecutions.length>0?(l(),M(e(j),{key:0,size:4,gap:4},{default:s(()=>[(l(!0),C(fe,null,Ie(o.statistics.lastExecutions,c=>(l(),M(e(ce),{key:c.id,to:{name:"logs",params:{projectId:o.projectId},query:{executionId:c.id}}},{default:s(()=>[a(e(ge),{title:r(new Date(c.createdAt))},{content:s(()=>[a(e(j),{vertical:"",size:4},{default:s(()=>[a(e(q),null,{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_status"))+": "+g(c.status),1)]),_:2},1024),c.updatedAt&&c.updatedAt!==c.createdAt?(l(),M(e(q),{key:0},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_duration"))+": "+g(u(c))+"s ",1)]),_:2},1024)):D("",!0),a(e(q),null,{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_version"))+": "+g(c.buildId.slice(0,6)),1)]),_:2},1024)]),_:2},1024)]),default:s(()=>[a(lt,{status:c.status},null,8,["status"])]),_:2},1032,["title"])]),_:2},1032,["to"]))),128))]),_:1})):D("",!0),o.statistics.totalTasks>0?(l(),M(e(ce),{key:1,to:{name:"tasks",params:{projectId:o.projectId},query:{stage:o.stageId,status:"pending"}}},{default:s(()=>[a(e(j),{vertical:"",size:2},{default:s(()=>[a(e($e),{"show-info":!1,percent:b.value,"stroke-color":v.value,size:"small"},null,8,["percent","stroke-color"]),a(e(j),{vertical:"",size:0},{default:s(()=>[o.statistics.pendingTasks>0&&o.statistics.averageCompletionSeconds?(l(),M(e(q),{key:0,type:"secondary",style:{fontSize:"11px"}},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_pending_tasks").replace("{count}",o.statistics.pendingTasks.toString()))+" ("+g(n(o.statistics.averageCompletionSeconds))+" "+g(e(h).translate("i18n_workflowviewer_average"))+") ",1)]),_:1})):D("",!0)]),_:1})]),_:1})]),_:1},8,["to"])):D("",!0)]),_:1}))}}),Bt={class:"stage-content"},Nt={class:"stage-title"},Dt={class:"action-item"},Vt={class:"action-item"},Wt={class:"action-warning"},Et={key:1,class:"action-item"},pe="3.18.0",Ht=X({__name:"WorkflowStageNode",props:{stage:{},statistics:{}},setup(p){const t=p,u=_e(),b=me(),v=u.params.projectId,r=k(()=>({forms:st,hooks:ot,scripts:rt,jobs:nt})[t.stage.type]),{result:n}=ae(async()=>await Qe.get(v)),{result:o}=ae(async()=>{const $=(await ie.list(v)).find(i=>i.latest);return $?await Ue.get($.id):null}),{result:d,refetch:c}=ae(async()=>(await Y.list(v)).filter($=>$)),f=()=>{b.push({name:"logs",params:{projectId:v},query:{stageId:t.stage.id}})},S=k(()=>t.stage.type==="forms"||t.stage.type==="hooks"),A=()=>{var i;if(!t.stage.path)return;const m=t.stage.type==="forms"?`/${t.stage.path}`:`/_hooks/${t.stage.path}`,$=(i=n.value)==null?void 0:i.getUrl(m);!$||(navigator.clipboard.writeText($),ze.success(h.translate("i18n_workflowviewer_copied_url")))},I=k(()=>{var m;return(m=d.value)==null?void 0:m.map($=>$.id).includes(t.stage.id)}),x=(m,$)=>{const[i,y,_]=m.split(".").map(Number),[H,Z,E]=$.split(".").map(Number);return i>H?!0:i<H?!1:y>Z?!0:y<Z?!1:_>=E},T=k(()=>I.value?Ze:je),P=k(()=>I.value?h.translate("i18n_workflowviewer_enable_stage"):h.translate("i18n_workflowviewer_disable_stage")),z=k(()=>{var m;return!x(((m=o.value)==null?void 0:m.abstraVersion)||"0.0.0",pe)}),B=k(()=>z.value?h.translate("i18n_workflowviewer_disable_stages_warning").replace("{version}",pe):""),V=async()=>{z.value||(I.value?await Y.enableStage({projectId:v,stageId:t.stage.id}):await Y.disableStage({projectId:v,stageId:t.stage.id}),await c())};return(m,$)=>(l(),C("div",{class:ne(["stage-node",{disabled:I.value}])},[w("div",Bt,[(l(),M(K(r.value),{size:18,class:"stage-icon"})),w("div",Nt,g(m.stage.title),1),a(e(Ce),{trigger:["click"]},{overlay:s(()=>[a(e(Le),null,{default:s(()=>[a(e(Q),{onClick:f},{default:s(()=>[w("div",Dt,[a(e(et),{size:16}),w("span",null,g(e(h).translate("i18n_workflowviewer_view_logs")),1)])]),_:1}),S.value?(l(),M(e(Q),{key:0,onClick:A},{default:s(()=>[w("div",Vt,[a(e(tt),{size:16}),w("span",null,g(e(h).translate("i18n_workflowviewer_copy_url")),1)])]),_:1})):D("",!0),a(e(Q),{onClick:V},{default:s(()=>[z.value?(l(),M(e(ge),{key:0,placement:"left"},{content:s(()=>[w("div",Wt,[a(e(F),null,{default:s(()=>[L(g(B.value),1)]),_:1})])]),default:s(()=>[w("div",{class:ne(["action-item",{disabled:z.value}])},[(l(),M(K(T.value),{size:16})),w("span",null,g(P.value),1)],2)]),_:1})):(l(),C("div",Et,[(l(),M(K(T.value),{size:16})),w("span",null,g(P.value),1)]))]),_:1})]),_:1})]),default:s(()=>[a(e(at),{style:{cursor:"pointer"},size:20,class:"actions-menu"})]),_:1})]),a(Pt,{"stage-id":m.stage.id,"project-id":e(v),statistics:m.statistics,style:{"margin-top":"8px"}},null,8,["stage-id","project-id","statistics"])],2))}});const J=le(Ht,[["__scopeId","data-v-884c958a"]]);function Ft({projectApi:p,projectId:t,stageIds:u}){const b=W(null),v=W(!1);async function r(){v.value=!0;try{b.value=await p.getWorkflowStatistics(t)}catch(d){console.error("Failed to load workflow data:",d)}finally{v.value=!1}}const{startPolling:n,endPolling:o}=dt({task:r,interval:15e3});return xe(u,d=>{d.length>0&&(r(),n())},{immediate:!0}),Te(()=>{o()}),{statistics:b,loading:v,refetch:r}}const we=p=>(We("data-v-1b43788b"),p=p(),Ee(),p),Yt={class:"flow-container"},Xt={class:"code-container"},Gt=we(()=>w("code",{class:"install-code"},"pip install abstra",-1)),Ot={class:"code-container"},qt=we(()=>w("code",{class:"install-code"},"abstra editor .",-1)),Jt={key:0,class:"edit-button-text"},re="#ea576a",Ut=X({__name:"WorkflowViewer",setup(p){const{onInit:t}=Oe(),u=new Ke,b=_e(),v=me(),r=b.params.projectId,n=b.query.buildId,o=W(!0),d=W(null),c=W(!0),f=W(!1),S=()=>{v.push({name:"web-editor",params:{projectId:r}})},A=async i=>{try{await navigator.clipboard.writeText(i)}catch(y){console.error("Failed to copy:",y)}};t(i=>{c.value&&(i.fitView(),c.value=!1)});const I=W([]),x=W([]),T=k(()=>I.value.map(i=>i.id)),P=new Re,{statistics:z}=Ft({projectApi:P,projectId:r,stageIds:T}),B=k(()=>I.value.length>0),V=k(()=>I.value.map(i=>({id:i.id,type:i.type,data:{stage:i,statistics:z},position:{x:i.position.x,y:i.position.y*1.5}}))),m=k(()=>x.value.map(i=>({id:i.id,source:i.sourceStageId,target:i.targetStageId,type:"task",data:{id:i.id,props:{taskType:i.taskType}},markerEnd:{type:Je.Arrow,width:24,height:24}})));function $(i){const y=[],_=[],H=["jobs","hooks","forms","scripts"];for(const Z of H){const E=i[Z]||[];for(const N of E){y.push({id:N.id,type:Z,title:N.title,position:{x:N.workflow_position[0],y:N.workflow_position[1]},file:N.file,path:N.path,schedule:N.schedule});for(const U of N.transitions||[])_.push({id:U.id,sourceStageId:N.id,targetStageId:U.target_id,taskType:U.task_type})}}I.value=y,x.value=_}return Pe(async()=>{try{o.value=!0;let i;if(n){const Z=(await ie.list(r)).find(E=>E.id===n);if(!Z){d.value="Build not found";return}i=Z}else{const Z=(await ie.list(r)).find(E=>E.latest);if(!Z){d.value="No builds found for this project";return}i=Z}const y=await u.get(i.id);if(!y||!y.abstraJson){d.value="No workflow data available for this build";return}const _=JSON.parse(y.abstraJson);$(_)}catch(i){d.value=i instanceof Error?i.message:"Failed to load workflow",console.error(i)}finally{o.value=!1}}),(i,y)=>(l(),C("div",Yt,[o.value?(l(),M(e(Be),{key:0,style:{width:"100%"}})):B.value?(l(),M(e(qe),{key:2,nodes:V.value,edges:m.value,"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.1,"max-zoom":1.25,"pan-on-scroll":e(be).isMac,"snap-to-grid":""},{"edge-task":s(_=>[a(xt,De(Ve(_)),null,16)]),"node-forms":s(_=>[a(J,{stage:_.data.stage,statistics:_.data.statistics},null,8,["stage","statistics"])]),"node-hooks":s(_=>[a(J,{stage:_.data.stage,statistics:_.data.statistics},null,8,["stage","statistics"])]),"node-scripts":s(_=>[a(J,{stage:_.data.stage,statistics:_.data.statistics},null,8,["stage","statistics"])]),"node-jobs":s(_=>[a(J,{stage:_.data.stage,statistics:_.data.statistics},null,8,["stage","statistics"])]),default:s(()=>[a(e(Ye),{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","pan-on-scroll"])):(l(),M(e(se),{key:1,class:"empty-state-card"},{default:s(()=>[a(e(j),{vertical:"",gap:24,align:"center"},{default:s(()=>[a(e(Zt),{size:64,color:re}),a(e(j),{vertical:"",gap:8,align:"center"},{default:s(()=>[a(e(R),{level:3},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_getting_started")),1)]),_:1}),a(e(F),{type:"secondary",style:{"text-align":"center"}},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_no_workflow_description")),1)]),_:1})]),_:1}),a(e(j),{gap:16,wrap:"wrap",justify:"center"},{default:s(()=>[a(e(se),{class:"option-card"},{default:s(()=>[a(e(j),{vertical:"",gap:12},{default:s(()=>[a(e(he),{size:32,color:re}),a(e(R),{level:5},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_option_cli")),1)]),_:1}),a(e(F),{type:"secondary",style:{"font-size":"13px"}},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_cli_description")),1)]),_:1}),a(e(j),{vertical:"",gap:8},{default:s(()=>[w("div",Xt,[Gt,a(G,{type:"text",size:"small",onClick:y[0]||(y[0]=_=>A("pip install abstra"))},{default:s(()=>[a(e(ue),{size:16})]),_:1})]),w("div",Ot,[qt,a(G,{type:"text",size:"small",onClick:y[1]||(y[1]=_=>A("abstra editor ."))},{default:s(()=>[a(e(ue),{size:16})]),_:1})])]),_:1})]),_:1})]),_:1}),a(e(se),{class:"option-card"},{default:s(()=>[a(e(j),{vertical:"",gap:12},{default:s(()=>[a(e(ke),{size:32,color:re}),a(e(R),{level:5},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_option_online")),1)]),_:1}),a(e(F),{type:"secondary",style:{"font-size":"13px"}},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_online_description")),1)]),_:1}),a(G,{type:"primary",onClick:S},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_open_editor")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(Ne),{href:"https://www.abstra.io/docs",target:"_blank"},{default:s(()=>[L(g(e(h).translate("i18n_workflowviewer_view_docs"))+" ",1),a(e(He),{size:14,style:{"margin-left":"4px"}})]),_:1})]),_:1})]),_:1})),!o.value&&B.value?(l(),M(G,{key:3,class:ne(["edit-button",{expanded:f.value}]),type:"primary",size:"large",onClick:S,onMouseenter:y[2]||(y[2]=_=>f.value=!0),onMouseleave:y[3]||(y[3]=_=>f.value=!1)},{default:s(()=>[a(e(Fe),{size:24}),f.value?(l(),C("span",Jt,g(e(h).translate("i18n_workflowviewer_edit_online")),1)):D("",!0)]),_:1},8,["class"])):D("",!0)]))}});const Sa=le(Ut,[["__scopeId","data-v-1b43788b"]]);export{Sa as default};
//# sourceMappingURL=WorkflowViewer.f08e8bde.js.map

import{_ as z}from"./AbstraButton.vue_vue_type_script_setup_true_lang.88b677f9.js";import{o as pe}from"./omniChatStore.7a5e1343.js";import{a as D}from"./string.70bd7122.js";import{d as ie,at as Y,c as E,o as i,ac as x,ae as Ie,h as R,ed as $e,e as C,dg as Me,r as U,i as r,a as b,b as s,u as e,f as o,g as w,t as N,df as W,dj as L,aY as re,ej as ve,ad as H,es as me,bT as ce,cD as ge,cE as ee,bQ as ae,d0 as fe,aI as Te,S as he,M as ke,cM as K,ec as je,ei as De,al as Ue,U as Be,ax as Ze,j as ze,A as Ee,cC as ye}from"./jwt-decode.esm.61303404.js";import{C as Fe,A as Pe,k as Ve,a as Re,g as Le}from"./router.4e9af2db.js";import{p as Oe,T as Ke}from"./tables.54716cfb.js";import{T as We}from"./TableCard.27df0856.js";import{_ as qe}from"./TablesTabs.vue_vue_type_script_setup_true_lang.97a543b0.js";import{u as X}from"./uuid.5cc48935.js";import{D as Ge}from"./PhFileArrowUp.vue.1bedbfc4.js";import{read as _e,utils as be}from"./xlsx.89ea120e.js";import{u as Je}from"./useTables.314cf13e.js";import"./record.2b5c88ab.js";import"./PhCopySimple.vue.81c62022.js";import"./index.656e3803.js";import"./PhKey.vue.400b04a5.js";import"./PhPencil.vue.fac68ae7.js";import"./vue-flow-core.ab6dcb23.js";import"./Card.5534a705.js";(function(){try{var I=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(I._sentryDebugIds=I._sentryDebugIds||{},I._sentryDebugIds[v]="629404aa-6c5e-4d02-afd7-a642d29de53d",I._sentryDebugIdIdentifier="sentry-dbid-629404aa-6c5e-4d02-afd7-a642d29de53d")}catch{}})();const Qe=["width","height","fill","transform"],Ye={key:0},He=C("path",{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},null,-1),Xe=[He],ea={key:1},aa=C("path",{d:"M192,112a80,80,0,1,1-80-80A80,80,0,0,1,192,112Z",opacity:"0.2"},null,-1),ta=C("path",{d:"M229.66,218.34,179.6,168.28a88.21,88.21,0,1,0-11.32,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"},null,-1),la=[aa,ta],na={key:2},sa=C("path",{d:"M168,112a56,56,0,1,1-56-56A56,56,0,0,1,168,112Zm61.66,117.66a8,8,0,0,1-11.32,0l-50.06-50.07a88,88,0,1,1,11.32-11.31l50.06,50.06A8,8,0,0,1,229.66,229.66ZM112,184a72,72,0,1,0-72-72A72.08,72.08,0,0,0,112,184Z"},null,-1),oa=[sa],ra={key:3},ia=C("path",{d:"M228.24,219.76l-51.38-51.38a86.15,86.15,0,1,0-8.48,8.48l51.38,51.38a6,6,0,0,0,8.48-8.48ZM38,112a74,74,0,1,1,74,74A74.09,74.09,0,0,1,38,112Z"},null,-1),da=[ia],ua={key:4},pa=C("path",{d:"M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"},null,-1),ma=[pa],ca={key:5},fa=C("path",{d:"M226.83,221.17l-52.7-52.7a84.1,84.1,0,1,0-5.66,5.66l52.7,52.7a4,4,0,0,0,5.66-5.66ZM36,112a76,76,0,1,1,76,76A76.08,76.08,0,0,1,36,112Z"},null,-1),ya=[fa],_a={name:"PhMagnifyingGlass"},ba=ie({..._a,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(I){const v=I,F=Y("weight","regular"),A=Y("size","1em"),g=Y("color","currentColor"),$=Y("mirrored",!1),f=E(()=>{var u;return(u=v.weight)!=null?u:F}),_=E(()=>{var u;return(u=v.size)!=null?u:A}),M=E(()=>{var u;return(u=v.color)!=null?u:g}),h=E(()=>v.mirrored!==void 0?v.mirrored?"scale(-1, 1)":void 0:$?"scale(-1, 1)":void 0);return(u,S)=>(i(),x("svg",$e({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:_.value,height:_.value,fill:M.value,transform:h.value},u.$attrs),[Ie(u.$slots,"default"),f.value==="bold"?(i(),x("g",Ye,Xe)):f.value==="duotone"?(i(),x("g",ea,la)):f.value==="fill"?(i(),x("g",na,oa)):f.value==="light"?(i(),x("g",ra,da)):f.value==="regular"?(i(),x("g",ua,ma)):f.value==="thin"?(i(),x("g",ca,ya)):R("",!0)],16,Qe))}}),va={key:0},ga={class:"ant-upload-drag-icon"},ha={class:"ant-upload-text"},ka={class:"ant-upload-hint"},wa={key:1},Na={style:{"margin-top":"1rem","max-height":"60vh","overflow-y":"auto"}},xa=ie({__name:"ImportSpreadsheetsModal",props:{open:{type:Boolean},projectId:{}},emits:["update:open","success"],setup(I,{emit:v}){const F=I,A=Me.Dragger,g=E({get:()=>F.open,set:l=>v("update:open",l)}),$=U(1),f=U([]),_=U([]),M=U([]),h=U(!1),u=U(!1),S=Oe.map(l=>({label:l,value:l})),te=[{title:"",dataIndex:"selected",key:"selected",width:50},{title:r.translate("i18n_tables_original_column"),dataIndex:"originalName",key:"originalName",width:150},{title:r.translate("i18n_tables_mapped_column"),dataIndex:"mappedName",key:"mappedName",width:200},{title:r.translate("i18n_tables_column_type"),dataIndex:"type",key:"type",width:120},{title:r.translate("i18n_tables_sample_value"),dataIndex:"sample",key:"sample",width:150}],q=l=>D(l,!0),G=l=>D(l,!1),le=l=>l==null?"(empty)":typeof l=="object"?JSON.stringify(l).substring(0,50):String(l).substring(0,50),k=l=>{const n=l.filter(t=>t!=null&&t!=="");return n.length===0?"text":n.every(t=>!isNaN(Number(t)))?"numeric":n.every(t=>t===!0||t===!1||t==="true"||t==="false"||t===1||t===0)?"boolean":n.every(t=>!isNaN(Date.parse(t)))?"date":"text"},d=l=>(l.type==="text/csv"||l.type==="application/vnd.ms-excel"||l.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||K.error(r.translate("i18n_tables_invalid_file_type")),!1),ne=l=>{const n=f.value.indexOf(l);n>-1&&f.value.splice(n,1)},m=async l=>new Promise((n,a)=>{const y=new FileReader;y.onload=p=>{var t;try{const c=(t=p.target)==null?void 0:t.result,T=_e(c,{type:"string"}),se=T.SheetNames[0],B=T.Sheets[se],Z=be.sheet_to_json(B,{defval:null});if(Z.length===0){a(new Error("Empty file"));return}const de=Object.keys(Z[0]).map(V=>{const Q=Z.map(j=>j[V]);return{id:X(),selected:!0,originalName:V,mappedName:D(V,!1),type:k(Q),sample:Q.find(j=>j!=null&&j!=="")||null}}),oe={selected:!0,fileName:l.name,sheetName:null,tableName:D(l.name.replace(/\.csv$/i,""),!1),columns:de,previewData:Z.slice(0,5),rawData:Z};n([oe])}catch(c){a(c)}},y.onerror=a,y.readAsText(l.originFileObj)}),we=async l=>new Promise((n,a)=>{const y=new FileReader;y.onload=p=>{var t;try{const c=new Uint8Array((t=p.target)==null?void 0:t.result),T=_e(c,{type:"array"}),se=T.SheetNames.map(B=>{const Z=T.Sheets[B],P=be.sheet_to_json(Z,{defval:null});if(P.length===0)return null;const oe=Object.keys(P[0]).map(j=>{const ue=P.map(O=>O[j]);return{id:X(),selected:!0,originalName:j,mappedName:D(j,!1),type:k(ue),sample:ue.find(O=>O!=null&&O!=="")||null}}),V=D(l.name.replace(/\.(xlsx|xls)$/i,""),!1),Q=T.SheetNames.length===1?V:`${V}_${D(B,!1)}`;return{selected:!0,fileName:l.name,sheetName:B,tableName:Q,columns:oe,previewData:P.slice(0,5),rawData:P}}).filter(B=>B!==null);n(se)}catch(c){a(c)}},y.onerror=a,y.readAsArrayBuffer(l.originFileObj)}),Ne=async()=>{h.value=!0,_.value=[];try{for(const l of f.value){const n=l.name.toLowerCase();let a=[];n.endsWith(".csv")?a=await m(l):(n.endsWith(".xlsx")||n.endsWith(".xls"))&&(a=await we(l)),_.value.push(...a)}_.value.length>0?(M.value=[0],$.value=2):K.error(r.translate("i18n_tables_no_valid_sheets"))}catch(l){console.error("Error processing files:",l),K.error(r.translate("i18n_tables_import_error"))}finally{h.value=!1}},xe=l=>l.columns.map(n=>({title:n.mappedName,dataIndex:n.originalName,key:n.originalName,width:150,ellipsis:!0})),Ce=E(()=>{const l=_.value.filter(n=>n.selected);return l.length>0&&l.every(n=>{const a=n.columns.filter(y=>y.selected);return n.tableName.trim()!==""&&a.length>0&&a.every(y=>y.mappedName.trim()!=="")})}),Se=async()=>{u.value=!0;try{const n={tables:_.value.filter(a=>a.selected).map(a=>{const y={id:X(),name:"id",type:"uuid",primaryKey:!0,nullable:!1,unique:!0,default:"gen_random_uuid()"},p=a.columns.filter(t=>t.selected);return{id:X(),name:a.tableName,columns:[y,...p.map(t=>({id:t.id,name:t.mappedName,type:t.type,primaryKey:!1,nullable:!0,unique:!1,default:""}))],data:a.rawData.map(t=>{const c={};return p.forEach(T=>{c[T.mappedName]=t[T.originalName]}),c})}})};await Ve.post(`projects/${F.projectId}/tables/restore`,{tables:n.tables}),K.success(r.translate("i18n_tables_import_success")),J(),v("success")}catch(l){console.error("Error importing tables:",l),K.error(r.translate("i18n_tables_import_error"))}finally{u.value=!1}},Ae=()=>{$.value=1},J=()=>{g.value=!1,$.value=1,f.value=[],_.value=[],M.value=[],h.value=!1,u.value=!1};return(l,n)=>(i(),b(e(ke),{open:g.value,"onUpdate:open":n[4]||(n[4]=a=>g.value=a),title:e(r).translate("i18n_tables_import_spreadsheets"),width:800,footer:null,onCancel:J},{default:s(()=>[$.value===1?(i(),x("div",va,[o(e(W),{type:"secondary"},{default:s(()=>[w(N(e(r).translate("i18n_tables_import_description")),1)]),_:1}),o(e(A),{"file-list":f.value,"onUpdate:fileList":n[0]||(n[0]=a=>f.value=a),"before-upload":d,remove:ne,accept:".csv,.xlsx,.xls",multiple:"",style:{"margin-top":"1rem"}},{default:s(()=>[C("p",ga,[o(e(Ge),{size:48})]),C("p",ha,N(e(r).translate("i18n_tables_upload_click_or_drag")),1),C("p",ka,N(e(r).translate("i18n_tables_upload_supported_formats")),1)]),_:1},8,["file-list"]),o(e(L),{justify:"flex-end",gap:"small",style:{"margin-top":"1rem"}},{default:s(()=>[o(z,{onClick:J},{default:s(()=>[w(" Cancel ")]),_:1}),o(z,{type:"primary",disabled:f.value.length===0,loading:h.value,onClick:Ne},{default:s(()=>[w(" Next ")]),_:1},8,["disabled","loading"])]),_:1})])):R("",!0),$.value===2?(i(),x("div",wa,[o(e(W),{type:"secondary"},{default:s(()=>[w(N(e(r).translate("i18n_tables_import_mapping_description")),1)]),_:1}),o(e(he),{spinning:h.value},{default:s(()=>[C("div",Na,[o(e(Fe),{"active-key":M.value,"onUpdate:activeKey":n[3]||(n[3]=a=>M.value=a),accordion:""},{default:s(()=>[(i(!0),x(re,null,ve(_.value,(a,y)=>(i(),b(e(Pe),{key:y,disabled:!a.selected,style:H({opacity:a.selected?1:.6})},{header:s(()=>[o(e(L),{align:"center",gap:"small",onClick:n[2]||(n[2]=me(()=>{},["stop"]))},{default:s(()=>[o(e(ce),{checked:a.selected,"onUpdate:checked":p=>a.selected=p,onClick:n[1]||(n[1]=me(()=>{},["stop"]))},null,8,["checked","onUpdate:checked"]),C("span",{style:H({textDecoration:a.selected?"none":"line-through",color:a.selected?"inherit":"#999"})},N(a.fileName)+" "+N(a.sheetName?`- ${a.sheetName}`:""),5)]),_:2},1024)]),default:s(()=>[a.selected?(i(),b(e(ge),{key:0,layout:"vertical"},{default:s(()=>[o(e(ee),{label:e(r).translate("i18n_tables_table_name")},{default:s(()=>[o(e(ae),{value:a.tableName,"onUpdate:value":p=>a.tableName=p,placeholder:e(r).translate("i18n_tables_enter_table_name"),onBlur:p=>a.tableName=G(a.tableName),onInput:p=>a.tableName=q(a.tableName)},null,8,["value","onUpdate:value","placeholder","onBlur","onInput"])]),_:2},1032,["label"]),o(e(ee),{label:e(r).translate("i18n_tables_columns")},{default:s(()=>[o(e(fe),{columns:te,"data-source":a.columns,pagination:!1,size:"small"},{bodyCell:s(({column:p,record:t})=>[p.key==="selected"?(i(),b(e(ce),{key:0,checked:t.selected,"onUpdate:checked":c=>t.selected=c},null,8,["checked","onUpdate:checked"])):p.key==="originalName"?(i(),b(e(W),{key:1,code:"",style:H({textDecoration:t.selected?"none":"line-through",opacity:t.selected?1:.5})},{default:s(()=>[w(N(t.originalName),1)]),_:2},1032,["style"])):p.key==="mappedName"?(i(),b(e(ae),{key:2,value:t.mappedName,"onUpdate:value":c=>t.mappedName=c,size:"small",disabled:!t.selected,onBlur:c=>t.mappedName=G(t.mappedName),onInput:c=>t.mappedName=q(t.mappedName)},null,8,["value","onUpdate:value","disabled","onBlur","onInput"])):p.key==="type"?(i(),b(e(Te),{key:3,value:t.type,"onUpdate:value":c=>t.type=c,size:"small",style:{width:"100%"},disabled:!t.selected,options:e(S)},null,8,["value","onUpdate:value","disabled","options"])):p.key==="sample"?(i(),b(e(W),{key:4,type:"secondary",style:H([{"font-size":"12px"},{opacity:t.selected?1:.5}])},{default:s(()=>[w(N(le(t.sample)),1)]),_:2},1032,["style"])):R("",!0)]),_:2},1032,["data-source"])]),_:2},1032,["label"]),o(e(ee),{label:e(r).translate("i18n_tables_preview")},{default:s(()=>[o(e(fe),{columns:xe(a),"data-source":a.previewData,pagination:!1,scroll:{x:"max-content",y:200},size:"small"},null,8,["columns","data-source"])]),_:2},1032,["label"])]),_:2},1024)):R("",!0)]),_:2},1032,["disabled","style"]))),128))]),_:1},8,["active-key"])])]),_:1},8,["spinning"]),o(e(L),{justify:"space-between",style:{"margin-top":"1rem"}},{default:s(()=>[o(z,{onClick:Ae},{default:s(()=>[w(" Back ")]),_:1}),o(e(L),{gap:"small"},{default:s(()=>[o(z,{onClick:J},{default:s(()=>[w(" Cancel ")]),_:1}),o(z,{type:"primary",disabled:!Ce.value,loading:u.value,onClick:Se},{default:s(()=>[w(N(e(r).translate("i18n_tables_import")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})])):R("",!0)]),_:1},8,["open","title"]))}}),Ca={key:1,style:{padding:"1rem"}},Sa={style:{flex:"1"}},Wa=ie({__name:"Tables",setup(I){const v=je(),A=De().params.projectId,{tables:g,loading:$,fetchTables:f}=Je(A),_=U(""),M=E(()=>{if(!g.value)return[];if(!_.value)return g.value;const k=_.value.toLowerCase();return g.value.filter(d=>d.name.toLowerCase().includes(k))}),h=U(!1),u=U(!1),S=Ue({name:""}),te=k=>D(k,!0),q=k=>D(k,!1),G=async()=>{const k=await Ke.create(A,S.name);h.value=!1,S.name="",v.push({name:"tableEditor",params:{tableId:k.id,projectId:A}})},le=()=>{f(!0)};return Be(()=>{const k=pe.subscribe("tableCreated",()=>{f(!0)});Ze(()=>{pe.unsubscribe(k)})}),(k,d)=>{const ne=ze("RouterLink");return i(),x(re,null,[o(qe),e($)?(i(),b(e(he),{key:0,style:{width:"100%","margin-top":"2rem"}})):(i(),x("div",Ca,[o(e(L),{justify:"space-between",align:"center",style:{"margin-bottom":"1rem"}},{default:s(()=>[C("div",Sa,[o(e(Ee),{level:3},{default:s(()=>[w(N(e(r).translate("i18n_tables_tables")),1)]),_:1}),o(e(W),{type:"secondary"},{default:s(()=>[w(N(e(r).translate("i18n_tables_description")),1)]),_:1})]),o(e(L),{gap:"small"},{default:s(()=>[o(z,{onClick:d[0]||(d[0]=m=>u.value=!0)},{default:s(()=>[w(N(e(r).translate("i18n_tables_import_spreadsheets")),1)]),_:1}),o(z,{type:"primary",onClick:d[1]||(d[1]=m=>h.value=!0)},{default:s(()=>[w(N(e(r).translate("i18n_tables_create_table")),1)]),_:1})]),_:1})]),_:1}),e(g)&&e(g).length>0?(i(),b(e(ae),{key:0,value:_.value,"onUpdate:value":d[2]||(d[2]=m=>_.value=m),placeholder:e(r).translate("i18n_tables_search_placeholder"),"allow-clear":"",style:{"margin-bottom":"1rem","max-width":"400px"}},{prefix:s(()=>[o(e(ba),{size:16})]),_:1},8,["value","placeholder"])):R("",!0),!e(g)||e(g).length===0?(i(),b(e(ye),{key:1,description:e(r).translate("i18n_tables_empty_title")},null,8,["description"])):M.value.length===0?(i(),b(e(ye),{key:2,description:e(r).translate("i18n_tables_no_match")},null,8,["description"])):(i(),b(e(Le),{key:3,gutter:[16,16]},{default:s(()=>[(i(!0),x(re,null,ve(M.value,m=>(i(),b(e(Re),{key:m.id,xs:24,sm:24,md:12,lg:12,xl:8,xxl:8},{default:s(()=>[o(ne,{to:`/projects/${e(A)}/tables/${m.id}`,style:{"text-decoration":"none",color:"inherit"}},{default:s(()=>[o(We,{table:m,"project-id":e(A),"show-edit-button":!1},null,8,["table","project-id"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1}))])),o(e(ke),{open:h.value,"onUpdate:open":d[6]||(d[6]=m=>h.value=m),title:e(r).translate("i18n_tables_create_table"),onOk:G,onCancel:d[7]||(d[7]=m=>h.value=!1)},{default:s(()=>[o(e(ge),{model:S,layout:"vertical"},{default:s(()=>[o(e(ee),{label:e(r).translate("i18n_tables_table_name"),name:"name"},{default:s(()=>[o(e(ae),{value:S.name,"onUpdate:value":d[3]||(d[3]=m=>S.name=m),placeholder:e(r).translate("i18n_tables_enter_table_name"),onBlur:d[4]||(d[4]=m=>S.name=q(S.name)),onInput:d[5]||(d[5]=m=>S.name=te(S.name))},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"]),o(xa,{open:u.value,"onUpdate:open":d[8]||(d[8]=m=>u.value=m),"project-id":e(A),onSuccess:le},null,8,["open","project-id"])],64)}}});export{Wa as default};
//# sourceMappingURL=Tables.be7ecb0d.js.map

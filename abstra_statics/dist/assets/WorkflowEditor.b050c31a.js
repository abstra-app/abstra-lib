var Ue=Object.defineProperty;var Ge=(t,e,s)=>e in t?Ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var ne=(t,e,s)=>(Ge(t,typeof e!="symbol"?e+"":e,s),s);import{g as qe,W as Je,w as Qe}from"./controller.1e43fb32.js";import{a as He}from"./asyncComputed.bbefd3c2.js";import{d as T,D as R,f as x,o as n,Y as k,$ as V,S,e8 as ge,a as A,b as d,w as c,u as o,aS as O,eb as ie,c as $,dh as Y,dc as Q,aG as P,e9 as N,da as et,ec as j,cO as tt,bT as be,a0 as se,e as z,g as fe,bB as he,aW as Ve,ed as $e,Z as W,X as Ae,ah as Ce,bL as ve,cz as pe,cy as Le,cL as ot,et as at,O as te,en as Pe,aB as me,eA as st,d9 as nt,ey as lt,ez as it,el as rt,eG as dt,eH as ct}from"./index.5e2c2a8a.js";import{u as K,P as ut,_ as pt,a as gt,b as ft,g as Fe,c as le,N as vt,d as yt,M as ht,e as mt}from"./vue-flow-core.8652a7d7.js";import"./linters.2228902a.js";import{W as ue}from"./workspaces.6a16114f.js";import{U as kt,G as wt}from"./UnsavedChangesHandler.91896f1c.js";import{w as Se,s as _t}from"./metadata.a17c06d5.js";import{A as we}from"./index.f1458328.js";import{A as bt}from"./index.d1d4e6b7.js";import{_ as $t,a as At}from"./vue-flow-minimap.3edd4c6a.js";import{G as Ct}from"./PhArrowCounterClockwise.vue.2a46e726.js";import{T as St}from"./TasksManager.768b3660.js";import{a as Dt,b as xt,n as It}from"./validations.16ced1fd.js";import{A as Et}from"./index.508cb60f.js";import{t as Ne}from"./index.98021bf5.js";import{B as Mt}from"./Badge.485f3795.js";import{G as Te}from"./PhArrowDown.vue.45489dda.js";import"./uuid.794214d3.js";import"./workspaceStore.fce60b26.js";import"./url.44371966.js";import"./colorHelpers.535e2fed.js";import"./record.1f070708.js";import"./ExclamationCircleOutlined.25735cd2.js";import"./PhRobot.vue.d907514a.js";import"./PhWebhooksLogo.vue.91d8001f.js";import"./tasksController.0aa6b290.js";import"./gateway.8ed23255.js";import"./popupNotifcation.1380a197.js";import"./scripts.2e4e6151.js";import"./polling.ceaa2aa3.js";import"./string.bda982c1.js";import"./ant-design.17cf1bf7.js";import"./PhArrowSquareOut.vue.323c2f13.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.85ce41fd.js";import"./Card.503c22b6.js";import"./TabPane.b24376d1.js";import"./CollapsePanel.d3ce7c97.js";import"./index.ed3d81a0.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="753481c9-db51-4ce1-8ded-9a2f89f90190",t._sentryDebugIdIdentifier="sentry-dbid-753481c9-db51-4ce1-8ded-9a2f89f90190")}catch{}})();const zt=["width","height","fill","transform"],Bt={key:0},Tt=A("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Ht=[Tt],Vt={key:1},Lt=A("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Pt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Ft=[Lt,Pt],Nt={key:2},Zt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),Ot=[Zt],jt={key:3},Rt=A("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),Kt=[Rt],Xt={key:4},Yt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Wt=[Yt],Ut={key:5},Gt=A("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),qt=[Gt],Jt={name:"PhArrowClockwise"},Qt=T({...Jt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,s=R("weight","regular"),a=R("size","1em"),l=R("color","currentColor"),v=R("mirrored",!1),u=x(()=>{var f;return(f=e.weight)!=null?f:s}),h=x(()=>{var f;return(f=e.size)!=null?f:a}),w=x(()=>{var f;return(f=e.color)!=null?f:l}),r=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:v?"scale(-1, 1)":void 0);return(f,y)=>(n(),k("svg",ge({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:w.value,transform:r.value},f.$attrs),[V(f.$slots,"default"),u.value==="bold"?(n(),k("g",Bt,Ht)):u.value==="duotone"?(n(),k("g",Vt,Ft)):u.value==="fill"?(n(),k("g",Nt,Ot)):u.value==="light"?(n(),k("g",jt,Kt)):u.value==="regular"?(n(),k("g",Xt,Wt)):u.value==="thin"?(n(),k("g",Ut,qt)):S("",!0)],16,zt))}}),eo=["width","height","fill","transform"],to={key:0},oo=A("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),ao=[oo],so={key:1},no=A("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),lo=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),io=[no,lo],ro={key:2},co=A("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),uo=[co],po={key:3},go=A("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),fo=[go],vo={key:4},yo=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),ho=[yo],mo={key:5},ko=A("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),wo=[ko],_o={name:"PhFunnel"},bo=T({..._o,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,s=R("weight","regular"),a=R("size","1em"),l=R("color","currentColor"),v=R("mirrored",!1),u=x(()=>{var f;return(f=e.weight)!=null?f:s}),h=x(()=>{var f;return(f=e.size)!=null?f:a}),w=x(()=>{var f;return(f=e.color)!=null?f:l}),r=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:v?"scale(-1, 1)":void 0);return(f,y)=>(n(),k("svg",ge({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:w.value,transform:r.value},f.$attrs),[V(f.$slots,"default"),u.value==="bold"?(n(),k("g",to,ao)):u.value==="duotone"?(n(),k("g",so,io)):u.value==="fill"?(n(),k("g",ro,uo)):u.value==="light"?(n(),k("g",po,fo)):u.value==="regular"?(n(),k("g",vo,ho)):u.value==="thin"?(n(),k("g",mo,wo)):S("",!0)],16,eo))}});class De{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const J=t=>De.isMac?t.metaKey:t.ctrlKey,$o=t=>t.altKey,Ze=t=>t.shiftKey,ke={alt:$o,"arrow-up":t=>t.code==="ArrowUp","arrow-down":t=>t.code==="ArrowDown","arrow-left":t=>t.code==="ArrowLeft","arrow-right":t=>t.code==="ArrowRight",ctrl:J,delete:t=>De.isMac?t.code==="Backspace":t.code==="Delete",enter:t=>t.code==="Enter",escape:t=>t.code==="Escape",shift:Ze,space:t=>t.code==="Space",a:t=>t.code==="KeyA",b:t=>t.code==="KeyB",c:t=>t.code==="KeyC",d:t=>t.code==="KeyD",f:t=>t.code==="KeyF",g:t=>t.code==="KeyG",h:t=>t.code==="KeyH",k:t=>t.code==="KeyK",p:t=>t.code==="KeyP",v:t=>t.code==="KeyV",x:t=>t.code==="KeyX",z:t=>t.code==="KeyZ",0:t=>t.code==="Digit0","[":t=>t.code==="BracketLeft","]":t=>t.code==="BracketRight"};class Ao{constructor(e){ne(this,"pressedKeys");ne(this,"evt");this.evt=e,this.pressedKeys={};const s=a=>l=>{Object.keys(ke).forEach(v=>{ke[v](l)&&this.setPressed(v,a)})};this.evt||(window.addEventListener("keydown",s(!0)),window.addEventListener("keyup",s(!1)))}setPressed(e,s){this.pressedKeys[e]=s}isPressed(e){var s;return this.evt?ke[e](this.evt):(s=this.pressedKeys[e])!=null?s:!1}}new Ao;const Co=["onDragstart"],So={style:{display:"flex","flex-direction":"column","max-width":"250px"}},Do=T({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){return(s,a)=>(n(),k(O,null,[d(o(Y),{class:"toolbar",align:"center"},{default:c(()=>[(n(!0),k(O,null,ie(o(Se).stages,l=>(n(),$(o(tt),{key:l.key,placement:"top"},{title:c(()=>[d(o(Y),{gap:"small"},{default:c(()=>[d(o(Q),null,{default:c(()=>[P(N(l.title),1)]),_:2},1024),d(o(Q),{keyboard:""},{default:c(()=>[P(N(l.key),1)]),_:2},1024)]),_:2},1024)]),content:c(()=>[A("div",So,[d(o(Q),null,{default:c(()=>[P(N(l.description),1)]),_:2},1024),l.beta?(n(),$(o(we),{key:0,type:"warning",class:"beta-alert"},{description:c(()=>[d(o(Q),null,{default:c(()=>[P(" This is a beta feature, "),d(o(et),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:c(()=>[P(" click here ")]),_:1}),P(" to learn more about it ")]),_:1})]),_:1})):S("",!0)])]),default:c(()=>[A("div",{draggable:!0,class:"toolbar__item",onDragstart:v=>e("drag-start",v.dataTransfer,l.typeName)},[(n(),$(j(l.icon),{size:18}))],40,Co)]),_:2},1024))),128)),d(o(bt),{type:"vertical"}),d(o(be),{disabled:!s.controller.hasChanges(),onClick:a[0]||(a[0]=l=>s.controller.save())},{default:c(()=>[d(o(Y),{align:"center",gap:"small"},{default:c(()=>[d(o(wt),{size:16}),P(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),d(kt,{"has-changes":s.controller.hasChanges()},null,8,["has-changes"])],64))}});const xo=se(Do,[["__scopeId","data-v-8abfff78"]]);function Oe(){let t;const e={draggedType:z(null),isDragOver:z(!1),isAdding:z(!1),isDragging:z(!1),mousePosition:z(null)},{draggedType:s,isDragOver:a,isDragging:l,isAdding:v}=e,u=b=>{t=b,document.addEventListener("mousemove",D)},{screenToFlowCoordinate:h}=K();fe(v,b=>{document.body.style.userSelect=b?"none":""});function w(b,B){v.value=!0,b?(b.setData("application/vueflow",B),b.effectAllowed="move",s.value=B,l.value=!0,document.addEventListener("drop",y)):(s.value=B,document.addEventListener("click",g))}function r(b){b.preventDefault(),s.value&&(a.value=!0,b.dataTransfer&&(b.dataTransfer.dropEffect="move"))}function f(){a.value=!1}function y(){v.value=!1,l.value=!1,a.value=!1,s.value=null,document.removeEventListener("drop",y)}function D(b){const B={x:b.pageX-200,y:b.pageY-80};e.mousePosition.value=B}function p(b){if(!s.value)throw new Error("No dragged type");return h({x:b.clientX-70,y:b.clientY-25})}function g(b){if(!t)return;if(!s.value)throw new Error("No dragged type");const B=p(b);t.addStages([{type:s.value,position:B}]),y()}function M(){document.removeEventListener("mousemove",D)}return{init:u,tearDown:M,draggedType:s,isDragOver:a,isAdding:v,isDragging:l,mousePosition:e.mousePosition,onDragStart:w,onDragLeave:f,onDragOver:r,onDrop:g}}const Io={name:"ControlButton",compatConfig:{MODE:3}},Eo=(t,e)=>{const s=t.__vccOpts||t;for(const[a,l]of e)s[a]=l;return s},Mo={class:"vue-flow__controls-button"};function zo(t,e,s,a,l,v){return n(),k("button",Mo,[V(t.$slots,"default")])}const ae=Eo(Io,[["render",zo]]),Bo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},To=A("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),Ho=[To];function Vo(t,e){return n(),k("svg",Bo,Ho)}const Lo={render:Vo},Po={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Fo=A("path",{d:"M0 0h32v4.2H0z"},null,-1),No=[Fo];function Zo(t,e){return n(),k("svg",Po,No)}const Oo={render:Zo},jo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ro=A("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Ko=[Ro];function Xo(t,e){return n(),k("svg",jo,Ko)}const Yo={render:Xo},Wo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Uo=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Go=[Uo];function qo(t,e){return n(),k("svg",Wo,Go)}const Jo={render:qo},Qo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ea=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),ta=[ea];function oa(t,e){return n(),k("svg",Qo,ta)}const aa={render:oa},sa={name:"Controls",compatConfig:{MODE:3}},na=T({...sa,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>ut.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:s,nodesConnectable:a,elementsSelectable:l,setInteractive:v,zoomIn:u,zoomOut:h,fitView:w,viewport:r,minZoom:f,maxZoom:y}=K(),D=he(()=>s.value||a.value||l.value),p=he(()=>r.value.zoom<=f.value),g=he(()=>r.value.zoom>=y.value);function M(){u(),e("zoomIn")}function b(){h(),e("zoomOut")}function B(){w(t.fitViewParams),e("fitView")}function L(){v(!D.value),e("interactionChange",!D.value)}return(C,Z)=>(n(),$(o(pt),{class:"vue-flow__controls",position:C.position},{default:c(()=>[V(C.$slots,"top"),C.showZoom?(n(),k(O,{key:0},[V(C.$slots,"control-zoom-in",{},()=>[d(ae,{class:"vue-flow__controls-zoomin",disabled:g.value,onClick:M},{default:c(()=>[V(C.$slots,"icon-zoom-in",{},()=>[(n(),$(j(o(Lo))))])]),_:3},8,["disabled"])]),V(C.$slots,"control-zoom-out",{},()=>[d(ae,{class:"vue-flow__controls-zoomout",disabled:p.value,onClick:b},{default:c(()=>[V(C.$slots,"icon-zoom-out",{},()=>[(n(),$(j(o(Oo))))])]),_:3},8,["disabled"])])],64)):S("",!0),C.showFitView?V(C.$slots,"control-fit-view",{key:1},()=>[d(ae,{class:"vue-flow__controls-fitview",onClick:B},{default:c(()=>[V(C.$slots,"icon-fit-view",{},()=>[(n(),$(j(o(Yo))))])]),_:3})]):S("",!0),C.showInteractive?V(C.$slots,"control-interactive",{key:2},()=>[C.showInteractive?(n(),$(ae,{key:0,class:"vue-flow__controls-interactive",onClick:L},{default:c(()=>[D.value?V(C.$slots,"icon-unlock",{key:0},()=>[(n(),$(j(o(aa))))]):S("",!0),D.value?S("",!0):V(C.$slots,"icon-lock",{key:1},()=>[(n(),$(j(o(Jo))))])]),_:3})):S("",!0)]):S("",!0),V(C.$slots,"default")]),_:3},8,["position"]))}}),la=T({__name:"ControlButtons",props:{workflow:{}},setup(t){return(e,s)=>(n(),$(o(na),{position:"top-left","show-interactive":!1},{default:c(()=>[d(o(ae),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:s[0]||(s[0]=a=>e.workflow.history.undo())},{default:c(()=>[d(o(Ct))]),_:1},8,["disabled"]),d(o(ae),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:s[1]||(s[1]=a=>e.workflow.history.redo())},{default:c(()=>[d(o(Qt))]),_:1},8,["disabled"])]),_:1}))}});class ia{constructor(e,s){ne(this,"dx");ne(this,"dy");this.dx=s.x-e.x,this.dy=s.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function ra(t,e,s=0){const{x:a,y:l}=e.center,{width:v,height:u}=e,h=new ia(t,e.center),w=s*(h.x/h.length),r=s*(h.y/h.length),f=u/v;let y,D;if(Math.abs(h.m)>Math.abs(f)){const p=u/2*(1/h.m);y=a-(h.y>0?p:-p),D=l+(h.y>0?-u/2:u/2)}else{const p=v/2*h.m;y=a+(h.x>0?-v/2:v/2),D=l-(h.x>0?p:-p)}return{x:y+w,y:D+r}}const da=(t,e=0,s=0)=>{const a=Math.atan2(t.ty-t.sy,t.tx-t.sx),l=e*Math.sin(a),v=e*Math.cos(a),u=s*Math.cos(a),h=s*Math.sin(a);return{sourceX:t.sx-l+u,sourceY:t.sy+v+h,targetX:t.tx-l-u,targetY:t.ty+v-h}};function _e(t,e,s=0){const a={x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},v={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return ra(a,v,s)}function je(t,e){const s=_e(t,e,-10),a=_e(e,t,-10);return{sx:a.x,sy:a.y,tx:s.x,ty:s.y}}const ca=T({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,s)=>(n(),$(o(Y),{vertical:"",gap:"small",style:W({marginBottom:`-${16*e.menuOptions.length}%`})},{default:c(()=>[(n(!0),k(O,null,ie(e.menuOptions,a=>(n(),$(o(Ve),{key:a.label,title:a.tooltip,placement:"right"},{default:c(()=>[d(o(be),{class:$e([{"warning-button":a.warning}]),disabled:a.disabled,style:W({backgroundColor:a.disabled?"#f5f5f5":void 0}),onClick:l=>a.click(l)},{default:c(()=>[d(o(Y),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:c(()=>[P(N(a.label)+" ",1),a.key?(n(),$(o(Q),{key:0,keyboard:"",disabled:a.disabled},{default:c(()=>[P(N(a.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const ua=T({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,s=[{label:"Edit task type",key:"T",click:()=>l.value="editing"},{label:"Delete",key:"Del",click:()=>D(e.data.id)}],a=z(e.data.props.taskType||""),l=z("idle"),v=()=>{l.value!=="idle"&&(a.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:a.value}),l.value="idle")},{onEdgeClick:u,onPaneClick:h,getSelectedEdges:w}=K();u(p=>{p.edge.id===e.id&&l.value==="idle"&&(l.value="selected")}),h(()=>v());const r=x(()=>je(e.sourceNode,e.targetNode)),f=x(()=>Fe(da(r.value))),y=p=>{!w.value.map(g=>g.id).includes(e.data.id)||(p.key==="Enter"&&v(),(p.key==="t"||p.key==="T")&&(l.value="editing"))},{removeEdges:D}=K();return Ae(()=>window.addEventListener("keydown",y)),Ce(()=>window.removeEventListener("keydown",y)),(p,g)=>(n(),k(O,null,[d(o(gt),{path:f.value[0],"marker-end":p.markerEnd},null,8,["path","marker-end"]),d(o(ft),null,{default:c(()=>[l.value==="idle"?(n(),k("div",{key:0,style:W({transform:`translate(-50%, -50%) translate(${f.value[1]}px,${f.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(n(),$(o(Q),{key:1},{default:c(()=>[P(N(e.data.props.taskType),1)]),_:1})):(n(),$(o(bo),{key:0,size:16}))],4)):l.value==="selected"?(n(),k("div",{key:1,style:W({transform:`translate(-50%, -120%) translate(${f.value[1]}px,${f.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[d(ca,{"is-connecting":!0,"is-editing":!0,"menu-options":s})],4)):l.value==="editing"?(n(),k("div",{key:2,style:W({transform:`translate(-50%, -50%) translate(${f.value[1]}px,${f.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[d(o(ve),{value:a.value,"onUpdate:value":g[0]||(g[0]=M=>a.value=M),placeholder:"Task type"},null,8,["value"])],4)):S("",!0)]),_:1})],64))}});const pa=se(ua,[["__scopeId","data-v-48e71e28"]]),ga={key:0},fa=A("defs",null,[A("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[A("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),va=["d"],ya=T({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,s=z(!0),{onNodeMouseEnter:a,onNodeMouseLeave:l}=K();a(w=>{w.node.id===e.sourceNode.id&&(s.value=!1)}),l(w=>{w.node.id===e.sourceNode.id&&(s.value=!0)});const v=x(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),u=x(()=>je(e.sourceNode,v.value)),h=x(()=>Fe({sourceX:u.value.sx,sourceY:u.value.sy,targetX:u.value.tx,targetY:u.value.ty}));return(w,r)=>s.value?(n(),k("g",ga,[fa,A("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:h.value[0],"marker-end":"url(#arrowhead)"},null,8,va)])):S("",!0)}}),ha=T({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const s=t,a=x(()=>{const l=Dt(s.filename);return l.valid?s.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:l});return(l,v)=>(n(),$(o(ot),{open:l.creatingFileStatus==="prompting"||l.creatingFileStatus==="creating",closable:!1,"confirm-loading":l.creatingFileStatus==="creating",onOk:v[1]||(v[1]=u=>e("create-file",l.filename)),onCancel:v[2]||(v[2]=u=>e("cancel"))},{default:c(()=>[d(o(Le),{layout:"vertical",disabled:l.creatingFileStatus=="creating"},{default:c(()=>[d(o(pe),{label:"You're creating a new file. What should it be called?","validate-status":a.value.valid?"success":"error",help:a.value.valid?a.value.help:a.value.reason},{default:c(()=>[d(o(ve),{value:l.filename,onChange:v[0]||(v[0]=u=>e("update-filename",u.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),ma={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},ka=T({...ma,props:{nodeId:null,isVisible:{type:Boolean},position:{default:le.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,s=R(vt,null),{viewportRef:a,viewport:l,getSelectedNodes:v,findNode:u}=K();function h(p,g,M,b,B){let L=.5;B==="start"?L=0:B==="end"&&(L=1);let C=[(p.x+p.width*L)*g.zoom+g.x,p.y*g.zoom+g.y-b],Z=[-100*L,-100];switch(M){case le.Right:C=[(p.x+p.width)*g.zoom+g.x+b,(p.y+p.height*L)*g.zoom+g.y],Z=[0,-100*L];break;case le.Bottom:C[1]=(p.y+p.height)*g.zoom+g.y+b,Z[1]=0;break;case le.Left:C=[p.x*g.zoom+g.x-b,(p.y+p.height*L)*g.zoom+g.y],Z=[-100,-100*L];break}return`translate(${C[0]}px, ${C[1]}px) translate(${Z[0]}%, ${Z[1]}%)`}const w=x(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||s||""]).reduce((p,g)=>{const M=u(g);return M&&p.push(M),p},[])),r=x(()=>typeof e.isVisible=="boolean"?e.isVisible:w.value.length===1&&w.value[0].selected&&v.value.length===1),f=x(()=>yt(w.value)),y=x(()=>Math.max(...w.value.map(p=>(p.computedPosition.z||1)+1))),D=x(()=>({position:"absolute",transform:h(f.value,l.value,e.position,e.offset,e.align),zIndex:y.value}));return(p,g)=>(n(),$(at,{to:o(a),disabled:!o(a)},[o(r)&&o(w).length?(n(),k("div",ge({key:0},p.$attrs,{style:o(D),class:"vue-flow__node-toolbar"}),[V(p.$slots,"default")],16)):S("",!0)],8,["to","disabled"]))}}),wa=T({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,s)=>(n(),$(o(ka),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:o(le).Right},{default:c(()=>[d(o(Y),{vertical:"",gap:"small",style:W({marginBottom:`-${16*e.menuOptions.length}%`})},{default:c(()=>[(n(!0),k(O,null,ie(e.menuOptions,a=>(n(),$(o(Ve),{key:a.label,title:a.tooltip,placement:"right"},{default:c(()=>[d(o(be),{class:$e([{"warning-button":a.warning}]),disabled:a.disabled,style:W({backgroundColor:a.disabled?"#f5f5f5":void 0}),onClick:l=>a.click(l)},{default:c(()=>[d(o(Y),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:c(()=>[P(N(a.label)+" ",1),a.key?(n(),$(o(Q),{key:0,keyboard:"",disabled:a.disabled},{default:c(()=>[P(N(a.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const _a=T({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(t,{emit:e}){const s=t,a=z(!1),l=te.object({title:te.string(),clientStageId:te.string().uuid(),inputSchemas:te.any(),outputSchemas:te.any()});fe(()=>s.stageProps.projectId,()=>{a.value=!0,f()});const v=te.array(l),{result:u,loading:h,refetch:w,error:r}=He(async()=>{const g=s.stageProps.projectId;if(!g)return[];const b=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${g}`)).json();return v.parse(b)}),f=Pe.exports.debounce(()=>{a.value=!1,w()},500),y=x(()=>h.value||!u.value?[]:u.value.map(g=>({label:g.title,value:g.clientStageId})));function D(g){e("update:stage-props",{...s.stageProps,projectId:g})}function p(g){const M=String(g);!u.value||e("update:stage-props",{...s.stageProps,clientStageId:M})}return(g,M)=>(n(),k(O,null,[d(o(pe),{label:"Project ID"},{default:c(()=>{var b;return[d(o(ve),{value:(b=g.stageProps.projectId)!=null?b:"",placeholder:"Project ID",autofocus:"","onUpdate:value":D},null,8,["value"])]}),_:1}),d(o(pe),{label:"Client entrypoint"},{default:c(()=>{var b;return[a.value||o(h)?(n(),$(o(me),{key:0,disabled:"",loading:""})):o(r)?(n(),$(o(we),{key:1,type:"error",message:"Invalid project id"})):g.stageProps.projectId?o(u).length===0?(n(),$(o(we),{key:3,type:"warning",message:"The project has no entrypoints"})):(n(),$(o(me),{key:4,options:y.value,value:(b=g.stageProps.clientStageId)!=null?b:void 0,"onUpdate:value":p},null,8,["options","value"])):(n(),$(o(me),{key:2,disabled:""}))]}),_:1})],64))}}),ba=T({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Be;const e=t,{useToken:s}=Ne,{token:a}=s(),l=a.value.colorText,v=[{label:"Add transition",key:"T",click:i=>Ie(i)},{label:"Rename",key:"R",click:()=>F.value=!0},{label:"Go to editor",key:"Enter",click:()=>xe()},{label:"Tasks",key:"M",click:()=>h.value=!0},{label:"Delete",key:"Del",click:()=>I(e.stage)}],u=x(()=>{let i=[...v];return w.value||i.unshift({label:"Create missing file",warning:!0,click:()=>B()}),e.controller.hasChanges()&&(i=i.map(_=>_.label==="Go to editor"?{..._,disabled:!0,tooltip:"Save it to allow editing"}:_)),(e.stage.type==="agents"||e.stage.type==="clients")&&(i=i.filter(_=>!["Create missing file","Go to editor","Tasks"].includes(_.label))),i}),h=z(!1),w=z(e.initialFileCheck);fe(()=>e.initialFileCheck,i=>{w.value=i});const r=i=>{p.value=i,D()},f=i=>{e.controller.updateStageProps(e.stage.id,i)},y=()=>{var i;g.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(p.value=(i=e.stage.props.filename)!=null?i:"",D())},D=Pe.exports.debounce(async()=>{const i=p.value;if(!i){w.value=!0;return}ue.checkFile(i).then(_=>{w.value=_.exists})},500),p=z((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Be=e.stage.props.filename)!=null?Be:""),g=z("idle"),M=async()=>{g.value="creating",await ue.initFile(p.value,e.stage.type),w.value=!0;const i=await ue.checkFile(p.value);if(w.value=i.exists,g.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:p.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:p.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},b=x(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!w.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),B=()=>{g.value="prompting"},{startConnection:L,updateConnection:C,onNodeClick:Z,addEdges:re,endConnection:m,removeNodes:I,onPaneClick:E,getSelectedNodes:U,flowToScreenCoordinate:X,onNodeMouseEnter:de,onNodeMouseLeave:ce,getNodes:Ke,onNodesChange:Xe,applyNodeChanges:Ye}=K(),We=st(),G=z(!1),F=z(!1),q=z(e.stage.title),ye=z(!1);Xe(async i=>{var H;const _=[];for(const ee of i)ee.type==="remove"?F.value||((H=e.controller)==null||H.delete([ee.id]),_.push(ee)):_.push(ee);Ye(_)});const xe=()=>{const i=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);We.push({path:`/_editor/${i}/${e.stage.id}`})},Ie=(i,_=!0)=>{L({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:_?i.pageX-180:i.pageX-90,y:_?i.pageY-50:i.pageY-20}),document.addEventListener("mousemove",Ee),G.value=!0},Ee=i=>{G.value&&!ye.value&&C({x:i.pageX-180,y:i.pageY-52})};Z(i=>{if(i.node.id===e.stage.id&&D(),G.value&&i.node.id!==e.stage.id){const _={sourceStageId:e.stage.id,targetStageId:i.node.id,type:"task",id:qe(),props:{taskType:null}};try{e.controller.connect([_]),document.removeEventListener("mousemove",Ee),re({id:_.id,source:e.stage.id,target:i.node.id,type:"task",markerEnd:{type:ht.Arrow,width:24,height:24},data:_}),m(),G.value=!1}catch(H){console.error(H)}}}),de(i=>{if(G.value&&i.node.id!==e.stage.id){ye.value=!0;const _=Ke.value.find(ee=>ee.id===e.stage.id);if(!_)return;const H=_e(_,i.node,-10);C(X({x:H.x-180,y:H.y-52}))}}),ce(()=>{ye.value=!1});const Me=()=>{if(!w.value){const i=xt(q.value+".py");p.value=i;let _={filename:i,path:null};if(["forms","hooks"].includes(e.stage.type)){const H=It(q.value);_={..._,path:H}}e.controller.updateStageProps(e.stage.id,_)}};E(()=>{F.value=!1,e.stage.title!==q.value&&(e.controller.updateStageTitle(e.stage.id,q.value),Me()),G.value=!1,m()});const ze=i=>{if(!!U.value.map(_=>_.id).includes(e.stage.id)&&g.value==="idle"){if(i.key==="Enter")if(F.value)F.value=!1,e.controller.updateStageTitle(e.stage.id,q.value),Me();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;xe()}if(!F.value){if(i.key==="t"||i.key==="T"){const _=X(e.stage.position);Ie({pageX:_.x,pageY:_.y},!1)}(i.key==="r"||i.key==="R")&&(F.value=!0),(i.key==="m"||i.key==="M")&&(h.value=!0)}}};return Ae(()=>{window.addEventListener("keydown",ze)}),Ce(()=>{window.removeEventListener("keydown",ze)}),(i,_)=>(n(),k(O,null,[d(wa,{"is-connecting":G.value,"is-editing":F.value,"menu-options":u.value},null,8,["is-connecting","is-editing","menu-options"]),A("div",{class:"stage",onDblclick:_[1]||(_[1]=H=>F.value=!0)},[d(o(Y),{vertical:F.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:c(()=>[(n(),$(j(o(_t)(i.stage.type)),{size:18,color:o(l)},null,8,["color"])),F.value?(n(),$(o(Le),{key:1,layout:"vertical"},{default:c(()=>[d(o(pe),{label:"Title"},{default:c(()=>[d(o(ve),{value:q.value,"onUpdate:value":_[0]||(_[0]=H=>q.value=H),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),i.stage.type==="agents"?(n(),$(_a,{key:0,"stage-props":i.stage.props,"onUpdate:stageProps":f},null,8,["stage-props"])):S("",!0)]),_:1})):(n(),$(o(nt),{key:0,class:"title"},{default:c(()=>[P(N(i.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),b.value?(n(),$(o(Mt),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):S("",!0),g.value==="prompting"||g.value==="creating"?(n(),$(ha,{key:1,filename:p.value,"file-exists":w.value,"creating-file-status":g.value,onCreateFile:M,onCancel:y,onUpdateFilename:r},null,8,["filename","file-exists","creating-file-status"])):S("",!0),d(o(Et),{visible:h.value,"onUpdate:visible":_[2]||(_[2]=H=>h.value=H),title:"Tasks",width:"500",onClose:_[3]||(_[3]=H=>h.value=!1)},{default:c(()=>[d(St,{"stage-id":i.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const oe=se(ba,[["__scopeId","data-v-7c8c886c"]]),Re=t=>(lt("data-v-f4278104"),t=t(),it(),t),$a={class:"empty-hint"},Aa={key:0,class:"drag-hint"},Ca=Re(()=>A("div",{class:"title"},"Start here",-1)),Sa={key:1,class:"drop-hint"},Da=Re(()=>A("div",{class:"title"},"Drop here",-1)),xa={key:2,class:"stages-hint"},Ia={class:"header"},Ea={class:"title"},Ma={class:"description"},za=T({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,s)=>(n(),k("div",$a,[e.showDragHint?(n(),k("div",Aa,[Ca,d(o(Te),{size:32,class:"arrow"})])):S("",!0),e.showDragHint?S("",!0):(n(),k("div",Sa,[Da,d(o(Te),{size:32,class:"arrow"})])),e.showDragHint?(n(),k("div",xa,[(n(!0),k(O,null,ie(o(Se).stages,a=>(n(),k("div",{key:a.key,class:"stage-hint"},[A("div",Ia,[(n(),$(j(a.icon))),A("span",Ea,N(a.title),1)]),A("div",Ma,N(a.description),1)]))),128))])):S("",!0)]))}});const Ba=se(za,[["__scopeId","data-v-f4278104"]]),Ta=T({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;rt(r=>({ecafe25e:o(u),"3094d9cc":o(v)}));const s=Oe(),{useToken:a}=Ne,{token:l}=a(),v=l.value.colorPrimaryBorder,u=l.value.colorBgElevated,{onInit:h}=K();h(r=>{r.fitView()});const w=r=>{var f;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:r&&(f=e.initialFileCheckStatus[r])!=null?f:!1};return(r,f)=>r.workflow?(n(),$(o(mt),{key:0,nodes:r.workflow.vueFlowNodes.value,edges:r.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":r.editable,"pan-on-scroll":o(De).isMac,"elements-selectable":r.editable,"snap-to-grid":"","apply-default":!1,onDragover:o(s).onDragOver,onDragleave:o(s).onDragLeave},{"connection-line":c(y=>[d(ya,dt(ct(y)),null,16)]),"edge-task":c(y=>[d(pa,ge(y,{controller:r.workflow}),null,16,["controller"])]),"node-forms":c(y=>[d(oe,{stage:y.data,node:y,controller:r.workflow,"initial-file-check":w(y.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":c(y=>[d(oe,{stage:y.data,node:y,controller:r.workflow,"initial-file-check":w(y.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":c(y=>[d(oe,{stage:y.data,node:y,controller:r.workflow,"initial-file-check":w(y.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":c(y=>[d(oe,{stage:y.data,node:y,controller:r.workflow,"initial-file-check":w(y.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":c(y=>[d(oe,{stage:y.data,node:y,controller:r.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":c(y=>[d(oe,{stage:y.data,node:y,controller:r.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:c(()=>[d(o($t)),r.editable&&!r.workflow.vueFlowNodes.value.length?(n(),$(Ba,{key:0,"show-drag-hint":r.showDragHint},null,8,["show-drag-hint"])):S("",!0),d(o(At),{pannable:"",zoomable:""}),r.editable?(n(),$(la,{key:1,workflow:r.workflow},null,8,["workflow"])):S("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):S("",!0)}});const Ha=se(Ta,[["__scopeId","data-v-d709f269"]]),Va=T({__name:"WorkflowEditor",setup(t){const{init:e,tearDown:s,onDragStart:a,onDrop:l,isDragging:v,isAdding:u,draggedType:h,mousePosition:w}=Oe(),{result:r}=He(async()=>await Je.init(Qe,!0)),f=z(null),y=async()=>{if(!r.value)return;const m=r.value.vueFlowNodes.value.map(I=>{var E,U,X,de,ce;return((E=I.data)==null?void 0:E.type)==="forms"||((U=I.data)==null?void 0:U.type)==="hooks"||((X=I.data)==null?void 0:X.type)==="scripts"||((de=I.data)==null?void 0:de.type)==="jobs"?(ce=I.data)==null?void 0:ce.props.filename:null});f.value=await ue.checkFiles(m.filter(I=>typeof I=="string"))};fe(()=>r.value,()=>{r.value&&(e(r.value),y())});const{onNodeDragStop:D,onEdgesChange:p,getSelectedElements:g,getNodes:M,addSelectedNodes:b,zoomIn:B,fitView:L,zoomOut:C,applyEdgeChanges:Z}=K();D(m=>{var I;(I=r.value)==null||I.move(m.nodes.map(E=>({id:E.id,position:E.position})))}),p(m=>{var I;for(const E of m)E.type==="remove"&&((I=r.value)==null||I.delete([E.id]));Z(m)});const re=m=>{var I,E;!r.value||((m.key==="z"||m.key==="Z")&&J(m)&&(Ze(m)?r.value.history.redo():(I=r.value)==null||I.history.undo(),m.preventDefault()),J(m)&&(m.key==="s"||m.key==="S")&&((E=r.value)==null||E.save(),m.preventDefault()),!g.value.length&&(m.key==="f"||m.key==="F"?a(null,"forms"):m.key==="h"||m.key==="H"?a(null,"hooks"):m.key==="j"||m.key==="J"?a(null,"jobs"):m.key==="o"||m.key==="O"?a(null,"scripts"):(m.key==="a"||m.key==="A")&&J(m)?(b(M.value),m.preventDefault()):m.key==="0"&&J(m)?(L(),m.preventDefault()):(m.key==="="||m.key==="+")&&J(m)?(m.preventDefault(),B()):m.key==="-"&&J(m)&&(m.preventDefault(),C())))};return Ae(()=>{window.addEventListener("keydown",re)}),Ce(()=>{window.removeEventListener("keydown",re),s()}),(m,I)=>o(r)?(n(),k("div",{key:0,class:$e(["workflow-container",{dragging:o(u)}]),onDrop:I[0]||(I[0]=(...E)=>o(l)&&o(l)(...E))},[d(Ha,{workflow:o(r),editable:"","show-drag-hint":!o(u),"check-file-status":!0,"initial-file-check-status":f.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),d(xo,{controller:o(r),onDragStart:o(a)},null,8,["controller","onDragStart"]),(n(!0),k(O,null,ie(o(Se).stages,E=>{var U,X;return n(),k("div",{key:E.key},[o(u)&&!o(v)&&E.typeName===o(h)?(n(),k("div",{key:0,class:"dragging-node",style:W({left:`${(U=o(w))==null?void 0:U.x}px`,top:`${(X=o(w))==null?void 0:X.y}px`,position:"absolute",cursor:o(u)?"grabbing":"grab"})},[(n(),$(j(E.icon),{size:18}))],4)):S("",!0)])}),128))],34)):S("",!0)}});const $s=se(Va,[["__scopeId","data-v-5f802ac0"]]);export{$s as default};
//# sourceMappingURL=WorkflowEditor.b050c31a.js.map

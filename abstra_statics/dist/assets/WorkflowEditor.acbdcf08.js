var vt=Object.defineProperty;var ht=(t,e,a)=>e in t?vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var ke=(t,e,a)=>(ht(t,typeof e!="symbol"?e+"":e,a),a);import{g as yt,W as mt,w as wt}from"./controller.783e3b46.js";import{o as ae,u as kt}from"./omniChatStore.2c2f2b25.js";import{a as xe}from"./asyncComputed.ac08d7c2.js";import{d as Z,af as X,g as V,o as i,K as y,O as N,F as S,e5 as me,a as b,e as _t,f as I,b as g,w as d,u as n,aL as R,ea as ge,c as _,da as ee,d5 as oe,az as F,eb as U,d3 as We,ei as Q,cH as bt,bM as he,Q as re,h as $e,bu as Se,am as Ge,aP as Re,ec as Ee,N as ne,J as Ce,a8 as ze,bE as ye,cs as _e,cr as qe,cE as Ke,eA as $t,B as ce,ej as Je,bs as Ct,bq as Ue,bK as Ht,au as Ie,e3 as At,d2 as Mt,bH as Vt,eP as St,eQ as It,eo as xt,aj as Dt,ep as Et,eq as zt}from"./index.6d326114.js";import{u as q,P as Ft,_ as Pt,g as Qe,a as Tt,b as Bt,c as fe,N as Lt,e as Zt,M as Nt,f as jt}from"./index.ee7c7b0a.js";import"./linters.993e3ea4.js";import{W as ve}from"./workspaces.7e1beae4.js";import{U as Ut,G as Ot}from"./UnsavedChangesHandler.6e37d333.js";import{w as be,s as Yt}from"./metadata.6ff498e4.js";import{A as Xt}from"./index.1fa988b1.js";import{A as De}from"./index.f4139f06.js";import{_ as Wt,a as Gt}from"./vue-flow-minimap.04c31e9b.js";import{G as Rt}from"./PhArrowCounterClockwise.vue.b72a6553.js";import{F as qt,C as Kt}from"./filesController.567107a7.js";import{T as Jt}from"./TasksManager.85accab8.js";import{n as Qt}from"./string.25635cc7.js";import{a as ea,b as ta,n as aa}from"./validations.48fc00e4.js";import{u as oa}from"./editor.4b1f69bd.js";import"./index.6df7a2a7.js";import{A as na}from"./index.a8154c0f.js";import{t as et}from"./index.30b61eba.js";import{B as sa}from"./Badge.733db12f.js";import{G as Oe}from"./PhArrowDown.vue.9bf66bc8.js";import"./uuid.557af65e.js";import"./record.4f4568da.js";import"./runnerData.cd569ed1.js";import"./url.fae55cc5.js";import"./colorHelpers.5f920bdf.js";import"./ExclamationCircleOutlined.4d63af6f.js";import"./PhWebhooksLogo.vue.01c73189.js";import"./tasksController.9ed9ba5f.js";import"./gateway.021cd409.js";import"./popupNotifcation.a72e377f.js";import"./scripts.bb71e014.js";import"./polling.9a0b0237.js";import"./ant-design.258a2496.js";import"./PhArrowSquareOut.vue.18a163fb.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.6d7ef170.js";import"./Card.9b236a44.js";import"./TabPane.80adead7.js";import"./CollapsePanel.29a81b1f.js";import"./userStore.f4e7e35e.js";import"./workspaceStore.94f8f1b9.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="a32d6e36-d6ad-453c-9e6e-205df594510f",t._sentryDebugIdIdentifier="sentry-dbid-a32d6e36-d6ad-453c-9e6e-205df594510f")}catch{}})();const la=["width","height","fill","transform"],ia={key:0},ra=b("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),ua=[ra],da={key:1},ca=b("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),pa=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ga=[ca,pa],fa={key:2},va=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),ha=[va],ya={key:3},ma=b("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),wa=[ma],ka={key:4},_a=b("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),ba=[_a],$a={key:5},Ca=b("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),Ha=[Ca],Aa={name:"PhArrowClockwise"},Ma=Z({...Aa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=X("weight","regular"),s=X("size","1em"),l=X("color","currentColor"),p=X("mirrored",!1),u=V(()=>{var o;return(o=e.weight)!=null?o:a}),k=V(()=>{var o;return(o=e.size)!=null?o:s}),m=V(()=>{var o;return(o=e.color)!=null?o:l}),v=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:p?"scale(-1, 1)":void 0);return(o,C)=>(i(),y("svg",me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:m.value,transform:v.value},o.$attrs),[N(o.$slots,"default"),u.value==="bold"?(i(),y("g",ia,ua)):u.value==="duotone"?(i(),y("g",da,ga)):u.value==="fill"?(i(),y("g",fa,ha)):u.value==="light"?(i(),y("g",ya,wa)):u.value==="regular"?(i(),y("g",ka,ba)):u.value==="thin"?(i(),y("g",$a,Ha)):S("",!0)],16,la))}}),Va=["width","height","fill","transform"],Sa={key:0},Ia=b("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),xa=[Ia],Da={key:1},Ea=b("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),za=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Fa=[Ea,za],Pa={key:2},Ta=b("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),Ba=[Ta],La={key:3},Za=b("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Na=[Za],ja={key:4},Ua=b("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),Oa=[Ua],Ya={key:5},Xa=b("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),Wa=[Xa],Ga={name:"PhFunnel"},Ra=Z({...Ga,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=X("weight","regular"),s=X("size","1em"),l=X("color","currentColor"),p=X("mirrored",!1),u=V(()=>{var o;return(o=e.weight)!=null?o:a}),k=V(()=>{var o;return(o=e.size)!=null?o:s}),m=V(()=>{var o;return(o=e.color)!=null?o:l}),v=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:p?"scale(-1, 1)":void 0);return(o,C)=>(i(),y("svg",me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:m.value,transform:v.value},o.$attrs),[N(o.$slots,"default"),u.value==="bold"?(i(),y("g",Sa,xa)):u.value==="duotone"?(i(),y("g",Da,Fa)):u.value==="fill"?(i(),y("g",Pa,Ba)):u.value==="light"?(i(),y("g",La,Na)):u.value==="regular"?(i(),y("g",ja,Oa)):u.value==="thin"?(i(),y("g",Ya,Wa)):S("",!0)],16,Va))}}),qa=["width","height","fill","transform"],Ka={key:0},Ja=b("path",{d:"M160,116h48a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20V60H128a28,28,0,0,0-28,28v28H76v-4A20,20,0,0,0,56,92H24A20,20,0,0,0,4,112v32a20,20,0,0,0,20,20H56a20,20,0,0,0,20-20v-4h24v28a28,28,0,0,0,28,28h12v12a20,20,0,0,0,20,20h48a20,20,0,0,0,20-20V160a20,20,0,0,0-20-20H160a20,20,0,0,0-20,20v12H128a4,4,0,0,1-4-4V88a4,4,0,0,1,4-4h12V96A20,20,0,0,0,160,116ZM52,140H28V116H52Zm112,24h40v40H164Zm0-112h40V92H164Z"},null,-1),Qa=[Ja],eo={key:1},to=b("path",{d:"M64,112v32a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V112a8,8,0,0,1,8-8H56A8,8,0,0,1,64,112ZM208,40H160a8,8,0,0,0-8,8V96a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V48A8,8,0,0,0,208,40Zm0,112H160a8,8,0,0,0-8,8v48a8,8,0,0,0,8,8h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152Z",opacity:"0.2"},null,-1),ao=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),oo=[to,ao],no={key:2},so=b("path",{d:"M144,96V80H128a8,8,0,0,0-8,8v80a8,8,0,0,0,8,8h16V160a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16v48a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V192H128a24,24,0,0,1-24-24V136H72v8a16,16,0,0,1-16,16H24A16,16,0,0,1,8,144V112A16,16,0,0,1,24,96H56a16,16,0,0,1,16,16v8h32V88a24,24,0,0,1,24-24h16V48a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16V96a16,16,0,0,1-16,16H160A16,16,0,0,1,144,96Z"},null,-1),lo=[so],io={key:3},ro=b("path",{d:"M160,110h48a14,14,0,0,0,14-14V48a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14V66H128a22,22,0,0,0-22,22v34H70V112A14,14,0,0,0,56,98H24a14,14,0,0,0-14,14v32a14,14,0,0,0,14,14H56a14,14,0,0,0,14-14V134h36v34a22,22,0,0,0,22,22h18v18a14,14,0,0,0,14,14h48a14,14,0,0,0,14-14V160a14,14,0,0,0-14-14H160a14,14,0,0,0-14,14v18H128a10,10,0,0,1-10-10V88a10,10,0,0,1,10-10h18V96A14,14,0,0,0,160,110ZM58,144a2,2,0,0,1-2,2H24a2,2,0,0,1-2-2V112a2,2,0,0,1,2-2H56a2,2,0,0,1,2,2Zm100,16a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2v48a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Zm0-112a2,2,0,0,1,2-2h48a2,2,0,0,1,2,2V96a2,2,0,0,1-2,2H160a2,2,0,0,1-2-2Z"},null,-1),uo=[ro],co={key:4},po=b("path",{d:"M160,112h48a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16V64H128a24,24,0,0,0-24,24v32H72v-8A16,16,0,0,0,56,96H24A16,16,0,0,0,8,112v32a16,16,0,0,0,16,16H56a16,16,0,0,0,16-16v-8h32v32a24,24,0,0,0,24,24h16v16a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V160a16,16,0,0,0-16-16H160a16,16,0,0,0-16,16v16H128a8,8,0,0,1-8-8V88a8,8,0,0,1,8-8h16V96A16,16,0,0,0,160,112ZM56,144H24V112H56v32Zm104,16h48v48H160Zm0-112h48V96H160Z"},null,-1),go=[po],fo={key:5},vo=b("path",{d:"M160,108h48a12,12,0,0,0,12-12V48a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12V68H128a20,20,0,0,0-20,20v36H68V112a12,12,0,0,0-12-12H24a12,12,0,0,0-12,12v32a12,12,0,0,0,12,12H56a12,12,0,0,0,12-12V132h40v36a20,20,0,0,0,20,20h20v20a12,12,0,0,0,12,12h48a12,12,0,0,0,12-12V160a12,12,0,0,0-12-12H160a12,12,0,0,0-12,12v20H128a12,12,0,0,1-12-12V88a12,12,0,0,1,12-12h20V96A12,12,0,0,0,160,108ZM60,144a4,4,0,0,1-4,4H24a4,4,0,0,1-4-4V112a4,4,0,0,1,4-4H56a4,4,0,0,1,4,4Zm96,16a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4v48a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Zm0-112a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V96a4,4,0,0,1-4,4H160a4,4,0,0,1-4-4Z"},null,-1),ho=[vo],yo={name:"PhTreeStructure"},mo=Z({...yo,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=X("weight","regular"),s=X("size","1em"),l=X("color","currentColor"),p=X("mirrored",!1),u=V(()=>{var o;return(o=e.weight)!=null?o:a}),k=V(()=>{var o;return(o=e.size)!=null?o:s}),m=V(()=>{var o;return(o=e.color)!=null?o:l}),v=V(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:p?"scale(-1, 1)":void 0);return(o,C)=>(i(),y("svg",me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:k.value,height:k.value,fill:m.value,transform:v.value},o.$attrs),[N(o.$slots,"default"),u.value==="bold"?(i(),y("g",Ka,Qa)):u.value==="duotone"?(i(),y("g",eo,oo)):u.value==="fill"?(i(),y("g",no,lo)):u.value==="light"?(i(),y("g",io,uo)):u.value==="regular"?(i(),y("g",co,go)):u.value==="thin"?(i(),y("g",fo,ho)):S("",!0)],16,qa))}});class tt{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const K=t=>tt.isMac?t.metaKey:t.ctrlKey,wo=t=>t.shiftKey;class ko{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const Ye=new ko;class He{constructor(e){this.dto=e}static async listConnections(){return(await Ye.listConnections()).map(a=>new He(a))}static async getIsUsageMode(){return await Ye.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const at=_t("agents-usage-mode",()=>{const t=I(!1);return(async()=>{t.value=await He.getIsUsageMode()})(),{agentUsageMode:t}}),_o=["onDragstart"],bo={style:{display:"flex","flex-direction":"column","max-width":"250px"}},$o=Z({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){const a=at(),s=V(()=>a.agentUsageMode?be.stages:be.stages.filter(l=>!["agents","clients"].includes(l.typeName)));return(l,p)=>(i(),y(R,null,[g(n(ee),{class:"toolbar",align:"center"},{default:d(()=>[(i(!0),y(R,null,ge(s.value,u=>(i(),_(n(bt),{key:u.key,placement:"top"},{title:d(()=>[g(n(ee),{gap:"small"},{default:d(()=>[g(n(oe),null,{default:d(()=>[F(U(u.title),1)]),_:2},1024),g(n(oe),{keyboard:""},{default:d(()=>[F(U(u.key),1)]),_:2},1024)]),_:2},1024)]),content:d(()=>[b("div",bo,[g(n(oe),null,{default:d(()=>[F(U(u.description),1)]),_:2},1024),u.beta?(i(),_(n(De),{key:0,type:"warning",class:"beta-alert"},{description:d(()=>[g(n(oe),null,{default:d(()=>[F(" This is a beta feature, "),g(n(We),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:d(()=>[F(" click here ")]),_:1}),F(" to learn more about it ")]),_:1})]),_:1})):S("",!0)])]),default:d(()=>[b("div",{draggable:!0,class:"toolbar__item",onDragstart:k=>e("drag-start",k.dataTransfer,u.typeName)},[(i(),_(Q(u.icon),{size:18}))],40,_o)]),_:2},1024))),128)),g(n(Xt),{type:"vertical"}),g(n(he),{disabled:!l.controller.hasChanges(),onClick:p[0]||(p[0]=u=>l.controller.save())},{default:d(()=>[g(n(ee),{align:"center",gap:"small"},{default:d(()=>[g(n(Ot),{size:16}),F(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),g(Ut,{"has-changes":l.controller.hasChanges()},null,8,["has-changes"])],64))}});const Co=re($o,[["__scopeId","data-v-d855dff0"]]);function ot(){let t;const e={draggedType:I(null),isDragOver:I(!1),isAdding:I(!1),isDragging:I(!1),mousePosition:I(null)},{draggedType:a,isDragOver:s,isDragging:l,isAdding:p}=e,u=A=>{t=A,document.addEventListener("mousemove",c)},{screenToFlowCoordinate:k}=q();$e(p,A=>{document.body.style.userSelect=A?"none":""});function m(A,T){p.value=!0,A?(A.setData("application/vueflow",T),A.effectAllowed="move",a.value=T,l.value=!0,document.addEventListener("drop",C)):(a.value=T,document.addEventListener("click",H))}function v(A){A.preventDefault(),a.value&&(s.value=!0,A.dataTransfer&&(A.dataTransfer.dropEffect="move"))}function o(){s.value=!1}function C(){p.value=!1,l.value=!1,s.value=!1,a.value=null,document.removeEventListener("drop",C)}function c(A){const T={x:A.pageX-200,y:A.pageY-80};e.mousePosition.value=T}function f(A){if(!a.value)throw new Error("No dragged type");return k({x:A.clientX-70,y:A.clientY-25})}function H(A){if(!t)return;if(!a.value)throw new Error("No dragged type");const T=f(A);t.addStages([{type:a.value,position:T}]),C()}function P(){document.removeEventListener("mousemove",c)}return{init:u,tearDown:P,draggedType:a,isDragOver:s,isAdding:p,isDragging:l,mousePosition:e.mousePosition,onDragStart:m,onDragLeave:o,onDragOver:v,onDrop:H}}const Ho={name:"ControlButton",compatConfig:{MODE:3}},Ao=(t,e)=>{const a=t.__vccOpts||t;for(const[s,l]of e)a[s]=l;return a},Mo={class:"vue-flow__controls-button"};function Vo(t,e,a,s,l,p){return i(),y("button",Mo,[N(t.$slots,"default")])}const ie=Ao(Ho,[["render",Vo]]),So={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Io=b("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),xo=[Io];function Do(t,e){return i(),y("svg",So,xo)}const Eo={render:Do},zo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Fo=b("path",{d:"M0 0h32v4.2H0z"},null,-1),Po=[Fo];function To(t,e){return i(),y("svg",zo,Po)}const Bo={render:To},Lo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Zo=b("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),No=[Zo];function jo(t,e){return i(),y("svg",Lo,No)}const Uo={render:jo},Oo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Yo=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Xo=[Yo];function Wo(t,e){return i(),y("svg",Oo,Xo)}const Go={render:Wo},Ro={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},qo=b("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),Ko=[qo];function Jo(t,e){return i(),y("svg",Ro,Ko)}const Qo={render:Jo},en={name:"Controls",compatConfig:{MODE:3}},tn=Z({...en,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>Ft.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:a,nodesConnectable:s,elementsSelectable:l,setInteractive:p,zoomIn:u,zoomOut:k,fitView:m,viewport:v,minZoom:o,maxZoom:C}=q(),c=Se(()=>a.value||s.value||l.value),f=Se(()=>v.value.zoom<=o.value),H=Se(()=>v.value.zoom>=C.value);function P(){u(),e("zoomIn")}function A(){k(),e("zoomOut")}function T(){m(t.fitViewParams),e("fitView")}function B(){p(!c.value),e("interactionChange",!c.value)}return(M,x)=>(i(),_(n(Pt),{class:"vue-flow__controls",position:M.position},{default:d(()=>[N(M.$slots,"top"),M.showZoom?(i(),y(R,{key:0},[N(M.$slots,"control-zoom-in",{},()=>[g(ie,{class:"vue-flow__controls-zoomin",disabled:H.value,onClick:P},{default:d(()=>[N(M.$slots,"icon-zoom-in",{},()=>[(i(),_(Q(n(Eo))))])]),_:3},8,["disabled"])]),N(M.$slots,"control-zoom-out",{},()=>[g(ie,{class:"vue-flow__controls-zoomout",disabled:f.value,onClick:A},{default:d(()=>[N(M.$slots,"icon-zoom-out",{},()=>[(i(),_(Q(n(Bo))))])]),_:3},8,["disabled"])])],64)):S("",!0),M.showFitView?N(M.$slots,"control-fit-view",{key:1},()=>[g(ie,{class:"vue-flow__controls-fitview",onClick:T},{default:d(()=>[N(M.$slots,"icon-fit-view",{},()=>[(i(),_(Q(n(Uo))))])]),_:3})]):S("",!0),M.showInteractive?N(M.$slots,"control-interactive",{key:2},()=>[M.showInteractive?(i(),_(ie,{key:0,class:"vue-flow__controls-interactive",onClick:B},{default:d(()=>[c.value?N(M.$slots,"icon-unlock",{key:0},()=>[(i(),_(Q(n(Qo))))]):S("",!0),c.value?S("",!0):N(M.$slots,"icon-lock",{key:1},()=>[(i(),_(Q(n(Go))))])]),_:3})):S("",!0)]):S("",!0),N(M.$slots,"default")]),_:3},8,["position"]))}}),an=Z({__name:"ControlButtons",props:{workflow:{}},setup(t){const e=t,{fitView:a}=q(),s=()=>{e.workflow.autoLayout(),Ge(()=>{a()})};return(l,p)=>(i(),_(n(tn),{position:"top-left","show-interactive":!1},{default:d(()=>[g(n(ie),{title:"Auto layout",onClick:p[0]||(p[0]=u=>s())},{default:d(()=>[g(n(mo))]),_:1}),g(n(ie),{title:"Undo",disabled:!l.workflow.history.canUndo(),onClick:p[1]||(p[1]=u=>l.workflow.history.undo())},{default:d(()=>[g(n(Rt))]),_:1},8,["disabled"]),g(n(ie),{title:"Redo",disabled:!l.workflow.history.canRedo(),onClick:p[2]||(p[2]=u=>l.workflow.history.redo())},{default:d(()=>[g(n(Ma))]),_:1},8,["disabled"])]),_:1}))}});class Y{constructor(e){ke(this,"angle");e=Y.normalize(e),this.angle=e}static normalize(e){const a=Math.PI;return((e+a)%(2*a)+2*a)%(2*a)-a}static fromRadians(e){return new Y(Y.normalize(e))}static fromDegrees(e){const a=e*Math.PI/180;return new Y(a)}static fromPoints(e,a){const s=a.x-e.x,l=a.y-e.y,p=Math.atan2(l,s);return new Y(p)}get degrees(){return this.angle*180/Math.PI}get radians(){return this.angle}get isZero(){return this.angle===0}get isPositive(){return this.angle>0}get complementary(){return new Y(Math.PI/2-this.angle)}get perpendicular(){return new Y(Math.PI/2+this.angle)}get sin(){return Math.sin(this.angle)}get cos(){return Math.cos(this.angle)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new Y(this.angle/e)}multiply(e){return new Y(this.angle*e)}}class J{constructor(e,a){ke(this,"dx");ke(this,"dy");this.dx=e,this.dy=a}static fromPoints(e,a){const s=a.x-e.x,l=a.y-e.y;return new J(s,l)}static fromAngleAndLength(e,a){const s=a*e.cos,l=a*e.sin;return new J(s,l)}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}get opposite(){return new J(-this.dx,-this.dy)}divide(e){if(e===0)throw new Error("Division by zero is not allowed");return new J(this.dx/e,this.dy/e)}add(e){return new J(this.dx+e.dx,this.dy+e.dy)}subtract(e){return new J(this.dx-e.dx,this.dy-e.dy)}}function on(t,e,a=1e-10){const s=e.center.x-e.width/2,l=e.center.x+e.width/2,p=e.center.y-e.height/2,u=e.center.y+e.height/2;return t.x>=s-a&&t.x<=l+a&&t.y>=p-a&&t.y<=u+a}function Xe(t,e,a,s=1e-10){const l=a.center.x-a.width/2,p=a.center.x+a.width/2,u=a.center.y-a.height/2,k=a.center.y+a.height/2,m=e.x-t.x,v=e.y-t.y;let o=1/0,C=null;if(on(t,a,s))return null;if(Math.abs(m)>s){const c=(l-t.x)/m;if(c>0&&c<o){const f=t.y+c*v;f>=u-s&&f<=k+s&&(o=c,C={x:l,y:f})}}if(Math.abs(m)>s){const c=(p-t.x)/m;if(c>0&&c<o){const f=t.y+c*v;f>=u-s&&f<=k+s&&(o=c,C={x:p,y:f})}}if(Math.abs(v)>s){const c=(u-t.y)/v;if(c>0&&c<o){const f=t.x+c*m;f>=l-s&&f<=p+s&&(o=c,C={x:f,y:u})}}if(Math.abs(v)>s){const c=(k-t.y)/v;if(c>0&&c<o){const f=t.x+c*m;f>=l-s&&f<=p+s&&(o=c,C={x:f,y:k})}}return C}function nn(t,e,a=0,s=0){a=Math.abs(a),t.height+=a*2,t.width+=a*2,e.height+=a*2,e.width+=a*2;const l=Y.fromPoints(t.center,e.center),p=s*l.perpendicular.cos,u=s*l.perpendicular.sin,k={x:t.center.x+p,y:t.center.y+u},m={x:e.center.x+p,y:e.center.y+u};let v=Xe(k,m,e);v||(v=e.center);let o=Xe(m,k,t);return o||(o=t.center),{sourceX:o.x,sourceY:o.y,targetX:v.x,targetY:v.y}}function sn(t,e=0){const a=Y.fromPoints({x:t.sourceX,y:t.sourceY},{x:t.targetX,y:t.targetY}),s=Math.sqrt(Math.pow(t.targetX-t.sourceX,2)+Math.pow(t.targetY-t.sourceY,2)),l=Y.fromRadians(Math.atan(2*e/s)).multiply(4),p=s/2/l.divide(2).sin,u=new J(t.sourceX+t.targetX,t.sourceY+t.targetY).divide(2),k=p*(1+(l.isPositive?-1:1)*l.divide(2).cos),m=J.fromAngleAndLength(a.perpendicular,k),v=e>0===l.isPositive?u.add(m):u.subtract(m);return{sourceX:t.sourceX,sourceY:t.sourceY,targetX:t.targetX,targetY:t.targetY,labelX:v.x,labelY:v.y,radius:p,largeArcFlag:l.isPositive?0:1,sweepFlag:0}}function nt(t,e,a=0,s=0){const p={center:{x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},width:t.dimensions.width,height:t.dimensions.height},k={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return nn(p,k,a,s)}function st(t,e,a=0){return nt(t,e,10,a)}function ln(t,e,a=0){a=Math.abs(a);const s=st(t,e,a/2);if(a===0)return Qe(s);const l=sn(s,a);return[`M${l.sourceX},${l.sourceY} A${l.radius},${l.radius} 0 ${l.largeArcFlag},${l.sweepFlag} ${l.targetX},${l.targetY}`,l.labelX,l.labelY,0,0]}const rn=Z({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(i(),_(n(ee),{vertical:"",gap:"small",style:ne({marginBottom:`-${16*e.menuOptions.length}%`})},{default:d(()=>[(i(!0),y(R,null,ge(e.menuOptions,s=>(i(),_(n(Re),{key:s.label,title:s.tooltip,placement:"right"},{default:d(()=>[g(n(he),{class:Ee([{"warning-button":s.warning}]),disabled:s.disabled,style:ne({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:l=>s.click(l)},{default:d(()=>[g(n(ee),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:d(()=>[F(U(s.label)+" ",1),s.key?(i(),_(n(oe),{key:0,keyboard:"",disabled:s.disabled},{default:d(()=>[F(U(s.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const un=Z({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,a=[{label:"Edit task type",key:"E",click:()=>l.value="editing"},{label:"Delete",key:"Del",click:()=>c(e.data.id)}],s=I(e.data.props.taskType||""),l=I("idle"),p=()=>{l.value!=="idle"&&(s.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:s.value}),l.value="idle")},{onEdgeClick:u,onPaneClick:k,getSelectedEdges:m}=q();u(f=>{f.edge.id===e.id&&l.value==="idle"&&(l.value="selected")}),k(()=>p());const v=V(()=>e.controller.edgeIsLonely(e.id)?0:20),o=V(()=>ln(e.sourceNode,e.targetNode,v.value)),C=f=>{if(!!m.value.map(H=>H.id).includes(e.data.id)&&(f.key==="Enter"&&p(),(f.key==="e"||f.key==="E")&&(l.value="editing"),f.key==="Backspace"||f.key==="Delete")){if(l.value==="editing")return;c(e.data.id)}},{removeEdges:c}=q();return Ce(()=>window.addEventListener("keydown",C)),ze(()=>window.removeEventListener("keydown",C)),(f,H)=>(i(),y(R,null,[g(n(Tt),{path:o.value[0],"marker-end":f.markerEnd},null,8,["path","marker-end"]),g(n(Bt),null,{default:d(()=>[l.value==="idle"?(i(),y("div",{key:0,style:ne({transform:`translate(-50%, -50%) translate(${o.value[1]}px,${o.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(i(),_(n(oe),{key:1},{default:d(()=>[F(U(e.data.props.taskType),1)]),_:1})):(i(),_(n(Ra),{key:0,size:16}))],4)):l.value==="selected"?(i(),y("div",{key:1,style:ne({transform:`translate(-50%, -120%) translate(${o.value[1]}px,${o.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[g(rn,{"is-connecting":!0,"is-editing":!0,"menu-options":a})],4)):l.value==="editing"?(i(),y("div",{key:2,style:ne({transform:`translate(-50%, -50%) translate(${o.value[1]}px,${o.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[g(n(ye),{value:s.value,"onUpdate:value":H[0]||(H[0]=P=>s.value=P),placeholder:"Task type"},null,8,["value"])],4)):S("",!0)]),_:1})],64))}});const dn=re(un,[["__scopeId","data-v-dd919c09"]]),cn={key:0},pn=b("defs",null,[b("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[b("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),gn=["d"],fn=Z({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,a=I(!0),{onNodeMouseEnter:s,onNodeMouseLeave:l}=q();s(m=>{m.node.id===e.sourceNode.id&&(a.value=!1)}),l(m=>{m.node.id===e.sourceNode.id&&(a.value=!0)});const p=V(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),u=V(()=>st(e.sourceNode,p.value)),k=V(()=>Qe(u.value));return(m,v)=>a.value?(i(),y("g",cn,[pn,b("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:k.value[0],"marker-end":"url(#arrowhead)"},null,8,gn)])):S("",!0)}}),vn=Z({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const a=t,s=V(()=>{const l=ea(a.filename);return l.valid?a.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:l});return(l,p)=>(i(),_(n(Ke),{open:l.creatingFileStatus==="prompting"||l.creatingFileStatus==="creating",closable:!1,"confirm-loading":l.creatingFileStatus==="creating",onOk:p[1]||(p[1]=u=>e("create-file",l.filename)),onCancel:p[2]||(p[2]=u=>e("cancel"))},{default:d(()=>[g(n(qe),{layout:"vertical",disabled:l.creatingFileStatus=="creating"},{default:d(()=>[g(n(_e),{label:"You're creating a new file. What should it be called?","validate-status":s.value.valid?"success":"error",help:s.value.valid?s.value.help:s.value.reason},{default:d(()=>[g(n(ye),{value:l.filename,onChange:p[0]||(p[0]=u=>e("update-filename",u.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),hn={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},yn=Z({...hn,props:{nodeId:null,isVisible:{type:Boolean},position:{default:fe.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,a=X(Lt,null),{viewportRef:s,viewport:l,getSelectedNodes:p,findNode:u}=q();function k(f,H,P,A,T){let B=.5;T==="start"?B=0:T==="end"&&(B=1);let M=[(f.x+f.width*B)*H.zoom+H.x,f.y*H.zoom+H.y-A],x=[-100*B,-100];switch(P){case fe.Right:M=[(f.x+f.width)*H.zoom+H.x+A,(f.y+f.height*B)*H.zoom+H.y],x=[0,-100*B];break;case fe.Bottom:M[1]=(f.y+f.height)*H.zoom+H.y+A,x[1]=0;break;case fe.Left:M=[f.x*H.zoom+H.x-A,(f.y+f.height*B)*H.zoom+H.y],x=[-100,-100*B];break}return`translate(${M[0]}px, ${M[1]}px) translate(${x[0]}%, ${x[1]}%)`}const m=V(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||a||""]).reduce((f,H)=>{const P=u(H);return P&&f.push(P),f},[])),v=V(()=>typeof e.isVisible=="boolean"?e.isVisible:m.value.length===1&&m.value[0].selected&&p.value.length===1),o=V(()=>Zt(m.value)),C=V(()=>Math.max(...m.value.map(f=>(f.computedPosition.z||1)+1))),c=V(()=>({position:"absolute",transform:k(o.value,l.value,e.position,e.offset,e.align),zIndex:C.value}));return(f,H)=>(i(),_($t,{to:n(s),disabled:!n(s)},[n(v)&&n(m).length?(i(),y("div",me({key:0},f.$attrs,{style:n(c),class:"vue-flow__node-toolbar"}),[N(f.$slots,"default")],16)):S("",!0)],8,["to","disabled"]))}}),mn=Z({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(i(),_(n(yn),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:n(fe).Right},{default:d(()=>[g(n(ee),{vertical:"",gap:"small",style:ne({marginBottom:`-${16*e.menuOptions.length}%`})},{default:d(()=>[(i(!0),y(R,null,ge(e.menuOptions,s=>(i(),_(n(Re),{key:s.label,title:s.tooltip,placement:"right"},{default:d(()=>[g(n(he),{class:Ee([{"warning-button":s.warning}]),disabled:s.disabled,style:ne({backgroundColor:s.disabled?"#f5f5f5":void 0,width:"100%"}),onClick:l=>s.click(l)},{default:d(()=>[g(n(ee),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:d(()=>[F(U(s.label)+" ",1),s.key?(i(),_(n(oe),{key:0,keyboard:"",disabled:s.disabled},{default:d(()=>[F(U(s.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const wn=Z({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(t,{emit:e}){var G;const a=t,s=I(!1),p=at().agentUsageMode,u=ce.object({title:ce.string(),clientStageId:ce.string().uuid(),inputSchemas:ce.any(),outputSchemas:ce.any()});$e(()=>a.stageProps.projectId,()=>{s.value=!0,M()});const k=oa(),m=()=>{var E;const $=(E=k.cloudProject)==null?void 0:E.id;return $?`https://cloud.abstra.io/projects/${$}/agents`:""},v=ce.array(u),o=I((G=a.stageProps.projectId)!=null?G:""),C=I(!1),c=$=>f.loading.value||!f.result.value?null:f.result.value.find(E=>E.agentConnection.id===$),f=xe(async()=>He.listConnections()),H=V(()=>f.loading.value||!f.result.value?[]:f.result.value.map($=>({label:$.agentConnection.connectionName,key:$.agentConnection.id,value:$.agent.projectId}))),{result:P,loading:A,refetch:T,error:B}=xe(async()=>{const $=a.stageProps.projectId;if(!$)return[];const O=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${$}`)).json();return v.parse(O)}),M=Je.exports.debounce(()=>{s.value=!1,T()},500),x=V(()=>A.value||!P.value?[]:P.value.map($=>({label:$.title,value:$.clientStageId})));function j($){e("update:stage-props",{...a.stageProps,projectId:$,clientStageId:null})}function ue($){const E=c($.key);!E||(j(E.agent.projectId),o.value=E.agent.projectId,C.value=!1)}function w($){const E=$.target;o.value=E.value,j(E.value),C.value=!0}function D($){C.value=$}function z($){const E=String($);!P.value||e("update:stage-props",{...a.stageProps,clientStageId:E})}return($,E)=>(i(),y(R,null,[g(n(_e),{label:"Project ID"},{default:d(()=>{var O;return[n(p)?(i(),_(n(Ht),{key:0,trigger:"click",visible:C.value,onVisibleChange:D},{overlay:d(()=>[g(n(Ct),{onClick:ue},{default:d(()=>[(i(!0),y(R,null,ge(H.value,te=>(i(),_(n(Ue),{key:te.key},{default:d(()=>[F(U(te.label),1)]),_:2},1024))),128)),g(n(Ue),null,{default:d(()=>[g(n(We),{class:"cloud-link",href:m(),target:"_blank"},{default:d(()=>[F(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:d(()=>[g(n(ye),{value:o.value,"onUpdate:value":E[0]||(E[0]=te=>o.value=te),autofocus:"","allow-clear":"",onInput:w},null,8,["value"])]),_:1},8,["visible"])):(i(),_(n(ye),{key:1,value:(O=$.stageProps.projectId)!=null?O:"",placeholder:"Project ID",autofocus:"","onUpdate:value":j},null,8,["value"]))]}),_:1}),g(n(_e),{label:"Client entrypoint"},{default:d(()=>{var O;return[s.value||n(A)?(i(),_(n(Ie),{key:0,disabled:"",loading:""})):n(B)?(i(),_(n(De),{key:1,type:"error",message:"Invalid project id"})):$.stageProps.projectId?n(P).length===0?(i(),_(n(De),{key:3,type:"warning",message:"The project has no entrypoints"})):(i(),_(n(Ie),{key:4,class:"entrypoint-select",options:x.value,value:(O=$.stageProps.clientStageId)!=null?O:void 0,"onUpdate:value":z},null,8,["options","value"])):(i(),_(n(Ie),{key:2,disabled:""}))]}),_:1})],64))}});const kn=re(wn,[["__scopeId","data-v-f4d2a34d"]]),_n=Z({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var je;const e=t,{useToken:a}=et,s=At(),{token:l}=a(),p=l.value.colorText,u=[{label:"Add transition",key:"C",click:r=>Te(r)},{label:"Rename",key:"R",click:()=>W.value=!0},{label:"Go to editor",key:"Enter",click:()=>Pe()},{label:"Tasks",key:"M",click:()=>m.value=!0},{label:"Delete",key:"Del",click:()=>o.value=!0}],k=V(()=>{let r=[...u];return v.value||r.unshift({label:"Create missing file",warning:!0,click:()=>D()}),e.controller.hasChanges()&&(r=r.map(h=>h.label==="Go to editor"?{...h,disabled:!0,tooltip:"Save it to allow editing"}:h.label==="Tasks"?{...h,disabled:!0,tooltip:"Save it to allow managing tasks"}:h)),(e.stage.type==="agents"||e.stage.type==="clients")&&(r=r.filter(h=>!["Create missing file","Go to editor","Tasks"].includes(h.label))),e.stage.type==="agents"&&(r=r.map(h=>h.label==="Rename"?{...h,label:"Edit"}:h)),r}),m=I(!1),v=I(!0);$e(()=>e.initialFileCheck,r=>{B.value||(v.value=r)});const o=I(!1),C=()=>{o.value=!1,te(e.stage)},c=new Kt,f=new qt(c,{separator:"/"}),H=async()=>{if(o.value=!1,"filename"in e.stage.props&&e.stage.props.filename){const r=e.stage.props.filename;(await ve.checkFile(r)).exists&&await f.deleteFile([r])}te(e.stage)},P=r=>{x.value=r,M()},A=r=>{e.controller.updateStageProps(e.stage.id,r)},T=()=>{var r;j.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(x.value=(r=e.stage.props.filename)!=null?r:"",M())},B=V(()=>e.controller.getUnsavedFilenameStages().some(r=>r.id===e.stage.id)),M=Je.exports.debounce(async()=>{if(B.value){v.value=!0;return}const r=x.value;if(!r){v.value=!0;return}ve.checkFile(r).then(h=>{v.value=h.exists})},500),x=I((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(je=e.stage.props.filename)!=null?je:""),j=I("idle"),ue=async()=>{j.value="creating",await ve.initFile(x.value,e.stage.type),v.value=!0;const r=await ve.checkFile(x.value);if(v.value=r.exists,j.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:x.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:x.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},w=V(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!v.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),D=()=>{j.value="prompting"},{startConnection:z,updateConnection:G,onNodeClick:$,addEdges:E,endConnection:O,removeNodes:te,onPaneClick:it,getSelectedNodes:rt,flowToScreenCoordinate:Fe,onNodeMouseEnter:ut,onNodeMouseLeave:dt,getNodes:ct,onNodesChange:pt,applyNodeChanges:gt}=q(),se=I(!1),W=I(!1),le=I(e.stage.title),Ae=I(!0),we=V(()=>{const h=`${e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1)}_${Qt(le.value,!1,!0)}.py`;return h!==x.value?h:null}),Me=I(!1),Ve=I(!1);pt(async r=>{var L;const h=[];for(const de of r)de.type==="remove"?W.value||((L=e.controller)==null||L.delete([de.id]),h.push(de)):h.push(de);gt(h)});const Pe=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);Ve.value?window.open(`/_editor/${r}/${e.stage.id}`,"_blank"):s.push({path:`/_editor/${r}/${e.stage.id}`})},Te=(r,h=!0)=>{z({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:h?r.pageX:r.pageX-90,y:h?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",Be),se.value=!0},Be=r=>{se.value&&!Me.value&&G({x:r.pageX,y:r.pageY-52})};$(r=>{if(r.node.id===e.stage.id&&M(),se.value&&r.node.id!==e.stage.id){const h={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:yt(),props:{taskType:null}};try{e.controller.connect([h]),document.removeEventListener("mousemove",Be),E({id:h.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:Nt.Arrow,width:24,height:24},data:h}),O(),se.value=!1}catch(L){console.error(L)}}}),ut(r=>{if(se.value&&r.node.id!==e.stage.id){Me.value=!0;const h=ct.value.find(de=>de.id===e.stage.id);if(!h)return;const L=nt(h,r.node,10);G(Fe({x:L.targetX,y:L.targetY-52}))}}),dt(()=>{Me.value=!1});const ft=()=>{if(!v.value){const r=ta(le.value+".py");x.value=r;let h={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const L=aa(le.value);h={...h,path:L}}e.controller.updateStageProps(e.stage.id,h)}},Le=async()=>{e.stage.title!==le.value&&(e.controller.updateStageTitle(e.stage.id,le.value),Ae.value&&we.value&&(x.value=we.value,e.controller.updateStageProps(e.stage.id,{...e.stage.props,filename:x.value})),ft()),M()};it(()=>{W.value&&Le(),W.value=!1,se.value=!1,O()});const Ze=r=>{if(Ve.value=K(r),!!rt.value.map(h=>h.id).includes(e.stage.id)&&j.value==="idle"){if(r.key==="Enter")if(W.value)W.value=!1,Le();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;Pe()}if(!W.value){if(r.key==="c"||r.key==="C"){const h=Fe(e.stage.position);Te({pageX:h.x,pageY:h.y},!1)}if((r.key==="r"||r.key==="R")&&(W.value=!0),r.key==="m"||r.key==="M"){if(e.controller.hasChanges())return;m.value=!0}(r.key==="Backspace"||r.key==="Delete")&&("filename"in e.stage.props&&e.stage.props.filename?o.value=!0:te(e.stage))}}},Ne=r=>{Ve.value=K(r)};return Ce(()=>{B.value||(v.value=e.initialFileCheck),window.addEventListener("keydown",Ze),window.addEventListener("keyup",Ne)}),ze(()=>{window.removeEventListener("keydown",Ze),window.removeEventListener("keyup",Ne)}),(r,h)=>(i(),y(R,null,[g(mn,{"is-connecting":se.value,"is-editing":W.value,"menu-options":k.value},null,8,["is-connecting","is-editing","menu-options"]),g(n(Ke),{open:o.value,title:"Delete file"},{footer:d(()=>[g(n(ee),{justify:"space-between",gap:"small"},{default:d(()=>[g(n(he),{onClick:C},{default:d(()=>[F("Delete only stage")]),_:1}),g(n(he),{type:"primary",danger:"",onClick:H},{default:d(()=>[F("Yes, delete file")]),_:1})]),_:1})]),default:d(()=>[F(" Do you also want to delete the file associated with the stage "+U(r.stage.title)+"? ",1)]),_:1},8,["open"]),b("div",{class:"stage",onDblclick:h[2]||(h[2]=L=>W.value=!0)},[g(n(ee),{vertical:W.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:d(()=>[(i(),_(Q(n(Yt)(r.stage.type)),{size:18,color:n(p)},null,8,["color"])),W.value?(i(),_(n(qe),{key:1,layout:"vertical"},{default:d(()=>[g(n(_e),{label:"Title"},{default:d(()=>[g(n(ye),{value:le.value,"onUpdate:value":h[0]||(h[0]=L=>le.value=L),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),we.value?(i(),_(n(Vt),{key:0,checked:Ae.value,"onUpdate:checked":h[1]||(h[1]=L=>Ae.value=L),style:{"margin-bottom":"12px"}},{default:d(()=>[F(" Update filename to "),g(n(oe),{code:""},{default:d(()=>[F(U(we.value),1)]),_:1})]),_:1},8,["checked"])):S("",!0),r.stage.type==="agents"?(i(),_(kn,{key:1,"stage-props":r.stage.props,"onUpdate:stageProps":A},null,8,["stage-props"])):S("",!0)]),_:1})):(i(),_(n(Mt),{key:0,class:"title"},{default:d(()=>[F(U(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),w.value?(i(),_(n(sa),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):S("",!0),j.value==="prompting"||j.value==="creating"?(i(),_(vn,{key:1,filename:x.value,"file-exists":v.value,"creating-file-status":j.value,onCreateFile:ue,onCancel:T,onUpdateFilename:P},null,8,["filename","file-exists","creating-file-status"])):S("",!0),g(n(na),{visible:m.value,"onUpdate:visible":h[3]||(h[3]=L=>m.value=L),title:"Tasks",width:"500",onClose:h[4]||(h[4]=L=>m.value=!1)},{default:d(()=>[g(Jt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const pe=re(_n,[["__scopeId","data-v-802d77e7"]]),lt=t=>(St("data-v-f4278104"),t=t(),It(),t),bn={class:"empty-hint"},$n={key:0,class:"drag-hint"},Cn=lt(()=>b("div",{class:"title"},"Start here",-1)),Hn={key:1,class:"drop-hint"},An=lt(()=>b("div",{class:"title"},"Drop here",-1)),Mn={key:2,class:"stages-hint"},Vn={class:"header"},Sn={class:"title"},In={class:"description"},xn=Z({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,a)=>(i(),y("div",bn,[e.showDragHint?(i(),y("div",$n,[Cn,g(n(Oe),{size:32,class:"arrow"})])):S("",!0),e.showDragHint?S("",!0):(i(),y("div",Hn,[An,g(n(Oe),{size:32,class:"arrow"})])),e.showDragHint?(i(),y("div",Mn,[(i(!0),y(R,null,ge(n(be).stages,s=>(i(),y("div",{key:s.key,class:"stage-hint"},[b("div",Vn,[(i(),_(Q(s.icon))),b("span",Sn,U(s.title),1)]),b("div",In,U(s.description),1)]))),128))])):S("",!0)]))}});const Dn=re(xn,[["__scopeId","data-v-f4278104"]]),En=Z({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;xt(o=>({"380e1d00":n(u),"26e1693d":n(p)}));const a=ot(),{useToken:s}=et,{token:l}=s(),p=l.value.colorPrimaryBorder,u=l.value.colorBgElevated,{onInit:k,fitView:m}=q();k(o=>{o.fitView()});const v=o=>{var C;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:o&&(C=e.initialFileCheckStatus[o])!=null?C:!1};return Ce(()=>{const o=ae.subscribe("stageCreated",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),C=ae.subscribe("stageEdited",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),c=ae.subscribe("transitionCreated",async()=>{await e.workflow.refetch(),e.workflow.autoLayout()}),f=ae.subscribe("finishActions",async()=>{Ge(()=>{m()})});Dt(()=>{ae.unsubscribe(o),ae.unsubscribe(c),ae.unsubscribe(C),ae.unsubscribe(f)})}),(o,C)=>o.workflow?(i(),_(n(jt),{key:0,nodes:o.workflow.vueFlowNodes.value,edges:o.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":o.editable,"pan-on-scroll":n(tt).isMac,"elements-selectable":o.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":[],onDragover:n(a).onDragOver,onDragleave:n(a).onDragLeave},{"connection-line":d(c=>[g(fn,Et(zt(c)),null,16)]),"edge-task":d(c=>[g(dn,me(c,{controller:o.workflow}),null,16,["controller"])]),"node-forms":d(c=>[g(pe,{stage:c.data,node:c,controller:o.workflow,"initial-file-check":v(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":d(c=>[g(pe,{stage:c.data,node:c,controller:o.workflow,"initial-file-check":v(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":d(c=>[g(pe,{stage:c.data,node:c,controller:o.workflow,"initial-file-check":v(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":d(c=>[g(pe,{stage:c.data,node:c,controller:o.workflow,"initial-file-check":v(c.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":d(c=>[g(pe,{stage:c.data,node:c,controller:o.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":d(c=>[g(pe,{stage:c.data,node:c,controller:o.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:d(()=>[g(n(Wt)),o.editable&&!o.workflow.vueFlowNodes.value.length?(i(),_(Dn,{key:0,"show-drag-hint":o.showDragHint},null,8,["show-drag-hint"])):S("",!0),g(n(Gt),{pannable:"",zoomable:""}),o.editable?(i(),_(an,{key:1,workflow:o.workflow},null,8,["workflow"])):S("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):S("",!0)}});const zn=re(En,[["__scopeId","data-v-9d205dbf"]]),Fn=Z({__name:"WorkflowEditor",setup(t){const e=kt(),{init:a,tearDown:s,onDragStart:l,onDrop:p,isDragging:u,isAdding:k,draggedType:m,mousePosition:v}=ot(),{result:o}=xe(async()=>await mt.init(wt,!0)),C=I(null),c=async()=>{if(!o.value)return;const w=o.value.vueFlowNodes.value.map(D=>{var z,G,$,E,O;return((z=D.data)==null?void 0:z.type)==="forms"||((G=D.data)==null?void 0:G.type)==="hooks"||(($=D.data)==null?void 0:$.type)==="scripts"||((E=D.data)==null?void 0:E.type)==="jobs"?(O=D.data)==null?void 0:O.props.filename:null});C.value=await ve.checkFiles(w.filter(D=>typeof D=="string"))};$e(()=>o.value,()=>{o.value&&(a(o.value),c())});const{onNodeDragStop:f,onEdgesChange:H,getSelectedElements:P,getNodes:A,addSelectedNodes:T,zoomIn:B,fitView:M,zoomOut:x,applyEdgeChanges:j}=q();f(w=>{var D;(D=o.value)==null||D.move(w.nodes.map(z=>({id:z.id,position:z.position})))}),H(w=>{var D;for(const z of w)z.type==="remove"&&((D=o.value)==null||D.delete([z.id]));j(w)});const ue=w=>{var D,z;e.isInputFocused||!o.value||((w.key==="z"||w.key==="Z")&&K(w)&&(wo(w)?o.value.history.redo():(D=o.value)==null||D.history.undo(),w.preventDefault()),K(w)&&(w.key==="s"||w.key==="S")&&((z=o.value)==null||z.save(),w.preventDefault()),!(K(w)&&(w.key==="f"||w.key==="F"))&&(P.value.length||(w.key==="f"||w.key==="F"?l(null,"forms"):w.key==="h"||w.key==="H"?l(null,"hooks"):w.key==="j"||w.key==="J"?l(null,"jobs"):w.key==="t"||w.key==="T"?l(null,"scripts"):(w.key==="a"||w.key==="A")&&K(w)?(T(A.value),w.preventDefault()):w.key==="0"&&K(w)?(M(),w.preventDefault()):(w.key==="="||w.key==="+")&&K(w)?(w.preventDefault(),B()):w.key==="-"&&K(w)&&(w.preventDefault(),x()))))};return Ce(()=>{window.addEventListener("keydown",ue)}),ze(()=>{window.removeEventListener("keydown",ue),s()}),(w,D)=>n(o)?(i(),y("div",{key:0,class:Ee(["workflow-container",{dragging:n(k)}]),onDrop:D[0]||(D[0]=(...z)=>n(p)&&n(p)(...z))},[g(zn,{workflow:n(o),editable:"","show-drag-hint":!n(k),"check-file-status":!0,"initial-file-check-status":C.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),g(Co,{controller:n(o),onDragStart:n(l)},null,8,["controller","onDragStart"]),(i(!0),y(R,null,ge(n(be).stages,z=>{var G,$;return i(),y("div",{key:z.key},[n(k)&&!n(u)&&z.typeName===n(m)?(i(),y("div",{key:0,class:"dragging-node",style:ne({left:`${(G=n(v))==null?void 0:G.x}px`,top:`${($=n(v))==null?void 0:$.y}px`,position:"absolute",cursor:n(k)?"grabbing":"grab"})},[(i(),_(Q(z.icon),{size:18}))],4)):S("",!0)])}),128))],34)):S("",!0)}});const As=re(Fn,[["__scopeId","data-v-aa8dbb66"]]);export{As as default};
//# sourceMappingURL=WorkflowEditor.acbdcf08.js.map

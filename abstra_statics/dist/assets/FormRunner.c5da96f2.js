var v=Object.defineProperty;var A=(o,e,t)=>e in o?v(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var n=(o,e,t)=>(A(o,typeof e!="symbol"?e+"":e,t),t);import{i as isUrl}from"./url.42b30a4e.js";import{d as defineComponent,X as inject,H as computed,b as openBlock,eu as createElementBlock,dl as renderSlot,ew as createCommentVNode,ez as mergeProps,e as createBaseVNode,eZ as i18nProvider,c as createBlock,eD as resolveDynamicComponent,v as _export_sfc,w as withCtx,aq as createTextVNode,u as unref,eE as toDisplayString,e_ as createStaticVNode,f as createVNode,r as ref,I as watch,ey as normalizeClass,e$ as StartWidget,f0 as EndWidget,f1 as ErrorWidget,aC as Fragment,eC as renderList,bF as Button,f2 as withKeys,f3 as StyleProvider}from"./outputWidgets.f017b1ba.js";import{P as Passwordless}from"./Passwordless.e85302fa.js";import{P as PlayerNavbar}from"./PlayerNavbar.b323f789.js";import{L as LoadingIndicator}from"./CircularLoading.f397eb8b.js";import{W as WidgetsFrame}from"./WidgetsFrame.ba21a3b2.js";import{S as Steps}from"./Steps.ce2711d2.js";import{S as SetttingsProvider}from"./index.7f38f098.js";import{C as Card}from"./Card.9bd70da8.js";import{T as Typography}from"./Typography.5dfc411f.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="72046cc1-e108-4624-94d6-b34259db91a1",o._sentryDebugIdIdentifier="sentry-dbid-72046cc1-e108-4624-94d6-b34259db91a1")}catch{}})();function normalizePath(o){return o.startsWith("/")?o.slice(1):o}async function redirect(o,e,t,a={}){if(isUrl(t)){const i=new URLSearchParams(a),l=new URL(t);l.search=i.toString(),window.location.href=l.toString()}else{const i=t.replace(/\/$/,"");if(o==="player")e.push({path:"/"+normalizePath(i),query:a});else if(o==="editor")e.push({name:"formEditor",params:{formPath:normalizePath(i)},query:a});else if(o==="preview")e.push({name:"formPreview",params:{formPath:normalizePath(i)},query:a});else throw new Error("Invalid routing")}}const y$1=["width","height","fill","transform"],f$1={key:0},M=createBaseVNode("path",{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},null,-1),w$1=[M],V={key:1},k$1=createBaseVNode("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),x$1=createBaseVNode("path",{d:"M144,176a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176Zm88-48A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128ZM124,96a12,12,0,1,0-12-12A12,12,0,0,0,124,96Z"},null,-1),S$1=[k$1,x$1],z$1={key:2},C$1=createBaseVNode("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm-4,48a12,12,0,1,1-12,12A12,12,0,0,1,124,72Zm12,112a16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40a8,8,0,0,1,0,16Z"},null,-1),B$1=[C$1],N$1={key:3},b$1=createBaseVNode("path",{d:"M142,176a6,6,0,0,1-6,6,14,14,0,0,1-14-14V128a2,2,0,0,0-2-2,6,6,0,0,1,0-12,14,14,0,0,1,14,14v40a2,2,0,0,0,2,2A6,6,0,0,1,142,176ZM124,94a10,10,0,1,0-10-10A10,10,0,0,0,124,94Zm106,34A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"},null,-1),E$1=[b$1],P$1={key:4},W$1=createBaseVNode("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"},null,-1),$$1=[W$1],j$1={key:5},I=createBaseVNode("path",{d:"M140,176a4,4,0,0,1-4,4,12,12,0,0,1-12-12V128a4,4,0,0,0-4-4,4,4,0,0,1,0-8,12,12,0,0,1,12,12v40a4,4,0,0,0,4,4A4,4,0,0,1,140,176ZM124,92a8,8,0,1,0-8-8A8,8,0,0,0,124,92Zm104,36A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"},null,-1),q$1=[I],D={name:"PhInfo"},H=defineComponent({...D,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(o){const e=o,t=inject("weight","regular"),a=inject("size","1em"),i=inject("color","currentColor"),l=inject("mirrored",!1),r=computed(()=>{var s;return(s=e.weight)!=null?s:t}),d=computed(()=>{var s;return(s=e.size)!=null?s:a}),u=computed(()=>{var s;return(s=e.color)!=null?s:i}),h=computed(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:l?"scale(-1, 1)":void 0);return(s,p)=>(openBlock(),createElementBlock("svg",mergeProps({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:d.value,height:d.value,fill:u.value,transform:h.value},s.$attrs),[renderSlot(s.$slots,"default"),r.value==="bold"?(openBlock(),createElementBlock("g",f$1,w$1)):r.value==="duotone"?(openBlock(),createElementBlock("g",V,S$1)):r.value==="fill"?(openBlock(),createElementBlock("g",z$1,B$1)):r.value==="light"?(openBlock(),createElementBlock("g",N$1,E$1)):r.value==="regular"?(openBlock(),createElementBlock("g",P$1,$$1)):r.value==="thin"?(openBlock(),createElementBlock("g",j$1,q$1)):createCommentVNode("",!0)],16,y$1))}}),Z=["width","height","fill","transform"],g={key:0},m=createBaseVNode("path",{d:"M112,36a12,12,0,0,0-12,12V60H24A20,20,0,0,0,4,80v96a20,20,0,0,0,20,20h76v12a12,12,0,0,0,24,0V48A12,12,0,0,0,112,36ZM28,172V84h72v88ZM252,80v96a20,20,0,0,1-20,20H152a12,12,0,0,1,0-24h76V84H152a12,12,0,0,1,0-24h80A20,20,0,0,1,252,80ZM88,112a12,12,0,0,1-12,12v20a12,12,0,0,1-24,0V124a12,12,0,0,1,0-24H76A12,12,0,0,1,88,112Z"},null,-1),y=[m],f={key:1},w=createBaseVNode("path",{d:"M240,80v96a8,8,0,0,1-8,8H24a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8H232A8,8,0,0,1,240,80Z",opacity:"0.2"},null,-1),k=createBaseVNode("path",{d:"M112,40a8,8,0,0,0-8,8V64H24A16,16,0,0,0,8,80v96a16,16,0,0,0,16,16h80v16a8,8,0,0,0,16,0V48A8,8,0,0,0,112,40ZM24,176V80h80v96ZM248,80v96a16,16,0,0,1-16,16H144a8,8,0,0,1,0-16h88V80H144a8,8,0,0,1,0-16h88A16,16,0,0,1,248,80ZM88,112a8,8,0,0,1-8,8H72v24a8,8,0,0,1-16,0V120H48a8,8,0,0,1,0-16H80A8,8,0,0,1,88,112Z"},null,-1),x=[w,k],S={key:2},z=createBaseVNode("path",{d:"M248,80v96a16,16,0,0,1-16,16H144a8,8,0,0,1-8-8V72a8,8,0,0,1,8-8h88A16,16,0,0,1,248,80ZM120,48V208a8,8,0,0,1-16,0V192H24A16,16,0,0,1,8,176V80A16,16,0,0,1,24,64h80V48a8,8,0,0,1,16,0ZM88,112a8,8,0,0,0-8-8H48a8,8,0,0,0,0,16h8v24a8,8,0,0,0,16,0V120h8A8,8,0,0,0,88,112Z"},null,-1),C=[z],B={key:3},b=createBaseVNode("path",{d:"M112,42a6,6,0,0,0-6,6V66H24A14,14,0,0,0,10,80v96a14,14,0,0,0,14,14h82v18a6,6,0,0,0,12,0V48A6,6,0,0,0,112,42ZM24,178a2,2,0,0,1-2-2V80a2,2,0,0,1,2-2h82V178ZM246,80v96a14,14,0,0,1-14,14H144a6,6,0,0,1,0-12h88a2,2,0,0,0,2-2V80a2,2,0,0,0-2-2H144a6,6,0,0,1,0-12h88A14,14,0,0,1,246,80ZM86,112a6,6,0,0,1-6,6H70v26a6,6,0,0,1-12,0V118H48a6,6,0,0,1,0-12H80A6,6,0,0,1,86,112Z"},null,-1),N=[b],E={key:4},P=createBaseVNode("path",{d:"M112,40a8,8,0,0,0-8,8V64H24A16,16,0,0,0,8,80v96a16,16,0,0,0,16,16h80v16a8,8,0,0,0,16,0V48A8,8,0,0,0,112,40ZM24,176V80h80v96ZM248,80v96a16,16,0,0,1-16,16H144a8,8,0,0,1,0-16h88V80H144a8,8,0,0,1,0-16h88A16,16,0,0,1,248,80ZM88,112a8,8,0,0,1-8,8H72v24a8,8,0,0,1-16,0V120H48a8,8,0,0,1,0-16H80A8,8,0,0,1,88,112Z"},null,-1),W=[P],$={key:5},j=createBaseVNode("path",{d:"M112,44a4,4,0,0,0-4,4V68H24A12,12,0,0,0,12,80v96a12,12,0,0,0,12,12h84v20a4,4,0,0,0,8,0V48A4,4,0,0,0,112,44ZM24,180a4,4,0,0,1-4-4V80a4,4,0,0,1,4-4h84V180ZM244,80v96a12,12,0,0,1-12,12H144a4,4,0,0,1,0-8h88a4,4,0,0,0,4-4V80a4,4,0,0,0-4-4H144a4,4,0,0,1,0-8h88A12,12,0,0,1,244,80ZM84,112a4,4,0,0,1-4,4H68v28a4,4,0,0,1-8,0V116H48a4,4,0,0,1,0-8H80A4,4,0,0,1,84,112Z"},null,-1),T=[j],q={name:"PhTextbox"},G=defineComponent({...q,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(o){const e=o,t=inject("weight","regular"),a=inject("size","1em"),i=inject("color","currentColor"),l=inject("mirrored",!1),r=computed(()=>{var s;return(s=e.weight)!=null?s:t}),d=computed(()=>{var s;return(s=e.size)!=null?s:a}),u=computed(()=>{var s;return(s=e.color)!=null?s:i}),h=computed(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:l?"scale(-1, 1)":void 0);return(s,p)=>(openBlock(),createElementBlock("svg",mergeProps({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:d.value,height:d.value,fill:u.value,transform:h.value},s.$attrs),[renderSlot(s.$slots,"default"),r.value==="bold"?(openBlock(),createElementBlock("g",g,y)):r.value==="duotone"?(openBlock(),createElementBlock("g",f,x)):r.value==="fill"?(openBlock(),createElementBlock("g",S,C)):r.value==="light"?(openBlock(),createElementBlock("g",B,N)):r.value==="regular"?(openBlock(),createElementBlock("g",E,W)):r.value==="thin"?(openBlock(),createElementBlock("g",$,T)):createCommentVNode("",!0)],16,Z))}}),WS_CLOSING_STATES=[WebSocket.CLOSING,WebSocket.CLOSED],WS_CLOSING_REASONS={FORM_EDITOR_RESTART:4e3};class FormConnectionManager{constructor(e,t){n(this,"ws",null);n(this,"heartbeatInterval");n(this,"onOpen",null);n(this,"onMessage",null);this.formId=e,this._detached=t}set detached(e){this._detached=e}get url(){const e=location.protocol==="https:"?"wss:":"ws:",t=this._detached?"_socket/detached":"_socket";return`${e}//${location.host}/${t}?id=${encodeURIComponent(this.formId)}`}handleOpen(e){if(!this.onOpen)throw new Error("onOpen is not set");this.onOpen(),e()}handleClose(e){(e.code===1006||!e.wasClean)&&clearInterval(this.heartbeatInterval)}handleMessage(e){if(!this.onMessage)throw new Error("onMessage is not set");const t=JSON.parse(e.data);this.onMessage(t)}sendHeartbeat(){!this.ws||this.ws.readyState!==this.ws.OPEN||this.send({type:"execution:heartbeat"})}async send(e){if(!this.ws)throw new Error(`[FormRunnerController] failed sending msg ${e.type} : websocket is not connected`);WS_CLOSING_STATES.includes(this.ws.readyState)&&await this.connect(),this.ws.send(JSON.stringify(e))}async close(e){this.ws&&this.ws.close(WS_CLOSING_REASONS[e],e)}async reset(){await this.close("FORM_EDITOR_RESTART"),await this.connect()}async connect(e=3){if(e!=0)return new Promise(t=>{clearInterval(this.heartbeatInterval),this.ws=new WebSocket(this.url),this.ws.onopen=()=>this.handleOpen(t),this.ws.onclose=a=>this.handleClose(a),this.ws.onmessage=a=>this.handleMessage(a),this.heartbeatInterval=setInterval(()=>this.sendHeartbeat(),2e3)}).catch(()=>{this.connect(e-1)})}}function isInputWidget(o){return"key"in o&&"value"in o&&"errors"in o}const executeCode=($context,code)=>{let evaluatedCode;try{evaluatedCode=eval(code)}catch(o){throw console.error(`[Error: execute_js]: ${o.message}, context: ${$context}`),o}return isSerializable(evaluatedCode)?evaluatedCode:null};async function executeJs(o){return{type:"execute-js:response",value:await executeCode(o.context,o.code)}}const isSerializable=o=>{try{return JSON.stringify(o),!0}catch{return!1}},FORM_END_STATES=["default-end","page-end","error","lock-failed"],FORM_RUNNING_STATES=["authenticating","page"];class FormRunnerController{constructor({formRunnerData:e,queryParams:t,userManager:a,logService:i,connectionManager:l,onFormStart:r,onFormEnd:d,onRedirect:u,onAuthUpdate:h,onStateUpdate:s,onStackTraceUpdate:p}){n(this,"connectionManager");n(this,"logService");n(this,"userManager");n(this,"formRunnerData");n(this,"queryParams");n(this,"formState");n(this,"messageSeq",0);n(this,"executionId",null);n(this,"onFormStart");n(this,"onFormEnd");n(this,"onRedirect");n(this,"onStackTraceUpdate");n(this,"onStateUpdate");n(this,"onAuthUpdate");n(this,"responseHistory",[]);n(this,"lastResponseHistory",[]);n(this,"handlers",{"form:mount-page":[e=>this.handleMountPageMessage(e)],"form:update-page":[e=>this.handleUpdatePageMessage(e)],"execution:stdout":[e=>this.handleStdoutMessage(e)],"execution:stderr":[e=>this.handleStderrMessage(e)],"execution:started":[e=>this.handleExecutionStartedMessage(e)],"execution:ended":[e=>this.handleExecutionEndedMessage(e)],"execution:heartbeat":[],"execution:lock-failed":[e=>this.handleExecutionLockFailedMessage(e)],"auth:invalid-jwt":[e=>this.handleAuthInvalidJWTMessage(e)],"auth:valid-jwt":[e=>this.handleAuthValidTokenMessage(e)],"redirect:request":[e=>this.handleRedirectRequestMessage(e)],"execute-js:request":[e=>this.handleExecuteJSRequestMessage(e)],"env:files-changed":[()=>this.handleFilesChangedMessage()],"auth:require-info":[e=>this.handleAuthRequireInfoMessage(e)]});n(this,"start",async()=>{await this.connectionManager.connect()});n(this,"reset",async()=>{var e;(e=this.logService)==null||e.log({type:"stdout",log:"[Form reloaded]"}),await this.connectionManager.close("FORM_EDITOR_RESTART"),this.messageSeq=0,this.setFormState({type:"waiting",actions:[this.getStartAction()]})});n(this,"getStartAction",()=>this.actionFromMessage(this.formRunnerData.startButtonText||"Start"));n(this,"getEndStateActions",()=>{const e=this.formRunnerData.restartButtonText||"Restart";return this.formRunnerData.allowRestart?[this.actionFromMessage(e)]:[]});n(this,"getState",()=>({formState:this.formState,passwordlessUser:this.userManager.getUser()}));n(this,"handleConnectionOpen",()=>{this.connectionManager.send({type:"execution:start",params:this.queryParams})});n(this,"actionFromMessage",e=>({name:e,label:i18nProvider.translateIfFound(e,this.formRunnerData),disabled:!1,loading:!1}));n(this,"getAutofillVisibilty",e=>this.lastResponseHistory.length===0?!1:this.lastResponseHistory[0].some(t=>e.find(a=>a.key===t.key&&a.type===t.type&&"value"in a)));n(this,"handleAutofillClick",()=>{!this.lastResponseHistory[0]||this.formState.type==="page"&&(this.lastResponseHistory[0].forEach(t=>{!("widgets"in this.formState&&this.formState.widgets.find(i=>i.key===t.key&&i.type===t.type))||"value"in t&&this.updateWidgetValue(t.key,t.value)}),this.setFormState({...this.formState,showAutofill:!1}))});n(this,"handleMessageReceived",e=>{const t=this.handlers[e.type];if(!t)throw new Error(`No handler for message type ${e.type}`);if(t.forEach(a=>a(e)),e.debug&&this.onStackTraceUpdate){const a=e.type==="execution:ended";this.onStackTraceUpdate(e.debug.stack,a)}});n(this,"handleFilesChangedMessage",()=>{var e;(e=this.logService)==null||e.log({type:"files-changed",log:"Files changed"})});n(this,"logout",()=>{this.userManager.removeUser(),this.reset(),this.onAuthUpdate(null)});n(this,"handleActionClick",e=>{if(this.formState.type==="waiting")return this.setFormState({...this.formState,actions:this.formState.actions.map(t=>t.label===e.label?{...t,loading:!0}:t)}),this.start();if(this.formState.type==="page"){const t=e.name==="i18n_back_action";return this.hasErrors()&&!t?void 0:(this.setFormState({...this.formState,actions:this.formState.actions.map(a=>a.label===e.label?{...a,loading:!0}:a)}),this.lastResponseHistory.shift(),this.responseHistory.push(this.formState.widgets),this.sendFormPageResponse(this.getWidgetValues(),e))}if(this.formState.type==="default-end"||this.formState.type==="page-end")return this.setFormState({...this.formState,actions:[{...this.getStartAction(),loading:!0}]}),this.start()});n(this,"updateWidgetValue",(e,t)=>{if(this.formState.type!=="page")return;const a=this.formState.widgets.find(l=>"key"in l&&l.key===e);if(!a||!isInputWidget(a))return;const i=this.formState.widgets.map(l=>l.key===e?{...l,value:t}:l);this.setFormState({...this.formState,widgets:i}),this.sendFormUserEvent(this.getWidgetValues(),this.getSecrets())});n(this,"updateWidgetFrontendErrors",(e,t)=>{if(this.formState.type!=="page"||!this.formState.widgets.find(l=>l.key===e))return;const i=this.formState.widgets.map(l=>l.key===e?{...l,errors:l._pythonErrors.concat(t.map(r=>i18nProvider.translateIfFound(r,l)))}:l);this.setFormState({...this.formState,widgets:i})});this.formRunnerData=e,this.queryParams=t,this.userManager=a,this.logService=i,this.connectionManager=l,this.onFormStart=r,this.onFormEnd=d,this.onRedirect=u,this.onAuthUpdate=h,this.onStateUpdate=s,this.onStackTraceUpdate=p,a.pubsub.subscribe("authenticated",c=>{c&&(this.connectionManager.send({type:"auth:saved-jwt",jwt:c==null?void 0:c.jwt}),this.onAuthUpdate(c))}),this.connectionManager.onOpen=()=>this.handleConnectionOpen(),this.connectionManager.onMessage=c=>this.handleMessageReceived(c),this.formState={type:"waiting",actions:[this.getStartAction()]},this.formRunnerData.autoStart&&this.start()}set detached(e){this.connectionManager.detached=e}fullWidthFromMessage(e){return e.some(t=>"fullWidth"in t&&t.fullWidth)}widgetFromMessage(e,t){if(isInputWidget(e)){const a=e.errors.map(i=>i18nProvider.translateIfFound(i,e));return{...e,input:!0,_pythonErrors:a,errors:a}}return{...e,input:!1,_pythonErrors:[],errors:[],key:e.type+t}}async handleExecutionStartedMessage(e){this.executionId=e.executionId,this.onFormStart()}handleMountPageMessage(e){var a,i;const t=e.widgets.map(this.widgetFromMessage);if(e.endProgram){this.setFormState({type:"page-end",actions:this.getEndStateActions(),widgets:t,fullWidth:this.fullWidthFromMessage(e.widgets),steps:e.steps,refreshKey:Date.now().toString(),showAutofill:this.getAutofillVisibilty(t)});return}this.setFormState({type:"page",widgets:t,actions:(i=(a=e.actions)==null?void 0:a.map(this.actionFromMessage))!=null?i:[],fullWidth:this.fullWidthFromMessage(e.widgets),steps:e.steps,refreshKey:Date.now().toString(),showAutofill:this.getAutofillVisibilty(t)})}async handleExecuteJSRequestMessage(e){const t=await executeJs(e);this.connectionManager.send(t)}async handleAuthRequireInfoMessage(e){const t=this.userManager.getUser();if(t&&!e.refresh){this.sendAuthSavedJWT(t);return}this.userManager.removeUser(),this.setFormState({type:"authenticating"})}async handleAuthInvalidJWTMessage(e){this.userManager.removeUser(),this.setFormState({type:"authenticating"})}async handleStderrMessage(e){var t;(t=this.logService)==null||t.log({type:"stderr",log:e.log})}async handleStdoutMessage(e){var t;(t=this.logService)==null||t.log({type:"stdout",log:e.log})}async handleAuthValidTokenMessage(e){}async handleExecutionLockFailedMessage(e){this.setFormState({type:"lock-failed",status:e.status})}async handleRedirectRequestMessage(e){this.onRedirect(e.url,e.queryParams)}async handleUpdatePageMessage(e){if(e.seq===this.messageSeq){if(this.formState.type!=="page")throw new Error("Received form:update-page message while not in render-page state");this.setFormState({...this.formState,error:{message:e.validation.message,status:e.validation.status},widgets:e.widgets.map(this.widgetFromMessage),actions:this.formState.actions.map(t=>({...t,loading:!1}))})}}async handleExecutionEndedMessage(e){var t,a;this.lastResponseHistory=[...this.responseHistory],this.responseHistory=[],!FORM_END_STATES.includes(this.formState.type)&&(e.exitStatus==="SUCCESS"&&(this.setFormState({type:"default-end",actions:this.getEndStateActions()}),(t=this.logService)==null||t.log({type:"stdout",log:"[Form run finished]"})),e.exitStatus==="EXCEPTION"&&(this.setFormState({type:"error",message:e.exception}),(a=this.logService)==null||a.log({type:"stderr",log:e.exception})),this.onFormEnd())}sendFormPageResponse(e,t,a){this.connectionManager.send({type:"form:page-response",payload:e,secrets:a,action:t==null?void 0:t.name,seq:++this.messageSeq})}sendFormUserEvent(e,t){this.connectionManager.send({type:"form:user-event",payload:e,secrets:t,seq:++this.messageSeq})}sendAuthSavedJWT(e){this.connectionManager.send({type:"auth:saved-jwt",jwt:e.jwt})}handleCloseAttempt(){return FORM_END_STATES.includes(this.formState.type)?!1:(this.connectionManager.send({type:"debug:close-attempt"}),!0)}setFormState(e){this.formState=Object.freeze(e),this.onStateUpdate(e)}getSecrets(){return this.formState.type!=="page"?[]:this.formState.widgets.filter(e=>"secret"in e).reduce((e,t)=>"key"in t&&"secret"in t?[...e,{key:t.key,secret:t.secret}]:e,[])}setWidgetValidationFunction(e,t){if(this.formState.type!=="page")return;const a=this.formState.widgets.find(i=>"key"in i&&i.key===e);!a||!isInputWidget(a)||(a.validationFunction=t)}hasErrors(){var e;return this.formState.type!=="page"?!1:((e=this.formState.error)==null?void 0:e.status)===!1||this.formState.widgets.some(t=>t.errors.length>0)}shouldDisableAction(e){return this.formState.type!=="page"||this.hasErrors()?!0:e!=="i18n_back_action"}getWidgetValue(e){if(this.formState.type!=="page")return null;const t=this.formState.widgets.find(a=>"key"in a&&a.key===e);if(!t||!isInputWidget(t))return null}getWidgetValues(){return this.formState.type!=="page"?{}:this.formState.widgets.reduce((e,t)=>("value"in t&&(e[t.key]=t.value),e),{})}}const _hoisted_1$4={key:0,class:"text"},_hoisted_2$3={key:1,class:"text"},_sfc_main$5=defineComponent({__name:"component",props:{status:{}},setup(o){return(e,t)=>e.status==="running"?(openBlock(),createElementBlock("div",_hoisted_1$4," This form is already being filled ")):(openBlock(),createElementBlock("div",_hoisted_2$3,"This form was already filled"))}}),_hoisted_1$3={class:"outline-button"},_sfc_main$4=defineComponent({__name:"OutlineButton",props:{icon:{},noShadow:{type:Boolean},status:{}},setup(o){return(e,t)=>(openBlock(),createElementBlock("button",_hoisted_1$3,[e.icon?(openBlock(),createBlock(resolveDynamicComponent(e.icon),{key:0,class:"icon",color:"#fff"})):createCommentVNode("",!0),renderSlot(e.$slots,"default",{},void 0,!0)]))}}),OutlineButton_vue_vue_type_style_index_0_scoped_8d870775_lang="",OutlineButton=_export_sfc(_sfc_main$4,[["__scopeId","data-v-8d870775"]]),_sfc_main$3=defineComponent({__name:"FormAutoFill",emits:["click"],setup(o,{emit:e}){return(t,a)=>(openBlock(),createBlock(OutlineButton,{icon:unref(G),class:"form-auto-fill-btn",onClick:a[0]||(a[0]=i=>e("click"))},{default:withCtx(()=>[createTextVNode(" Repeat last answer ")]),_:1},8,["icon"]))}}),FormAutoFill_vue_vue_type_style_index_0_scoped_24a4c744_lang="",FormAutoFill=_export_sfc(_sfc_main$3,[["__scopeId","data-v-24a4c744"]]),_hoisted_1$2=["href"],_hoisted_2$2=createStaticVNode('<svg width="44" height="32" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-91fa59aa><g clip-path="url(#clip0_405_116214)" data-v-91fa59aa><path d="M188.697 133.808L172.68 148.263C172.68 148.263 216.044 185.966 217.997 187.72C219.951 189.475 234.405 174.566 232.843 173.266C231.28 171.966 188.697 133.808 188.697 133.808Z" fill="#E36C7C" data-v-91fa59aa></path><path d="M188.697 133.808L172.68 148.263C172.68 148.263 216.044 185.966 217.997 187.72C219.951 189.475 234.405 174.566 232.843 173.266C231.28 171.966 188.697 133.808 188.697 133.808Z" fill="url(#paint0_linear_405_116214)" data-v-91fa59aa></path><path d="M218.387 91.2249L176.195 127.557L173.851 129.51C151.192 149.849 149.853 152.309 141.642 152.584L141.584 152.586C139.612 152.652 135.357 152.795 131.875 149.849C126.797 145.552 120.155 140.083 117.03 137.348C115.34 135.869 112.465 133.039 109.998 131.097C107.902 129.448 106.482 127.581 104.919 127.581C103.357 127.581 100.622 129.925 96.3246 133.832C92.0272 137.739 82.6511 146.333 82.6511 146.333L65.0712 161.569C65.0712 161.569 42.5857 180.688 36.7256 185.376C30.8656 190.064 16.5797 175.69 21.4895 171.703C21.9628 171.23 26.2429 167.755 29.7179 164.915C32.2165 162.84 34.2084 161.179 34.2084 161.179C34.9897 160.397 66.2433 133.051 66.2433 133.051L87.723 114.573C87.723 114.573 95.9339 106.094 105.701 106.094C108.826 106.094 112.83 106.485 126.015 118.205C129.531 121.33 131.485 122.542 135.782 126.409C137.345 127.816 139.852 130.316 140.861 130.316C141.882 130.316 143.986 128.363 145.549 127.023C145.549 127.023 195.897 84.4149 202.37 77.9421C207.839 72.4726 223.075 86.9273 218.387 91.2249Z" fill="url(#paint1_linear_405_116214)" data-v-91fa59aa></path><path d="M33.238 67.1372C31.2846 68.6564 23.9305 75.1737 22.2992 76.9039C19.3366 80.0417 21.3638 81.3905 25.6611 84.9065C29.9585 88.4225 57.8962 112.712 64.8542 118.963L79.9642 105.221L41.288 71.2331C36.5999 67.1372 35.1913 65.6179 33.238 67.1372Z" fill="url(#paint2_linear_405_116214)" data-v-91fa59aa></path></g><defs data-v-91fa59aa><linearGradient id="paint0_linear_405_116214" x1="172.68" y1="133.808" x2="183.059" y2="196.169" gradientUnits="userSpaceOnUse" data-v-91fa59aa><stop offset="0.114583" stop-color="#FF98A6" data-v-91fa59aa></stop><stop offset="1" stop-color="#E36C7C" data-v-91fa59aa></stop></linearGradient><linearGradient id="paint1_linear_405_116214" x1="219.271" y1="186.305" x2="206.115" y2="57.7298" gradientUnits="userSpaceOnUse" data-v-91fa59aa><stop stop-color="#E36C7C" data-v-91fa59aa></stop><stop offset="0.859375" stop-color="#FF98A6" data-v-91fa59aa></stop></linearGradient><linearGradient id="paint2_linear_405_116214" x1="20.8984" y1="66.56" x2="30.8589" y2="127.049" gradientUnits="userSpaceOnUse" data-v-91fa59aa><stop stop-color="#E36C7C" data-v-91fa59aa></stop><stop offset="0.859375" stop-color="#FF98A6" data-v-91fa59aa></stop></linearGradient><clipPath id="clip0_405_116214" data-v-91fa59aa><rect width="256" height="256" fill="white" data-v-91fa59aa></rect></clipPath></defs></svg><b data-v-91fa59aa>Abstra Cloud</b>',2),_sfc_main$2=defineComponent({__name:"Watermark",props:{runtime:{}},setup(o){var a;const e=window.location.hostname.split(".")[0],t=(a=SetttingsProvider.instance)==null?void 0:a.showWatermark;return(i,l)=>unref(t)?(openBlock(),createElementBlock("a",{key:0,href:`https://www.abstra.io/forms?utm_source=abstra_pages&utm_medium=badge&utm_campaign=${i.runtime.id}&origin_subdomain=${unref(e)}`,target:"_blank",class:"watermark"},[createTextVNode(toDisplayString(unref(i18nProvider).translate("i18n_watermark_text"))+" ",1),_hoisted_2$2],8,_hoisted_1$2)):createCommentVNode("",!0)}}),Watermark_vue_vue_type_style_index_0_scoped_91fa59aa_lang="",Watermark=_export_sfc(_sfc_main$2,[["__scopeId","data-v-91fa59aa"]]),_hoisted_1$1={key:0,class:"hint"},_hoisted_2$1={class:"hint-content"},_sfc_main$1=defineComponent({__name:"WidgetHint",props:{hint:{}},setup(o){return(e,t)=>e.hint?(openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(unref(H),{size:"20"}),createBaseVNode("div",_hoisted_2$1,toDisplayString(e.hint),1)])):createCommentVNode("",!0)}}),WidgetHint_vue_vue_type_style_index_0_scoped_56c261f3_lang="",WidgetHint=_export_sfc(_sfc_main$1,[["__scopeId","data-v-56c261f3"]]),_hoisted_1={key:0,class:"loading-wrapper"},_hoisted_2={class:"form-wrapper"},_hoisted_3=["id"],_hoisted_4={key:5,class:"span-error"},_hoisted_5={key:0,class:"buttons"},_sfc_main=defineComponent({__name:"FormRunner",props:{formRunnerData:{},formState:{},userEmail:{},isPreview:{type:Boolean},disabled:{}},emits:["navigate","action-clicked","autofill-clicked","update-widget-value","update-widget-errors","login","logout"],setup(o,{emit:e}){const t=o,a=ref(null),i=ref({}),l=()=>{!a.value||(a.value.scrollTop=0)};return watch(()=>t.formState,(r,d)=>{r.type==="page"&&(d==null?void 0:d.type)==="page"&&r.refreshKey!==d.refreshKey&&l()}),(r,d)=>(openBlock(),createBlock(WidgetsFrame,{class:normalizeClass([{preview:r.isPreview},"runner"]),"main-color":r.formRunnerData.mainColor,theme:r.formRunnerData.theme,"font-family":r.formRunnerData.fontFamily,runtime:"form"},{default:withCtx(()=>{var u,h;return[r.disabled?(openBlock(),createBlock(unref(Card),{key:0,class:"unsaved-changes"},{default:withCtx(()=>[createVNode(unref(Typography),{style:{"font-size":"18px","font-weight":"500"}},{default:withCtx(()=>[createTextVNode(toDisplayString(r.disabled.title),1)]),_:1}),createVNode(unref(Typography),{style:{"margin-bottom":"6px"}},{default:withCtx(()=>[createTextVNode(toDisplayString(r.disabled.message),1)]),_:1})]),_:1})):createCommentVNode("",!0),r.isPreview&&((u=r.formState)==null?void 0:u.type)==="page"&&r.formState.showAutofill?(openBlock(),createBlock(FormAutoFill,{key:1,class:"auto-fill-btn",form:r.formRunnerData,style:{"z-index":1},onClick:d[0]||(d[0]=s=>e("autofill-clicked"))},null,8,["form"])):createCommentVNode("",!0),createBaseVNode("header",null,[createVNode(PlayerNavbar,{"runner-data":r.formRunnerData,"user-email":r.userEmail,onLogout:d[1]||(d[1]=s=>e("logout")),onNavigate:d[2]||(d[2]=s=>e("navigate",s))},null,8,["runner-data","user-email"])]),((h=r.formState)==null?void 0:h.type)==="page"?(openBlock(),createBlock(Steps,{key:2,class:"steps","steps-info":r.formState.steps},null,8,["steps-info"])):createCommentVNode("",!0),createBaseVNode("main",{ref_key:"scrollableContainer",ref:a,class:normalizeClass([{disabled:r.disabled}])},[r.formState?r.formState.type==="authenticating"?(openBlock(),createBlock(Passwordless,{key:1,class:"form-auth"})):(openBlock(),createElementBlock("div",{key:2,class:normalizeClass(["form",{"full-width":r.formState.type==="page"&&r.formState.fullWidth}])},[createBaseVNode("div",_hoisted_2,[r.formState.type==="waiting"?(openBlock(),createBlock(StartWidget,{key:0,form:r.formRunnerData},null,8,["form"])):r.formState.type==="default-end"?(openBlock(),createBlock(EndWidget,{key:1,"end-message":r.formRunnerData.endMessage},null,8,["end-message"])):r.formState.type==="error"?(openBlock(),createBlock(ErrorWidget,{key:2,"error-message":r.formRunnerData.errorMessage},null,8,["error-message"])):r.formState.type==="lock-failed"?(openBlock(),createBlock(_sfc_main$5,{key:3,status:r.formState.status},null,8,["status"])):(openBlock(!0),createElementBlock(Fragment,{key:4},renderList(r.formState.widgets,(s,p)=>{var c;return openBlock(),createElementBlock("div",{id:s.type+p,key:(c=s.key)!=null?c:s.type+p,class:"widget"},[(openBlock(),createBlock(resolveDynamicComponent(s.type),{ref_for:!0,ref:_=>"key"in s?i.value[s.key]=_:null,value:unref(isInputWidget)(s)&&s.value,errors:s.errors,"user-props":s,"refresh-key":r.formState.refreshKey,runtime:"form","onUpdate:value":_=>e("update-widget-value",s.key,_),"onUpdate:errors":_=>e("update-widget-errors",s.key,_)},null,40,["value","errors","user-props","refresh-key","onUpdate:value","onUpdate:errors"])),createVNode(WidgetHint,{hint:"hint"in s?s.hint:null},null,8,["hint"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(s.errors,_=>(openBlock(),createElementBlock("span",{key:_,class:"span-error"},toDisplayString(_),1))),128))],8,_hoisted_3)}),128)),r.formState.type==="page"&&r.formState.error&&r.formState.error.status===!1?(openBlock(),createElementBlock("span",_hoisted_4,toDisplayString(r.formState.error.message||unref(i18nProvider).translateIfFound("i18n_generic_validation_error")),1)):createCommentVNode("",!0)]),"actions"in r.formState?(openBlock(),createElementBlock("div",_hoisted_5,[createVNode(unref(StyleProvider),null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.formState.actions,s=>(openBlock(),createBlock(unref(Button),{key:s.name,class:normalizeClass(["next-button",s.disabled?"disabled":""]),loading:s.loading,disabled:s.disabled||s.loading,onClick:p=>e("action-clicked",s),onKeydown:withKeys(p=>e("action-clicked",s),["enter"])},{default:withCtx(()=>[createTextVNode(toDisplayString(s.label),1)]),_:2},1032,["loading","disabled","class","onClick","onKeydown"]))),128))]),_:1})])):createCommentVNode("",!0)],2)):(openBlock(),createElementBlock("div",_hoisted_1,[createVNode(LoadingIndicator)]))],2),createVNode(Watermark,{class:"watermark",runtime:r.formRunnerData},null,8,["runtime"])]}),_:1},8,["class","main-color","theme","font-family"]))}}),FormRunner_vue_vue_type_style_index_0_scoped_a17d253f_lang="",FormRunner=_export_sfc(_sfc_main,[["__scopeId","data-v-a17d253f"]]);export{FORM_END_STATES as F,FORM_RUNNING_STATES as a,FormRunner as b,FormRunnerController as c,FormConnectionManager as d,redirect as r};
//# sourceMappingURL=FormRunner.c5da96f2.js.map

import{_ as ye}from"./DocsButton.vue_vue_type_script_setup_true_lang.827a8e24.js";import{f as c,ee as L,fa as be,d as le,r as j,al as V,w as T,c as z,o as p,ac as k,e as w,b as u,u as o,aY as _e,ej as we,a as g,t as C,dj as $,g as P,cy as X,h as S,cI as Oe,bT as Z,el as Ce,eq as Pe,cC as Ie,bV as je,bQ as Se,M as ze,K as x,_ as oe,ei as $e,i as K,A as xe,de as Fe}from"./jwt-decode.esm.9d191a76.js";import{k as O,f as ke,e as Ae,p as Ue}from"./router.61b1ce1a.js";import{a as De}from"./asyncComputed.d231d8c0.js";import{f as ee}from"./string.6bea0aa7.js";import{a as He,I as Me}from"./files.edd8194f.js";import{a as Ve,G as Te}from"./PhFolderPlus.vue.92ea8711.js";import{_ as F}from"./AbstraButton.vue_vue_type_script_setup_true_lang.9503ef94.js";import{_ as Le}from"./ScrollArea.vue_vue_type_script_setup_true_lang.e0621b4c.js";import{B as Ee,A as te}from"./Breadcrumb.d1adb2c3.js";import{U as Be}from"./UploadOutlined.2c2fbc02.js";import"./tables.9609b3e4.js";import{C as Re}from"./Card.86497ce4.js";import"./constants.6f8d31ff.js";import"./index.b5277efa.js";import"./record.f2c2316a.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="a534e220-72fc-4a2b-8882-5e0ab9b24d1d",s._sentryDebugIdIdentifier="sentry-dbid-a534e220-72fc-4a2b-8882-5e0ab9b24d1d")}catch{}})();var Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"};const Ge=Ne;var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"};const Qe=qe;function ae(s){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),i.forEach(function(l){Ye(s,l,n[l])})}return s}function Ye(s,e,n){return e in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}var E=function(e,n){var i=ae({},e,n.attrs);return c(L,ae({},i,{icon:be}),null)};E.displayName="DeleteOutlined";E.inheritAttrs=!1;const Je=E;function ne(s){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),i.forEach(function(l){We(s,l,n[l])})}return s}function We(s,e,n){return e in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}var B=function(e,n){var i=ne({},e,n.attrs);return c(L,ne({},i,{icon:Ge}),null)};B.displayName="FolderAddOutlined";B.inheritAttrs=!1;const Xe=B;function re(s){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),i.forEach(function(l){Ze(s,l,n[l])})}return s}function Ze(s,e,n){return e in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}var R=function(e,n){var i=re({},e,n.attrs);return c(L,re({},i,{icon:Qe}),null)};R.displayName="HomeOutlined";R.inheritAttrs=!1;const Ke=R;class N{constructor(e){this.projectId=e}static fromProjectId(e){return new N(e)}async list(e,n,i,l){const m=new URLSearchParams;m.set("limit",e.toString()),m.set("offset",n.toString()),i&&i.trim()&&m.set("search",i.trim()),l&&l.trim()&&m.set("path",l.trim());const A=m.toString(),d=`projects/${this.projectId}/files?${A}`,f=await O.get(d);return{items:f.items,totalCount:f.totalCount}}async upload(e,n){const i={"Content-Type":"multipart/form-data"},l=new File([n||new Uint8Array],He(e));return O.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e)}`,l,i)}async download(e){return O.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return O.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,n){return O.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(n)}`,{})}async createFolder(e){return O.post(`projects/${this.projectId}/files/create-folder`,{path:e})}}const et={class:"files-navigator"},tt={class:"header-container",style:{"margin-bottom":"8px"}},at=["onClick"],nt={class:"list-header"},rt=["onClick"],lt={class:"file-name"},ot={key:2,class:"file-size"},st=le({__name:"FilesNavigator",props:{filesModel:{}},setup(s){const e=s,n=j(!1),i=j(""),l=j(new Set),m=j(!1),A=a=>{if(!y.searchTerm.trim())return x("span",a);const t=ee(y.searchTerm,a);return t?x("span",a.split("").map((r,v)=>t.includes(v)?x("span",{class:"char-match"},r):r)):x("span",a)},d=V({currentIndex:1,pageSize:20,totalCount:0}),f=V({currentPath:"",breadcrumbs:[]}),y=V({searchTerm:"",isSearching:!1}),{loading:U,result:I,refetch:_}=De(async()=>{const a=await e.filesModel.list(d.pageSize,(d.currentIndex-1)*d.pageSize,y.searchTerm||void 0,f.currentPath||void 0);return d.totalCount=a.totalCount,a});T([()=>d.currentIndex,()=>d.pageSize],()=>{_()}),T(()=>y.searchTerm,()=>{console.log("Search term changed:",y.searchTerm),d.currentIndex=1,_()}),T(()=>f.currentPath,()=>{_()});const D=z(()=>I.value?I.value.items:[]);async function se(a,t){const r=a.join("/");await e.filesModel.upload(r,t),await _()}async function G(a){a.forEach(async t=>{const r=await e.filesModel.download(t),v=URL.createObjectURL(r),b=document.createElement("a");b.href=v,b.download=t.split("/").pop()||"download",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(v)})}function H(a){f.currentPath=a,f.breadcrumbs=a?a.split("/").filter(t=>t.length>0):[],d.currentIndex=1,_()}async function ie(a){for(const t of a)await e.filesModel.delete(t.path);l.value.clear(),await _()}const ce=a=>a.type==="directory"?"":a.type==="file"?a.sizeHuman:"",h=z(()=>D.value?y.searchTerm.trim()?D.value.filter(a=>ee(y.searchTerm,a.name)):D.value:[]),ue=z(()=>h.value?h.value.filter(a=>l.value.has(a.path)):[]);function de(a){a.type==="directory"?(l.value.clear(),m.value=!1,H(a.path)):G([a.path])}const q=j(!1);function fe(a){if(a&&a.type==="file")return;const t=document.createElement("input");t.type="file",t.onchange=async()=>{var b,Y,J;const r=(b=t.files)==null?void 0:b[0],v=await(r==null?void 0:r.arrayBuffer());if(!!r)try{q.value=!0;const W=(Y=a==null?void 0:a.path.split("/").filter(M=>M.length>0))!=null?Y:f.currentPath?f.currentPath.split("/").filter(M=>M.length>0):[];await se([...W,(J=r.name)!=null?J:"Untitled file"],v?new Uint8Array(v):void 0),await _()}catch{Ue("Failed to upload file","File already exists")}finally{q.value=!1}},t.click()}const pe=z(()=>`Search files in ${f.currentPath?`/${f.currentPath}`:"/"}`);function me(a){const t=a.path;l.value.has(t)?l.value.delete(t):l.value.add(t),he()}function ve(){var a;m.value?l.value.clear():(a=h.value)==null||a.forEach(t=>{l.value.add(t.path)}),m.value=!m.value}function he(){var r;const a=((r=h.value)==null?void 0:r.length)||0,t=l.value.size;m.value=a>0&&t===a}function ge(){i.value="",n.value=!0}async function Q(){if(i.value.trim()){const a=f.currentPath,t=i.value,r=a?`${a}/${t}`:t;await e.filesModel.createFolder(r),await _(),n.value=!1,i.value=""}}return(a,t)=>(p(),k("div",et,[w("div",tt,[c(o($),{justify:"space-between",align:"center",gap:"small"},{default:u(()=>[c(o(Ee),null,{default:u(()=>[c(o(te),null,{default:u(()=>[w("a",{onClick:t[0]||(t[0]=r=>H(""))},[c(o(Ke))])]),_:1}),(p(!0),k(_e,null,we(f.breadcrumbs,(r,v)=>(p(),g(o(te),{key:v},{default:u(()=>[w("a",{onClick:b=>H(f.breadcrumbs.slice(0,v+1).join("/"))},C(r),9,at)]),_:2},1024))),128))]),_:1}),c(o($),{gap:"small"},{default:u(()=>[o(U)?S("",!0):(p(),g(o(X),{key:0},{default:u(()=>[c(F,{size:"small",onClick:t[1]||(t[1]=()=>fe())},{default:u(()=>[c(o(Be)),P(" Upload File ")]),_:1}),c(F,{size:"small",onClick:t[2]||(t[2]=()=>ge())},{default:u(()=>[c(o(Xe)),P(" New Folder ")]),_:1})]),_:1})),l.value.size>0?(p(),g(o(X),{key:1},{default:u(()=>[c(F,{size:"small",onClick:t[3]||(t[3]=()=>G(Array.from(l.value)))},{default:u(()=>[c(o(Ve),{size:"18"}),P(" Download ("+C(l.value.size)+") ",1)]),_:1}),c(F,{size:"small",danger:"",onClick:t[4]||(t[4]=()=>ie(ue.value))},{default:u(()=>[c(o(Je)),P(" Delete ("+C(l.value.size)+") ",1)]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})]),c(Le,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:u(()=>[w("div",nt,[c(o($),{justify:"space-between",align:"center",gap:"small",style:{"margin-bottom":"8px"}},{default:u(()=>[c(o(Oe),{value:y.searchTerm,"onUpdate:value":t[5]||(t[5]=r=>y.searchTerm=r),loading:o(U),placeholder:pe.value,style:{"max-width":"300px"},size:"small"},null,8,["value","loading","placeholder"]),h.value&&h.value.length>0?(p(),g(o(Z),{key:0,checked:m.value,indeterminate:l.value.size>0&&l.value.size<h.value.length,class:"select-all-checkbox",onChange:ve},null,8,["checked","indeterminate"])):S("",!0)]),_:1})]),h.value&&h.value.length>0?(p(),g(o(Ae),{key:0,class:"files-list","data-source":h.value},{renderItem:u(({item:r})=>[c(o(ke),{class:"compact-list-item"},{default:u(()=>[c(o($),{align:"center",justify:"space-between",style:{width:"100%"}},{default:u(()=>[w("div",{style:{display:"flex","align-items":"center",gap:"8px",flex:"1",cursor:"pointer","min-width":"0"},onClick:v=>de(r)},[r.type==="directory"?(p(),g(o(Te),{key:0,size:"18px"})):(p(),g(o(Me),{key:1,size:"18px"})),w("span",lt,[(p(),g(Ce(A(r.name))))]),r.type==="file"?(p(),k("span",ot,C(ce(r)),1)):S("",!0)],8,rt),c(o(Z),{checked:l.value.has(r.path),onChange:()=>me(r),onClick:t[6]||(t[6]=Pe(()=>{},["stop"]))},null,8,["checked","onChange"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])):(p(),g(o(Ie),{key:1,description:o(U)?"Loading...":"No files"},null,8,["description"]))]),_:1}),o(I)&&o(I).totalCount>d.pageSize?(p(),g(o(je),{key:0,current:d.currentIndex,"onUpdate:current":t[7]||(t[7]=r=>d.currentIndex=r),"page-size":d.pageSize,"onUpdate:pageSize":t[8]||(t[8]=r=>d.pageSize=r),total:o(I).totalCount,"show-total":r=>`${r} items`,"show-size-changer":"","page-size-options":["10","20","50","100"],style:{"margin-top":"20px","text-align":"center"}},null,8,["current","page-size","total","show-total"])):S("",!0),c(o(ze),{open:n.value,"onUpdate:open":t[10]||(t[10]=r=>n.value=r),title:"Create Folder",onOk:Q,onCancel:t[11]||(t[11]=r=>n.value=!1)},{default:u(()=>[c(o(Se),{value:i.value,"onUpdate:value":t[9]||(t[9]=r=>i.value=r),placeholder:"Enter folder name",onPressEnter:Q},null,8,["value"])]),_:1},8,["open"])]))}});const it=oe(st,[["__scopeId","data-v-2be8fa34"]]),ct={class:"files-container"},ut=le({__name:"Files",setup(s){const n=$e().params.projectId,i=N.fromProjectId(n);return(l,m)=>(p(),k("div",ct,[c(o(xe),null,{default:u(()=>[P(C(o(K).translate("i18n_filesview_title")),1)]),_:1}),c(o(Fe),null,{default:u(()=>[P(C(o(K).translate("i18n_filesview_description"))+" ",1),c(ye,{path:"tools/files"})]),_:1}),c(o(Re),{class:"files-card"},{default:u(()=>[c(it,{"files-model":o(i)},null,8,["files-model"])]),_:1})]))}});const St=oe(ut,[["__scopeId","data-v-1d917c14"]]);export{St as default};
//# sourceMappingURL=Files.19dab4e0.js.map

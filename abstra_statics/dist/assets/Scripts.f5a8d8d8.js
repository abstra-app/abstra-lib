import{d as T,F as k,a as ae,b as u,c as d,w as t,f as a,u as e,ao as c,eB as $,bf as be,bd as K,ew as we,bK as ke,ev as C,t as J,e as w,eC as Y,eD as q,et as U,ag as Se,cw as j,af as P,eF as B,bF as X,bp as Ce,bM as G,ab as Fe,eA as se,cz as Ie,bo as L,eK as Te,ey as Ae,r as Q,c2 as xe}from"./outputWidgets.9da14cab.js";import{F as x}from"./forms.95c6a698.js";import{H as N,J as M}from"./jobs.a4c60708.js";import{W as oe}from"./workspaces.02ab2218.js";import{S as D}from"./scripts.ba3ab98f.js";import{a as V}from"./asyncComputed.0987ea4f.js";import{a as Z}from"./ant-design.8db74d49.js";import{f as le,a as ie,b as ne,j as re,m as Ne,c as $e}from"./icons.596bf1aa.js";import{A as F,a as Ue}from"./Text.a55300b7.js";import{A as I}from"./index.4845a096.js";import{C as pe}from"./Card.e9a073f0.js";import{_ as ee}from"./DocsButton.vue_vue_type_script_setup_true_lang.0e2f529b.js";import{A as H,a as Me}from"./Title.9ff83db3.js";import{v as ce,b as De}from"./validations.b0968744.js";import{A as O}from"./FormItem.747cadfe.js";import"./index.58dd317a.js";import{A as Ee}from"./index.a5f40c59.js";import{F as ue}from"./Form.0999ca96.js";import{M as je}from"./Modal.40c2214d.js";import"./index.65a19675.js";import"./record.6cb31dd5.js";import"./pubsub.20ca981d.js";import"./url.9bdc8ab3.js";import"./index.56334a1c.js";import"./TabPane.8f806cb5.js";import"./hasIn.ed16d98d.js";import"./string.406102b7.js";import"./Link.d91eb8ca.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[i]="2b08c6a6-b614-498e-afc7-44baa4ed6147",l._sentryDebugIdIdentifier="sentry-dbid-2b08c6a6-b614-498e-afc7-44baa4ed6147")}catch{}})();const Pe=T({__name:"ScriptCard",props:{script:{},workspace:{}},emits:["delete","go-to-script"],setup(l,{emit:i}){const o=l,r=async()=>{if(await Z("Are you sure you want to delete this script?")){const _=await Z("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});i("delete",o.script.id,_)}},y=()=>{o.script instanceof x&&i("go-to-script",o.script.id,"form"),o.script instanceof N&&i("go-to-script",o.script.id,"hook"),o.script instanceof D&&i("go-to-script",o.script.id,"script"),o.script instanceof M&&i("go-to-script",o.script.id,"job")},g=k(()=>{if(o.script instanceof x)return le;if(o.script instanceof N)return ie;if(o.script instanceof D)return ne;if(o.script instanceof M)return re;throw new Error("Invalid script type")}),f=()=>{!o.script.file||!o.workspace||o.workspace.openFile(o.script.file)};return(_,h)=>{const s=ae("icon");return u(),d(e(pe),{key:_.script.title,class:"script-card",onClick:y},{title:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(s,{path:g.value},null,8,["path"]),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[c($(_.script.title),1)]),_:1})]),_:1})]),extra:t(()=>[a(e(ke),{trigger:["click"],onClick:h[0]||(h[0]=we(()=>{},["stop"]))},{overlay:t(()=>[a(e(be),null,{default:t(()=>[a(e(K),{onClick:f},{default:t(()=>[c("Open .py file")]),_:1}),a(e(K),{danger:"",onClick:r},{default:t(()=>[c("Delete")]),_:1})]),_:1})]),default:t(()=>[a(s,{path:e(Ne),style:{cursor:"pointer"}},null,8,["path"])]),_:1})]),default:t(()=>[_.script instanceof e(x)||_.script instanceof e(N)?(u(),d(e(I),{key:0,gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[c("URL path:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"150px"}},{default:t(()=>[c("/"+$(_.script.path),1)]),_:1})]),_:1})):C("",!0),a(e(I),{gap:"12"},{default:t(()=>[a(e(I),{gap:"small"},{default:t(()=>[a(e(F),{type:"secondary"},{default:t(()=>[c("Code:")]),_:1}),a(e(F),{ellipsis:!0,style:{"max-width":"125px"}},{default:t(()=>[c($(_.script.file),1)]),_:1})]),_:1})]),_:1})]),_:1})}}});const Be=J(Pe,[["__scopeId","data-v-0e55c24b"]]),He=l=>(Y("data-v-14680ef5"),l=l(),q(),l),Oe={class:"card-content"},Ve=He(()=>w("span",null,"New",-1)),Je=T({__name:"NewScriptCard",setup(l){return(i,o)=>{const r=ae("icon");return u(),d(e(pe),{class:"new-script-card"},{default:t(()=>[w("div",Oe,[a(r,{path:e($e)},null,8,["path"]),Ve])]),_:1})}}});const Re=J(Je,[["__scopeId","data-v-14680ef5"]]),R=l=>(Y("data-v-94df32a7"),l=l(),q(),l),ze={key:0,class:"choose-type"},Ge={class:"option-content"},Le=R(()=>w("span",null,"Forms",-1)),Ye={class:"option-content"},qe=R(()=>w("span",null,"Hooks",-1)),We={class:"option-content"},Ke=R(()=>w("span",null,"Scripts",-1)),Xe={class:"option-content"},Qe=R(()=>w("span",null,"Jobs",-1)),Ze=T({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(l,{emit:i}){const o=l,r=k(()=>o.state.type==="form"?"#fff":void 0),y=k(()=>o.state.type==="hook"?"#fff":void 0),g=k(()=>o.state.type==="script"?"#fff":void 0),f=k(()=>o.state.type==="job"?"#fff":void 0),_=h=>i("choose-type",h);return(h,s)=>h.state.state==="choosing-type"?(u(),U("div",ze,[a(e(I),{vertical:"",gap:"30"},{default:t(()=>[a(e(Ue),null,{default:t(()=>[c("Choose your script type")]),_:1}),a(e(Se),{value:h.state.type,"onUpdate:value":[s[0]||(s[0]=v=>h.state.type=v),_],size:"large","button-style":"solid"},{default:t(()=>[a(e(I),{gap:"24",vertical:""},{default:t(()=>[a(e(I),{gap:"24"},{default:t(()=>[a(e(j),{placement:"left",title:"Forms"},{content:t(()=>[a(e(H),null,{default:t(()=>[c(" Use to collect user input via interaction with a form interface ")]),_:1}),a(ee,{path:"forms/overview"})]),default:t(()=>[a(e(P),{value:"form",class:"option"},{default:t(()=>[w("div",Ge,[(u(),d(B,{key:r.value,path:e(le),fill:r.value},null,8,["path","fill"])),Le])]),_:1})]),_:1}),a(e(j),{placement:"right",title:"Hooks"},{content:t(()=>[a(e(H),null,{default:t(()=>[c("Use to build endpoints triggered by HTTP requests")]),_:1}),a(ee,{path:"forms/overview"})]),default:t(()=>[a(e(P),{value:"hook",class:"option"},{default:t(()=>[w("div",Ye,[(u(),d(B,{key:y.value,path:e(ie),fill:y.value},null,8,["path","fill"])),qe])]),_:1})]),_:1})]),_:1}),a(e(I),{gap:"24"},{default:t(()=>[a(e(j),{placement:"left",title:"Scripts"},{content:t(()=>[a(e(H),null,{default:t(()=>[c(" Use to write plain Python scripts ")]),_:1})]),default:t(()=>[a(e(P),{value:"script",class:"option"},{default:t(()=>[w("div",We,[(u(),d(B,{key:g.value,path:e(ne),fill:g.value},null,8,["path","fill"])),Ke])]),_:1})]),_:1}),a(e(j),{placement:"right",title:"Jobs"},{content:t(()=>[a(e(H),null,{default:t(()=>[c(" Use to schedule your script execution periodically ")]),_:1})]),default:t(()=>[a(e(P),{value:"job",class:"option"},{default:t(()=>[w("div",Xe,[(u(),d(B,{key:f.value,path:e(re),fill:f.value},null,8,["path","fill"])),Qe])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):C("",!0)}});const et=J(Ze,[["__scopeId","data-v-94df32a7"]]),tt=w("br",null,null,-1),at=T({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(l,{emit:i}){const o=l,{result:r}=V(()=>fetch("/_editor/api/workspace/root").then(v=>v.text())),y=k(()=>o.state.state!=="creating"?"":`${r.value}/${o.state.stage.filename}`),g=k(()=>o.state.state!=="creating"?"":`${o.state.stage.type[0].toUpperCase()+o.state.stage.type.slice(1)} title`),f=v=>{i("update-name",v);const p=De(v);i("update-file",p),h()},{result:_,refetch:h}=V(()=>oe.checkFile(o.state.stage.filename)),s=k(()=>ce(o.state.stage.filename));return(v,p)=>(u(),d(e(ue),{layout:"vertical"},{default:t(()=>{var A;return[a(e(O),{label:g.value,required:!0},{default:t(()=>[a(e(X),{value:v.state.stage.title,"onUpdate:value":f},null,8,["value"])]),_:1},8,["label"]),a(e(O),{label:"Generated file",required:!0,"validate-status":s.value.valid?"success":"error",help:s.value.valid?void 0:s.value.reason},{default:t(()=>[a(e(Ce),{placement:"right"},{title:t(()=>[c(" You can change this later ")]),default:t(()=>[a(e(X),{value:v.state.stage.filename,"onUpdate:value":p[0]||(p[0]=z=>v.state.stage.filename=z),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["validate-status","help"]),a(e(O),null,{default:t(()=>[a(e(F),null,{default:t(()=>[c(" Your script will be generated at: ")]),_:1}),tt,a(e(F),{code:""},{default:t(()=>[c($(y.value),1)]),_:1})]),_:1}),(A=e(_))!=null&&A.exists?(u(),d(e(Ee),{key:0,type:"warning"},{message:t(()=>[a(e(F),null,{default:t(()=>[a(e(F),{strong:""},{default:t(()=>[c("Warning:")]),_:1}),c(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):C("",!0)]}),_:1}))}}),st=T({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(l,{emit:i}){const o=l,r=p=>i("update-name",p),y=p=>i("update-file",p),g=()=>i("close"),f=p=>i("choose-type",p),_=()=>i("next-step"),h=()=>i("previous-step"),s=()=>i("create-script"),v=k(()=>!(o.state.state!=="creating"||!ce(o.state.stage.filename).valid||!o.state.stage.title));return(p,A)=>(u(),d(e(je),{open:p.open,title:"Create a new script",onCancel:g},{footer:t(()=>[p.state.state==="creating"?(u(),d(e(G),{key:0,onClick:h},{default:t(()=>[c("Previous")]),_:1})):C("",!0),p.state.state==="creating"?(u(),d(e(G),{key:1,type:"primary",disabled:!v.value,onClick:s},{default:t(()=>[c(" Create ")]),_:1},8,["disabled"])):C("",!0),p.state.state==="choosing-type"?(u(),d(e(G),{key:2,type:"primary",disabled:!p.state.type,onClick:_},{default:t(()=>[c(" Next ")]),_:1},8,["disabled"])):C("",!0)]),default:t(()=>[p.state.state==="choosing-type"?(u(),d(et,{key:0,state:p.state,onChooseType:f},null,8,["state"])):C("",!0),p.state.state==="creating"?(u(),d(at,{key:1,state:p.state,onUpdateName:r,onUpdateFile:y},null,8,["state"])):C("",!0)]),_:1},8,["open"]))}}),ot=T({__name:"FilterScripts",emits:["update-filter"],setup(l,{emit:i}){const o=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],r=y=>i("update-filter",y);return(y,g)=>(u(),d(e(ue),null,{default:t(()=>[a(e(O),{label:"Filter"},{default:t(()=>[a(e(Fe),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":r},{default:t(()=>[(u(),U(L,null,se(o,f=>a(e(Ie),{key:f.value,value:f.value},{default:t(()=>[c($(f.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),lt=200,it=l=>{if(!l)return[0,0];if(l.length===0)return[0,0];let i=-1/0,o=0;for(const r of l)r.position.x>i&&(i=r.position.x),o+=r.position.y/l.length;return[i+lt,o]},nt=l=>{if(l instanceof x)return"form";if(l instanceof N)return"hook";if(l instanceof M)return"job";if(l instanceof D)return"script";throw new Error("Invalid script type")},rt=l=>(Y("data-v-f170da7e"),l=l(),q(),l),pt={key:0},ct=rt(()=>w("span",null,"loading",-1)),ut=[ct],te=100,dt=T({__name:"Scripts",setup(l){Te(n=>({"69f5c37e":ye()}));const i=Ae(),{loading:o,result:r,refetch:y}=V(async()=>Promise.all([x.list(),N.list(),M.list(),D.list()]).then(([n,m,b,S])=>[...n,...m,...b,...S])),{result:g}=V(()=>oe.get()),f=Q([]),_=n=>{f.value=n},h=k(()=>r.value?f.value.length===0?r.value:r.value.filter(n=>f.value.includes(nt(n))):[]),s=Q({state:"idle"}),v=k(()=>s.value.state==="choosing-type"||s.value.state==="creating"),p=()=>{s.value={state:"choosing-type",type:null}},A=()=>{s.value={state:"idle"}},z=n=>{s.value.state==="choosing-type"&&(s.value={state:"choosing-type",type:n})},de=()=>{s.value.state==="choosing-type"&&s.value.type!==null&&(s.value={state:"creating",stage:{type:s.value.type,title:`Untitled ${s.value.type}`,filename:`untitled_${s.value.type}.py`}})},fe=()=>{s.value.state==="creating"&&(s.value={state:"choosing-type",type:s.value.stage.type})},_e=n=>{s.value.state==="creating"&&(s.value.stage.title=n)},me=n=>{s.value.state==="creating"&&(s.value.stage.filename=n)},ve=async(n,m)=>{var b,S;await((S=(b=r.value)==null?void 0:b.find(E=>E.id===n))==null?void 0:S.delete(m)),await y()},ye=()=>(te/1e3).toString()+"s",he=async()=>{if(s.value.state!=="creating")return;const n=it(r.value||[]);let m;if(s.value.stage.type==="form"?m=await x.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="hook"?m=await N.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="job"?m=await M.create(s.value.stage.title,s.value.stage.filename,n):s.value.stage.type==="script"&&(m=await D.create(s.value.stage.title,s.value.stage.filename,n)),!m)throw new Error("Failed to create script");const b=m.id,S=s.value.stage.type;A(),await y(),setTimeout(()=>{W(b,S)},te)},W=(n,m)=>{var b,S;if(m==="form"&&i.push({name:"formEditor",params:{id:n}}),m==="hook"&&i.push({name:"hookEditor",params:{id:n}}),m==="script"){const E=(b=r.value)==null?void 0:b.find(ge=>ge.id===n);if(!E)return;(S=g.value)==null||S.openFile(E.file)}m==="job"&&i.push({name:"jobEditor",params:{id:n}})};return(n,m)=>(u(),U(L,null,[e(o)?(u(),U("span",pt,ut)):C("",!0),a(e(Me),null,{default:t(()=>[c("Home")]),_:1}),a(ot,{onUpdateFilter:_}),a(e(I),{wrap:"wrap",gap:"large",class:"scripts-container"},{default:t(()=>[a(xe,null,{default:t(()=>[(u(!0),U(L,null,se(h.value,b=>(u(),d(Be,{key:b.title,script:b,workspace:e(g),onDelete:ve,onGoToScript:W},null,8,["script","workspace"]))),128))]),_:1}),a(Re,{onClick:p})]),_:1}),a(st,{open:v.value,state:s.value,onClose:A,onChooseType:z,onNextStep:de,onPreviousStep:fe,onCreateScript:he,onUpdateName:_e,onUpdateFile:me},null,8,["open","state"])],64))}});const Vt=J(dt,[["__scopeId","data-v-f170da7e"]]);export{Vt as default};
//# sourceMappingURL=Scripts.f5a8d8d8.js.map

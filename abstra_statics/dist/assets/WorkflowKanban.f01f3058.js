var oe=Object.defineProperty;var ie=(n,t,a)=>t in n?oe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var U=(n,t,a)=>(ie(n,typeof t!="symbol"?t+"":t,a),a);import{t as de}from"./ant-design.d494077f.js";import{f as i,eG as te,e$ as ce,r as $,G as j,E as fe,o as pe,K as ge,d as M,F as me,b as u,c as d,w as r,u as e,aq as y,eD as k,ex as b,ev as h,bq as S,eC as w,ci as ye,bg as ve,cC as F,bO as z,bH as _e,ad as E,cB as N,a as he,co as be,dq as X,e as V,cK as Se,ck as ke,v as we}from"./outputWidgets.333243b5.js";import{a as B}from"./asyncComputed.916d2e38.js";import{L as Ce,a as Oe}from"./log.d431b0e1.js";import"./authorManager.afcc9659.js";import"./index.cbd7b276.js";import{T as Ae}from"./index.f1fc9225.js";import{A as ae}from"./index.e33ba097.js";import{A as ne}from"./index.7a3dbad5.js";import{A as q,a as Re}from"./Title.3b7d5185.js";import{D as xe,a as Ie,A as re,C as le}from"./index.12dbcf3c.js";import{_ as De}from"./SaveButton.vue_vue_type_script_setup_true_lang.6626792f.js";import{A as Pe}from"./Text.f7432746.js";import{F as se}from"./Form.950f385f.js";import{A as L}from"./FormItem.413481bf.js";import{W as Te}from"./workspaces.76ae478a.js";import{F as Fe}from"./index.9961e9cd.js";import{C as Ee}from"./Card.a3469205.js";import{E as Ne}from"./ExpandOutlined.9407071f.js";import{A as $e}from"./index.597ee428.js";import"./index.e0bce9ea.js";import"./gateway.d354a11c.js";import"./index.cf4c23b9.js";import"./record.3365b440.js";import"./pubsub.6843f3da.js";import"./isNumeric.75337b1e.js";import"./hasIn.cb198a04.js";import"./url.2fbcdffc.js";import"./index.0fc4370c.js";import"./index.58647876.js";import"./TabPane.11abb547.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="99a08ed0-2981-4de3-8ca6-c5277d00e1ea",n._sentryDebugIdIdentifier="sentry-dbid-99a08ed0-2981-4de3-8ca6-c5277d00e1ea")}catch{}})();var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM641.7 520.8L442.3 677.6c-7.4 5.8-18.3.6-18.3-8.8V355.3c0-9.4 10.9-14.7 18.3-8.8l199.4 156.7a11.2 11.2 0 010 17.6z"}}]},name:"play-square",theme:"filled"};const Le=je;function Y(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(f){return Object.getOwnPropertyDescriptor(a,f).enumerable}))),l.forEach(function(f){Ue(n,f,a[f])})}return n}function Ue(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var W=function(t,a){var l=Y({},t,a.attrs);return i(te,Y({},l,{icon:ce}),null)};W.displayName="EyeOutlined";W.inheritAttrs=!1;const Ve=W;function Z(n){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(f){return Object.getOwnPropertyDescriptor(a,f).enumerable}))),l.forEach(function(f){qe(n,f,a[f])})}return n}function qe(n,t,a){return t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n}var J=function(t,a){var l=Z({},t,a.attrs);return i(te,Z({},l,{icon:Le}),null)};J.displayName="PlaySquareFilled";J.inheritAttrs=!1;const ze=J;function Be(n){switch(n.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"};case"abandoned":return{color:"warning",text:"Abandoned"}}}function Me(){const n=$({state:"closed"});function t(){n.value={state:"closed"}}function a(){n.value={state:"visualizations"}}function l(c,s){n.value={state:"stage-run",stageRun:s}}const f=j(()=>"stageRun"in n.value?n.value.stageRun:null);return{closeDrawer:t,openVisualizationEditor:a,inspectStageRun:l,drawerState:n,selectedStageRunForDrawer:f}}function We({getKanbanData:n,storage:t,getWorkspace:a}){const l=t!=null?t:localStorage;function f(){const g=l.getItem("kanban-selected-stage-ids");if(g)try{return JSON.parse(g)}catch{return[]}else return[]}const c=fe(f()),s=B(async()=>{try{const g=await n(c.value);return l.setItem("kanban-selected-stage-ids",JSON.stringify(c.value)),g}catch{return l.setItem("kanban-selected-stage-ids",JSON.stringify([])),{columns:[],next_stage_options:[]}}finally{c.value=f()}}),C=B(()=>a());async function A(g,o){g?c.value=[...c.value.slice(0,o),g]:c.value=c.value.slice(0,o),await s.refetch()}function R(g,o){var p;const _=(p=g.stages)==null?void 0:p.find(D=>D.id===g.selected_stage.id);if((_==null?void 0:_.type)==="form"){const D=(o==null?void 0:o.status)==="waiting"?{"abstra-run-id":o.id}:{};return{path:`/${_.path}`,query:D}}else return null}let O=null;function x(){pe(()=>{O=setInterval(()=>{s.refetch()},1e3)}),ge(()=>{O&&clearInterval(O)})}const I=j(()=>{var o,_,p;const g=(_=(o=s.result.value)==null?void 0:o.columns)!=null?_:[];return(p=g[g.length-1])==null?void 0:p.selected_stage});return{kanbanAsyncComputed:s,selectedStageIds:c,setNewSelectedStageId:A,workspaceAsyncComputed:C,launchLink:R,lastSelectedStage:I,init:x}}const Je={key:2},Ge={key:3},Ke=M({__name:"StageRunInspector",props:{stageRun:{}},setup(n){const t=n,a=j(()=>t.stageRun?Array.from(new Set(t.stageRun.logs.map(s=>s.event))):[]),l=me({filters:a.value}),f=j(()=>t.stageRun?t.stageRun.logs.filter(s=>s.payload&&l.filters.includes(s.event)):[]),c=s=>Oe.fromDTO({executionId:s.executionId,runtimeType:s.runtimeType,runtimeName:s.runtimeName,payload:s.payload,event:s.event,createdAt:new Date(s.createdAt*1e3),buildId:""});return(s,C)=>(u(),d(e(ae),{open:"",title:"Stage Run Inspector",size:"large"},{default:r(()=>{var A,R,O,x,I,g;return[i(e(q),null,{default:r(()=>[y(" Status: "),i(e(ne),{style:{"font-weight":"600"}},{default:r(()=>{var o;return[y(k((o=s.stageRun)==null?void 0:o.status),1)]}),_:1})]),_:1}),(A=s.stageRun)!=null&&A.assignee?(u(),d(e(q),{key:0},{default:r(()=>{var o;return[y(" Assignee: "+k((o=s.stageRun)==null?void 0:o.assignee),1)]}),_:1})):b("",!0),(R=s.stageRun)!=null&&R.created_at?(u(),d(e(q),{key:1},{default:r(()=>{var o;return[y(" Created at: "+k((o=s.stageRun)==null?void 0:o.created_at),1)]}),_:1})):b("",!0),((O=s.stageRun)==null?void 0:O.content)&&((x=s.stageRun)==null?void 0:x.content.length)>0?(u(),h("div",Je,[i(e(Ie),{title:"Stored data",size:"small",layout:"vertical",column:1},{default:r(()=>{var o;return[(u(!0),h(S,null,w((o=s.stageRun)==null?void 0:o.content,_=>(u(),d(e(xe),{key:_.key,label:_.key},{default:r(()=>{var p;return[y(k((p=_.value)!=null?p:"null"),1)]}),_:2},1032,["label"]))),128))]}),_:1})])):b("",!0),((I=s.stageRun)==null?void 0:I.logs)&&((g=s.stageRun)==null?void 0:g.logs.length)>0?(u(),h("div",Ge,[i(e(Re),{level:4},{default:r(()=>[y("Logs")]),_:1}),i(e(ye),{value:l.filters,"onUpdate:value":C[0]||(C[0]=o=>l.filters=o),options:a.value},null,8,["value","options"]),i(e(Ae),null,{default:r(()=>[(u(!0),h(S,null,w(f.value,o=>(u(),d(Ce,{key:o.executionId,log:c(o)},null,8,["log"]))),128))]),_:1})])):b("",!0)]}),_:1}))}}),He=[{value:"text",label:"Text"},{value:"image",label:"Image"},{value:"table",label:"Table"},{value:"progress-bar",label:"Progress Bar"}];class ee{static async get(){return(await fetch("/_editor/api/visualizations")).json()}static async put(t){const a=await fetch("/_editor/api/visualizations",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return Object.freeze(a.json())}}function Qe(n,t){const a=n.length;if(a!==t.length)return!1;for(let l=0;l<a;l++)if(n[l].name!==t[l].name||n[l].type!==t[l].type)return!1;return!0}function T(n,t){var a;return{...n,id:(a=t==null?void 0:t.toString())!=null?a:Math.random().toString(36).slice(2)}}class G{constructor(t){U(this,"initialItems");U(this,"_items");this.initialItems=t.map((a,l)=>T(a,l)),this._items=$(t.map((a,l)=>T(a,l)))}get items(){return this._items.value}hasChanges(){return!Qe(this.initialItems,this.items)}async save(){const t=await ee.put(this.items);this.initialItems=t.map((a,l)=>T(a,l)),this._items.value=t.map((a,l)=>T(a,l))}static async get(){const t=await ee.get();return new G(t)}add(){this.items.push(T({name:"New var",type:"text"}))}remove(t){const a=this.items.findIndex(l=>l.id===t);a!==-1&&this.items.splice(a,1)}}const Xe=M({__name:"VisualizationEditor",setup(n){const{result:t,loading:a}=B(()=>G.get());return(l,f)=>(u(),d(e(ae),{open:"",title:"Visualization settings"},{extra:r(()=>[e(t)?(u(),d(De,{key:0,model:e(t),disabled:!e(t).hasChanges()},null,8,["model","disabled"])):b("",!0)]),default:r(()=>[e(a)||!e(t)?(u(),d(e(ve),{key:0})):(u(),d(e(F),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>[i(e(z),{onClick:f[0]||(f[0]=c=>e(t).add())},{default:r(()=>[y("Add")]),_:1}),i(e(le),{bordered:!1},{default:r(()=>[(u(!0),h(S,null,w(e(t).items,c=>(u(),d(e(re),{key:c.id},{header:r(()=>[c.name?(u(),d(e(Pe),{key:0,strong:!0},{default:r(()=>[y(k(c.name),1)]),_:2},1024)):b("",!0)]),extra:r(()=>[i(e(z),{danger:"",onClick:s=>e(t).remove(c.id)},{default:r(()=>[y(" Remove ")]),_:2},1032,["onClick"])]),default:r(()=>[i(e(se),{layout:"vertical"},{default:r(()=>[i(e(L),{label:"Property name"},{default:r(()=>[i(e(_e),{value:c.name,"onUpdate:value":s=>c.name=s},null,8,["value","onUpdate:value"])]),_:2},1024),i(e(L),null,{default:r(()=>[i(e(E),{value:c.type,"onUpdate:value":s=>c.type=s,label:"Visualization type"},{default:r(()=>[(u(!0),h(S,null,w(e(He),s=>(u(),d(e(N),{key:s.value,value:s.value},{default:r(()=>[y(k(s.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1}))}}),ue=["waiting","running","finished","failed"];function Ye(){const n=$([...ue]),t=$("");return{filterStatus:n,filterSearch:t}}async function Ze(n){return(await fetch("/_editor/api/kanban",{method:"POST",body:JSON.stringify({selected_stages_ids:n}),headers:{"Content-Type":"application/json"}})).json()}const et={class:"stages-container"},tt={class:"stages-content"},at={style:{"max-height":"200px","overflow-y":"hidden"}},nt=M({__name:"WorkflowKanban",setup(n){const{kanbanAsyncComputed:t,launchLink:a,setNewSelectedStageId:l,lastSelectedStage:f,init:c}=We({getKanbanData:Ze,getWorkspace:()=>Te.get()}),{filterSearch:s,filterStatus:C}=Ye(),{closeDrawer:A,inspectStageRun:R,openVisualizationEditor:O,drawerState:x,selectedStageRunForDrawer:I}=Me();return c(),(g,o)=>{const _=he("router-link");return u(),h(S,null,[i(e($e),{vertical:"",style:{height:"100%"}},{default:r(()=>[i(e(le),{ghost:""},{default:r(()=>[i(e(re),{header:"Filters"},{default:r(()=>[i(e(se),null,{default:r(()=>[i(e(L),{label:"Search"},{default:r(()=>[i(e(be),{value:e(s),"onUpdate:value":o[0]||(o[0]=p=>X(s)?s.value=p:null),placeholder:"Search",style:{width:"400px"}},null,8,["value"])]),_:1}),i(e(L),{label:"Status"},{default:r(()=>[i(e(E),{value:e(C),"onUpdate:value":o[1]||(o[1]=p=>X(C)?C.value=p:null),mode:"multiple",style:{width:"400px"}},{default:r(()=>[(u(!0),h(S,null,w(e(ue),p=>(u(),d(e(N),{key:p,value:p},{default:r(()=>[y(k(e(Be)({status:p}).text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),V("div",et,[V("div",tt,[i(e(F),{align:"start"},{default:r(()=>{var p,D,K;return[(u(!0),h(S,null,w((D=(p=e(t).result.value)==null?void 0:p.columns)!=null?D:[],(m,H)=>(u(),d(e(F),{key:H,direction:"vertical"},{default:r(()=>[i(e(E),{style:{width:"100%","min-width":"200px"},"allow-clear":"",value:m.selected_stage.id,"onUpdate:value":v=>e(l)(v,H)},{default:r(()=>[(u(!0),h(S,null,w(m.stages,v=>(u(),d(e(N),{key:v.id,value:v.id},{default:r(()=>[y(k(v.title),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),m.selected_stage.id?(u(),d(e(F),{key:0,direction:"vertical",style:{width:"100%"}},{default:r(()=>[(u(!0),h(S,null,w(m.stage_run_cards,v=>{var Q;return u(),d(e(Ee),{key:v.id,size:"small",style:{"max-width":"250px",cursor:"pointer"},"body-style":{display:((Q=v.content)==null?void 0:Q.length)>0?"block":"none"},onClick:P=>e(R)(m,v)},{title:r(()=>[i(e(ne),null,{default:r(()=>[y(k(v.status),1)]),_:2},1024)]),default:r(()=>[V("div",at,[(u(!0),h(S,null,w(v.content,P=>(u(),d(e(Se),{key:P.key,"tree-data":e(de)(P.value)},null,8,["tree-data"]))),128))]),y(" "+k(v.assignee),1)]),actions:r(()=>[e(a)(m,v)?(u(),d(_,{key:0,to:e(a)(m,v),target:"_blank",onClick:o[2]||(o[2]=P=>P.stopPropagation())},{default:r(()=>[i(e(ze))]),_:2},1032,["to"])):b("",!0)]),extra:r(()=>[i(e(Ne),{onClick:P=>e(R)(m,v)},null,8,["onClick"])]),_:2},1032,["body-style","onClick"])}),128)),m.stage_run_cards.length===0?(u(),d(e(ke),{key:0})):b("",!0),m.selected_stage.can_be_started&&e(a)(m)!==null?(u(),d(_,{key:1,target:"_blank",to:e(a)(m)},{default:r(()=>[i(e(z),{style:{width:"100%"}},{default:r(()=>[y(" Start ")]),_:1})]),_:2},1032,["to"])):b("",!0)]),_:2},1024)):b("",!0)]),_:2},1024))),128)),e(t).result.value&&e(t).result.value.next_stage_options.length>0?(u(),d(e(E),{key:(K=e(f))==null?void 0:K.id,style:{width:"100%","min-width":"200px"},"allow-clear":"","onUpdate:value":o[3]||(o[3]=m=>e(l)(m,e(t).result.value.columns.length))},{default:r(()=>[(u(!0),h(S,null,w(e(t).result.value.next_stage_options,m=>(u(),d(e(N),{key:m.id,value:m.id},{default:r(()=>[y(k(m.title),1)]),_:2},1032,["value"]))),128))]),_:1})):b("",!0)]}),_:1})])])]),_:1}),e(x).state==="stage-run"&&e(I)?(u(),d(Ke,{key:0,"stage-run":e(I),onClose:e(A)},null,8,["stage-run","onClose"])):e(x).state==="visualizations"?(u(),d(Xe,{key:1,onClose:e(A)},null,8,["onClose"])):b("",!0),i(e(Fe),{onClick:e(O)},{icon:r(()=>[i(e(Ve))]),_:1},8,["onClick"])],64)}}});const $t=we(nt,[["__scopeId","data-v-8cc79f02"]]);export{$t as default};
//# sourceMappingURL=WorkflowKanban.f01f3058.js.map

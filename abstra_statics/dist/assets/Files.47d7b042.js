import{f as c,ez as I,d as L,eB as M,G as U,r as H,b as d,c as f,w as u,u as l,aq as m,dh as G,bU as w,e as g,eD as j,eu as F,ew as y,cP as q,cn as J,cF as Q,eE as W,eF as X,t as Y}from"./outputWidgets.8ed5c9f3.js";import"./router.afff361c.js";import"./columns.3f63be75.js";import{C as h}from"./gateway.82499ebb.js";import{a as Z}from"./asyncComputed.8a952af2.js";import{a as K}from"./ant-design.104e9a39.js";import{p as ee}from"./popupNotifcation.ff436ad0.js";import{D as te,a as ne,C as re}from"./DownloadOutlined.ad7e8d23.js";import{A as ae}from"./Title.c0f8cffb.js";import{b as A}from"./Text.e6e81a88.js";import"./Base.7a191de8.js";import"./transButton.67499561.js";import"./index.a6f782d1.js";import"./activeRecord.065f5706.js";import"./pubsub.d7e8bfae.js";import"./index.9e0a5f68.js";import"./TabPane.bb242da2.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="ea988411-7405-46a9-a185-709685525d01",t._sentryDebugIdIdentifier="sentry-dbid-ea988411-7405-46a9-a185-709685525d01")}catch{}})();var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const le=oe;function E(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},a=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable}))),a.forEach(function(o){ie(t,o,n[o])})}return t}function ie(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var D=function(e,n){var a=E({},e,n.attrs);return c(I,E({},a,{icon:te}),null)};D.displayName="DeleteOutlined";D.inheritAttrs=!1;const se=D;function x(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},a=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable}))),a.forEach(function(o){ce(t,o,n[o])})}return t}function ce(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(e,n){var a=x({},e,n.attrs);return c(I,x({},a,{icon:ne}),null)};P.displayName="DownloadOutlined";P.inheritAttrs=!1;const ue=P;function N(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},a=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable}))),a.forEach(function(o){de(t,o,n[o])})}return t}function de(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var C=function(e,n){var a=N({},e,n.attrs);return c(I,N({},a,{icon:le}),null)};C.displayName="UploadOutlined";C.inheritAttrs=!1;const pe=C;class ${constructor(e){this.projectId=e}static fromProjectId(e){return new $(e)}async list(){return h.get(`projects/${this.projectId}/files`)}async upload(e){return h.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e.name)}`,e,!1)}async download(e){return h.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return h.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,n){return h.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(n)}`,{})}}const B=t=>(W("data-v-638d22f6"),t=t(),X(),t),fe=B(()=>g("br",null,null,-1)),me=B(()=>g("a",{href:"https://docs.abstra.io/utils/#persistent-dir",target:"_blank"},"Learn more about it",-1)),ye={key:0},he={key:0,class:"file-size"},be=L({__name:"Files",setup(t){const n=M().params.projectId,a=$.fromProjectId(n),{loading:o,result:R,refetch:S}=Z(()=>a.list());function k(r){var i,s;return{key:r.path,title:r.name,isLeaf:r.type==="file",file:r,children:r.type==="file"?[]:(s=(i=r.children)==null?void 0:i.map(k))!=null?s:[]}}const p=U(()=>{var r;return(r=R.value)==null?void 0:r.map(k)}),_=U(()=>{var r,i;return(i=(r=p==null?void 0:p.value)==null?void 0:r.length)!=null?i:0}),O=H(!1);function V(){const r=document.createElement("input");r.type="file",r.onchange=async()=>{var s;const i=(s=r.files)==null?void 0:s[0];if(!!i)try{O.value=!0,await a.upload(i),await S()}catch{ee("Failed to upload file","File already exists")}finally{O.value=!1}},r.click()}async function z(r){if(!r)return;const i=await a.download(r.path),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=r.name,s.click()}async function T(r){!r||await K("Are you sure you want to delete this file?")&&(await a.delete(r.path),await S())}return(r,i)=>(d(),f(l(Q),{direction:"vertical"},{default:u(()=>[c(l(ae),null,{default:u(()=>[m("Files")]),_:1}),c(l(A),null,{default:u(()=>[m(" Here you can upload, download and delete files in your persistent dir."),fe,m(" Files can be used in your scripts. "),me,G(r.$slots,"description",{},void 0,!0)]),_:3}),c(l(w),{type:"primary",loading:O.value,onClick:V},{default:u(()=>[c(l(pe)),m(" Upload ")]),_:1},8,["loading"]),c(l(re),null,{default:u(()=>[_.value>0?(d(),f(l(A),{key:0},{default:u(()=>[g("b",null,[m(j(_.value)+" file",1),_.value!==1?(d(),F("span",ye,"s")):y("",!0)])]),_:1})):y("",!0),p.value&&p.value.length>0?(d(),f(l(q),{key:1,"tree-data":p.value,selectable:!1},{title:u(({title:s,isLeaf:b,file:v})=>[g("span",null,[m(j(s)+" ",1),b?(d(),F("span",he,"("+j(v.size)+")",1)):y("",!0)]),b?(d(),f(l(w),{key:0,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>z(v)},{default:u(()=>[c(l(ue))]),_:2},1032,["onClick"])):y("",!0),b?(d(),f(l(w),{key:1,type:"text",size:"small",style:{float:"inline-end"},onClick:()=>T(v)},{default:u(()=>[c(l(se))]),_:2},1032,["onClick"])):y("",!0)]),_:1},8,["tree-data"])):(d(),f(l(J),{key:2,description:l(o)?"Loading...":"No files"},null,8,["description"]))]),_:1})]),_:3}))}});const xe=Y(be,[["__scopeId","data-v-638d22f6"]]);export{xe as default};
//# sourceMappingURL=Files.47d7b042.js.map

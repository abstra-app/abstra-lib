import{R as ue,F as ie,r as ee}from"./FormRunner.7b51fc6c.js";import{f as a,eF as te,d as D,r as P,G as x,b as g,c as h,w as r,az as m,eC as $,u as e,bX as B,cC as ae,F as de,H as re,ez as oe,ew as R,eu as G,eB as ce,cG as pe,bQ as w,b6 as me,bx as fe,e as ve,bR as W,eA as ge,eI as ye}from"./outputWidgets.6d6b4a37.js";import{R as he,S as be,L as we}from"./RuntimeCommonSettings.678c05b5.js";import{B as _e}from"./BaseLayout.5a0efef2.js";import{a as ne}from"./asyncComputed.17a6198d.js";import{F as ke}from"./forms.11a3d85b.js";import{W as le}from"./workspaces.ed4248fb.js";import{l as Y,N as xe}from"./NavbarControls.f407b84f.js";import{A as X}from"./index.f744c3f5.js";import{C as Se,A as Pe}from"./CollapsePanel.1657046b.js";import{a as F}from"./index.9eddb8ae.js";import{A as v,F as se}from"./Form.1ff54ed5.js";import{A as Oe}from"./index.6f6e8ffd.js";import{A as Ae}from"./index.0e216cc8.js";import{A as T}from"./Title.b41b4f96.js";import{A as J,T as Re}from"./TabPane.2e98a9d7.js";import"./index.54fb1b86.js";import{c as Le}from"./index.838a4574.js";import"./url.b5fbb423.js";import"./index.ec217461.js";import"./pubsub.7d377b25.js";import"./icons.28d0d847.js";import"./CircularLoading.a69637ff.js";import"./PlayerNavbar.a442f839.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.ad5557a9.js";import"./WidgetsFrame.fc26c5ed.js";import"./uuid.7843f981.js";import"./jobs.18f2760c.js";import"./record.7835c07e.js";import"./popupNotifcation.fbd53de0.js";import"./SaveButton.vue_vue_type_script_setup_true_lang.18978e4d.js";import"./ant-design.c99b7781.js";import"./index.f2a53bdb.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="24715b6b-c55c-43eb-9de8-46cb8c38f7f4",s._sentryDebugIdIdentifier="sentry-dbid-24715b6b-c55c-43eb-9de8-46cb8c38f7f4")}catch{}})();var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"};const Ce=Te;var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const Be=$e;function Z(s){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},u=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),u.forEach(function(o){De(s,o,t[o])})}return s}function De(s,n,t){return n in s?Object.defineProperty(s,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[n]=t,s}var q=function(n,t){var u=Z({},n,t.attrs);return a(te,Z({},u,{icon:Ce}),null)};q.displayName="ExpandOutlined";q.inheritAttrs=!1;const Ue=q;function K(s){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?Object(arguments[n]):{},u=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),u.forEach(function(o){Ee(s,o,t[o])})}return s}function Ee(s,n,t){return n in s?Object.defineProperty(s,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[n]=t,s}var I=function(n,t){var u=K({},n,t.attrs);return a(te,K({},u,{icon:Be}),null)};I.displayName="LinkOutlined";I.inheritAttrs=!1;const Fe=I,qe=D({__name:"LaunchButton",props:{path:{}},setup(s){const n=s,t=P({state:"loading"}),u=x(()=>t.value.state!=="found"),o=x(()=>t.value.state==="loading"),d=x(()=>t.value.state==="found"?t.value.url:void 0),l=x(()=>{switch(t.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${t.value}`)}}),L=x(()=>{switch(t.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${t.value}`)}});async function k(f){const p=`https://${f}.abstra.app/_version`;return(await fetch(p)).ok}async function O(f){const p=`https://${f}.abstra.app/_pages/${n.path}`;return(await fetch(p)).ok}async function A(){if(!(await Y.get()).logged){t.value={state:"not-logged"};return}const p=await Y.getProjectInfo().catch(()=>null);if(!p){t.value={state:"error"};return}if(!await k(p.subdomain).catch(()=>null)){t.value={state:"not-deployed"};return}if(!await O(p.subdomain).catch(()=>null)){t.value={state:"not-found"};return}const U=`https://${p.subdomain}.abstra.app/${n.path}`;t.value={state:"found",url:U}}return A(),(f,p)=>(g(),h(e(ae),{title:l.value},{content:r(()=>[m($(L.value),1)]),default:r(()=>[a(e(B),{href:d.value,target:"_blank",disabled:u.value,loading:o.value,size:"small",type:"link"},{icon:r(()=>[a(e(Fe))]),default:r(()=>[m(" Open Deployed ")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Ie=ve("p",{style:{width:"200px"}}," Add query params to simulate someone using your forms with specific data in the URL. ",-1),Me={key:2,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},C="abstra-run-id",Ne=D({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(s,{expose:n,emit:t}){var z,Q,V,H;const u=s,o=P(void 0);function d(){o.value=o.value?void 0:"query-params"}const l=de({queryParams:[],url:`${u.form.path}`,stageRunId:null}),L=i=>{l.stageRunId=i},{result:k,loading:O}=ne(()=>le.get()),A=()=>{l.queryParams.push({name:"",value:""})},f=i=>{l.queryParams=l.queryParams.filter((_,c)=>c!==i)};re([()=>l.stageRunId,()=>l.queryParams],([i,_])=>{const c=_.find(y=>y.name===C);if(console.log(i,c),i&&!c){l.queryParams.push({name:C,value:i});return}if(!i&&c){l.queryParams=l.queryParams.filter(y=>y.name!==C);return}i&&c&&i!==c.value&&(c.value=i)});const p=x(()=>ue.create(u.form.id));(z=p.value)==null||z.on("stdout",i=>{u.logService.log({type:"stdout",log:i.log})}),(Q=p.value)==null||Q.on("stderr",i=>{u.logService.log({type:"stderr",log:i.log})}),(V=p.value)==null||V.onClose(()=>{u.logService.log({type:"stderr",log:"Program closed"})}),(H=p.value)==null||H.on("files:changed",()=>{u.logService.log({type:"files-changed",log:"Files changed"})});const b=oe(),M=({path:i})=>{ee("editor",b,i)};function U(i,_){t("redirect",i,_)}const N=P(null);async function j(){var i;return u.logService.log({type:"restart"}),(i=N.value)==null?void 0:i.run()}const E=x(()=>{const i=new URLSearchParams(l.queryParams.filter(c=>c.name.trim()).reduce((c,y)=>({...c,[y.name]:y.value}),{})).toString();return{subdomain:"[your-subdomain]",path:u.form.path,query:i}});return n({restart:j}),(i,_)=>(g(),h(e(se),{layout:"vertical"},{default:r(()=>[R("",!0),a(e(v),{label:"Testing URL"},{default:r(()=>[a(e(X),{gap:0,style:{overflow:"hidden"}},{default:r(()=>[m(" https:// "),a(e(F),{style:{"margin-right":"0"}},{default:r(()=>[m($(E.value.subdomain),1)]),_:1}),m(" .abstra.app/ "),a(e(F),{style:{"margin-right":"0","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis"}},{default:r(()=>[m($(E.value.path),1)]),_:1}),a(e(X),null,{default:r(()=>[m(" ? "),a(e(ae),{title:"Query params"},{content:r(()=>[Ie]),default:r(()=>[a(e(F),{style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer"},onClick:d},{default:r(()=>[m($(E.value.query||"[ ... ]"),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(v),null,{default:r(()=>[a(e(Se),{"active-key":o.value,"onUpdate:activeKey":_[1]||(_[1]=c=>o.value=c),ghost:""},{default:r(()=>[a(e(Pe),{key:"query-params",header:`Query Params (${l.queryParams.length})`},{default:r(()=>[(g(!0),G(me,null,ce(l.queryParams,(c,y)=>(g(),h(e(v),{key:y},{default:r(()=>[a(e(pe),null,{default:r(()=>[a(e(w),{value:c.name,"onUpdate:value":S=>c.name=S,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),a(e(w),{value:c.value,"onUpdate:value":S=>c.value=S,type:"text",placeholder:"value",disabled:c.name===C},null,8,["value","onUpdate:value","disabled"]),a(e(B),{danger:"",onClick:S=>f(y)},{default:r(()=>[m("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(e(v),null,{default:r(()=>[a(e(B),{type:"dashed",style:{width:"100%"},onClick:A},{default:r(()=>[m("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1},8,["active-key"])]),_:1})]),_:1}),a(e(Oe),{orientation:"left"},{default:r(()=>[m("Quick Preview")]),_:1}),e(O)||!e(k)?(g(),h(e(fe),{key:1})):l.stageRunId||u.form.isInitial?(g(),G("div",Me,[a(ie,{ref_key:"runner",ref:N,form:i.form.makeRunnerData(e(k)),params:{...l.queryParams.reduce((c,{name:y,value:S})=>({...c,[y]:S}),{})},"is-preview":"","enable-auto-focus":"",broker:p.value,onNavigate:M,onRedirect:U,onLogout:j},null,8,["form","params","broker"])])):(g(),h(e(Ae),{key:3,message:"This form is an intermediate task within the workflow. Please select a task instance to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}}),je=D({__name:"FormSettings",props:{form:{}},setup(s){const t=P(s.form);return(u,o)=>(g(),h(e(se),{layout:"vertical"},{default:r(()=>[a(he,{runtime:t.value},null,8,["runtime"]),a(e(v),{label:"Form name"},{default:r(()=>[a(e(w),{type:"text",onChange:o[0]||(o[0]=d=>{var l;return t.value.title=(l=d.target.value)!=null?l:""})})]),_:1}),a(e(T),{level:3},{default:r(()=>[m(" Texts ")]),_:1}),a(e(T),{level:4},{default:r(()=>[m(" Welcome Screen ")]),_:1}),a(e(v),{label:"Title"},{default:r(()=>[a(e(w),{value:t.value.welcomeTitle,"onUpdate:value":o[1]||(o[1]=d=>t.value.welcomeTitle=d),type:"text",placeholder:t.value.title,disabled:t.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),a(e(v),{label:"Description"},{default:r(()=>[a(e(w),{value:t.value.startMessage,"onUpdate:value":o[2]||(o[2]=d=>t.value.startMessage=d),type:"text",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(v),{label:"Start button label"},{default:r(()=>[a(e(w),{value:t.value.startButtonText,"onUpdate:value":o[3]||(o[3]=d=>t.value.startButtonText=d),type:"text",placeholder:"Start",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(v),null,{default:r(()=>[a(e(W),{checked:t.value.autoStart,"onUpdate:checked":o[4]||(o[4]=d=>t.value.autoStart=d)},{default:r(()=>[m("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),a(e(T),{level:4},{default:r(()=>[m(" End Screen ")]),_:1}),a(e(v),{label:"End text"},{default:r(()=>[a(e(w),{value:t.value.endMessage,"onUpdate:value":o[5]||(o[5]=d=>t.value.endMessage=d),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),a(e(v),{label:"Restart button label"},{default:r(()=>[a(e(w),{value:t.value.restartButtonText,"onUpdate:value":o[6]||(o[6]=d=>t.value.restartButtonText=d),placeholder:"Restart",type:"text",disabled:!t.value.allowRestart},null,8,["value","disabled"])]),_:1}),a(e(v),null,{default:r(()=>[a(e(W),{checked:t.value.allowRestart,"onUpdate:checked":o[7]||(o[7]=d=>t.value.allowRestart=d)},{default:r(()=>[m("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),a(e(T),{level:4},{default:r(()=>[m(" Alert Messages ")]),_:1}),a(e(v),{label:"Error message"},{default:r(()=>[a(e(w),{value:t.value.errorMessage,"onUpdate:value":o[8]||(o[8]=d=>t.value.errorMessage=d),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),kt=D({__name:"FormEditor",setup(s){const n=oe(),t=ge(),u=P(null),o=P("test");function d(){n.push({name:"forms"})}const{result:l,refetch:L}=ne(()=>Promise.all([le.get(),ke.get(t.params.id)]).then(([f,p])=>ye({workspace:f,form:p}))),k=we.create();function O(f,p){ee("editor",n,f,p)}const A=()=>{var f;n.push({name:"formPreview",query:t.query,params:{id:(f=l.value)==null?void 0:f.form.id}})};return re(()=>t.params.id,()=>{L()}),(f,p)=>(g(),h(_e,null,{navbar:r(()=>[e(l)?(g(),h(e(Le),{key:0,title:e(l).form.title,style:{padding:"5px 10px"},onBack:d},{footer:r(()=>[a(e(Re),{"active-key":o.value,"onUpdate:activeKey":p[0]||(p[0]=b=>o.value=b)},{default:r(()=>[a(e(J),{key:"test",tab:"Test"}),a(e(J),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:r(()=>[a(xe,{"docs-path":"forms/overview","show-v-s-code-button":"","show-save-button":o.value==="settings","editing-model":e(l).form},{default:r(()=>[a(qe,{path:e(l).form.path},null,8,["path"]),a(e(B),{target:"_blank",onClick:A},{icon:r(()=>[a(e(Ue))]),default:r(()=>[m(" Preview ")]),_:1})]),_:1},8,["show-save-button","editing-model"])]),_:1},8,["title"])):R("",!0)]),content:r(()=>[e(l)&&o.value==="test"?(g(),h(Ne,{key:0,ref_key:"tester",ref:u,form:e(l).form,"log-service":e(k),onRedirect:O},null,8,["form","log-service"])):R("",!0),e(l)&&o.value==="settings"?(g(),h(je,{key:1,form:e(l).form},null,8,["form"])):R("",!0)]),footer:r(()=>{var b;return[e(l)&&o.value==="test"?(g(),h(be,{key:0,runtime:"forms","log-service":e(k),onRestart:(b=u.value)==null?void 0:b.restart},null,8,["log-service","onRestart"])):R("",!0)]}),_:1}))}});export{kt as default};
//# sourceMappingURL=FormEditor.7deca865.js.map

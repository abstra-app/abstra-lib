import{f as r,eG as Z,eP as we,r as X,H as J,F as ke,d as j,b as c,ev as _,w as i,aD as T,eC as U,eD as A,u as t,v as q,c as d,ar as h,cM as xe,cE as x,ex as O,bg as je,eJ as pe,e as W,eI as Q,aH as de,cm as ge,eE as De,eF as Me,eQ as $e,bG as K,a as be,eA as Fe,J as Te,o as Ue,L as ze,ae as Ne,dk as qe,cD as Ve}from"./outputWidgets.7e6eb177.js";import{a as Se}from"./asyncComputed.5c83bb8a.js";import"./workspaces.79fe4cd5.js";import{S as Be}from"./scripts.93d75c8b.js";import"./envVars.1339ad37.js";import{A as Ke,s as ee}from"./api.94ff33eb.js";import{z as e}from"./index.cf4c23b9.js";import{A as P}from"./index.d8062c86.js";import{q as Je,r as We}from"./icons.42e022b7.js";import{t as Ge}from"./ant-design.3e571b9a.js";import{A as F}from"./Text.497ac05f.js";import"./index.94c2f885.js";import{A as G}from"./index.a964b97b.js";import{f as He}from"./index.514e5d47.js";import{A as le}from"./Paragraph.a13a9f0d.js";import{A as B}from"./Title.f948a676.js";import"./index.f08ffdbf.js";import{T as Qe,A as Ye}from"./Timeline.7f598b08.js";import{A as he,C as ye}from"./CollapsePanel.43cef110.js";import{A as Ze}from"./Link.eeb9f7f0.js";import{A as Xe}from"./index.57701e80.js";import{A as et}from"./index.bd8cf264.js";import{E as tt}from"./ExpandOutlined.e353b5c4.js";import{C as at}from"./Card.edac6aea.js";import{d as nt}from"./vuedraggable.umd.af699732.js";import"./index.e33176dd.js";import{F as ot,A as st}from"./Form.f6e73dd6.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[a]="a9538d0d-22c8-4e8f-9c72-1a37433af7a6",o._sentryDebugIdIdentifier="sentry-dbid-a9538d0d-22c8-4e8f-9c72-1a37433af7a6")}catch{}})();var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM641.7 520.8L442.3 677.6c-7.4 5.8-18.3.6-18.3-8.8V355.3c0-9.4 10.9-14.7 18.3-8.8l199.4 156.7a11.2 11.2 0 010 17.6z"}}]},name:"play-square",theme:"filled"};const rt=it;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const ct=lt;function ce(o){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},l=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),l.forEach(function(n){mt(o,n,s[n])})}return o}function mt(o,a,s){return a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,o}var te=function(a,s){var l=ce({},a,s.attrs);return r(Z,ce({},l,{icon:we}),null)};te.displayName="EyeInvisibleOutlined";te.inheritAttrs=!1;const ut=te;function me(o){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},l=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),l.forEach(function(n){pt(o,n,s[n])})}return o}function pt(o,a,s){return a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,o}var ae=function(a,s){var l=me({},a,s.attrs);return r(Z,me({},l,{icon:rt}),null)};ae.displayName="PlaySquareFilled";ae.inheritAttrs=!1;const dt=ae;function ue(o){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},l=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(s).filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable}))),l.forEach(function(n){gt(o,n,s[n])})}return o}function gt(o,a,s){return a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,o}var ne=function(a,s){var l=ue({},a,s.attrs);return r(Z,ue({},l,{icon:ct}),null)};ne.displayName="SyncOutlined";ne.inheritAttrs=!1;const bt=ne;function St(){const o=X({state:"closed"});function a(){o.value={state:"closed"}}function s(){o.value={state:"visualizations"}}function l(u,y){o.value={state:"stage-run",stageRun:y}}const n=J(()=>"stageRun"in o.value?o.value.stageRun:null);return{closeDrawer:a,openVisualizationEditor:s,inspectStageRun:l,drawerState:o,selectedStageRunForDrawer:n}}const $="kanban-selected-stage-ids",z=10,ht=({kanbanRepository:o,storage:a,filterFactory:s,router:l})=>{const n=ke([]),u=Se(async()=>{try{const p=await o.getData({selection:n.value,filter:s()}),g=await a.get($)||[];for(const b of p.not_found_stages)a.set($,g.filter(S=>S!==b)),n.value=n.value.filter(S=>S.stage_id!==b);return p}catch{return n.value=[],await a.set($,[]),{columns:[],next_stage_options:[]}}});function y(p){const g=p.selected_stage.id,b=n.value.find(S=>S.stage_id===g);return b!=null&&b.limit?b.limit<p.total_count:!1}async function m(p){var b;const g=n.value.find(S=>S.stage_id===p.selected_stage.id);g&&(g.limit=((b=g.limit)!=null?b:0)+z,await u.refetch())}async function C(p){const g=n.value.find(b=>b.stage_id===p);g&&g.limit&&g.limit>z&&(g.limit-=z,await u.refetch())}async function f(){const p=await a.get($)||[];n.value=p.map(g=>({stage_id:g,limit:z,offset:0}))}async function I(p,g){p?n.value=[...n.value.slice(0,g),{stage_id:p.id,limit:z,offset:0},...n.value.slice(g+1)]:n.value=[...n.value.slice(0,g),...n.value.slice(g+1)],await a.set($,n.value.map(b=>b.stage_id)),await u.refetch()}async function D(p){await I(p,n.value.length)}async function R(p){const g=n.value[p.moved.oldIndex];I(null,p.moved.oldIndex),n.value=[...n.value.slice(0,p.moved.newIndex),g,...n.value.slice(p.moved.newIndex)],await a.set($,n.value.map(b=>b.stage_id)),await u.refetch()}let v=null;return{kanbanAsyncComputed:u,selection:n,increasePagination:m,hasPagination:y,seeLess:C,setStage:I,addStage:D,cardActionHandler:async(p,g)=>{const b=p.selected_stage,S=g.id;if(b.type==="script"){const E=await Be.get(b.id);if(!E)return;await E.run(S)}if(b.type==="form"){const E=l.resolve({path:`/${b.path}`,query:S?{[Ke]:S}:{}});window.open(E.href,S)}},setup:async()=>{await f(),u.refetch(),v=setInterval(()=>{u.refetch()},1e3)},tearDown:()=>{v&&clearInterval(v)},reorderStages:R}},yt=e.boolean(),Ct=e.boolean(),ft=e.boolean(),At=e.boolean();e.object({PROJECT_LIVE:yt.optional(),ALLOW_RELEASE:Ct.optional(),CONNECTORS_CONSOLE:ft.optional(),DUPLICATE_PROJECTS:At.optional()});const _t=e.string(),Rt=e.string(),vt=e.string(),Lt=e.string(),Et=e.string();e.object({plan:_t.optional(),expires:Rt.optional(),message:vt.optional(),messageLink:Lt.optional(),messageCTA:Et.optional()});const Pt=e.string(),Ce=e.string(),oe=e.string(),Ot=e.string(),It=e.string(),wt=e.object({id:Pt,name:Ce,description:oe.optional(),projectId:Ot,createdAt:It}),kt=e.string(),xt=e.string(),jt=e.string(),Dt=e.string(),Mt=e.string().regex(new RegExp("^[0-9]+m$")),$t=e.string().regex(new RegExp("^[0-9]+m$")),Ft=e.string().regex(new RegExp("^[0-9]+Mi$")),Tt=e.string().regex(new RegExp("^[0-9]+Mi$")),Ut=e.string().regex(new RegExp("^[0-9]+$")),zt=e.string().regex(new RegExp("^[0-9]+$")),Nt=e.enum(["shared","clickbus","test"]),qt=e.object({requestsCPU:Mt.optional(),limitsCPU:$t.optional(),requestsMemory:Ft.optional(),limitsMemory:Tt.optional(),minReplicas:Ut.optional(),timeoutSeconds:zt.optional(),workerType:Nt.optional()});e.object({id:kt,name:xt,subdomain:jt,organizationId:Dt,deploymentResources:qt.optional()});const Vt=e.string(),Bt=e.string(),fe=e.array(Bt),Ae=e.string(),Kt=e.string();e.object({id:Vt,emailPatterns:fe,projectId:Ae,createdAt:Kt});const Jt=e.string().regex(new RegExp("^[0-9]+m$")),Wt=e.string().regex(new RegExp("^[0-9]+m$")),Gt=e.string().regex(new RegExp("^[0-9]+Mi$")),Ht=e.string().regex(new RegExp("^[0-9]+Mi$")),Qt=e.string().regex(new RegExp("^[0-9]+$")),Yt=e.string().regex(new RegExp("^[0-9]+$")),Zt=e.enum(["shared","clickbus","test"]);e.object({requestsCPU:Jt.optional(),limitsCPU:Wt.optional(),requestsMemory:Gt.optional(),limitsMemory:Ht.optional(),minReplicas:Qt.optional(),timeoutSeconds:Yt.optional(),workerType:Zt.optional()});const Xt=e.string(),H=e.string().email(),ea=e.string(),se=e.array(ea),ta=e.string(),aa=e.string(),na=e.object({id:Xt,email:H,roles:se,projectId:ta,createdAt:aa}),_e=e.string(),Re=e.string(),oa=e.boolean(),sa=e.boolean(),ia=e.boolean(),ra=e.boolean(),ve=e.object({PROJECT_LIVE:oa,ALLOW_RELEASE:sa,CONNECTORS_CONSOLE:ia,DUPLICATE_PROJECTS:ra}),la=e.string(),ca=e.string(),ma=e.string(),ua=e.string(),pa=e.string(),Le=e.object({plan:la.optional(),expires:ca.optional(),message:ma.optional(),messageLink:ua.optional(),messageCTA:pa.optional()}),da=e.string().regex(new RegExp("^[0-9]+m$")),ga=e.string().regex(new RegExp("^[0-9]+m$")),ba=e.string().regex(new RegExp("^[0-9]+Mi$")),Sa=e.string().regex(new RegExp("^[0-9]+Mi$")),ha=e.string().regex(new RegExp("^[0-9]+$")),ya=e.string().regex(new RegExp("^[0-9]+$")),Ca=e.enum(["shared","clickbus","test"]),fa=e.object({requestsCPU:da.optional(),limitsCPU:ga.optional(),requestsMemory:ba.optional(),limitsMemory:Sa.optional(),minReplicas:ha.optional(),timeoutSeconds:ya.optional(),workerType:Ca.optional()}),Aa=e.string(),_a=e.array(Aa),Ra=e.object({whitelistPatterns:_a.optional()});e.object({id:_e,name:Re,featureFlags:ve,billingMetadata:Le,deploymentResources:fa.optional(),membershipsMetadata:Ra.optional()});const va=e.string(),La=e.array(va);e.object({whitelistPatterns:La.optional()});const Ea=_e,Pa=Re,Oa=ve,Ia=Le;e.object({id:Ea,name:Pa,featureFlags:Oa,billingMetadata:Ia});const wa=oe;e.object({description:wa});const ka=e.number(),xa=e.number();e.object({offset:ka.optional(),limit:xa.optional()});const ja=wt;e.array(ja);const Da=Ce,Ma=oe;e.object({name:Da,description:Ma.optional()});const $a=H,Fa=se;e.object({email:$a.optional(),roles:Fa.optional()});const Ta=e.number(),Ua=e.number();e.object({offset:Ta.optional(),limit:Ua.optional()});const za=na;e.array(za);const Na=H,qa=se;e.object({email:Na,roles:qa});const Va=fe;e.object({emailPatterns:Va});const Ba=Ae;e.object({projectId:Ba});const Ka=e.boolean();e.object({shouldBeOnboarded:Ka.optional()});const Ja=e.string(),Wa=e.string(),Ga=e.string(),Ha=e.string();e.object({name:Ja.optional(),companyName:Wa.optional(),source:Ga.optional(),authorEmail:Ha.optional()});const Qa=e.string(),Ya=e.record(e.any()),Za=e.string(),Xa=e.object({key:Qa,value:Ya,type:Za}),en=Xa,tn=e.array(en),an=e.string(),nn=e.enum(["text","image","table","progress-bar"]),on=e.object({name:an,type:nn}),sn=e.string(),rn=e.string(),ln=e.record(e.any()),Ee=e.enum(["waiting","running","finished","failed","abandoned"]),cn=["waiting","running","finished","failed","abandoned"],mn=e.string(),un=e.string(),pn=e.string(),dn=e.string();e.object({id:sn,stage:rn,data:ln,status:Ee,created_at:mn,updated_at:un,parent_id:pn.optional(),execution_id:dn.optional()});const gn=e.string(),bn=e.string(),Sn=e.string(),hn=e.string(),yn=Ee,Cn=tn,fn=e.object({id:gn,created_at:bn,updated_at:Sn.optional(),assignee:hn.optional(),status:yn,content:Cn}),An=fn,_n=e.array(An),Rn=e.string(),vn=e.enum(["form","hook","job","script","iterator","condition"]),Ln=e.string(),En=e.string(),Pn=e.boolean(),Pe=e.object({id:Rn,type:vn,title:Ln,path:En.optional(),can_be_started:Pn}),On=Pe,In=_n,wn=Pe,Oe=e.array(wn),kn=Oe,xn=e.number(),jn=e.object({selected_stage:On,stage_run_cards:In,stages:kn,total_count:xn}),Dn=jn,Mn=e.array(Dn),$n=Mn,Fn=Oe,Tn=e.string(),Un=e.array(Tn);e.object({columns:$n,next_stage_options:Fn,not_found_stages:Un});const zn=on;e.array(zn);const Nn=e.string(),qn=e.string(),Vn=e.literal("bug"),Bn=e.string(),Kn=e.string(),Jn=e.string(),Wn=e.object({name:Kn,label:Jn}),Gn=Wn,Hn=e.array(Gn),Qn=e.object({label:Bn,fixes:Hn}),Yn=Qn,Zn=e.array(Yn),Xn=e.object({name:Nn,label:qn,type:Vn,issues:Zn}),eo=e.boolean();e.object({success:eo});const to=Xn;e.array(to);const ao=e.string(),no=e.string(),oo=e.object({key:ao,value:no}),so=oo;e.array(so);const io=H;e.object({email:io});function ie(o){switch(o.status){case"waiting":return{color:"blue",text:"Waiting"};case"running":return{color:"processing",text:"Running"};case"finished":return{color:"success",text:"Success"};case"failed":return{color:"error",text:"Failed"};case"abandoned":return{color:"warning",text:"Abandoned"}}}const N="Show All",ro=[N,...cn];function lo(){const o=X(N);return{filterStatus:o,filterFactory:()=>o.value==N?{}:{status:o.value},labelOption:l=>l==N?N:ie({status:l}).text}}const co={key:0},mo={key:1,class:"terminal"},uo=j({__name:"ExecutionInspector",props:{logs:{}},setup(o){return(a,s)=>a.logs.length===0?(c(),_("span",co)):(c(),_("div",mo,[r(t(P),{vertical:""},{default:i(()=>[(c(!0),_(T,null,U(a.logs,l=>(c(),_("pre",{key:l.executionId,class:"log-text"},A(l.payload.text),1))),128))]),_:1})]))}});const po=q(uo,[["__scopeId","data-v-4e71a195"]]),Y=j({__name:"StageRunData",props:{data:{}},setup(o){return(a,s)=>(c(),d(t(x),{direction:"vertical",style:{overflow:"hidden"}},{default:i(()=>[(c(!0),_(T,null,U(a.data,l=>(c(),_("div",{key:l.key},[r(t(F),{strong:""},{default:i(()=>[h(A(l.key),1)]),_:2},1024),r(t(xe),{"tree-data":t(Ge)(l.value),selectable:!1},null,8,["tree-data"])]))),128))]),_:1}))}}),go=o=>(De("data-v-68c9e478"),o=o(),Me(),o),bo={key:1},So={key:1},ho=go(()=>W("span",null,"[Deleted Stage]",-1)),yo=["onClick"],Co=j({__name:"StageRunInspector",props:{stageRun:{},kanbanRepository:{},stageRunRepository:{}},emits:["close"],setup(o,{emit:a}){const s=o;function l(m){return Object.entries(m).map(([C,f])=>({key:C,value:f,type:typeof f}))}const{result:n,loading:u}=Se(()=>{var m;return s.kanbanRepository.getLogs((m=s.stageRun)==null?void 0:m.id)}),y=(m,C)=>{var f;m.stopPropagation(),(f=s.stageRunRepository)==null||f.fork(C),a("close")};return(m,C)=>(c(),d(t(et),{open:"",title:"Thread details",size:"large",onClose:C[0]||(C[0]=f=>a("close"))},{extra:i(()=>[r(t(le),null,{default:i(()=>[r(t(G),{style:{"font-weight":"600"}},{default:i(()=>{var f;return[h(A(t(ie)({status:(f=m.stageRun)==null?void 0:f.status}).text),1)]}),_:1}),h(" "+A(t(He)(new Date(m.stageRun.created_at),{addSuffix:!0})),1)]),_:1})]),default:i(()=>{var f,I,D;return[(f=m.stageRun)!=null&&f.assignee?(c(),d(t(le),{key:0},{default:i(()=>{var R;return[h(" Assignee: "+A((R=m.stageRun)==null?void 0:R.assignee),1)]}),_:1})):O("",!0),((I=m.stageRun)==null?void 0:I.content)&&((D=m.stageRun)==null?void 0:D.content.length)>0?(c(),_("div",bo,[r(t(B),{level:4},{default:i(()=>[h("Current data")]),_:1}),r(Y,{data:m.stageRun.content},null,8,["data"])])):O("",!0),r(t(B),{level:4,style:{"margin-bottom":"30px"}},{default:i(()=>[h(" Timeline ")]),_:1}),t(u)?(c(),d(t(je),{key:2})):t(n)?(c(),d(t(Qe),{key:3},{default:i(()=>[(c(!0),_(T,null,U(t(n),({stage:R,stage_run:v,logs:w})=>(c(),d(t(Ye),{key:v.id},{default:i(()=>[r(t(ye),{ghost:"","expand-icon-position":"end"},{default:i(()=>[r(t(he),{class:"panel"},pe({header:i(()=>[R?(c(),d(t(P),{key:0,align:"center",gap:15},{default:i(()=>[r(Q,{path:t(ee)(R.type)},null,8,["path"]),w.length?(c(),_("span",So,A(R.title),1)):(c(),d(t(de),{key:0,placement:"right",title:"No logs"},{default:i(()=>[h(A(R.title),1)]),_:2},1024))]),_:2},1024)):(c(),d(t(P),{key:1,align:"center",gap:15},{default:i(()=>[r(Q,{path:t(We)},null,8,["path"]),ho]),_:1}))]),default:i(()=>[l(v.data).length||w.length?(c(),d(t(P),{key:0,vertical:""},{default:i(()=>[l(v.data).length?(c(),d(t(P),{key:0,gap:0,vertical:""},{default:i(()=>[r(t(B),{level:5},{default:i(()=>[h(" Output data ")]),_:1}),r(Y,{data:l(v.data)},null,8,["data"])]),_:2},1024)):O("",!0),w.length?(c(),d(t(P),{key:1,vertical:"",gap:0},{default:i(()=>[r(t(Xe)),r(t(B),{level:5},{default:i(()=>[h(" Logs ")]),_:1}),r(po,{logs:w},null,8,["logs"])]),_:2},1024)):O("",!0)]),_:2},1024)):(c(),d(t(ge),{key:1,description:"No logs"}))]),_:2},[m.stageRunRepository&&R?{name:"extra",fn:i(()=>[W("span",{onClick:V=>y(V,v.id)},[r(t(P),{gap:"small"},{default:i(()=>[r(Q,{path:t(Je),width:"22"},null,8,["path"]),r(t(Ze),null,{default:i(()=>[h("Fork")]),_:1})]),_:1})],8,yo)]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):O("",!0)]}),_:1}))}});const fo=q(Co,[["__scopeId","data-v-68c9e478"]]),Ao=j({__name:"Card",props:{stage:{},card:{}},emits:["inspect","action"],setup(o){const a=o,s=J(()=>ie({status:a.card.status}).text),l=J(()=>$e(new Date(String(a.card.updated_at))));return(n,u)=>{var y,m;return c(),d(t(at),{size:"small",style:{cursor:"pointer"},"head-style":{"border-bottom":((y=n.card.content)==null?void 0:y.length)>0?"":"none"},"body-style":{display:((m=n.card.content)==null?void 0:m.length)>0?"block":"none"}},pe({title:i(()=>[r(t(G),null,{default:i(()=>[h(A(s.value)+" ",1),s.value==="Running"?(c(),d(t(bt),{key:0,spin:!0,style:{"margin-left":"4px"}})):O("",!0)]),_:1})]),default:i(()=>[r(t(x),{direction:"vertical",style:{"max-height":"300px",width:"100%",overflow:"hidden"},onClick:u[0]||(u[0]=C=>n.$emit("inspect"))},{default:i(()=>[r(Y,{data:n.card.content,disabled:!0},null,8,["data"]),n.card.assignee?(c(),d(t(G),{key:0},{default:i(()=>[h(A(n.card.assignee),1)]),_:1})):O("",!0)]),_:1})]),extra:i(()=>[r(t(P),{gap:"10"},{default:i(()=>[r(t(de),null,{title:i(()=>[h(A(n.card.updated_at),1)]),default:i(()=>[r(t(F),{type:"secondary",style:{"font-size":"12px"}},{default:i(()=>[h(A(l.value),1)]),_:1})]),_:1}),r(t(tt),{onClick:u[2]||(u[2]=C=>n.$emit("inspect"))})]),_:1})]),_:2},[n.card.status==="waiting"?{name:"actions",fn:i(()=>[r(t(K),{onClick:u[1]||(u[1]=C=>n.$emit("action"))},{default:i(()=>[r(t(dt)),h(" Continue this thread ")]),_:1})]),key:"0"}:void 0]),1032,["head-style","body-style"])}}});class _o{constructor(a,s,l){this.router=a,this.column=s,this.kanbanRepository=l}get stage(){return this.column.selected_stage}get canStart(){return this.stage.can_be_started}get launchLink(){return!this.stage.can_be_started||this.stage.type!=="form"||!this.stage.path?null:this.router.resolve({path:`/${this.stage.path}`}).href}click(){if(this.launchLink)return window.open(this.launchLink,"_blank");if(this.stage.type==="job")return this.kanbanRepository.startJob(this.stage.id).catch(console.error)}}const Ro=j({__name:"Column",props:{router:{},hasPagination:{type:Boolean},column:{},kanbanRepository:{}},emits:["increasePagination","cardAction","stageUpdate","cardInspection"],setup(o,{emit:a}){const s=o,l=J(()=>new _o(s.router,s.column,s.kanbanRepository));return(n,u)=>{const y=be("icon");return c(),d(t(x),{direction:"vertical",class:"stage-column"},{default:i(()=>[r(t(x),{direction:"horizontal",style:{width:"100%","justify-content":"space-between"}},{default:i(()=>[r(t(P),{gap:"8",style:{"max-width":"200px"}},{default:i(()=>[r(y,{path:t(ee)(n.column.selected_stage.type),style:{"flex-shrink":"0",width:"24px"}},null,8,["path"]),r(t(F),{ellipsis:"",content:n.column.selected_stage.title},null,8,["content"])]),_:1}),r(t(x),null,{default:i(()=>[r(t(F),{type:"secondary",style:{"font-size":"small","margin-right":"2px"}},{default:i(()=>[h(A(n.column.total_count),1)]),_:1}),r(t(K),{type:"text",style:{padding:"4px"},onClick:u[0]||(u[0]=m=>a("stageUpdate",null))},{default:i(()=>[r(t(F),{type:"secondary",style:{"font-size":"small","margin-right":"2px"}},{default:i(()=>[r(t(ut))]),_:1})]),_:1})]),_:1})]),_:1}),r(t(x),{direction:"vertical",style:{width:"100%"}},{default:i(()=>[n.column.stage_run_cards.length===0?(c(),d(t(ge),{key:0})):O("",!0),(c(!0),_(T,null,U(n.column.stage_run_cards,m=>(c(),d(Ao,{key:m.id,stage:n.column.selected_stage,card:m,onInspect:C=>a("cardInspection",m),onAction:C=>a("cardAction",m)},null,8,["stage","card","onInspect","onAction"]))),128)),n.hasPagination?(c(),d(t(K),{key:1,style:{width:"100%"},onClick:u[1]||(u[1]=m=>a("increasePagination"))},{default:i(()=>[h("See more")]),_:1})):O("",!0),l.value.canStart?(c(),d(t(K),{key:2,style:{width:"100%"},onClick:u[2]||(u[2]=()=>l.value.click())},{default:i(()=>[h(" Start new thread ")]),_:1})):O("",!0)]),_:1})]),_:1})}}});const vo=q(Ro,[["__scopeId","data-v-0c439682"]]),Lo=j({__name:"EmptyColumn",props:{stages:{}},emits:["stageUpdate"],setup(o,{emit:a}){const s=l=>{a("stageUpdate",l)};return(l,n)=>{const u=be("icon");return c(),d(t(x),{direction:"vertical"},{default:i(()=>[(c(!0),_(T,null,U(l.stages,y=>(c(),d(t(G),{key:y.id,class:"tag",onClick:m=>s(y)},{default:i(()=>[r(t(P),{gap:"8",style:{"max-width":"200px","justify-content":"center","align-items":"center"}},{default:i(()=>[r(u,{path:t(ee)(y.type),style:{"flex-shrink":"0",width:"24px"}},null,8,["path"]),r(t(F),{ellipsis:"",content:y.title},null,8,["content"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})}}});const Eo=q(Lo,[["__scopeId","data-v-86a920d1"]]),Po={style:{"padding-top":"20px"}},Oo={class:"stages-container"},Io={class:"stages-content"},wo=j({__name:"Kanban",props:{storage:{},kanbanRepository:{},stageRunRepository:{}},setup(o){const a=o,s=Fe(),{closeDrawer:l,inspectStageRun:n,drawerState:u,selectedStageRunForDrawer:y}=St(),{filterFactory:m,filterStatus:C,labelOption:f}=lo(),{kanbanAsyncComputed:I,setStage:D,addStage:R,setup:v,tearDown:w,cardActionHandler:V,increasePagination:re,hasPagination:p,reorderStages:g}=ht({kanbanRepository:a.kanbanRepository,storage:a.storage,filterFactory:m,router:s}),b=X([]);return Te(()=>{var S;return(S=I.result.value)==null?void 0:S.columns},S=>{S!==void 0&&(b.value=S)}),Ue(v),ze(w),(S,E)=>(c(),_("div",Po,[r(t(P),{vertical:"",style:{height:"100%"}},{default:i(()=>[r(t(ye),{ghost:""},{default:i(()=>[r(t(he),{header:"Filters"},{default:i(()=>[r(t(ot),null,{default:i(()=>[r(t(st),{label:"Status"},{default:i(()=>[r(t(Ne),{value:t(C),"onUpdate:value":E[0]||(E[0]=k=>qe(C)?C.value=k:null),style:{width:"325px"}},{default:i(()=>[(c(!0),_(T,null,U(t(ro),k=>(c(),d(t(Ve),{key:k,value:k},{default:i(()=>[h(A(t(f)(k)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),W("div",Oo,[W("div",Io,[r(t(x),{align:"start"},{default:i(()=>{var k;return[r(t(nt),{modelValue:b.value,"onUpdate:modelValue":E[1]||(E[1]=L=>b.value=L),class:"draggable","item-key":L=>L.selected_stage.id,"ghost-class":"ghost",onStart:t(w),onEnd:t(v),onChange:t(g)},{item:i(({element:L,index:Ie})=>[(c(),d(t(vo),{key:L.selected_stage.id,column:L,router:t(s),"has-pagination":t(p)(L),"kanban-repository":a.kanbanRepository,class:"stages-content-column",onIncreasePagination:M=>t(re)(L),onCardInspection:M=>t(n)(L,M),onCardAction:M=>t(V)(L,M),onStageUpdate:M=>t(D)(M,Ie)},null,8,["column","router","has-pagination","kanban-repository","onIncreasePagination","onCardInspection","onCardAction","onStageUpdate"]))]),_:1},8,["modelValue","item-key","onStart","onEnd","onChange"]),r(t(Eo),{stages:((k=t(I).result.value)==null?void 0:k.next_stage_options)||[],onStageUpdate:E[2]||(E[2]=L=>t(R)(L))},null,8,["stages"])]}),_:1})])])]),_:1}),t(u).state==="stage-run"&&t(y)?(c(),d(t(fo),{key:0,"kanban-repository":a.kanbanRepository,"stage-run":t(y),"stage-run-repository":a.stageRunRepository,onClose:t(l)},null,8,["kanban-repository","stage-run","stage-run-repository","onClose"])):O("",!0)]))}});const os=q(wo,[["__scopeId","data-v-e9bc25a1"]]);class ss{constructor(a,s=localStorage){this.contextKey=a,this.storage=s}makeKey(a){return`${this.contextKey}:${a}`}async get(a){const s=this.storage.getItem(this.makeKey(a));return s?JSON.parse(s):null}async set(a,s){this.storage.setItem(this.makeKey(a),JSON.stringify(s))}}export{os as K,ss as L};
//# sourceMappingURL=repository.9deaa6ad.js.map

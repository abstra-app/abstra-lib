import{f as l,ee as U,d as $,c as N,U as V,R as J,ac as T,b as a,u as e,aY as O,o as p,cE as I,i as c,aI as P,cD as q,a as g,d6 as Y,g as b,t as S,df as C,el as G,dd as H,dj as R,d9 as Q,h as D,eq as W,S as X,d0 as Z,cM as K,ei as ee,A as te}from"./jwt-decode.esm.efe61f61.js";import{_ as ae}from"./AbstraButton.vue_vue_type_script_setup_true_lang.8c3bc72f.js";import{I as le}from"./PhCopy.vue.3474ac3b.js";import{T as ne,R as se}from"./tasksController.0674a5af.js";import{s as re}from"./metadata.e03dbb68.js";import{t as oe}from"./ant-design.586b2d0d.js";import{c as ie}from"./string.a304cb29.js";import{R as de}from"./dayjs.47c19d71.js";import{g as L,a as k}from"./router.9170c19d.js";import{a as pe,B as ue}from"./build.50a8c890.js";import{a as ce}from"./project.bf2082f1.js";import"./tables.049ae96e.js";import{a as fe}from"./asyncComputed.077fcf75.js";import"./contracts.generated.b0a20886.js";import"./record.e87c13bf.js";import"./linters.aa3de8a0.js";import"./polling.73aa9842.js";import"./PhUserList.vue.668320f1.js";import"./PhWebhooksLogo.vue.a5119cfe.js";import"./index.efe05f59.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[o]="fa10aeff-b1a5-42f8-ac06-1e8fef0991be",r._sentryDebugIdIdentifier="sentry-dbid-fa10aeff-b1a5-42f8-ac06-1e8fef0991be")}catch{}})();var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const me=ge;function B(r){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?Object(arguments[o]):{},m=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(m=m.concat(Object.getOwnPropertySymbols(n).filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable}))),m.forEach(function(f){_e(r,f,n[f])})}return r}function _e(r,o,n){return o in r?Object.defineProperty(r,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[o]=n,r}var j=function(o,n){var m=B({},o,n.attrs);return l(U,B({},m,{icon:me}),null)};j.displayName="SyncOutlined";j.inheritAttrs=!1;const ye=j,be={key:4,style:{"min-width":"100px"}},Se=$({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean}},setup(r,{expose:o}){const n=r,{setup:m,tearDown:f,state:s,getColumns:_,fetchTasks:v,clearAllTasks:h}=ne({api:n.api,poll:!0,stages:n.stages}),A=t=>t.dataIndex===void 0&&"children"in t&&Array.isArray(t.children)&&t.children.length===0,x=N(()=>n.stages?s.tasks.map(t=>{var d,y,u;const i=(d=n.stages)==null?void 0:d.find(w=>w.id===t.targetStageId);return i?{...t,targetStageTitle:i.stageTitle,targetStageType:i.stageType,completedAt:(u=t.completed)!=null&&u.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1}:{...t,targetStageTitle:null,targetStageType:null,completedAt:(y=t.completed)!=null&&y.at?new Date(t.completed.at).toLocaleString():c.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString(),deleted:!0}}):s.tasks.map(t=>{var i;return{...t,deleted:!1,completedAt:(i=t.completed)!=null&&i.at?new Date(t.completed.at).toLocaleString():c.translate("i18n_tasksview_not_completed"),createdAt:new Date(t.created.at).toLocaleString()}})),E=(t,i,d)=>{var w,z;const y=(w=t.current)!=null?w:1,u=(z=t.pageSize)!=null?z:10;s.pagination.currentIndex=y-1,s.pagination.pageSize=u,v()},F=(t,i)=>`/_editor/${t}/${i}`,M=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),K.success({content:c.translate("i18n_tasksview_copied_to_clipboard")})};return o({clearAllTasks:h}),V(()=>m()),J(()=>f()),(t,i)=>(p(),T(O,null,[l(e(q),{layout:"vertical"},{default:a(()=>[l(e(L),{gutter:10},{default:a(()=>[l(e(k),{span:10},{default:a(()=>[l(e(I),{label:e(c).translate("i18n_tasksview_stage_label")},{default:a(()=>[l(e(P),{value:e(s).filters.stage,"onUpdate:value":i[0]||(i[0]=d=>e(s).filters.stage=d),options:e(s).filterOptions.stages,placeholder:e(c).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(k),{span:6},{default:a(()=>[l(e(I),{label:e(c).translate("i18n_tasksview_status_label")},{default:a(()=>[l(e(P),{value:e(s).filters.status,"onUpdate:value":i[1]||(i[1]=d=>e(s).filters.status=d),options:e(s).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(c).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),l(e(k),{span:8},{default:a(()=>[l(e(I),{label:e(c).translate("i18n_tasksview_created_at_date_label")},{default:a(()=>[l(e(de),{value:e(s).filters.dateRange,"onUpdate:value":i[2]||(i[2]=d=>e(s).filters.dateRange=d),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),l(e(Z),{columns:e(_)(),"data-source":x.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(s).pagination.currentIndex+1,pageSize:e(s).pagination.pageSize,total:e(s).pagination.totalCount},onChange:E},{bodyCell:a(({column:d,text:y,record:u})=>[d.key==="payload"?(p(),g(e(Y),{key:0,"tree-data":e(oe)(u.payload),selectable:!1},null,8,["tree-data"])):d.key==="targetStageTitle"?(p(),T(O,{key:1},[u.deleted?(p(),g(e(C),{key:0},{default:a(()=>[b(S(e(c).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),g(e(R),{key:1,gap:"small",justify:"center"},{default:a(()=>[(p(),g(G(e(re)(u.targetStageType)),{size:"20"})),t.editor?(p(),g(e(H),{key:0,href:F(u.targetStageType,u.targetStageId)},{default:a(()=>[b(S(u.targetStageTitle),1)]),_:2},1032,["href"])):(p(),g(e(C),{key:1},{default:a(()=>[b(S(u.targetStageTitle),1)]),_:2},1024))]),_:2},1024))],64)):d.dataIndex==="status"?(p(),g(e(R),{key:2,gap:"small",justify:"center"},{default:a(()=>[l(e(Q),null,{default:a(()=>[b(S(e(ie)(String(y)))+" ",1),y==="started"?(p(),g(e(ye),{key:0,spin:!0,style:{"margin-left":"4px"}})):D("",!0)]),_:2},1024)]),_:2},1024)):d.dataIndex==="actions"?(p(),g(ae,{key:3,type:"text",size:"small",tooltip:e(c).translate("i18n_tasksview_copy_payload_tooltip"),onClick:W(w=>M(u.payload),["stop"])},{default:a(()=>[l(e(le))]),_:2},1032,["tooltip","onClick"])):A(d)?(p(),T("div",be)):D("",!0)]),footer:a(()=>[l(e(L),{justify:"end",gutter:10},{default:a(()=>[l(e(k),null,{default:a(()=>[l(e(X),{size:"small"})]),_:1}),l(e(k),null,{default:a(()=>[l(e(C),null,{default:a(()=>[b(S(e(c).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Fe=$({__name:"Tasks",setup(r){const n=ee().params.projectId,m=new se(n),{result:f}=fe(async()=>{const v=(await pe.list(n)).find(x=>x.latest);if(!v)return null;const[h,A]=await Promise.all([ue.get(v.id),ce.get(n)]);return{buildSpec:h,project:A}}),s=N(()=>!f.value||!f.value.buildSpec?null:f.value.buildSpec.runtimes.map(_=>({id:_.id,stageTitle:_.title,stageType:_.type})));return(_,v)=>(p(),T(O,null,[l(e(te),null,{default:a(()=>[b(S(e(c).translate("i18n_tasksview_title")),1)]),_:1}),s.value?(p(),g(Se,{key:0,class:"tasks",api:e(m),stages:s.value},null,8,["api","stages"])):D("",!0)],64))}});export{Fe as default};
//# sourceMappingURL=Tasks.d4703081.js.map

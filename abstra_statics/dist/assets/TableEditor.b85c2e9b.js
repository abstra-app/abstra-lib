import{B as Me}from"./BaseLayout.1e49bd2f.js";import{a as me}from"./asyncComputed.a50f21d4.js";import{G as Re}from"./PhPencil.vue.75024b51.js";import{d as ae,a0 as ue,D as E,b as s,ey as q,dq as Fe,eA as S,eD as Ve,e as $,f as l,eK as Ie,fd as Ke,eG as ie,r as N,O as ve,B as ee,c as h,w as a,u as e,bI as F,au as U,cG as ye,bB as H,bj as Oe,o as Ge,ah as Je,E as $e,eM as xe,N as He,a as Le,eY as Qe,eJ as Y,bG as We,bk as Ye,bi as De,aG as pe,cB as Xe,aK as et,cI as tt,eH as Ne,eN as at,bC as lt,x as nt}from"./outputWidgets.7323a17d.js";import"./router.7bb92c0e.js";import{p as Ee,T as W,d as rt}from"./tables.380f1031.js";import{P as ge}from"./project.dfdecc43.js";import"./index.c9f11f2b.js";import{O as ut}from"./organization.7a4ab869.js";import{C as ot}from"./ContentLayout.143d2119.js";import{p as oe}from"./popupNotifcation.4e57751c.js";import{a as st}from"./ant-design.aba87fd3.js";import{H as Ue}from"./PhCheckCircle.vue.33fdfcd3.js";import{A as ze}from"./index.55ba4390.js";import{A as j,F as be}from"./Form.4d35a934.js";import{A as te}from"./index.0e2fdb3c.js";import{A as he}from"./index.a39c007e.js";import{G as it}from"./PhCaretRight.vue.f102f632.js";import{E as dt}from"./Base.003f7172.js";import{L as ct}from"./LoadingOutlined.a0fd65bc.js";import{A as se}from"./index.42443749.js";import{D as ft}from"./DeleteOutlined.3e9ad32b.js";import{A as pt}from"./index.aff86221.js";import{B as mt,A as vt,b as yt}from"./index.252f049c.js";import"./record.1f033572.js";import"./pubsub.2c3883f4.js";import"./string.3bdd59f2.js";import"./index.e70ae279.js";import"./Modal.8e6a9189.js";import"./index.120df1e3.js";import"./hasIn.adc00278.js";import"./isNumeric.75337b1e.js";import"./DeleteOutlined.f8ba9770.js";import"./index.4920b0cf.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[o]="8fdc1815-8c0e-49d0-86dd-57b60714405b",m._sentryDebugIdIdentifier="sentry-dbid-8fdc1815-8c0e-49d0-86dd-57b60714405b")}catch{}})();const gt=["width","height","fill","transform"],bt={key:0},ht=$("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},null,-1),kt=[ht],Ct={key:1},_t=$("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),wt=$("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"},null,-1),Dt=[_t,wt],At={key:2},St=$("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm-8,56a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm8,104a12,12,0,1,1,12-12A12,12,0,0,1,128,184Z"},null,-1),It=[St],Ot={key:3},$t=$("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Zm-6-82V80a6,6,0,0,1,12,0v56a6,6,0,0,1-12,0Zm16,36a10,10,0,1,1-10-10A10,10,0,0,1,138,172Z"},null,-1),xt=[$t],Lt={key:4},Nt=$("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"},null,-1),Et=[Nt],Ut={key:5},zt=$("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Zm-4-84V80a4,4,0,0,1,8,0v56a4,4,0,0,1-8,0Zm12,36a8,8,0,1,1-8-8A8,8,0,0,1,136,172Z"},null,-1),jt=[zt],qt={name:"PhWarningCircle"},je=ae({...qt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(m){const o=m,t=ue("weight","regular"),k=ue("size","1em"),y=ue("color","currentColor"),z=ue("mirrored",!1),A=E(()=>{var _;return(_=o.weight)!=null?_:t}),C=E(()=>{var _;return(_=o.size)!=null?_:k}),d=E(()=>{var _;return(_=o.color)!=null?_:y}),P=E(()=>o.mirrored!==void 0?o.mirrored?"scale(-1, 1)":void 0:z?"scale(-1, 1)":void 0);return(_,T)=>(s(),q("svg",Ve({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:C.value,height:C.value,fill:d.value,transform:P.value},_.$attrs),[Fe(_.$slots,"default"),A.value==="bold"?(s(),q("g",bt,kt)):A.value==="duotone"?(s(),q("g",Ct,Dt)):A.value==="fill"?(s(),q("g",At,It)):A.value==="light"?(s(),q("g",Ot,xt)):A.value==="regular"?(s(),q("g",Lt,Et)):A.value==="thin"?(s(),q("g",Ut,jt)):S("",!0)],16,gt))}});function Ae(m){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?Object(arguments[o]):{},k=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(k=k.concat(Object.getOwnPropertySymbols(t).filter(function(y){return Object.getOwnPropertyDescriptor(t,y).enumerable}))),k.forEach(function(y){Tt(m,y,t[y])})}return m}function Tt(m,o,t){return o in m?Object.defineProperty(m,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):m[o]=t,m}var ke=function(o,t){var k=Ae({},o,t.attrs);return l(Ie,Ae({},k,{icon:Ke}),null)};ke.displayName="DownOutlined";ke.inheritAttrs=!1;const Bt=ke;function Se(m){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?Object(arguments[o]):{},k=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(k=k.concat(Object.getOwnPropertySymbols(t).filter(function(y){return Object.getOwnPropertyDescriptor(t,y).enumerable}))),k.forEach(function(y){Zt(m,y,t[y])})}return m}function Zt(m,o,t){return o in m?Object.defineProperty(m,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):m[o]=t,m}var Ce=function(o,t){var k=Se({},o,t.attrs);return l(Ie,Se({},k,{icon:dt}),null)};Ce.displayName="EditOutlined";Ce.inheritAttrs=!1;const Pt=Ce,qe=(m,o)=>o.includes(m)?{status:"error",help:"There already is a column with this name in the table"}:{status:""},Mt=ae({__name:"NewColumn",props:{open:{type:Boolean},table:{}},emits:["created","cancel"],setup(m,{emit:o}){const t=m,y=ie().params.projectId,z=E(()=>{var v;return((v=t.table)==null?void 0:v.getColumns().map(f=>f.name))||[]}),A=E(()=>qe(d.value.name,z.value)),C={name:"",type:"varchar",default:"",nullable:!0,unique:!1},d=N(C),P=()=>{d.value={...C}},_=N([{value:"reference",label:"reference",isLeaf:!1},...Ee.map(v=>({value:v,label:v,isLeaf:!0}))]),T=v=>{if(!v)return;const f=v[v.length-1];switch(v.length){case 0:return;case 1:f.loading=!0,W.list(y).then(w=>{f.children=w.map(Z=>({value:Z.id,label:Z.name,isLeaf:!1})),f.loading=!1});return;case 2:f.loading=!0,W.get(y,f.value).then(w=>{f.children=w.getColumns().map(Z=>({type:Z.type,value:Z.id,label:Z.name,isLeaf:!0})),f.loading=!1});return}},b=(v,f)=>{if(!!v){if(v.length===1){d.value.type=v[0],d.value.foreignKey=void 0;return}if(v.length===3){const w=f[f.length-1];d.value.type=w.type,d.value.foreignKey={columnId:w.value}}}},I=v=>{const f=v.selectedOptions;return f?f.length===1?f[0].label:f.length===3?`reference to ${f[1].label}(${f[2].label})`:"":"Select type"},g=N({...{status:"success",message:"",fakeLoading:!1}}),V=()=>{g.value.fakeLoading=!0,X()};ve(()=>d.value.type,()=>{d.value.default=rt[d.value.type]||"",V()});const X=ee.exports.debounce(async()=>{if(!d.value.default){g.value.status="success",g.value.message="",g.value.fakeLoading=!1;return}const v=`select (${d.value.default})::${d.value.type} `;ge.executeQuery(y,v,[]).then(f=>{g.value.status=f.errors.length>0?"error":"success",g.value.message=f.errors[0]||"",g.value.fakeLoading=!1})},500);function G(){o("cancel")}async function x(){if(!!t.table&&!(!d.value.name||!d.value.type))try{await t.table.addColumn(d.value),P(),o("created")}catch(v){v instanceof Error&&oe("Database error",v.message)}}return(v,f)=>(s(),h(e(he),{title:"New column",width:720,open:t.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:G},{extra:a(()=>[l(e(ye),null,{default:a(()=>[l(e(F),{onClick:G},{default:a(()=>[U("Cancel")]),_:1}),l(e(F),{type:"primary",onClick:x},{default:a(()=>[U("Submit")]),_:1})]),_:1})]),default:a(()=>[l(e(be),{model:d.value,layout:"vertical"},{default:a(()=>[l(e(j),{key:"name",label:"Name",required:"","validate-status":A.value.status,help:A.value.help},{default:a(()=>[l(e(H),{value:d.value.name,"onUpdate:value":f[0]||(f[0]=w=>d.value.name=w)},null,8,["value"])]),_:1},8,["validate-status","help"]),l(e(j),{key:"type",label:"Type",required:""},{default:a(()=>[l(e(ze),{options:_.value,"load-data":T,"display-render":I,"allow-clear":!1,onChange:b},null,8,["options"])]),_:1}),l(e(j),{key:"default-value",label:"Default value","validate-status":g.value.status,help:g.value.message},{default:a(()=>[l(e(H),{value:d.value.default,"onUpdate:value":f[1]||(f[1]=w=>d.value.default=w),onInput:V},{suffix:a(()=>[g.value.fakeLoading?(s(),h(e(Oe),{key:0})):S("",!0),!g.value.fakeLoading&&g.value.status==="success"?(s(),h(e(Ue),{key:1,size:"18"})):S("",!0),!g.value.fakeLoading&&g.value.status==="error"?(s(),h(e(je),{key:2,size:"18"})):S("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),l(e(j),{key:"nullable",label:"Nullable"},{default:a(()=>[l(e(te),{checked:d.value.nullable,"onUpdate:checked":f[2]||(f[2]=w=>d.value.nullable=w)},null,8,["checked"])]),_:1}),l(e(j),{key:"unique",label:"Unique"},{default:a(()=>[l(e(te),{checked:d.value.unique,"onUpdate:checked":f[3]||(f[3]=w=>d.value.unique=w)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]))}}),Rt={class:"twin-container"},Ft={class:"fullwidth-input"},Vt={class:"fullwidth-input"},Kt={class:"using-container"},Gt={class:"fullwidth-input"},Jt=ae({__name:"UpdateColumn",props:{open:{type:Boolean},table:{},column:{}},emits:["updated","cancel"],setup(m,{emit:o}){const t=m,y=ie().params.projectId,z=N(t.column.record.initialState.type);Ge(async()=>{if(!t.column.foreignKey)return;z.value="loading...";const n=await W.fromColumnId(y,t.column.foreignKey.columnId),r=n.getColumn(t.column.foreignKey.columnId);z.value=`reference to ${n.name}(${r.name})`});const A=E(()=>{var n;return((n=t.table)==null?void 0:n.getColumns().map(r=>r.record.initialState.name))||[]}),C=E(()=>t.column.name===t.column.record.initialState.name?{status:"",help:""}:qe(t.column.name,A.value)),{result:d,loading:P}=me(async()=>t.table.select({},10,0).then(({total:n})=>n));function _(){t.column.record.resetChanges(),o("cancel")}const b=N({status:"success",message:"",fakeLoading:!1}),I=()=>{b.value.fakeLoading=!0,B()},B=ee.exports.debounce(async()=>{if(!t.column.default){b.value.status="success",b.value.message="",b.value.fakeLoading=!1;return}const n=`select (${t.column.default})::${t.column.type} `,r=await ge.executeQuery(y,n,[]);b.value.status=r.errors.length>0?"error":"success",b.value.message=r.errors[0]||"",b.value.fakeLoading=!1},500),g=N([{value:"reference",label:"reference",isLeaf:!1},...Ee.map(n=>({value:n,label:n,isLeaf:!0}))]),V=n=>{if(!n)return;const r=n[n.length-1];switch(n.length){case 0:return;case 1:r.loading=!0,W.list(y).then(i=>{r.children=i.map(M=>({value:M.id,label:M.name,isLeaf:!1})),r.loading=!1});return;case 2:r.loading=!0,W.get(y,r.value).then(i=>{r.children=i.getColumns().map(M=>({type:M.type,value:M.id,label:M.name,isLeaf:!0})),r.loading=!1});return}},le=n=>{const r=n.selectedOptions;return r?r.length===1?r[0].label:r.length===3?`reference to ${r[1].label}(${r[2].label})`:"":"Select type"},X=(n,r)=>{if(!!n){if(n.length===1){t.column.type=n[0],t.column.foreignKey=null;return}if(n.length===3){if(t.column.foreignKey&&t.column.foreignKey.columnId===n[2])return;const i=r[r.length-1];t.column.type=i.type,t.column.foreignKey={columnId:i.value}}}},G=()=>d.value===0||P.value?!1:t.column.record.hasChangesDeep("type"),x=N({type:"default"}),v=()=>{t.column.type=t.column.record.initialState.type,x.value={type:"default"}};function f(n,r){return r==="varchar"||n==="int"&&r==="boolean"||n==="boolean"&&r==="int"}ve(()=>t.column.type,()=>{I(),Z.value||(x.value={type:"user-defined",using:Q.value,mandatory:!0})});const Z=E(()=>x.value.type==="default"&&f(t.column.record.initialState.type,t.column.type)),ne=E(()=>!f(t.column.record.initialState.type,t.column.type));function re(n){n?x.value={type:"default"}:x.value={type:"user-defined",using:Q.value,mandatory:!1}}function de(n){if(x.value.type==="default")throw new Error("Can't change using when using default casting");x.value.using=n!=null?n:""}const J=()=>ne.value?!0:G()&&x.value.type==="user-defined",Q=E(()=>`${t.column.record.initialState.name}::${t.column.type}`);async function ce(){if(!t.column)return;let n=x.value.type==="default"?Q.value:x.value.using;d.value===0&&(n=`${t.column.name}::text::${t.column.type}`);try{await t.column.update(n),o("updated")}catch(r){r instanceof Error&&oe("Database error",r.message)}}return(n,r)=>(s(),h(e(he),{title:"Edit column",width:720,open:n.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:_},{extra:a(()=>[l(e(ye),null,{default:a(()=>[l(e(F),{onClick:_},{default:a(()=>[U("Cancel")]),_:1}),l(e(F),{type:"primary",onClick:ce},{default:a(()=>[U("Submit")]),_:1})]),_:1})]),default:a(()=>[l(e(be),{model:n.column,layout:"vertical"},{default:a(()=>[l(e(j),{key:"name",label:"Name","validate-status":C.value.status,help:C.value.help},{default:a(()=>[l(e(H),{value:n.column.name,"onUpdate:value":r[0]||(r[0]=i=>n.column.name=i)},null,8,["value"])]),_:1},8,["validate-status","help"]),$("div",Rt,[$("span",Ft,[l(e(j),{key:"type",label:"Current Type"},{default:a(()=>[l(e(Je),{value:z.value,"onUpdate:value":r[1]||(r[1]=i=>z.value=i),"default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),l(e(it),{class:"right-arrow"}),$("span",Vt,[l(e(j),{key:"new-type",label:"New Type"},{default:a(()=>[l(e(ze),{options:g.value,"load-data":V,"display-render":le,"allow-clear":!0,onClear:v,onChange:X},null,8,["options"])]),_:1})])]),l(e(j),{key:"default-value",label:"Default value","validate-status":b.value.status,help:b.value.message},{default:a(()=>[l(e(H),{value:n.column.default,"onUpdate:value":r[2]||(r[2]=i=>n.column.default=i),onInput:I},{suffix:a(()=>[b.value.fakeLoading?(s(),h(e(Oe),{key:0,size:"small"})):S("",!0),!b.value.fakeLoading&&b.value.status==="success"?(s(),h(e(Ue),{key:1,size:18})):S("",!0),!b.value.fakeLoading&&b.value.status==="error"?(s(),h(e(je),{key:2,size:18})):S("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),$("div",Kt,[G()?(s(),h(e(j),{key:"default-casting",label:"Use default casting"},{default:a(()=>[l(e(te),{checked:Z.value,disabled:ne.value,"onUpdate:checked":r[3]||(r[3]=i=>re(!!i))},null,8,["checked","disabled"])]),_:1})):S("",!0),$("span",Gt,[G()?(s(),h(e(j),{key:"using",label:"Using"},{default:a(()=>[l(e(H),{value:x.value.type==="user-defined"?x.value.using:Q.value,disabled:!J(),onInput:r[4]||(r[4]=i=>de(i.target.value))},null,8,["value","disabled"])]),_:1})):S("",!0)])]),l(e(j),{key:"nullable",label:"Nullable"},{default:a(()=>[l(e(te),{checked:n.column.nullable,"onUpdate:checked":r[5]||(r[5]=i=>n.column.nullable=i)},null,8,["checked"])]),_:1}),l(e(j),{key:"unique",label:"Unique"},{default:a(()=>[l(e(te),{checked:n.column.unique,"onUpdate:checked":r[6]||(r[6]=i=>n.column.unique=i)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]))}});const Ht=$e(Jt,[["__scopeId","data-v-795220e4"]]),Qt={style:{overflow:"hidden","white-space":"wrap"}},Wt={key:1},Yt={key:1},Xt={key:1},ea=["onClick"],ta=$("a",null,"Delete",-1),aa=ae({__name:"TableData",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(m,{emit:o}){var _e;const t=m,k=N(1),y=N(10),z=E(()=>{var u,p;return{total:(p=(u=v.value)==null?void 0:u.total)!=null?p:0,current:k.value,pageSize:y.value,totalBoundaryShowSizeChanger:10,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],onChange:async(D,c)=>{k.value=D,y.value=c,await w()}}}),A=ie(),C=xe(),d=N(typeof A.query.q=="string"?A.query.q:""),P=E(()=>{try{return JSON.parse(A.query.where)}catch{return{}}});ve(d,()=>{C.replace({query:{...A.query,where:JSON.stringify(A.query.value),q:d.value}})});const _=N(!1),T=N({type:"idle"}),b=()=>{_.value=!0,I()},I=ee.exports.debounce(()=>{w(),_.value=!1},500);function B(){T.value={type:"idle"}}async function g(){B(),o("refresh"),await w(),Q()}function V(){T.value={type:"creating"}}const le=u=>{if(!t.table)throw new Error("Table not found");T.value={type:"editing",column:t.table.getColumn(u)}};async function X(u){await st("Are you sure you want to delete this column?")&&await G(u)}async function G(u){var p,D;await((D=(p=t.table)==null?void 0:p.getColumn(u))==null?void 0:D.delete()),o("refresh"),await w(),Q()}const x=E(()=>{var u;return((u=v.value)==null?void 0:u.rows.length)===1}),{result:v,loading:f,refetch:w}=me(()=>Promise.all([t.table.select(P.value,(k.value-1)*y.value,y.value,d.value),Promise.all(t.table.getColumns().filter(u=>u.foreignKey).map(u=>W.fromColumnId(A.params.projectId,u.foreignKey.columnId).then(p=>[u.name,p])))]).then(([{rows:u,total:p},D])=>({rows:u,total:p,columns:D.reduce((c,[L,R])=>({...c,[L]:R}),{})}))),Z=(u,p)=>{var R,O;const D=(R=t.table)==null?void 0:R.getColumns().find(K=>K.name===u);if(!D)return"";const c=(O=v.value)==null?void 0:O.columns[D.name],L=c==null?void 0:c.getColumns().find(K=>{var we;return K.id===((we=D.foreignKey)==null?void 0:we.columnId)});return!c||!L?"":{name:"tableEditor",params:{projectId:A.params.projectId,tableId:c.id},query:{where:JSON.stringify({[L.name]:p})}}},ne=(u,p)=>D=>{if(u==="json"&&D==""){i.value[p]="null";return}i.value[p]=D},re=()=>[...t.table.getColumns().map(u=>{var p;return{key:(p=u.id)!=null?p:"",title:u.name,dataIndex:u.name,width:220,resizable:!0,ellipsis:!1}}),{key:"action",title:"",fixed:"right",width:100,align:"center",resizable:!1,ellipsis:!1}],de=re(),J=N(de),Q=()=>J.value=re();function ce(u,p){J.value=J.value.map(D=>D.key===p.key?{...D,width:u}:D)}const n=E(()=>{var u;return((u=v.value)==null?void 0:u.rows.map(p=>({key:p.id,...p})))||[]}),r=N(!1),i=N({}),M=()=>{r.value=!0},fe=()=>{i.value={},r.value=!1};let Te=He((_e=t.table)==null?void 0:_e.getUnprotectedColumns().reduce((u,p)=>({...u,[p.name]:""}),{}));async function Be(){if(!(!t.table||!Te))try{i.value.id?await t.table.updateRow(i.value.id,i.value):await t.table.insertRow(i.value),i.value={},w(),fe()}catch(u){u instanceof Error&&oe("Database error",u.message)}}const Ze=async u=>{if(!(!v.value||!v.value.rows.find(p=>p.id===u)))try{await t.table.deleteRow(u),x.value&&(k.value=Math.max(1,k.value-1)),w()}catch(p){p instanceof Error&&oe("Database error",p.message)}},Pe=u=>{var R;const p=(R=n.value)==null?void 0:R.filter(O=>u===O.key)[0],D=t.table.getColumns(),c=D.map(O=>O.name),L=D.filter(O=>O.type==="json").map(O=>O.name);i.value=ee.exports.pick(ee.exports.cloneDeep(p),c),L.forEach(O=>{i.value[O]&&(i.value[O]=JSON.stringify(i.value[O]))}),M()};return(u,p)=>{const D=Le("router-link");return s(),h(ot,{"full-width":""},{default:a(()=>[l(e(se),{justify:"space-between",style:{"margin-bottom":"16px"},gap:"middle"},{default:a(()=>[l(e(H),{value:d.value,"onUpdate:value":[p[0]||(p[0]=c=>d.value=c),b],placeholder:"Search",style:{width:"400px"},"allow-clear":""},{prefix:a(()=>[l(e(Qe))]),suffix:a(()=>[_.value?(s(),h(e(ct),{key:0})):S("",!0)]),_:1},8,["value"]),l(e(F),{type:"primary",onClick:V},{default:a(()=>[U("+ Add new column")]),_:1})]),_:1}),l(e(tt),{columns:J.value,"data-source":n.value,pagination:z.value,bordered:"",loading:e(f)||u.loading,scroll:{x:1e3,y:720},size:"small",onResizeColumn:ce},{headerCell:a(({column:c})=>[c.title!=="id"&&c.title!=="created_at"&&c.key!=="action"?(s(),h(e(se),{key:0,align:"center",justify:"space-between",gap:"small"},{default:a(()=>[$("span",Qt,Y(c.title),1),l(e(We),{placement:"bottomRight",trigger:"click"},{overlay:a(()=>[l(e(Ye),null,{default:a(()=>[l(e(De),{onClick:L=>le(String(c.key))},{icon:a(()=>[l(e(Pt))]),default:a(()=>[U(" Edit ")]),_:2},1032,["onClick"]),l(e(De),{danger:"",onClick:L=>X(String(c.key))},{icon:a(()=>[l(e(ft))]),default:a(()=>[U(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[l(e(Bt))]),_:2},1024)]),_:2},1024)):(s(),q("span",Wt,Y(c.title),1))]),bodyCell:a(({column:c,text:L,record:R})=>{var O;return[J.value.map(K=>K.title).includes(c.dataIndex)?(s(),q(pe,{key:0},[(O=u.table.getColumns().find(K=>K.name===c.dataIndex))!=null&&O.foreignKey?(s(),h(D,{key:0,to:Z(c.dataIndex,L),target:"_blank"},{default:a(()=>[U(Y(L),1)]),_:2},1032,["to"])):(s(),q("span",Yt,Y(L),1))],64)):S("",!0),c.key==="action"?(s(),q("div",Xt,[$("span",null,[$("a",{onClick:K=>Pe(R.id)},"Edit",8,ea)]),l(e(pt),{type:"vertical"}),l(e(Xe),{title:"Sure to delete?",onConfirm:K=>Ze(R.id)},{default:a(()=>[ta]),_:2},1032,["onConfirm"])])):S("",!0)]}),footer:a(()=>[J.value.length===3?(s(),h(e(et),{key:0,title:"Add a first column prior to data entry",placement:"right"},{default:a(()=>[l(e(F),{type:"primary",disabled:!0,onClick:M},{default:a(()=>[U(" + Add New Data ")]),_:1})]),_:1})):(s(),h(e(F),{key:1,type:"primary",onClick:M},{default:a(()=>[U("+ Add New Data")]),_:1}))]),_:1},8,["columns","data-source","pagination","loading"]),l(e(he),{title:"Data",width:720,open:r.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:fe},{extra:a(()=>[l(e(ye),null,{default:a(()=>[l(e(F),{onClick:fe},{default:a(()=>[U("Cancel")]),_:1}),l(e(F),{type:"primary",onClick:Be},{default:a(()=>[U("Submit")]),_:1})]),_:1})]),default:a(()=>[l(e(be),{model:i.value,layout:"vertical"},{default:a(()=>[(s(!0),q(pe,null,Ne(u.table.getUnprotectedColumns(),c=>(s(),h(e(j),{key:c.id,label:c.name,required:!c.nullable},{default:a(()=>[i.value?(s(),h(e(H),{key:0,placeholder:c.type,value:i.value[c.name],disabled:i.value[c.name]===null,"onUpdate:value":L=>ne(c.type,c.name)(L)},at({_:2},[c.nullable?{name:"addonAfter",fn:a(()=>[l(e(lt),{checked:i.value[c.name]===null,"onUpdate:checked":L=>i.value[c.name]=L?null:""},{default:a(()=>[U(" NULL ")]),_:2},1032,["checked","onUpdate:checked"])]),key:"0"}:void 0]),1032,["placeholder","value","disabled","onUpdate:value"])):S("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])]),_:1},8,["open"]),u.table&&T.value.type==="creating"?(s(),h(Mt,{key:0,open:"",table:t.table,onClose:B,onCancel:B,onCreated:g},null,8,["table"])):S("",!0),u.table&&T.value.type==="editing"?(s(),h(Ht,{key:1,column:T.value.column,open:"",table:u.table,onUpdated:g,onClose:B,onCancel:B},null,8,["column","table"])):S("",!0)]),_:1})}}});const la={style:{"font-size":"20px"}},na=ae({__name:"TableEditor",setup(m){const o=xe(),t=ie(),k=t.params.tableId,y=t.params.projectId,z=N(!1),A=()=>{var b;z.value=!1,(b=C.value)==null||b.table.save(),P()},{result:C,loading:d,refetch:P}=me(()=>Promise.all([ge.get(y).then(async b=>{const I=await ut.get(b.organizationId);return{project:b,organization:I}}),W.get(y,k)]).then(([{project:b,organization:I},B])=>nt({project:b,organization:I,table:B}))),_=E(()=>!d.value&&C.value?[{label:"My organizations",path:"/organizations"},{label:C.value.organization.name,path:`/organizations/${C.value.organization.id}`},{label:C.value.project.name,path:`/projects/${C.value.project.id}/tables`}]:void 0);function T(){o.push({name:"tables",params:{projectId:y}})}return(b,I)=>{const B=Le("router-link");return s(),h(Me,null,{navbar:a(()=>[l(e(yt),{style:{padding:"5px 25px"},onBack:T},{title:a(()=>[z.value?(s(),h(e(se),{key:1,align:"center",gap:"large"},{default:a(()=>[e(C)?(s(),h(e(H),{key:0,value:e(C).table.name,"onUpdate:value":I[1]||(I[1]=g=>e(C).table.name=g),class:"borderless-input"},null,8,["value"])):S("",!0),l(e(F),{onClick:A},{default:a(()=>[U("Save")]),_:1})]),_:1})):(s(),h(e(se),{key:0,align:"center",gap:"small"},{default:a(()=>{var g;return[$("span",la,Y((g=e(C))==null?void 0:g.table.name),1),l(e(Re),{size:"22",style:{cursor:"pointer"},onClick:I[0]||(I[0]=V=>z.value=!0)})]}),_:1}))]),subTitle:a(()=>[_.value?(s(),h(e(mt),{key:0,style:{margin:"0px 20px"}},{default:a(()=>[(s(!0),q(pe,null,Ne(_.value,(g,V)=>(s(),h(e(vt),{key:V},{default:a(()=>[l(B,{to:g.path},{default:a(()=>[U(Y(g.label),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):S("",!0)]),_:1})]),content:a(()=>[e(C)?(s(),h(aa,{key:0,loading:e(d),table:e(C).table,onRefresh:I[2]||(I[2]=g=>e(P)())},null,8,["loading","table"])):S("",!0)]),_:1})}}});const Ba=$e(na,[["__scopeId","data-v-8c6a42b5"]]);export{Ba as default};
//# sourceMappingURL=TableEditor.b85c2e9b.js.map

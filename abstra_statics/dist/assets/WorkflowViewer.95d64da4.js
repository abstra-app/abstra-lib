var ve=Object.defineProperty;var ye=(u,t,d)=>t in u?ve(u,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[t]=d;var de=(u,t,d)=>(ye(u,typeof t!="symbol"?t+"":t,d),d);import{_ as G}from"./AbstraButton.vue_vue_type_script_setup_true_lang.9c0844e1.js";import{d as X,at as O,c as b,o as c,ac as A,ae as he,h as H,ed as ke,e as _,f as s,u as e,a as $,b as o,g as C,t as g,df as F,ad as be,aY as fe,_ as ie,dj as Z,ej as Se,f6 as ce,de as q,i as k,cS as ge,cT as Me,ei as me,ec as _e,el as R,bE as $e,bD as K,eh as re,bW as Le,cM as xe,eD as Ie,fa as Ce,r as V,w as Ae,ax as ze,U as Be,S as Ze,A as Q,dd as Pe,eG as je,eH as Te,es as Ne,et as Ve}from"./jwt-decode.esm.32f71954.js";import{F as Ee}from"./PhArrowSquareOut.vue.5a8d2f86.js";import{I as ue}from"./PhCopy.vue.3f2b76a2.js";import{F as He,I as We,O as De}from"./os.d718583c.js";import{G as Fe}from"./PhPencilSimple.vue.7ffd0edb.js";import{_ as Ye}from"./vue-flow-background.7de722ba.js";import{a as Xe,b as Ge,g as ee,u as Oe,e as qe,M as Je}from"./vue-flow-core.589f776e.js";import{k as te}from"./router.29e08ea4.js";import{a as le,B as Ue,b as Re}from"./build.c626214a.js";import"./tables.94d324c3.js";import{G as Ke}from"./PhArrowCounterClockwise.vue.dbc4fdc7.js";import{I as Qe}from"./PhCopySimple.vue.7cacc0f7.js";import{G as et}from"./PhDotsThreeVertical.vue.e305b3a2.js";import{F as tt,G as at,I as st,a as ot}from"./PhWebhooksLogo.vue.13c489ce.js";import{a as ae}from"./asyncComputed.f9fa4c71.js";import{a as nt}from"./project.b14b799c.js";import{g as rt}from"./datetime.cf8e211d.js";import{_ as lt,R as it}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang.a2a7ab75.js";import{R as dt}from"./repository.e580214f.js";import{u as ct}from"./polling.ca800fea.js";import{C as se}from"./Card.e1ec3051.js";import"./index.2400150a.js";import"./record.41c9caee.js";import"./string.ff0b4ef9.js";import"./LoadingOutlined.6f7bdc44.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[t]="441c6031-b325-4c4c-bbd7-be99ddda98e3",u._sentryDebugIdIdentifier="sentry-dbid-441c6031-b325-4c4c-bbd7-be99ddda98e3")}catch{}})();const ut=["width","height","fill","transform"],pt={key:0},ft=_("path",{d:"M227.85,46.89a20,20,0,0,0-18.74-18.74c-13.13-.77-46.65.42-74.48,28.24L131,60H74.36a19.83,19.83,0,0,0-14.14,5.86L25.87,100.19a20,20,0,0,0,11.35,33.95l37.14,5.18,42.32,42.32,5.19,37.18A19.88,19.88,0,0,0,135.34,235a20.13,20.13,0,0,0,6.37,1,19.9,19.9,0,0,0,14.1-5.87l34.34-34.35A19.85,19.85,0,0,0,196,181.64V125l3.6-3.59C227.43,93.54,228.62,60,227.85,46.89ZM76,84h31L75.75,115.28l-27.23-3.8ZM151.6,73.37A72.27,72.27,0,0,1,204,52a72.17,72.17,0,0,1-21.38,52.41L128,159,97,128ZM172,180l-27.49,27.49-3.8-27.23L172,149Zm-72,22c-8.71,11.85-26.19,26-60,26a12,12,0,0,1-12-12c0-33.84,14.12-51.32,26-60A12,12,0,1,1,68.18,175.3C62.3,179.63,55.51,187.8,53,203c15.21-2.51,23.37-9.3,27.7-15.18A12,12,0,1,1,100,202Z"},null,-1),gt=[ft],mt={key:1},_t=_("path",{d:"M184,120v61.65a8,8,0,0,1-2.34,5.65l-34.35,34.35a8,8,0,0,1-13.57-4.53L128,176ZM136,72H74.35a8,8,0,0,0-5.65,2.34L34.35,108.69a8,8,0,0,0,4.53,13.57L80,128ZM40,216c37.65,0,50.69-19.69,54.56-28.18L68.18,161.44C59.69,165.31,40,178.35,40,216Z",opacity:"0.2"},null,-1),wt=_("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),vt=[_t,wt],yt={key:2},ht=_("path",{d:"M101.85,191.14C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Zm122-144a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.4,27.07h0L88,108.7A8,8,0,0,1,76.67,97.39l26.56-26.57A4,4,0,0,0,100.41,64H74.35A15.9,15.9,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A16,16,0,0,0,192,181.65V155.59a4,4,0,0,0-6.83-2.82l-26.57,26.56a8,8,0,0,1-11.71-.42,8.2,8.2,0,0,1,.6-11.1l49.27-49.27h0C223.45,91.86,224.6,59.71,223.85,47.12Z"},null,-1),kt=[ht],bt={key:3},St=_("path",{d:"M221.86,47.24a14,14,0,0,0-13.11-13.1c-12.31-.73-43.77.39-69.88,26.5L133.52,66H74.35a13.9,13.9,0,0,0-9.89,4.1L30.11,104.44a14,14,0,0,0,7.94,23.76l39.13,5.46,45.16,45.16L127.8,218a14,14,0,0,0,23.76,7.92l34.35-34.35a13.91,13.91,0,0,0,4.1-9.89V122.48l5.35-5.35h0C221.46,91,222.59,59.56,221.86,47.24ZM38.11,115a2,2,0,0,1,.49-2L72.94,78.58A2,2,0,0,1,74.35,78h47.17L77.87,121.64l-38.14-5.32A1.93,1.93,0,0,1,38.11,115ZM178,181.65a2,2,0,0,1-.59,1.41L143.08,217.4a2,2,0,0,1-3.4-1.11l-5.32-38.16L178,134.48Zm8.87-73h0L128,167.51,88.49,128l58.87-58.88a78.47,78.47,0,0,1,60.69-23A2,2,0,0,1,209.88,48,78.47,78.47,0,0,1,186.88,108.64ZM100,190.31C95.68,199.84,81.13,222,40,222a6,6,0,0,1-6-6c0-41.13,22.16-55.68,31.69-60a6,6,0,1,1,5,10.92c-7,3.17-22.53,13.52-24.47,42.91,29.39-1.94,39.74-17.52,42.91-24.47a6,6,0,1,1,10.92,5Z"},null,-1),Mt=[St],$t={key:4},Lt=_("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),xt=[Lt],It={key:5},Ct=_("path",{d:"M219.86,47.36a12,12,0,0,0-11.22-11.22c-12-.71-42.82.38-68.35,25.91L134.35,68h-60a11.9,11.9,0,0,0-8.48,3.52L31.52,105.85a12,12,0,0,0,6.81,20.37l39.79,5.55,46.11,46.11,5.55,39.81a12,12,0,0,0,20.37,6.79l34.34-34.35a11.9,11.9,0,0,0,3.52-8.48v-60l5.94-5.94C219.48,90.18,220.57,59.41,219.86,47.36ZM36.21,115.6a3.94,3.94,0,0,1,1-4.09L71.53,77.17A4,4,0,0,1,74.35,76h52L78.58,123.76,39.44,118.3A3.94,3.94,0,0,1,36.21,115.6ZM180,181.65a4,4,0,0,1-1.17,2.83l-34.35,34.34a4,4,0,0,1-6.79-2.25l-5.46-39.15L180,129.65Zm-52-11.31L85.66,128l60.28-60.29c23.24-23.24,51.25-24.23,62.22-23.58a3.93,3.93,0,0,1,3.71,3.71c.65,11-.35,39-23.58,62.22ZM98.21,189.48C94,198.66,80,220,40,220a4,4,0,0,1-4-4c0-40,21.34-54,30.52-58.21a4,4,0,0,1,3.32,7.28c-7.46,3.41-24.43,14.66-25.76,46.85,32.19-1.33,43.44-18.3,46.85-25.76a4,4,0,1,1,7.28,3.32Z"},null,-1),At=[Ct],zt={name:"PhRocketLaunch"},Bt=X({...zt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(u){const t=u,d=O("weight","regular"),L=O("size","1em"),w=O("color","currentColor"),r=O("mirrored",!1),a=b(()=>{var i;return(i=t.weight)!=null?i:d}),p=b(()=>{var i;return(i=t.size)!=null?i:L}),l=b(()=>{var i;return(i=t.color)!=null?i:w}),x=b(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:r?"scale(-1, 1)":void 0);return(i,v)=>(c(),A("svg",ke({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:p.value,height:p.value,fill:l.value,transform:x.value},i.$attrs),[he(i.$slots,"default"),a.value==="bold"?(c(),A("g",pt,gt)):a.value==="duotone"?(c(),A("g",mt,vt)):a.value==="fill"?(c(),A("g",yt,kt)):a.value==="light"?(c(),A("g",bt,Mt)):a.value==="regular"?(c(),A("g",$t,xt)):a.value==="thin"?(c(),A("g",It,At)):H("",!0)],16,ut))}}),Zt=X({__name:"WorkflowEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(u){const t=u;function d(r,a,p=0){const l=a.center.x-r.center.x,x=a.center.y-r.center.y,i=Math.sqrt(l*l+x*x);if(i===0)return{sourceX:r.center.x,sourceY:r.center.y,targetX:a.center.x,targetY:a.center.y};const v=l/i,S=x/i,f=r.width/2,M=r.height/2;let P=r.center.x,j=r.center.y;Math.abs(v)*M>Math.abs(S)*f?(P=r.center.x+(v>0?f:-f),j=r.center.y+S*f/Math.abs(v)):(P=r.center.x+v*M/Math.abs(S),j=r.center.y+(S>0?M:-M));const z=a.width/2,T=a.height/2;let E=a.center.x,m=a.center.y;return Math.abs(v)*T>Math.abs(S)*z?(E=a.center.x-(v>0?z:-z),m=a.center.y-S*z/Math.abs(v)):(E=a.center.x-v*T/Math.abs(S),m=a.center.y-(S>0?T:-T)),P+=v*p,j+=S*p,E-=v*p,m-=S*p,{sourceX:P,sourceY:j,targetX:E,targetY:m}}function L(r,a){const l={center:{x:r.computedPosition.x+r.dimensions.width/2,y:r.computedPosition.y+r.dimensions.height/2},width:r.dimensions.width,height:r.dimensions.height},i={center:{x:a.computedPosition.x+a.dimensions.width/2,y:a.computedPosition.y+a.dimensions.height/2},width:a.dimensions.width,height:a.dimensions.height};return d(l,i,10)}const w=b(()=>{if(!t.sourceNode||!t.targetNode)return ee({sourceX:0,sourceY:0,targetX:0,targetY:0});if(!t.sourceNode.dimensions.width||!t.targetNode.dimensions.width||!t.sourceNode.dimensions.height||!t.targetNode.dimensions.height)return ee({sourceX:0,sourceY:0,targetX:0,targetY:0});const r=L(t.sourceNode,t.targetNode);return ee(r)});return(r,a)=>{var p,l;return c(),A(fe,null,[s(e(Xe),{path:w.value[0],"marker-end":t.markerEnd},null,8,["path","marker-end"]),(l=(p=t.data)==null?void 0:p.props)!=null&&l.taskType?(c(),$(e(Ge),{key:0},{default:o(()=>[_("div",{style:be({transform:`translate(-50%, -50%) translate(${w.value[1]}px,${w.value[2]}px)`}),class:"nodrag nopan edge-label"},[s(e(F),null,{default:o(()=>[C(g(t.data.props.taskType),1)]),_:1})],4)]),_:1})):H("",!0)],64)}}});const Pt=ie(Zt,[["__scopeId","data-v-8f1859d4"]]);class jt{async list(t){return te.get(`projects/${t}/disabled-stages`)}async disableStage({projectId:t,stageId:d}){return te.patch(`projects/${t}/disabled-stages/${d}`,{enable:!1})}async enableStage({projectId:t,stageId:d}){return te.patch(`projects/${t}/disabled-stages/${d}`,{enable:!0})}}const oe=new jt;class Y{constructor(t){de(this,"id");this.dto=t,this.id=t}static async list(t){return(await oe.list(t)).map(L=>new Y(L))}static async disableStage({projectId:t,stageId:d}){return oe.disableStage({projectId:t,stageId:d})}static async enableStage({projectId:t,stageId:d}){return oe.enableStage({projectId:t,stageId:d})}}const Tt=X({__name:"WorkflowStageExecutions",props:{stageId:{},projectId:{},executions:{},taskStats:{},loading:{type:Boolean}},setup(u){const t=u,d=b(()=>t.taskStats?Math.round(t.taskStats.completed/t.taskStats.total*100):0),L=b(()=>{const a=d.value;return a===100?"#52c41a":a>=50?"#1890ff":"#faad14"}),w=a=>rt(a,{weekday:void 0}),r=a=>{if(a<60)return`${Math.round(a)}s`;const p=Math.floor(a/60);if(p<60)return`${p}m`;const l=Math.floor(p/60);return l<24?`${l}h`:`${Math.floor(l/24)}d`};return(a,p)=>(c(),$(e(Z),{vertical:"",size:4,style:{width:"100%"}},{default:o(()=>[a.executions&&a.executions.length>0?(c(),$(e(Z),{key:0,size:4,gap:4},{default:o(()=>[(c(!0),A(fe,null,Se(a.executions,l=>(c(),$(e(ce),{key:l.id,to:{name:"logs",params:{projectId:a.projectId},query:{executionId:l.id}}},{default:o(()=>[s(e(ge),{title:w(l.createdAt)},{content:o(()=>[s(e(Z),{vertical:"",size:4},{default:o(()=>[s(e(q),null,{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_status"))+": "+g(l.status),1)]),_:2},1024),s(e(q),null,{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_duration"))+": "+g(l.duration_seconds)+"s",1)]),_:2},1024),s(e(q),null,{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_version"))+": "+g(l.buildId.slice(0,6)),1)]),_:2},1024)]),_:2},1024)]),default:o(()=>[s(lt,{status:l.status},null,8,["status"])]),_:2},1032,["title"])]),_:2},1032,["to"]))),128))]),_:1})):H("",!0),a.taskStats&&a.taskStats.total>0?(c(),$(e(ce),{key:1,to:{name:"tasks",params:{projectId:a.projectId},query:{stage:a.stageId,status:"pending"}}},{default:o(()=>[s(e(Z),{vertical:"",size:2},{default:o(()=>[s(e(Me),{"show-info":!1,percent:d.value,"stroke-color":L.value,size:"small"},null,8,["percent","stroke-color"]),s(e(Z),{vertical:"",size:0},{default:o(()=>[a.taskStats.pending&&a.taskStats.averageCompletionSeconds?(c(),$(e(q),{key:0,type:"secondary",style:{fontSize:"11px"}},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_pending_tasks").replace("{count}",a.taskStats.pending.toString()))+" ("+g(r(a.taskStats.averageCompletionSeconds))+" "+g(e(k).translate("i18n_workflowviewer_average"))+") ",1)]),_:1})):H("",!0)]),_:1})]),_:1})]),_:1},8,["to"])):H("",!0)]),_:1}))}}),Nt={class:"stage-content"},Vt={class:"stage-title"},Et={class:"action-item"},Ht={class:"action-item"},Wt={class:"action-warning"},Dt={key:1,class:"action-item"},pe="3.18.0",Ft=X({__name:"WorkflowStageNode",props:{stage:{}},setup(u){const t=u,d=me(),L=_e(),w=d.params.projectId,r=b(()=>({forms:tt,hooks:at,scripts:st,jobs:ot})[t.stage.type]),{result:a}=ae(async()=>await nt.get(w)),{result:p}=ae(async()=>{const I=(await le.list(w)).find(n=>n.latest);return I?await Ue.get(I.id):null}),{result:l,refetch:x}=ae(async()=>(await Y.list(w)).filter(I=>I)),i=()=>{L.push({name:"logs",params:{projectId:w},query:{stageId:t.stage.id}})},v=b(()=>t.stage.type==="forms"||t.stage.type==="hooks"),S=()=>{var n;if(!t.stage.path)return;const m=t.stage.type==="forms"?`/${t.stage.path}`:`/_hooks/${t.stage.path}`,I=(n=a.value)==null?void 0:n.getUrl(m);!I||(navigator.clipboard.writeText(I),xe.success(k.translate("i18n_workflowviewer_copied_url")))},f=b(()=>{var m;return(m=l.value)==null?void 0:m.map(I=>I.id).includes(t.stage.id)}),M=(m,I)=>{const[n,y,h]=m.split(".").map(Number),[D,B,W]=I.split(".").map(Number);return n>D?!0:n<D?!1:y>B?!0:y<B?!1:h>=W},P=b(()=>f.value?Ie:Ce),j=b(()=>f.value?k.translate("i18n_workflowviewer_enable_stage"):k.translate("i18n_workflowviewer_disable_stage")),z=b(()=>{var m;return!M(((m=p.value)==null?void 0:m.abstraVersion)||"0.0.0",pe)}),T=b(()=>z.value?k.translate("i18n_workflowviewer_disable_stages_warning").replace("{version}",pe):""),E=async()=>{z.value||(f.value?await Y.enableStage({projectId:w,stageId:t.stage.id}):await Y.disableStage({projectId:w,stageId:t.stage.id}),await x())};return(m,I)=>(c(),A("div",{class:re(["stage-node",{disabled:f.value}])},[_("div",Nt,[(c(),$(R(r.value),{size:18,class:"stage-icon"})),_("div",Vt,g(m.stage.title),1),s(e(Le),{trigger:["click"]},{overlay:o(()=>[s(e($e),null,{default:o(()=>[s(e(K),{onClick:i},{default:o(()=>[_("div",Et,[s(e(Ke),{size:16}),_("span",null,g(e(k).translate("i18n_workflowviewer_view_logs")),1)])]),_:1}),v.value?(c(),$(e(K),{key:0,onClick:S},{default:o(()=>[_("div",Ht,[s(e(Qe),{size:16}),_("span",null,g(e(k).translate("i18n_workflowviewer_copy_url")),1)])]),_:1})):H("",!0),s(e(K),{onClick:E},{default:o(()=>[z.value?(c(),$(e(ge),{key:0,placement:"left"},{content:o(()=>[_("div",Wt,[s(e(F),null,{default:o(()=>[C(g(T.value),1)]),_:1})])]),default:o(()=>[_("div",{class:re(["action-item",{disabled:z.value}])},[(c(),$(R(P.value),{size:16})),_("span",null,g(j.value),1)],2)]),_:1})):(c(),A("div",Dt,[(c(),$(R(P.value),{size:16})),_("span",null,g(j.value),1)]))]),_:1})]),_:1})]),default:o(()=>[s(e(et),{style:{cursor:"pointer"},size:20,class:"actions-menu"})]),_:1})]),s(Tt,{"stage-id":m.stage.id,"project-id":e(w),executions:m.stage.executions,"task-stats":m.stage.taskStats,style:{"margin-top":"8px"}},null,8,["stage-id","project-id","executions","task-stats"])],2))}});const J=ie(Ft,[["__scopeId","data-v-0d8346f9"]]);function Yt(u,t){const d=new it,L=new dt(u),w=V({}),r=V({}),a=V(!1);async function p(){const i=t.value;if(i.length===0){a.value=!1;return}a.value=!0;try{const[v,S]=await Promise.all([Promise.all(i.map(async f=>{try{const{executions:M}=await d.list({projectId:u,stageId:f,limit:6});return{stageId:f,executions:M}}catch(M){return console.error(`Failed to load executions for stage ${f}:`,M),{stageId:f,executions:[]}}})),L.getTasksStatistics()]);v.forEach(({stageId:f,executions:M})=>{w.value[f]=M}),S.forEach(f=>{r.value[f.stageId]={pending:f.pendingTasks,completed:f.completedTasks,total:f.totalTasks,averageCompletionSeconds:f.averageCompletionSeconds}})}catch(v){console.error("Failed to load workflow data:",v)}finally{a.value=!1}}const{startPolling:l,endPolling:x}=ct({task:p,interval:15e3});return Ae(t,i=>{i.length>0&&(p(),l())},{immediate:!0}),ze(()=>{x()}),{executionsByStage:w,taskStatsByStage:r,loading:a,refetch:p}}const we=u=>(Ne("data-v-7b40ff03"),u=u(),Ve(),u),Xt={class:"flow-container"},Gt={class:"code-container"},Ot=we(()=>_("code",{class:"install-code"},"pip install abstra",-1)),qt={class:"code-container"},Jt=we(()=>_("code",{class:"install-code"},"abstra editor .",-1)),Ut={key:0,class:"edit-button-text"},ne="#ea576a",Rt=X({__name:"WorkflowViewer",setup(u){const{onInit:t}=Oe(),d=new Re,L=me(),w=_e(),r=L.params.projectId,a=L.query.buildId,p=V(!0),l=V(null),x=V(!0),i=V(!1),v=()=>{w.push({name:"web-editor",params:{projectId:r}})},S=async n=>{try{await navigator.clipboard.writeText(n)}catch(y){console.error("Failed to copy:",y)}};t(n=>{x.value&&(n.fitView(),x.value=!1)});const f=V([]),M=V([]),P=b(()=>f.value.map(n=>n.id)),{executionsByStage:j,taskStatsByStage:z}=Yt(r,P),T=b(()=>f.value.length>0),E=b(()=>f.value.map(n=>({id:n.id,type:n.type,data:{...n,executions:j.value[n.id]||[],taskStats:z.value[n.id]||null},position:{x:n.position.x,y:n.position.y*1.5}}))),m=b(()=>M.value.map(n=>({id:n.id,source:n.sourceStageId,target:n.targetStageId,type:"task",data:{id:n.id,props:{taskType:n.taskType}},markerEnd:{type:Je.Arrow,width:24,height:24}})));function I(n){const y=[],h=[],D=["jobs","hooks","forms","scripts"];for(const B of D){const W=n[B]||[];for(const N of W){y.push({id:N.id,type:B,title:N.title,position:{x:N.workflow_position[0],y:N.workflow_position[1]},file:N.file,path:N.path,schedule:N.schedule});for(const U of N.transitions||[])h.push({id:U.id,sourceStageId:N.id,targetStageId:U.target_id,taskType:U.task_type})}}f.value=y,M.value=h}return Be(async()=>{try{p.value=!0;let n;if(a){const B=(await le.list(r)).find(W=>W.id===a);if(!B){l.value="Build not found";return}n=B}else{const B=(await le.list(r)).find(W=>W.latest);if(!B){l.value="No builds found for this project";return}n=B}const y=await d.get(n.id);if(!y||!y.abstraJson){l.value="No workflow data available for this build";return}const h=JSON.parse(y.abstraJson);I(h)}catch(n){l.value=n instanceof Error?n.message:"Failed to load workflow",console.error(n)}finally{p.value=!1}}),(n,y)=>(c(),A("div",Xt,[p.value?(c(),$(e(Ze),{key:0,style:{width:"100%"}})):T.value?(c(),$(e(qe),{key:2,nodes:E.value,edges:m.value,"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.1,"max-zoom":1.25,"pan-on-scroll":e(De).isMac,"snap-to-grid":""},{"edge-task":o(h=>[s(Pt,je(Te(h)),null,16)]),"node-forms":o(h=>[s(J,{stage:h.data},null,8,["stage"])]),"node-hooks":o(h=>[s(J,{stage:h.data},null,8,["stage"])]),"node-scripts":o(h=>[s(J,{stage:h.data},null,8,["stage"])]),"node-jobs":o(h=>[s(J,{stage:h.data},null,8,["stage"])]),default:o(()=>[s(e(Ye),{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","pan-on-scroll"])):(c(),$(e(se),{key:1,class:"empty-state-card"},{default:o(()=>[s(e(Z),{vertical:"",gap:24,align:"center"},{default:o(()=>[s(e(Bt),{size:64,color:ne}),s(e(Z),{vertical:"",gap:8,align:"center"},{default:o(()=>[s(e(Q),{level:3},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_getting_started")),1)]),_:1}),s(e(F),{type:"secondary",style:{"text-align":"center"}},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_no_workflow_description")),1)]),_:1})]),_:1}),s(e(Z),{gap:16,wrap:"wrap",justify:"center"},{default:o(()=>[s(e(se),{class:"option-card"},{default:o(()=>[s(e(Z),{vertical:"",gap:12},{default:o(()=>[s(e(He),{size:32,color:ne}),s(e(Q),{level:5},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_option_cli")),1)]),_:1}),s(e(F),{type:"secondary",style:{"font-size":"13px"}},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_cli_description")),1)]),_:1}),s(e(Z),{vertical:"",gap:8},{default:o(()=>[_("div",Gt,[Ot,s(G,{type:"text",size:"small",onClick:y[0]||(y[0]=h=>S("pip install abstra"))},{default:o(()=>[s(e(ue),{size:16})]),_:1})]),_("div",qt,[Jt,s(G,{type:"text",size:"small",onClick:y[1]||(y[1]=h=>S("abstra editor ."))},{default:o(()=>[s(e(ue),{size:16})]),_:1})])]),_:1})]),_:1})]),_:1}),s(e(se),{class:"option-card"},{default:o(()=>[s(e(Z),{vertical:"",gap:12},{default:o(()=>[s(e(We),{size:32,color:ne}),s(e(Q),{level:5},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_option_online")),1)]),_:1}),s(e(F),{type:"secondary",style:{"font-size":"13px"}},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_online_description")),1)]),_:1}),s(G,{type:"primary",onClick:v},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_open_editor")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(Pe),{href:"https://www.abstra.io/docs",target:"_blank"},{default:o(()=>[C(g(e(k).translate("i18n_workflowviewer_view_docs"))+" ",1),s(e(Ee),{size:14,style:{"margin-left":"4px"}})]),_:1})]),_:1})]),_:1})),!p.value&&T.value?(c(),$(G,{key:3,class:re(["edit-button",{expanded:i.value}]),type:"primary",size:"large",onClick:v,onMouseenter:y[2]||(y[2]=h=>i.value=!0),onMouseleave:y[3]||(y[3]=h=>i.value=!1)},{default:o(()=>[s(e(Fe),{size:24}),i.value?(c(),A("span",Ut,g(e(k).translate("i18n_workflowviewer_edit_online")),1)):H("",!0)]),_:1},8,["class"])):H("",!0)]))}});const $a=ie(Rt,[["__scopeId","data-v-7b40ff03"]]);export{$a as default};
//# sourceMappingURL=WorkflowViewer.95d64da4.js.map

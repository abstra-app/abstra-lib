var ue=Object.defineProperty;var de=(m,e,a)=>e in m?ue(m,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[e]=a;var L=(m,e,a)=>(de(m,typeof e!="symbol"?e+"":e,a),a);import{_ as pe}from"./DocsButton.vue_vue_type_script_setup_true_lang.2694b5d6.js";import{_ as ee}from"./AbstraButton.vue_vue_type_script_setup_true_lang.389127ab.js";import{d as D,at as G,c as x,o as i,ac as I,ae as ge,h as V,ed as he,e as B,z as ye,r as P,M as J,w as ae,a as v,b as l,ej as M,u as n,cE as fe,bQ as W,cW as me,aY as N,cU as ve,g as _,t as C,cA as _e,bT as Ce,aI as ke,cJ as be,dg as we,f as s,i as f,df as z,cD as Ie,dj as S,de as O,c$ as Te,d9 as oe,eh as Se,_ as ie,ei as Ae,Z as le,cM as Y,A as Q,bW as Ue,bE as je,bD as se,cI as $e,eu as Ne,ev as Ve}from"./jwt-decode.esm.f40ec2b3.js";import{G as Ee}from"./PhDotsThreeVertical.vue.d177067e.js";import{k as H,o as Ke}from"./router.07ee79cc.js";import{U as Le}from"./UploadOutlined.2f35e20a.js";import{_ as Fe}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.9e256c49.js";import{L as He}from"./Logo.c8307b4d.js";import{A as ce}from"./index.18a558de.js";import{C as re}from"./Card.7efceb15.js";import{A as ze}from"./index.30effe38.js";import"./constants.75dbc700.js";import"./index.5077cf47.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[e]="dd9d726c-af3e-4262-84d0-59cb8900f42d",m._sentryDebugIdIdentifier="sentry-dbid-dd9d726c-af3e-4262-84d0-59cb8900f42d")}catch{}})();const Re=["width","height","fill","transform"],xe={key:0},Be=B("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),Pe=[Be],Me={key:1},De=B("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),Ze=B("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),qe=[De,Ze],Ge={key:2},Oe=B("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),Je=[Oe],We={key:3},Ye=B("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),Qe=[Ye],Xe={key:4},en=B("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),nn=[en],tn={key:5},an=B("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),on=[an],ln={name:"PhArrowsLeftRight"},sn=D({...ln,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(m){const e=m,a=G("weight","regular"),t=G("size","1em"),r=G("color","currentColor"),y=G("mirrored",!1),c=x(()=>{var T;return(T=e.weight)!=null?T:a}),b=x(()=>{var T;return(T=e.size)!=null?T:t}),$=x(()=>{var T;return(T=e.color)!=null?T:r}),E=x(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:y?"scale(-1, 1)":void 0);return(T,u)=>(i(),I("svg",he({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:b.value,height:b.value,fill:$.value,transform:E.value},T.$attrs),[ge(T.$slots,"default"),c.value==="bold"?(i(),I("g",xe,Pe)):c.value==="duotone"?(i(),I("g",Me,qe)):c.value==="fill"?(i(),I("g",Ge,Je)):c.value==="light"?(i(),I("g",We,Qe)):c.value==="regular"?(i(),I("g",Xe,nn)):c.value==="thin"?(i(),I("g",tn,on)):V("",!0)],16,Re))}});class cn{async generateEcdsaKey(e){const{projectId:a,connectionName:t,connectorType:r}=e;return H.post(`projects/${a}/connectors/${r}/connections/${t}/ecdsa-key`,{})}async createEcdsaConnection(e){const{projectId:a,connectionName:t,connectorType:r,publicKey:y,privateKey:c,accessId:b}=e;return H.post(`projects/${a}/connectors/${r}/connections/${t}/create-ecdsa`,{publicKey:y,privateKey:c,accessId:b})}async generateRsaKey(e){const{projectId:a,connectionName:t,connectorType:r}=e;return H.post(`projects/${a}/connectors/${r}/connections/${t}/rsa-key`,{})}async createRsaConnection(e){const{projectId:a,connectionName:t,connectorType:r,publicKey:y,privateKey:c,apiToken:b}=e;return H.post(`projects/${a}/connectors/${r}/connections/${t}/create-rsa`,{publicKey:y,privateKey:c,apiToken:b})}async getLoginUrl(e,a,t,r,y){return H.get(`projects/${e}/connectors/${t}/connections/${a}/login-url`,{scopeIds:r.join(","),...y})}async listConnectors(e){return H.get(`projects/${e}/connectors`)}async getConnectorsBetaStatus(){const{EnvURL:e}=await ye(()=>import("./router.07ee79cc.js").then(a=>a.q),["assets/router.07ee79cc.js","assets/jwt-decode.esm.f40ec2b3.js","assets/jwt-decode.1a092264.css","assets/index.5077cf47.js"]);try{const a=await fetch(`${e.cloudApi}/public/connectors/beta-status`);if(!a.ok){if(a.status===404)return console.warn("Beta status endpoint not available yet, returning empty status"),{};throw new Error("Failed to fetch connectors beta status")}return a.json()}catch(a){return console.error("Error fetching beta status:",a),{}}}async createTokenConnection(e){const{projectId:a,connectionName:t,connectorType:r,tokens:y}=e,c={type:"tokens",tokens:y};return H.post(`projects/${a}/connectors/${r}/connections/${t}`,c)}async listConnections(e){return H.get(`projects/${e}/connections`)}async deleteConnection(e){const{projectId:a,connectionName:t,connectorType:r}=e;return H.delete(`projects/${a}/connectors/${r}/connections/${t}`)}async renameConnection(e){const{projectId:a,connectionName:t,connectorType:r,newConnectionName:y}=e;return H.patch(`projects/${a}/connectors/${r}/connections/${t}`,{newConnectionName:y})}}class rn{constructor(e,a){L(this,"state");L(this,"hasChanges",x(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));L(this,"handleDeletionClick",async e=>{J.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(e)})});L(this,"handleDeleteConnection",async e=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});L(this,"handleAddConnectionSubmit",async()=>{var y,c,b,$;const e=(y=this.state.value.addingConnection)==null?void 0:y.connector.metadata.key,a=(c=this.state.value.addingConnection)==null?void 0:c.selectedScopeIds,t=($=(b=this.state.value.addingConnection)==null?void 0:b.tokenValues)!=null?$:{};if(!e||!a)throw new Error("No connector or scope selected");const{url:r}=await this.getLoginUrl(e,this.getUniqueName(e),a,t);window.location.href=r});L(this,"handleAddTokenConnectionSubmit",async()=>{const e=this.state.value.addingConnection;if(!e)throw new Error("No connection is being added");const a=e.connector.metadata.key,t=this.getUniqueName(a);await this.api.createTokenConnection({projectId:this.projectId,connectionName:t,connectorType:a,tokens:e.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()});L(this,"handleAddEcdsaConnectionSubmit",async(e,a)=>{const t=this.state.value.addingConnection;if(!t||!e)throw new Error("No connection is being added or public key is missing");if(!t.connectionName||!t.ecdsaKeys)throw new Error("Keys or connection name not found");const r=t.connector.metadata.key;if(r==="iugu"){if(!a)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:t.connectionName,connectorType:r,publicKey:t.ecdsaKeys.publicKey,privateKey:t.ecdsaKeys.privateKey,apiToken:a})}else{if(!a)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:t.connectionName,connectorType:r,publicKey:t.ecdsaKeys.publicKey,privateKey:t.ecdsaKeys.privateKey,accessId:a})}this.state.value.addingConnection=null,await this.refetchConnections()});L(this,"renameConnection",async()=>{const{editingConnection:e}=this.state.value;if(!e)throw new Error("No connection is being edited");const a=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType,newConnectionName:e.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};J.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:a})});L(this,"showAddConfirmationModal",e=>{this.state.value.addingConnection={selectedScopeIds:e.auth.type==="oauth2"?e.auth.scopes.map(a=>a.key):[],connector:e,tokenValues:{}}});L(this,"handleScopeToggle",(e,a)=>{a?this.state.value.addingConnection.selectedScopeIds.push(e):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(t=>t!==e)});this.projectId=e,this.api=a,this.state=P({connectors:[],connections:[],addingConnection:null,editingConnection:null,betaStatus:{}})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchBetaStatus(){this.state.value.betaStatus=await this.api.getConnectorsBetaStatus()}async fetchInitialState(){await this.fetchConnectors(),await Promise.all([this.fetchBetaStatus(),this.refetchConnections()])}async refetchConnections(){const e=await this.api.listConnections(this.projectId);this.state.value.connections=e.map(a=>{const t=this.state.value.connectors.find(r=>r.metadata.key===a.connectionType);return t?{name:a.name,connectorTitle:t.metadata.label,connectorType:a.connectionType,icon:t.metadata.logoUrl}:null}).filter(a=>a!==null)}handleEditConnectionClick(e){this.state.value.editingConnection={...e,newName:e.name}}async getLoginUrl(e,a,t,r){return this.api.getLoginUrl(this.projectId,a,e,t,r)}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(e){const a=this.state.value.connections.filter(t=>t.connectorType===e).length;return a===0?e:`${e}-${a}`}async generateEcdsaKey(){const e=this.state.value.addingConnection;if(!e)throw new Error("No connection is being added");const a=e.connector.metadata.key,t=this.getUniqueName(a),y=a==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:t,connectorType:a}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:t,connectorType:a});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=t,this.state.value.addingConnection.ecdsaKeys=y),y.publicKey}}function un(m){return new Promise((e,a)=>{const t=new FileReader;t.onload=()=>{const y=t.result.split(",")[1];e(y)},t.onerror=()=>a(t.error),t.readAsDataURL(m)})}const dn={key:6,style:{"margin-top":"16px"}},X=D({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(m,{emit:e}){const a=m,t=P(a.uploadedFiles||{});function r(d){const g=c.value[d];return g?g.split(",").map(o=>o.trim()):[]}function y(d,g){Array.isArray(g)?b(d,g.join(",")):console.error("Expected array for checkbox/select value")}const c=P({...a.tokenValues});ae(()=>a.tokenValues,d=>{c.value={...d}},{deep:!0}),ae(()=>a.uploadedFiles,d=>{t.value=d||{}},{deep:!0});function b(d,g){c.value[d]=g;const o={...c.value};e("update:tokenValues",o),e("tokenChange")}function $(d){var o,U;const g=[];return d.key&&g.push({required:!0,message:f.translate("i18n_auth_form_field_required",null,d.label||d.key)}),(o=d.input)!=null&&o.minSize&&g.push({min:d.input.minSize,message:f.translate("i18n_auth_form_field_min_length",null,d.input.minSize)}),(U=d.input)!=null&&U.maxSize&&g.push({max:d.input.maxSize,message:f.translate("i18n_auth_form_field_max_length",null,d.input.maxSize)}),g}async function E(d,g){try{const o=await un(d),U={...t.value,[g]:{file:d,base64:o}};t.value=U,e("update:uploadedFiles",U),c.value[g]=o;const R={...c.value};e("update:tokenValues",R),e("tokenChange")}catch(o){console.error("Error converting file to base64:",o)}return!1}function T(d){const g={...t.value};delete g[d],t.value=g,e("update:uploadedFiles",g),c.value[d]="";const o={...c.value};e("update:tokenValues",o),e("tokenChange")}function u(d){const g=t.value[d];return g?[{uid:d,name:g.file.name,status:"done",size:g.file.size}]:[]}return(d,g)=>(i(),v(n(Ie),{model:c.value,layout:"vertical"},{default:l(()=>[(i(!0),I(N,null,M(d.tokens,o=>(i(),v(n(fe),{key:o.key,label:o.label,name:o.key,rules:$(o)},{default:l(()=>{var U,R,Z,p,k,h,j,A,F,K,q,ne,te;return[((U=o.input)==null?void 0:U.type)==="small-string"?(i(),v(n(W),{key:0,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,placeholder:o.description,maxlength:(R=o.input)==null?void 0:R.maxSize,minlength:(Z=o.input)==null?void 0:Z.minSize,type:"password",onInput:()=>b(o.key,c.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((p=o.input)==null?void 0:p.type)==="radiobox"?(i(),v(n(me),{key:1,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,onChange:()=>b(o.key,c.value[o.key]||"")},{default:l(()=>[(i(!0),I(N,null,M(o.input.options,w=>(i(),v(n(ve),{key:w.value,value:w.value},{default:l(()=>[_(C(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):((k=o.input)==null?void 0:k.type)==="checkbox"?(i(),I(N,{key:2},[((A=(j=(h=o.input)==null?void 0:h.options)==null?void 0:j.length)!=null?A:0)<=10?(i(),v(n(_e),{key:0,value:r(o.key),onChange:w=>y(o.key,w)},{default:l(()=>[(i(!0),I(N,null,M(o.input.options,w=>(i(),v(n(Ce),{key:w.value,value:w.value},{default:l(()=>[_(C(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(i(),v(n(ke),{key:1,mode:"multiple",style:{width:"100%"},value:r(o.key),options:(F=o.input.options)!=null?F:[],onChange:w=>y(o.key,w)},null,8,["value","options","onChange"]))],64)):((K=o.input)==null?void 0:K.type)==="large-text"?(i(),v(n(be),{key:3,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,placeholder:o.description,maxlength:(q=o.input)==null?void 0:q.maxSize,minlength:(ne=o.input)==null?void 0:ne.minSize,rows:4,onInput:()=>b(o.key,c.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((te=o.input)==null?void 0:te.type)==="file"?(i(),v(n(we),{key:4,"file-list":u(o.key),"before-upload":w=>E(w,o.key),"max-count":1,"show-upload-list":!0,onRemove:()=>T(o.key)},{default:l(()=>[s(ee,null,{default:l(()=>[s(n(Le)),_(" "+C(n(f).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:2},1032,["file-list","before-upload","onRemove"])):(i(),v(n(W),{key:5,value:c.value[o.key],"onUpdate:value":w=>c.value[o.key]=w,placeholder:o.description,type:"password",onInput:()=>b(o.key,c.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),o.instructions?(i(),I("div",dn,[s(n(z),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:l(()=>[_(C(o.instructions),1)]),_:2},1024)])):V("",!0),o.description&&!o.instructions?(i(),v(n(z),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:l(()=>[_(C(o.description),1)]),_:2},1024)):V("",!0)]}),_:2},1032,["label","name","rules"]))),128))]),_:1},8,["model"]))}}),pn=D({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(m){return(e,a)=>(i(),v(n(S),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:l(()=>[s(Fe,{"hide-text":"",size:"large"}),s(n(sn),{size:24}),s(He,{"image-url":e.connectorLogoUrl,"brand-name":e.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),gn=D({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(m,{emit:e}){const a=m,t=x(()=>{var d,g,o;switch((d=a.addingConnection)==null?void 0:d.connector.auth.type){case"oauth2":return f.translate("i18n_connection_modal_button_authorize",null);case"tokens":return f.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!a.ecdsaPublicKey)return f.translate("i18n_connection_modal_button_ok",null);const U=((g=a.addingConnection)==null?void 0:g.connector.auth.params)||[],R=((o=a.addingConnection)==null?void 0:o.tokenValues)||{};return U.every(p=>R[p.key]&&R[p.key].trim().length>0)?f.translate("i18n_connection_modal_button_create",null):f.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return f.translate("i18n_connection_modal_button_ok",null)}});function r(){e("cancel")}function y(){e("submit")}function c(u,d){e("scope-toggle",u,d)}function b(){e("generate-ecdsa-key")}function $(u){e("update:token-values",u)}function E(u){e("update:uploaded-files",u)}function T(){e("token-change")}return(u,d)=>(i(),v(n(J),{open:!!u.addingConnection,title:u.addingConnection?n(f).translate("i18n_connection_modal_title_add",null,u.addingConnection.connector.metadata.label):"","ok-text":t.value,"ok-button-props":{disabled:t.value.includes("Required")},"confirm-loading":u.loading,"wrap-class-name":"full-modal",onCancel:r,onOk:y},{default:l(()=>[u.addingConnection?(i(),I(N,{key:0},[s(pn,{"connector-logo-url":u.addingConnection.connector.metadata.logoUrl,"connector-label":u.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),u.addingConnection.connector.auth.type==="oauth2"?(i(),I(N,{key:0},[s(n(O),null,{default:l(()=>[_(C(n(f).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),s(n(S),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:l(()=>{var g;return[(i(!0),I(N,null,M(u.addingConnection.connector.auth.scopes,o=>(i(),v(n(S),{key:o.key,justify:"space-between",align:"center"},{default:l(()=>[s(n(S),{vertical:""},{default:l(()=>[s(n(z),null,{default:l(()=>[_(C(o.description),1)]),_:2},1024),s(n(z),{type:"secondary"},{default:l(()=>[_(C(o.key),1)]),_:2},1024)]),_:2},1024),s(n(Te),{checked:u.addingConnection.selectedScopeIds.includes(o.key),onChange:U=>c(o.key,U)},null,8,["checked","onChange"])]),_:2},1024))),128)),(g=u.addingConnection.connector.auth.params)!=null&&g.length?(i(),v(X,{key:0,tokens:u.addingConnection.connector.auth.params,"token-values":u.addingConnection.tokenValues,"uploaded-files":u.uploadedFiles,"onUpdate:tokenValues":$,"onUpdate:uploadedFiles":E,onTokenChange:T},null,8,["tokens","token-values","uploaded-files"])):V("",!0)]}),_:1})],64)):V("",!0),u.addingConnection.connector.auth.type==="tokens"?(i(),I(N,{key:1},[s(n(O),null,{default:l(()=>[_(C(n(f).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),s(X,{tokens:u.addingConnection.connector.auth.tokens,"token-values":u.addingConnection.tokenValues,"uploaded-files":u.uploadedFiles,"onUpdate:tokenValues":$,"onUpdate:uploadedFiles":E,onTokenChange:T},null,8,["tokens","token-values","uploaded-files"])],64)):V("",!0),u.addingConnection.connector.auth.type==="ecdsa"?(i(),I(N,{key:2},[u.ecdsaPublicKey?(i(),v(n(S),{key:1,vertical:"",gap:"16"},{default:l(()=>[s(n(z),{strong:""},{default:l(()=>[_(C(n(f).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),s(n(z),{strong:""},{default:l(()=>[_(C(n(f).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),s(n(W),{value:u.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),s(X,{tokens:u.addingConnection.connector.auth.params,"token-values":u.addingConnection.tokenValues,"uploaded-files":u.uploadedFiles,"onUpdate:tokenValues":$,"onUpdate:uploadedFiles":E,onTokenChange:T},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(i(),I(N,{key:0},[s(n(O),null,{default:l(()=>[_(C(n(f).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),s(n(S),{vertical:"",gap:"16"},{default:l(()=>[s(ee,{loading:u.ecdsaKeyLoading,onClick:b},{default:l(()=>[_(C(n(f).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):V("",!0)],64)):V("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),hn=D({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{},isBeta:{type:Boolean}},setup(m){return(e,a)=>(i(),v(n(re),{class:Se({"connector-card":!0,unavailable:e.unavailable})},{default:l(()=>[s(n(S),{style:{width:"100%"},vertical:"",gap:12},{default:l(()=>[s(n(S),{justify:"space-between"},{default:l(()=>[s(n(ce),{src:e.logoUrl,shape:"square",size:"large"},null,8,["src"]),s(n(S),{gap:8},{default:l(()=>[e.isBeta?(i(),v(n(oe),{key:0,color:"orange",style:{height:"fit-content"}},{default:l(()=>[_("BETA")]),_:1})):V("",!0),e.unavailable?(i(),v(n(oe),{key:1,style:{height:"fit-content"}},{default:l(()=>[_(C(n(f).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):V("",!0)]),_:1})]),_:1}),s(n(S),{vertical:""},{default:l(()=>[s(n(z),{strong:""},{default:l(()=>[_(C(e.title),1)]),_:1}),s(n(z),{type:"secondary"},{default:l(()=>[_(C(e.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const yn=ie(hn,[["__scopeId","data-v-86187920"]]),fn=m=>(Ne("data-v-41fbcf6c"),m=m(),Ve(),m),mn=fn(()=>B("div",{style:{"flex-grow":"1"}},null,-1)),vn={class:"connectors-grid"},_n=D({__name:"ConnectorsView",setup(m){const a=Ae().params.projectId,t=new rn(a,new cn),r=P(null),y=P(!1),c=P({}),b=P(!1),$=x(()=>[...t.state.value.connectors.filter(p=>p.auth.type==="oauth2"),...t.state.value.connectors.filter(p=>p.auth.type==="tokens"),...t.state.value.connectors.filter(p=>p.auth.type==="ecdsa"),...t.state.value.connectors.filter(p=>p.auth.type==="manual")]),E=P(""),T=x(()=>{if(!E.value.trim())return $.value;const p=E.value.trim().toLowerCase();return $.value.filter(k=>{var A,F;const h=((A=k.metadata.label)==null?void 0:A.toLowerCase())||"",j=((F=k.metadata.key)==null?void 0:F.toLowerCase())||"";return h.includes(p)||j.includes(p)})}),u=x(()=>t.state.value.connections.filter(p=>p&&p.name&&p.connectorTitle&&p.connectorType));t.fetchInitialState();function d(p){t.state.value.addingConnection&&(t.state.value.addingConnection.tokenValues=p)}function g(p){c.value=p}function o(){r.value=null,y.value=!1,c.value={}}async function U(){y.value=!0;try{const k=(await t.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");r.value=k}finally{y.value=!1}}async function R(){var k,h,j;const p=(k=t.state.value.addingConnection)==null?void 0:k.connector.auth.type;b.value=!0;try{switch(p){case"oauth2":return await t.handleAddConnectionSubmit();case"tokens":return await t.handleAddTokenConnectionSubmit();case"ecdsa":{const A=((h=t.state.value.addingConnection)==null?void 0:h.tokenValues)||{},F=(j=t.state.value.addingConnection)==null?void 0:j.connector.metadata.key;let K="";F==="starkbank"?K=A.projectId||"":F==="iugu"&&(K=A.apiToken||"");const q=await t.handleAddEcdsaConnectionSubmit(r.value,K);return o(),q}default:break}}catch(A){const F=K=>{try{return JSON.parse(K),!0}catch{return!1}};if(A instanceof Error&&F(A.message)){const K=le.object({error:le.string()}).safeParse(JSON.parse(A.message));if(K.success){Y.error(K.data.error);return}else{Y.error(f.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:A instanceof Error?A.message:"Unknown error"}));return}}else Y.error(f.translate("i18n_connectorsview_failed_to_create"))}finally{b.value=!1}}function Z(p){p.auth.type==="manual"?Ke.showNewMessage(f.translate("i18n_connectors_ask_for_access",null,p.metadata.label)):t.showAddConfirmationModal(p)}return(p,k)=>(i(),I(N,null,[s(n(ze),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:l(()=>[s(n(S),{align:"center",justify:"space-between"},{default:l(()=>[s(n(Q),null,{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),s(n(O),null,{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_description"))+" ",1),s(pe)]),_:1}),u.value.length?(i(),v(n(S),{key:0,vertical:""},{default:l(()=>[s(n(Q),{level:2},{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_installed")),1)]),_:1}),s(n(S),{vertical:"",gap:10},{default:l(()=>[(i(!0),I(N,null,M(u.value,h=>(i(),v(n(re),{key:h.name},{default:l(()=>[s(n(S),{align:"center",gap:20},{default:l(()=>[s(n(ce),{src:h.icon,height:"40px",shape:"square"},null,8,["src"]),s(n(z),{strong:""},{default:l(()=>[_(C(h.connectorTitle),1)]),_:2},1024),mn,s(n(z),{content:h.name,copyable:"",code:""},null,8,["content"]),s(n(Ue),null,{overlay:l(()=>[s(n(je),null,{default:l(()=>[s(n(se),{onClick:j=>n(t).handleEditConnectionClick(h)},{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_rename")),1)]),_:2},1032,["onClick"]),s(n(se),{danger:"",onClick:j=>n(t).handleDeletionClick(h)},{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:l(()=>[s(n(Ee))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):V("",!0),s(n(S),{vertical:""},{default:l(()=>[u.value.length?(i(),v(n(Q),{key:0,level:2},{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_available")),1)]),_:1})):V("",!0),s(n($e),{value:E.value,"onUpdate:value":k[0]||(k[0]=h=>E.value=h),placeholder:n(f).translate("i18n_connectorsview_search_placeholder"),style:{width:"300px","margin-bottom":"40px"}},null,8,["value","placeholder"]),B("div",vn,[(i(!0),I(N,null,M(T.value,h=>{var j;return i(),v(yn,{key:h.metadata.key,title:h.metadata.label,"logo-url":h.metadata.logoUrl,description:h.metadata.description,unavailable:h.auth.type==="manual",connector:h,"is-beta":(j=n(t).state.value.betaStatus[h.metadata.key])!=null?j:!1,onClick:A=>Z(h)},null,8,["title","logo-url","description","unavailable","connector","is-beta","onClick"])}),128))])]),_:1})]),_:1}),s(n(J),{open:!!n(t).state.value.editingConnection,title:n(t).state.value.editingConnection?n(f).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:n(t).state.value.editingConnection.connectorTitle}):"",onCancel:k[3]||(k[3]=h=>n(t).state.value.editingConnection=null)},{footer:l(()=>[s(n(S),{justify:"end"},{default:l(()=>[s(ee,{disabled:!n(t).hasChanges.value,onClick:k[2]||(k[2]=h=>n(t).renameConnection())},{default:l(()=>[_(C(n(f).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:l(()=>[n(t).state.value.editingConnection?(i(),v(n(W),{key:0,value:n(t).state.value.editingConnection.newName,"onUpdate:value":k[1]||(k[1]=h=>n(t).state.value.editingConnection.newName=h)},null,8,["value"])):V("",!0)]),_:1},8,["open","title"]),s(gn,{"adding-connection":n(t).state.value.addingConnection,"ecdsa-public-key":r.value,"ecdsa-key-loading":y.value,"uploaded-files":c.value,loading:b.value,onCancel:k[4]||(k[4]=()=>{n(t).state.value.addingConnection=null,o()}),onSubmit:R,onScopeToggle:k[5]||(k[5]=(h,j)=>n(t).handleScopeToggle(h,j)),onGenerateEcdsaKey:U,"onUpdate:tokenValues":d,"onUpdate:uploadedFiles":g},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}});const Kn=ie(_n,[["__scopeId","data-v-41fbcf6c"]]);export{Kn as default};
//# sourceMappingURL=ConnectorsView.3e213486.js.map

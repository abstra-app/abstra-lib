import{N as re}from"./Navbar.0fac7202.js";import{a as N}from"./asyncComputed.45b928c1.js";import{m as le}from"./url.98d76cb4.js";import{d as ie,f as d,e as A,ea as se,o as l,Y as E,b as u,a as ue,u as a,c as s,w as r,by as D,aG as p,e9 as _,eP as i,df as ce,aB as P,cV as m,cW as z,aS as L,eb as T,S as f,cB as v,bL as R,eg as de,bT as pe,cA as _e,a0 as ve}from"./index.5c5b8754.js";import{A as ye}from"./apiKey.a58bc65c.js";import"./gateway.72a5f8e6.js";import{M as fe}from"./member.95755737.js";import{O as ge}from"./organization.63c5be85.js";import{P as me}from"./project.90e767bb.js";import"./tables.03e1f1df.js";import{F as ze}from"./folder.5b3ce5ac.js";import"./PhChats.vue.11dd4bcd.js";import"./PhSignOut.vue.4b4f4a26.js";import"./router.26bba6f6.js";import"./Badge.143b8423.js";import"./index.544c9f61.js";import"./Avatar.f5ca7790.js";import"./index.c6eff8b9.js";import"./index.8b9e04a5.js";import"./BookOutlined.159f676d.js";import"./popupNotifcation.de7c84b3.js";import"./record.efb550f2.js";import"./string.a8c51ad6.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[c]="de4b118c-7404-4d4a-b792-1eadba9daaa0",y._sentryDebugIdIdentifier="sentry-dbid-de4b118c-7404-4d4a-b792-1eadba9daaa0")}catch{}})();const je={class:"container"},we={class:"content"},S="NEW_ORGANIZATION_KEY",O="NEW_PROJECT_KEY",be=ie({__name:"EditorLogin",setup(y){const c=new ze,j=new ge,w=new me,U=new fe,{result:x,loading:W}=N(()=>j.list()),{result:Y,loading:b,refetch:G}=N(async()=>{const t=e.value;return t.type!=="selected-organization"?[]:w.list(t.organizationId)}),{result:M,loading:q,refetch:J}=N(async()=>e.value.type!=="selected-organization"?[]:c.list(e.value.organizationId)),F=d(()=>{var t,o;return(o=(t=x.value)==null?void 0:t.map(n=>({key:n.id,label:n.name})))!=null?o:[]}),C=d(()=>{var t,o;return(o=(t=Y.value)==null?void 0:t.map(n=>({key:n.id,label:n.name})))!=null?o:[]}),K=d(()=>{var t,o;return(o=(t=M.value)==null?void 0:t.map(n=>({value:n.id,label:n.name})))!=null?o:[]}),Z=d(()=>e.value.type==="initial"?!0:e.value.type==="new-organization"?!e.value.organizationName||!e.value.project.projectName:e.value.type==="selected-organization"&&e.value.project.type==="new"?!e.value.project.projectName||!e.value.project.folderId:e.value.type==="selected-organization"&&e.value.project.type==="initial"),I=async t=>await ye.create({projectId:t,name:"default"}),e=A({type:"initial"}),Q=d(()=>{if(e.value.type!=="initial")return e.value.type==="new-organization"?S:e.value.organizationId}),H=d(()=>e.value.type==="selected-organization"&&e.value.project.type==="new"?O:e.value.type==="selected-organization"&&e.value.project.type==="selected"?e.value.project.projectId:void 0),X=d(()=>{if(e.value.type==="selected-organization"&&e.value.project.type==="new")return e.value.project.folderId});function $(t){t||(e.value={type:"initial"}),t===S?e.value={type:"new-organization",organizationName:"",project:{type:"new",projectName:"",folderId:""}}:(e.value={type:"selected-organization",organizationId:String(t),project:{type:"initial"}},G()),J()}function ee(t){e.value.type==="selected-organization"&&(t||(e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"initial"}}),t===O?e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"new",projectName:"",folderId:""}}:e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"selected",projectId:String(t)}})}function ae(t){e.value.type!=="selected-organization"||e.value.project.type!=="new"||typeof t=="string"&&(e.value={...e.value,project:{...e.value.project,folderId:t}})}async function V(t){const o=await U.list(t);return(await c.list(t)).length===0&&await c.create({name:"Default Folder",organizationId:t,memberIds:[...o.map(oe=>oe.id)]}),(await c.list(t))[0]}const g=A(!1);async function te(){if(!g.value){g.value=!0;try{if(e.value.type==="initial")return;if(e.value.type==="new-organization"){const t=await j.create({name:e.value.organizationName}),o=await V(t.id),n=await w.create({name:e.value.project.projectName,organizationId:t.id,folderId:o.id}),h=await I(n.id);h.value&&k(h.value)}if(e.value.type==="selected-organization"&&e.value.project.type==="new"){const t=await V(e.value.organizationId),o=await w.create({name:e.value.project.projectName,organizationId:e.value.organizationId,folderId:t.id}),n=await I(o.id);n.value&&k(n.value)}if(e.value.type==="selected-organization"&&e.value.project.type==="selected"){const t=await I(e.value.project.projectId);t.value&&k(t.value)}}finally{g.value=!1}}}const B=se(),ne=A(null);async function k(t){if(B.query.redirect){const o=B.query.redirect;if(!o.match(/http:\/\/localhost:\d+/))throw new Error("Invalid redirect");const n=decodeURIComponent(o);location.href=le(n,{"api-key":t})}else ne.value=t}return(t,o)=>(l(),E("div",je,[u(re),ue("div",we,[a(W)||!a(x)?(l(),s(a(D),{key:0})):(l(),s(a(_e),{key:1,layout:"vertical",class:"card"},{default:r(()=>[u(a(ce),{level:3,style:{padding:"0px",margin:"0px","margin-bottom":"30px"}},{default:r(()=>[p(_(a(i).translate("i18n_create_or_choose_project")),1)]),_:1}),u(a(v),{label:a(i).translate("i18n_get_api_key_organization")},{default:r(()=>[u(a(P),{style:{width:"100%"},placeholder:a(i).translate("i18n_get_api_key_choose_organization"),size:"large",value:Q.value,"onUpdate:value":$},{default:r(()=>[u(a(m),{label:a(i).translate("i18n_get_api_key_new_organization")},{default:r(()=>[(l(),s(a(z),{key:S},{default:r(()=>[p(_(a(i).translate("i18n_get_api_key_create_new_organization")),1)]),_:1}))]),_:1},8,["label"]),F.value.length>0?(l(),s(a(m),{key:0,label:a(i).translate("i18n_get_api_key_existing_organizations")},{default:r(()=>[(l(!0),E(L,null,T(F.value,n=>(l(),s(a(z),{key:n.key},{default:r(()=>[p(_(n.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):f("",!0)]),_:1},8,["placeholder","value"])]),_:1},8,["label"]),e.value.type=="new-organization"?(l(),s(a(v),{key:0,label:a(i).translate("i18n_get_api_key_organization_name")},{default:r(()=>[u(a(R),{value:e.value.organizationName,"onUpdate:value":o[0]||(o[0]=n=>e.value.organizationName=n),placeholder:a(i).translate("i18n_get_api_key_choose_organization_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):(l(),s(a(v),{key:1,label:a(i).translate("i18n_get_api_key_project")},{default:r(()=>[u(a(P),{style:{width:"100%"},disabled:e.value.type!="selected-organization",placeholder:a(i).translate("i18n_get_api_key_choose_project"),size:"large",value:H.value,"onUpdate:value":ee},de({default:r(()=>[a(b)?f("",!0):(l(),s(a(m),{key:0,label:a(i).translate("i18n_get_api_key_new_project")},{default:r(()=>[(l(),s(a(z),{key:O},{default:r(()=>[p(_(a(i).translate("i18n_get_api_key_create_new_project")),1)]),_:1}))]),_:1},8,["label"])),C.value.length>0&&!a(b)?(l(),s(a(m),{key:1,label:a(i).translate("i18n_get_api_key_existing_projects")},{default:r(()=>[(l(!0),E(L,null,T(C.value,n=>(l(),s(a(z),{key:n.key},{default:r(()=>[p(_(n.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):f("",!0)]),_:2},[a(b)?{name:"notFoundContent",fn:r(()=>[u(a(D),{size:"small"})]),key:"0"}:void 0]),1032,["disabled","placeholder","value"])]),_:1},8,["label"])),(e.value.type=="new-organization"||e.value.type=="selected-organization")&&e.value.project.type=="new"?(l(),s(a(v),{key:2,label:"Project name"},{default:r(()=>[u(a(R),{value:e.value.project.projectName,"onUpdate:value":o[1]||(o[1]=n=>e.value.project.projectName=n),placeholder:a(i).translate("i18n_get_api_key_choose_project_name"),size:"large"},null,8,["value","placeholder"])]),_:1})):f("",!0),(e.value.type=="new-organization"||e.value.type=="selected-organization")&&e.value.project.type=="new"&&K.value.length>0?(l(),s(a(v),{key:3,label:"Select folder"},{default:r(()=>[u(a(P),{value:X.value,options:K.value,loading:a(q),size:"large","onUpdate:value":ae},null,8,["value","options","loading"])]),_:1})):f("",!0),u(a(v),{style:{"margin-top":"40px"}},{default:r(()=>[u(a(pe),{type:"primary",disabled:Z.value,loading:g.value,style:{width:"100%"},onClick:te},{default:r(()=>[p(_(a(i).translate("i18n_login_with_this_project")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))])]))}});const Me=ve(be,[["__scopeId","data-v-439384bd"]]);export{Me as default};
//# sourceMappingURL=EditorLogin.bd7670f4.js.map

import{d as k,eY as o,H as S,G as g,b as c,ev as l,e as t,eD as r,u as d,b6 as T,eS as $,f1 as x,ex as y,eE as A,eF as P,v as b,ar as B,o as D,f as m}from"./outputWidgets.108432da.js";import{u as w,S as C}from"./index.dc3329a0.js";import{J as E}from"./icons.9db31d3d.js";import{L as I}from"./CircularLoading.052ac0ae.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="3970adee-dcd7-4ada-8cf3-405da07e8b24",s._sentryDebugIdIdentifier="sentry-dbid-3970adee-dcd7-4ada-8cf3-405da07e8b24")}catch{}})();class N{async authenticate(n){try{const e=await fetch("/_auth/authenticate",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:n})});if(!e.ok)throw new Error(await e.text());return null}catch(e){return e.message}}async verify(n,e){const _=await fetch("/_auth/verify",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({email:n,token:e})});if(!_.ok)return null;const h=await _.json();return w.saveJWT(h.jwt),w.getUser()}}const V=s=>(A("data-v-6f44f486"),s=s(),P(),s),K={class:"auth-info"},M={class:"auth-header"},j={class:"auth-label"},J={class:"description"},O=["onKeyup"],U={key:0,class:"span-error"},L=V(()=>t("div",{class:"spacer"},null,-1)),R=k({__name:"AuthInfo",props:{invalid:{type:Boolean}},emits:["sendAuthInfo"],setup(s,{emit:n}){const e=s,_={description:o.translate("i18n_local_auth_info_description"),button:o.translate("i18n_local_auth_info_authenticate")},h={description:o.translate("i18n_auth_info_description"),button:o.translate("i18n_auth_info_send_code")},f=S(()=>{var a;return(a=C.instance)!=null&&a.isLocal?_:h}),u=g({email:""}),i=()=>{n("sendAuthInfo",u)};return(a,p)=>(c(),l("div",K,[t("div",M,[t("div",j,r(d(o).translate("i18n_auth_validate_your_email")),1),t("div",J,r(f.value.description),1)]),T(t("input",{"onUpdate:modelValue":p[0]||(p[0]=v=>u.email=v),type:"email",placeholder:"Email address",class:"input email-input",onKeyup:x(i,["enter"])},null,40,O),[[$,u.email]]),e.invalid?(c(),l("span",U,r(d(o).translate("i18n_auth_info_invalid_email")),1)):y("",!0),L,t("button",{class:"next-button",onClick:i},r(f.value.button),1)]))}});const F=b(R,[["__scopeId","data-v-6f44f486"]]),G=s=>(A("data-v-5cb011c0"),s=s(),P(),s),H={class:"auth-token"},W={class:"auth-label"},Y=["onKeyup"],q={key:0,class:"span-error"},z={key:1,class:"span-error"},Q=G(()=>t("div",{class:"spacer"},null,-1)),X={class:"button-icon",viewBox:"0 0 24 24"},Z=["d"],ee={class:"footer"},te=k({__name:"AuthToken",props:{email:{},invalid:{type:Boolean},expired:{type:Boolean}},emits:["sendToken","restartAuth","resendToken"],setup(s,{emit:n}){const e=g({token:""}),_=()=>{n("restartAuth")},h=()=>{n("resendToken")},f=()=>{n("sendToken",e.token)};return(u,i)=>(c(),l("div",H,[t("div",W,r(d(o).translate("i18n_auth_token_label",{email:u.email})),1),T(t("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>e.token=a),type:"text",placeholder:"Type your verification code",class:"input",onKeyup:x(f,["enter"])},null,40,Y),[[$,e.token]]),u.expired?(c(),l("span",q,r(d(o).translate("i18n_auth_token_expired")),1)):y("",!0),u.invalid?(c(),l("span",z,r(d(o).translate("i18n_auth_token_invalid")),1)):y("",!0),Q,t("button",{class:"next-button",onClick:f},r(d(o).translate("i18n_auth_token_verify_email")),1),t("button",{class:"secondary-button back",onClick:_},[(c(),l("svg",X,[t("path",{d:d(E)},null,8,Z)])),B(" "+r(d(o).translate("i18n_auth_token_try_again")),1)]),t("button",{class:"secondary-button back",onClick:h},r(d(o).translate("i18n_auth_token_resend_email")),1),t("div",ee,r(d(o).translate("i18n_auth_token_footer_alternative_email")),1)]))}});const se=b(te,[["__scopeId","data-v-5cb011c0"]]),ne={key:0,class:"form"},oe={class:"form-wrapper"},ae={class:"loading"},ie={key:1,class:"form"},re={class:"form-wrapper"},de={class:"widget"},ce={key:2,class:"form"},le={class:"form-wrapper"},_e={class:"widget"},ue={key:3,class:"form"},pe={class:"form-wrapper"},he={class:"loading"},fe=k({__name:"Passwordless",emits:["done"],setup(s,{emit:n}){const e=g({stage:"collect-info",userProvider:null,invalid:!1,token:null,info:null});D(()=>{e.userProvider=new N});const _=async i=>{if(!e.userProvider)return;e.info=i,e.stage="loading";const a=await e.userProvider.authenticate(i.email);e.invalid=!!a,a?e.stage="collect-info":e.stage="collect-token"},h=async i=>{var a;if(!(!e.userProvider||!((a=e.info)!=null&&a.email))){e.token=i,e.stage="loading";try{const p=await e.userProvider.verify(e.info.email,e.token);if(!p)throw new Error("no user");n("done",p),e.stage="done"}catch{e.invalid=!0,e.stage="collect-token"}}},f=()=>{e.info&&_(e.info)},u=()=>{e.stage="collect-info",e.info=null,e.token=null,e.invalid=!1};return(i,a)=>{var p,v;return e.userProvider?e.stage==="collect-info"?(c(),l("div",ie,[t("div",re,[t("div",de,[m(F,{invalid:e.invalid,onSendAuthInfo:_},null,8,["invalid"])])])])):e.stage==="collect-token"?(c(),l("div",ce,[t("div",le,[t("div",_e,[m(se,{invalid:e.invalid,email:(v=(p=e.info)==null?void 0:p.email)!=null?v:"",onSendToken:h,onResendToken:f,onRestartAuth:u},null,8,["invalid","email"])])])])):(c(),l("div",ue,[t("div",pe,[t("div",he,[m(I)])])])):(c(),l("div",ne,[t("div",oe,[t("div",ae,[m(I)])])]))}}});const ge=b(fe,[["__scopeId","data-v-d468d037"]]);export{ge as P};
//# sourceMappingURL=Passwordless.f5753ca0.js.map

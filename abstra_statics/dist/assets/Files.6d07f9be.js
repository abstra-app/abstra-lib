import{_ as ge}from"./DocsButton.vue_vue_type_script_setup_true_lang.836e8f5e.js";import{f as c,e7 as T,f3 as ye,d as re,r as I,ae as V,w as L,c as S,o as p,a5 as k,e as w,b as u,u as o,aR as be,ec as _e,a as g,ed as z,de as $,g as C,ct as Y,h as j,cD as we,bM as Z,ef as Oe,ej as Ce,cx as Pe,bO as Ie,bJ as je,M as Se,D as x,_ as le,eb as ze,A as $e,d9 as xe}from"./jwt-decode.esm.1b301f74.js";import{h as O,e as Fe,d as ke,p as Ae}from"./router.99a53337.js";import{a as De}from"./asyncComputed.92146382.js";import{f as K}from"./string.4796d44a.js";import{a as Ue,I as He,_ as Me}from"./ScrollArea.vue_vue_type_script_setup_true_lang.21ea9f38.js";import{a as Ve,G as Le}from"./PhFolderPlus.vue.65855487.js";import{_ as F}from"./AbstraButton.vue_vue_type_script_setup_true_lang.e74c1d9b.js";import{B as Te,A as ee}from"./Breadcrumb.21c760be.js";import{U as Ee}from"./UploadOutlined.3828d031.js";import"./tables.13d62f0c.js";import{C as Re}from"./Card.714646f7.js";import"./constants.f352d89b.js";import"./index.8ea8b90b.js";import"./record.b96b0275.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="f0ee9f70-a91b-454d-8574-378f7e0092e8",s._sentryDebugIdIdentifier="sentry-dbid-f0ee9f70-a91b-454d-8574-378f7e0092e8")}catch{}})();var Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M484 443.1V528h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H484v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V584h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H540v-84.9c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1zm396-144.7H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder-add",theme:"outlined"};const Ne=Be;var Ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"};const qe=Ge;function te(s){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),i.forEach(function(l){Je(s,l,n[l])})}return s}function Je(s,e,n){return e in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}var E=function(e,n){var i=te({},e,n.attrs);return c(T,te({},i,{icon:ye}),null)};E.displayName="DeleteOutlined";E.inheritAttrs=!1;const Qe=E;function ae(s){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),i.forEach(function(l){We(s,l,n[l])})}return s}function We(s,e,n){return e in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}var R=function(e,n){var i=ae({},e,n.attrs);return c(T,ae({},i,{icon:Ne}),null)};R.displayName="FolderAddOutlined";R.inheritAttrs=!1;const Xe=R;function ne(s){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),i.forEach(function(l){Ye(s,l,n[l])})}return s}function Ye(s,e,n){return e in s?Object.defineProperty(s,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[e]=n,s}var B=function(e,n){var i=ne({},e,n.attrs);return c(T,ne({},i,{icon:qe}),null)};B.displayName="HomeOutlined";B.inheritAttrs=!1;const Ze=B;class N{constructor(e){this.projectId=e}static fromProjectId(e){return new N(e)}async list(e,n,i,l){const m=new URLSearchParams;m.set("limit",e.toString()),m.set("offset",n.toString()),i&&i.trim()&&m.set("search",i.trim()),l&&l.trim()&&m.set("path",l.trim());const A=m.toString(),d=`projects/${this.projectId}/files?${A}`,f=await O.get(d);return{items:f.items,totalCount:f.totalCount}}async upload(e,n){const i={"Content-Type":"multipart/form-data"},l=new File([n||new Uint8Array],Ue(e));return O.post(`projects/${this.projectId}/files/upload?path=${encodeURIComponent(e)}`,l,i)}async download(e){return O.getBlob(`projects/${this.projectId}/files/download?path=${encodeURIComponent(e)}`)}async delete(e){return O.delete(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}`)}async move(e,n){return O.patch(`projects/${this.projectId}/files?path=${encodeURIComponent(e)}&newPath=${encodeURIComponent(n)}`,{})}async createFolder(e){return O.post(`projects/${this.projectId}/files/create-folder`,{path:e})}}const Ke={class:"files-navigator"},et={class:"header-container",style:{"margin-bottom":"8px"}},tt=["onClick"],at={class:"list-header"},nt=["onClick"],rt={class:"file-name"},lt={key:2,class:"file-size"},ot=re({__name:"FilesNavigator",props:{filesModel:{}},setup(s){const e=s,n=I(!1),i=I(""),l=I(new Set),m=I(!1),A=a=>{if(!y.searchTerm.trim())return x("span",a);const t=K(y.searchTerm,a);return t?x("span",a.split("").map((r,h)=>t.includes(h)?x("span",{class:"char-match"},r):r)):x("span",a)},d=V({currentIndex:1,pageSize:20,totalCount:0}),f=V({currentPath:"",breadcrumbs:[]}),y=V({searchTerm:"",isSearching:!1}),{loading:D,result:P,refetch:_}=De(async()=>{const a=await e.filesModel.list(d.pageSize,(d.currentIndex-1)*d.pageSize,y.searchTerm||void 0,f.currentPath||void 0);return d.totalCount=a.totalCount,a});L([()=>d.currentIndex,()=>d.pageSize],()=>{_()}),L(()=>y.searchTerm,()=>{console.log("Search term changed:",y.searchTerm),d.currentIndex=1,_()}),L(()=>f.currentPath,()=>{_()});const U=S(()=>P.value?P.value.items:[]);async function oe(a,t){const r=a.join("/");await e.filesModel.upload(r,t),await _()}async function G(a){a.forEach(async t=>{const r=await e.filesModel.download(t),h=URL.createObjectURL(r),b=document.createElement("a");b.href=h,b.download=t.split("/").pop()||"download",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(h)})}function H(a){f.currentPath=a,f.breadcrumbs=a?a.split("/").filter(t=>t.length>0):[],d.currentIndex=1,_()}async function se(a){for(const t of a)await e.filesModel.delete(t.path);l.value.clear(),await _()}const ie=a=>a.type==="directory"?"":a.type==="file"?a.sizeHuman:"",v=S(()=>U.value?y.searchTerm.trim()?U.value.filter(a=>K(y.searchTerm,a.name)):U.value:[]),ce=S(()=>v.value?v.value.filter(a=>l.value.has(a.path)):[]);function ue(a){a.type==="directory"?(l.value.clear(),m.value=!1,H(a.path)):G([a.path])}const q=I(!1);function de(a){if(a&&a.type==="file")return;const t=document.createElement("input");t.type="file",t.onchange=async()=>{var b,Q,W;const r=(b=t.files)==null?void 0:b[0],h=await(r==null?void 0:r.arrayBuffer());if(!!r)try{q.value=!0;const X=(Q=a==null?void 0:a.path.split("/").filter(M=>M.length>0))!=null?Q:f.currentPath?f.currentPath.split("/").filter(M=>M.length>0):[];await oe([...X,(W=r.name)!=null?W:"Untitled file"],h?new Uint8Array(h):void 0),await _()}catch{Ae("Failed to upload file","File already exists")}finally{q.value=!1}},t.click()}const fe=S(()=>`Search files in ${f.currentPath?`/${f.currentPath}`:"/"}`);function pe(a){const t=a.path;l.value.has(t)?l.value.delete(t):l.value.add(t),he()}function me(){var a;m.value?l.value.clear():(a=v.value)==null||a.forEach(t=>{l.value.add(t.path)}),m.value=!m.value}function he(){var r;const a=((r=v.value)==null?void 0:r.length)||0,t=l.value.size;m.value=a>0&&t===a}function ve(){i.value="",n.value=!0}async function J(){if(i.value.trim()){const a=f.currentPath,t=i.value,r=a?`${a}/${t}`:t;await e.filesModel.createFolder(r),await _(),n.value=!1,i.value=""}}return(a,t)=>(p(),k("div",Ke,[w("div",et,[c(o($),{justify:"space-between",align:"center",gap:"small"},{default:u(()=>[c(o(Te),null,{default:u(()=>[c(o(ee),null,{default:u(()=>[w("a",{onClick:t[0]||(t[0]=r=>H(""))},[c(o(Ze))])]),_:1}),(p(!0),k(be,null,_e(f.breadcrumbs,(r,h)=>(p(),g(o(ee),{key:h},{default:u(()=>[w("a",{onClick:b=>H(f.breadcrumbs.slice(0,h+1).join("/"))},z(r),9,tt)]),_:2},1024))),128))]),_:1}),c(o($),{gap:"small"},{default:u(()=>[o(D)?j("",!0):(p(),g(o(Y),{key:0},{default:u(()=>[c(F,{size:"small",onClick:t[1]||(t[1]=()=>de())},{default:u(()=>[c(o(Ee)),C(" Upload File ")]),_:1}),c(F,{size:"small",onClick:t[2]||(t[2]=()=>ve())},{default:u(()=>[c(o(Xe)),C(" New Folder ")]),_:1})]),_:1})),l.value.size>0?(p(),g(o(Y),{key:1},{default:u(()=>[c(F,{size:"small",onClick:t[3]||(t[3]=()=>G(Array.from(l.value)))},{default:u(()=>[c(o(Ve),{size:"18"}),C(" Download ("+z(l.value.size)+") ",1)]),_:1}),c(F,{size:"small",danger:"",onClick:t[4]||(t[4]=()=>se(ce.value))},{default:u(()=>[c(o(Qe)),C(" Delete ("+z(l.value.size)+") ",1)]),_:1})]),_:1})):j("",!0)]),_:1})]),_:1})]),c(Me,{class:"scroll-area","outer-style":{flexGrow:"1"}},{default:u(()=>[w("div",at,[c(o($),{justify:"space-between",align:"center",gap:"small",style:{"margin-bottom":"8px"}},{default:u(()=>[c(o(we),{value:y.searchTerm,"onUpdate:value":t[5]||(t[5]=r=>y.searchTerm=r),loading:o(D),placeholder:fe.value,style:{"max-width":"300px"},size:"small"},null,8,["value","loading","placeholder"]),v.value&&v.value.length>0?(p(),g(o(Z),{key:0,checked:m.value,indeterminate:l.value.size>0&&l.value.size<v.value.length,class:"select-all-checkbox",onChange:me},null,8,["checked","indeterminate"])):j("",!0)]),_:1})]),v.value&&v.value.length>0?(p(),g(o(ke),{key:0,class:"files-list","data-source":v.value},{renderItem:u(({item:r})=>[c(o(Fe),{class:"compact-list-item"},{default:u(()=>[c(o($),{align:"center",justify:"space-between",style:{width:"100%"}},{default:u(()=>[w("div",{style:{display:"flex","align-items":"center",gap:"8px",flex:"1",cursor:"pointer","min-width":"0"},onClick:h=>ue(r)},[r.type==="directory"?(p(),g(o(Le),{key:0,size:"18px"})):(p(),g(o(He),{key:1,size:"18px"})),w("span",rt,[(p(),g(Oe(A(r.name))))]),r.type==="file"?(p(),k("span",lt,z(ie(r)),1)):j("",!0)],8,nt),c(o(Z),{checked:l.value.has(r.path),onChange:()=>pe(r),onClick:t[6]||(t[6]=Ce(()=>{},["stop"]))},null,8,["checked","onChange"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])):(p(),g(o(Pe),{key:1,description:o(D)?"Loading...":"No files"},null,8,["description"]))]),_:1}),o(P)&&o(P).totalCount>d.pageSize?(p(),g(o(Ie),{key:0,current:d.currentIndex,"onUpdate:current":t[7]||(t[7]=r=>d.currentIndex=r),"page-size":d.pageSize,"onUpdate:pageSize":t[8]||(t[8]=r=>d.pageSize=r),total:o(P).totalCount,"show-total":r=>`${r} items`,"show-size-changer":"","page-size-options":["10","20","50","100"],style:{"margin-top":"20px","text-align":"center"}},null,8,["current","page-size","total","show-total"])):j("",!0),c(o(Se),{open:n.value,"onUpdate:open":t[10]||(t[10]=r=>n.value=r),title:"Create Folder",onOk:J,onCancel:t[11]||(t[11]=r=>n.value=!1)},{default:u(()=>[c(o(je),{value:i.value,"onUpdate:value":t[9]||(t[9]=r=>i.value=r),placeholder:"Enter folder name",onPressEnter:J},null,8,["value"])]),_:1},8,["open"])]))}});const st=le(ot,[["__scopeId","data-v-2be8fa34"]]),it={class:"files-container"},ct=re({__name:"Files",setup(s){const n=ze().params.projectId,i=N.fromProjectId(n);return(l,m)=>(p(),k("div",it,[c(o($e),null,{default:u(()=>[C("Files")]),_:1}),c(o(xe),null,{default:u(()=>[C(" Manage files located in your project's persistent directory "),c(ge,{path:"tools/files"})]),_:1}),c(o(Re),{class:"files-card"},{default:u(()=>[c(st,{"files-model":o(i)},null,8,["files-model"])]),_:1})]))}});const It=le(ct,[["__scopeId","data-v-d42eb84d"]]);export{It as default};
//# sourceMappingURL=Files.6d07f9be.js.map

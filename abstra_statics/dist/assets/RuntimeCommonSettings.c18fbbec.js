var ee=Object.defineProperty;var te=(d,t,a)=>t in d?ee(d,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[t]=a;var B=(d,t,a)=>(te(d,typeof t!="symbol"?t+"":t,a),a);import{d as $,af as O,g as V,o as r,K as f,O as H,F as _,e5 as ae,a as h,Q as N,c as w,w as c,b as u,u as s,az as P,da as C,ec as R,aP as W,e4 as K,f as S,h as G,am as D,J as q,aj as se,a8 as Q,N as oe,ea as ne,eb as z,aL as Y,dA as re,aT as le,aU as ie,ed as ue,bE as ce,a6 as de,cs as pe}from"./index.e58852ef.js";import{B as me}from"./BaseLayout.03f31219.js";import{S as ve}from"./SaveButton.28439bf7.js";import{u as ge}from"./omniChatStore.93044769.js";import{S as fe,L as he,a as ye,b as X}from"./OmniChat.0e54f2a2.js";import{N as _e,_ as be}from"./Navbar.12906dac.js";import{S as ke}from"./SourceCode.52bed744.js";import{T as we}from"./TasksManager.67c9550c.js";import{G as F}from"./PhCaretRight.vue.4416f226.js";import{B as Se}from"./Badge.a8022ff6.js";import"./Card.3163d835.js";import{T as J,A}from"./TabPane.06e2a57c.js";import"./linters.d966844e.js";import{H as Te,J as He,S as Ce}from"./scripts.415093c2.js";import{n as $e}from"./validations.e91eae8c.js";import{u as Me}from"./editor.b31c8073.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[t]="479c4d7a-9655-42f8-be64-9738eaee92b5",d._sentryDebugIdIdentifier="sentry-dbid-479c4d7a-9655-42f8-be64-9738eaee92b5")}catch{}})();const Le=["width","height","fill","transform"],Ae={key:0},Ve=h("path",{d:"M72.5,150.63,100.79,128,72.5,105.37a12,12,0,1,1,15-18.74l40,32a12,12,0,0,1,0,18.74l-40,32a12,12,0,0,1-15-18.74ZM144,172h32a12,12,0,0,0,0-24H144a12,12,0,0,0,0,24ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},null,-1),Ie=[Ve],Ze={key:1},Ee=h("path",{d:"M224,56V200a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V56a8,8,0,0,1,8-8H216A8,8,0,0,1,224,56Z",opacity:"0.2"},null,-1),Be=h("path",{d:"M128,128a8,8,0,0,1-3,6.25l-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32A8,8,0,0,1,128,128Zm48,24H136a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm56-96V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56ZM216,200V56H40V200H216Z"},null,-1),Oe=[Ee,Be],ze={key:2},Ne=h("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm-91,94.25-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32a8,8,0,0,1,0,12.5ZM176,168H136a8,8,0,0,1,0-16h40a8,8,0,0,1,0,16Z"},null,-1),Pe=[Ne],Re={key:3},Ue=h("path",{d:"M126,128a6,6,0,0,1-2.25,4.69l-40,32a6,6,0,0,1-7.5-9.38L110.4,128,76.25,100.69a6,6,0,1,1,7.5-9.38l40,32A6,6,0,0,1,126,128Zm50,26H136a6,6,0,0,0,0,12h40a6,6,0,0,0,0-12Zm54-98V200a14,14,0,0,1-14,14H40a14,14,0,0,1-14-14V56A14,14,0,0,1,40,42H216A14,14,0,0,1,230,56Zm-12,0a2,2,0,0,0-2-2H40a2,2,0,0,0-2,2V200a2,2,0,0,0,2,2H216a2,2,0,0,0,2-2Z"},null,-1),je=[Ue],De={key:4},Fe=h("path",{d:"M128,128a8,8,0,0,1-3,6.25l-40,32a8,8,0,1,1-10-12.5L107.19,128,75,102.25a8,8,0,1,1,10-12.5l40,32A8,8,0,0,1,128,128Zm48,24H136a8,8,0,0,0,0,16h40a8,8,0,0,0,0-16Zm56-96V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56ZM216,200V56H40V200H216Z"},null,-1),Je=[Fe],We={key:5},Ke=h("path",{d:"M122.5,124.88a4,4,0,0,1,0,6.24l-40,32a4,4,0,0,1-5-6.24L113.6,128,77.5,99.12a4,4,0,0,1,5-6.24ZM176,156H136a4,4,0,0,0,0,8h40a4,4,0,0,0,0-8ZM228,56V200a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V56A12,12,0,0,1,40,44H216A12,12,0,0,1,228,56Zm-8,0a4,4,0,0,0-4-4H40a4,4,0,0,0-4,4V200a4,4,0,0,0,4,4H216a4,4,0,0,0,4-4Z"},null,-1),Ge=[Ke],qe={name:"PhTerminalWindow"},Qe=$({...qe,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(d){const t=d,a=O("weight","regular"),m=O("size","1em"),o=O("color","currentColor"),p=O("mirrored",!1),l=V(()=>{var i;return(i=t.weight)!=null?i:a}),v=V(()=>{var i;return(i=t.size)!=null?i:m}),b=V(()=>{var i;return(i=t.color)!=null?i:o}),y=V(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:p?"scale(-1, 1)":void 0);return(i,I)=>(r(),f("svg",ae({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:v.value,height:v.value,fill:b.value,transform:y.value},i.$attrs),[H(i.$slots,"default"),l.value==="bold"?(r(),f("g",Ae,Ie)):l.value==="duotone"?(r(),f("g",Ze,Oe)):l.value==="fill"?(r(),f("g",ze,Pe)):l.value==="light"?(r(),f("g",Re,je)):l.value==="regular"?(r(),f("g",De,Je)):l.value==="thin"?(r(),f("g",We,Ge)):_("",!0)],16,Le))}}),Ye={class:"editor-layout"},Xe={class:"layout-left"},xe={class:"layout-center"},et={class:"layout-right"},tt=$({__name:"EditorLayout",props:{fullWidth:{type:Boolean}},setup(d){return(t,a)=>(r(),f("div",Ye,[h("section",Xe,[H(t.$slots,"left",{},void 0,!0)]),h("section",xe,[H(t.$slots,"center",{},void 0,!0)]),h("section",et,[H(t.$slots,"right",{},void 0,!0)])]))}});const at=N(tt,[["__scopeId","data-v-ea35460f"]]);class x{constructor(t,a){B(this,"ws",null);B(this,"selfClosed",!1);B(this,"reconnectInterval");this.onMessage=t,this.stageId=a}get url(){return"/_editor/api/stdio/listen"}handleMessage(t){const a=JSON.parse(t.data);a.stage_id===this.stageId&&this.onMessage(a)}handleClose(t){this.selfClosed||this.reconnectInterval||(this.reconnectInterval=setInterval(()=>this.reset(),2e3))}clearReconnectInterval(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=void 0)}async close(){if(!!this.ws){this.selfClosed=!0;try{this.ws.close()}catch{console.warn("already closed")}this.ws=null}}async reset(){await this.close(),await this.connect()}async connect(){return await new Promise(t=>{this.ws=new WebSocket(this.url),this.ws.onopen=()=>t(),this.ws.onclose=a=>this.handleClose(a),this.ws.onmessage=a=>this.handleMessage(a),this.selfClosed=!1,this.clearReconnectInterval()})}}const st={class:"toggle-button"},ot=$({__name:"TerminalOutputHeader",props:{controller:{},open:{type:Boolean}},emits:["toggle-console"],setup(d,{emit:t}){return(a,m)=>(r(),w(s(C),{class:"header",justify:"space-between"},{default:c(()=>[u(s(C),{align:"center",gap:"middle"},{default:c(()=>[u(s(Qe),{size:"20"}),P(" Terminal Output ")]),_:1}),u(s(W),{placement:"left","mouse-enter-delay":.5,title:a.open?"Hide Smart Console":"Show Smart Console"},{default:c(()=>{var o,p,l;return[h("div",st,[((o=a.controller)==null?void 0:o.badgeState.type)==="unseen"?(r(),w(s(Se),{key:0,count:(p=a.controller)==null?void 0:p.badgeState.count,"number-style":{backgroundColor:((l=a.controller)==null?void 0:l.badgeState.severity)==="error"?"#e03636":"#606060"}},{default:c(()=>[u(s(F),{class:R(["icon",{open:a.open}]),onClick:m[0]||(m[0]=v=>t("toggle-console"))},null,8,["class"])]),_:1},8,["count","number-style"])):(r(),w(s(F),{key:1,class:R(["icon",{open:a.open}]),onClick:m[1]||(m[1]=v=>t("toggle-console"))},null,8,["class"]))])]}),_:1},8,["title"])]),_:1}))}});const nt=N(ot,[["__scopeId","data-v-e08ca106"]]),rt={key:0,class:"entry ai-output"},lt={key:0,class:"local-entry"},it=$({__name:"TerminalOutput",props:{workspace:{},stage:{}},setup(d,{expose:t}){const a=d,m=K(),o=S(null),p=S(!1),l=S(200),v=S(!1),b=X.create(),y=new x(g=>b.log(g),a.stage.id),i=new fe(new he,b,a.stage.id,{origin:"editor"}),I=V(()=>({height:`${l.value}px`})),T=S(!0);async function Z(){var g;if(p.value=!p.value,p.value){if(i.setSeen(),await D(),!o.value)return;o.value.addEventListener("wheel",M),T.value&&(o.value.scrollTop=(g=o.value)==null?void 0:g.scrollHeight)}else{if(!o.value)return;o.value.removeEventListener("wheel",M)}}const M=()=>{if(!o.value)return;const{scrollTop:g,scrollHeight:e,clientHeight:n}=o.value;g+n>=e?T.value=!0:T.value=!1};G(m,()=>b.clear()),t({closeTerminal:()=>p.value=!1,fixJson:async(g,e)=>{p.value=!0,await i.fixJson(g,e)}}),b.listen(async g=>{p.value||i.setUnseen(g),g.type!=="restart"&&(await D(),!!o.value&&T.value&&(o.value.scrollTop=o.value.scrollHeight))});const L=g=>{!v.value||(l.value=document.body.clientHeight-g.clientY)},E=()=>v.value=!1;return q(async()=>{document.addEventListener("mousemove",L),document.addEventListener("mouseup",E),await y.connect()}),se(async()=>{o.value&&o.value.removeEventListener("wheel",M)}),Q(async()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",E),await y.close()}),(g,e)=>(r(),w(s(C),{vertical:""},{default:c(()=>[u(nt,{controller:s(i),open:p.value,onToggleConsole:Z},null,8,["controller","open"]),p.value?(r(),w(s(C),{key:0,class:"terminal",style:oe(I.value),vertical:""},{default:c(()=>[h("div",{class:"resize-handler",onMousedown:e[0]||(e[0]=n=>v.value=!0)},null,32),u(s(C),{class:"cli"},{default:c(()=>[u(s(C),{class:"left",vertical:""},{default:c(()=>[h("div",{ref_key:"entriesContainer",ref:o,class:"entries"},[s(b).logs.length===0?(r(),f("div",rt," The output and errors generated by your code will be printed here. ")):_("",!0),(r(!0),f(Y,null,ne(s(b).logs,(n,k)=>(r(),f("div",{key:k,class:R([n.type,"entry"])},[n.type==="stdout"||n.type==="stderr"||n.type==="restart"?(r(),f("div",lt,z(n.type==="restart"?"-- restarted --":n.log),1)):_("",!0)],2))),128))],512)]),_:1}),u(s(C),{class:"right",vertical:"",justify:"space-between",align:"center"},{default:c(()=>[u(s(W),{placement:"left",title:"Start new conversation"},{default:c(()=>[u(s(ye),{size:20,class:"broom-icon",onClick:e[1]||(e[1]=n=>s(i).clearLogService())})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])):_("",!0)]),_:1}))}});const ut=N(it,[["__scopeId","data-v-edd3b7c0"]]),At=$({__name:"Editor",props:{workspace:{},stage:{},stageType:{},testTabName:{},extraTab:{},docsPath:{}},emits:["refetch-tasks","on-save"],setup(d,{expose:t,emit:a}){const m=d,o=K(),p=S(null),l=S(null),v=ge(),b=e=>{m.stage.file=e},y=S("source-code"),i=S("test");function I(){var n;const e=m.stage.codeContent;(n=p.value)==null||n.updateLocalEditorCode(e)}const T=X.create(),Z=new x(e=>T.log(e),o.params.id);let M;re(()=>{M=v.isOpen,v.open()}),q(()=>{Z.connect()}),Q(()=>{v.isOpen=M,Z.close()});const L=e=>e!==y.value&&m.stage.hasChanges(),E=()=>{i.value="test"},g=()=>{var e;(e=l.value)==null||e.closeTerminal()};return G(()=>m.stage.title,e=>{if(e){const n=m.stageType==="scripts"?"Tasklet":m.stageType.charAt(0).toUpperCase()+m.stageType.slice(1,-1);document.title=`${e} - ${n}`}},{immediate:!0}),t({code:p,logService:T,goToTestTab:E,closeTerminal:g}),(e,n)=>(r(),w(me,null,{navbar:c(()=>[u(_e,{"page-title":e.stage.title},null,8,["page-title"])]),content:c(()=>[u(at,null,{left:c(()=>{var k,U;return[u(s(J),{"active-key":y.value,"onUpdate:activeKey":n[0]||(n[0]=j=>y.value=j)},{rightExtra:c(()=>[u(ve,{model:e.stage,onSave:I},null,8,["model"])]),default:c(()=>[u(s(A),{key:"source-code",tab:"Source code",disabled:L("source-code")},null,8,["disabled"]),u(s(A),{key:"settings",tab:"Settings",disabled:L("settings")},null,8,["disabled"]),e.extraTab?(r(),w(s(A),{key:e.extraTab.key,tab:e.extraTab.name,disabled:L(e.extraTab.key)},null,8,["tab","disabled"])):_("",!0)]),_:1},8,["active-key"]),le(u(ke,{ref_key:"code",ref:p,script:e.stage,workspace:e.workspace,onUpdateFile:b,onSave:n[1]||(n[1]=j=>a("on-save"))},null,8,["script","workspace"]),[[ie,y.value==="source-code"]]),e.stage&&y.value==="settings"?H(e.$slots,"settings",{key:0}):_("",!0),e.stage&&y.value===((k=e.extraTab)==null?void 0:k.key)?H(e.$slots,(U=e.extraTab)==null?void 0:U.key,{key:1}):_("",!0)]}),center:c(()=>[u(s(J),{"active-key":i.value,"onUpdate:activeKey":n[2]||(n[2]=k=>i.value=k)},{rightExtra:c(()=>[H(e.$slots,"action-button")]),default:c(()=>{var k;return[u(s(A),{key:"test",tab:(k=e.testTabName)!=null?k:"Test"},null,8,["tab"]),u(s(A),{key:"tasks",tab:"Tasks"})]}),_:3},8,["active-key"]),e.stage&&i.value==="tasks"?(r(),w(we,{key:0,ref:"tasksManager","stage-id":e.stage.id,onRefetchTasks:n[3]||(n[3]=k=>a("refetch-tasks"))},null,8,["stage-id"])):_("",!0),e.stage&&i.value==="test"?H(e.$slots,"test",{key:1}):_("",!0)]),right:c(()=>[u(be,{"stage-editor-info":{stage:e.stage,workspace:e.workspace,logService:s(T)}},null,8,["stage-editor-info"])]),_:3})]),footer:c(()=>[u(ut,{ref_key:"terminalOutput",ref:l,stage:e.stage,workspace:e.workspace},null,8,["stage","workspace"])]),_:3}))}}),ct=$({__name:"PathInput",props:{runtime:{}},setup(d){const t=d,{cloudProject:a}=Me(),m=()=>{const o=$e(t.runtime.path);o&&o!==t.runtime.path&&(t.runtime.path=o)};return(o,p)=>(r(),w(s(ce),{value:o.runtime.path,"onUpdate:value":p[0]||(p[0]=l=>o.runtime.path=l),type:"text",onBlur:m},ue({_:2},[o.runtime instanceof s(Te)?{name:"addonBefore",fn:c(()=>{var l,v;return[P(" https://"+z((v=(l=s(a))==null?void 0:l.subdomain)!=null?v:"your-project-domain")+".abstra.app/_hooks/ ",1)]}),key:"0"}:{name:"addonBefore",fn:c(()=>{var l,v;return[P(" https://"+z((v=(l=s(a))==null?void 0:l.subdomain)!=null?v:"your-project-domain")+".abstra.app/ ",1)]}),key:"1"}]),1032,["value"]))}}),dt={key:1},pt=$({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(d){const t=de({pathError:null});return(a,m)=>(r(),f(Y,null,[a.runtime instanceof s(He)||a.runtime instanceof s(Ce)?_("",!0):(r(),w(s(pe),{key:0,label:"URL path"},{default:c(()=>[u(ct,{runtime:a.runtime},null,8,["runtime"])]),_:1})),t.pathError?(r(),f("div",dt,z(t.pathError),1)):_("",!0)],64))}});const Vt=N(pt,[["__scopeId","data-v-18856675"]]);export{Vt as R,At as _};
//# sourceMappingURL=RuntimeCommonSettings.c18fbbec.js.map

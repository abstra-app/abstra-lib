var ot=Object.defineProperty;var at=(t,e,a)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var ce=(t,e,a)=>(at(t,typeof e!="symbol"?e+"":e,a),a);import{g as st,W as nt,w as lt}from"./controller.7037d3c8.js";import{a as Ie}from"./asyncComputed.2c8718b1.js";import{d as H,af as Y,g as M,o as n,K as m,O as L,F as S,e4 as me,a as A,e as Ue,f as E,b as c,w as d,u as o,aL as K,e9 as ue,c as b,da as G,d5 as ae,az as N,ea as Z,d3 as Ze,eg as X,cH as it,bM as De,Q as se,h as ke,bu as $e,aP as Oe,eb as xe,N as q,J as we,a8 as Ee,bE as ge,cs as ye,cr as Re,cE as rt,ew as dt,B as ie,en as Ke,bs as ut,bq as Le,bK as ct,au as Ce,eH as pt,d2 as gt,eF as ft,eG as vt,ej as yt,aj as ht,ek as mt,el as kt}from"./index.866f1cee.js";import{u as W,P as wt,_ as _t,a as bt,b as $t,g as Xe,c as pe,N as Ct,d as At,M as It,e as St}from"./vue-flow-core.92748bc1.js";import"./linters.9028c9d1.js";import{W as ve}from"./workspaces.b435ad55.js";import{U as Mt,G as Dt}from"./UnsavedChangesHandler.347c6b8b.js";import{w as he,s as xt}from"./metadata.50166120.js";import{A as Et}from"./index.b51410ec.js";import{A as Se}from"./index.fa4c74f5.js";import{o as fe}from"./omniChatStore.8f409090.js";import{_ as zt,a as Bt}from"./vue-flow-minimap.0dc89f15.js";import{G as Pt}from"./PhArrowCounterClockwise.vue.ad522080.js";import{T as Vt}from"./TasksManager.3060f59e.js";import{a as Tt,b as Ht,n as Ft}from"./validations.bc4c732e.js";import{u as Lt}from"./editor.c6a18c67.js";import{A as Nt}from"./index.87cf9719.js";import{t as Ye}from"./index.778e6d50.js";import{B as jt}from"./Badge.46772c5c.js";import{G as Ne}from"./PhArrowDown.vue.04f39f05.js";import"./uuid.b9a61e06.js";import"./workspaceStore.68d6e4c7.js";import"./userStore.3e5bf0f3.js";import"./url.8807a85e.js";import"./colorHelpers.ca0796d4.js";import"./record.c9ee830f.js";import"./ExclamationCircleOutlined.d87035fb.js";import"./PhWebhooksLogo.vue.50bbc928.js";import"./tasksController.9b496598.js";import"./gateway.d6a9e1a7.js";import"./popupNotifcation.dcf965c9.js";import"./scripts.7c0fb7f4.js";import"./polling.33c7f8b5.js";import"./string.8898a855.js";import"./ant-design.2ddc2f42.js";import"./PhArrowSquareOut.vue.97ee6d2b.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.a4afa8fe.js";import"./Card.c4c185dc.js";import"./TabPane.2c455018.js";import"./CollapsePanel.66fd4b3f.js";import"./index.d4d4ddd4.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="d82d288e-0f57-44f5-8494-02ed8a56e827",t._sentryDebugIdIdentifier="sentry-dbid-d82d288e-0f57-44f5-8494-02ed8a56e827")}catch{}})();const Ut=["width","height","fill","transform"],Zt={key:0},Ot=A("path",{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},null,-1),Rt=[Ot],Kt={key:1},Xt=A("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),Yt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),Wt=[Xt,Yt],Gt={key:2},qt=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1-5.66-13.66l17-17-10.55-9.65-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,1,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60l10.93,10L226.34,50.3A8,8,0,0,1,240,56Z"},null,-1),Jt=[qt],Qt={key:3},eo=A("path",{d:"M238,56v48a6,6,0,0,1-6,6H184a6,6,0,0,1,0-12h32.55l-30.38-27.8c-.06-.06-.12-.13-.19-.19a82,82,0,1,0-1.7,117.65,6,6,0,0,1,8.24,8.73A93.46,93.46,0,0,1,128,222h-1.28A94,94,0,1,1,194.37,61.4L226,90.35V56a6,6,0,1,1,12,0Z"},null,-1),to=[eo],oo={key:4},ao=A("path",{d:"M240,56v48a8,8,0,0,1-8,8H184a8,8,0,0,1,0-16H211.4L184.81,71.64l-.25-.24a80,80,0,1,0-1.67,114.78,8,8,0,0,1,11,11.63A95.44,95.44,0,0,1,128,224h-1.32A96,96,0,1,1,195.75,60L224,85.8V56a8,8,0,1,1,16,0Z"},null,-1),so=[ao],no={key:5},lo=A("path",{d:"M236,56v48a4,4,0,0,1-4,4H184a4,4,0,0,1,0-8h37.7L187.53,68.69l-.13-.12a84,84,0,1,0-1.75,120.51,4,4,0,0,1,5.5,5.82A91.43,91.43,0,0,1,128,220h-1.26A92,92,0,1,1,193,62.84l35,32.05V56a4,4,0,1,1,8,0Z"},null,-1),io=[lo],ro={name:"PhArrowClockwise"},uo=H({...ro,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=Y("weight","regular"),s=Y("size","1em"),l=Y("color","currentColor"),f=Y("mirrored",!1),p=M(()=>{var i;return(i=e.weight)!=null?i:a}),y=M(()=>{var i;return(i=e.size)!=null?i:s}),w=M(()=>{var i;return(i=e.color)!=null?i:l}),v=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(i,g)=>(n(),m("svg",me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:y.value,height:y.value,fill:w.value,transform:v.value},i.$attrs),[L(i.$slots,"default"),p.value==="bold"?(n(),m("g",Zt,Rt)):p.value==="duotone"?(n(),m("g",Kt,Wt)):p.value==="fill"?(n(),m("g",Gt,Jt)):p.value==="light"?(n(),m("g",Qt,to)):p.value==="regular"?(n(),m("g",oo,so)):p.value==="thin"?(n(),m("g",no,io)):S("",!0)],16,Ut))}}),co=["width","height","fill","transform"],po={key:0},go=A("path",{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},null,-1),fo=[go],vo={key:1},yo=A("path",{d:"M221.9,61.38,152,136v58.65a8,8,0,0,1-3.56,6.66l-32,21.33A8,8,0,0,1,104,216V136L34.1,61.38A8,8,0,0,1,40,48H216A8,8,0,0,1,221.9,61.38Z",opacity:"0.2"},null,-1),ho=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),mo=[yo,ho],ko={key:2},wo=A("path",{d:"M227.81,66.76l-.08.09L160,139.17v55.49A16,16,0,0,1,152.87,208l-32,21.34A16,16,0,0,1,96,216V139.17L28.27,66.85l-.08-.09A16,16,0,0,1,40,40H216a16,16,0,0,1,11.84,26.76Z"},null,-1),_o=[wo],bo={key:3},$o=A("path",{d:"M228.77,50.34A13.8,13.8,0,0,0,216,42H40A14,14,0,0,0,29.67,65.42l.06.07L98,138.38V216a14,14,0,0,0,21.77,11.64l32-21.33A14,14,0,0,0,158,194.66V138.38l68.33-73A13.82,13.82,0,0,0,228.77,50.34Zm-11.26,6.94L147.62,131.9A6,6,0,0,0,146,136v58.66a2,2,0,0,1-.89,1.67l-32,21.33A2,2,0,0,1,110,216V136a6,6,0,0,0-1.62-4.1L38.53,57.32A2,2,0,0,1,40,54H216a1.9,1.9,0,0,1,1.83,1.19A1.86,1.86,0,0,1,217.51,57.28Z"},null,-1),Co=[$o],Ao={key:4},Io=A("path",{d:"M230.6,49.53A15.81,15.81,0,0,0,216,40H40A16,16,0,0,0,28.19,66.76l.08.09L96,139.17V216a16,16,0,0,0,24.87,13.32l32-21.34A16,16,0,0,0,160,194.66V139.17l67.74-72.32.08-.09A15.8,15.8,0,0,0,230.6,49.53ZM40,56h0Zm106.18,74.58A8,8,0,0,0,144,136v58.66L112,216V136a8,8,0,0,0-2.16-5.47L40,56H216Z"},null,-1),So=[Io],Mo={key:5},Do=A("path",{d:"M227,51.15A11.85,11.85,0,0,0,216,44H40a12,12,0,0,0-8.88,20.07l.05.05L100,137.59V216a12,12,0,0,0,18.66,10l32-21.33a12,12,0,0,0,5.35-10V137.59l68.86-73.52A11.85,11.85,0,0,0,227,51.15Zm-8,7.5-69.9,74.62A4,4,0,0,0,148,136v58.65a4,4,0,0,1-1.78,3.33l-32,21.33A4,4,0,0,1,108,216V136a4,4,0,0,0-1.08-2.74L37.05,58.67A4,4,0,0,1,40,52H216a4,4,0,0,1,3,6.65Z"},null,-1),xo=[Do],Eo={name:"PhFunnel"},zo=H({...Eo,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(t){const e=t,a=Y("weight","regular"),s=Y("size","1em"),l=Y("color","currentColor"),f=Y("mirrored",!1),p=M(()=>{var i;return(i=e.weight)!=null?i:a}),y=M(()=>{var i;return(i=e.size)!=null?i:s}),w=M(()=>{var i;return(i=e.color)!=null?i:l}),v=M(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(i,g)=>(n(),m("svg",me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:y.value,height:y.value,fill:w.value,transform:v.value},i.$attrs),[L(i.$slots,"default"),p.value==="bold"?(n(),m("g",po,fo)):p.value==="duotone"?(n(),m("g",vo,mo)):p.value==="fill"?(n(),m("g",ko,_o)):p.value==="light"?(n(),m("g",bo,Co)):p.value==="regular"?(n(),m("g",Ao,So)):p.value==="thin"?(n(),m("g",Mo,xo)):S("",!0)],16,co))}});class ze{static get isMac(){return navigator.userAgent.includes("Mac OS X")}static get buildPlatform(){return{}.CURRENT_PLATFORM||"web"}}const oe=t=>ze.isMac?t.metaKey:t.ctrlKey,Bo=t=>t.altKey,We=t=>t.shiftKey,Ae={alt:Bo,"arrow-up":t=>t.code==="ArrowUp","arrow-down":t=>t.code==="ArrowDown","arrow-left":t=>t.code==="ArrowLeft","arrow-right":t=>t.code==="ArrowRight",ctrl:oe,delete:t=>ze.isMac?t.code==="Backspace":t.code==="Delete",enter:t=>t.code==="Enter",escape:t=>t.code==="Escape",shift:We,space:t=>t.code==="Space",a:t=>t.code==="KeyA",b:t=>t.code==="KeyB",c:t=>t.code==="KeyC",d:t=>t.code==="KeyD",f:t=>t.code==="KeyF",g:t=>t.code==="KeyG",h:t=>t.code==="KeyH",k:t=>t.code==="KeyK",p:t=>t.code==="KeyP",v:t=>t.code==="KeyV",x:t=>t.code==="KeyX",z:t=>t.code==="KeyZ",0:t=>t.code==="Digit0","[":t=>t.code==="BracketLeft","]":t=>t.code==="BracketRight"};class Po{constructor(e){ce(this,"pressedKeys");ce(this,"evt");this.evt=e,this.pressedKeys={};const a=s=>l=>{Object.keys(Ae).forEach(f=>{Ae[f](l)&&this.setPressed(f,s)})};this.evt||(window.addEventListener("keydown",a(!0)),window.addEventListener("keyup",a(!1)))}setPressed(e,a){this.pressedKeys[e]=a}isPressed(e){var a;return this.evt?Ae[e](this.evt):(a=this.pressedKeys[e])!=null?a:!1}}new Po;class Vo{async listConnections(){return(await fetch("/_editor/api/agents/connections")).json()}async getIsUsageMode(){const e=await fetch("/_editor/api/agents/is-usage-mode");try{return(await e.json()).is_usage_mode}catch{return!1}}}const je=new Vo;class _e{constructor(e){this.dto=e}static async listConnections(){return(await je.listConnections()).map(a=>new _e(a))}static async getIsUsageMode(){return await je.getIsUsageMode()}get agentConnection(){return this.dto.agentConnection}get agent(){return this.dto.agent}}const Ge=Ue("agents-usage-mode",()=>{const t=E(!1);return(async()=>{t.value=await _e.getIsUsageMode()})(),{agentUsageMode:t}}),To=["onDragstart"],Ho={style:{display:"flex","flex-direction":"column","max-width":"250px"}},Fo=H({__name:"BottomToolbar",props:{controller:{}},emits:["drag-start"],setup(t,{emit:e}){const a=Ge(),s=M(()=>a.agentUsageMode?he.stages:he.stages.filter(l=>!["agents","clients"].includes(l.typeName)));return(l,f)=>(n(),m(K,null,[c(o(G),{class:"toolbar",align:"center"},{default:d(()=>[(n(!0),m(K,null,ue(s.value,p=>(n(),b(o(it),{key:p.key,placement:"top"},{title:d(()=>[c(o(G),{gap:"small"},{default:d(()=>[c(o(ae),null,{default:d(()=>[N(Z(p.title),1)]),_:2},1024),c(o(ae),{keyboard:""},{default:d(()=>[N(Z(p.key),1)]),_:2},1024)]),_:2},1024)]),content:d(()=>[A("div",Ho,[c(o(ae),null,{default:d(()=>[N(Z(p.description),1)]),_:2},1024),p.beta?(n(),b(o(Se),{key:0,type:"warning",class:"beta-alert"},{description:d(()=>[c(o(ae),null,{default:d(()=>[N(" This is a beta feature, "),c(o(Ze),{href:"https://abstra.io/docs/concepts/agents/",target:"_blank"},{default:d(()=>[N(" click here ")]),_:1}),N(" to learn more about it ")]),_:1})]),_:1})):S("",!0)])]),default:d(()=>[A("div",{draggable:!0,class:"toolbar__item",onDragstart:y=>e("drag-start",y.dataTransfer,p.typeName)},[(n(),b(X(p.icon),{size:18}))],40,To)]),_:2},1024))),128)),c(o(Et),{type:"vertical"}),c(o(De),{disabled:!l.controller.hasChanges(),onClick:f[0]||(f[0]=p=>l.controller.save())},{default:d(()=>[c(o(G),{align:"center",gap:"small"},{default:d(()=>[c(o(Dt),{size:16}),N(" Save ")]),_:1})]),_:1},8,["disabled"])]),_:1}),c(Mt,{"has-changes":l.controller.hasChanges()},null,8,["has-changes"])],64))}});const Lo=se(Fo,[["__scopeId","data-v-d855dff0"]]);function qe(){let t;const e={draggedType:E(null),isDragOver:E(!1),isAdding:E(!1),isDragging:E(!1),mousePosition:E(null)},{draggedType:a,isDragOver:s,isDragging:l,isAdding:f}=e,p=C=>{t=C,document.addEventListener("mousemove",D)},{screenToFlowCoordinate:y}=W();ke(f,C=>{document.body.style.userSelect=C?"none":""});function w(C,V){f.value=!0,C?(C.setData("application/vueflow",V),C.effectAllowed="move",a.value=V,l.value=!0,document.addEventListener("drop",g)):(a.value=V,document.addEventListener("click",_))}function v(C){C.preventDefault(),a.value&&(s.value=!0,C.dataTransfer&&(C.dataTransfer.dropEffect="move"))}function i(){s.value=!1}function g(){f.value=!1,l.value=!1,s.value=!1,a.value=null,document.removeEventListener("drop",g)}function D(C){const V={x:C.pageX-200,y:C.pageY-80};e.mousePosition.value=V}function u(C){if(!a.value)throw new Error("No dragged type");return y({x:C.clientX-70,y:C.clientY-25})}function _(C){if(!t)return;if(!a.value)throw new Error("No dragged type");const V=u(C);t.addStages([{type:a.value,position:V}]),g()}function P(){document.removeEventListener("mousemove",D)}return{init:p,tearDown:P,draggedType:a,isDragOver:s,isAdding:f,isDragging:l,mousePosition:e.mousePosition,onDragStart:w,onDragLeave:i,onDragOver:v,onDrop:_}}const No={name:"ControlButton",compatConfig:{MODE:3}},jo=(t,e)=>{const a=t.__vccOpts||t;for(const[s,l]of e)a[s]=l;return a},Uo={class:"vue-flow__controls-button"};function Zo(t,e,a,s,l,f){return n(),m("button",Uo,[L(t.$slots,"default")])}const de=jo(No,[["render",Zo]]),Oo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Ro=A("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),Ko=[Ro];function Xo(t,e){return n(),m("svg",Oo,Ko)}const Yo={render:Xo},Wo={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Go=A("path",{d:"M0 0h32v4.2H0z"},null,-1),qo=[Go];function Jo(t,e){return n(),m("svg",Wo,qo)}const Qo={render:Jo},ea={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},ta=A("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),oa=[ta];function aa(t,e){return n(),m("svg",ea,oa)}const sa={render:aa},na={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},la=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),ia=[la];function ra(t,e){return n(),m("svg",na,ia)}const da={render:ra},ua={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},ca=A("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),pa=[ca];function ga(t,e){return n(),m("svg",ua,pa)}const fa={render:ga},va={name:"Controls",compatConfig:{MODE:3}},ya=H({...va,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>wt.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(t,{emit:e}){const{nodesDraggable:a,nodesConnectable:s,elementsSelectable:l,setInteractive:f,zoomIn:p,zoomOut:y,fitView:w,viewport:v,minZoom:i,maxZoom:g}=W(),D=$e(()=>a.value||s.value||l.value),u=$e(()=>v.value.zoom<=i.value),_=$e(()=>v.value.zoom>=g.value);function P(){p(),e("zoomIn")}function C(){y(),e("zoomOut")}function V(){w(t.fitViewParams),e("fitView")}function T(){f(!D.value),e("interactionChange",!D.value)}return(I,j)=>(n(),b(o(_t),{class:"vue-flow__controls",position:I.position},{default:d(()=>[L(I.$slots,"top"),I.showZoom?(n(),m(K,{key:0},[L(I.$slots,"control-zoom-in",{},()=>[c(de,{class:"vue-flow__controls-zoomin",disabled:_.value,onClick:P},{default:d(()=>[L(I.$slots,"icon-zoom-in",{},()=>[(n(),b(X(o(Yo))))])]),_:3},8,["disabled"])]),L(I.$slots,"control-zoom-out",{},()=>[c(de,{class:"vue-flow__controls-zoomout",disabled:u.value,onClick:C},{default:d(()=>[L(I.$slots,"icon-zoom-out",{},()=>[(n(),b(X(o(Qo))))])]),_:3},8,["disabled"])])],64)):S("",!0),I.showFitView?L(I.$slots,"control-fit-view",{key:1},()=>[c(de,{class:"vue-flow__controls-fitview",onClick:V},{default:d(()=>[L(I.$slots,"icon-fit-view",{},()=>[(n(),b(X(o(sa))))])]),_:3})]):S("",!0),I.showInteractive?L(I.$slots,"control-interactive",{key:2},()=>[I.showInteractive?(n(),b(de,{key:0,class:"vue-flow__controls-interactive",onClick:T},{default:d(()=>[D.value?L(I.$slots,"icon-unlock",{key:0},()=>[(n(),b(X(o(fa))))]):S("",!0),D.value?S("",!0):L(I.$slots,"icon-lock",{key:1},()=>[(n(),b(X(o(da))))])]),_:3})):S("",!0)]):S("",!0),L(I.$slots,"default")]),_:3},8,["position"]))}}),ha=H({__name:"ControlButtons",props:{workflow:{}},setup(t){return(e,a)=>(n(),b(o(ya),{position:"top-left","show-interactive":!1},{default:d(()=>[c(o(de),{title:"Undo",disabled:!e.workflow.history.canUndo(),onClick:a[0]||(a[0]=s=>e.workflow.history.undo())},{default:d(()=>[c(o(Pt))]),_:1},8,["disabled"]),c(o(de),{title:"Redo",disabled:!e.workflow.history.canRedo(),onClick:a[1]||(a[1]=s=>e.workflow.history.redo())},{default:d(()=>[c(o(uo))]),_:1},8,["disabled"])]),_:1}))}});class ma{constructor(e,a){ce(this,"dx");ce(this,"dy");this.dx=a.x-e.x,this.dy=a.y-e.y}get x(){return this.dx}get y(){return this.dy}get length(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}get m(){return this.dy/this.dx}}function ka(t,e,a=0){const{x:s,y:l}=e.center,{width:f,height:p}=e,y=new ma(t,e.center),w=a*(y.x/y.length),v=a*(y.y/y.length),i=p/f;let g,D;if(Math.abs(y.m)>Math.abs(i)){const u=p/2*(1/y.m);g=s-(y.y>0?u:-u),D=l+(y.y>0?-p/2:p/2)}else{const u=f/2*y.m;g=s+(y.x>0?-f/2:f/2),D=l-(y.x>0?u:-u)}return{x:g+w,y:D+v}}const wa=(t,e=0,a=0)=>{const s=Math.atan2(t.ty-t.sy,t.tx-t.sx),l=e*Math.sin(s),f=e*Math.cos(s),p=a*Math.cos(s),y=a*Math.sin(s);return{sourceX:t.sx-l+p,sourceY:t.sy+f+y,targetX:t.tx-l-p,targetY:t.ty+f-y}};function Me(t,e,a=0){const s={x:t.computedPosition.x+t.dimensions.width/2,y:t.computedPosition.y+t.dimensions.height/2},f={center:{x:e.computedPosition.x+e.dimensions.width/2,y:e.computedPosition.y+e.dimensions.height/2},width:e.dimensions.width,height:e.dimensions.height};return ka(s,f,a)}function Je(t,e){const a=Me(t,e,-10),s=Me(e,t,-10);return{sx:s.x,sy:s.y,tx:a.x,ty:a.y}}const _a=H({__name:"TaskMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(n(),b(o(G),{vertical:"",gap:"small",style:q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:d(()=>[(n(!0),m(K,null,ue(e.menuOptions,s=>(n(),b(o(Oe),{key:s.label,title:s.tooltip,placement:"right"},{default:d(()=>[c(o(De),{class:xe([{"warning-button":s.warning}]),disabled:s.disabled,style:q({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:l=>s.click(l)},{default:d(()=>[c(o(G),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:d(()=>[N(Z(s.label)+" ",1),s.key?(n(),b(o(ae),{key:0,keyboard:"",disabled:s.disabled},{default:d(()=>[N(Z(s.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"]))}});const ba=H({__name:"TaskEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{},controller:{}},setup(t){const e=t,a=[{label:"Edit task type",key:"T",click:()=>l.value="editing"},{label:"Delete",key:"Del",click:()=>D(e.data.id)}],s=E(e.data.props.taskType||""),l=E("idle"),f=()=>{l.value!=="idle"&&(s.value!==e.data.props.taskType&&e.controller.updateTransitionProps(e.data.id,{taskType:s.value}),l.value="idle")},{onEdgeClick:p,onPaneClick:y,getSelectedEdges:w}=W();p(u=>{u.edge.id===e.id&&l.value==="idle"&&(l.value="selected")}),y(()=>f());const v=M(()=>Je(e.sourceNode,e.targetNode)),i=M(()=>Xe(wa(v.value))),g=u=>{!w.value.map(_=>_.id).includes(e.data.id)||(u.key==="Enter"&&f(),(u.key==="t"||u.key==="T")&&(l.value="editing"))},{removeEdges:D}=W();return we(()=>window.addEventListener("keydown",g)),Ee(()=>window.removeEventListener("keydown",g)),(u,_)=>(n(),m(K,null,[c(o(bt),{path:i.value[0],"marker-end":u.markerEnd},null,8,["path","marker-end"]),c(o($t),null,{default:d(()=>[l.value==="idle"?(n(),m("div",{key:0,style:q({transform:`translate(-50%, -50%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-label"},[e.data.props.taskType?(n(),b(o(ae),{key:1},{default:d(()=>[N(Z(e.data.props.taskType),1)]),_:1})):(n(),b(o(zo),{key:0,size:16}))],4)):l.value==="selected"?(n(),m("div",{key:1,style:q({transform:`translate(-50%, -120%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[c(_a,{"is-connecting":!0,"is-editing":!0,"menu-options":a})],4)):l.value==="editing"?(n(),m("div",{key:2,style:q({transform:`translate(-50%, -50%) translate(${i.value[1]}px,${i.value[2]}px)`}),class:"nodrag nopan edge-input-container"},[c(o(ge),{value:s.value,"onUpdate:value":_[0]||(_[0]=P=>s.value=P),placeholder:"Task type"},null,8,["value"])],4)):S("",!0)]),_:1})],64))}});const $a=se(ba,[["__scopeId","data-v-48e71e28"]]),Ca={key:0},Aa=A("defs",null,[A("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth"},[A("path",{d:"M0,0 L8,4 L0,8",fill:"none",stroke:"#222","stroke-width":"1"})])],-1),Ia=["d"],Sa=H({__name:"LineFloating",props:{targetX:{},targetY:{},sourcePosition:{},targetPosition:{},sourceNode:{}},setup(t){const e=t,a=E(!0),{onNodeMouseEnter:s,onNodeMouseLeave:l}=W();s(w=>{w.node.id===e.sourceNode.id&&(a.value=!1)}),l(w=>{w.node.id===e.sourceNode.id&&(a.value=!0)});const f=M(()=>({id:"connection-target",computedPosition:{x:e.targetX,y:e.targetY},dimensions:{width:1,height:1}})),p=M(()=>Je(e.sourceNode,f.value)),y=M(()=>Xe({sourceX:p.value.sx,sourceY:p.value.sy,targetX:p.value.tx,targetY:p.value.ty}));return(w,v)=>a.value?(n(),m("g",Ca,[Aa,A("path",{fill:"none",stroke:"#222","stroke-width":1,class:"animated",d:y.value[0],"marker-end":"url(#arrowhead)"},null,8,Ia)])):S("",!0)}}),Ma=H({__name:"CreateStageFile",props:{filename:{},creatingFileStatus:{},fileExists:{type:Boolean}},emits:["create-file","cancel","update-filename"],setup(t,{emit:e}){const a=t,s=M(()=>{const l=Tt(a.filename);return l.valid?a.fileExists?{valid:!0,help:"This file already exists, stage will point to it."}:{valid:!0,help:"File doesn't exist yet. It will be created."}:l});return(l,f)=>(n(),b(o(rt),{open:l.creatingFileStatus==="prompting"||l.creatingFileStatus==="creating",closable:!1,"confirm-loading":l.creatingFileStatus==="creating",onOk:f[1]||(f[1]=p=>e("create-file",l.filename)),onCancel:f[2]||(f[2]=p=>e("cancel"))},{default:d(()=>[c(o(Re),{layout:"vertical",disabled:l.creatingFileStatus=="creating"},{default:d(()=>[c(o(ye),{label:"You're creating a new file. What should it be called?","validate-status":s.value.valid?"success":"error",help:s.value.valid?s.value.help:s.value.reason},{default:d(()=>[c(o(ge),{value:l.filename,onChange:f[0]||(f[0]=p=>e("update-filename",p.target.value||""))},null,8,["value"])]),_:1},8,["validate-status","help"])]),_:1},8,["disabled"])]),_:1},8,["open","confirm-loading"]))}}),Da={name:"NodeToolbar",compatConfig:{MODE:3},inheritAttrs:!1},xa=H({...Da,props:{nodeId:null,isVisible:{type:Boolean},position:{default:pe.Top},offset:{default:10},align:{default:"center"}},setup(t){const e=t,a=Y(Ct,null),{viewportRef:s,viewport:l,getSelectedNodes:f,findNode:p}=W();function y(u,_,P,C,V){let T=.5;V==="start"?T=0:V==="end"&&(T=1);let I=[(u.x+u.width*T)*_.zoom+_.x,u.y*_.zoom+_.y-C],j=[-100*T,-100];switch(P){case pe.Right:I=[(u.x+u.width)*_.zoom+_.x+C,(u.y+u.height*T)*_.zoom+_.y],j=[0,-100*T];break;case pe.Bottom:I[1]=(u.y+u.height)*_.zoom+_.y+C,j[1]=0;break;case pe.Left:I=[u.x*_.zoom+_.x-C,(u.y+u.height*T)*_.zoom+_.y],j=[-100,-100*T];break}return`translate(${I[0]}px, ${I[1]}px) translate(${j[0]}%, ${j[1]}%)`}const w=M(()=>(Array.isArray(e.nodeId)?e.nodeId:[e.nodeId||a||""]).reduce((u,_)=>{const P=p(_);return P&&u.push(P),u},[])),v=M(()=>typeof e.isVisible=="boolean"?e.isVisible:w.value.length===1&&w.value[0].selected&&f.value.length===1),i=M(()=>At(w.value)),g=M(()=>Math.max(...w.value.map(u=>(u.computedPosition.z||1)+1))),D=M(()=>({position:"absolute",transform:y(i.value,l.value,e.position,e.offset,e.align),zIndex:g.value}));return(u,_)=>(n(),b(dt,{to:o(s),disabled:!o(s)},[o(v)&&o(w).length?(n(),m("div",me({key:0},u.$attrs,{style:o(D),class:"vue-flow__node-toolbar"}),[L(u.$slots,"default")],16)):S("",!0)],8,["to","disabled"]))}}),Ea=H({__name:"NodeMenu",props:{isConnecting:{type:Boolean},isEditing:{type:Boolean},menuOptions:{}},setup(t){return(e,a)=>(n(),b(o(xa),{"is-visible":e.isConnecting||e.isEditing?!1:void 0,position:o(pe).Right},{default:d(()=>[c(o(G),{vertical:"",gap:"small",style:q({marginBottom:`-${16*e.menuOptions.length}%`})},{default:d(()=>[(n(!0),m(K,null,ue(e.menuOptions,s=>(n(),b(o(Oe),{key:s.label,title:s.tooltip,placement:"right"},{default:d(()=>[c(o(De),{class:xe([{"warning-button":s.warning}]),disabled:s.disabled,style:q({backgroundColor:s.disabled?"#f5f5f5":void 0}),onClick:l=>s.click(l)},{default:d(()=>[c(o(G),{gap:"small",style:{width:"100%"},justify:"space-between",align:"center"},{default:d(()=>[N(Z(s.label)+" ",1),s.key?(n(),b(o(ae),{key:0,keyboard:"",disabled:s.disabled},{default:d(()=>[N(Z(s.key),1)]),_:2},1032,["disabled"])):S("",!0)]),_:2},1024)]),_:2},1032,["class","disabled","style","onClick"])]),_:2},1032,["title"]))),128))]),_:1},8,["style"])]),_:1},8,["is-visible","position"]))}});const za=H({__name:"AgentItems",props:{stageProps:{}},emits:["update:stage-props"],setup(t,{emit:e}){var O;const a=t,s=E(!1),f=Ge().agentUsageMode,p=ie.object({title:ie.string(),clientStageId:ie.string().uuid(),inputSchemas:ie.any(),outputSchemas:ie.any()});ke(()=>a.stageProps.projectId,()=>{s.value=!0,I()});const y=Lt(),w=()=>{var z;const $=(z=y.cloudProject)==null?void 0:z.id;return $?`https://cloud.abstra.io/projects/${$}/agents`:""},v=ie.array(p),i=E((O=a.stageProps.projectId)!=null?O:""),g=E(!1),D=$=>u.loading.value||!u.result.value?null:u.result.value.find(z=>z.agentConnection.id===$),u=Ie(async()=>_e.listConnections()),_=M(()=>u.loading.value||!u.result.value?[]:u.result.value.map($=>({label:$.agentConnection.connectionName,key:$.agentConnection.id,value:$.agent.projectId}))),{result:P,loading:C,refetch:V,error:T}=Ie(async()=>{const $=a.stageProps.projectId;if(!$)return[];const U=await(await fetch(`/_editor/api/services/roles/client/entrypoints/${$}`)).json();return v.parse(U)}),I=Ke.exports.debounce(()=>{s.value=!1,V()},500),j=M(()=>C.value||!P.value?[]:P.value.map($=>({label:$.title,value:$.clientStageId})));function J($){e("update:stage-props",{...a.stageProps,projectId:$,clientStageId:null})}function Q($){const z=D($.key);!z||(J(z.agent.projectId),i.value=z.agent.projectId,g.value=!1)}function h($){const z=$.target;i.value=z.value,J(z.value),g.value=!0}function x($){g.value=$}function B($){const z=String($);!P.value||e("update:stage-props",{...a.stageProps,clientStageId:z})}return($,z)=>(n(),m(K,null,[c(o(ye),{label:"Project ID"},{default:d(()=>{var U;return[o(f)?(n(),b(o(ct),{key:0,trigger:"click",visible:g.value,onVisibleChange:x},{overlay:d(()=>[c(o(ut),{onClick:Q},{default:d(()=>[(n(!0),m(K,null,ue(_.value,ne=>(n(),b(o(Le),{key:ne.key},{default:d(()=>[N(Z(ne.label),1)]),_:2},1024))),128)),c(o(Le),null,{default:d(()=>[c(o(Ze),{class:"cloud-link",href:w(),target:"_blank"},{default:d(()=>[N(" Connect to Agents ")]),_:1},8,["href"])]),_:1})]),_:1})]),default:d(()=>[c(o(ge),{value:i.value,"onUpdate:value":z[0]||(z[0]=ne=>i.value=ne),autofocus:"","allow-clear":"",onInput:h},null,8,["value"])]),_:1},8,["visible"])):(n(),b(o(ge),{key:1,value:(U=$.stageProps.projectId)!=null?U:"",placeholder:"Project ID",autofocus:"","onUpdate:value":J},null,8,["value"]))]}),_:1}),c(o(ye),{label:"Client entrypoint"},{default:d(()=>{var U;return[s.value||o(C)?(n(),b(o(Ce),{key:0,disabled:"",loading:""})):o(T)?(n(),b(o(Se),{key:1,type:"error",message:"Invalid project id"})):$.stageProps.projectId?o(P).length===0?(n(),b(o(Se),{key:3,type:"warning",message:"The project has no entrypoints"})):(n(),b(o(Ce),{key:4,class:"entrypoint-select",options:j.value,value:(U=$.stageProps.clientStageId)!=null?U:void 0,"onUpdate:value":B},null,8,["options","value"])):(n(),b(o(Ce),{key:2,disabled:""}))]}),_:1})],64))}});const Ba=se(za,[["__scopeId","data-v-f4d2a34d"]]),Pa=H({__name:"StageNode",props:{stage:{},node:{},initialFileCheck:{type:Boolean},controller:{}},setup(t){var Fe;const e=t,{useToken:a}=Ye,{token:s}=a(),l=s.value.colorText,f=[{label:"Add transition",key:"T",click:r=>Pe(r)},{label:"Rename",key:"R",click:()=>R.value=!0},{label:"Go to editor",key:"Enter",click:()=>Be()},{label:"Tasks",key:"M",click:()=>y.value=!0},{label:"Delete",key:"Del",click:()=>h(e.stage)}],p=M(()=>{let r=[...f];return w.value||r.unshift({label:"Create missing file",warning:!0,click:()=>V()}),e.controller.hasChanges()&&(r=r.map(k=>k.label==="Go to editor"?{...k,disabled:!0,tooltip:"Save it to allow editing"}:k)),(e.stage.type==="agents"||e.stage.type==="clients")&&(r=r.filter(k=>!["Create missing file","Go to editor","Tasks"].includes(k.label))),e.stage.type==="agents"&&(r=r.map(k=>k.label==="Rename"?{...k,label:"Edit"}:k)),r}),y=E(!1),w=E(e.initialFileCheck);ke(()=>e.initialFileCheck,r=>{w.value=r});const v=r=>{u.value=r,D()},i=r=>{e.controller.updateStageProps(e.stage.id,r)},g=()=>{var r;_.value="idle",(e.stage.type==="forms"||e.stage.type==="jobs"||e.stage.type==="hooks"||e.stage.type==="scripts")&&(u.value=(r=e.stage.props.filename)!=null?r:"",D())},D=Ke.exports.debounce(async()=>{const r=u.value;if(!r){w.value=!0;return}ve.checkFile(r).then(k=>{w.value=k.exists})},500),u=E((e.stage.type==="forms"||e.stage.type==="hooks"||e.stage.type==="scripts"||e.stage.type==="jobs")&&(Fe=e.stage.props.filename)!=null?Fe:""),_=E("idle"),P=async()=>{_.value="creating",await ve.initFile(u.value,e.stage.type),w.value=!0;const r=await ve.checkFile(u.value);if(w.value=r.exists,_.value="idle",e.stage.type==="forms"||e.stage.type==="hooks")e.controller.updateStageProps(e.stage.id,{path:e.stage.props.path,filename:u.value});else if(e.stage.type==="scripts"||e.stage.type==="jobs")e.controller.updateStageProps(e.stage.id,{filename:u.value});else throw new Error(`Invalid stage type: ${e.stage.type}`)},C=M(()=>["forms","hooks","scripts","jobs"].includes(e.stage.type)?!w.value:e.stage.type==="agents"?!e.stage.props.clientStageId||!e.stage.props.projectId:!1),V=()=>{_.value="prompting"},{startConnection:T,updateConnection:I,onNodeClick:j,addEdges:J,endConnection:Q,removeNodes:h,onPaneClick:x,getSelectedNodes:B,flowToScreenCoordinate:O,onNodeMouseEnter:$,onNodeMouseLeave:z,getNodes:U,onNodesChange:ne,applyNodeChanges:et}=W(),tt=pt(),ee=E(!1),R=E(!1),te=E(e.stage.title),be=E(!1);ne(async r=>{var F;const k=[];for(const le of r)le.type==="remove"?R.value||((F=e.controller)==null||F.delete([le.id]),k.push(le)):k.push(le);et(k)});const Be=()=>{const r=e.stage.type==="scripts"?"tasklet":e.stage.type.slice(0,-1);tt.push({path:`/_editor/${r}/${e.stage.id}`})},Pe=(r,k=!0)=>{T({nodeId:e.stage.id,type:"source",handleId:e.stage.id},{x:k?r.pageX:r.pageX-90,y:k?r.pageY-50:r.pageY-20}),document.addEventListener("mousemove",Ve),ee.value=!0},Ve=r=>{ee.value&&!be.value&&I({x:r.pageX,y:r.pageY-52})};j(r=>{if(r.node.id===e.stage.id&&D(),ee.value&&r.node.id!==e.stage.id){const k={sourceStageId:e.stage.id,targetStageId:r.node.id,type:"task",id:st(),props:{taskType:null}};try{e.controller.connect([k]),document.removeEventListener("mousemove",Ve),J({id:k.id,source:e.stage.id,target:r.node.id,type:"task",markerEnd:{type:It.Arrow,width:24,height:24},data:k}),Q(),ee.value=!1}catch(F){console.error(F)}}}),$(r=>{if(ee.value&&r.node.id!==e.stage.id){be.value=!0;const k=U.value.find(le=>le.id===e.stage.id);if(!k)return;const F=Me(k,r.node,-10);I(O({x:F.x,y:F.y-52}))}}),z(()=>{be.value=!1});const Te=()=>{if(!w.value){const r=Ht(te.value+".py");u.value=r;let k={filename:r,path:null};if(["forms","hooks"].includes(e.stage.type)){const F=Ft(te.value);k={...k,path:F}}e.controller.updateStageProps(e.stage.id,k)}};x(()=>{R.value=!1,e.stage.title!==te.value&&(e.controller.updateStageTitle(e.stage.id,te.value),Te()),ee.value=!1,Q()});const He=r=>{if(!!B.value.map(k=>k.id).includes(e.stage.id)&&_.value==="idle"){if(r.key==="Enter")if(R.value)R.value=!1,e.controller.updateStageTitle(e.stage.id,te.value),Te();else{if(e.controller.hasChanges()||e.stage.type==="agents"||e.stage.type==="clients")return;Be()}if(!R.value){if(r.key==="t"||r.key==="T"){const k=O(e.stage.position);Pe({pageX:k.x,pageY:k.y},!1)}(r.key==="r"||r.key==="R")&&(R.value=!0),(r.key==="m"||r.key==="M")&&(y.value=!0)}}};return we(()=>{window.addEventListener("keydown",He)}),Ee(()=>{window.removeEventListener("keydown",He)}),(r,k)=>(n(),m(K,null,[c(Ea,{"is-connecting":ee.value,"is-editing":R.value,"menu-options":p.value},null,8,["is-connecting","is-editing","menu-options"]),A("div",{class:"stage",onDblclick:k[1]||(k[1]=F=>R.value=!0)},[c(o(G),{vertical:R.value,class:"point",gap:"small",align:"center",style:{padding:"4px 0"}},{default:d(()=>[(n(),b(X(o(xt)(r.stage.type)),{size:18,color:o(l)},null,8,["color"])),R.value?(n(),b(o(Re),{key:1,layout:"vertical"},{default:d(()=>[c(o(ye),{label:"Title"},{default:d(()=>[c(o(ge),{value:te.value,"onUpdate:value":k[0]||(k[0]=F=>te.value=F),class:"nodrag nopan",autofocus:""},null,8,["value"])]),_:1}),r.stage.type==="agents"?(n(),b(Ba,{key:0,"stage-props":r.stage.props,"onUpdate:stageProps":i},null,8,["stage-props"])):S("",!0)]),_:1})):(n(),b(o(gt),{key:0,class:"title"},{default:d(()=>[N(Z(r.stage.title),1)]),_:1}))]),_:1},8,["vertical"])],32),C.value?(n(),b(o(jt),{key:0,count:"!",color:"gold",style:{position:"absolute",top:"-4px",right:"-4px","z-index":"1"}})):S("",!0),_.value==="prompting"||_.value==="creating"?(n(),b(Ma,{key:1,filename:u.value,"file-exists":w.value,"creating-file-status":_.value,onCreateFile:P,onCancel:g,onUpdateFilename:v},null,8,["filename","file-exists","creating-file-status"])):S("",!0),c(o(Nt),{visible:y.value,"onUpdate:visible":k[2]||(k[2]=F=>y.value=F),title:"Tasks",width:"500",onClose:k[3]||(k[3]=F=>y.value=!1)},{default:d(()=>[c(Vt,{"stage-id":r.stage.id},null,8,["stage-id"])]),_:1},8,["visible"])],64))}});const re=se(Pa,[["__scopeId","data-v-ccfb2273"]]),Qe=t=>(ft("data-v-f4278104"),t=t(),vt(),t),Va={class:"empty-hint"},Ta={key:0,class:"drag-hint"},Ha=Qe(()=>A("div",{class:"title"},"Start here",-1)),Fa={key:1,class:"drop-hint"},La=Qe(()=>A("div",{class:"title"},"Drop here",-1)),Na={key:2,class:"stages-hint"},ja={class:"header"},Ua={class:"title"},Za={class:"description"},Oa=H({__name:"EmptyHint",props:{showDragHint:{type:Boolean}},setup(t){return(e,a)=>(n(),m("div",Va,[e.showDragHint?(n(),m("div",Ta,[Ha,c(o(Ne),{size:32,class:"arrow"})])):S("",!0),e.showDragHint?S("",!0):(n(),m("div",Fa,[La,c(o(Ne),{size:32,class:"arrow"})])),e.showDragHint?(n(),m("div",Na,[(n(!0),m(K,null,ue(o(he).stages,s=>(n(),m("div",{key:s.key,class:"stage-hint"},[A("div",ja,[(n(),b(X(s.icon))),A("span",Ua,Z(s.title),1)]),A("div",Za,Z(s.description),1)]))),128))])):S("",!0)]))}});const Ra=se(Oa,[["__scopeId","data-v-f4278104"]]),Ka=H({__name:"Workflow",props:{workflow:{},editable:{type:Boolean},showDragHint:{type:Boolean},checkFileStatus:{type:Boolean},initialFileCheckStatus:{}},setup(t){const e=t;yt(v=>({"064bffb1":o(p),"8ade8628":o(f)}));const a=qe(),{useToken:s}=Ye,{token:l}=s(),f=l.value.colorPrimaryBorder,p=l.value.colorBgElevated,{onInit:y}=W();y(v=>{v.fitView()});const w=v=>{var i;return!e.checkFileStatus||!e.initialFileCheckStatus?!0:v&&(i=e.initialFileCheckStatus[v])!=null?i:!1};return we(()=>{const v=fe.subscribe("stageCreated",()=>{e.workflow.refetch()}),i=fe.subscribe("transitionCreated",()=>{e.workflow.refetch()});ht(()=>{fe.unsubscribe(v),fe.unsubscribe(i)})}),(v,i)=>v.workflow?(n(),b(o(St),{key:0,nodes:v.workflow.vueFlowNodes.value,edges:v.workflow.vueFlowEdges.value,"max-zoom":1.25,class:"vue-flow-root","select-nodes-on-drag":!1,"zoom-on-double-click":!1,multi:"","multi-selection-key-code":"Shift","nodes-draggable":v.editable,"pan-on-scroll":o(ze).isMac,"elements-selectable":v.editable,"snap-to-grid":"","apply-default":!1,"delete-key-code":["delete","backspace"],onDragover:o(a).onDragOver,onDragleave:o(a).onDragLeave},{"connection-line":d(g=>[c(Sa,mt(kt(g)),null,16)]),"edge-task":d(g=>[c($a,me(g,{controller:v.workflow}),null,16,["controller"])]),"node-forms":d(g=>[c(re,{stage:g.data,node:g,controller:v.workflow,"initial-file-check":w(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-hooks":d(g=>[c(re,{stage:g.data,node:g,controller:v.workflow,"initial-file-check":w(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-scripts":d(g=>[c(re,{stage:g.data,node:g,controller:v.workflow,"initial-file-check":w(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-jobs":d(g=>[c(re,{stage:g.data,node:g,controller:v.workflow,"initial-file-check":w(g.data.props.filename)},null,8,["stage","node","controller","initial-file-check"])]),"node-agents":d(g=>[c(re,{stage:g.data,node:g,controller:v.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),"node-clients":d(g=>[c(re,{stage:g.data,node:g,controller:v.workflow,"initial-file-check":!0},null,8,["stage","node","controller"])]),default:d(()=>[c(o(zt)),v.editable&&!v.workflow.vueFlowNodes.value.length?(n(),b(Ra,{key:0,"show-drag-hint":v.showDragHint},null,8,["show-drag-hint"])):S("",!0),c(o(Bt),{pannable:"",zoomable:""}),v.editable?(n(),b(ha,{key:1,workflow:v.workflow},null,8,["workflow"])):S("",!0)]),_:1},8,["nodes","edges","nodes-draggable","pan-on-scroll","elements-selectable","onDragover","onDragleave"])):S("",!0)}});const Xa=se(Ka,[["__scopeId","data-v-953e32fd"]]),Ya=Ue("omniChat",()=>{const t=E(!1),e=E(!1),a=()=>{e.value=!0},s=()=>{e.value=!1};return{isOpen:t,isInputFocused:e,focusInput:a,blurInput:s,open:()=>{t.value=!0,a()},close:()=>{t.value=!1,s()}}}),Wa=H({__name:"WorkflowEditor",setup(t){const e=Ya(),{init:a,tearDown:s,onDragStart:l,onDrop:f,isDragging:p,isAdding:y,draggedType:w,mousePosition:v}=qe(),{result:i}=Ie(async()=>await nt.init(lt,!0)),g=E(null),D=async()=>{if(!i.value)return;const h=i.value.vueFlowNodes.value.map(x=>{var B,O,$,z,U;return((B=x.data)==null?void 0:B.type)==="forms"||((O=x.data)==null?void 0:O.type)==="hooks"||(($=x.data)==null?void 0:$.type)==="scripts"||((z=x.data)==null?void 0:z.type)==="jobs"?(U=x.data)==null?void 0:U.props.filename:null});g.value=await ve.checkFiles(h.filter(x=>typeof x=="string"))};ke(()=>i.value,()=>{i.value&&(a(i.value),D())});const{onNodeDragStop:u,onEdgesChange:_,getSelectedElements:P,getNodes:C,addSelectedNodes:V,zoomIn:T,fitView:I,zoomOut:j,applyEdgeChanges:J}=W();u(h=>{var x;(x=i.value)==null||x.move(h.nodes.map(B=>({id:B.id,position:B.position})))}),_(h=>{var x;for(const B of h)B.type==="remove"&&((x=i.value)==null||x.delete([B.id]));J(h)});const Q=h=>{var x,B;e.isInputFocused||!i.value||((h.key==="z"||h.key==="Z")&&oe(h)&&(We(h)?i.value.history.redo():(x=i.value)==null||x.history.undo(),h.preventDefault()),oe(h)&&(h.key==="s"||h.key==="S")&&((B=i.value)==null||B.save(),h.preventDefault()),!P.value.length&&(h.key==="f"||h.key==="F"?l(null,"forms"):h.key==="h"||h.key==="H"?l(null,"hooks"):h.key==="j"||h.key==="J"?l(null,"jobs"):h.key==="o"||h.key==="O"?l(null,"scripts"):(h.key==="a"||h.key==="A")&&oe(h)?(V(C.value),h.preventDefault()):h.key==="0"&&oe(h)?(I(),h.preventDefault()):(h.key==="="||h.key==="+")&&oe(h)?(h.preventDefault(),T()):h.key==="-"&&oe(h)&&(h.preventDefault(),j())))};return we(()=>{window.addEventListener("keydown",Q)}),Ee(()=>{window.removeEventListener("keydown",Q),s()}),(h,x)=>o(i)?(n(),m("div",{key:0,class:xe(["workflow-container",{dragging:o(y)}]),onDrop:x[0]||(x[0]=(...B)=>o(f)&&o(f)(...B))},[c(Xa,{workflow:o(i),editable:"","show-drag-hint":!o(y),"check-file-status":!0,"initial-file-check-status":g.value},null,8,["workflow","show-drag-hint","initial-file-check-status"]),c(Lo,{controller:o(i),onDragStart:o(l)},null,8,["controller","onDragStart"]),(n(!0),m(K,null,ue(o(he).stages,B=>{var O,$;return n(),m("div",{key:B.key},[o(y)&&!o(p)&&B.typeName===o(w)?(n(),m("div",{key:0,class:"dragging-node",style:q({left:`${(O=o(v))==null?void 0:O.x}px`,top:`${($=o(v))==null?void 0:$.y}px`,position:"absolute",cursor:o(y)?"grabbing":"grab"})},[(n(),b(X(B.icon),{size:18}))],4)):S("",!0)])}),128))],34)):S("",!0)}});const Fs=se(Wa,[["__scopeId","data-v-b9fa2cb5"]]);export{Fs as default};
//# sourceMappingURL=WorkflowEditor.7ac59800.js.map

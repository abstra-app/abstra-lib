import{f as s,ee as J,d as L,c as N,U as H,R as Y,ac as U,b as n,u as t,aY as E,o as p,cE as C,i as d,aI as P,cD as G,a as g,df as D,g as y,t as f,d9 as $,h as j,dj as k,el as Q,dd as W,d6 as X,eq as Z,S as K,d0 as tt,cM as et,ei as at,A as nt}from"./jwt-decode.esm.32f71954.js";import{_ as lt}from"./AbstraButton.vue_vue_type_script_setup_true_lang.9c0844e1.js";import{I as st}from"./PhCopy.vue.3f2b76a2.js";import{T as rt}from"./tasksController.42d22818.js";import{s as ot}from"./metadata.c5f500d1.js";import{t as it}from"./ant-design.a8b36151.js";import{R as ut}from"./dayjs.68053597.js";import{g as R,a as A}from"./router.29e08ea4.js";import{R as ct}from"./repository.e580214f.js";import{a as dt,B as pt}from"./build.c626214a.js";import{a as gt}from"./project.b14b799c.js";import"./tables.94d324c3.js";import{a as ft}from"./asyncComputed.f9fa4c71.js";import"./contracts.generated.c5043d35.js";import"./record.41c9caee.js";import"./linters.3b9f6de6.js";import"./polling.ca800fea.js";import"./PhWebhooksLogo.vue.13c489ce.js";import"./index.2400150a.js";import"./string.ff0b4ef9.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[i]="86cc79ec-27e2-475d-a4ca-29487ec9899c",c._sentryDebugIdIdentifier="sentry-dbid-86cc79ec-27e2-475d-a4ca-29487ec9899c")}catch{}})();var mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const _t=mt;function B(c){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?Object(arguments[i]):{},v=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(o).filter(function(w){return Object.getOwnPropertyDescriptor(o,w).enumerable}))),v.forEach(function(w){yt(c,w,o[w])})}return c}function yt(c,i,o){return i in c?Object.defineProperty(c,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):c[i]=o,c}var z=function(i,o){var v=B({},i,o.attrs);return s(J,B({},v,{icon:_t}),null)};z.displayName="SyncOutlined";z.inheritAttrs=!1;const vt=z,wt=L({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean},stageId:{},status:{}},setup(c,{expose:i}){const o=c,{setup:v,tearDown:w,state:u,getColumns:T,fetchTasks:I,clearAllTasks:b}=rt({api:o.api,poll:!0,stages:o.stages,stageId:o.stageId,status:o.status}),S=e=>{var a,m;if(!((a=e.completed)!=null&&a.at)||!((m=e.created)!=null&&m.at))return null;const l=new Date(e.created.at).getTime(),r=new Date(e.completed.at).getTime();return Math.round((r-l)/1e3)},h=e=>{var a;if(!((a=e.created)!=null&&a.at))return null;const l=new Date(e.created.at).getTime(),r=Date.now();return Math.round((r-l)/1e3)},x=e=>{if(e<60)return`${e}s`;const l=Math.floor(e/60);if(l<60){const _=e%60;return _>0?`${l}m ${_}s`:`${l}m`}const r=Math.floor(l/60);if(r<24){const _=l%60;return _>0?`${r}h ${_}m`:`${r}h`}const a=Math.floor(r/24),m=r%24;return m>0?`${a}d ${m}h`:`${a}d`},O=N(()=>o.stages?u.tasks.map(e=>{var r,a,m;const l=(r=o.stages)==null?void 0:r.find(_=>_.id===e.targetStageId);return l?{...e,targetStageTitle:l.stageTitle,targetStageType:l.stageType,completedAt:(m=e.completed)!=null&&m.at?new Date(e.completed.at).toLocaleString():"Not completed",createdAt:new Date(e.created.at).toLocaleString(),deleted:!1,duration:S(e),pendingDuration:h(e)}:{...e,targetStageTitle:null,targetStageType:null,completedAt:(a=e.completed)!=null&&a.at?new Date(e.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(e.created.at).toLocaleString(),deleted:!0,duration:S(e),pendingDuration:h(e)}}):u.tasks.map(e=>{var l;return{...e,deleted:!1,completedAt:(l=e.completed)!=null&&l.at?new Date(e.completed.at).toLocaleString():d.translate("i18n_tasksview_not_completed"),createdAt:new Date(e.created.at).toLocaleString(),duration:S(e),pendingDuration:h(e)}})),F=(e,l,r)=>{var _,M;const a=(_=e.current)!=null?_:1,m=(M=e.pageSize)!=null?M:10;u.pagination.currentIndex=a-1,u.pagination.pageSize=m,I()},V=(e,l)=>`/_editor/${e}/${l}`,q=e=>{typeof e=="object"?navigator.clipboard.writeText(JSON.stringify(e)):navigator.clipboard.writeText(String(e)),et.success({content:d.translate("i18n_tasksview_copied_to_clipboard")})};return i({clearAllTasks:b}),H(()=>v()),Y(()=>w()),(e,l)=>(p(),U(E,null,[s(t(G),{layout:"vertical"},{default:n(()=>[s(t(R),{gutter:10},{default:n(()=>[s(t(A),{span:10},{default:n(()=>[s(t(C),{label:t(d).translate("i18n_tasksview_stage_label")},{default:n(()=>[s(t(P),{value:t(u).filters.stage,"onUpdate:value":l[0]||(l[0]=r=>t(u).filters.stage=r),options:t(u).filterOptions.stages,placeholder:t(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(t(A),{span:6},{default:n(()=>[s(t(C),{label:t(d).translate("i18n_tasksview_status_label")},{default:n(()=>[s(t(P),{value:t(u).filters.status,"onUpdate:value":l[1]||(l[1]=r=>t(u).filters.status=r),options:t(u).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:t(d).translate("i18n_tasksview_all_placeholder"),"allow-clear":""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),s(t(A),{span:8},{default:n(()=>[s(t(C),{label:t(d).translate("i18n_tasksview_created_at_date_label")},{default:n(()=>[s(t(ut),{value:t(u).filters.dateRange,"onUpdate:value":l[2]||(l[2]=r=>t(u).filters.dateRange=r),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),s(t(tt),{columns:t(T)(),"data-source":O.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:t(u).pagination.currentIndex+1,pageSize:t(u).pagination.pageSize,total:t(u).pagination.totalCount},onChange:F},{bodyCell:n(({column:r,record:a})=>[r.key==="timeInfo"?(p(),g(t(k),{key:0,vertical:"",gap:4},{default:n(()=>[s(t(D),null,{default:n(()=>[y(f(a.createdAt),1)]),_:2},1024),a.status==="pending"&&a.pendingDuration?(p(),g(t($),{key:0,color:"orange"},{default:n(()=>[y(f(t(d).translate("i18n_tasksview_pending_for"))+" "+f(x(a.pendingDuration)),1)]),_:2},1024)):a.status==="started"?(p(),g(t($),{key:1,color:"blue"},{default:n(()=>[y(f(t(d).translate("i18n_tasksview_status_running"))+" ",1),s(t(vt),{spin:!0,style:{"margin-left":"4px"}})]),_:1})):a.duration?(p(),g(t($),{key:2,color:"green"},{default:n(()=>[y(f(t(d).translate("i18n_tasksview_completed_in"))+" "+f(x(a.duration)),1)]),_:2},1024)):j("",!0)]),_:2},1024)):r.key==="stageInfo"?(p(),g(t(k),{key:1,vertical:"",gap:4},{default:n(()=>[a.deleted?(p(),g(t(D),{key:0},{default:n(()=>[y(f(t(d).translate("i18n_tasksview_not_found")),1)]),_:1})):(p(),g(t(k),{key:1,gap:8,align:"center"},{default:n(()=>[(p(),g(Q(t(ot)(a.targetStageType)),{size:20})),s(t(k),{vertical:"",gap:0},{default:n(()=>[e.editor?(p(),g(t(W),{key:0,href:V(a.targetStageType,a.targetStageId)},{default:n(()=>[y(f(a.targetStageTitle),1)]),_:2},1032,["href"])):(p(),g(t(D),{key:1},{default:n(()=>[y(f(a.targetStageTitle),1)]),_:2},1024)),s(t(D),{type:"secondary",style:{fontSize:"12px"}},{default:n(()=>[y(f(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024)):r.key==="payloadInfo"?(p(),g(t(k),{key:2,gap:8,align:"start",justify:"space-between"},{default:n(()=>[s(t(X),{"tree-data":t(it)(a.payload),selectable:!1,style:{flex:"1"}},null,8,["tree-data"]),s(lt,{type:"text",size:"small",tooltip:t(d).translate("i18n_tasksview_copy_payload_tooltip"),onClick:Z(m=>q(a.payload),["stop"])},{default:n(()=>[s(t(st))]),_:2},1032,["tooltip","onClick"])]),_:2},1024)):j("",!0)]),footer:n(()=>[s(t(R),{justify:"end",gutter:10},{default:n(()=>[s(t(A),null,{default:n(()=>[s(t(K),{size:"small"})]),_:1}),s(t(A),null,{default:n(()=>[s(t(D),null,{default:n(()=>[y(f(t(d).translate("i18n_tasksview_auto_updating")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}}),Ut=L({__name:"Tasks",setup(c){const i=at(),o=i.params.projectId,v=i.query.stage,w=i.query.status,u=new ct(o),{result:T}=ft(async()=>{const S=(await dt.list(o)).find(O=>O.latest);if(!S)return null;const[h,x]=await Promise.all([pt.get(S.id),gt.get(o)]);return{buildSpec:h,project:x}}),I=N(()=>!T.value||!T.value.buildSpec?null:T.value.buildSpec.runtimes.map(b=>({id:b.id,stageTitle:b.title,stageType:b.type})));return(b,S)=>(p(),U(E,null,[s(t(nt),null,{default:n(()=>[y(f(t(d).translate("i18n_tasksview_title")),1)]),_:1}),I.value?(p(),g(wt,{key:0,class:"tasks",api:t(u),stages:I.value,"stage-id":t(v),status:t(w)},null,8,["api","stages","stage-id","status"])):j("",!0)],64))}});export{Ut as default};
//# sourceMappingURL=Tasks.932349fa.js.map

import{d as K,r as T,H as U,G as E,eB as M,F as J,eH as Q,b as i,c as v,w as r,u as e,eG as W,f as a,aA as P,ad as N,cw as X,bD as Z,cK as S,eu as _,eC as q,ew as j,eD as c,e as C,cS as ee,b8 as te,bY as ae,cs as le,t as se}from"./outputWidgets.969742a9.js";import{A as I}from"./router.244d1b55.js";import{B as ne}from"./build.41ed794e.js";import"./columns.858f96a4.js";import{C as z}from"./gateway.68bce6f2.js";import{a as re}from"./asyncComputed.8cf76354.js";import{t as oe}from"./ant-design.3d4ffcb9.js";import{R as ue}from"./dayjs.0b5cfa3a.js";import{f as ie}from"./index.b048d0fb.js";import{A as de}from"./Title.96d10d0c.js";import{A as F}from"./index.b9284466.js";import{A as g}from"./FormItem.8edb30fb.js";import{F as pe}from"./Base.c33fc232.js";import{A as ce,C as me}from"./CollapsePanel.48b7e9e4.js";import{A as fe}from"./Text.104ae35a.js";import{A as k}from"./index.95743cb9.js";import"./index.347431e6.js";import"./activeRecord.5a6e314a.js";import"./pubsub.0444215c.js";import"./index.cf4c23b9.js";import"./transButton.6dbf3986.js";import"./index.1ae02e99.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[t]="5ca7466f-6c34-4d16-a76a-ef0e5d115d55",y._sentryDebugIdIdentifier="sentry-dbid-5ca7466f-6c34-4d16-a76a-ef0e5d115d55")}catch{}})();class ve{list(t){return z.post(`projects/${t.projectId}/builds/${t.buildId}/logs`,t)}filters(t){return z.get(`projects/${t}/log-filters`)}}const O=new ve;class A{constructor(t,d,m,h,w,x,b){this.executionId=t,this.runtimeType=d,this.runtimeName=m,this.payload=h,this.event=w,this.buildId=x,this.createdAt=b}static fromDTO(t){return new A(t.executionId,t.runtimeType,t.runtimeName,t.payload,t.event,t.buildId,new Date(t.createdAt))}static async list(t){const d=await O.list(t);return{total:d.total,logs:d.logs.map(A.fromDTO)}}static async filters(t){return O.filters(t)}}const ye={key:0},_e=["textContent"],be=["textContent"],ge=["textContent"],Ae=["textContent"],he=K({__name:"Logs",setup(y){function t(n){return ie(n,new Date,{addSuffix:!0})}const d=T(1),m=T(10);U([d,m],([n,s])=>{d.value=n,m.value=s,B()});function h(n){return(n.event==="stderr"||n.event==="stdout")&&typeof n.payload.log=="string"&&n.payload.log.trim().length===0}const w=E(()=>{var n,s;return{runtimes:(n=f.value)==null?void 0:n.filters.runtimes.map(({runtimeName:p,runtimeType:u})=>({label:`[${u}] ${p}`,value:p})),events:(s=f.value)==null?void 0:s.filters.events.map(p=>({label:`[${p.runtimeType}] ${p.event}`,value:p.event}))}}),x=M(),b=x.params.projectId,o=J({selectedBuild:x.query.buildId||"latest",dateRange:void 0,search:"",runtimeNames:[],events:[]}),V=Q.exports.debounce(async()=>{await B(),D.value=!1},500),D=T(!1);U(o,()=>{D.value=!0,V()});const G=E(()=>f.value?[{label:"Latest",value:"latest"},{label:"All",value:"all"},...f.value.builds.map(n=>({label:`${t(n.createdAt)} (${n.id.slice(0,8)})`,value:n.id}))]:[{label:"Latest",value:"latest"},{label:"All",value:"all"}]),H=n=>{o.selectedBuild=n,B()},{loading:Y,result:f,refetch:B}=re(()=>{var n,s;return Promise.all([A.list({projectId:b,limit:m.value,offset:(d.value-1)*m.value,buildId:o.selectedBuild,from:(n=o.dateRange)==null?void 0:n[0].toDate(),to:(s=o.dateRange)==null?void 0:s[1].toDate(),search:o.search,runtimeNames:o.runtimeNames,events:o.events}),ne.list(b),A.filters(b)]).then(([{total:p,logs:u},l,R])=>W({total:p,logs:u,builds:l,filters:R}))});return(n,s)=>(i(),v(e(S),{direction:"vertical"},{default:r(()=>{var p;return[a(e(de),null,{default:r(()=>[P("Logs")]),_:1}),a(e(pe),{layout:"vertical"},{default:r(()=>[a(e(F),{gutter:10},{default:r(()=>[a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Build"},{default:r(()=>[a(e(N),{value:o.selectedBuild,"onUpdate:value":s[0]||(s[0]=u=>o.selectedBuild=u),options:G.value,"option-label":"label","option-value":"value",filter:!1,onChange:H},null,8,["value","options"])]),_:1})]),_:1}),a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Date"},{default:r(()=>[a(e(ue),{value:o.dateRange,"onUpdate:value":s[1]||(s[1]=u=>o.dateRange=u),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(e(F),{gutter:10},{default:r(()=>[a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Runtimes"},{default:r(()=>[a(e(N),{value:o.runtimeNames,"onUpdate:value":s[2]||(s[2]=u=>o.runtimeNames=u),options:w.value.runtimes,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1}),a(e(I),{span:12},{default:r(()=>[a(e(g),{label:"Events"},{default:r(()=>[a(e(N),{value:o.events,"onUpdate:value":s[3]||(s[3]=u=>o.events=u),options:w.value.events,mode:"multiple"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),a(e(g),{label:"Search"},{default:r(()=>[a(e(X),{value:o.search,"onUpdate:value":s[4]||(s[4]=u=>o.search=u),type:"search"},null,8,["value"])]),_:1})]),_:1}),e(Y)||D.value?(i(),v(e(Z),{key:0,style:{width:"100%"}})):(p=e(f))!=null&&p.logs.length?(i(),v(e(S),{key:1,direction:"vertical",style:{width:"100%"}},{default:r(()=>{var u;return[a(e(me),{"data-source":(u=e(f))==null?void 0:u.logs},{default:r(()=>[(i(!0),_(te,null,q(e(f).logs,(l,R)=>(i(),v(e(ce),{key:R,disabled:h(l)},{extra:r(()=>[h(l)?(i(),v(e(fe),{key:0},{default:r(()=>[P(" EMPTY ")]),_:1})):j("",!0)]),header:r(()=>[a(e(S),null,{default:r(()=>[o.selectedBuild=="all"?(i(),_("span",ye,c(l.buildId.split("-")[0]),1)):j("",!0),a(e(k),{type:"vertical"}),C("span",null,c(t(l.createdAt)),1),a(e(k),{type:"vertical"}),C("span",null," ["+c(l.runtimeType)+"] "+c(l.runtimeName),1),a(e(k),{type:"vertical"}),C("span",null,c(l.executionId.slice(0,8)),1),a(e(k),{type:"vertical"}),C("span",null,c(l.event),1)]),_:2},1024)]),default:r(()=>{var $,L;return[l.event==="stdout"?(i(),_("pre",{key:0,class:"stdio-log",textContent:c(l.payload.log)},null,8,_e)):l.event==="stderr"?(i(),_("pre",{key:1,class:"stdio-log",textContent:c(l.payload.log)},null,8,be)):l.event==="program-start-failed"?(i(),_("pre",{key:2,textContent:c(l.payload.error)},null,8,ge)):l.event==="widgets-computed"&&((L=($=l.payload.errors)==null?void 0:$.general)==null?void 0:L.repr)?(i(),_("pre",{key:3,textContent:c(l.payload.errors.general.repr)},null,8,Ae)):(i(),v(e(ee),{key:4,"tree-data":e(oe)(l.payload)},null,8,["tree-data"]))]}),_:2},1032,["disabled"]))),128))]),_:1},8,["data-source"]),a(e(ae),{current:d.value,"onUpdate:current":s[5]||(s[5]=l=>d.value=l),"page-size":m.value,"onUpdate:pageSize":s[6]||(s[6]=l=>m.value=l),"show-size-changer":"",total:e(f).total},null,8,["current","page-size","total"])]}),_:1})):(i(),v(e(le),{key:2}))]}),_:1}))}});const He=se(he,[["__scopeId","data-v-74ad90a7"]]);export{He as default};
//# sourceMappingURL=Logs.87e87656.js.map

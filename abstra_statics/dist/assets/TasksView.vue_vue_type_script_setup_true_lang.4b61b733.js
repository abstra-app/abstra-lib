import{b as n,e6 as B,d as M,g as E,J as U,a8 as V,K as _,w as a,u as e,aL as C,o as u,cs as A,au as x,cr as J,c as p,cX as X,az as S,d5 as v,ei as q,d3 as G,eb as w,da as O,c_ as H,F as D,eM as Q,br as W,cR as Y,cA as Z}from"./index.dac48cf7.js";import{_ as K}from"./AbstraButton.vue_vue_type_script_setup_true_lang.72597d4f.js";import{I as ee}from"./PhCopy.vue.af35bf4d.js";import{T as te}from"./tasksController.5cf0c7c0.js";import{s as ae}from"./metadata.12393afb.js";import{t as ne}from"./ant-design.7bc3937c.js";import{c as le}from"./string.9568178f.js";import{a as I,A as b}from"./index.e5a37860.js";import{R as re}from"./dayjs.91740d4f.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[o]="04b8a79a-8888-454a-9e7a-56b9fd065ba6",r._sentryDebugIdIdentifier="sentry-dbid-04b8a79a-8888-454a-9e7a-56b9fd065ba6")}catch{}})();var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const se=oe;function k(r){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?Object(arguments[o]):{},g=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(g=g.concat(Object.getOwnPropertySymbols(s).filter(function(m){return Object.getOwnPropertyDescriptor(s,m).enumerable}))),g.forEach(function(m){ie(r,m,s[m])})}return r}function ie(r,o,s){return o in r?Object.defineProperty(r,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[o]=s,r}var T=function(o,s){var g=k({},o,s.attrs);return n(B,k({},g,{icon:se}),null)};T.displayName="SyncOutlined";T.inheritAttrs=!1;const de=T,ce={key:4,style:{"min-width":"100px"}},Ae=M({__name:"TasksView",props:{api:{},stages:{},editor:{type:Boolean}},setup(r,{expose:o}){const s=r,{setup:g,tearDown:m,state:i,getColumns:z,fetchTasks:L,clearAllTasks:N}=te({api:s.api,poll:!0,stages:s.stages}),j=t=>t.dataIndex===void 0&&"children"in t&&Array.isArray(t.children)&&t.children.length===0,P=E(()=>s.stages?i.tasks.map(t=>{var d,f,c;const l=(d=s.stages)==null?void 0:d.find(y=>y.id===t.targetStageId);return l?{...t,targetStageTitle:l.stageTitle,targetStageType:l.stageType,completedAt:(c=t.completed)!=null&&c.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!1}:{...t,targetStageTitle:null,targetStageType:null,completedAt:(f=t.completed)!=null&&f.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString(),deleted:!0}}):i.tasks.map(t=>{var l;return{...t,deleted:!1,completedAt:(l=t.completed)!=null&&l.at?new Date(t.completed.at).toLocaleString():"Not completed",createdAt:new Date(t.created.at).toLocaleString()}})),F=(t,l,d)=>{var y,h;const f=(y=t.current)!=null?y:1,c=(h=t.pageSize)!=null?h:10;i.pagination.currentIndex=f-1,i.pagination.pageSize=c,L()},R=(t,l)=>`/_editor/${t}/${l}`,$=t=>{typeof t=="object"?navigator.clipboard.writeText(JSON.stringify(t)):navigator.clipboard.writeText(String(t)),Z.success({content:"Copied to clipboard"})};return o({clearAllTasks:N}),U(()=>g()),V(()=>m()),(t,l)=>(u(),_(C,null,[n(e(J),{layout:"vertical"},{default:a(()=>[n(e(I),{gutter:10},{default:a(()=>[n(e(b),{span:10},{default:a(()=>[n(e(A),{label:"Stage"},{default:a(()=>[n(e(x),{value:e(i).filters.stage,"onUpdate:value":l[0]||(l[0]=d=>e(i).filters.stage=d),options:e(i).filterOptions.stages,placeholder:"All","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),n(e(b),{span:6},{default:a(()=>[n(e(A),{label:"Status"},{default:a(()=>[n(e(x),{value:e(i).filters.status,"onUpdate:value":l[1]||(l[1]=d=>e(i).filters.status=d),options:e(i).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:"All","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),n(e(b),{span:8},{default:a(()=>[n(e(A),{label:"Created at date"},{default:a(()=>[n(e(re),{value:e(i).filters.dateRange,"onUpdate:value":l[2]||(l[2]=d=>e(i).filters.dateRange=d),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(Y),{columns:e(z)(),"data-source":P.value,scroll:{x:"max-content",y:1e3},bordered:"",size:"small",pagination:{current:e(i).pagination.currentIndex+1,pageSize:e(i).pagination.pageSize,total:e(i).pagination.totalCount},onChange:F},{bodyCell:a(({column:d,text:f,record:c})=>[d.key==="payload"?(u(),p(e(X),{key:0,"tree-data":e(ne)(c.payload),selectable:!1},null,8,["tree-data"])):d.key==="targetStageTitle"?(u(),_(C,{key:1},[c.deleted?(u(),p(e(v),{key:0},{default:a(()=>[S("Not found")]),_:1})):(u(),p(e(O),{key:1,gap:"small",justify:"center"},{default:a(()=>[(u(),p(q(e(ae)(c.targetStageType)),{size:"20"})),t.editor?(u(),p(e(G),{key:0,href:R(c.targetStageType,c.targetStageId)},{default:a(()=>[S(w(c.targetStageTitle),1)]),_:2},1032,["href"])):(u(),p(e(v),{key:1},{default:a(()=>[S(w(c.targetStageTitle),1)]),_:2},1024))]),_:2},1024))],64)):d.dataIndex==="status"?(u(),p(e(O),{key:2,gap:"small",justify:"center"},{default:a(()=>[n(e(H),null,{default:a(()=>[S(w(e(le)(String(f)))+" ",1),f==="started"?(u(),p(e(de),{key:0,spin:!0,style:{"margin-left":"4px"}})):D("",!0)]),_:2},1024)]),_:2},1024)):d.dataIndex==="actions"?(u(),p(K,{key:3,type:"text",size:"small",tooltip:"Copy Payload Data",onClick:Q(y=>$(c.payload),["stop"])},{default:a(()=>[n(e(ee))]),_:2},1032,["onClick"])):j(d)?(u(),_("div",ce)):D("",!0)]),footer:a(()=>[n(e(I),{justify:"end",gutter:10},{default:a(()=>[n(e(b),null,{default:a(()=>[n(e(W),{size:"small"})]),_:1}),n(e(b),null,{default:a(()=>[n(e(v),null,{default:a(()=>[S(" auto updating ")]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","data-source","pagination"])],64))}});export{Ae as _};
//# sourceMappingURL=TasksView.vue_vue_type_script_setup_true_lang.4b61b733.js.map

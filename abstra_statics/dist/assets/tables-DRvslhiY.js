import{C as s}from"./router-BfX34XLs.js";import{E as g}from"./record-BoeAoZE0.js";import{n as u}from"./string-DXA1IHkK.js";import{z as n}from"./jwt-decode.esm-X_JHyrHe.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[e]="97f07045-003f-4e71-94f7-bcecd176b907",i._sentryDebugIdIdentifier="sentry-dbid-97f07045-003f-4e71-94f7-bcecd176b907")}catch{}})();n.object({name:n.string().optional(),unique:n.boolean().optional(),nullable:n.boolean().optional(),type:n.object({newType:n.string(),using:n.string()}).optional(),default:n.string().optional(),foreignKey:n.object({columnId:n.string()}).nullish().optional()});const f={boolean:["boolean","bool"],int:["int","integer","int4"],varchar:["varchar","character varying"],json:["json"],jsonb:["jsonb"],date:["date"],timestamp:["timestamp","timestamp with time zone","timestamptz"],uuid:["uuid"],real:["real","float4","float8","double precision"],numeric:["numeric","decimal"],text:["text"],bigint:["bigint","int8"],smallint:["smallint","int2"]},I=i=>{for(const e of w)if(f[e].includes(i))return e;throw new Error(`Unknown type: ${i}`)};class j{async create(e){return s.post(`projects/${e.projectId}/tables/${e.tableId}/columns`,e)}async delete(e){return s.delete(`projects/${e.projectId}/tables/${e.tableId}/columns/${e.id}`)}async update(e,t){return s.patch(`projects/${e.projectId}/tables/${e.tableId}/columns/${e.id}`,t)}async getById(e){return s.get(`projects/${e.projectId}/columns/${e.id}`)}}const p=new j;class a{record;constructor(e){this.record=g.from(e)}static async create(e,t,r,c,d,m,y,b){const h=await p.create({name:e,type:t,default:r,nullable:c,unique:d,tableId:m,projectId:y,foreignKey:b});return"error"in h?h:new a(h)}async update(e){const t={...this.record.changes,type:this.record.changes.type&&e?{newType:this.record.changes.type,using:e}:void 0};return Object.keys(t).length===0||!this.id?{success:!0,error:""}:(await p.update({id:this.id,tableId:this.tableId,projectId:this.projectId},t),{success:!0,error:""})}static fromDTO=e=>new a(e);static fromID=async(e,t)=>{const r=await p.getById({projectId:e,id:t});return a.fromDTO(r.column)};toDTO(){return this.record.state}get id(){return this.record.get("id")}get tableId(){return this.record.get("tableId")}get projectId(){return this.record.get("projectId")}get protected(){return this.record.get("protected")}get type(){return I(this.record.get("type"))}set type(e){this.record.set("type",e)}get name(){return this.record.get("name")}set name(e){this.record.set("name",e)}get nullable(){return this.record.get("nullable")}set nullable(e){this.record.set("nullable",e)}get unique(){return this.record.get("unique")}set unique(e){this.record.set("unique",e)}get primaryKey(){return this.record.get("primaryKey")}get default(){return this.record.get("default")?.split("::")[0]}set default(e){this.record.set("default",e)}get foreignKey(){return this.record.get("foreignKey")}set foreignKey(e){this.record.set("foreignKey",e)}async delete(){this.id&&await p.delete({id:this.id,tableId:this.tableId,projectId:this.projectId})}}const w=["varchar","int","boolean","json","jsonb","date","timestamp","uuid","real","numeric","text","bigint","smallint"],A={varchar:"'DEFAULT_VALUE'",int:"",boolean:"false",json:"'{}'::json",jsonb:"'{}'::jsonb",date:"now()",timestamp:"now()",uuid:"gen_random_uuid()",real:"0.0",numeric:"0",text:"'DEFAULT_VALUE'",bigint:"0",smallint:"0"};class ${async list(e){return s.get(`projects/${e}/tables`)}async create(e,t){return await s.post(`projects/${e.projectId}/tables`,t)}async get(e){return s.get(`projects/${e.projectId}/tables/${e.tableId}`)}async delete(e){return s.delete(`projects/${e.projectId}/tables/${e.tableId}`)}async selectRows(e){return s.get(`projects/${e.projectId}/tables/${e.tableId}/rows`,{limit:e.limit.toString(),offset:e.offset.toString(),search:e.search,where:JSON.stringify(e.where),orderBy:JSON.stringify(e.orderBy)})}async update(e,t){return s.patch(`projects/${e.projectId}/tables/${e.tableId}`,t)}async insertRow(e,t){return s.post(`projects/${e.projectId}/tables/${e.tableId}/rows`,t)}async updateRow(e,t){return s.patch(`projects/${e.projectId}/tables/${e.tableId}/rows/${e.rowId}`,t)}async deleteRow(e){return s.delete(`projects/${e.projectId}/tables/${e.tableId}/rows/${e.rowId}`)}async getByColumnID(e){return s.get(`projects/${e.projectId}/columns/${e.columnId}`)}}const o=new $;class l{constructor(e,t){this.projectId=e,this.record=g.from(t),this.columns=t.columns.map(r=>a.fromDTO({...r,projectId:t.projectId}))}record;columns;static async list(e){return(await o.list(e)).map(r=>new l(e,r))}static async fromColumnId(e,t){const r=await o.getByColumnID({projectId:e,columnId:t});return l.get(e,r.table.id)}static async create(e,t,r){const c=u(t,!1),d=await o.create({projectId:e},{name:c,id:r});return new l(e,d)}static async get(e,t){const r=await o.get({projectId:e,tableId:t});return new l(e,{...r.table,columns:r.columns})}async delete(e,t){return o.delete({projectId:e,tableId:t})}fixTraillingName(){this.name=u(this.name,!1)}async save(){if(Object.keys(this.record.changes).length!==0){this.record.changes.name&&this.fixTraillingName();try{await o.update({id:this.id,tableId:this.id,projectId:this.projectId},this.record.changes)}finally{this.record.resetChanges()}}}resetChanges(){this.record.resetChanges()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(){return this.record.hasChanges()}hasChangesDeep(e){return this.record.hasChangesDeep(e)&&u(this.name,!1)!==this.record.initialState.name}getColumns(){return this.columns??[]}getUnprotectedColumns(){return this.columns?.filter(e=>!e.protected).map(e=>e.toDTO())??[]}get id(){return this.record.get("id")}get name(){return this.record.get("name")}set name(e){const t=u(e,!0);this.record.set("name",t)}async addColumn(e){const t=await a.create(e.name,e.type,e.default,e.nullable,e.unique,this.id,this.projectId,e.foreignKey);return"error"in t?{success:!1,error:t.error}:this.columns?(this.columns.push(t),{success:!0,error:""}):(this.columns=[t],{success:!0,error:""})}getColumn(e){return this.columns?.find(t=>t.id&&t.id===e)}async select(e={},t,r,c,d){return o.selectRows({name:this.name,where:e,tableId:this.id,projectId:this.projectId,limit:r,offset:t,search:c,orderBy:d})}async insertRow(e){return o.insertRow({tableId:this.id,projectId:this.projectId},e)}async updateRow(e,t){return o.updateRow({tableId:this.id,projectId:this.projectId,rowId:e},t)}async deleteRow(e){return o.deleteRow({tableId:this.id,projectId:this.projectId,rowId:e})}}export{a as C,l as T,A as d,w as p};
//# sourceMappingURL=tables-DRvslhiY.js.map

var fe=Object.defineProperty;var ge=(i,t,l)=>t in i?fe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[t]=l;var R=(i,t,l)=>(ge(i,typeof t!="symbol"?t+"":t,l),l);import{a as z}from"./asyncComputed.f9fa4c71.js";import{d as k,r as O,a as g,b as s,u as e,o as m,f as o,cU as J,g as h,t as v,i as n,aI as Y,cW as he,bY as w,dj as ve,al as S,cE as C,bQ as V,cD as N,c as W,ac as H,ej as be,d9 as we,aY as X,er as ee,cJ as te,ei as Ce,U as ke,h as T,A as Pe,de as Ue}from"./jwt-decode.esm.32f71954.js";import{A as $}from"./index.c59ca45b.js";import{_ as xe}from"./DocsButton.vue_vue_type_script_setup_true_lang.c50f6a0a.js";import{d as L,k as I,p as U}from"./router.29e08ea4.js";import{C as le}from"./CrudView.ca91f805.js";import{G as ae}from"./PhPencil.vue.e0099a7f.js";import{C as Re}from"./repository.bfee664a.js";import{E as ne}from"./record.41c9caee.js";import{a as K}from"./ant-design.a8b36151.js";import{A as M,T as Ie}from"./Card.e1ec3051.js";import"./constants.b5d83622.js";import"./index.2400150a.js";import"./url.79cc02c3.js";import"./PhDotsThreeVertical.vue.e305b3a2.js";import"./fetch.a8fb4ba0.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[t]="6e6c8ff5-d3f1-42ca-9016-853b454ffe56",i._sentryDebugIdIdentifier="sentry-dbid-6e6c8ff5-d3f1-42ca-9016-853b454ffe56")}catch{}})();const $e=k({__name:"View",props:{signupPolicy:{}},emits:["updated","save"],setup(i,{emit:t}){const l=i,a=O(l.signupPolicy.strategy),r=O(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns:[]),c=O(l.signupPolicy.strategy==="patternOnly"?l.signupPolicy.emailPatterns.map(u=>({label:u})):[]),y=u=>{const P=u;if(r.value=P,P.length===0){a.value="inviteOnly",f("inviteOnly");return}c.value=P.map(x=>({label:x})),l.signupPolicy.emailPatterns=u,t("updated",l.signupPolicy)},_=()=>{t("save")},f=u=>{a.value=u,u!=="patternOnly"&&(u==="inviteOnly"&&l.signupPolicy.allowOnlyInvited(),t("updated",l.signupPolicy))};return(u,P)=>(m(),g(e(ve),{style:{"padding-top":"8px",width:"100%"},justify:"space-between",align:"flex-end"},{default:s(()=>[o(e(he),{value:a.value,"onUpdate:value":f},{default:s(()=>[o(e($),{direction:"vertical"},{default:s(()=>[o(e(J),{value:"inviteOnly"},{default:s(()=>[h(v(e(n).translate("i18n_signup_policy_invite_only",null)),1)]),_:1}),o(e($),null,{default:s(()=>[o(e(J),{value:"patternOnly"},{default:s(()=>[h(v(e(n).translate("i18n_signup_policy_pattern_only",null)),1)]),_:1}),o(e(Y),{mode:"tags",value:u.signupPolicy.emailPatterns,style:{"min-width":"300px"},placeholder:e(n).translate("i18n_signup_policy_domain_placeholder",null),disabled:a.value!=="patternOnly",options:c.value,"dropdown-match-select-width":"",open:!1,"onUpdate:value":y},null,8,["value","placeholder","disabled","options"])]),_:1})]),_:1})]),_:1},8,["value"]),o(e(w),{disabled:!u.signupPolicy.hasChanges,type:"primary",onClick:_},{default:s(()=>[h(v(e(n).translate("i18n_signup_policy_save_changes",null)),1)]),_:1},8,["disabled"])]),_:1}))}}),Oe=k({__name:"NewUser",props:{roleOptions:{}},emits:["created","cancel"],setup(i,{emit:t}){const a=i.roleOptions.map(_=>({label:_.name,value:_.name})),r=S({email:"",roles:[]});function c(){t("cancel")}function y(){!r.email||t("created",r)}return(_,f)=>(m(),g(e(L),{open:"",title:e(n).translate("i18n_user_editor_new_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:c},{extra:s(()=>[o(e($),null,{default:s(()=>[o(e(w),{onClick:c},{default:s(()=>[h(v(e(n).translate("i18n_user_editor_cancel",null)),1)]),_:1}),o(e(w),{type:"primary",onClick:y},{default:s(()=>[h(v(e(n).translate("i18n_user_editor_submit",null)),1)]),_:1})]),_:1})]),default:s(()=>[o(e(N),{model:r,layout:"vertical"},{default:s(()=>[o(e(C),{key:"email",label:e(n).translate("i18n_user_editor_email_label",null),required:!0},{default:s(()=>[o(e(V),{value:r.email,"onUpdate:value":f[0]||(f[0]=u=>r.email=u)},null,8,["value"])]),_:1},8,["label"]),o(e(C),{key:"role",label:e(n).translate("i18n_user_editor_role_label",null)},{default:s(()=>[o(e(Y),{value:r.roles,"onUpdate:value":f[1]||(f[1]=u=>r.roles=u),mode:"multiple",options:e(a)},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),je=k({__name:"UpdateUser",props:{roleOptions:{},email:{},roles:{}},emits:["updated","cancel"],setup(i,{emit:t}){const l=i,a=l.roleOptions.map(_=>({label:_.name,value:_.name})),r=S({email:l.email,roles:l.roles});function c(){t("cancel")}function y(){t("updated",r)}return(_,f)=>(m(),g(e(L),{open:"",title:e(n).translate("i18n_user_editor_update_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:c},{extra:s(()=>[o(e($),null,{default:s(()=>[o(e(w),{onClick:c},{default:s(()=>[h(v(e(n).translate("i18n_user_editor_cancel",null)),1)]),_:1}),o(e(w),{type:"primary",onClick:y},{default:s(()=>[h(v(e(n).translate("i18n_user_editor_submit",null)),1)]),_:1})]),_:1})]),default:s(()=>[o(e(N),{model:r,layout:"vertical"},{default:s(()=>[o(e(C),{key:"email",label:e(n).translate("i18n_user_editor_email_label",null)},{default:s(()=>[o(e(V),{value:r.email,"onUpdate:value":f[0]||(f[0]=u=>r.email=u)},null,8,["value"])]),_:1},8,["label"]),o(e(C),{key:"role",label:e(n).translate("i18n_user_editor_role_label",null)},{default:s(()=>[o(e(Y),{value:r.roles,"onUpdate:value":f[1]||(f[1]=u=>r.roles=u),mode:"multiple",options:e(a)},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Ae=k({__name:"View",props:{loading:{type:Boolean},users:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const t=i,l=W(()=>{var a;return{columns:[{title:n.translate("i18n_user_editor_email_label",null)},{title:n.translate("i18n_user_editor_roles_column",null)},{title:"",align:"right"}],rows:(a=t.users.map(r=>({key:r.email,cells:[{type:"text",text:r.email},{type:"slot",key:"roles",payload:{roles:r.roles}},{type:"actions",actions:[{icon:ae,label:n.translate("i18n_user_editor_edit",null),onClick:()=>t.onEdit(r)},{icon:ee,label:n.translate("i18n_user_editor_delete",null),onClick:()=>t.onDelete(r)}]}]})))!=null?a:[]}});return(a,r)=>(m(),g(le,{"entity-name":"users",title:"",loading:a.loading,description:e(n).translate("i18n_user_editor_view_description",null),"empty-title":e(n).translate("i18n_user_editor_empty_title",null),table:l.value,"create-button-text":e(n).translate("i18n_user_editor_add_button",null),create:a.onCreate},{roles:s(({payload:c})=>[(m(!0),H(X,null,be(c.roles,y=>(m(),g(e(we),{key:y,bordered:""},{default:s(()=>[h(v(y),1)]),_:2},1024))),128))]),_:1},8,["loading","description","empty-title","table","create-button-text","create"]))}}),Ee=k({__name:"NewRole",emits:["created","cancel"],setup(i,{emit:t}){const l=S({name:"",description:""});function a(){t("cancel")}function r(){!l.name||t("created",l)}return(c,y)=>(m(),g(e(L),{open:"",title:e(n).translate("i18n_role_editor_new_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:a},{extra:s(()=>[o(e($),null,{default:s(()=>[o(e(w),{onClick:a},{default:s(()=>[h(v(e(n).translate("i18n_role_editor_cancel",null)),1)]),_:1}),o(e(w),{type:"primary",onClick:r},{default:s(()=>[h(v(e(n).translate("i18n_role_editor_submit",null)),1)]),_:1})]),_:1})]),default:s(()=>[o(e(N),{model:l,layout:"vertical"},{default:s(()=>[o(e(C),{key:"name",label:e(n).translate("i18n_role_editor_name_label",null),required:!0},{default:s(()=>[o(e(V),{value:l.name,"onUpdate:value":y[0]||(y[0]=_=>l.name=_)},null,8,["value"])]),_:1},8,["label"]),o(e(C),{key:"description",label:e(n).translate("i18n_role_editor_description_label",null)},{default:s(()=>[o(e(te),{value:l.description,"onUpdate:value":y[1]||(y[1]=_=>l.description=_),placeholder:e(n).translate("i18n_role_editor_description_placeholder",null),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),De=k({__name:"UpdateRole",props:{name:{},description:{}},emits:["updated","cancel"],setup(i,{emit:t}){const l=i,a=S({description:l.description});function r(){t("cancel")}function c(){t("updated",a)}return(y,_)=>(m(),g(e(L),{open:"",title:e(n).translate("i18n_role_editor_update_title",null),width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:r},{extra:s(()=>[o(e($),null,{default:s(()=>[o(e(w),{onClick:r},{default:s(()=>[h(v(e(n).translate("i18n_role_editor_cancel",null)),1)]),_:1}),o(e(w),{type:"primary",onClick:c},{default:s(()=>[h(v(e(n).translate("i18n_role_editor_submit",null)),1)]),_:1})]),_:1})]),default:s(()=>[o(e(N),{model:a,layout:"vertical"},{default:s(()=>[o(e(C),{key:"name",label:e(n).translate("i18n_role_editor_name_label",null)},{default:s(()=>[o(e(V),{value:l.name,disabled:""},null,8,["value"])]),_:1},8,["label"]),o(e(C),{key:"role",label:e(n).translate("i18n_role_editor_description_label",null)},{default:s(()=>[o(e(te),{value:a.description,"onUpdate:value":_[0]||(_[0]=f=>a.description=f),placeholder:e(n).translate("i18n_role_editor_description_placeholder",null),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"]))}}),Te=k({__name:"View",props:{loading:{type:Boolean},roles:{},onCreate:{type:Function},onEdit:{type:Function},onDelete:{type:Function}},setup(i){const t=i,l=W(()=>{var a;return{columns:[{title:n.translate("i18n_role_editor_name_label",null)},{title:n.translate("i18n_role_editor_description_label",null)},{title:"",align:"right"}],rows:(a=t.roles.map(r=>({key:r.id,cells:[{type:"text",text:r.name},{type:"text",text:r.description},{type:"actions",actions:[{icon:ae,label:n.translate("i18n_role_editor_edit",null),onClick:()=>t.onEdit(r)},{icon:ee,label:n.translate("i18n_role_editor_delete",null),onClick:()=>t.onDelete(r)}]}]})))!=null?a:[]}});return(a,r)=>(m(),g(le,{"entity-name":"roles",loading:a.loading,title:"",description:e(n).translate("i18n_role_editor_view_description",null),"empty-title":e(n).translate("i18n_role_editor_empty_title",null),table:l.value,"create-button-text":e(n).translate("i18n_role_editor_add_button",null),create:a.onCreate},null,8,["loading","description","empty-title","table","create-button-text","create"]))}}),B=class{constructor(t){R(this,"record");this.dto=t,this.record=ne.from(t)}static from(t){return new B(t)}toDTO(){return this.record.toDTO()}get id(){return this.record.get("id")}get projectId(){return this.record.get("projectId")}get emailPatterns(){return this.record.get("emailPatterns")}set emailPatterns(t){this.record.set("emailPatterns",t)}get hasChanges(){return this.record.hasChangesDeep("emailPatterns")}get strategy(){return this.dto.emailPatterns.length===0?"inviteOnly":"patternOnly"}get changes(){return this.record.changes}allowOnlyInvited(){this.record.set("emailPatterns",[])}static validate(t){return B.pattern.test(t)}};let j=B;R(j,"pattern",new RegExp("^@?(?!-)[A-Za-z0-9-]{1,}(?<!-)(\\.[A-Za-z]{2,})+$"));class Fe{constructor(){R(this,"urlPath","signup-policy")}async update(t,l){return I.patch(`projects/${t}/${this.urlPath}`,l)}async get(t){return I.get(`projects/${t}/${this.urlPath}`)}}const Q=new Fe;class Be{constructor(t){this.projectId=t}async update(t){const{emailPatterns:l}=t.changes;if(!l)return t;const a=await Q.update(this.projectId,{emailPatterns:l});return j.from(a)}async get(){const t=await Q.get(this.projectId);return j.from(t)}}class Z{constructor(t){R(this,"record");this.dto=t,this.record=ne.from(t)}static from(t){return new Z(t)}toDTO(){return this.record.toDTO()}get changes(){return this.record.changes}get id(){return this.record.get("id")}get email(){return this.record.get("email")}set email(t){this.record.set("email",t)}get projectId(){return this.record.get("projectId")}get roles(){return this.record.get("roles")}set roles(t){this.record.set("roles",t)}update(t){this.record.update(t)}resetChanges(){this.record.resetChanges()}}class Se{constructor(){R(this,"urlPath","users")}async create(t,l){return I.post(`projects/${t}/${this.urlPath}`,l)}async delete(t,l){await I.delete(`projects/${t}/${this.urlPath}/${l}`)}async list(t,{limit:l,offset:a}){const r={};l&&(r.limit=l.toString()),a&&(r.offset=a.toString());const c=new URLSearchParams(r);return I.get(`projects/${t}/${this.urlPath}?${c.toString()}`)}async update(t,l,a){return I.patch(`projects/${t}/${this.urlPath}/${l}`,a)}}const F=new Se;class Ve{constructor(t){this.projectId=t}async create(t){await F.create(this.projectId,t)}async update(t,l){await F.update(this.projectId,t,l)}async delete(t){await F.delete(this.projectId,t)}async list(t,l){return(await F.list(this.projectId,{limit:t,offset:l})).map(Z.from)}}const at=k({__name:"View",setup(i){const l=Ce().params.projectId,a=O({type:"initial"}),r=O("users");ke(()=>{const p=new URLSearchParams(location.search).get("selected-panel")||"users",b=["roles","users"].includes(p)?p:"users";p&&(r.value=b)});const c=()=>{a.value.type="initial"},y=()=>{a.value.type="creatingUser"},_=d=>{a.value={type:"editingUser",payload:d}},f=()=>{a.value.type="creatingRole"},u=d=>{a.value={type:"editingRole",payload:d}},P=new Be(l),{result:x,refetch:re}=z(()=>P.get()),oe=async()=>{if(!!x.value)try{await P.update(x.value),re()}catch(d){d instanceof Error&&U(n.translate("i18n_access_control_update_error",null),d.message)}},A=new Ve(l),{loading:se,result:ie,refetch:E}=z(()=>A.list(100,0)),D=new Re(l),{loading:ce,result:q,refetch:G}=z(()=>D.list(100,0)),ue=async d=>{try{if(a.value.type!=="creatingUser")return;await A.create(d),c(),E()}catch(p){p instanceof Error&&U(n.translate("i18n_access_control_create_error",null),p.message)}},de=async d=>{try{if(a.value.type!=="editingUser")return;await A.update(a.value.payload.id,d),c(),E()}catch(p){p instanceof Error&&U(n.translate("i18n_access_control_update_error",null),p.message)}},pe=async d=>{if(!!await K(n.translate("i18n_access_control_delete_user_confirm",null)))try{await A.delete(d.id),E()}catch(b){b instanceof Error&&U(n.translate("i18n_access_control_delete_error",null),b.message)}},_e=async d=>{try{if(a.value.type!=="creatingRole")return;await D.create(d),c(),G()}catch(p){p instanceof Error&&U(n.translate("i18n_access_control_create_error",null),p.message)}},me=async d=>{try{if(a.value.type!=="editingRole")return;await D.update(a.value.payload.id,d),c(),G()}catch(p){p instanceof Error&&U(n.translate("i18n_access_control_update_error",null),p.message)}},ye=async d=>{if(!!await K(n.translate("i18n_access_control_delete_role_confirm",null)))try{await D.delete(d.id),G(),E()}catch(b){b instanceof Error&&U(n.translate("i18n_access_control_delete_error",null),b.message)}};return(d,p)=>(m(),H(X,null,[o(e(Pe),null,{default:s(()=>[h(v(e(n).translate("i18n_access_control_title",null)),1)]),_:1}),o(e(Ue),null,{default:s(()=>[h(v(e(n).translate("i18n_access_control_description",null))+" ",1),o(xe,{path:"tools/access-control"})]),_:1}),o(e(Ie),{"active-key":r.value,"onUpdate:activeKey":p[0]||(p[0]=b=>r.value=b)},{default:s(()=>[o(e(M),{key:"users",tab:e(n).translate("i18n_access_control_users_tab",null)},null,8,["tab"]),o(e(M),{key:"roles",tab:e(n).translate("i18n_access_control_roles_tab",null)},null,8,["tab"])]),_:1},8,["active-key"]),r.value==="users"&&e(x)?(m(),g($e,{key:0,"signup-policy":e(x),onSave:oe},null,8,["signup-policy"])):T("",!0),r.value==="users"?(m(),g(Ae,{key:1,loading:e(se),users:e(ie)||[],onCreate:y,onEdit:_,onDelete:pe},null,8,["loading","users"])):T("",!0),r.value==="roles"?(m(),g(Te,{key:2,loading:e(ce),roles:e(q)||[],onCreate:f,onEdit:u,onDelete:ye},null,8,["loading","roles"])):T("",!0),a.value.type==="creatingUser"?(m(),g(Oe,{key:3,"role-options":e(q)||[],onCancel:c,onCreated:ue},null,8,["role-options"])):a.value.type==="editingUser"?(m(),g(je,{key:4,email:a.value.payload.email,roles:a.value.payload.roles||[],"role-options":e(q)||[],onUpdated:de,onCancel:c},null,8,["email","roles","role-options"])):a.value.type==="creatingRole"?(m(),g(Ee,{key:5,onCancel:c,onCreated:_e})):a.value.type==="editingRole"?(m(),g(De,{key:6,name:a.value.payload.name,description:a.value.payload.description,onUpdated:me,onCancel:c},null,8,["name","description"])):T("",!0)],64))}});export{at as default};
//# sourceMappingURL=View.67504c02.js.map

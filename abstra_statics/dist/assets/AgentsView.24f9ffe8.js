var U=Object.defineProperty;var R=(s,e,n)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>(R(s,typeof e!="symbol"?e+"":e,n),n);import{C as T}from"./ConnectorCard.2bb377ad.js";import{_ as V}from"./AbstraButton.vue_vue_type_script_setup_true_lang.a643d3ac.js";import{f as P,cE as I,d as F,o as l,c as u,w as i,b as a,u as t,d5 as b,az as c,ea as E,c_ as O,bK as B,bs as G,bq as v,F as m,da as p,eF as x,eG as q,a as M,Q as j,e3 as K,K as w,aL as _,d6 as y,d4 as L,e9 as $,cs as z,bE as Q,ef as Y}from"./index.f15cb536.js";import{C as A}from"./gateway.ee243f16.js";import{C as H}from"./router.8f01412f.js";import{G as J}from"./PhDotsThreeVertical.vue.b75560a4.js";import{A as W}from"./Avatar.368279c6.js";import{C as X}from"./Card.61b8789c.js";import{A as Z}from"./index.fe0be999.js";import"./popupNotifcation.8270aa41.js";import"./Badge.55963c6c.js";import"./TabPane.b1f788aa.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="2510fa0d-0c87-47ff-ae30-2180f770aa08",s._sentryDebugIdIdentifier="sentry-dbid-2510fa0d-0c87-47ff-ae30-2180f770aa08")}catch{}})();class ee{async listAgents(){return A.get("agents")}async listAgentConnections(e){return A.get(`projects/${e}/agents/connections`)}async createAgentConnection({projectId:e,agentId:n}){return A.post(`projects/${e}/agents/connections`,{agentId:n})}async renameAgentConnection({projectId:e,agentConnectionId:n,newAgentConnectionName:o}){return A.patch(`projects/${e}/agents/connections/${n}`,{newAgentConnectionName:o})}async deleteAgentConnection({projectId:e,agentConnectionId:n}){return A.delete(`projects/${e}/agents/connections/${n}`)}}const te="/src/assets/logo.svg";class S{constructor(e){this.data=e}get id(){return this.data.id}get name(){return this.data.name}get description(){return this.data.description}get setupPath(){return this.data.setupPath}get logoURL(){return this.data.logoURL||te}get unavailable(){return!this.data.isAvailable}}class ne{constructor(e){this.data=e}get id(){return this.data.id}get connectionName(){return this.data.connectionName}get agentId(){return this.data.agentId}get clientProjectId(){return this.data.clientProjectId}get connectionStatus(){return this.data.connectionStatus}}class oe{constructor(e){C(this,"agentConnection");C(this,"agent");C(this,"redirectURL");this.data=e,this.agentConnection=new ne(e.agentConnection),this.agent=new S(e.agent),this.redirectURL=e.redirectURL}}class ie{constructor(e,n){C(this,"state");this.api=e,this.projectId=n,this.state=P({agents:[],agentConnectionDetailsList:[],selectedAgentForConnection:null,editingAgentConnection:{selectedAgentConnection:null,newName:"",errorMessage:null}})}get agents(){return this.state.value.agents}get agentConnectionDetailsList(){return this.state.value.agentConnectionDetailsList}get selectedAgentForConnection(){return this.state.value.selectedAgentForConnection}get selectedAgentConnectionForEditing(){return this.state.value.editingAgentConnection.selectedAgentConnection}get editingNewName(){return this.state.value.editingAgentConnection.newName}set editingNewName(e){this.state.value.editingAgentConnection.newName=e}get editingErrorMessage(){return this.state.value.editingAgentConnection.errorMessage}hasChanges(){return!!this.state.value.editingAgentConnection.selectedAgentConnection&&this.state.value.editingAgentConnection.newName!==this.state.value.editingAgentConnection.selectedAgentConnection.connectionName}async fetchInitialState(){await Promise.all([this.fetchAgents(),this.fetchAgentConnections()])}async fetchAgents(){const e=await this.api.listAgents();this.state.value.agents=e.map(n=>new S(n))}async fetchAgentConnections(){const e=await this.api.listAgentConnections(this.projectId);this.state.value.agentConnectionDetailsList=e.map(n=>new oe(n))}cancelAgentConnectionCreation(){this.state.value.selectedAgentForConnection=null}cancelAgentConnectionEditing(){this.state.value.editingAgentConnection.selectedAgentConnection=null,this.state.value.editingAgentConnection.newName="",this.removeEditingErrorMessage()}async createAgentConnection(){if(!this.state.value.selectedAgentForConnection)return;const n=(await this.api.createAgentConnection({projectId:this.projectId,agentId:this.state.value.selectedAgentForConnection.id})).redirectUrl;n?window.location.href=n:(await this.fetchAgentConnections(),this.cancelAgentConnectionCreation())}handleEditAgentConnectionClick(e){this.state.value.editingAgentConnection.newName=e.connectionName,this.state.value.editingAgentConnection.selectedAgentConnection=e}async renameAgentConnection(){try{await this.api.renameAgentConnection({projectId:this.projectId,agentConnectionId:this.state.value.editingAgentConnection.selectedAgentConnection.id,newAgentConnectionName:this.state.value.editingAgentConnection.newName}),this.cancelAgentConnectionEditing(),await this.fetchAgentConnections()}catch{this.state.value.editingAgentConnection.errorMessage="There's already a connection to the same agent with this name"}}removeEditingErrorMessage(){this.state.value.editingAgentConnection.errorMessage=null}async deleteAgentConnection(e){await this.api.deleteAgentConnection({projectId:this.projectId,agentConnectionId:e}),await this.fetchAgentConnections()}handleDeleteAgentConnectionClick(e){I.confirm({title:`Are you sure you want to delete ${e.connectionName}?`,onOk:()=>this.deleteAgentConnection(e.id)})}showNewAgentConnectionModal(e){this.state.value.selectedAgentForConnection=e}handleSetupAgentConnectionClick(e){!e.redirectURL||(window.location.href=e.redirectURL)}}const ae=s=>(x("data-v-4372bea0"),s=s(),q(),s),se=ae(()=>M("div",{style:{"flex-grow":"1"}},null,-1)),re=F({__name:"AgentConnectionCard",props:{agentConnectionDetails:{},controller:{}},setup(s){function e(n){switch(n){case"connected":return"success";case"pending":return"warning";default:return"default"}}return(n,o)=>(l(),u(t(X),null,{default:i(()=>[a(t(p),{align:"center",gap:16},{default:i(()=>[a(t(W),{src:n.agentConnectionDetails.agent.logoURL,height:"40px",shape:"square"},null,8,["src"]),a(t(b),{strong:""},{default:i(()=>[c(E(n.agentConnectionDetails.agent.name),1)]),_:1}),se,a(t(b),{content:n.agentConnectionDetails.agentConnection.connectionName,code:""},null,8,["content"]),a(t(O),{class:"status-tag",color:e(n.agentConnectionDetails.agentConnection.connectionStatus)},{default:i(()=>[c(E(n.agentConnectionDetails.agentConnection.connectionStatus),1)]),_:1},8,["color"]),a(t(B),null,{overlay:i(()=>[a(t(G),null,{default:i(()=>[n.agentConnectionDetails.redirectURL?(l(),u(t(v),{key:0,onClick:o[0]||(o[0]=h=>n.controller.handleSetupAgentConnectionClick(n.agentConnectionDetails))},{default:i(()=>[c(" Setup ")]),_:1})):m("",!0),a(t(v),{onClick:o[1]||(o[1]=h=>n.controller.handleEditAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:i(()=>[c(" Rename ")]),_:1}),a(t(v),{danger:"",onClick:o[2]||(o[2]=h=>n.controller.handleDeleteAgentConnectionClick(n.agentConnectionDetails.agentConnection))},{default:i(()=>[c(" Disconnect ")]),_:1})]),_:1})]),default:i(()=>[a(t(J))]),_:1})]),_:1})]),_:1}))}});const ce=j(re,[["__scopeId","data-v-4372bea0"]]),le={class:"agents-grid"},ge=F({__name:"AgentsView",setup(s){const n=K().params.projectId,o=new ie(new ee,n);o.fetchInitialState();function h(f){f.unavailable?H.showNewMessage(Y.translate("i18n_agents_ask_for_access",null,f.name)):o.showNewAgentConnectionModal(f)}return(f,r)=>{var N,k;return l(),w(_,null,[a(t(Z),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:i(()=>{var g,D;return[a(t(y),null,{default:i(()=>[c("Agents")]),_:1}),a(t(L),null,{default:i(()=>[c("Add and manage external integrations to your project.")]),_:1}),(g=t(o).agentConnectionDetailsList)!=null&&g.length?(l(),u(t(p),{key:0,vertical:""},{default:i(()=>[a(t(y),{level:2},{default:i(()=>[c("Connected")]),_:1}),a(t(p),{vertical:"",gap:10},{default:i(()=>[(l(!0),w(_,null,$(t(o).agentConnectionDetailsList,d=>(l(),u(ce,{key:d.agentConnection.id,"agent-connection-details":d,controller:t(o)},null,8,["agent-connection-details","controller"]))),128))]),_:1})]),_:1})):m("",!0),(D=t(o).agents)!=null&&D.length?(l(),u(t(p),{key:1,vertical:""},{default:i(()=>[a(t(y),{level:2},{default:i(()=>[c("All")]),_:1}),M("div",le,[(l(!0),w(_,null,$(t(o).agents,d=>(l(),u(T,{key:d.id,title:d.name,"logo-url":d.logoURL,description:d.description,unavailable:d.unavailable,onClick:de=>h(d)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})):m("",!0)]}),_:1}),a(t(I),{open:!!t(o).selectedAgentForConnection,title:(N=t(o).selectedAgentForConnection)==null?void 0:N.name,"ok-text":"Connect",onCancel:r[0]||(r[0]=g=>t(o).cancelAgentConnectionCreation()),onOk:r[1]||(r[1]=g=>t(o).createAgentConnection())},{default:i(()=>[a(t(L),null,{default:i(()=>[c("You will be redirected to the Agent's setup page.")]),_:1})]),_:1},8,["open","title"]),a(t(I),{open:!!t(o).selectedAgentConnectionForEditing,title:`${(k=t(o).selectedAgentConnectionForEditing)==null?void 0:k.connectionName} Connection`,onCancel:r[5]||(r[5]=g=>t(o).cancelAgentConnectionEditing())},{footer:i(()=>[a(t(p),{justify:"end"},{default:i(()=>[a(V,{type:"primary",disabled:!t(o).hasChanges(),onClick:r[4]||(r[4]=g=>t(o).renameAgentConnection())},{default:i(()=>[c(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[a(t(z),{"has-feedback":"","validate-status":t(o).editingErrorMessage?"error":"",help:t(o).editingErrorMessage},{default:i(()=>[t(o).selectedAgentConnectionForEditing?(l(),u(t(Q),{key:0,value:t(o).editingNewName,"onUpdate:value":r[2]||(r[2]=g=>t(o).editingNewName=g),onChange:r[3]||(r[3]=g=>t(o).removeEditingErrorMessage())},null,8,["value"])):m("",!0)]),_:1},8,["validate-status","help"])]),_:1},8,["open","title"])],64)}}});const ke=j(ge,[["__scopeId","data-v-f3283209"]]);export{ke as default};
//# sourceMappingURL=AgentsView.24f9ffe8.js.map

var w=Object.defineProperty;var y=(r,e,t)=>e in r?w(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>(y(r,typeof e!="symbol"?e+"":e,t),t);import{C}from"./CrudView.30f57cae.js";import{e as s,f,ej as I,ep as E,d as T,ea as k,eo as x,o as b,Y as z,b as l,u as a,w as u,aS as A,c as _,cz as g,cS as O,aB as R,dh as S,S as V,cL as F}from"./index.0dbe12ae.js";import{a as M}from"./gateway.8367a2b1.js";import{M as P}from"./member.645cbbb8.js";import"./tables.fe0267c9.js";import{a as v}from"./ant-design.f87f5e81.js";import{T as j,G as D}from"./tagColorProvider.de979aa1.js";import"./router.d0f97237.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.ed8ee373.js";import"./BookOutlined.9d1c7985.js";import"./url.f5cd570a.js";import"./PhDotsThreeVertical.vue.668153b7.js";import"./Badge.9e1d659f.js";import"./index.3c666224.js";import"./popupNotifcation.ea5628ff.js";import"./record.f667204e.js";import"./string.fe250db8.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="b20125a5-a478-4106-9927-44199639df21",r._sentryDebugIdIdentifier="sentry-dbid-b20125a5-a478-4106-9927-44199639df21")}catch{}})();const B=[{label:"Admin",value:"admin"},{label:"Editor",value:"editor"}],L={admin:"Has full access to the organization, projects and editors",editor:"Can only manage projects within their teams"};class N{constructor({authorEmail:e,organizationId:t,api:n,handlers:m}){i(this,"members",s([]));i(this,"teamOptions",s([]));i(this,"selectedMember",s(null));i(this,"draftMember",s(null));i(this,"creationFields",f(()=>this.getCreationFields()));i(this,"table",f(()=>this.makeCrudViewTable()));i(this,"loading",s(!1));i(this,"authorEmail");i(this,"organizationId");i(this,"api");i(this,"handlers");i(this,"currentMember",s(null));i(this,"teamColorProvider",new j);i(this,"confirmAddMember",async e=>{await this.api.create({organizationId:this.organizationId,email:e.email,teams:e.teams}),await this.fetchState()});i(this,"openEditMemberModal",e=>{this.draftMember.value=I.exports.cloneDeep(e),this.selectedMember.value=e,this.fetchTeamOptions()});i(this,"confirmUpdateMember",async()=>{var e,t;this.loading.value=!0,this.draftMember.value&&(await this.api.update(this.organizationId,this.draftMember.value.authorId,{role:(e=this.draftMember.value)==null?void 0:e.role,teams:(t=this.draftMember.value)==null?void 0:t.teams}),await this.fetchState(),this.draftMember.value=null,this.selectedMember.value=null,this.loading.value=!1)});i(this,"cancelEditMember",()=>{this.draftMember.value=null,this.selectedMember.value=null});this.authorEmail=e,this.organizationId=t,this.api=n,this.handlers=m}async fetchState(){this.loading.value=!0,await this.fetchMembers(),await this.fetchTeamOptions(),this.setCurrentMember(),this.loading.value=!1}setCurrentMember(){var e;this.currentMember.value=(e=this.members.value.find(t=>t.email===this.authorEmail))!=null?e:null}async fetchMembers(){this.members.value=await this.api.list(this.organizationId)}async fetchTeamOptions(){const e=await this.api.fetchTeamOptions(this.organizationId);this.teamOptions.value=e.map(t=>({label:t,value:t}))}async removeMember(e){var n;if(((n=M.getAuthor())==null?void 0:n.claims.email)===e.email){await v("Removing your own access will block you from this organization. Are you sure?",{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),this.handlers.onSelfRemove());return}await v(`Are you sure you want to remove ${e.email} access?`,{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),await this.fetchMembers())}getCreationFields(){var t;const e=[{key:"email",label:"Email",type:"text"}];return((t=this.currentMember.value)==null?void 0:t.role)==="admin"&&e.push({key:"teams",type:"select",mode:"tags",options:this.teamOptions.value,label:"Teams"}),e}makeCrudViewActions(e){var t;return((t=this.currentMember.value)==null?void 0:t.role)==="editor"?[]:[{icon:D,label:"Edit Permissions",onClick:()=>this.openEditMemberModal(e)},{icon:E,label:"Remove access",onClick:()=>this.removeMember(e),dangerous:!0}]}getTeamTags(e){const t=e.teams.map(n=>({text:n,color:this.teamColorProvider.getColor(n)}));return e.role==="admin"&&t.unshift({text:"Admin",color:"red"}),t}makeColumns(){var e;return((e=this.currentMember.value)==null?void 0:e.role)==="editor"?[{title:"Email",align:"center"},{title:"Teams",align:"center"}]:[{title:"Email",align:"center"},{title:"Teams",align:"center"},{title:"",align:"right"}]}makeCrudViewTable(){return{columns:this.makeColumns(),rows:this.members.value.map(e=>({key:e.email,cells:[{type:"text",text:e.email},{type:"tags",tags:this.getTeamTags(e)},{type:"actions",actions:this.makeCrudViewActions(e)}]}))}}}const se=T({__name:"EditorsView",setup(r){var p;const e=k(),t=x(),n=e.params.organizationId,m=new P,h=(p=M.getAuthor())==null?void 0:p.claims.email;if(!h)throw new Error("Author email is not available");const o=new N({organizationId:n,api:m,authorEmail:h,handlers:{onSelfRemove:()=>{t.push("organizations")}}});return o.fetchState(),(U,d)=>(b(),z(A,null,[l(C,{"entity-name":"editor",loading:a(o).loading.value,title:"Editors",description:"Manage the editors and their permissions for this organization.","empty-title":"No editors yet",table:a(o).table.value,"create-button-text":"Invite Editor",fields:a(o).creationFields.value,create:a(o).confirmAddMember},null,8,["loading","table","fields","create"]),l(a(F),{open:!!a(o).draftMember.value,title:"Editor Permissions","ok-text":"Apply","cancel-text":"Cancel","confirm-loading":a(o).loading.value,onOk:a(o).confirmUpdateMember,onCancel:a(o).cancelEditMember},{default:u(()=>[a(o).draftMember.value?(b(),_(a(S),{key:0,vertical:"",justify:"center",gap:"0",style:{padding:"15px 0px 0px 0px"}},{default:u(()=>[l(a(g),{colon:!1,label:"Role",help:a(L)[a(o).draftMember.value.role]},{default:u(()=>[l(a(O),{value:a(o).draftMember.value.role,"onUpdate:value":d[0]||(d[0]=c=>a(o).draftMember.value.role=c),options:a(B)},null,8,["value","options"])]),_:1},8,["help"]),l(a(g),{colon:!1,label:"Teams",tooltip:"Editor will have access to projects within these teams"},{default:u(()=>[l(a(R),{value:a(o).draftMember.value.teams,"onUpdate:value":d[1]||(d[1]=c=>a(o).draftMember.value.teams=c),options:a(o).teamOptions.value,mode:"tags",placeholder:"Select or type new team name"},null,8,["value","options"])]),_:1})]),_:1})):V("",!0)]),_:1},8,["open","confirm-loading","onOk","onCancel"])],64))}});export{se as default};
//# sourceMappingURL=EditorsView.6ca4bc0c.js.map

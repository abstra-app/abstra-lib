var _e=Object.defineProperty;var fe=(s,e,t)=>e in s?_e(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var P=(s,e,t)=>(fe(s,typeof e!="symbol"?e+"":e,t),t);import{d as T,E as M,F as N,ex as me,b as l,c as d,bu as h,aS as z,eF as q,er as n,eu as w,eA as C,e as S,eQ as ge,bh as O,eB as Z,eC as ee,t as R,es as ye,U as be,o as A,a as te,c2 as x,bw as se,ez as ne,ew as L,u as oe,V as we,aT as ke,r as m,ey as Se,G as ae,a1 as Ce,J as re,I,et as $e,eR as Ie,eS as Te,eT as Ee}from"./registerWidgets.fc9d5fd6.js";import{p as xe,k as W,n as Y,o as G,q as Le}from"./icons.c6cfa25a.js";import{a as Q}from"./asyncComputed.11711b1c.js";import{F as Me}from"./forms.7463d00f.js";import{D as Re}from"./dashes.307fecbb.js";import{H as Ae}from"./hooks.e0ea7f0b.js";import{J as X}from"./jobs.da7f6c4d.js";import{W as Ue}from"./workspaces.459fe32e.js";import{u as H}from"./uuid.7c316e77.js";import{L as De}from"./DocsButton.977e14dd.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="d612d0f8-bb68-4d20-a307-9928e64f11d0",s._sentryDebugIdIdentifier="sentry-dbid-d612d0f8-bb68-4d20-a307-9928e64f11d0")}catch{}})();const ie=s=>(Z("data-v-0dfc8705"),s=s(),ee(),s),Be={class:"runtime-settings"},Fe={key:0,class:"field"},Pe=ie(()=>n("div",{class:"label"},"Path",-1)),Ve={class:"field"},ze=ie(()=>n("div",{class:"label"},"Code",-1)),He={class:"input-row"},Ne={key:1,class:"root-path loading"},Oe={class:"path-feedback"},je={key:1,class:"error"},Je=T({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(s){const e=s,t=M({pathError:null}),{result:o}=Q(()=>Ue.get()),c=()=>{!o.value||!e.runtime.file||o.value.openFile(e.runtime.file)},i=N(()=>{var r;return(r=e.runtime.file)!=null&&r.endsWith(".py")?null:"It should be a .py file"}),a=()=>{!o.value||!p.value||o.value.openFile(".")},v=me(),{result:p}=Q(()=>fetch("/_editor/api/workspace/root-path").then(r=>r.text()));return e.runtime.onUpdate(r=>{if(e.runtime instanceof X||!r||!("path"in r)||!(r!=null&&r.path))return;const f=[{runtime:Me,basePath:"form"},{runtime:Ae,basePath:"hook"},{runtime:Re,basePath:"dash"}].find(U=>e.runtime instanceof U.runtime);if(!f)throw new Error(`Unknown runtime type ${e.runtime}`);v.push({path:`/_editor/${f.basePath}/${encodeURIComponent(r.path)}`})}),(r,_)=>(l(),d("div",Be,[r.runtime instanceof h(X)?w("",!0):(l(),d("div",Fe,[Pe,z(n("input",{"onUpdate:modelValue":_[0]||(_[0]=f=>r.runtime.path=f),class:"path-input",type:"text"},null,512),[[q,r.runtime.path]])])),n("div",Ve,[ze,n("div",He,[h(p)?(l(),d("button",{key:0,class:"root-path",onClick:_[1]||(_[1]=f=>a())},C(h(p)),1)):(l(),d("span",Ne," Loading... ")),z(n("input",{"onUpdate:modelValue":_[2]||(_[2]=f=>r.runtime.file=f),type:"text"},null,512),[[q,r.runtime.file]]),n("button",{class:"open-file-icon",onClick:_[3]||(_[3]=f=>c())},[S(ge,{path:h(xe)},null,8,["path"]),O(" Open in editor ")])]),n("div",Oe,C(i.value),1)]),t.pathError?(l(),d("div",je,C(t.pathError),1)):w("",!0)]))}});const xt=R(Je,[["__scopeId","data-v-0dfc8705"]]),Ke={class:"tab-menu"},qe={class:"tabs"},We={key:0,class:"group"},Ye={class:"group"},Ge=["onClick"],Qe={key:1,class:"group"},Xe={class:"content"},Ze=T({__name:"TabMenuUnderline",setup(s){const e=M([]),t=ye(),o=i=>{const a=v=>v==i;e.forEach((v,p)=>{v.isActive=a(p)})},c=N(()=>e.findIndex(i=>i.isActive));return be("addTab",i=>{e.push(i)}),A(()=>{o(0)}),(i,a)=>{const v=te("icon");return l(),d("div",Ke,[n("div",qe,[h(t).left?(l(),d("div",We,[x(i.$slots,"left",{},void 0,!0)])):w("",!0),n("div",Ye,[(l(!0),d(se,null,ne(e,(p,r)=>(l(),d("button",{key:p.title,class:L(["form-tab",c.value==r&&"active"]),onClick:_=>o(r)},[p.icon?(l(),oe(v,{key:0,path:p.icon,fill:"#8692A5",width:"10",height:"10"},null,8,["path"])):w("",!0),O(" "+C(p.title),1)],10,Ge))),128))]),h(t).right?(l(),d("div",Qe,[x(i.$slots,"right",{},void 0,!0)])):w("",!0)]),n("div",Xe,[x(i.$slots,"default",{},void 0,!0)])])}}});const Lt=R(Ze,[["__scopeId","data-v-60b2affa"]]),et={class:"tab"},tt=T({__name:"Tab",props:{title:{},icon:{}},setup(s){const e=s,t=M({isActive:!1,title:e.title,icon:e.icon}),o=we("addTab");return A(()=>{o(t)}),(c,i)=>z((l(),d("div",et,[x(c.$slots,"default",{},void 0,!0)],512)),[[ke,t.isActive]])}});const Mt=R(tt,[["__scopeId","data-v-9c2e92c2"]]);class le{constructor(){P(this,"logState",M({log:[]}));P(this,"_listeners",{})}static create(){return new le}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const o=t?this.logs.find(c=>c.id===t):null;return o?Object.assign(o,e):this.logs.push({...e,id:t||H()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=H();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class st{static async*sendMessage(e,t){var i;const c=(i=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:i.getReader();if(!c)throw new Error("No response body");for(;;){const a=await c.read();if(a.done)break;yield new TextDecoder().decode(a.value)}}}const nt=s=>(Z("data-v-cfdedb79"),s=s(),ee(),s),ot={class:"smart-console"},at={class:"header"},rt={class:"left"},it={class:"right"},lt=["unseen-severity"],ct={class:"cli"},ut={class:"left"},dt=nt(()=>n("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),pt={key:1,class:"local-entry"},vt={class:"input"},ht=["pointer-events","onKeydown"],_t={class:"right"},ft=T({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(s,{emit:e}){const t=s,o=m(""),c=m(null),i=Se(),a=m({type:"seen"}),v=m(!1),p=m(!1),r=()=>{t.logService.clear(),e("restart")},_=()=>{$.value=$.value==="assistant"?"debugger":"assistant"};function f(u){switch(u.type){case"ai-input":return{role:"user",content:u.log};case"ai-output":return{role:"assistant",content:u.log};case"stderr":case"stdout":return{role:"user",content:u.log};case"restart":return{role:"user",content:"-- new session --"};default:throw new Error(`Unknown log type: ${u.type}`)}}function U(){b.value=!b.value,b.value&&(a.value={type:"seen"})}ae(i,()=>{t.logService.clear(),e("clear-terminal")});const E=m(null),$=m("assistant"),ce=async u=>{var y;if(u.preventDefault(),o.value=((y=E.value)==null?void 0:y.innerText)||"",u.shiftKey){document.execCommand("insertLineBreak");return}E.value&&(E.value.innerText=""),$.value==="assistant"?await ue():await de()},ue=async()=>{var y;if(e("enter",o.value),t.logService.log({type:"ai-input",log:o.value}),o.value="",!p.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}v.value=!0;const u={role:"user",content:(y=t.formCode)!=null?y:""};try{const k=H();let g="";const B=st.sendMessage([u,...t.logService.logs.map(F=>f(F)),{role:"user",content:o.value}],t.runtime);for await(const F of B)g+=F,t.logService.log({type:"ai-output",log:g},k)}catch(k){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(k),Te(k)}finally{v.value=!1}},de=async()=>{o.value&&(t.logService.log({type:"eval-input",log:`>>> ${o.value}`}),e("eval-request",o.value),o.value="")},pe=()=>{t.logService.clear()};t.logService.listen(async u=>{b.value||(a.value={type:"unseen",count:a.value.type==="unseen"?a.value.count+1:1,severity:u.type==="stderr"?"error":"info"}),u.type!=="restart"&&(await Ce(),c.value&&(c.value.scrollTop=c.value.scrollHeight))});const b=m(!1),j=m(400),ve=N(()=>({height:`${j.value}px`})),D=m(!1),he=()=>D.value=!0,J=u=>{!D.value||(j.value=document.body.clientHeight-u.clientY)},K=()=>D.value=!1;return A(()=>{document.addEventListener("mousemove",J),document.addEventListener("mouseup",K),De.get().then(u=>p.value=!!u)}),re(()=>{document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",K)}),(u,y)=>{const k=te("Markdown");return l(),d("div",ot,[n("div",at,[n("div",rt,[S(I,{path:$.value==="assistant"?h(W):h(Y)},null,8,["path"]),O(" Smart Console ")]),n("div",it,[n("div",{class:"changes-container"},[n("button",{class:"header-button",onClick:r},"Restart")]),n("div",{class:"toggle-button",onClick:U},[S(I,{class:L(["icon",{open:b.value}]),path:h(G),fill:"#fff"},null,8,["class","path"]),a.value.type==="unseen"?(l(),d("div",{key:0,class:"unseen-count","unseen-severity":a.value.severity},C(a.value.count),9,lt)):w("",!0)])])]),b.value?(l(),d("div",{key:0,class:"terminal",style:$e(ve.value)},[n("div",{class:"resize-handler",onMousedown:he},null,32),n("div",ct,[n("div",ut,[n("div",{ref_key:"entriesContainer",ref:c,class:"entries"},[dt,(l(!0),d(se,null,ne(t.logService.logs,(g,B)=>(l(),d("div",{key:B,class:L([g.type,"entry"])},[g.type==="ai-output"?(l(),oe(k,{key:0,source:g.log},null,8,["source"])):(l(),d("div",pt,C(g.type==="restart"?"-- restarted --":g.log),1))],2))),128))],512),n("div",vt,[S(I,{class:L(["icon",{open:b.value}]),path:h(G)},null,8,["class","path"]),n("div",{ref_key:"inputRef",ref:E,class:"input-text",contenteditable:"","pointer-events":v.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:Ie(ce,["enter"])},null,40,ht)])]),n("div",_t,[n("div",{class:"icons",onClick:pe},[S(I,{class:"icon",path:h(Le)},null,8,["path"])]),n("div",null,[S(I,{class:"icon clickable",path:$.value==="assistant"?h(W):h(Y),onClick:y[0]||(y[0]=g=>_())},null,8,["path"])])])])],4)):w("",!0)])}}});const Rt=R(ft,[["__scopeId","data-v-cfdedb79"]]),mt={class:"unsaved-changes-handler"},V="You have unsaved changes. Are you sure you want to leave?",At=T({__name:"UnsavedChangesHandler",props:{hasChanges:{type:Boolean}},setup(s){const e=s,t=a=>(a=a||window.event,a&&(a.returnValue=V),V),o=()=>{window.addEventListener("beforeunload",t)};Ee((a,v,p)=>{if(!e.hasChanges)return p();confirm(V)?p():p(!1)});const c=()=>window.removeEventListener("beforeunload",t),i=a=>a?o():c();return ae(()=>e.hasChanges,i),A(()=>i(e.hasChanges)),re(c),(a,v)=>(l(),d("div",mt))}});export{le as L,xt as R,Rt as S,Lt as T,At as _,Mt as a};
//# sourceMappingURL=UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.26e757c8.js.map

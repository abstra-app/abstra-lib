var ye=Object.defineProperty;var we=(n,e,t)=>e in n?ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var P=(n,e,t)=>(we(n,typeof e!="symbol"?e+"":e,t),t);import{a as K}from"./asyncComputed.3068c2f0.js";import{F as be}from"./forms.5a4b7621.js";import{D as Ce}from"./dashes.25ae3367.js";import{H as ke}from"./hooks.83b588ef.js";import{J as G}from"./jobs.44935944.js";import{W as Se}from"./workspaces.5fc86a02.js";import{d as M,G as ae,H as B,ey as Ie,a as oe,b as p,et as m,f as l,w as u,aI as g,u as s,c as T,bV as Y,ev as $,e as i,eB as j,bf as re,v as z,r as f,S as q,ex as O,eC as ie,eD as le,ez as Ee,J as Te,a4 as Ae,o as ce,L as ue,I as x,eu as xe,eA as $e,eO as Re,eP as je,c0 as L,cE as De}from"./outputWidgets.3a1a3161.js";import{A as Pe}from"./activeRecord.8f2918d8.js";import{o as Le,e as Oe,s as Q,q as X,r as Z,k as Be}from"./icons.d8ed105c.js";import{c as Me,A as ee}from"./Title.875549d8.js";import{A as Ne}from"./index.46bd6cba.js";import{u as V}from"./uuid.d5a19964.js";import{l as Fe}from"./DocsButton.vue_vue_type_script_setup_true_lang.cc9605ca.js";import{A as Ue,a as te}from"./Text.499f5d9d.js";import{A as se}from"./index.0d5ed1d0.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="1334644e-4822-423b-a761-9e69bd68edac",n._sentryDebugIdIdentifier="sentry-dbid-1334644e-4822-423b-a761-9e69bd68edac")}catch{}})();class Ve{async list(){return await(await fetch("/_editor/api/scripts")).json()}async create(){return await(await fetch("/_editor/api/scripts",{method:"POST",headers:{"Content-Type":"application/json"}})).json()}async get(e){return await(await fetch(`/_editor/api/scripts/${e}`)).json()}async update(e,t){return await(await fetch(`/_editor/api/scripts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async delete(e){await fetch(`/_editor/api/scripts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}async test(e){return(await fetch(`/_editor/api/scripts/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()}}const E=new Ve;class R{constructor(e){P(this,"record");this.record=Pe.create(E,e,"path")}static async list(){return(await E.list()).map(t=>new R(t))}static async create(){const e=await E.create();return new R(e)}static async get(e){const t=await E.get(e);return new R(t)}async delete(){await E.delete(this.path)}async duplicate(){return this}async save(){await this.record.save()}onUpdate(e){this.record.pubsub.subscribe("update",e)}hasChanges(e){return this.record.hasChanges(e)}get schedule(){return this.record.get("schedule")}set schedule(e){this.record.set("schedule",e)}get title(){return this.record.get("title")}set title(e){this.record.set("title",e)}get file(){return this.record.get("file")}set file(e){this.record.set("file",e)}get path(){return this.record.get("path")}set path(e){this.record.set("path",e)}async test(){return E.test(this.path)}get routeName(){return"script"}get position(){const[e,t]=this.record.get("workflow_position");return{x:e,y:t,referential:"world"}}get isInitial(){return!1}}const ze={class:"file-path"},He={key:1},We=M({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(n){const e=n,t=ae({pathError:null}),{result:a}=K(()=>Se.get()),d=()=>{!a.value||!e.runtime.file||a.value.openFile(e.runtime.file)},h=B(()=>{var o;return(o=e.runtime.file)!=null&&o.endsWith(".py")?e.runtime.hasChanges("file")?"The original file will be renamed after saving":null:"It should be a .py file"}),c=()=>{!a.value||!S.value||a.value.openFile(".")},w=Ie(),{result:S}=K(()=>fetch("/_editor/api/workspace/root-path").then(o=>o.text()));return e.runtime.onUpdate(o=>{if(e.runtime instanceof G||!o||!("path"in o)||!(o!=null&&o.path))return;const C=[{runtime:be,basePath:"form"},{runtime:ke,basePath:"hook"},{runtime:Ce,basePath:"dash"}].find(_=>e.runtime instanceof _.runtime);if(!C)throw new Error(`Unknown runtime type ${e.runtime}`);w.push({path:`/_editor/${C.basePath}/${encodeURIComponent(o.path)}`})}),(o,v)=>{const C=oe("icon");return p(),m(re,null,[l(s(Me),{level:3},{default:u(()=>[g("Common")]),_:1}),o.runtime instanceof s(G)||o.runtime instanceof s(R)?$("",!0):(p(),T(s(ee),{key:0,label:"Path"},{default:u(()=>[l(s(Y),{value:o.runtime.path,"onUpdate:value":v[0]||(v[0]=_=>o.runtime.path=_),type:"text"},null,8,["value"])]),_:1})),l(s(Ne),null,{default:u(()=>[l(s(ee),{label:"source code",help:h.value},{default:u(()=>[l(s(Y),{value:o.runtime.file,"onUpdate:value":v[3]||(v[3]=_=>o.runtime.file=_),type:"text"},{addonBefore:u(()=>[s(S)?(p(),m("span",{key:0,class:"clickable",onClick:v[1]||(v[1]=_=>c())},[l(C,{class:"clickable",path:s(Le)},null,8,["path"]),i("p",ze,j(s(S)),1)])):$("",!0)]),addonAfter:u(()=>[i("span",{class:"clickable",onClick:v[2]||(v[2]=_=>d())},[l(C,{class:"clickable",path:s(Oe)},null,8,["path"]),g(" Open file ")])]),_:1},8,["value"])]),_:1},8,["help"])]),_:1}),t.pathError?(p(),m("div",He,j(t.pathError),1)):$("",!0)],64)}}});const At=z(We,[["__scopeId","data-v-24ce428d"]]);class de{constructor(){P(this,"logState",ae({log:[]}));P(this,"_listeners",{})}static create(){return new de}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const a=t?this.logs.find(d=>d.id===t):null;return a?Object.assign(a,e):this.logs.push({...e,id:t||V()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=V();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class Je{static async*sendMessage(e,t){var h;const d=(h=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:h.getReader();if(!d)throw new Error("No response body");for(;;){const c=await d.read();if(c.done)break;yield new TextDecoder().decode(c.value)}}}const Ke=n=>(ie("data-v-59ca7295"),n=n(),le(),n),Ge=Ke(()=>i("div",{class:"text"}," Changes were made in your code. Click Restart to refresh the preview window. ",-1)),ne="ignoreCodeChangesWarning",Ye=M({__name:"ChangesWarning",props:{hasChanges:{type:Boolean}},setup(n){var h;const e=n,t=f((h=q.get(ne))!=null?h:!1),a=B(()=>e.hasChanges&&!t.value),d=()=>{q.set(ne,!0),t.value=!0};return(c,w)=>(p(),m("div",{class:O(["changes-warning",{visible:a.value}])},[Ge,i("div",{class:"no-more-alert",onClick:d},"Do not show again")],2))}});const qe=z(Ye,[["__scopeId","data-v-59ca7295"]]),Qe=n=>(ie("data-v-440200c2"),n=n(),le(),n),Xe={class:"smart-console"},Ze={class:"header"},et={class:"left"},tt={class:"right"},st={class:"changes-container"},nt=["unseen-severity"],at={class:"cli"},ot={class:"left"},rt=Qe(()=>i("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),it={key:1,class:"local-entry"},lt={class:"input"},ct=["pointer-events","onKeydown"],ut={class:"right"},dt=M({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(n,{emit:e}){const t=n,a=f(""),d=f(null),h=Ee(),c=f({type:"seen"}),w=f(!1),S=f(!1),o=()=>{t.logService.clear(),e("restart")},v=()=>{A.value=A.value==="assistant"?"debugger":"assistant"};function C(r){switch(r.type){case"ai-input":return{role:"user",content:r.log};case"ai-output":return{role:"assistant",content:r.log};case"stderr":case"stdout":return{role:"user",content:r.log};case"restart":return{role:"user",content:"-- new session --"};case"files-changed":return{role:"user",content:"-- files changed --"};default:throw new Error(`Unknown log type: ${r.type}`)}}const _=B(()=>t.logService.logs.some(r=>r.type==="files-changed"));function pe(){k.value=!k.value,k.value&&(c.value={type:"seen"})}Te(h,()=>{t.logService.clear(),e("clear-terminal")});const D=f(null),A=f("assistant"),he=async r=>{var b;if(r.preventDefault(),a.value=((b=D.value)==null?void 0:b.innerText)||"",r.shiftKey){document.execCommand("insertLineBreak");return}D.value&&(D.value.innerText=""),A.value==="assistant"?await fe():await ve()},fe=async()=>{var b;if(e("enter",a.value),t.logService.log({type:"ai-input",log:a.value}),a.value="",!S.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}w.value=!0;const r={role:"user",content:(b=t.formCode)!=null?b:""};try{const I=V();let y="";const F=Je.sendMessage([r,...t.logService.logs.map(U=>C(U)),{role:"user",content:a.value}],t.runtime);for await(const U of F)y+=U,t.logService.log({type:"ai-output",log:y},I)}catch(I){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(I),je(I)}finally{w.value=!1}},ve=async()=>{a.value&&(t.logService.log({type:"eval-input",log:`>>> ${a.value}`}),e("eval-request",a.value),a.value="")},ge=()=>{t.logService.clear()};t.logService.listen(async r=>{k.value||(c.value={type:"unseen",count:c.value.type==="unseen"?c.value.count+1:1,severity:r.type==="stderr"?"error":"info"}),r.type!=="restart"&&(await Ae(),d.value&&(d.value.scrollTop=d.value.scrollHeight))});const k=f(!1),H=f(400),me=B(()=>({height:`${H.value}px`})),N=f(!1),_e=()=>N.value=!0,W=r=>{!N.value||(H.value=document.body.clientHeight-r.clientY)},J=()=>N.value=!1;return ce(()=>{document.addEventListener("mousemove",W),document.addEventListener("mouseup",J),Fe.get().then(r=>S.value=!!r)}),ue(()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",J)}),(r,b)=>{const I=oe("Markdown");return p(),m("div",Xe,[i("div",Ze,[i("div",et,[l(x,{path:A.value==="assistant"?s(Q):s(X)},null,8,["path"]),g(" Smart Console ")]),i("div",tt,[i("div",st,[l(qe,{"has-changes":_.value},null,8,["has-changes"]),i("button",{class:"header-button",onClick:o},"Restart")]),i("div",{class:"toggle-button",onClick:pe},[l(x,{class:O(["icon",{open:k.value}]),path:s(Z),fill:"#fff"},null,8,["class","path"]),c.value.type==="unseen"?(p(),m("div",{key:0,class:"unseen-count","unseen-severity":c.value.severity},j(c.value.count),9,nt)):$("",!0)])])]),k.value?(p(),m("div",{key:0,class:"terminal",style:xe(me.value)},[i("div",{class:"resize-handler",onMousedown:_e},null,32),i("div",at,[i("div",ot,[i("div",{ref_key:"entriesContainer",ref:d,class:"entries"},[rt,(p(!0),m(re,null,$e(t.logService.logs,(y,F)=>(p(),m("div",{key:F,class:O([y.type,"entry"])},[y.type==="ai-output"?(p(),T(I,{key:0,source:y.log},null,8,["source"])):(p(),m("div",it,j(y.type==="restart"?"-- restarted --":y.log),1))],2))),128))],512),i("div",lt,[l(x,{class:O(["icon",{open:k.value}]),path:s(Z)},null,8,["class","path"]),i("div",{ref_key:"inputRef",ref:D,class:"input-text",contenteditable:"","pointer-events":w.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:Re(he,["enter"])},null,40,ct)])]),i("div",ut,[i("div",{class:"icons",onClick:ge},[l(x,{class:"icon",path:s(Be)},null,8,["path"])]),i("div",null,[l(x,{class:"icon clickable",path:A.value==="assistant"?s(Q):s(X),onClick:b[0]||(b[0]=y=>v())},null,8,["path"])])])])],4)):$("",!0)])}}});const xt=z(dt,[["__scopeId","data-v-440200c2"]]),$t=M({__name:"Debugger",setup(n){async function e(){const c=await fetch("/_editor/api/debugger",{method:"GET"});if(!c.ok)throw new Error("Failed to check debugger connection");return await c.json()}async function t(){await fetch("/_editor/api/debugger/vscode-launch",{method:"POST"}),d()}const a=f({connected:!1,port:0,is_launch_json_configured:!1});async function d(){a.value=await e()}let h=null;return ce(()=>{h=setInterval(d,1e3)}),ue(()=>{h&&clearInterval(h)}),(c,w)=>a.value.connected?(p(),T(s(L),{key:0,disabled:""},{default:u(()=>[g("VSCode connected")]),_:1})):(p(),T(s(De),{key:1},{content:u(()=>[l(s(se),{direction:"vertical"},{default:u(()=>[l(s(Ue),null,{default:u(()=>[g(" Abstra allows you to connect to your VSCode debugger ")]),_:1}),l(s(te),null,{default:u(()=>[g(" You're not connected ")]),_:1}),a.value.is_launch_json_configured?(p(),T(s(se),{key:0,direction:"vertical"},{default:u(()=>[l(s(te),{style:{"font-size":"24px"},copyable:"",code:""},{default:u(()=>[g(j(a.value.port),1)]),_:1}),l(s(L),{href:"https://docs.abstra.io/debug/vscode",target:"_blank"},{default:u(()=>[g(" Learn how to connect to vscode ")]),_:1})]),_:1})):(p(),T(s(L),{key:1,onClick:t},{default:u(()=>[g("Configure launch.json")]),_:1}))]),_:1})]),default:u(()=>[l(s(L),null,{default:u(()=>[g("Connect to VSCode")]),_:1})]),_:1}))}});export{de as L,At as R,xt as S,$t as _,R as a};
//# sourceMappingURL=Debugger.vue_vue_type_script_setup_true_lang.c50a6f18.js.map

var y=Object.defineProperty;var C=(r,e,t)=>e in r?y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>(C(r,typeof e!="symbol"?e+"":e,t),t);import{C as I}from"./CrudView.423d8744.js";import{e as n,f as b,ej as E,ep as T,d as k,ea as x,eo as z,o as g,Y as A,b as s,u as a,w as u,aS as _,c as O,cz as v,cS as R,aB as S,dh as V,S as F,cL as P}from"./index.d0f12294.js";import{a as w}from"./gateway.ae1d6857.js";import{M as j}from"./member.8ffb8c1d.js";import"./tables.318f703e.js";import{a as M}from"./ant-design.d89b18ab.js";import{T as D,G as B}from"./tagColorProvider.36a797cb.js";import"./router.375df57e.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.d6f2b20e.js";import"./BookOutlined.7c922f07.js";import"./url.121c9984.js";import"./PhDotsThreeVertical.vue.d0b16f96.js";import"./Badge.f6241be2.js";import"./index.a82e0ed1.js";import"./popupNotifcation.a0a6244b.js";import"./record.8c284c67.js";import"./string.d9c83adf.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="bde6d750-6390-48c1-b1a4-6de53b5561d6",r._sentryDebugIdIdentifier="sentry-dbid-bde6d750-6390-48c1-b1a4-6de53b5561d6")}catch{}})();const L=[{label:"Admin",value:"admin"},{label:"Editor",value:"editor"}],N={admin:"Has full access to the organization, projects and editors",editor:"Can only manage projects within their teams"};class U{constructor({authorEmail:e,organizationId:t,api:l,handlers:m}){i(this,"members",n([]));i(this,"teamOptions",n([]));i(this,"selectedMember",n(null));i(this,"draftMember",n(null));i(this,"creationFields",b(()=>this.getCreationFields()));i(this,"table",b(()=>this.makeCrudViewTable()));i(this,"loading",n(!1));i(this,"authorEmail");i(this,"organizationId");i(this,"api");i(this,"handlers");i(this,"currentMember",n(null));i(this,"teamColorProvider",new D);i(this,"confirmAddMember",async e=>{await this.api.create({organizationId:this.organizationId,email:e.email,teams:e.teams}),await this.fetchState()});i(this,"openEditMemberModal",e=>{this.draftMember.value=E.exports.cloneDeep(e),this.selectedMember.value=e,this.fetchTeamOptions()});i(this,"confirmUpdateMember",async()=>{var e,t;this.loading.value=!0,this.draftMember.value&&(await this.api.update(this.organizationId,this.draftMember.value.authorId,{role:(e=this.draftMember.value)==null?void 0:e.role,teams:(t=this.draftMember.value)==null?void 0:t.teams}),await this.fetchState(),this.draftMember.value=null,this.selectedMember.value=null,this.loading.value=!1)});i(this,"cancelEditMember",()=>{this.draftMember.value=null,this.selectedMember.value=null});this.authorEmail=e,this.organizationId=t,this.api=l,this.handlers=m}async fetchState(){this.loading.value=!0,await this.fetchMembers(),await this.fetchTeamOptions(),this.setCurrentMember(),this.loading.value=!1}setCurrentMember(){var e;this.currentMember.value=(e=this.members.value.find(t=>t.email===this.authorEmail))!=null?e:null}async fetchMembers(){this.members.value=await this.api.list(this.organizationId)}async fetchTeamOptions(){const e=await this.api.fetchTeamOptions(this.organizationId);this.teamOptions.value=e.map(t=>({label:t,value:t}))}async removeMember(e){var l;if(((l=w.getAuthor())==null?void 0:l.claims.email)===e.email){await M("Removing your own access will block you from this organization. Are you sure?",{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),this.handlers.onSelfRemove());return}await M(`Are you sure you want to remove ${e.email} access?`,{okText:"Remove",cancelText:"Cancel"})&&(await this.api.delete({organizationId:this.organizationId,authorId:e.authorId}),await this.fetchMembers())}getCreationFields(){var t;const e=[{key:"email",label:"Email",type:"text"}];return((t=this.currentMember.value)==null?void 0:t.role)==="admin"&&e.push({key:"teams",type:"select",mode:"tags",options:this.teamOptions.value,label:"Teams"}),e}makeCrudViewActions(e){var t;return((t=this.currentMember.value)==null?void 0:t.role)==="editor"?[]:[{icon:B,label:"Edit Permissions",onClick:()=>this.openEditMemberModal(e)},{icon:T,label:"Remove access",onClick:()=>this.removeMember(e),dangerous:!0}]}getTeamTags(e){const t=e.teams.map(l=>({text:l,color:this.teamColorProvider.getColor(l)}));return e.role==="admin"&&t.unshift({text:"Admin",color:"red"}),t}makeColumns(){var e;return((e=this.currentMember.value)==null?void 0:e.role)==="editor"?[{title:"Email",align:"center"},{title:"Teams",align:"center"}]:[{title:"Email",align:"center"},{title:"Teams",align:"center"},{title:"",align:"right"}]}makeCrudViewTable(){return{columns:this.makeColumns(),rows:this.members.value.map(e=>({key:e.email,cells:[{type:"text",text:e.email},{type:"tags",tags:this.getTeamTags(e)},{type:"actions",actions:this.makeCrudViewActions(e)}]}))}}}const se=k({__name:"EditorsView",setup(r){var p;const e=x(),t=z(),l=e.params.organizationId,m=new j,h=(p=w.getAuthor())==null?void 0:p.claims.email;if(!h)throw new Error("Author email is not available");const o=new U({organizationId:l,api:m,authorEmail:h,handlers:{onSelfRemove:()=>{t.push("organizations")}}});return o.fetchState(),(G,d)=>{var f;return g(),A(_,null,[s(I,{"entity-name":"editor",loading:a(o).loading.value,title:"Editors",description:"Manage the editors and their permissions for this organization.","empty-title":"No editors yet",table:a(o).table.value,"create-button-text":"Invite Editor",fields:a(o).creationFields.value,create:a(o).confirmAddMember},null,8,["loading","table","fields","create"]),s(a(P),{open:!!a(o).draftMember.value,title:`Editing ${(f=a(o).draftMember.value)==null?void 0:f.email}`,"ok-text":"Apply","cancel-text":"Cancel","confirm-loading":a(o).loading.value,onOk:a(o).confirmUpdateMember,onCancel:a(o).cancelEditMember},{default:u(()=>[a(o).draftMember.value?(g(),O(a(V),{key:0,vertical:"",justify:"center",gap:"0",style:{padding:"15px 0px 0px 0px"}},{default:u(()=>[s(a(v),{colon:!1,label:"Role",help:a(N)[a(o).draftMember.value.role]},{default:u(()=>[s(a(R),{value:a(o).draftMember.value.role,"onUpdate:value":d[0]||(d[0]=c=>a(o).draftMember.value.role=c),options:a(L)},null,8,["value","options"])]),_:1},8,["help"]),s(a(v),{colon:!1,label:"Teams",tooltip:"Editor will have access to projects within these teams"},{default:u(()=>[s(a(S),{value:a(o).draftMember.value.teams,"onUpdate:value":d[1]||(d[1]=c=>a(o).draftMember.value.teams=c),options:a(o).teamOptions.value,mode:"tags",placeholder:"Select or type new team name"},null,8,["value","options"])]),_:1})]),_:1})):F("",!0)]),_:1},8,["open","title","confirm-loading","onOk","onCancel"])],64)}}});export{se as default};
//# sourceMappingURL=EditorsView.19e3ced6.js.map

import{d as N,H as G,G as J,r as _,J as Q,b as i,c as f,w as s,f as o,u as e,ae as W,ev as I,eC as q,cF as E,bO as w,bV as U,ar as b,a$ as B,cs as F,ex as k,e as $,eD as M,eA as j,eB as K,eM as z}from"./outputWidgets.7cdb44f9.js";import{R as X,S as Y,a as Z,L as ee}from"./SourceCode.e6b40616.js";import{a as te}from"./asyncComputed.2ea08899.js";import{W as O}from"./workspaces.b9c27a04.js";import{H as ae}from"./jobs.5b3f2be3.js";import"./envVars.c5f2f5b6.js";import{B as oe}from"./BaseLayout.b0d04a1c.js";import{_ as re}from"./RunButton.vue_vue_type_script_setup_true_lang.632c8c24.js";import{A as S}from"./api.7bf1d574.js";import{D as se,A as le}from"./index.33ee72a8.js";import{A as c,F as V}from"./Form.b2d1fc22.js";import{C as ne,A as D}from"./CollapsePanel.4cad409d.js";import{A as ue}from"./index.5195a3ff.js";import{A as de}from"./index.80363f70.js";import{N as ie}from"./NavbarControls.e84a4507.js";import{_ as pe}from"./SaveButton.vue_vue_type_script_setup_true_lang.ba948056.js";import{S as me}from"./StageRunSelector.e64762be.js";import{c as fe}from"./index.f62b5b4f.js";import{A as ve}from"./index.403ab8f7.js";import{A as H,T as L}from"./TabPane.50af93c9.js";import"./uuid.e01bca0d.js";import"./icons.e4c053bb.js";import"./scripts.ea5508b0.js";import"./record.de4ae3da.js";import"./pubsub.9a822d34.js";import"./validations.2c261637.js";import"./string.8c79292b.js";import"./toggleHighContrast.e6d4c7cb.js";import"./index.9830ed72.js";import"./Card.e68af23e.js";import"./runnerData.174f3803.js";import"./url.f15e35f5.js";import"./Text.5ace53aa.js";import"./Base.91e900fa.js";import"./Typography.ed7d8def.js";import"./index.cf4c23b9.js";import"./hasIn.6e4a2c3d.js";import"./index.5b4fef53.js";import"./popupNotifcation.3e85efca.js";import"./Link.2d497627.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.2037a542.js";import"./Paragraph.3ebe3349.js";import"./Modal.e9e684b4.js";import"./ant-design.8cb355b5.js";import"./index.17da0b9b.js";import"./index.88e31b1e.js";import"./ArrowRightOutlined.08fa31dd.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new Error().stack;v&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[v]="39e41d77-f2d1-462a-a7e3-19a8acfb31b0",y._sentryDebugIdIdentifier="sentry-dbid-39e41d77-f2d1-462a-a7e3-19a8acfb31b0")}catch{}})();const ce={style:{display:"flex","flex-direction":"column",gap:"10px"}},ye={key:0},ke=N({__name:"HookTester",props:{hook:{},logService:{},stageRunId:{},enableStartThread:{type:Boolean}},emits:["update:stage-run-id"],setup(y,{expose:v,emit:g}){const u=y,h=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],P=G(()=>{var a;if((a=t.response)!=null&&a.status)return t.response.status>=500?"red":t.response.status>=400?"orange":t.response.status>=200?"green":"blue"}),t=J({shouldSelectStageRun:!u.hook.isInitial,stageRunId:u.stageRunId,queryParams:[],headers:[{key:"Content-Type",value:"application/json"}],method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4)}),T=t.queryParams.find(a=>a.name===S);u.stageRunId&&!T&&t.queryParams.push({name:S,value:u.stageRunId});const A=_(!1),C=async()=>{A.value=!0;try{const a={method:t.method,query:t.queryParams.reduce((r,{name:l,value:p})=>(l&&p&&(r[l]=p),r),{}),body:t.body,headers:t.headers.reduce((r,{key:l,value:p})=>(l&&p&&(r[l]=p),r),{})},n=u.stageRunId||u.enableStartThread?await u.hook.run(a):await u.hook.test(a);t.response=n,n.stderr&&u.logService.log({type:"stderr",log:n.stderr}),n.stdout&&u.logService.log({type:"stdout",log:n.stdout})}finally{A.value=!1,u.stageRunId&&g("update:stage-run-id",null)}};Q([()=>u.stageRunId,()=>t.queryParams],([a,n])=>{const r=n.find(l=>l.name===S);if(a&&!r){t.queryParams.push({name:S,value:a});return}if(!a&&r){t.queryParams=t.queryParams.filter(l=>l.name!==S);return}a&&r&&a!==r.value&&(r.value=a)});const m=()=>{t.queryParams.push({name:"",value:""})},R=a=>{t.queryParams=t.queryParams.filter((n,r)=>r!==a)},x=()=>{t.headers.push({key:"",value:""})},d=a=>{t.headers=t.headers.filter((n,r)=>r!==a)};return v({runHook:C}),(a,n)=>(i(),f(e(V),{layout:"vertical"},{default:s(()=>[o(e(c),{label:"Method"},{default:s(()=>[o(e(W),{value:t.method,options:h,onSelect:n[0]||(n[0]=r=>t.method=r)},null,8,["value"])]),_:1}),o(e(c),null,{default:s(()=>[o(e(ne),{ghost:""},{default:s(()=>[o(e(D),{header:`Query Params (${t.queryParams.length})`},{default:s(()=>[(i(!0),I(B,null,q(t.queryParams,(r,l)=>(i(),f(e(c),{key:l},{default:s(()=>[o(e(E),null,{default:s(()=>[o(e(w),{value:r.name,"onUpdate:value":p=>r.name=p,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(e(w),{value:r.value,"onUpdate:value":p=>r.value=p,type:"text",placeholder:"value",disabled:r.name===e(S)},null,8,["value","onUpdate:value","disabled"]),o(e(U),{danger:"",onClick:p=>R(l)},{default:s(()=>[b("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(e(c),null,{default:s(()=>[o(e(U),{type:"dashed",style:{width:"100%"},onClick:m},{default:s(()=>[b(" Add Query Param ")]),_:1})]),_:1})]),_:1},8,["header"]),o(e(D),{header:`Headers (${t.headers.length})`},{default:s(()=>[(i(!0),I(B,null,q(t.headers,(r,l)=>(i(),f(e(c),{key:l,label:l===0?"Headers":void 0},{default:s(()=>[o(e(E),null,{default:s(()=>[o(e(w),{value:r.key,"onUpdate:value":p=>r.key=p,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(e(w),{value:r.value,"onUpdate:value":p=>r.value=p,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(e(U),{danger:"",onClick:p=>d(l)},{default:s(()=>[b("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["label"]))),128)),o(e(c),null,{default:s(()=>[o(e(U),{type:"dashed",style:{width:"100%"},onClick:x},{default:s(()=>[b("Add Header")]),_:1})]),_:1})]),_:1},8,["header"]),o(e(D),{header:"Body"},{default:s(()=>[t.method!=="GET"?(i(),f(e(c),{key:0},{default:s(()=>[o(e(F),{value:t.body,"onUpdate:value":n[1]||(n[1]=r=>t.body=r)},null,8,["value"])]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1}),o(e(c),null,{default:s(()=>[$("div",ce,[o(re,{loading:A.value,disabled:a.hook.hasChanges(),onClick:C,onSave:n[2]||(n[2]=r=>a.hook.save())},null,8,["loading","disabled"])])]),_:1}),o(e(ue),{orientation:"left"},{default:s(()=>[b("Response")]),_:1}),t.response?(i(),I("div",ye,[o(e(de),{color:P.value},{default:s(()=>[b(M(t.response.status),1)]),_:1},8,["color"]),o(e(le),null,{default:s(()=>[(i(!0),I(B,null,q(t.response.headers,(r,l)=>(i(),f(e(se),{key:l,label:l},{default:s(()=>[b(M(r),1)]),_:2},1032,["label"]))),128))]),_:1}),o(e(F),{value:t.response.body},null,8,["value"])])):k("",!0)]),_:1}))}}),ge=N({__name:"HookSettings",props:{hook:{}},setup(y){return(v,g)=>(i(),f(e(V),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:s(()=>[o(e(c),{label:"Name",required:""},{default:s(()=>[o(e(w),{value:v.hook.title,"onUpdate:value":g[0]||(g[0]=u=>v.hook.title=u)},null,8,["value"])]),_:1}),o(X,{runtime:v.hook},null,8,["runtime"])]),_:1}))}}),he={style:{width:"50%"}},be={style:{width:"50%"}},vt=N({__name:"HookEditor",setup(y){const v=j(),g=K(),u=_(null),h=_("source-code"),P=_("preview"),t=_(null),T=_(!1);function A(){v.push({name:"stages"})}const C=_(null),{result:m}=te(()=>Promise.all([O.get(),ae.get(g.params.id),O.readTestData()]).then(([x,d,a])=>(d.updateInitialState("test_data",a),z({workspace:x,hook:d})))),R=ee.create();return(x,d)=>(i(),f(oe,{"no-margins":""},{navbar:s(()=>[e(m)?(i(),f(e(fe),{key:0,title:e(m).hook.title,style:{padding:"5px 25px","margin-bottom":"15px"},onBack:A},{extra:s(()=>[o(ie,{"docs-path":"hooks","editing-model":e(m).hook,"show-save-button":!1},null,8,["editing-model"])]),_:1},8,["title"])):k("",!0)]),content:s(()=>[e(m)?(i(),f(e(ve),{key:0,gap:"40",style:{width:"calc(100% - 80px)"}},{default:s(()=>[$("div",he,[o(e(L),{"active-key":h.value,"onUpdate:activeKey":d[0]||(d[0]=a=>h.value=a)},{rightExtra:s(()=>[o(pe,{model:e(m).hook},null,8,["model"])]),default:s(()=>[o(e(H),{key:"source-code",tab:"Source code"}),o(e(H),{key:"settings",tab:"Settings"}),o(e(H),{key:"test-data",tab:"Thread data"})]),_:1},8,["active-key"]),h.value==="source-code"?(i(),f(Y,{key:0,script:e(m).hook,workspace:e(m).workspace},null,8,["script","workspace"])):k("",!0),e(m).hook&&h.value==="settings"?(i(),f(ge,{key:1,hook:e(m).hook},null,8,["hook"])):k("",!0),h.value==="test-data"?(i(),f(me,{key:2,"stage-run-id":t.value,"onUpdate:stageRunId":d[1]||(d[1]=a=>t.value=a),"enable-start-thread":T.value,"onUpdate:enableStartThread":d[2]||(d[2]=a=>T.value=a),stage:e(m).hook,onFixInvalidJson:d[3]||(d[3]=(a,n)=>{var r;return(r=C.value)==null?void 0:r.fixJson(a,n)})},null,8,["stage-run-id","enable-start-thread","stage"])):k("",!0)]),$("div",be,[o(e(L),{"active-key":P.value,"onUpdate:activeKey":d[4]||(d[4]=a=>P.value=a)},{default:s(()=>[o(e(H),{key:"preview",tab:"Preview"})]),_:1},8,["active-key"]),e(m).hook&&P.value==="preview"?(i(),f(ke,{key:0,ref_key:"tester",ref:u,"stage-run-id":t.value,"onUpdate:stageRunId":d[5]||(d[5]=a=>t.value=a),hook:e(m).hook,"log-service":e(R),"enable-start-thread":T.value},null,8,["stage-run-id","hook","log-service","enable-start-thread"])):k("",!0)])]),_:1})):k("",!0)]),footer:s(()=>{var a;return[o(Z,{ref_key:"smartConsole",ref:C,runtime:"forms","log-service":e(R),onRestart:(a=u.value)==null?void 0:a.runHook},null,8,["log-service","onRestart"])]}),_:1}))}});export{vt as default};
//# sourceMappingURL=HookEditor.81d7d097.js.map

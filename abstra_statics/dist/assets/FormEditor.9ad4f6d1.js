import{d as $,r as x,v as H,b as i,c as f,x as a,F as C,L as T,N as q,W as M,a3 as N,e as n,O as Q,Q as j,q as A,K as X,z as t,t as w,w as y,D as V,H as Y,J as Z,S as ee}from"./registerWidgets.1f64062d.js";import{L as te}from"./CircularLoading.48f8280b.js";import{E as oe}from"./Error.5ebce65a.js";import{R as re,F as ae}from"./broker.1f6a1a31.js";import{R as se,S as le,_ as ne,L as ie}from"./UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.8206f9e1.js";import{T as ue,a as W}from"./Tab.94bbeb5a.js";import{a as ce}from"./asyncComputed.be96efa9.js";import{F as me}from"./forms.06156222.js";import{W as de}from"./workspaces.5570ba2d.js";import{B as pe}from"./BackButton.5157bd81.js";import{S as fe}from"./SaveButton.bb7defd6.js";import{D as _e}from"./DocsButton.86a17ad8.js";import{P as ve}from"./PreviewButton.5dd6304f.js";import"./lottie.ec4238e0.js";import"./passwordlessManager.f7bf4528.js";import"./pubsub.3afe3339.js";import"./icons.888e0741.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.1528dfde.js";import"./Passwordless.88ee3445.js";import"./executeJs.9d3c1254.js";import"./PlayerNavbar.e608b902.js";import"./index.247b1b38.js";import"./WidgetsFrame.444835bd.js";import"./colors.d1d40ad8.js";import"./Modal.68e9439f.js";import"./dashes.47698501.js";import"./activeRecord.a4f84f22.js";import"./runnerData.19896da7.js";import"./hooks.96142eaa.js";import"./jobs.9275facb.js";import"./uuid.0bb7ec95.js";import"./login.f06b9578.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[d]="21cd2cf0-0faf-4503-b270-23389f4ab12f",s._sentryDebugIdIdentifier="sentry-dbid-21cd2cf0-0faf-4503-b270-23389f4ab12f")}catch{}})();const ye="forms_workspace_id_path_key",U=s=>(Q("data-v-89e322ed"),s=s(),j(),s),he={class:"form-settings"},ge={class:"content"},be={class:"subsection-label"},ke={class:"property-label"},we=["value","onChange"],Se={class:"content"},xe={class:"property"},Ce=U(()=>a("div",{class:"property-label"},"Start smart form automatically",-1)),Ee={class:"property"},Fe=U(()=>a("div",{class:"property-label"},"Allow the user to restart the smart form after it is over",-1)),Re=$({__name:"FormSettings",props:{form:null},setup(s){const o=x(s.form),h=[{label:"General",props:[{label:"Form name",valueKey:"title"}]},{label:"Welcome Screen",props:[{label:"Title",valueKey:"welcome_title"},{label:"Subtitle",valueKey:"start_message"},{label:"Start button text",valueKey:"start_button_text"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"end_message"},{label:"Restart button text",valueKey:"restart_button_text"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"error_message"}]}],g=H({pathError:null,sectionsShown:[!0,!1,!1]}),S=_=>{_.detail.includes(ye)&&(g.pathError=r)},r="This path is already being used by another form or dash on your workspace";return addEventListener("hasura-error",S),(_,m)=>(i(),f("div",he,[a("div",ge,[(i(),f(C,null,T(h,l=>a("div",{key:l.label,class:"subsection"},[a("div",be,q(l.label),1),(i(!0),f(C,null,T(l.props,p=>(i(),f("div",{key:p.label,class:"property column"},[a("div",ke,q(p.label),1),a("input",{class:"property-input",type:"text",value:o.value.get(p.valueKey),onChange:u=>o.value.set(p.valueKey,u.target.value)},null,40,we)]))),128))])),64))]),a("div",Se,[a("div",xe,[M(a("input",{"onUpdate:modelValue":m[0]||(m[0]=l=>o.value.autoStart=l),class:"checkbox-input",type:"checkbox"},null,512),[[N,o.value.autoStart]]),Ce]),a("div",Ee,[M(a("input",{"onUpdate:modelValue":m[1]||(m[1]=l=>o.value.allowRestart=l),class:"checkbox-input",type:"checkbox"},null,512),[[N,o.value.allowRestart]]),Fe])]),n(se,{runtime:o.value},null,8,["runtime"])]))}});const Ke=A(Re,[["__scopeId","data-v-89e322ed"]]),Pe={class:"page"},Be={key:1,class:"error"},De=$({__name:"FormEditor",setup(s){var F,R,K;const d=Y(),o=Z(),h=H({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),p())});const g=x(null),{loading:S,result:r,error:_,refetch:m}=ce(()=>Promise.all([de.get(),me.get(o.params.formPath)]).then(([e,k])=>ee({workspace:e,form:k}))),l=x(!1);async function p(){var e;l.value=!0;try{await((e=r.value)==null?void 0:e.form.save())}finally{l.value=!1}}const u=ie.create(),b=X(()=>re.create({formPath:o.params.formPath}));(F=b.value)==null||F.on("stdout",e=>{u.log({type:"stdout",log:e.log})}),(R=b.value)==null||R.on("stderr",e=>{u.log({type:"stderr",log:e.log})}),(K=b.value)==null||K.onClose(()=>{u.log({type:"stderr",log:"Program closed"})});const z=()=>{u.clear()},E=async()=>{var e;return u.log({type:"restart"}),(e=g.value)==null?void 0:e.run()},G=({path:e,type:k})=>{k==="dash"?d.push({name:"dashEditor",params:{dashPath:e},query:o.query}):(d.push({name:"editor",params:{formPath:e},query:o.query}),m())},J=()=>{h.started=!0},O=()=>{h.started=!1};return(e,k)=>{var P,B,D,I,L;return i(),f(C,null,[a("div",Pe,[t(S)||!((P=t(r))!=null&&P.form)||!((B=t(r))!=null&&B.workspace)?(i(),w(te,{key:0})):t(_)?(i(),f("div",Be,[n(oe,{error:t(_),onReload:t(m)},null,8,["error","onReload"])])):(i(),w(ue,{key:2},{left:y(()=>[n(pe,{link:"/_editor/forms"})]),right:y(()=>{var c,v;return[n(_e),n(ve,{model:(c=t(r))==null?void 0:c.form},null,8,["model"]),n(fe,{model:(v=t(r))==null?void 0:v.form},null,8,["model"])]}),default:y(()=>[n(W,{title:"Preview"},{default:y(()=>{var c,v;return[n(ae,{ref_key:"runner",ref:g,form:(v=t(r))==null?void 0:v.form.makeRunnerData((c=t(r))==null?void 0:c.workspace),params:t(o).query,"is-preview":!0,"enable-auto-focus":!1,broker:t(b),style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:G,onLogout:E,onExit:O,onStart:J},null,8,["form","params","broker"])]}),_:1}),n(W,{title:"Settings"},{default:y(()=>{var c;return[(c=t(r))!=null&&c.form?(i(),w(Ke,{key:0,form:t(r).form},null,8,["form"])):V("",!0)]}),_:1})]),_:1})),(D=t(r))!=null&&D.form?(i(),w(le,{key:3,runtime:"forms","log-service":t(u),onRestart:E,onClearTerminal:z},null,8,["log-service"])):V("",!0)]),n(ne,{"has-changes":(L=(I=t(r))==null?void 0:I.form)==null?void 0:L.hasChanges()},null,8,["has-changes"])],64)}}});const mt=A(De,[["__scopeId","data-v-8b7849de"]]);export{mt as default};
//# sourceMappingURL=FormEditor.9ad4f6d1.js.map

var pe=Object.defineProperty;var ge=(l,t,a)=>t in l?pe(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var K=(l,t,a)=>(ge(l,typeof t!="symbol"?t+"":t,a),a);import{_ as ye}from"./DocsButton.vue_vue_type_script_setup_true_lang.95065a46.js";import{_ as ee}from"./AbstraButton.vue_vue_type_script_setup_true_lang.d8bcc7e4.js";import{d as q,at as O,c as B,o as r,ac as b,ae as he,h as N,ew as me,e as P,z as fe,r as M,M as J,w as le,a as v,b as i,eB as D,b4 as ve,b5 as Ce,u as n,cE as _e,bQ as W,cW as ke,aY as j,cU as we,g as C,t as k,cA as be,bT as Ie,aI as Te,cJ as xe,dg as Se,f as s,i as m,df as H,cD as Ae,dj as S,de as G,c$ as Ue,d9 as ie,ez as $e,_ as re,eA as je,Z as se,cM as Y,A as Q,bW as Ne,bE as Ve,bD as ce,cI as Ee}from"./jwt-decode.esm.7c9b757c.js";import{G as Ke}from"./PhDotsThreeVertical.vue.23d4ad15.js";import{k as z,o as Le}from"./router.95e6e4b6.js";import{U as Fe}from"./UploadOutlined.451b0201.js";import{_ as ze}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.7d3bd819.js";import{L as He}from"./Logo.2bc39bab.js";import{A as ue}from"./index.3a0bf605.js";import{C as de}from"./Card.929a13fd.js";import{b as Re}from"./index.b636bb44.js";import"./constants.6f371b22.js";import"./index.33534fc9.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[t]="60136f7a-969e-4882-863f-0ab3fcc8788a",l._sentryDebugIdIdentifier="sentry-dbid-60136f7a-969e-4882-863f-0ab3fcc8788a")}catch{}})();const Be=["width","height","fill","transform"],Pe={key:0},Me=P("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),De=[Me],qe={key:1},Ze=P("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),Oe=P("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Ge=[Ze,Oe],Je={key:2},We=P("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),Ye=[We],Qe={key:3},Xe=P("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),en=[Xe],nn={key:4},tn=P("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),an=[tn],on={key:5},ln=P("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),sn=[ln],cn={name:"PhArrowsLeftRight"},rn=q({...cn,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const t=l,a=O("weight","regular"),e=O("size","1em"),c=O("color","currentColor"),h=O("mirrored",!1),_=B(()=>{var I;return(I=t.weight)!=null?I:a}),T=B(()=>{var I;return(I=t.size)!=null?I:e}),g=B(()=>{var I;return(I=t.color)!=null?I:c}),x=B(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:h?"scale(-1, 1)":void 0);return(I,L)=>(r(),b("svg",me({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:T.value,height:T.value,fill:g.value,transform:x.value},I.$attrs),[he(I.$slots,"default"),_.value==="bold"?(r(),b("g",Pe,De)):_.value==="duotone"?(r(),b("g",qe,Ge)):_.value==="fill"?(r(),b("g",Je,Ye)):_.value==="light"?(r(),b("g",Qe,en)):_.value==="regular"?(r(),b("g",nn,an)):_.value==="thin"?(r(),b("g",on,sn)):N("",!0)],16,Be))}});class un{async generateEcdsaKey(t){const{projectId:a,connectionName:e,connectorType:c}=t;return z.post(`projects/${a}/connectors/${c}/connections/${e}/ecdsa-key`,{})}async createEcdsaConnection(t){const{projectId:a,connectionName:e,connectorType:c,publicKey:h,privateKey:_,accessId:T}=t;return z.post(`projects/${a}/connectors/${c}/connections/${e}/create-ecdsa`,{publicKey:h,privateKey:_,accessId:T})}async generateRsaKey(t){const{projectId:a,connectionName:e,connectorType:c}=t;return z.post(`projects/${a}/connectors/${c}/connections/${e}/rsa-key`,{})}async createRsaConnection(t){const{projectId:a,connectionName:e,connectorType:c,publicKey:h,privateKey:_,apiToken:T}=t;return z.post(`projects/${a}/connectors/${c}/connections/${e}/create-rsa`,{publicKey:h,privateKey:_,apiToken:T})}async getLoginUrl(t,a,e,c,h){return z.get(`projects/${t}/connectors/${e}/connections/${a}/login-url`,{scopeIds:c.join(","),...h})}async listConnectors(t){return z.get(`projects/${t}/connectors`)}async getConnectorsBetaStatus(){const{EnvURL:t}=await fe(()=>import("./router.95e6e4b6.js").then(a=>a.q),["assets/router.95e6e4b6.js","assets/jwt-decode.esm.7c9b757c.js","assets/jwt-decode.403169a6.css","assets/index.33534fc9.js"]);try{const a=await fetch(`${t.cloudApi}/public/connectors/beta-status`);if(!a.ok){if(a.status===404)return console.warn("Beta status endpoint not available yet, returning empty status"),{};throw new Error("Failed to fetch connectors beta status")}return a.json()}catch(a){return console.error("Error fetching beta status:",a),{}}}async createTokenConnection(t){const{projectId:a,connectionName:e,connectorType:c,tokens:h}=t,_={type:"tokens",tokens:h};return z.post(`projects/${a}/connectors/${c}/connections/${e}`,_)}async listConnections(t){return z.get(`projects/${t}/connections`)}async deleteConnection(t){const{projectId:a,connectionName:e,connectorType:c}=t;return z.delete(`projects/${a}/connectors/${c}/connections/${e}`)}async renameConnection(t){const{projectId:a,connectionName:e,connectorType:c,newConnectionName:h}=t;return z.patch(`projects/${a}/connectors/${c}/connections/${e}`,{newConnectionName:h})}}class dn{constructor(t,a){K(this,"state");K(this,"hasChanges",B(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));K(this,"handleDeletionClick",async t=>{J.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(t)})});K(this,"handleDeleteConnection",async t=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});K(this,"handleAddConnectionSubmit",async()=>{var h,_,T,g;const t=(h=this.state.value.addingConnection)==null?void 0:h.connector.metadata.key,a=(_=this.state.value.addingConnection)==null?void 0:_.selectedScopeIds,e=(g=(T=this.state.value.addingConnection)==null?void 0:T.tokenValues)!=null?g:{};if(!t||!a)throw new Error("No connector or scope selected");const{url:c}=await this.getLoginUrl(t,this.getUniqueName(t),a,e);window.location.href=c});K(this,"handleAddTokenConnectionSubmit",async()=>{const t=this.state.value.addingConnection;if(!t)throw new Error("No connection is being added");const a=t.connector.metadata.key,e=this.getUniqueName(a);await this.api.createTokenConnection({projectId:this.projectId,connectionName:e,connectorType:a,tokens:t.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()});K(this,"handleAddEcdsaConnectionSubmit",async(t,a)=>{const e=this.state.value.addingConnection;if(!e||!t)throw new Error("No connection is being added or public key is missing");if(!e.connectionName||!e.ecdsaKeys)throw new Error("Keys or connection name not found");const c=e.connector.metadata.key;if(c==="iugu"){if(!a)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:e.connectionName,connectorType:c,publicKey:e.ecdsaKeys.publicKey,privateKey:e.ecdsaKeys.privateKey,apiToken:a})}else{if(!a)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:e.connectionName,connectorType:c,publicKey:e.ecdsaKeys.publicKey,privateKey:e.ecdsaKeys.privateKey,accessId:a})}this.state.value.addingConnection=null,await this.refetchConnections()});K(this,"renameConnection",async()=>{const{editingConnection:t}=this.state.value;if(!t)throw new Error("No connection is being edited");const a=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:t.name,connectorType:t.connectorType,newConnectionName:t.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};J.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:a})});K(this,"showAddConfirmationModal",t=>{this.state.value.addingConnection={selectedScopeIds:t.auth.type==="oauth2"?t.auth.scopes.map(a=>a.key):[],connector:t,tokenValues:{}}});K(this,"handleScopeToggle",(t,a)=>{a?this.state.value.addingConnection.selectedScopeIds.push(t):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(e=>e!==t)});this.projectId=t,this.api=a,this.state=M({connectors:[],connections:[],addingConnection:null,editingConnection:null,betaStatus:{}})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchBetaStatus(){this.state.value.betaStatus=await this.api.getConnectorsBetaStatus()}async fetchInitialState(){await this.fetchConnectors(),await Promise.all([this.fetchBetaStatus(),this.refetchConnections()])}async refetchConnections(){const t=await this.api.listConnections(this.projectId);this.state.value.connections=t.map(a=>{const e=this.state.value.connectors.find(c=>c.metadata.key===a.connectionType);return e?{name:a.name,connectorTitle:e.metadata.label,connectorType:a.connectionType,icon:e.metadata.logoUrl}:null}).filter(a=>a!==null)}handleEditConnectionClick(t){this.state.value.editingConnection={...t,newName:t.name}}async getLoginUrl(t,a,e,c){return this.api.getLoginUrl(this.projectId,a,t,e,c)}slugify(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(t){const a=new Set(this.state.value.connections.filter(c=>c.connectorType===t).map(c=>c.name));if(!a.has(t))return t;let e=1;for(;a.has(`${t}-${e}`);)e++;return`${t}-${e}`}async generateEcdsaKey(){const t=this.state.value.addingConnection;if(!t)throw new Error("No connection is being added");const a=t.connector.metadata.key,e=this.getUniqueName(a),h=a==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:e,connectorType:a}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:e,connectorType:a});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=e,this.state.value.addingConnection.ecdsaKeys=h),h.publicKey}}function pn(l){return new Promise((t,a)=>{const e=new FileReader;e.onload=()=>{const h=e.result.split(",")[1];t(h)},e.onerror=()=>a(e.error),e.readAsDataURL(l)})}const gn={key:6,style:{"margin-top":"16px"}},X=q({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(l,{emit:t}){const a=l,e=t,c=M(a.uploadedFiles||{});function h(u){const d=g.value[u];return d?d.split(",").map(o=>o.trim()):[]}function _(u){if(!u.condition)return!0;const d=Object.keys(u.condition);for(const o of d){const A=u.condition[o].equals;if(g.value[o]!==A)return!1}return!0}function T(u,d){Array.isArray(d)?x(u,d.join(",")):console.error("Expected array for checkbox/select value")}const g=M({...a.tokenValues});le(()=>a.tokenValues,u=>{g.value={...u}},{deep:!0}),le(()=>a.uploadedFiles,u=>{c.value=u||{}},{deep:!0});function x(u,d){g.value[u]=d;const o={...g.value};e("update:tokenValues",o),e("tokenChange")}function I(u){var o,A;const d=[];return u.key&&d.push({required:!0,message:m.translate("i18n_auth_form_field_required",null,u.label||u.key)}),(o=u.input)!=null&&o.minSize&&d.push({min:u.input.minSize,message:m.translate("i18n_auth_form_field_min_length",null,u.input.minSize)}),(A=u.input)!=null&&A.maxSize&&d.push({max:u.input.maxSize,message:m.translate("i18n_auth_form_field_max_length",null,u.input.maxSize)}),d}async function L(u,d){try{const o=await pn(u),A={...c.value,[d]:{file:u,base64:o}};c.value=A,e("update:uploadedFiles",A),g.value[d]=o;const p={...g.value};e("update:tokenValues",p),e("tokenChange")}catch(o){console.error("Error converting file to base64:",o)}return!1}function V(u){const d={...c.value};delete d[u],c.value=d,e("update:uploadedFiles",d),g.value[u]="";const o={...g.value};e("update:tokenValues",o),e("tokenChange")}function R(u){const d=c.value[u];return d?[{uid:u,name:d.file.name,status:"done",size:d.file.size}]:[]}return(u,d)=>(r(),v(n(Ae),{model:g.value,layout:"vertical"},{default:i(()=>[(r(!0),b(j,null,D(l.tokens,o=>ve((r(),v(n(_e),{key:o.key,required:_(o),label:o.label,name:o.key,rules:I(o)},{default:i(()=>{var A,p,f,y,$,U,F,E,Z,ne,te,ae,oe;return[((A=o.input)==null?void 0:A.type)==="small-string"?(r(),v(n(W),{key:0,value:g.value[o.key],"onUpdate:value":w=>g.value[o.key]=w,placeholder:o.description,maxlength:(p=o.input)==null?void 0:p.maxSize,minlength:(f=o.input)==null?void 0:f.minSize,type:"password",onInput:()=>x(o.key,g.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((y=o.input)==null?void 0:y.type)==="radiobox"?(r(),v(n(ke),{key:1,value:g.value[o.key],"onUpdate:value":w=>g.value[o.key]=w,onChange:()=>x(o.key,g.value[o.key]||"")},{default:i(()=>[(r(!0),b(j,null,D(o.input.options,w=>(r(),v(n(we),{key:w.value,value:w.value},{default:i(()=>[C(k(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):(($=o.input)==null?void 0:$.type)==="checkbox"?(r(),b(j,{key:2},[((E=(F=(U=o.input)==null?void 0:U.options)==null?void 0:F.length)!=null?E:0)<=10?(r(),v(n(be),{key:0,value:h(o.key),onChange:w=>T(o.key,w)},{default:i(()=>[(r(!0),b(j,null,D(o.input.options,w=>(r(),v(n(Ie),{key:w.value,value:w.value},{default:i(()=>[C(k(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(r(),v(n(Te),{key:1,mode:"multiple",style:{width:"100%"},value:h(o.key),options:(Z=o.input.options)!=null?Z:[],onChange:w=>T(o.key,w)},null,8,["value","options","onChange"]))],64)):((ne=o.input)==null?void 0:ne.type)==="large-text"?(r(),v(n(xe),{key:3,value:g.value[o.key],"onUpdate:value":w=>g.value[o.key]=w,placeholder:o.description,maxlength:(te=o.input)==null?void 0:te.maxSize,minlength:(ae=o.input)==null?void 0:ae.minSize,rows:4,onInput:()=>x(o.key,g.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):((oe=o.input)==null?void 0:oe.type)==="file"?(r(),v(n(Se),{key:4,"file-list":R(o.key),"before-upload":w=>L(w,o.key),"max-count":1,"show-upload-list":!0,onRemove:()=>V(o.key)},{default:i(()=>[s(ee,null,{default:i(()=>[s(n(Fe)),C(" "+k(n(m).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:1},8,["file-list","before-upload","onRemove"])):(r(),v(n(W),{key:5,value:g.value[o.key],"onUpdate:value":w=>g.value[o.key]=w,placeholder:o.description,type:"password",onInput:()=>x(o.key,g.value[o.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),o.instructions?(r(),b("div",gn,[s(n(H),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:i(()=>[C(k(o.instructions),1)]),_:2},1024)])):N("",!0),o.description&&!o.instructions?(r(),v(n(H),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:i(()=>[C(k(o.description),1)]),_:2},1024)):N("",!0)]}),_:2},1032,["required","label","name","rules"])),[[Ce,_(o)]])),128))]),_:1},8,["model"]))}}),yn=q({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(l){return(t,a)=>(r(),v(n(S),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:i(()=>[s(ze,{"hide-text":"",size:"large"}),s(n(rn),{size:24}),s(He,{"image-url":l.connectorLogoUrl,"brand-name":l.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),hn=q({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(l,{emit:t}){const a=l,e=t,c=B(()=>{var R,u,d;switch((R=a.addingConnection)==null?void 0:R.connector.auth.type){case"oauth2":return m.translate("i18n_connection_modal_button_authorize",null);case"tokens":return m.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!a.ecdsaPublicKey)return m.translate("i18n_connection_modal_button_ok",null);const o=((u=a.addingConnection)==null?void 0:u.connector.auth.params)||[],A=((d=a.addingConnection)==null?void 0:d.tokenValues)||{};return o.every(f=>A[f.key]&&A[f.key].trim().length>0)?m.translate("i18n_connection_modal_button_create",null):m.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return m.translate("i18n_connection_modal_button_ok",null)}});function h(){e("cancel")}function _(){e("submit")}function T(V,R){e("scope-toggle",V,R)}function g(){e("generate-ecdsa-key")}function x(V){e("update:token-values",V)}function I(V){e("update:uploaded-files",V)}function L(){e("token-change")}return(V,R)=>(r(),v(n(J),{open:!!l.addingConnection,title:l.addingConnection?n(m).translate("i18n_connection_modal_title_add",null,l.addingConnection.connector.metadata.label):"","ok-text":c.value,"ok-button-props":{disabled:c.value.includes("Required")},"confirm-loading":l.loading,"wrap-class-name":"full-modal",onCancel:h,onOk:_},{default:i(()=>[l.addingConnection?(r(),b(j,{key:0},[s(yn,{"connector-logo-url":l.addingConnection.connector.metadata.logoUrl,"connector-label":l.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),l.addingConnection.connector.auth.type==="oauth2"?(r(),b(j,{key:0},[s(n(G),null,{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),s(n(S),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:i(()=>{var u;return[(r(!0),b(j,null,D(l.addingConnection.connector.auth.scopes,d=>(r(),v(n(S),{key:d.key,justify:"space-between",align:"center"},{default:i(()=>[s(n(S),{vertical:""},{default:i(()=>[s(n(H),null,{default:i(()=>[C(k(d.description),1)]),_:2},1024),s(n(H),{type:"secondary"},{default:i(()=>[C(k(d.key),1)]),_:2},1024)]),_:2},1024),s(n(Ue),{checked:l.addingConnection.selectedScopeIds.includes(d.key),onChange:o=>T(d.key,o)},null,8,["checked","onChange"])]),_:2},1024))),128)),(u=l.addingConnection.connector.auth.params)!=null&&u.length?(r(),v(X,{key:0,tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":x,"onUpdate:uploadedFiles":I,onTokenChange:L},null,8,["tokens","token-values","uploaded-files"])):N("",!0)]}),_:1})],64)):N("",!0),l.addingConnection.connector.auth.type==="tokens"?(r(),b(j,{key:1},[s(n(G),null,{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),s(X,{tokens:l.addingConnection.connector.auth.tokens,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":x,"onUpdate:uploadedFiles":I,onTokenChange:L},null,8,["tokens","token-values","uploaded-files"])],64)):N("",!0),l.addingConnection.connector.auth.type==="ecdsa"?(r(),b(j,{key:2},[l.ecdsaPublicKey?(r(),v(n(S),{key:1,vertical:"",gap:"16"},{default:i(()=>[s(n(H),{strong:""},{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),s(n(H),{strong:""},{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),s(n(W),{value:l.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),s(X,{tokens:l.addingConnection.connector.auth.params,"token-values":l.addingConnection.tokenValues,"uploaded-files":l.uploadedFiles,"onUpdate:tokenValues":x,"onUpdate:uploadedFiles":I,onTokenChange:L},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(r(),b(j,{key:0},[s(n(G),null,{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),s(n(S),{vertical:"",gap:"16"},{default:i(()=>[s(ee,{loading:l.ecdsaKeyLoading,onClick:g},{default:i(()=>[C(k(n(m).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):N("",!0)],64)):N("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),mn=q({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{},isBeta:{type:Boolean}},setup(l){return(t,a)=>(r(),v(n(de),{class:$e({"connector-card":!0,unavailable:l.unavailable})},{default:i(()=>[s(n(S),{style:{width:"100%"},vertical:"",gap:12},{default:i(()=>[s(n(S),{justify:"space-between"},{default:i(()=>[s(n(ue),{src:l.logoUrl,shape:"square",size:"large"},null,8,["src"]),s(n(S),{gap:8},{default:i(()=>[l.isBeta?(r(),v(n(ie),{key:0,color:"orange",style:{height:"fit-content"}},{default:i(()=>[...a[0]||(a[0]=[C("BETA",-1)])]),_:1})):N("",!0),l.unavailable?(r(),v(n(ie),{key:1,style:{height:"fit-content"}},{default:i(()=>[C(k(n(m).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):N("",!0)]),_:1})]),_:1}),s(n(S),{vertical:""},{default:i(()=>[s(n(H),{strong:""},{default:i(()=>[C(k(l.title),1)]),_:1}),s(n(H),{type:"secondary"},{default:i(()=>[C(k(l.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const fn=re(mn,[["__scopeId","data-v-86187920"]]),vn={class:"connectors-grid"},Cn=q({__name:"ConnectorsView",setup(l){const a=je().params.projectId,e=new dn(a,new un),c=M(null),h=M(!1),_=M({}),T=M(!1),g=B(()=>[...e.state.value.connectors.filter(p=>p.auth.type==="oauth2"),...e.state.value.connectors.filter(p=>p.auth.type==="tokens"),...e.state.value.connectors.filter(p=>p.auth.type==="ecdsa"),...e.state.value.connectors.filter(p=>p.auth.type==="manual")]),x=M(""),I=B(()=>{if(!x.value.trim())return g.value;const p=x.value.trim().toLowerCase();return g.value.filter(f=>{var U,F;const y=((U=f.metadata.label)==null?void 0:U.toLowerCase())||"",$=((F=f.metadata.key)==null?void 0:F.toLowerCase())||"";return y.includes(p)||$.includes(p)})}),L=B(()=>e.state.value.connections.filter(p=>p&&p.name&&p.connectorTitle&&p.connectorType));e.fetchInitialState();function V(p){e.state.value.addingConnection&&(e.state.value.addingConnection.tokenValues=p)}function R(p){_.value=p}function u(){c.value=null,h.value=!1,_.value={}}async function d(){h.value=!0;try{const f=(await e.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");c.value=f}finally{h.value=!1}}async function o(){var f,y,$;const p=(f=e.state.value.addingConnection)==null?void 0:f.connector.auth.type;T.value=!0;try{switch(p){case"oauth2":return await e.handleAddConnectionSubmit();case"tokens":return await e.handleAddTokenConnectionSubmit();case"ecdsa":{const U=((y=e.state.value.addingConnection)==null?void 0:y.tokenValues)||{},F=($=e.state.value.addingConnection)==null?void 0:$.connector.metadata.key;let E="";F==="starkbank"?E=U.projectId||"":F==="iugu"&&(E=U.apiToken||"");const Z=await e.handleAddEcdsaConnectionSubmit(c.value,E);return u(),Z}default:break}}catch(U){const F=E=>{try{return JSON.parse(E),!0}catch{return!1}};if(U instanceof Error&&F(U.message)){const E=se.object({error:se.string()}).safeParse(JSON.parse(U.message));if(E.success){Y.error(E.data.error);return}else{Y.error(m.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:U instanceof Error?U.message:"Unknown error"}));return}}else Y.error(m.translate("i18n_connectorsview_failed_to_create"))}finally{T.value=!1}}function A(p){p.auth.type==="manual"?Le.showNewMessage(m.translate("i18n_connectors_ask_for_access",null,p.metadata.label)):e.showAddConfirmationModal(p)}return(p,f)=>(r(),b(j,null,[s(n(Re),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:i(()=>[s(n(S),{align:"center",justify:"space-between"},{default:i(()=>[s(n(Q),null,{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),s(n(G),null,{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_description"))+" ",1),s(ye)]),_:1}),L.value.length?(r(),v(n(S),{key:0,vertical:""},{default:i(()=>[s(n(Q),{level:2},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_installed")),1)]),_:1}),s(n(S),{vertical:"",gap:10},{default:i(()=>[(r(!0),b(j,null,D(L.value,y=>(r(),v(n(de),{key:y.name},{default:i(()=>[s(n(S),{align:"center",gap:20},{default:i(()=>[s(n(ue),{src:y.icon,height:"40px",shape:"square"},null,8,["src"]),s(n(H),{strong:""},{default:i(()=>[C(k(y.connectorTitle),1)]),_:2},1024),f[6]||(f[6]=P("div",{style:{"flex-grow":"1"}},null,-1)),s(n(H),{content:y.name,copyable:"",code:""},null,8,["content"]),s(n(Ne),null,{overlay:i(()=>[s(n(Ve),null,{default:i(()=>[s(n(ce),{onClick:$=>n(e).handleEditConnectionClick(y)},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_rename")),1)]),_:1},8,["onClick"]),s(n(ce),{danger:"",onClick:$=>n(e).handleDeletionClick(y)},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:i(()=>[s(n(Ke))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):N("",!0),s(n(S),{vertical:""},{default:i(()=>[L.value.length?(r(),v(n(Q),{key:0,level:2},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_available")),1)]),_:1})):N("",!0),s(n(Ee),{value:x.value,"onUpdate:value":f[0]||(f[0]=y=>x.value=y),placeholder:n(m).translate("i18n_connectorsview_search_placeholder"),style:{width:"300px","margin-bottom":"40px"}},null,8,["value","placeholder"]),P("div",vn,[(r(!0),b(j,null,D(I.value,y=>{var $;return r(),v(fn,{key:y.metadata.key,title:y.metadata.label,"logo-url":y.metadata.logoUrl,description:y.metadata.description,unavailable:y.auth.type==="manual",connector:y,"is-beta":($=n(e).state.value.betaStatus[y.metadata.key])!=null?$:!1,onClick:U=>A(y)},null,8,["title","logo-url","description","unavailable","connector","is-beta","onClick"])}),128))])]),_:1})]),_:1}),s(n(J),{open:!!n(e).state.value.editingConnection,title:n(e).state.value.editingConnection?n(m).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:n(e).state.value.editingConnection.connectorTitle}):"",onCancel:f[3]||(f[3]=y=>n(e).state.value.editingConnection=null)},{footer:i(()=>[s(n(S),{justify:"end"},{default:i(()=>[s(ee,{disabled:!n(e).hasChanges.value,onClick:f[2]||(f[2]=y=>n(e).renameConnection())},{default:i(()=>[C(k(n(m).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[n(e).state.value.editingConnection?(r(),v(n(W),{key:0,value:n(e).state.value.editingConnection.newName,"onUpdate:value":f[1]||(f[1]=y=>n(e).state.value.editingConnection.newName=y)},null,8,["value"])):N("",!0)]),_:1},8,["open","title"]),s(hn,{"adding-connection":n(e).state.value.addingConnection,"ecdsa-public-key":c.value,"ecdsa-key-loading":h.value,"uploaded-files":_.value,loading:T.value,onCancel:f[4]||(f[4]=()=>{n(e).state.value.addingConnection=null,u()}),onSubmit:o,onScopeToggle:f[5]||(f[5]=(y,$)=>n(e).handleScopeToggle(y,$)),onGenerateEcdsaKey:d,"onUpdate:tokenValues":V,"onUpdate:uploadedFiles":R},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}});const En=re(Cn,[["__scopeId","data-v-21b5de4f"]]);export{En as default};
//# sourceMappingURL=ConnectorsView.2f969d5e.js.map

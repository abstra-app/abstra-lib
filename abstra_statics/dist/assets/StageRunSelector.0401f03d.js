import{d as _,H as I,r as D,o as R,G as k,b as c,ev as A,f as g,w as u,c as p,u as i,ae as C,ar as m,bP as N,e as O,ez as V,ex as T,a$ as J,v as x}from"./outputWidgets.e46e0ded.js";import{e as B}from"./toggleHighContrast.36a5ed4e.js";import{v as F}from"./string.44e540f4.js";import{f as $}from"./index.8a7fae95.js";import{A as z}from"./index.b0838867.js";import{A as E}from"./FormItem.028a21cb.js";import{F as j}from"./Form.e62bba2a.js";import{A as M}from"./Text.dfce2b71.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[t]="bc2bf87a-9ab1-493c-b196-8516e6f59340",r._sentryDebugIdIdentifier="sentry-dbid-bc2bf87a-9ab1-493c-b196-8516e6f59340")}catch{}})();class P{async list(t){const s=new URLSearchParams({stage:t});return await(await fetch(`/_editor/api/stage_runs?${s}`)).json()}}const U=new P;class b{constructor(t){this.dto=t}static async list(t){return(await U.list(t)).map(l=>new b(l))}get id(){return this.dto.id}get data(){return this.dto.data}get assignee(){return this.dto.assignee}get stage(){return this.dto.stage}get status(){return this.dto.status}get createdAt(){return new Date(this.dto.createdAt)}}const G=_({__name:"StageRunSelector",props:{stage:{},stageRunId:{},enableStartThread:{type:Boolean}},emits:["update:stage-run-id","update:enable-start-thread"],setup(r,{emit:t}){var h;const s=r,l=I(()=>s.stage.testData?!F(s.stage.testData):!1),f=D(null),v=e=>{const a=d.stageRuns.find(S=>S.id===e),o=JSON.stringify(a==null?void 0:a.data,null,2);t("update:stage-run-id",e),n.setValue(o),n.updateOptions({readOnly:!!e})},y=()=>{t("update:stage-run-id",null),n.setValue("{}"),n.updateOptions({readOnly:!1})},w=e=>{t("update:enable-start-thread",e),n.setValue("{}"),n.updateOptions({readOnly:e})};let n;R(async()=>{d.stageRuns=await b.list(s.stage.id),d.options=d.stageRuns.filter(e=>e.status==="waiting").map(e=>({value:e.id,label:`Started ${$(e.createdAt,{addSuffix:!0})}`})),n=B.create(f.value,{language:"json",value:s.stage.testData,fontFamily:"monospace",lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",horizontal:"visible"}}),n.onDidChangeModelContent(()=>{s.stage.testData=n.getValue()})});const d=k({stageRuns:[],options:[],loading:!1,stageRunId:(h=s.stageRunId)!=null?h:void 0});return(e,a)=>(c(),A(J,null,[g(i(j),{layout:"vertical"},{default:u(()=>[e.stage.isInitial?(c(),p(i(N),{key:1,checked:e.enableStartThread,onChange:a[3]||(a[3]=o=>w(o.target.checked))},{default:u(()=>[m(" Continue with the thread after this ")]),_:1},8,["checked"])):(c(),p(i(E),{key:0,label:"Select a thread or edit the test thread data"},{default:u(()=>[g(i(C),{value:d.stageRunId,"onUpdate:value":a[0]||(a[0]=o=>d.stageRunId=o),placeholder:"No thread selected","filter-option":"",style:{width:"100%"},"allow-clear":!0,options:d.options,disabled:e.stage.isInitial,"not-found-content":"There are no waiting threads",onSelect:a[1]||(a[1]=o=>v(o)),onClear:a[2]||(a[2]=o=>y())},null,8,["value","options","disabled"])]),_:1}))]),_:1}),g(i(z),{orientation:"left"},{default:u(()=>[m("Data")]),_:1}),O("div",{ref_key:"dataJson",ref:f,class:V(["data-container",{threaded:!!e.stageRunId||e.stage.isInitial,invalid:l.value}])},null,2),l.value?(c(),p(i(M),{key:0,type:"danger"},{default:u(()=>[m("Invalid JSON")]),_:1})):T("",!0)],64))}});const Z=x(G,[["__scopeId","data-v-5f4e39b0"]]);export{Z as S};
//# sourceMappingURL=StageRunSelector.0401f03d.js.map

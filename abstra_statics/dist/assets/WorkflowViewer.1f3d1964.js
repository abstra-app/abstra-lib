var Ie=Object.defineProperty;var $e=(l,t,o)=>t in l?Ie(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o;var me=(l,t,o)=>($e(l,typeof t!="symbol"?t+"":t,o),o);import{_ as ee}from"./AbstraButton.vue_vue_type_script_setup_true_lang.0c061ebe.js";import{F as Le,I as xe,O as je}from"./os.b85576d6.js";import{d as U,at as te,c as $,o as g,ac as E,ae as Ce,h as W,ew as Te,e as h,f as s,u as e,a as j,b as a,g as P,t as v,df as J,ad as ze,aY as be,_ as fe,dj as D,eB as Ze,ft as ve,de as ae,i as S,cS as ke,cT as Pe,eA as Se,ec as Me,eD as ie,bE as Be,bD as le,ez as ge,bW as Ee,cM as Ne,eV as De,fw as Ve,v as We,r as B,w as we,ax as He,X as Fe,S as Ye,A as ne,dd as Xe,eY as Ge,eZ as Oe}from"./jwt-decode.esm.bd82b615.js";import{F as qe}from"./PhArrowSquareOut.vue.8362a69f.js";import{I as _e}from"./PhCopy.vue.c9addbb8.js";import{G as Je}from"./PhPencilSimple.vue.f5b6ce77.js";import{_ as Ue}from"./vue-flow-background.5ac96ded.js";import{a as Ke,b as Qe,g as re,u as Re,e as et,M as tt}from"./vue-flow-core.a4b79d62.js";import{k as de}from"./router.940f241f.js";import{a as he,B as at,b as st}from"./build.98a07a00.js";import{a as ot,P as it}from"./project.0d946df4.js";import"./tables.1e9a0b00.js";import{G as lt}from"./PhArrowCounterClockwise.vue.0af500be.js";import{I as nt}from"./PhCopySimple.vue.72e4a031.js";import{G as rt}from"./PhDotsThreeVertical.vue.49ae4af1.js";import{F as dt,G as ct,I as ut,a as pt}from"./PhWebhooksLogo.vue.e279dd84.js";import{g as gt}from"./datetime.b3be54c7.js";import{_ as ft}from"./ExecutionStatusIcon.vue_vue_type_script_setup_true_lang.92b600a1.js";import{u as mt}from"./polling.447302b6.js";import{C as ce}from"./Card.65e6b91d.js";import"./ts.worker.c7dc6285.js";import"./record.353ed1db.js";import"./string.f4dafc3c.js";import"./LoadingOutlined.efef5c1a.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[t]="b47b2836-3d26-4b0f-8244-8e7dc2cfa5b7",l._sentryDebugIdIdentifier="sentry-dbid-b47b2836-3d26-4b0f-8244-8e7dc2cfa5b7")}catch{}})();const vt=["width","height","fill","transform"],wt={key:0},_t=h("path",{d:"M227.85,46.89a20,20,0,0,0-18.74-18.74c-13.13-.77-46.65.42-74.48,28.24L131,60H74.36a19.83,19.83,0,0,0-14.14,5.86L25.87,100.19a20,20,0,0,0,11.35,33.95l37.14,5.18,42.32,42.32,5.19,37.18A19.88,19.88,0,0,0,135.34,235a20.13,20.13,0,0,0,6.37,1,19.9,19.9,0,0,0,14.1-5.87l34.34-34.35A19.85,19.85,0,0,0,196,181.64V125l3.6-3.59C227.43,93.54,228.62,60,227.85,46.89ZM76,84h31L75.75,115.28l-27.23-3.8ZM151.6,73.37A72.27,72.27,0,0,1,204,52a72.17,72.17,0,0,1-21.38,52.41L128,159,97,128ZM172,180l-27.49,27.49-3.8-27.23L172,149Zm-72,22c-8.71,11.85-26.19,26-60,26a12,12,0,0,1-12-12c0-33.84,14.12-51.32,26-60A12,12,0,1,1,68.18,175.3C62.3,179.63,55.51,187.8,53,203c15.21-2.51,23.37-9.3,27.7-15.18A12,12,0,1,1,100,202Z"},null,-1),ht=[_t],yt={key:1},bt=h("path",{d:"M184,120v61.65a8,8,0,0,1-2.34,5.65l-34.35,34.35a8,8,0,0,1-13.57-4.53L128,176ZM136,72H74.35a8,8,0,0,0-5.65,2.34L34.35,108.69a8,8,0,0,0,4.53,13.57L80,128ZM40,216c37.65,0,50.69-19.69,54.56-28.18L68.18,161.44C59.69,165.31,40,178.35,40,216Z",opacity:"0.2"},null,-1),kt=h("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),St=[bt,kt],Mt={key:2},At=h("path",{d:"M101.85,191.14C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Zm122-144a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.4,27.07h0L88,108.7A8,8,0,0,1,76.67,97.39l26.56-26.57A4,4,0,0,0,100.41,64H74.35A15.9,15.9,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A16,16,0,0,0,192,181.65V155.59a4,4,0,0,0-6.83-2.82l-26.57,26.56a8,8,0,0,1-11.71-.42,8.2,8.2,0,0,1,.6-11.1l49.27-49.27h0C223.45,91.86,224.6,59.71,223.85,47.12Z"},null,-1),It=[At],$t={key:3},Lt=h("path",{d:"M221.86,47.24a14,14,0,0,0-13.11-13.1c-12.31-.73-43.77.39-69.88,26.5L133.52,66H74.35a13.9,13.9,0,0,0-9.89,4.1L30.11,104.44a14,14,0,0,0,7.94,23.76l39.13,5.46,45.16,45.16L127.8,218a14,14,0,0,0,23.76,7.92l34.35-34.35a13.91,13.91,0,0,0,4.1-9.89V122.48l5.35-5.35h0C221.46,91,222.59,59.56,221.86,47.24ZM38.11,115a2,2,0,0,1,.49-2L72.94,78.58A2,2,0,0,1,74.35,78h47.17L77.87,121.64l-38.14-5.32A1.93,1.93,0,0,1,38.11,115ZM178,181.65a2,2,0,0,1-.59,1.41L143.08,217.4a2,2,0,0,1-3.4-1.11l-5.32-38.16L178,134.48Zm8.87-73h0L128,167.51,88.49,128l58.87-58.88a78.47,78.47,0,0,1,60.69-23A2,2,0,0,1,209.88,48,78.47,78.47,0,0,1,186.88,108.64ZM100,190.31C95.68,199.84,81.13,222,40,222a6,6,0,0,1-6-6c0-41.13,22.16-55.68,31.69-60a6,6,0,1,1,5,10.92c-7,3.17-22.53,13.52-24.47,42.91,29.39-1.94,39.74-17.52,42.91-24.47a6,6,0,1,1,10.92,5Z"},null,-1),xt=[Lt],jt={key:4},Ct=h("path",{d:"M223.85,47.12a16,16,0,0,0-15-15c-12.58-.75-44.73.4-71.41,27.07L132.69,64H74.36A15.91,15.91,0,0,0,63,68.68L28.7,103a16,16,0,0,0,9.07,27.16l38.47,5.37,44.21,44.21,5.37,38.49a15.94,15.94,0,0,0,10.78,12.92,16.11,16.11,0,0,0,5.1.83A15.91,15.91,0,0,0,153,227.3L187.32,193A15.91,15.91,0,0,0,192,181.64V123.31l4.77-4.77C223.45,91.86,224.6,59.71,223.85,47.12ZM74.36,80h42.33L77.16,119.52,40,114.34Zm74.41-9.45a76.65,76.65,0,0,1,59.11-22.47,76.46,76.46,0,0,1-22.42,59.16L128,164.68,91.32,128ZM176,181.64,141.67,216l-5.19-37.17L176,139.31Zm-74.16,9.5C97.34,201,82.29,224,40,224a8,8,0,0,1-8-8c0-42.29,23-57.34,32.86-61.85a8,8,0,0,1,6.64,14.56c-6.43,2.93-20.62,12.36-23.12,38.91,26.55-2.5,36-16.69,38.91-23.12a8,8,0,1,1,14.56,6.64Z"},null,-1),Tt=[Ct],zt={key:5},Zt=h("path",{d:"M219.86,47.36a12,12,0,0,0-11.22-11.22c-12-.71-42.82.38-68.35,25.91L134.35,68h-60a11.9,11.9,0,0,0-8.48,3.52L31.52,105.85a12,12,0,0,0,6.81,20.37l39.79,5.55,46.11,46.11,5.55,39.81a12,12,0,0,0,20.37,6.79l34.34-34.35a11.9,11.9,0,0,0,3.52-8.48v-60l5.94-5.94C219.48,90.18,220.57,59.41,219.86,47.36ZM36.21,115.6a3.94,3.94,0,0,1,1-4.09L71.53,77.17A4,4,0,0,1,74.35,76h52L78.58,123.76,39.44,118.3A3.94,3.94,0,0,1,36.21,115.6ZM180,181.65a4,4,0,0,1-1.17,2.83l-34.35,34.34a4,4,0,0,1-6.79-2.25l-5.46-39.15L180,129.65Zm-52-11.31L85.66,128l60.28-60.29c23.24-23.24,51.25-24.23,62.22-23.58a3.93,3.93,0,0,1,3.71,3.71c.65,11-.35,39-23.58,62.22ZM98.21,189.48C94,198.66,80,220,40,220a4,4,0,0,1-4-4c0-40,21.34-54,30.52-58.21a4,4,0,0,1,3.32,7.28c-7.46,3.41-24.43,14.66-25.76,46.85,32.19-1.33,43.44-18.3,46.85-25.76a4,4,0,1,1,7.28,3.32Z"},null,-1),Pt=[Zt],Bt={name:"PhRocketLaunch"},Et=U({...Bt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(l){const t=l,o=te("weight","regular"),y=te("size","1em"),b=te("color","currentColor"),n=te("mirrored",!1),r=$(()=>{var f;return(f=t.weight)!=null?f:o}),d=$(()=>{var f;return(f=t.size)!=null?f:y}),m=$(()=>{var f;return(f=t.color)!=null?f:b}),u=$(()=>t.mirrored!==void 0?t.mirrored?"scale(-1, 1)":void 0:n?"scale(-1, 1)":void 0);return(f,k)=>(g(),E("svg",Te({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:d.value,height:d.value,fill:m.value,transform:u.value},f.$attrs),[Ce(f.$slots,"default"),r.value==="bold"?(g(),E("g",wt,ht)):r.value==="duotone"?(g(),E("g",yt,St)):r.value==="fill"?(g(),E("g",Mt,It)):r.value==="light"?(g(),E("g",$t,xt)):r.value==="regular"?(g(),E("g",jt,Tt)):r.value==="thin"?(g(),E("g",zt,Pt)):W("",!0)],16,vt))}}),Nt=U({__name:"WorkflowEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{type:[String,Object,Function]},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(l){const t=l;function o(n,r,d=0){const m=r.center.x-n.center.x,u=r.center.y-n.center.y,f=Math.sqrt(m*m+u*u);if(f===0)return{sourceX:n.center.x,sourceY:n.center.y,targetX:r.center.x,targetY:r.center.y};const k=m/f,M=u/f,L=n.width/2,w=n.height/2;let x=n.center.x,A=n.center.y;Math.abs(k)*w>Math.abs(M)*L?(x=n.center.x+(k>0?L:-L),A=n.center.y+M*L/Math.abs(k)):(x=n.center.x+k*w/Math.abs(M),A=n.center.y+(M>0?w:-w));const p=r.width/2,z=r.height/2;let C=r.center.x,V=r.center.y;return Math.abs(k)*z>Math.abs(M)*p?(C=r.center.x-(k>0?p:-p),V=r.center.y-M*p/Math.abs(k)):(C=r.center.x-k*z/Math.abs(M),V=r.center.y-(M>0?z:-z)),x+=k*d,A+=M*d,C-=k*d,V-=M*d,{sourceX:x,sourceY:A,targetX:C,targetY:V}}function y(n,r){const m={center:{x:n.computedPosition.x+n.dimensions.width/2,y:n.computedPosition.y+n.dimensions.height/2},width:n.dimensions.width,height:n.dimensions.height},f={center:{x:r.computedPosition.x+r.dimensions.width/2,y:r.computedPosition.y+r.dimensions.height/2},width:r.dimensions.width,height:r.dimensions.height};return o(m,f,10)}const b=$(()=>{if(!t.sourceNode||!t.targetNode)return re({sourceX:0,sourceY:0,targetX:0,targetY:0});if(!t.sourceNode.dimensions.width||!t.targetNode.dimensions.width||!t.sourceNode.dimensions.height||!t.targetNode.dimensions.height)return re({sourceX:0,sourceY:0,targetX:0,targetY:0});const n=y(t.sourceNode,t.targetNode);return re(n)});return(n,r)=>{var d,m;return g(),E(be,null,[s(e(Ke),{path:b.value[0],"marker-end":t.markerEnd},null,8,["path","marker-end"]),(m=(d=t.data)==null?void 0:d.props)!=null&&m.taskType?(g(),j(e(Qe),{key:0},{default:a(()=>[h("div",{style:ze({transform:`translate(-50%, -50%) translate(${b.value[1]}px,${b.value[2]}px)`}),class:"nodrag nopan edge-label"},[s(e(J),null,{default:a(()=>[P(v(t.data.props.taskType),1)]),_:1})],4)]),_:1})):W("",!0)],64)}}});const Dt=fe(Nt,[["__scopeId","data-v-8f1859d4"]]),Vt=U({__name:"WorkflowStageExecutions",props:{stageId:{},projectId:{},statistics:{}},setup(l){const t=l,o=d=>{if(!d.createdAt||!d.updatedAt)return 0;const m=new Date(d.createdAt).getTime(),u=new Date(d.updatedAt).getTime();return Math.round((u-m)/1e3)},y=$(()=>t.statistics?Math.round(t.statistics.completedTasks/t.statistics.totalTasks*100):0),b=$(()=>{const d=y.value;return d===100?"#52c41a":d>=50?"#1890ff":"#faad14"}),n=d=>gt(d,{weekday:void 0}),r=d=>{if(d<60)return`${Math.round(d)}s`;const m=Math.floor(d/60);if(m<60)return`${m}m`;const u=Math.floor(m/60);return u<24?`${u}h`:`${Math.floor(u/24)}d`};return(d,m)=>(g(),j(e(D),{vertical:"",size:4,style:{width:"100%"}},{default:a(()=>[l.statistics.lastExecutions&&l.statistics.lastExecutions.length>0?(g(),j(e(D),{key:0,size:4,gap:4},{default:a(()=>[(g(!0),E(be,null,Ze(l.statistics.lastExecutions,u=>(g(),j(e(ve),{key:u.id,to:{name:"logs",params:{projectId:l.projectId},query:{executionId:u.id}}},{default:a(()=>[s(e(ke),{title:n(new Date(u.createdAt))},{content:a(()=>[s(e(D),{vertical:"",size:4},{default:a(()=>[s(e(ae),null,{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_status"))+": "+v(u.status),1)]),_:2},1024),u.updatedAt&&u.updatedAt!==u.createdAt?(g(),j(e(ae),{key:0},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_duration"))+": "+v(o(u))+"s ",1)]),_:2},1024)):W("",!0),s(e(ae),null,{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_version"))+": "+v(u.buildId.slice(0,6)),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[s(ft,{status:u.status},null,8,["status"])]),_:2},1032,["title"])]),_:2},1032,["to"]))),128))]),_:1})):W("",!0),l.statistics.totalTasks>0?(g(),j(e(ve),{key:1,to:{name:"tasks",params:{projectId:l.projectId},query:{stage:l.stageId,status:"pending"}}},{default:a(()=>[s(e(D),{vertical:"",size:2},{default:a(()=>[s(e(Pe),{"show-info":!1,percent:y.value,"stroke-color":b.value,size:"small"},null,8,["percent","stroke-color"]),s(e(D),{vertical:"",size:0},{default:a(()=>[l.statistics.pendingTasks>0&&l.statistics.averageCompletionSeconds?(g(),j(e(ae),{key:0,type:"secondary",style:{fontSize:"11px"}},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_pending_tasks").replace("{count}",l.statistics.pendingTasks.toString()))+" ("+v(r(l.statistics.averageCompletionSeconds))+" "+v(e(S).translate("i18n_workflowviewer_average"))+") ",1)]),_:1})):W("",!0)]),_:1})]),_:1})]),_:1},8,["to"])):W("",!0)]),_:1}))}}),Wt={class:"stage-content"},Ht={class:"stage-title"},Ft={class:"action-item"},Yt={class:"action-item"},Xt={class:"action-warning"},Gt={key:1,class:"action-item"},ye="3.18.0",Ot=U({__name:"WorkflowStageNode",props:{stage:{},statistics:{},isDisabled:{type:Boolean},project:{},buildSpec:{}},emits:["toggle-stage-enabled-state"],setup(l,{emit:t}){const o=l,y=Se(),b=Me(),n=y.params.projectId,r=$(()=>({forms:dt,hooks:ct,scripts:ut,jobs:pt})[o.stage.type]),d=()=>{b.push({name:"logs",params:{projectId:n},query:{stageId:o.stage.id}})},m=$(()=>o.stage.type==="forms"||o.stage.type==="hooks"),u=()=>{var C;if(!o.stage.path)return;const p=o.stage.type==="forms"?`/${o.stage.path}`:`/_hooks/${o.stage.path}`,z=(C=o.project)==null?void 0:C.getUrl(p);!z||(navigator.clipboard.writeText(z),Ne.success(S.translate("i18n_workflowviewer_copied_url")))},f=(p,z)=>{const[C,V,K]=p.split(".").map(Number),[G,Y,oe]=z.split(".").map(Number);return C>G?!0:C<G?!1:V>Y?!0:V<Y?!1:K>=oe},k=$(()=>o.isDisabled?De:Ve),M=$(()=>o.isDisabled?S.translate("i18n_workflowviewer_enable_stage"):S.translate("i18n_workflowviewer_disable_stage")),L=$(()=>{var p;return!f(((p=o.buildSpec)==null?void 0:p.abstraVersion)||"0.0.0",ye)}),w=$(()=>L.value?S.translate("i18n_workflowviewer_disable_stages_warning").replace("{version}",ye):""),x=t,A=async()=>{L.value||await x("toggle-stage-enabled-state",o.stage.id)};return(p,z)=>(g(),E("div",{class:ge(["stage-node",{disabled:l.isDisabled}])},[h("div",Wt,[(g(),j(ie(r.value),{size:18,class:"stage-icon"})),h("div",Ht,v(l.stage.title),1),s(e(Ee),{trigger:["click"]},{overlay:a(()=>[s(e(Be),null,{default:a(()=>[s(e(le),{onClick:d},{default:a(()=>[h("div",Ft,[s(e(lt),{size:16}),h("span",null,v(e(S).translate("i18n_workflowviewer_view_logs")),1)])]),_:1}),m.value?(g(),j(e(le),{key:0,onClick:u},{default:a(()=>[h("div",Yt,[s(e(nt),{size:16}),h("span",null,v(e(S).translate("i18n_workflowviewer_copy_url")),1)])]),_:1})):W("",!0),s(e(le),{onClick:A},{default:a(()=>[L.value?(g(),j(e(ke),{key:0,placement:"left"},{content:a(()=>[h("div",Xt,[s(e(J),null,{default:a(()=>[P(v(w.value),1)]),_:1})])]),default:a(()=>[h("div",{class:ge(["action-item",{disabled:L.value}])},[(g(),j(ie(k.value),{size:16})),h("span",null,v(M.value),1)],2)]),_:1})):(g(),E("div",Gt,[(g(),j(ie(k.value),{size:16})),h("span",null,v(M.value),1)]))]),_:1})]),_:1})]),default:a(()=>[s(e(rt),{style:{cursor:"pointer"},size:20,class:"actions-menu"})]),_:1})]),l.statistics?(g(),j(Vt,{key:0,"stage-id":l.stage.id,"project-id":e(n),statistics:l.statistics,style:{"margin-top":"8px"}},null,8,["stage-id","project-id","statistics"])):W("",!0)],2))}});const se=fe(Ot,[["__scopeId","data-v-72a65f73"]]);class qt{async list(t){return de.get(`projects/${t}/disabled-stages`)}async disableStage({projectId:t,stageId:o}){return de.patch(`projects/${t}/disabled-stages/${o}`,{enable:!1})}async enableStage({projectId:t,stageId:o}){return de.patch(`projects/${t}/disabled-stages/${o}`,{enable:!0})}}const ue=new qt;class X{constructor(t){me(this,"id");this.dto=t,this.id=t}static async list(t){return(await ue.list(t)).map(y=>new X(y))}static async disableStage({projectId:t,stageId:o}){return ue.disableStage({projectId:t,stageId:o})}static async enableStage({projectId:t,stageId:o}){return ue.enableStage({projectId:t,stageId:o})}}const Jt=We("workflow",()=>{const l=B([]),t=B(null),o=B(!1);let y=null,b=null,n=null,r=[];async function d(){if(!b||!n){console.warn("Cannot load data: no project context set");return}o.value=!0;try{const w=await n.getWorkflowStatistics(b),x=new Set(r),A=new Map(w.filter(p=>x.has(p.stageId)).map(p=>[p.stageId,p]));l.value=r.map(p=>A.has(p)?A.get(p):{stageId:p,lastExecutions:[],pendingTasks:0,lockedTasks:0,completedTasks:0,averageCompletionSeconds:void 0,totalTasks:0}),await k()}catch(w){console.error("Failed to load workflow data:",w)}finally{o.value=!1}}function m(w,x,A){if(y&&y.endPolling(),n=w,b=x,r=A,A.length>0){const p=mt({task:d,interval:15e3});y=p,d(),p.startPolling()}}function u(){y&&(y.endPolling(),y=null)}function f(){u(),l.value=[],t.value=null,o.value=!1,b=null,n=null,r=[]}async function k(){if(!b){console.warn("Cannot refetch disabled stages: no project context set");return}t.value=await X.list(b)}async function M(w){var x;(x=t.value)!=null&&x.some(A=>A.id===w)?(t.value=t.value.filter(A=>A.id!==w),await X.enableStage({projectId:b,stageId:w})):(t.value=[...t.value||[],new X(w)],await X.disableStage({projectId:b,stageId:w})),await k()}const L=$(()=>w=>l.value.find(x=>x.stageId===w)||null);return{statistics:l,disabledStages:t,loading:o,getStatisticsForStage:L,initializePolling:m,stopPolling:u,resetStore:f,refetch:d,toggleStageEnabledState:M}}),Ut={class:"flow-container"},Kt={class:"code-container"},Qt={class:"code-container"},Rt={key:0,class:"edit-button-text"},pe="#ea576a",ea=U({__name:"WorkflowViewer",setup(l){const{onInit:t}=Re(),o=new st,y=Se(),b=Me(),n=y.params.projectId,r=y.query.buildId,d=B(!0),m=B(null),u=B(!0),f=B(!1),k=()=>{b.push({name:"web-editor",params:{projectId:n}})},M=async _=>{try{await navigator.clipboard.writeText(_)}catch(i){console.error("Failed to copy:",i)}};t(_=>{u.value&&(_.fitView(),u.value=!1)});const L=B([]),w=B([]),x=$(()=>L.value.map(_=>_.id)),A=new it,p=Jt(),z=$(()=>p.statistics),C=B();we(x,_=>{p.initializePolling(A,n,_)},{immediate:!0}),He(()=>{p.stopPolling()});const V=B(!1),K=$(()=>L.value.length>0&&V.value),G=_=>L.value.map(i=>({id:i.id,type:i.type,data:{stage:i,statistics:_.find(c=>c.stageId===i.id)||null},position:{x:i.position.x,y:i.position.y*1.5}})),Y=B(G(z.value));we(()=>z.value,()=>{Y.value=G(z.value)});const oe=$(()=>{const _=new Set(Y.value.map(i=>i.id));return w.value.filter(i=>{const c=_.has(i.sourceStageId),H=_.has(i.targetStageId);return c&&H}).map(i=>({id:i.id,source:i.sourceStageId,target:i.targetStageId,type:"task",data:{id:i.id,props:{taskType:i.taskType}},markerEnd:{type:tt.Arrow,width:24,height:24}}))});function Ae(_){const i=[],c=[],H=["jobs","hooks","forms","scripts"];for(const Z of H){const I=_[Z]||[];for(const T of I){i.push({id:T.id,type:Z,title:T.title,position:{x:T.workflow_position[0],y:T.workflow_position[1]},file:T.file,path:T.path,schedule:T.schedule});for(const F of T.transitions||[])c.push({id:F.id,sourceStageId:T.id,targetStageId:F.target_id,taskType:F.task_type})}}const N=new Set(i.map(Z=>Z.id)),q=c.filter(Z=>N.has(Z.sourceStageId)&&N.has(Z.targetStageId));L.value=i,w.value=q,V.value=!0}const O=B();Fe(async()=>{var _,i,c,H;try{d.value=!0,C.value=await ot.get(n);let N;if(r){const T=(await he.list(n)).find(F=>F.id===r);if(!T){m.value="Build not found";return}N=T}else{const T=(await he.list(n)).find(F=>F.latest);if(!T){m.value="No builds found for this project";return}N=T}const q=await o.get(N.id);if(!q||!q.abstraJson){m.value="No workflow data available for this build";return}const Z=JSON.parse(q.abstraJson);Ae(Z),O.value=at.fromDTO(n,N.id,Z.version,{forms:((_=Z.forms)==null?void 0:_.map(I=>({id:I.id,path:I.path,title:I.title})))||[],hooks:((i=Z.hooks)==null?void 0:i.map(I=>({id:I.id,path:I.path,title:I.title})))||[],jobs:((c=Z.jobs)==null?void 0:c.map(I=>({id:I.id,schedule:I.schedule,title:I.title})))||[],scripts:((H=Z.scripts)==null?void 0:H.map(I=>({id:I.id,title:I.title})))||[]})}catch(N){m.value=N instanceof Error?N.message:"Failed to load workflow",console.error(N)}finally{d.value=!1}});const Q=_=>{var i,c;return(c=(i=p.disabledStages)==null?void 0:i.some(H=>H.id===_))!=null?c:!1},R=_=>{p.toggleStageEnabledState(_)};return(_,i)=>(g(),E("div",Ut,[d.value?(g(),j(e(Ye),{key:0,style:{width:"100%"}})):K.value?(g(),j(e(et),{key:`workflow-${L.value.length}-${w.value.length}`,nodes:Y.value,edges:oe.value,"default-viewport":{zoom:1.5},"fit-view-on-init":"","min-zoom":.1,"max-zoom":1.25,"pan-on-scroll":e(je).isMac,"snap-to-grid":""},{"edge-task":a(c=>[s(Dt,Ge(Oe(c)),null,16)]),"node-forms":a(c=>[s(se,{stage:c.data.stage,statistics:c.data.statistics,project:C.value,"build-spec":O.value,"is-disabled":Q(c.data.stage.id),onToggleStageEnabledState:R},null,8,["stage","statistics","project","build-spec","is-disabled"])]),"node-hooks":a(c=>[s(se,{stage:c.data.stage,statistics:c.data.statistics,project:C.value,"build-spec":O.value,"is-disabled":Q(c.data.stage.id),onToggleStageEnabledState:R},null,8,["stage","statistics","project","build-spec","is-disabled"])]),"node-scripts":a(c=>[s(se,{stage:c.data.stage,statistics:c.data.statistics,project:C.value,"build-spec":O.value,"is-disabled":Q(c.data.stage.id),onToggleStageEnabledState:R},null,8,["stage","statistics","project","build-spec","is-disabled"])]),"node-jobs":a(c=>[s(se,{stage:c.data.stage,statistics:c.data.statistics,project:C.value,"build-spec":O.value,"is-disabled":Q(c.data.stage.id),onToggleStageEnabledState:R},null,8,["stage","statistics","project","build-spec","is-disabled"])]),default:a(()=>[s(e(Ue),{"pattern-color":"#aaa",gap:16})]),_:1},8,["nodes","edges","pan-on-scroll"])):(g(),j(e(ce),{key:1,class:"empty-state-card"},{default:a(()=>[s(e(D),{vertical:"",gap:24,align:"center"},{default:a(()=>[s(e(Et),{size:64,color:pe}),s(e(D),{vertical:"",gap:8,align:"center"},{default:a(()=>[s(e(ne),{level:3},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_getting_started")),1)]),_:1}),s(e(J),{type:"secondary",style:{"text-align":"center"}},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_no_workflow_description")),1)]),_:1})]),_:1}),s(e(D),{gap:16,wrap:"wrap",justify:"center"},{default:a(()=>[s(e(ce),{class:"option-card"},{default:a(()=>[s(e(D),{vertical:"",gap:12},{default:a(()=>[s(e(Le),{size:32,color:pe}),s(e(ne),{level:5},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_option_cli")),1)]),_:1}),s(e(J),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_cli_description")),1)]),_:1}),s(e(D),{vertical:"",gap:8},{default:a(()=>[h("div",Kt,[i[4]||(i[4]=h("code",{class:"install-code"},"pip install abstra",-1)),s(ee,{type:"text",size:"small",onClick:i[0]||(i[0]=c=>M("pip install abstra"))},{default:a(()=>[s(e(_e),{size:16})]),_:1})]),h("div",Qt,[i[5]||(i[5]=h("code",{class:"install-code"},"abstra editor .",-1)),s(ee,{type:"text",size:"small",onClick:i[1]||(i[1]=c=>M("abstra editor ."))},{default:a(()=>[s(e(_e),{size:16})]),_:1})])]),_:1})]),_:1})]),_:1}),s(e(ce),{class:"option-card"},{default:a(()=>[s(e(D),{vertical:"",gap:12},{default:a(()=>[s(e(xe),{size:32,color:pe}),s(e(ne),{level:5},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_option_online")),1)]),_:1}),s(e(J),{type:"secondary",style:{"font-size":"13px"}},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_online_description")),1)]),_:1}),s(ee,{type:"primary",onClick:k},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_open_editor")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(Xe),{href:"https://www.abstra.io/docs",target:"_blank"},{default:a(()=>[P(v(e(S).translate("i18n_workflowviewer_view_docs"))+" ",1),s(e(qe),{size:14,style:{"margin-left":"4px"}})]),_:1})]),_:1})]),_:1})),!d.value&&K.value?(g(),j(ee,{key:3,class:ge(["edit-button",{expanded:f.value}]),type:"primary",size:"large",onClick:k,onMouseenter:i[2]||(i[2]=c=>f.value=!0),onMouseleave:i[3]||(i[3]=c=>f.value=!1)},{default:a(()=>[s(e(Je),{size:24}),f.value?(g(),E("span",Rt,v(e(S).translate("i18n_workflowviewer_edit_online")),1)):W("",!0)]),_:1},8,["class"])):W("",!0)]))}});const Ia=fe(ea,[["__scopeId","data-v-c605f2d3"]]);export{Ia as default};
//# sourceMappingURL=WorkflowViewer.1f3d1964.js.map

import{d as A,H as b,b as u,ev as D,f as s,w as a,u as t,ar as c,aj as me,cB as x,ai as $,e as y,c as _,eH as N,ex as F,eE as Z,eF as ee,v as te,bO as W,b3 as ve,eD as I,bV as J,ae as _e,eC as ye,cE as he,a$ as ae,eM as ge,eA as be,r as G}from"./outputWidgets.74ac2ec4.js";import{F as H}from"./forms.e8f9537b.js";import{H as P,J as B}from"./jobs.0128b9a3.js";import{W as se}from"./workspaces.2898fa49.js";import{S as R}from"./scripts.274c8d77.js";import{a as O}from"./asyncComputed.f88a4b94.js";import{f as ke,a as we,b as Fe,j as Se,e as Te,d as Ce}from"./icons.f62d7c23.js";import{_ as X}from"./DocsButton.vue_vue_type_script_setup_true_lang.30b53c7c.js";import{a as Ie}from"./Base.bd01be9c.js";import{A as U}from"./index.ba7b32c9.js";import{A as E}from"./Paragraph.d67398fc.js";import{v as oe,b as Ae}from"./validations.b55cc691.js";import{A as j}from"./FormItem.bf6c91bc.js";import{A as C}from"./Text.039f7ef4.js";import{A as xe}from"./index.4627b22e.js";import{F as le}from"./Form.9d6d8c17.js";import{M as $e}from"./Modal.fae7bce9.js";import{C as Ne}from"./CrudView.300a16f4.js";import{a as K}from"./ant-design.ba20537e.js";import{c as Ue}from"./string.ae0d3257.js";import{A as Ee}from"./Title.e4bf994e.js";import{A as je}from"./Link.81322bd7.js";import{A as De}from"./index.08be46f9.js";import"./record.a15934e9.js";import"./pubsub.6d093b2e.js";import"./runnerData.ae84c16f.js";import"./url.c37f3fbe.js";import"./hasIn.88fbb4e5.js";import"./router.3342c4c3.js";import"./index.8324d637.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[n]="dd541823-08e7-4a82-98e9-6d735c186691",o._sentryDebugIdIdentifier="sentry-dbid-dd541823-08e7-4a82-98e9-6d735c186691")}catch{}})();const V=o=>(Z("data-v-94df32a7"),o=o(),ee(),o),He={key:0,class:"choose-type"},Pe={class:"option-content"},Be=V(()=>y("span",null,"Forms",-1)),Oe={class:"option-content"},Ve=V(()=>y("span",null,"Hooks",-1)),Le={class:"option-content"},Me=V(()=>y("span",null,"Scripts",-1)),Je={class:"option-content"},ze=V(()=>y("span",null,"Jobs",-1)),Re=A({__name:"ChooseScriptType",props:{state:{}},emits:["choose-type"],setup(o,{emit:n}){const i=o,p=b(()=>i.state.type==="form"?"#fff":void 0),h=b(()=>i.state.type==="hook"?"#fff":void 0),k=b(()=>i.state.type==="script"?"#fff":void 0),m=b(()=>i.state.type==="job"?"#fff":void 0),S=g=>n("choose-type",g);return(g,w)=>g.state.state==="choosing-type"?(u(),D("div",He,[s(t(U),{vertical:"",gap:"30"},{default:a(()=>[s(t(Ie),null,{default:a(()=>[c("Choose your script type")]),_:1}),s(t(me),{value:g.state.type,"onUpdate:value":[w[0]||(w[0]=f=>g.state.type=f),S],size:"large","button-style":"solid"},{default:a(()=>[s(t(U),{gap:"24",vertical:""},{default:a(()=>[s(t(U),{gap:"24"},{default:a(()=>[s(t(x),{placement:"left",title:"Forms"},{content:a(()=>[s(t(E),null,{default:a(()=>[c(" Use to collect user input via interaction with a form interface ")]),_:1}),s(X,{path:"forms/overview"})]),default:a(()=>[s(t($),{value:"form",class:"option"},{default:a(()=>[y("div",Pe,[(u(),_(N,{key:p.value,path:t(ke),fill:p.value},null,8,["path","fill"])),Be])]),_:1})]),_:1}),s(t(x),{placement:"right",title:"Hooks"},{content:a(()=>[s(t(E),null,{default:a(()=>[c("Use to build endpoints triggered by HTTP requests")]),_:1}),s(X,{path:"forms/overview"})]),default:a(()=>[s(t($),{value:"hook",class:"option"},{default:a(()=>[y("div",Oe,[(u(),_(N,{key:h.value,path:t(we),fill:h.value},null,8,["path","fill"])),Ve])]),_:1})]),_:1})]),_:1}),s(t(U),{gap:"24"},{default:a(()=>[s(t(x),{placement:"left",title:"Scripts"},{content:a(()=>[s(t(E),null,{default:a(()=>[c(" Use to write plain Python scripts ")]),_:1})]),default:a(()=>[s(t($),{value:"script",class:"option"},{default:a(()=>[y("div",Le,[(u(),_(N,{key:k.value,path:t(Fe),fill:k.value},null,8,["path","fill"])),Me])]),_:1})]),_:1}),s(t(x),{placement:"right",title:"Jobs"},{content:a(()=>[s(t(E),null,{default:a(()=>[c(" Use to schedule your script execution periodically ")]),_:1})]),default:a(()=>[s(t($),{value:"job",class:"option"},{default:a(()=>[y("div",Je,[(u(),_(N,{key:m.value,path:t(Se),fill:m.value},null,8,["path","fill"])),ze])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})])):F("",!0)}});const Ye=te(Re,[["__scopeId","data-v-94df32a7"]]),qe=y("br",null,null,-1),We=A({__name:"NewScript",props:{state:{}},emits:["update-name","update-file"],setup(o,{emit:n}){const i=o,{result:p}=O(()=>fetch("/_editor/api/workspace/root").then(f=>f.text())),h=b(()=>i.state.state!=="creating"?"":`${p.value}/${i.state.stage.filename}`),k=b(()=>i.state.state!=="creating"?"":`${i.state.stage.type[0].toUpperCase()+i.state.stage.type.slice(1)} title`),m=f=>{n("update-name",f);const e=Ae(f);n("update-file",e),g()},{result:S,refetch:g}=O(()=>se.checkFile(i.state.stage.filename)),w=b(()=>oe(i.state.stage.filename));return(f,e)=>(u(),_(t(le),{layout:"vertical"},{default:a(()=>{var T;return[s(t(j),{label:k.value,required:!0},{default:a(()=>[s(t(W),{value:f.state.stage.title,"onUpdate:value":m},null,8,["value"])]),_:1},8,["label"]),s(t(j),{label:"Generated file",required:!0,"validate-status":w.value.valid?"success":"error",help:w.value.valid?void 0:w.value.reason},{default:a(()=>[s(t(ve),{placement:"right"},{title:a(()=>[c(" You can change this later ")]),default:a(()=>[s(t(W),{value:f.state.stage.filename,"onUpdate:value":e[0]||(e[0]=L=>f.state.stage.filename=L),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["validate-status","help"]),s(t(j),null,{default:a(()=>[s(t(C),null,{default:a(()=>[c(" Your script will be generated at: ")]),_:1}),qe,s(t(C),{code:""},{default:a(()=>[c(I(h.value),1)]),_:1})]),_:1}),(T=t(S))!=null&&T.exists?(u(),_(t(xe),{key:0,type:"warning"},{message:a(()=>[s(t(C),null,{default:a(()=>[s(t(C),{strong:""},{default:a(()=>[c("Warning:")]),_:1}),c(" This file already exists. It will be used by more than one script. ")]),_:1})]),_:1})):F("",!0)]}),_:1}))}}),Ge=A({__name:"CreateModal",props:{open:{type:Boolean},state:{}},emits:["close","choose-type","next-step","previous-step","create-script","update-name","update-file"],setup(o,{emit:n}){const i=o,p=e=>n("update-name",e),h=e=>n("update-file",e),k=()=>n("close"),m=e=>n("choose-type",e),S=()=>n("next-step"),g=()=>n("previous-step"),w=()=>n("create-script"),f=b(()=>!(i.state.state!=="creating"||!oe(i.state.stage.filename).valid||!i.state.stage.title));return(e,T)=>(u(),_(t($e),{open:e.open,title:"Create a new script",onCancel:k},{footer:a(()=>[e.state.state==="creating"?(u(),_(t(J),{key:0,onClick:g},{default:a(()=>[c("Previous")]),_:1})):F("",!0),e.state.state==="creating"?(u(),_(t(J),{key:1,type:"primary",disabled:!f.value,onClick:w},{default:a(()=>[c(" Create ")]),_:1},8,["disabled"])):F("",!0),e.state.state==="choosing-type"?(u(),_(t(J),{key:2,type:"primary",disabled:!e.state.type,onClick:S},{default:a(()=>[c(" Next ")]),_:1},8,["disabled"])):F("",!0)]),default:a(()=>[e.state.state==="choosing-type"?(u(),_(Ye,{key:0,state:e.state,onChooseType:m},null,8,["state"])):F("",!0),e.state.state==="creating"?(u(),_(We,{key:1,state:e.state,onUpdateName:p,onUpdateFile:h},null,8,["state"])):F("",!0)]),_:1},8,["open"]))}}),Xe=A({__name:"FilterScripts",emits:["update-filter"],setup(o,{emit:n}){const i=[{label:"Forms",value:"form"},{label:"Hooks",value:"hook"},{label:"Scripts",value:"script"},{label:"Jobs",value:"job"}],p=h=>n("update-filter",h);return(h,k)=>(u(),_(t(le),null,{default:a(()=>[s(t(j),{label:"Filter"},{default:a(()=>[s(t(_e),{mode:"multiple",style:{width:"360px"},placeholder:"All","onUpdate:value":p},{default:a(()=>[(u(),D(ae,null,ye(i,m=>s(t(he),{key:m.value,value:m.value},{default:a(()=>[c(I(m.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1})]),_:1}))}}),Ke=200,Qe=o=>{if(!o)return[0,0];if(o.length===0)return[0,0];let n=-1/0,i=0;for(const p of o)p.position.x>n&&(n=p.position.x),i+=p.position.y/o.length;return[n+Ke,i]},z=o=>{if(o instanceof H)return"form";if(o instanceof P)return"hook";if(o instanceof B)return"job";if(o instanceof R)return"script";throw new Error("Invalid script type")},Ze=o=>o instanceof H?`/${o.path}`:o instanceof P?`/_hooks/${o.path}`:o instanceof B?`${o.schedule}`:"",et=o=>(Z("data-v-0ac82c9b"),o=o(),ee(),o),tt={key:0},at=et(()=>y("span",null,"loading",-1)),st=[at],ot={class:"ellipsis",style:{"max-width":"280px"}},lt={class:"ellipsis",style:{"max-width":"210px"}},nt={class:"ellipsis",style:{"max-width":"200px"}},Q=100,it=A({__name:"Scripts",setup(o){ge(l=>({"0b655db2":de()}));const n=be(),{loading:i,result:p,refetch:h}=O(async()=>Promise.all([H.list(),P.list(),B.list(),R.list()]).then(([l,r,d,v])=>[...l,...r,...d,...v])),{result:k}=O(()=>se.get()),m=G([]),S=l=>{m.value=l},g=b(()=>p.value?m.value.length===0?p.value:p.value.filter(l=>m.value.includes(z(l))):[]),w=l=>{!k.value||k.value.openFile(l)},f=b(()=>{const l=[{name:"Type",align:"left"},{name:"Title",align:"left"},{name:"File",align:"left"},{name:"Trigger",align:"left"},{name:"",align:"right"}],r=g.value;if(!r)return{columns:l,rows:[]};const d=r.map(v=>{const M=Ue(z(v));return{key:v.id,cells:[{type:"tag",text:M},{type:"slot",key:"title",payload:{script:v}},{type:"slot",key:"file",payload:{script:v}},{type:"slot",key:"trigger",payload:{script:v}},{type:"actions",actions:[{icon:Te,label:"Open .py file",onClick:()=>w(v.file)},{icon:Ce,label:"Delete",onClick:()=>ce(v.id)}]}]}});return{columns:l,rows:d}}),e=G({state:"idle"}),T=b(()=>e.value.state==="choosing-type"||e.value.state==="creating"),L=()=>{e.value={state:"choosing-type",type:null}},Y=()=>{e.value={state:"idle"}},ne=l=>{e.value.state==="choosing-type"&&(e.value={state:"choosing-type",type:l})},ie=()=>{e.value.state==="choosing-type"&&e.value.type!==null&&(e.value={state:"creating",stage:{type:e.value.type,title:`Untitled ${e.value.type}`,filename:`untitled_${e.value.type}.py`}})},re=()=>{e.value.state==="creating"&&(e.value={state:"choosing-type",type:e.value.stage.type})},pe=l=>{e.value.state==="creating"&&(e.value.stage.title=l)},ue=l=>{e.value.state==="creating"&&(e.value.stage.filename=l)},ce=async l=>{var r,d;if(await K("Are you sure you want to delete this script?")){const v=await K("Do you want to delete the .py file associated with this script?",{okText:"Yes",cancelText:"No"});await((d=(r=p.value)==null?void 0:r.find(M=>M.id===l))==null?void 0:d.delete(v)),await h()}},de=()=>(Q/1e3).toString()+"s",fe=async()=>{if(e.value.state!=="creating")return;const l=Qe(p.value||[]);let r;if(e.value.stage.type==="form"?r=await H.create(e.value.stage.title,e.value.stage.filename,l):e.value.stage.type==="hook"?r=await P.create(e.value.stage.title,e.value.stage.filename,l):e.value.stage.type==="job"?r=await B.create(e.value.stage.title,e.value.stage.filename,l):e.value.stage.type==="script"&&(r=await R.create(e.value.stage.title,e.value.stage.filename,l)),!r)throw new Error("Failed to create script");const d=r.id,v=e.value.stage.type;Y(),await h(),setTimeout(()=>{q(d,v)},Q)},q=(l,r)=>{r==="form"&&n.push({name:"formEditor",params:{id:l}}),r==="hook"&&n.push({name:"hookEditor",params:{id:l}}),r==="script"&&n.push({name:"scriptEditor",params:{id:l}}),r==="job"&&n.push({name:"jobEditor",params:{id:l}})};return(l,r)=>(u(),D(ae,null,[t(i)?(u(),D("span",tt,st)):F("",!0),s(t(Ee),null,{default:a(()=>[c("Home")]),_:1}),s(Xe,{onUpdateFilter:S}),s(Ne,{"empty-title":"There are no scripts","entity-name":"scripts",description:"",table:f.value,loading:t(i),title:"","create-button-text":"Create new",onCreate:L},{title:a(({payload:d})=>[y("div",ot,[s(t(je),{onClick:v=>q(d.script.id,t(z)(d.script))},{default:a(()=>[c(I(d.script.title),1)]),_:2},1032,["onClick"])])]),file:a(({payload:d})=>[y("div",lt,[s(t(C),null,{default:a(()=>[c(I(d.script.file),1)]),_:2},1024)])]),trigger:a(({payload:d})=>[s(t(De),{color:"default"},{default:a(()=>[y("div",nt,I(t(Ze)(d.script)),1)]),_:2},1024)]),_:1},8,["table","loading"]),s(Ge,{open:T.value,state:e.value,onClose:Y,onChooseType:ne,onNextStep:ie,onPreviousStep:re,onCreateScript:fe,onUpdateName:pe,onUpdateFile:ue},null,8,["open","state"])],64))}});const Bt=te(it,[["__scopeId","data-v-0ac82c9b"]]);export{Bt as default};
//# sourceMappingURL=Scripts.f496bb88.js.map

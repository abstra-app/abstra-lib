import{R as le,F as ne,r as X}from"./FormRunner.078fc3b9.js";import{f as a,eG as se,d as O,r as P,G as S,b as g,c as h,w as r,aq as m,eD as B,u as e,bO as D,cy as Z,F as ue,H as ee,eA as te,ex as L,ev as G,eC as ie,cC as de,bH as w,bq as pe,bg as ce,e as me,bI as H,eB as fe,eJ as ve}from"./outputWidgets.e04018d6.js";import{R as ge,S as ye,L as he}from"./RuntimeCommonSettings.bcb3249b.js";import{B as be}from"./BaseLayout.124c7b4d.js";import{a as ae}from"./asyncComputed.23285845.js";import{F as we}from"./forms.c29a1aa9.js";import{W as re}from"./workspaces.5bf76ed0.js";import{l as W,N as _e}from"./NavbarControls.2b483bdf.js";import"./index.8fb459f6.js";import{C as ke,A as Se}from"./CollapsePanel.0ebcc574.js";import{A as Y}from"./index.141031bd.js";import{A as F}from"./index.841b47e6.js";import{A as v}from"./FormItem.e4984bde.js";import{A as xe}from"./index.a993d626.js";import{A as Pe}from"./index.30977851.js";import{F as oe}from"./Form.ef695b37.js";import{A as C}from"./Title.873659e3.js";import{A as J,T as Ae}from"./TabPane.d6c55a1f.js";import"./index.6beb5dcf.js";import{E as Re}from"./ExpandOutlined.b9917d05.js";import{c as Le}from"./index.281066d5.js";import"./url.39460579.js";import"./index.61bd0a1f.js";import"./pubsub.273e94b2.js";import"./icons.1319a4cf.js";import"./CircularLoading.8a51a92e.js";import"./PlayerNavbar.921890db.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.99ddee1b.js";import"./WidgetsFrame.1046558c.js";import"./uuid.f87595fd.js";import"./scripts.10134673.js";import"./record.3dcaee8d.js";import"./index.30fa266a.js";import"./popupNotifcation.664d33f0.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.989c8b10.js";import"./SaveButton.vue_vue_type_script_setup_true_lang.40cd6eef.js";import"./ant-design.b6e6d5e6.js";import"./index.88b45e8b.js";import"./Modal.0805ccf5.js";import"./Text.cb37dd29.js";import"./index.a095762a.js";import"./Link.43d08e55.js";import"./hasIn.ca61761c.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new Error().stack;u&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[u]="607481b2-9097-4b6f-a050-1af59515e72d",c._sentryDebugIdIdentifier="sentry-dbid-607481b2-9097-4b6f-a050-1af59515e72d")}catch{}})();var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};const Ce=Te;function K(c){for(var u=1;u<arguments.length;u++){var t=arguments[u]!=null?Object(arguments[u]):{},p=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),p.forEach(function(o){Ue(c,o,t[o])})}return c}function Ue(c,u,t){return u in c?Object.defineProperty(c,u,{value:t,enumerable:!0,configurable:!0,writable:!0}):c[u]=t,c}var I=function(u,t){var p=K({},u,t.attrs);return a(se,K({},p,{icon:Ce}),null)};I.displayName="LinkOutlined";I.inheritAttrs=!1;const Be=I,De=O({__name:"LaunchButton",props:{path:{}},setup(c){const u=c,t=P({state:"loading"}),p=S(()=>t.value.state!=="found"),o=S(()=>t.value.state==="loading"),n=S(()=>t.value.state==="found"?t.value.url:void 0),l=S(()=>{switch(t.value.state){case"error":return"Error";case"loading":return"Loading";case"not-deployed":return"No deploy";case"not-logged":return"Not logged";case"not-found":return"Page not found";case"found":return"Launch";default:throw new Error(`Invalid state ${t.value}`)}}),T=S(()=>{switch(t.value.state){case"error":return"Something went wrong when trying to get your deployed URL.";case"loading":return"Getting deployed url info...";case"not-deployed":return"You have no deployed url yet.";case"not-logged":return"You are not logged.";case"not-found":return"This page is not on the deployed application.";case"found":return"Launch the deployed version of this application in another tab.";default:throw new Error(`Invalid state ${t.value}`)}});async function k(f){const i=`https://${f}.abstra.app/_version`;return(await fetch(i)).ok}async function A(f){const i=`https://${f}.abstra.app/_pages/${u.path}`;return(await fetch(i)).ok}async function R(){if(!(await W.get()).logged){t.value={state:"not-logged"};return}const i=await W.getProjectInfo().catch(()=>null);if(!i){t.value={state:"error"};return}if(!await k(i.subdomain).catch(()=>null)){t.value={state:"not-deployed"};return}if(!await A(i.subdomain).catch(()=>null)){t.value={state:"not-found"};return}const q=`https://${i.subdomain}.abstra.app/${u.path}`;t.value={state:"found",url:q}}return R(),(f,i)=>(g(),h(e(Z),{title:l.value},{content:r(()=>[m(B(T.value),1)]),default:r(()=>[a(e(D),{href:n.value,target:"_blank",disabled:p.value,loading:o.value,size:"small",type:"link"},{icon:r(()=>[a(e(Be))]),default:r(()=>[m(" Open Deployed ")]),_:1},8,["href","disabled","loading"])]),_:1},8,["title"]))}}),Oe=me("p",{style:{width:"200px"}}," Add query params to simulate someone using your forms with specific data in the URL. ",-1),qe={key:2,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},U="abstra-run-id",$e=O({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(c,{expose:u,emit:t}){var Q,j,V,z;const p=c,o=P(void 0);function n(){o.value=o.value?void 0:"query-params"}const l=ue({queryParams:[],url:`${p.form.path}`,stageRunId:null}),T=s=>{l.stageRunId=s},{result:k,loading:A}=ae(()=>re.get()),R=()=>{l.queryParams.push({name:"",value:""})},f=s=>{l.queryParams=l.queryParams.filter((_,d)=>d!==s)};ee([()=>l.stageRunId,()=>l.queryParams],([s,_])=>{const d=_.find(y=>y.name===U);if(s&&!d){l.queryParams.push({name:U,value:s});return}if(!s&&d){l.queryParams=l.queryParams.filter(y=>y.name!==U);return}s&&d&&s!==d.value&&(d.value=s)});const i=S(()=>le.create(p.form.id));(Q=i.value)==null||Q.on("stdout",s=>{p.logService.log({type:"stdout",log:s.log})}),(j=i.value)==null||j.on("stderr",s=>{p.logService.log({type:"stderr",log:s.log})}),(V=i.value)==null||V.onClose(()=>{p.logService.log({type:"stderr",log:"Program closed"})}),(z=i.value)==null||z.on("files:changed",()=>{p.logService.log({type:"files-changed",log:"Files changed"})});const b=te(),E=({path:s})=>{X("editor",b,s)};function q(s,_){t("redirect",s,_)}const M=P(null);async function N(){var s;return p.logService.log({type:"restart"}),(s=M.value)==null?void 0:s.run()}const $=S(()=>{const s=new URLSearchParams(l.queryParams.filter(d=>d.name.trim()).reduce((d,y)=>({...d,[y.name]:y.value}),{})).toString();return{subdomain:"[your-subdomain]",path:p.form.path,query:s}});return u({restart:N}),(s,_)=>(g(),h(e(oe),{layout:"vertical"},{default:r(()=>[L("",!0),a(e(v),{label:"Testing URL"},{default:r(()=>[a(e(Y),{gap:0,style:{overflow:"hidden"}},{default:r(()=>[m(" https:// "),a(e(F),{style:{"margin-right":"0"}},{default:r(()=>[m(B($.value.subdomain),1)]),_:1}),m(" .abstra.app/ "),a(e(F),{style:{"margin-right":"0","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis"}},{default:r(()=>[m(B($.value.path),1)]),_:1}),a(e(Y),null,{default:r(()=>[m(" ? "),a(e(Z),{title:"Query params"},{content:r(()=>[Oe]),default:r(()=>[a(e(F),{style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer"},onClick:n},{default:r(()=>[m(B($.value.query||"[ ... ]"),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(e(v),null,{default:r(()=>[a(e(ke),{"active-key":o.value,"onUpdate:activeKey":_[1]||(_[1]=d=>o.value=d),ghost:""},{default:r(()=>[a(e(Se),{key:"query-params",header:`Query Params (${l.queryParams.length})`},{default:r(()=>[(g(!0),G(pe,null,ie(l.queryParams,(d,y)=>(g(),h(e(v),{key:y},{default:r(()=>[a(e(de),null,{default:r(()=>[a(e(w),{value:d.name,"onUpdate:value":x=>d.name=x,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),a(e(w),{value:d.value,"onUpdate:value":x=>d.value=x,type:"text",placeholder:"value",disabled:d.name===U},null,8,["value","onUpdate:value","disabled"]),a(e(D),{danger:"",onClick:x=>f(y)},{default:r(()=>[m("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(e(v),null,{default:r(()=>[a(e(D),{type:"dashed",style:{width:"100%"},onClick:R},{default:r(()=>[m("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1},8,["active-key"])]),_:1})]),_:1}),a(e(xe),{orientation:"left"},{default:r(()=>[m("Quick Preview")]),_:1}),e(A)||!e(k)?(g(),h(e(ce),{key:1})):l.stageRunId||p.form.isInitial?(g(),G("div",qe,[a(ne,{ref_key:"runner",ref:M,form:s.form.makeRunnerData(e(k)),params:{...l.queryParams.reduce((d,{name:y,value:x})=>({...d,[y]:x}),{})},"is-preview":"","enable-auto-focus":"",broker:i.value,onNavigate:E,onRedirect:q,onLogout:N},null,8,["form","params","broker"])])):(g(),h(e(Pe),{key:3,message:"This form is an intermediate task within the workflow. Please select a thread to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}}),Fe=O({__name:"FormSettings",props:{form:{}},setup(c){const t=P(c.form);return(p,o)=>(g(),h(e(oe),{layout:"vertical"},{default:r(()=>[a(ge,{runtime:t.value},null,8,["runtime"]),a(e(v),{label:"Form name"},{default:r(()=>[a(e(w),{value:t.value.title,"onUpdate:value":o[0]||(o[0]=n=>t.value.title=n),type:"text",onChange:o[1]||(o[1]=n=>{var l;return t.value.title=(l=n.target.value)!=null?l:""})},null,8,["value"])]),_:1}),a(e(C),{level:3},{default:r(()=>[m(" Texts ")]),_:1}),a(e(C),{level:4},{default:r(()=>[m(" Welcome Screen ")]),_:1}),a(e(v),{label:"Title"},{default:r(()=>[a(e(w),{value:t.value.welcomeTitle,"onUpdate:value":o[2]||(o[2]=n=>t.value.welcomeTitle=n),type:"text",placeholder:t.value.title,disabled:t.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),a(e(v),{label:"Description"},{default:r(()=>[a(e(w),{value:t.value.startMessage,"onUpdate:value":o[3]||(o[3]=n=>t.value.startMessage=n),type:"text",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(v),{label:"Start button label"},{default:r(()=>[a(e(w),{value:t.value.startButtonText,"onUpdate:value":o[4]||(o[4]=n=>t.value.startButtonText=n),type:"text",placeholder:"Start",disabled:t.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(v),null,{default:r(()=>[a(e(H),{checked:t.value.autoStart,"onUpdate:checked":o[5]||(o[5]=n=>t.value.autoStart=n)},{default:r(()=>[m("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),a(e(C),{level:4},{default:r(()=>[m(" End Screen ")]),_:1}),a(e(v),{label:"End text"},{default:r(()=>[a(e(w),{value:t.value.endMessage,"onUpdate:value":o[6]||(o[6]=n=>t.value.endMessage=n),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),a(e(v),{label:"Restart button label"},{default:r(()=>[a(e(w),{value:t.value.restartButtonText,"onUpdate:value":o[7]||(o[7]=n=>t.value.restartButtonText=n),placeholder:"Restart",type:"text",disabled:!t.value.allowRestart},null,8,["value","disabled"])]),_:1}),a(e(v),null,{default:r(()=>[a(e(H),{checked:t.value.allowRestart,"onUpdate:checked":o[8]||(o[8]=n=>t.value.allowRestart=n)},{default:r(()=>[m("Show restart button at the end")]),_:1},8,["checked"])]),_:1}),a(e(C),{level:4},{default:r(()=>[m(" Alert Messages ")]),_:1}),a(e(v),{label:"Error message"},{default:r(()=>[a(e(w),{value:t.value.errorMessage,"onUpdate:value":o[9]||(o[9]=n=>t.value.errorMessage=n),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}}),Rt=O({__name:"FormEditor",setup(c){const u=te(),t=fe(),p=P(null),o=P("test");function n(){u.push({name:"home"})}const{result:l,refetch:T}=ae(()=>Promise.all([re.get(),we.get(t.params.id)]).then(([f,i])=>ve({workspace:f,form:i}))),k=he.create();function A(f,i){X("editor",u,f,i)}const R=()=>{var f;u.push({name:"formPreview",query:t.query,params:{id:(f=l.value)==null?void 0:f.form.id}})};return ee(()=>t.params.id,()=>{T()}),(f,i)=>(g(),h(be,null,{navbar:r(()=>[e(l)?(g(),h(e(Le),{key:0,title:e(l).form.title,style:{padding:"5px 25px"},onBack:n},{footer:r(()=>[a(e(Ae),{"active-key":o.value,"onUpdate:activeKey":i[0]||(i[0]=b=>o.value=b)},{default:r(()=>[a(e(J),{key:"test",tab:"Test"}),a(e(J),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:r(()=>[a(_e,{"docs-path":"forms/overview","show-v-s-code-button":"","show-save-button":o.value==="settings","editing-model":e(l).form},{default:r(()=>[a(De,{path:e(l).form.path},null,8,["path"]),a(e(D),{target:"_blank",onClick:R},{icon:r(()=>[a(e(Re))]),default:r(()=>[m(" Preview ")]),_:1})]),_:1},8,["show-save-button","editing-model"])]),_:1},8,["title"])):L("",!0)]),content:r(()=>[e(l)&&o.value==="test"?(g(),h($e,{key:0,ref_key:"tester",ref:p,form:e(l).form,"log-service":e(k),onRedirect:A},null,8,["form","log-service"])):L("",!0),e(l)&&o.value==="settings"?(g(),h(Fe,{key:1,form:e(l).form},null,8,["form"])):L("",!0)]),footer:r(()=>{var b;return[e(l)&&o.value==="test"?(g(),h(ye,{key:0,runtime:"forms","log-service":e(k),onRestart:(b=p.value)==null?void 0:b.restart},null,8,["log-service","onRestart"])):L("",!0)]}),_:1}))}});export{Rt as default};
//# sourceMappingURL=FormEditor.a2b49f66.js.map

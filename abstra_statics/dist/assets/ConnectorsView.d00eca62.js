var U=Object.defineProperty;var V=(c,e,o)=>e in c?U(c,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[e]=o;var g=(c,e,o)=>(V(c,typeof e!="symbol"?e+"":e,o),o);import{_ as L}from"./DocsButton.vue_vue_type_script_setup_true_lang.de8b1d83.js";import{_ as M}from"./AbstraButton.vue_vue_type_script_setup_true_lang.3cdfd6dd.js";import{f as F,g as x,cE as I,d as q,e4 as B,K as m,b as i,w as a,u as t,aL as v,o as r,da as f,d6 as k,az as d,d4 as S,c as h,ea as $,d5 as w,eb as j,bK as G,bs as O,bq as T,F as b,a as D,bE as P,cQ as z,eg as R,eG as K,eH as Q,Q as H}from"./index.cb4b8516.js";import{G as Y}from"./PhDotsThreeVertical.vue.b8ad476a.js";import{C as y}from"./gateway.450be966.js";import{C as J}from"./router.9423905d.js";import{C as W}from"./ConnectorCard.4671afa9.js";import{C as X}from"./Card.a1082b2a.js";import{A as Z}from"./Avatar.d62c710b.js";import{A as ee}from"./index.2fda36cd.js";import"./popupNotifcation.e1b0a50d.js";import"./Badge.473ae333.js";import"./TabPane.410d1cc2.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[e]="15b3e5de-a0a0-4478-9fb2-266cd9fc7e34",c._sentryDebugIdIdentifier="sentry-dbid-15b3e5de-a0a0-4478-9fb2-266cd9fc7e34")}catch{}})();class te{async getLoginUrl(e,o,n,u){return y.get(`projects/${e}/connectors/${n}/connections/${o}/login-url`,{scopeIds:u.join(",")})}async listConnectors(e){return y.get(`projects/${e}/connectors`)}async listConnections(e){return y.get(`projects/${e}/connections`)}async deleteConnection(e){const{projectId:o,connectionName:n,connectorType:u}=e;return y.delete(`projects/${o}/connectors/${u}/connections/${n}`)}async renameConnection(e){const{projectId:o,connectionName:n,connectorType:u,newConnectionName:C}=e;return y.patch(`projects/${o}/connectors/${u}/connections/${n}`,{newConnectionName:C})}}class ne{constructor(e,o){g(this,"state");g(this,"hasChanges",x(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));g(this,"handleDeletionClick",async e=>{I.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(e)})});g(this,"handleDeleteConnection",async e=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});g(this,"handleAddConnectionSubmit",async()=>{var u,C;const e=(u=this.state.value.addingConnection)==null?void 0:u.connector.type,o=(C=this.state.value.addingConnection)==null?void 0:C.selectedScopeIds;if(!e||!o)throw new Error("No connector or scope selected");const{url:n}=await this.getLoginUrl(e,this.getUniqueName(e),o);window.location.href=n});g(this,"renameConnection",async()=>{const{editingConnection:e}=this.state.value;if(!e)throw new Error("No connection is being edited");const o=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType,newConnectionName:e.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};I.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:o})});g(this,"showAddConfirmationModal",e=>{this.state.value.addingConnection={selectedScopeIds:e.scopes.map(o=>o.id),connector:e}});g(this,"handleScopeToggle",(e,o)=>{o?this.state.value.addingConnection.selectedScopeIds.push(e):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(n=>n!==e)});this.projectId=e,this.api=o,this.state=F({connectors:[],connections:[],addingConnection:null,editingConnection:null})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchInitialState(){await this.fetchConnectors(),await this.refetchConnections()}async refetchConnections(){this.state.value.connections=(await this.api.listConnections(this.projectId)).map(e=>{const o=this.state.value.connectors.find(n=>n.type===e.connectorType);if(!o)throw new Error(`Unknown connector type: ${e.connectorType}`);return{name:e.name,connectorTitle:o.title,connectorType:e.connectorType,icon:o.logoUrl}})}handleEditConnectionClick(e){this.state.value.editingConnection={...e,newName:e.name}}async getLoginUrl(e,o,n){return this.api.getLoginUrl(this.projectId,o,e,n)}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(e){const o=this.state.value.connections.filter(n=>n.connectorType===e).length;return o===0?e:`${e}-${o}`}}const oe=c=>(K("data-v-9c6bb68a"),c=c(),Q(),c),ae=oe(()=>D("div",{style:{"flex-grow":"1"}},null,-1)),ie={class:"connectors-grid"},se=q({__name:"ConnectorsView",setup(c){const o=B().params.projectId,n=new ne(o,new te);function u(l){return o==="3d186c5d-7d13-4d4c-a17a-b7d59bc431ae"&&["google","gmail"].some(p=>l.type.includes(p))}const C=x(()=>[...n.state.value.connectors.filter(l=>!l.unavailable),...n.state.value.connectors.filter(l=>l.unavailable).map(l=>({...l,unavailable:!u(l)}))]);n.fetchInitialState();function E(l){l.unavailable?J.showNewMessage(R.translate("i18n_connectors_ask_for_access",null,l.title)):n.showAddConfirmationModal(l)}return(l,p)=>{var A,N;return r(),m(v,null,[i(t(ee),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:a(()=>[i(t(f),{align:"center",justify:"space-between"},{default:a(()=>[i(t(k),null,{default:a(()=>[d("Connectors")]),_:1})]),_:1}),i(t(S),null,{default:a(()=>[d(" Add and manage external integrations to your project. "),i(L)]),_:1}),t(n).state.value.connections.length?(r(),h(t(f),{key:0,vertical:""},{default:a(()=>[i(t(k),{level:2},{default:a(()=>[d("Installed")]),_:1}),i(t(f),{vertical:"",gap:10},{default:a(()=>[(r(!0),m(v,null,$(t(n).state.value.connections,s=>(r(),h(t(X),{key:s.name},{default:a(()=>[i(t(f),{align:"center",gap:20},{default:a(()=>[i(t(Z),{src:s.icon,height:"40px",shape:"square"},null,8,["src"]),i(t(w),{strong:""},{default:a(()=>[d(j(s.connectorTitle),1)]),_:2},1024),ae,i(t(w),{content:s.name,copyable:"",code:""},null,8,["content"]),i(t(G),null,{overlay:a(()=>[i(t(O),null,{default:a(()=>[i(t(T),{onClick:_=>t(n).handleEditConnectionClick(s)},{default:a(()=>[d(" Rename ")]),_:2},1032,["onClick"]),i(t(T),{danger:"",onClick:_=>t(n).handleDeletionClick(s)},{default:a(()=>[d(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[i(t(Y))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):b("",!0),i(t(f),{vertical:""},{default:a(()=>[t(n).state.value.connections.length?(r(),h(t(k),{key:0,level:2},{default:a(()=>[d("Available")]),_:1})):b("",!0),D("div",ie,[(r(!0),m(v,null,$(C.value,s=>(r(),h(W,{key:s.type,title:s.title,"logo-url":s.logoUrl,description:s.description,unavailable:s.unavailable,onClick:_=>E(s)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})]),_:1}),i(t(I),{open:!!t(n).state.value.editingConnection,title:`${(A=t(n).state.value.editingConnection)==null?void 0:A.connectorTitle} Connection`,onCancel:p[2]||(p[2]=s=>t(n).state.value.editingConnection=null)},{footer:a(()=>[i(t(f),{justify:"end"},{default:a(()=>[i(M,{disabled:!t(n).hasChanges.value,onClick:p[1]||(p[1]=s=>t(n).renameConnection())},{default:a(()=>[d(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[t(n).state.value.editingConnection?(r(),h(t(P),{key:0,value:t(n).state.value.editingConnection.newName,"onUpdate:value":p[0]||(p[0]=s=>t(n).state.value.editingConnection.newName=s)},null,8,["value"])):b("",!0)]),_:1},8,["open","title"]),i(t(I),{open:!!t(n).state.value.addingConnection,title:`Add ${(N=t(n).state.value.addingConnection)==null?void 0:N.connector.title} Connection`,"ok-text":"Authorize","wrap-class-name":"full-modal",onCancel:p[3]||(p[3]=s=>t(n).state.value.addingConnection=null),onOk:t(n).handleAddConnectionSubmit},{default:a(()=>[t(n).state.value.addingConnection?(r(),m(v,{key:0},[i(t(S),null,{default:a(()=>[d(" Please select the scopes you want to authorize for this connection. You can change these later by deleting and re-adding the connection. ")]),_:1}),i(t(f),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:a(()=>[(r(!0),m(v,null,$(t(n).state.value.addingConnection.connector.scopes,s=>(r(),h(t(f),{key:s.id,justify:"space-between",align:"center"},{default:a(()=>[i(t(f),{vertical:""},{default:a(()=>[i(t(w),null,{default:a(()=>[d(j(s.description),1)]),_:2},1024),i(t(w),{type:"secondary"},{default:a(()=>[d(j(s.id),1)]),_:2},1024)]),_:2},1024),i(t(z),{checked:t(n).state.value.addingConnection.selectedScopeIds.includes(s.id),onChange:_=>t(n).handleScopeToggle(s.id,_)},null,8,["checked","onChange"])]),_:2},1024))),128))]),_:1})],64)):b("",!0)]),_:1},8,["open","title","onOk"])],64)}}});const we=H(se,[["__scopeId","data-v-9c6bb68a"]]);export{we as default};
//# sourceMappingURL=ConnectorsView.d00eca62.js.map

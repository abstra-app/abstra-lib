var M=Object.defineProperty;var B=(s,a,n)=>a in s?M(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n;var T=(s,a,n)=>(B(s,typeof a!="symbol"?a+"":a,n),n);import{S as L}from"./SourceCode.742b8cf5.js";import{_ as V}from"./AbstraLogo.vue_vue_type_script_setup_true_lang.8e4ef536.js";import{C as W}from"./ContentLayout.9a1f0653.js";import{i as U,F as H,I as J,_ as O}from"./FilesNavigator.030003a8.js";import{S as Q}from"./SaveButton.71ebcb35.js";import{G as K,I as X}from"./PhFilePy.vue.95124f57.js";import{G as Y}from"./PhFolder.vue.ff98c93c.js";import{H as Z,F as ee}from"./PhPackage.vue.f3aede11.js";import{f as k,g as A,d as te,e3 as re,c as o,w,u as r,o as i,a as N,b as C,az as ae,d6 as se,F as D,da as ne,eI as oe,cy as ie,Q as ce}from"./index.0aa22eb1.js";import{F as le,G as ue,a as pe,I as de}from"./PhWebhooksLogo.vue.8a33b13c.js";import{F as me,C as he}from"./filesController.a6777bbb.js";import"./linters.1e5b4714.js";import{W as fe}from"./workspaces.6777754f.js";import"./omniChatStore.4fa66805.js";import"./record.f313467e.js";import"./asyncComputed.aa8ef1b1.js";import"./polling.42fbca45.js";import"./validations.69585abd.js";import"./string.4db7b5b7.js";import"./toggleHighContrast.8463f1ff.js";import"./index.e9e53410.js";import"./Card.ea63bd5c.js";import"./TabPane.e054bca9.js";import"./Logo.32f72cd3.js";import"./popupNotifcation.f330a36a.js";import"./ant-design.77b8866f.js";import"./PhDotsThree.vue.72371f43.js";import"./UnsavedChangesHandler.3d3d310a.js";import"./ExclamationCircleOutlined.e5eab889.js";import"./runnerData.c985992f.js";import"./url.1b0df002.js";import"./colorHelpers.c0ab2983.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="acdc04ab-dae6-49b7-8296-68ec9a9c1a79",s._sentryDebugIdIdentifier="sentry-dbid-acdc04ab-dae6-49b7-8296-68ec9a9c1a79")}catch{}})();const ge=s=>{switch(s){case"abap":return"abap";case"apex":return"apex";case"azcli":return"azcli";case"bat":return"bat";case"bicep":return"bicep";case"c":return"c";case"cameligo":return"cameligo";case"clojure":return"clojure";case"coffeescript":return"coffeescript";case"cpp":return"cpp";case"csharp":return"csharp";case"csp":return"csp";case"css":return"css";case"cypher":return"cypher";case"dart":return"dart";case"dockerfile":return"dockerfile";case"ecl":return"ecl";case"elixir":return"elixir";case"flow9":return"flow9";case"freemarker2":return"freemarker2";case"freemarker2.tag-angle.interpolation-bracket":return"freemarker2.tag-angle.interpolation-bracket";case"freemarker2.tag-angle.interpolation-dollar":return"freemarker2.tag-angle.interpolation-dollar";case"freemarker2.tag-auto.interpolation-bracket":return"freemarker2.tag-auto.interpolation-bracket";case"freemarker2.tag-auto.interpolation-dollar":return"freemarker2.tag-auto.interpolation-dollar";case"freemarker2.tag-bracket.interpolation-bracket":return"freemarker2.tag-bracket.interpolation-bracket";case"freemarker2.tag-bracket.interpolation-dollar":return"freemarker2.tag-bracket.interpolation-dollar";case"fsharp":return"fsharp";case"go":return"go";case"graphql":return"graphql";case"handlebars":return"handlebars";case"hcl":return"hcl";case"html":return"html";case"ini":return"ini";case"java":return"java";case"javascript":return"javascript";case"json":return"json";case"julia":return"julia";case"kotlin":return"kotlin";case"less":return"less";case"lexon":return"lexon";case"liquid":return"liquid";case"lua":return"lua";case"m3":return"m3";case"markdown":return"markdown";case"mdx":return"mdx";case"mips":return"mips";case"msdax":return"msdax";case"mysql":return"mysql";case"objective-c":return"objective-c";case"pascal":return"pascal";case"pascaligo":return"pascaligo";case"perl":return"perl";case"pgsql":return"pgsql";case"php":return"php";case"pla":return"pla";case"plaintext":return"plaintext";case"postiats":return"postiats";case"powerquery":return"powerquery";case"powershell":return"powershell";case"proto":return"proto";case"pug":return"pug";case"python":return"python";case"qsharp":return"qsharp";case"r":return"r";case"razor":return"razor";case"redis":return"redis";case"redshift":return"redshift";case"restructuredtext":return"restructuredtext";case"ruby":return"ruby";case"rust":return"rust";case"sb":return"sb";case"scala":return"scala";case"scheme":return"scheme";case"scss":return"scss";case"shell":return"shell";case"sol":return"sol";case"sparql":return"sparql";case"sql":return"sql";case"st":return"st";case"swift":return"swift";case"systemverilog":return"systemverilog";case"tcl":return"tcl";case"twig":return"twig";case"typescript":return"typescript";case"typespec":return"typespec";case"vb":return"vb";case"verilog":return"verilog";case"xml":return"xml";case"yaml":return"yaml";default:return"plaintext"}};class ye{constructor(a,n,d,p){T(this,"initialContent");this.fileNode=a,this.content=n,this.sep=d,this.onSave=p,this.initialContent=new Uint8Array(n)}get file(){return this.fileNode.pathParts.join(this.sep)}get codeContent(){return this.text}set codeContent(a){this.text=a}updateInitialState(a,n){this.initialContent=new TextEncoder().encode(n)}get text(){return new TextDecoder().decode(this.content)}set text(a){const n=new TextEncoder;this.content=n.encode(a)}get url(){return`/_editor/api/codebase/files/${this.file}`}hasChanges(){return this.content.length!==this.initialContent.length||!this.content.every((a,n)=>a===this.initialContent[n])}async save(){await this.onSave(this),this.initialContent=new Uint8Array(this.content)}isImage(){return U(this.file)}isText(){return!this.isImage()}}const ke=s=>{const a=k([]),n=k(!1),d=k(null),p=k({separator:"/"}),m=new me(s.api,p.value),h=async()=>{n.value=!0;try{a.value=await s.api.list()}finally{n.value=!1}},F=async()=>{p.value=await s.api.settings()},f=s.router.currentRoute.value.query.f,q=async(e,u)=>{await m.uploadFile(e,u),await h()},P=async e=>{await m.deleteFile(e),await h()},I=async(e,u)=>{await m.renameFile(e,u),await h()},b=async(e,u)=>{await m.editFile(e,u)},E=async e=>await m.getFile(e),v=async e=>{await m.mkdir(e),await h()},$=e=>{switch(e.type){case"form":return{name:"formEditor",params:{id:e.id}};case"hook":return{name:"hookEditor",params:{id:e.id}};case"job":return{name:"jobEditor",params:{id:e.id}};case"script":return{name:"scriptEditor",params:{id:e.id}};default:throw new Error(`Unknown stage type: ${e.type}`)}},x=async e=>{var j;const u=e.join(p.value.separator),c=a.value.find(y=>y.file.pathParts.join(p.value.separator)===u);if(!c)throw new Error(`File not found: ${u}`);if(c.file.type==="directory")d.value=null;else if(c.file.pathParts.length===1&&c.file.pathParts[0]==="requirements.txt")s.router.push({name:"settingsRequirements"});else if(c.file.pathParts.length===1&&c.file.pathParts[0]===".env")s.router.push({name:"env-vars"});else if(!c.stages||c.stages.length===0)d.value=new ye(c.file,await E(e),(j=p.value.separator)!=null?j:"/",({content:t})=>b(e,t)),new URL(window.location.href).searchParams.set("f",e.join(p.value.separator)),s.router.replace({query:{...s.router.currentRoute.value.query,f:e}});else if(c.stages.length===1){const y=c.stages[0];s.router.push($(y))}},R=A(()=>a.value.map(({file:e})=>e)),S=A(()=>{var u;const e=(u=d.value)==null?void 0:u.file.split(".").pop();return e?ge(e):"plaintext"}),g=A(()=>d.value?d.value:null),_=k(null);return fe.get().then(e=>{_.value=e}),Promise.all([h(),F()]).then(()=>{typeof f=="string"&&x(f.split(p.value.separator))}),{files:R,loading:n,editing:d,language:S,settings:p,mkdir:v,fetchFiles:h,uploadFile:q,deleteFile:P,renameFile:I,editFile:b,open:x,sourceCodeEditable:g,workspaceModel:_,filesListResponse:a}},we={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"stretch","align-items":"stretch"}},be={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ve=te({__name:"Codebase",setup(s){const a=re(),n=t=>t.type==="file"&&t.pathParts[t.pathParts.length-1].endsWith(".py"),d=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]==="abstra.json",p=t=>t.type==="file"&&U(t.pathParts[t.pathParts.length-1]),m=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]==="requirements.txt",h=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]===".env",F=t=>t.type==="file"&&t.pathParts.length===1&&t.pathParts[0]===".gitignore",f=(t,G)=>j.value.some(l=>l.stages.some(z=>z.type===t)&&l.file.pathParts.join("/")===G.pathParts.join("/")),q=t=>f("form",t),P=t=>f("hook",t),I=t=>f("job",t),b=t=>f("script",t),E=new he,{loading:v,uploadFile:$,deleteFile:x,open:R,files:S,editing:g,renameFile:_,sourceCodeEditable:e,mkdir:u,workspaceModel:c,filesListResponse:j,settings:y}=ke({api:E,router:a});return(t,G)=>(i(),o(W,{"full-width":!!r(g)},{default:w(()=>[N("div",we,[N("div",be,[C(r(se),null,{default:w(()=>[ae("Project files")]),_:1}),r(e)?(i(),o(Q,{key:0,model:r(e),disabled:r(v)},null,8,["model","disabled"])):D("",!0)]),C(O,{"inner-class":"scroll-area","outer-style":{flexGrow:1},"inner-style":{display:"flex",justifyContent:"stretch",gap:"20px"}},{default:w(()=>[C(H,{class:"files-nav",files:r(S),loading:r(v),separator:r(y).separator,onCreate:r($),onDelete:r(x),onOpen:r(R),onRename:r(_),onMkdir:r(u)},{icon:w(({file:l})=>[C(r(ne),{style:{height:"100%"},justify:"center",align:"center"},{default:w(()=>[l.type==="directory"?(i(),o(r(Y),{key:0})):q(l)?(i(),o(r(le),{key:1})):P(l)?(i(),o(r(ue),{key:2})):I(l)?(i(),o(r(pe),{key:3})):b(l)?(i(),o(r(de),{key:4})):n(l)?(i(),o(r(K),{key:5})):d(l)?(i(),o(V,{key:6,"hide-text":""})):m(l)?(i(),o(r(Z),{key:7})):h(l)?(i(),o(r(X),{key:8})):p(l)?(i(),o(r(oe),{key:9})):F(l)?(i(),o(r(ee),{key:10})):(i(),o(r(J),{key:11}))]),_:2},1024)]),_:1},8,["files","loading","separator","onCreate","onDelete","onOpen","onRename","onMkdir"]),r(g)&&r(g).isImage()?(i(),o(r(ie),{key:0,class:"editing-content",src:r(g).url},null,8,["src"])):r(e)&&r(c)?(i(),o(L,{key:1,script:r(e),class:"editing-content","hide-header":"",workspace:r(c)},null,8,["script","workspace"])):D("",!0)]),_:1})])]),_:1},8,["full-width"]))}});const tt=ce(ve,[["__scopeId","data-v-d29a6b1b"]]);export{tt as default};
//# sourceMappingURL=Codebase.f77e87ab.js.map

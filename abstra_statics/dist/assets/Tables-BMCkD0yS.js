import{_ as O}from"./AbstraButton.vue_vue_type_script_setup_true_lang-RJDLUN6w.js";import{o as Ne}from"./omniChatStore-Dcx7weVO.js";import{n as Y}from"./string-zrXH3Bxd.js";import{a as ye,i as J,c as P,b as g,e as u,f as Ve,g as ae,h as w,m as $e,bz as Ye,r as Z,ae as i,M as me,j as s,u as e,a8 as ve,w as n,ak as G,S as y,U as _,v as te,b6 as Ze,W as je,p as U,K as ue,aJ as Te,aK as ce,aL as fe,bk as De,bA as Se,b7 as Je,bm as Me,bB as Qe,bC as Ce,bq as ee,ad as Xe,ac as et,P as tt,D as at,Y as lt,a4 as nt,aj as st,bo as Ae}from"./jwt-decode.esm-GozgdRRU.js";import{e as rt,f as ot,C as it,c as dt,d as ut}from"./router-DIAUNhry.js";import{p as pt,T as ct}from"./tables-DtaHIW8q.js";import{T as mt}from"./TableCard-wJuGUg2U.js";import{_ as ft}from"./TablesTabs.vue_vue_type_script_setup_true_lang-C8p73dAv.js";import{u as pe}from"./uuid-AZFy701m.js";import{read as Ie,utils as be}from"./xlsx-sIPcJk3-.js";import{A as yt}from"./index-C4LL7lH1.js";import{u as _t}from"./useTables-B_YYpWvO.js";import"./record-DDFlsieT.js";import"./PhCopySimple.vue-BBF0ozsv.js";import"./ts.worker-D410PRpA.js";import"./PhKey.vue-CKOehH4w.js";import"./PhPencil.vue-CJIX9A_T.js";import"./vue-flow-core-8R3VOMtq.js";import"./index-DVkd2HF1.js";(function(){try{var F=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x=new Error().stack;x&&(F._sentryDebugIds=F._sentryDebugIds||{},F._sentryDebugIds[x]="13c957d4-e342-4a96-9abb-0bcbd00150cf",F._sentryDebugIdIdentifier="sentry-dbid-13c957d4-e342-4a96-9abb-0bcbd00150cf")}catch{}})();const gt=["width","height","fill","transform"],bt={key:0},vt=w("path",{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM183,80H160V57ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm100.49-72.49a12,12,0,0,1-17,17L140,153v31a12,12,0,0,1-24,0V153l-3.51,3.52a12,12,0,0,1-17-17l24-24a12,12,0,0,1,17,0Z"},null,-1),ht=[vt],wt={key:1},kt=w("path",{d:"M208,88H152V32Z",opacity:"0.2"},null,-1),xt=w("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Zm-42.34-77.66a8,8,0,0,1-11.32,11.32L136,139.31V184a8,8,0,0,1-16,0V139.31l-10.34,10.35a8,8,0,0,1-11.32-11.32l24-24a8,8,0,0,1,11.32,0Z"},null,-1),Nt=[kt,xt],Dt={key:2},St=w("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34Zm-56,67.32a8,8,0,0,1-11.32,0L136,139.31V184a8,8,0,0,1-16,0V139.31l-10.34,10.35a8,8,0,0,1-11.32-11.32l24-24a8,8,0,0,1,11.32,0l24,24A8,8,0,0,1,157.66,149.66ZM152,88V44l44,44Z"},null,-1),Mt=[St],Ct={key:3},At=w("path",{d:"M212.24,83.76l-56-56A6,6,0,0,0,152,26H56A14,14,0,0,0,42,40V216a14,14,0,0,0,14,14H200a14,14,0,0,0,14-14V88A6,6,0,0,0,212.24,83.76ZM158,46.48,193.52,82H158ZM200,218H56a2,2,0,0,1-2-2V40a2,2,0,0,1,2-2h90V88a6,6,0,0,0,6,6h50V216A2,2,0,0,1,200,218Zm-43.76-78.24a6,6,0,1,1-8.48,8.48L134,134.49V184a6,6,0,0,1-12,0V134.49l-13.76,13.75a6,6,0,0,1-8.48-8.48l24-24a6,6,0,0,1,8.48,0Z"},null,-1),It=[At],Vt={key:4},$t=w("path",{d:"M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Zm-42.34-77.66a8,8,0,0,1-11.32,11.32L136,139.31V184a8,8,0,0,1-16,0V139.31l-10.34,10.35a8,8,0,0,1-11.32-11.32l24-24a8,8,0,0,1,11.32,0Z"},null,-1),Zt=[$t],jt={key:5},Tt=w("path",{d:"M210.83,85.17l-56-56A4,4,0,0,0,152,28H56A12,12,0,0,0,44,40V216a12,12,0,0,0,12,12H200a12,12,0,0,0,12-12V88A4,4,0,0,0,210.83,85.17ZM156,41.65,198.34,84H156ZM200,220H56a4,4,0,0,1-4-4V40a4,4,0,0,1,4-4h92V88a4,4,0,0,0,4,4h52V216A4,4,0,0,1,200,220Zm-45.17-78.83a4,4,0,0,1-5.66,5.66L132,129.66V184a4,4,0,0,1-8,0V129.66l-17.17,17.17a4,4,0,0,1-5.66-5.66l24-24a4,4,0,0,1,5.66,0Z"},null,-1),Ut=[Tt],Bt={name:"PhFileArrowUp"},Ft=ye({...Bt,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(F){const x=F,Q=J("weight","regular"),j=J("size","1em"),V=J("color","currentColor"),R=J("mirrored",!1),b=P(()=>x.weight??Q),S=P(()=>x.size??j),M=P(()=>x.color??V),v=P(()=>x.mirrored!==void 0?x.mirrored?"scale(-1, 1)":void 0:R?"scale(-1, 1)":void 0);return(C,m)=>(u(),g("svg",$e({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:S.value,height:S.value,fill:M.value,transform:v.value},C.$attrs),[Ve(C.$slots,"default"),b.value==="bold"?(u(),g("g",bt,ht)):b.value==="duotone"?(u(),g("g",wt,Nt)):b.value==="fill"?(u(),g("g",Dt,Mt)):b.value==="light"?(u(),g("g",Ct,It)):b.value==="regular"?(u(),g("g",Vt,Zt)):b.value==="thin"?(u(),g("g",jt,Ut)):ae("",!0)],16,gt))}}),zt=["width","height","fill","transform"],Ht={key:0},Pt=w("path",{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},null,-1),Et=[Pt],Lt={key:1},Ot=w("path",{d:"M192,112a80,80,0,1,1-80-80A80,80,0,0,1,192,112Z",opacity:"0.2"},null,-1),Rt=w("path",{d:"M229.66,218.34,179.6,168.28a88.21,88.21,0,1,0-11.32,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"},null,-1),Wt=[Ot,Rt],Kt={key:2},qt=w("path",{d:"M168,112a56,56,0,1,1-56-56A56,56,0,0,1,168,112Zm61.66,117.66a8,8,0,0,1-11.32,0l-50.06-50.07a88,88,0,1,1,11.32-11.31l50.06,50.06A8,8,0,0,1,229.66,229.66ZM112,184a72,72,0,1,0-72-72A72.08,72.08,0,0,0,112,184Z"},null,-1),Gt=[qt],Yt={key:3},Jt=w("path",{d:"M228.24,219.76l-51.38-51.38a86.15,86.15,0,1,0-8.48,8.48l51.38,51.38a6,6,0,0,0,8.48-8.48ZM38,112a74,74,0,1,1,74,74A74.09,74.09,0,0,1,38,112Z"},null,-1),Qt=[Jt],Xt={key:4},ea=w("path",{d:"M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"},null,-1),ta=[ea],aa={key:5},la=w("path",{d:"M226.83,221.17l-52.7-52.7a84.1,84.1,0,1,0-5.66,5.66l52.7,52.7a4,4,0,0,0,5.66-5.66ZM36,112a76,76,0,1,1,76,76A76.08,76.08,0,0,1,36,112Z"},null,-1),na=[la],sa={name:"PhMagnifyingGlass"},ra=ye({...sa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(F){const x=F,Q=J("weight","regular"),j=J("size","1em"),V=J("color","currentColor"),R=J("mirrored",!1),b=P(()=>x.weight??Q),S=P(()=>x.size??j),M=P(()=>x.color??V),v=P(()=>x.mirrored!==void 0?x.mirrored?"scale(-1, 1)":void 0:R?"scale(-1, 1)":void 0);return(C,m)=>(u(),g("svg",$e({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:S.value,height:S.value,fill:M.value,transform:v.value},C.$attrs),[Ve(C.$slots,"default"),b.value==="bold"?(u(),g("g",Ht,Et)):b.value==="duotone"?(u(),g("g",Lt,Wt)):b.value==="fill"?(u(),g("g",Kt,Gt)):b.value==="light"?(u(),g("g",Yt,Qt)):b.value==="regular"?(u(),g("g",Xt,ta)):b.value==="thin"?(u(),g("g",aa,na)):ae("",!0)],16,zt))}}),oa={key:0},ia={class:"ant-upload-drag-icon"},da={class:"ant-upload-text"},ua={class:"ant-upload-hint"},pa={key:1},ca={style:{"margin-top":"1rem","max-height":"60vh","overflow-y":"auto"}},ma=ye({__name:"ImportSpreadsheetsModal",props:{open:{type:Boolean},projectId:{}},emits:["update:open","success"],setup(F,{emit:x}){const Q=Ye.Dragger,j=F,V=x,R=P({get:()=>j.open,set:t=>V("update:open",t)}),b=()=>{const l=(typeof navigator<"u"?navigator.language:"en").split(/[-_]/)[0];return["pt","es","fr","de","it","nl","pl","ru","hi","zh"].includes(l)?"dd/MM/yyyy":"MM/dd/yyyy"},S=Z(1),M=Z([]),v=Z([]),C=Z([]),m=Z(!1),le=Z(!1),K=Z(b()),E=Z(!1),ne=Z("01/02/2025"),se=Z([]),_e=pt.map(t=>({label:t,value:t})),B=[{title:"",dataIndex:"selected",key:"selected",width:50},{title:i.translate("i18n_tables_original_column"),dataIndex:"originalName",key:"originalName",width:150},{title:i.translate("i18n_tables_mapped_column"),dataIndex:"mappedName",key:"mappedName",width:200},{title:i.translate("i18n_tables_column_type"),dataIndex:"type",key:"type",width:120},{title:i.translate("i18n_tables_sample_value"),dataIndex:"sample",key:"sample",width:150}],f=t=>Y(t,!0),ie=t=>Y(t,!1),N=t=>{const a=t.replace(/\.(csv|xlsx|xls)$/i,"").replace(/\s*-\s*/g," ").replace(/_-_/g,"_").replace(/-_/g,"_").replace(/_-/g,"_");return Y(a,!1,!1,!0,!1,!1)},Ue=t=>{if(t==null)return"(empty)";if(t instanceof Date)return t.toLocaleDateString("pt-BR");if(typeof t=="string"){const l=/^(\d{2})\/(\d{2})\/(\d{4})$/,a=t.match(l);if(a){const[,c,d,o]=a,p=new Date(parseInt(o),parseInt(d)-1,parseInt(c));if(p.getFullYear()===parseInt(o)&&p.getMonth()===parseInt(d)-1&&p.getDate()===parseInt(c))return p.toLocaleDateString("pt-BR")}}return typeof t=="object"?JSON.stringify(t).substring(0,50):String(t).substring(0,50)},Be=(t,l)=>{if(t==null||t==="")return null;if(l==="date"){if(t instanceof Date)return t.toISOString();if(typeof t=="number"&&t>100&&t<1e5){const d=new Date(Date.UTC(1899,11,31)),o=1440*60*1e3,p=t>60?t-1:t;return new Date(d.getTime()+p*o).toISOString()}const a=/^(\d{2})\/(\d{2})\/(\d{4})$/,c=String(t).trim().match(a);if(c){const[,d,o,p]=c,r=new Date(Date.UTC(parseInt(p),parseInt(o)-1,parseInt(d)));if(!isNaN(r.getTime()))return r.toISOString()}if(typeof t=="string"||typeof t=="number"){const d=new Date(t);if(!isNaN(d.getTime()))return d.toISOString()}}return t},Fe=t=>{const l=String(t).trim(),a=/^(\d{2})\/(\d{2})\/(\d{4})$/,c=l.match(a);if(!c)return!1;const[,d,o,p]=c,r=parseInt(d),A=parseInt(o);return r>=1&&r<=12&&A>=1&&A<=12},he=t=>{for(const l of t)for(const[,a]of Object.entries(l))if(typeof a=="string"&&Fe(a))return a;return null},ze=t=>{if(t>=100&&t<=1e5){const l=new Date(1899,11,31),a=1440*60*1e3,c=t>60?t-1:t;return new Date(l.getTime()+c*a)}return null},ge=(t,l)=>{const a=String(t).trim(),c=Number(a);if(!isNaN(c)&&a===String(c)){const T=ze(c);if(T)return T}const d=/^(\d{2})\/(\d{2})\/(\d{4})$/,o=a.match(d);if(!o)return null;const[,p,r,A]=o,$=parseInt(l==="dd/MM/yyyy"?p:r),I=parseInt(l==="dd/MM/yyyy"?r:p),D=new Date(parseInt(A),I-1,$);return D.getFullYear()===parseInt(A)&&D.getMonth()===I-1&&D.getDate()===$?D:null},we=t=>{const l=t.filter(r=>r!=null&&r!=="");return l.length===0?"text":l.every(r=>r instanceof Date)||l.every(r=>{const A=String(r),$=/^(\d{2})\/(\d{2})\/(\d{4})$/,I=A.match($);if(I){const[,D,T,oe]=I,X=new Date(parseInt(oe),parseInt(T)-1,parseInt(D));return X.getFullYear()===parseInt(oe)&&X.getMonth()===parseInt(T)-1&&X.getDate()===parseInt(D)}return!1})||l.every(r=>ge(String(r),K.value)!==null||!isNaN(Date.parse(String(r))))?"date":l.every(r=>r===!0||r===!1||r==="true"||r==="false"||r===1||r===0)?"boolean":l.every(r=>String(r).match(/^\d{2}\/\d{2}\/\d{4}$/)?!1:typeof r=="number"||!isNaN(Number(r)))?"numeric":"text"},He=t=>(t.type==="text/csv"||t.type==="application/vnd.ms-excel"||t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||ee.error(i.translate("i18n_tables_invalid_file_type")),!1),Pe=t=>{const l=M.value.indexOf(t);l>-1&&M.value.splice(l,1)},ke=async(t,l=!1)=>new Promise((a,c)=>{const d=new FileReader;d.onload=o=>{try{const p=o.target?.result,r=Ie(p,{type:"string",cellDates:!1}),A=r.SheetNames[0],$=r.Sheets[A],I=be.sheet_to_json($,{defval:null,raw:!0});if(I.length===0){c(new Error("Empty file"));return}if(!l){const z=he(I);if(z){se.value=I,ne.value=z,E.value=!0,a([]);return}}const D=I.map(z=>{const q={};for(const[H,k]of Object.entries(z))if(typeof k=="string"){const L=ge(k,K.value);q[H]=L||k}else q[H]=k;return q}),oe=Object.keys(I[0]).map(z=>{const q=D.map(h=>h[z]),H=we(q),k=q.find(h=>h!=null&&h!=="")||null;let L=k;if(H==="date"&&typeof k=="number"&&k>=100&&k<=1e5){const h=new Date(1899,11,31),re=1440*60*1e3,W=k>60?k-1:k;L=new Date(h.getTime()+W*re)}return{id:pe(),selected:!0,originalName:z,mappedName:Y(z,!1),type:H,sample:L}}),X={selected:!0,fileName:t.name,sheetName:null,tableName:N(t.name),columns:oe,previewData:D.slice(0,5),rawData:D};a([X])}catch(p){c(p)}},d.onerror=c,d.readAsText(t.originFileObj)}),xe=async(t,l=!1)=>new Promise((a,c)=>{const d=new FileReader;d.onload=o=>{try{const p=new Uint8Array(o.target?.result),r=Ie(p,{type:"array",cellDates:!1});if(!l)for(const $ of r.SheetNames){const I=r.Sheets[$],D=be.sheet_to_json(I,{defval:null,raw:!0}),T=he(D);if(T){se.value=D,ne.value=T,E.value=!0,a([]);return}}const A=r.SheetNames.map($=>{const I=r.Sheets[$],D=be.sheet_to_json(I,{defval:null,raw:!0});if(D.length===0)return null;const T=D.map(H=>{const k={};for(const[L,h]of Object.entries(H))if(typeof h=="string"){const re=ge(h,K.value);k[L]=re||h}else k[L]=h;return k}),X=Object.keys(D[0]).map(H=>{const k=T.map(W=>W[H]),L=we(k),h=k.find(W=>W!=null&&W!=="")||null;let re=h;if(L==="date"&&typeof h=="number"&&h>=100&&h<=1e5){const W=new Date(1899,11,31),qe=1440*60*1e3,Ge=h>60?h-1:h;re=new Date(W.getTime()+Ge*qe)}return{id:pe(),selected:!0,originalName:H,mappedName:Y(H,!1),type:L,sample:re}}),z=N(t.name),q=r.SheetNames.length===1?z:`${z}_${Y($,!1)}`;return{selected:!0,fileName:t.name,sheetName:$,tableName:q,columns:X,previewData:T.slice(0,5),rawData:T}}).filter($=>$!==null);a(A)}catch(p){c(p)}},d.onerror=c,d.readAsArrayBuffer(t.originFileObj)}),Ee=async()=>{m.value=!0,v.value=[];try{for(const t of M.value){const l=t.name.toLowerCase();let a=[];l.endsWith(".csv")?a=await ke(t):(l.endsWith(".xlsx")||l.endsWith(".xls"))&&(a=await xe(t)),v.value.push(...a)}v.value.length>0?(C.value=[0],S.value=2):ee.error(i.translate("i18n_tables_no_valid_sheets"))}catch(t){console.error("Error processing files:",t),ee.error(i.translate("i18n_tables_import_error"))}finally{m.value=!1}},Le=t=>t.columns.map(l=>({title:l.mappedName,dataIndex:l.originalName,key:l.originalName,width:150,ellipsis:!0})),Oe=P(()=>{const t=v.value.filter(l=>l.selected);return t.length>0&&t.every(l=>{const a=l.columns.filter(c=>c.selected);return l.tableName.trim()!==""&&a.length>0&&a.every(c=>c.mappedName.trim()!=="")})}),Re=async()=>{le.value=!0;try{const l={tables:v.value.filter(a=>a.selected).map(a=>{const c={id:pe(),name:"id",type:"uuid",primaryKey:!0,nullable:!1,unique:!0,default:"gen_random_uuid()"},d=a.columns.filter(o=>o.selected);return{id:pe(),name:a.tableName,columns:[c,...d.map(o=>({id:o.id,name:o.mappedName,type:o.type,primaryKey:!1,nullable:!0,unique:!1,default:""}))],data:a.rawData.map(o=>{const p={};return d.forEach(r=>{const A=o[r.originalName];p[r.mappedName]=Be(A,r.type)}),p})}})};await it.post(`projects/${j.projectId}/tables/restore`,{tables:l.tables}),ee.success(i.translate("i18n_tables_import_success")),de(),V("success")}catch(t){console.error("Error importing tables:",t),ee.error(i.translate("i18n_tables_import_error"))}finally{le.value=!1}},We=async()=>{E.value=!1,m.value=!0;try{v.value=[];for(const t of M.value){const l=t.name.toLowerCase();let a=[];l.endsWith(".csv")?a=await ke(t,!0):(l.endsWith(".xlsx")||l.endsWith(".xls"))&&(a=await xe(t,!0)),v.value.push(...a)}v.value.length>0?(C.value=[0],S.value=2):ee.error(i.translate("i18n_tables_no_valid_sheets"))}catch(t){console.error("Error reprocessing files:",t),ee.error(i.translate("i18n_tables_import_error"))}finally{m.value=!1,se.value=[]}},Ke=()=>{S.value=1},de=()=>{R.value=!1,S.value=1,M.value=[],v.value=[],C.value=[],m.value=!1,le.value=!1,K.value=b(),E.value=!1,se.value=[]};return(t,l)=>(u(),g(me,null,[s(e(ve),{open:R.value,"onUpdate:open":l[4]||(l[4]=a=>R.value=a),title:e(i).translate("i18n_tables_import_spreadsheets"),width:800,footer:null,onCancel:de},{default:n(()=>[S.value===1?(u(),g("div",oa,[s(e(G),{type:"secondary"},{default:n(()=>[y(_(e(i).translate("i18n_tables_import_description")),1)]),_:1}),s(e(Q),{"file-list":M.value,"onUpdate:fileList":l[0]||(l[0]=a=>M.value=a),"before-upload":He,remove:Pe,accept:".csv,.xlsx,.xls",multiple:"",style:{"margin-top":"1rem"}},{default:n(()=>[w("p",ia,[s(e(Ft),{size:48})]),w("p",da,_(e(i).translate("i18n_tables_upload_click_or_drag")),1),w("p",ua,_(e(i).translate("i18n_tables_upload_supported_formats")),1)]),_:1},8,["file-list"]),s(e(te),{justify:"flex-end",gap:"small",style:{"margin-top":"1rem"}},{default:n(()=>[s(O,{onClick:de},{default:n(()=>[...l[7]||(l[7]=[y(" Cancel ",-1)])]),_:1}),s(O,{type:"primary",disabled:M.value.length===0,loading:m.value,onClick:Ee},{default:n(()=>[...l[8]||(l[8]=[y(" Next ",-1)])]),_:1},8,["disabled","loading"])]),_:1})])):ae("",!0),S.value===2?(u(),g("div",pa,[s(e(G),{type:"secondary"},{default:n(()=>[y(_(e(i).translate("i18n_tables_import_mapping_description")),1)]),_:1}),s(e(Ze),{spinning:m.value},{default:n(()=>[w("div",ca,[s(e(rt),{"active-key":C.value,"onUpdate:activeKey":l[3]||(l[3]=a=>C.value=a),accordion:""},{default:n(()=>[(u(!0),g(me,null,je(v.value,(a,c)=>(u(),U(e(ot),{key:c,disabled:!a.selected,style:ue({opacity:a.selected?1:.6})},{header:n(()=>[s(e(te),{align:"center",gap:"small",onClick:l[2]||(l[2]=Me(()=>{},["stop"]))},{default:n(()=>[s(e(Se),{checked:a.selected,"onUpdate:checked":d=>a.selected=d,onClick:l[1]||(l[1]=Me(()=>{},["stop"]))},null,8,["checked","onUpdate:checked"]),w("span",{style:ue({textDecoration:a.selected?"none":"line-through",color:a.selected?"inherit":"#999"})},_(a.fileName)+" "+_(a.sheetName?`- ${a.sheetName}`:""),5)]),_:2},1024)]),default:n(()=>[a.selected?(u(),U(e(Te),{key:0,layout:"vertical"},{default:n(()=>[s(e(ce),{label:e(i).translate("i18n_tables_table_name")},{default:n(()=>[s(e(fe),{value:a.tableName,"onUpdate:value":d=>a.tableName=d,placeholder:e(i).translate("i18n_tables_enter_table_name"),onBlur:d=>a.tableName=ie(a.tableName),onInput:d=>a.tableName=f(a.tableName)},null,8,["value","onUpdate:value","placeholder","onBlur","onInput"])]),_:2},1032,["label"]),s(e(ce),{label:e(i).translate("i18n_tables_columns")},{default:n(()=>[s(e(De),{columns:B,"data-source":a.columns,pagination:!1,size:"small"},{bodyCell:n(({column:d,record:o})=>[d.key==="selected"?(u(),U(e(Se),{key:0,checked:o.selected,"onUpdate:checked":p=>o.selected=p},null,8,["checked","onUpdate:checked"])):d.key==="originalName"?(u(),U(e(G),{key:1,code:"",style:ue({textDecoration:o.selected?"none":"line-through",opacity:o.selected?1:.5})},{default:n(()=>[y(_(o.originalName),1)]),_:2},1032,["style"])):d.key==="mappedName"?(u(),U(e(fe),{key:2,value:o.mappedName,"onUpdate:value":p=>o.mappedName=p,size:"small",disabled:!o.selected,onBlur:p=>o.mappedName=ie(o.mappedName),onInput:p=>o.mappedName=f(o.mappedName)},null,8,["value","onUpdate:value","disabled","onBlur","onInput"])):d.key==="type"?(u(),U(e(Je),{key:3,value:o.type,"onUpdate:value":p=>o.type=p,size:"small",style:{width:"100%"},disabled:!o.selected,options:e(_e)},null,8,["value","onUpdate:value","disabled","options"])):d.key==="sample"?(u(),U(e(G),{key:4,type:"secondary",style:ue([{"font-size":"12px"},{opacity:o.selected?1:.5}])},{default:n(()=>[y(_(Ue(o.sample)),1)]),_:2},1032,["style"])):ae("",!0)]),_:1},8,["data-source"])]),_:2},1032,["label"]),s(e(ce),{label:e(i).translate("i18n_tables_preview")},{default:n(()=>[s(e(De),{columns:Le(a),"data-source":a.previewData,pagination:!1,scroll:{x:"max-content",y:200},size:"small"},null,8,["columns","data-source"])]),_:2},1032,["label"])]),_:2},1024)):ae("",!0)]),_:2},1032,["disabled","style"]))),128))]),_:1},8,["active-key"])])]),_:1},8,["spinning"]),s(e(te),{justify:"space-between",style:{"margin-top":"1rem"}},{default:n(()=>[s(O,{onClick:Ke},{default:n(()=>[...l[9]||(l[9]=[y(" Back ",-1)])]),_:1}),s(e(te),{gap:"small"},{default:n(()=>[s(O,{onClick:de},{default:n(()=>[...l[10]||(l[10]=[y(" Cancel ",-1)])]),_:1}),s(O,{type:"primary",disabled:!Oe.value,loading:le.value,onClick:Re},{default:n(()=>[y(_(e(i).translate("i18n_tables_import")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})])):ae("",!0)]),_:1},8,["open","title"]),s(e(ve),{open:E.value,"onUpdate:open":l[6]||(l[6]=a=>E.value=a),title:e(i).translate("i18n_tables_date_format"),width:600,closable:!1,"mask-closable":!1},{footer:n(()=>[s(e(te),{justify:"flex-end"},{default:n(()=>[s(O,{type:"primary",onClick:We},{default:n(()=>[y(_(e(i).translate("i18n_tables_confirm_and_continue")),1)]),_:1})]),_:1})]),default:n(()=>[s(e(yt),{type:"warning","show-icon":"",style:{"margin-bottom":"1rem"},message:e(i).translate("i18n_tables_ambiguous_dates_detected"),description:e(i).translate("i18n_tables_ambiguous_dates_description")},null,8,["message","description"]),s(e(G),{strong:"",style:{display:"block","margin-bottom":"0.5rem"}},{default:n(()=>[y(_(e(i).translate("i18n_tables_date_format_description")),1)]),_:1}),s(e(Qe),{value:K.value,"onUpdate:value":l[5]||(l[5]=a=>K.value=a),style:{display:"flex","flex-direction":"column",gap:"0.5rem"}},{default:n(()=>[s(e(Ce),{value:"dd/MM/yyyy"},{default:n(()=>[y(_(e(i).translate("i18n_tables_date_format_ddmmyyyy"))+" ",1),s(e(G),{type:"secondary",style:{display:"block","margin-left":"24px"}},{default:n(()=>[y(_(e(i).translate("i18n_tables_date_format_example",null,"dd/MM/yyyy",ne.value)),1)]),_:1})]),_:1}),s(e(Ce),{value:"MM/dd/yyyy"},{default:n(()=>[y(_(e(i).translate("i18n_tables_date_format_mmddyyyy"))+" ",1),s(e(G),{type:"secondary",style:{display:"block","margin-left":"24px"}},{default:n(()=>[y(_(e(i).translate("i18n_tables_date_format_example",null,"MM/dd/yyyy",ne.value)),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["open","title"])],64))}}),fa={key:1,style:{padding:"1rem"}},ya={style:{flex:"1"}},Ta=ye({__name:"Tables",setup(F){const x=Xe(),j=et().params.projectId,{tables:V,loading:R,fetchTables:b}=_t(j),S=Z(""),M=P(()=>{if(!V.value)return[];if(!S.value)return V.value;const B=S.value.toLowerCase();return V.value.filter(f=>f.name.toLowerCase().includes(B))}),v=Z(!1),C=Z(!1),m=tt({name:""}),le=B=>Y(B,!0),K=B=>Y(B,!1),E=Z(!1),ne=async()=>{E.value=!0;const B=await ct.create(j,m.name);await b(!0),E.value=!1,v.value=!1,m.name="",x.push({name:"tableEditor",params:{tableId:B.id,projectId:j}})},se=()=>{v.value=!1,m.name=""},_e=()=>{b(!0)};return at(()=>{const B=Ne.subscribe("tableCreated",()=>{b(!0)});lt(()=>{Ne.unsubscribe(B)})}),(B,f)=>{const ie=nt("RouterLink");return u(),g(me,null,[s(ft),e(R)?(u(),U(e(Ze),{key:0,style:{width:"100%","margin-top":"2rem"}})):(u(),g("div",fa,[s(e(te),{justify:"space-between",align:"center",style:{"margin-bottom":"1rem"}},{default:n(()=>[w("div",ya,[s(e(st),{level:3},{default:n(()=>[y(_(e(i).translate("i18n_tables_tables")),1)]),_:1}),s(e(G),{type:"secondary"},{default:n(()=>[y(_(e(i).translate("i18n_tables_description")),1)]),_:1})]),s(e(te),{gap:"small"},{default:n(()=>[s(O,{onClick:f[0]||(f[0]=N=>C.value=!0)},{default:n(()=>[y(_(e(i).translate("i18n_tables_import_spreadsheets")),1)]),_:1}),s(O,{type:"primary",onClick:f[1]||(f[1]=N=>v.value=!0)},{default:n(()=>[y(_(e(i).translate("i18n_tables_create_table")),1)]),_:1})]),_:1})]),_:1}),e(V)&&e(V).length>0?(u(),U(e(fe),{key:0,value:S.value,"onUpdate:value":f[2]||(f[2]=N=>S.value=N),placeholder:e(i).translate("i18n_tables_search_placeholder"),"allow-clear":"",style:{"margin-bottom":"1rem","max-width":"400px"}},{prefix:n(()=>[s(e(ra),{size:16})]),_:1},8,["value","placeholder"])):ae("",!0),!e(V)||e(V).length===0?(u(),U(e(Ae),{key:1,description:e(i).translate("i18n_tables_empty_title")},null,8,["description"])):M.value.length===0?(u(),U(e(Ae),{key:2,description:e(i).translate("i18n_tables_no_match")},null,8,["description"])):(u(),U(e(ut),{key:3,gutter:[16,16]},{default:n(()=>[(u(!0),g(me,null,je(M.value,N=>(u(),U(e(dt),{key:N.id,xs:24,sm:24,md:12,lg:12,xl:8,xxl:8},{default:n(()=>[s(ie,{to:`/projects/${e(j)}/tables/${N.id}`,style:{"text-decoration":"none",color:"inherit"}},{default:n(()=>[s(mt,{table:N,"project-id":e(j),"show-edit-button":!1},null,8,["table","project-id"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1}))])),s(e(ve),{open:v.value,"onUpdate:open":f[6]||(f[6]=N=>v.value=N),title:e(i).translate("i18n_tables_create_table")},{footer:n(()=>[s(O,{onClick:se},{default:n(()=>[y(_(e(i).translate("i18n_tables_cancel")),1)]),_:1}),s(O,{type:"primary",loading:E.value,disabled:!m.name.trim(),onClick:ne},{default:n(()=>[y(_(e(i).translate("i18n_tables_create")),1)]),_:1},8,["loading","disabled"])]),default:n(()=>[s(e(Te),{model:m,layout:"vertical"},{default:n(()=>[s(e(ce),{label:e(i).translate("i18n_tables_table_name"),name:"name"},{default:n(()=>[s(e(fe),{value:m.name,"onUpdate:value":f[3]||(f[3]=N=>m.name=N),placeholder:e(i).translate("i18n_tables_enter_table_name"),onBlur:f[4]||(f[4]=N=>m.name=K(m.name)),onInput:f[5]||(f[5]=N=>m.name=le(m.name))},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"]),s(ma,{open:C.value,"onUpdate:open":f[7]||(f[7]=N=>C.value=N),"project-id":e(j),onSuccess:_e},null,8,["open","project-id"])],64)}}});export{Ta as default};
//# sourceMappingURL=Tables-BMCkD0yS.js.map

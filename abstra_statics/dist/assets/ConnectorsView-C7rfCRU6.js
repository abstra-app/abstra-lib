import{_ as oe}from"./DocsButton.vue_vue_type_script_setup_true_lang-CAmZ-lkx.js";import{_ as Y}from"./AbstraButton.vue_vue_type_script_setup_true_lang-B5SKTzwg.js";import{a as z,i as M,c as K,b as T,e as h,f as le,g as F,h as j,m as se,r as H,a8 as D,H as Q,p as k,u as a,aJ as re,w as s,M as V,W as R,aG as ce,aH as ue,aK as de,cA as W,bq as pe,br as he,S as b,U as w,cz as ge,bo as me,b8 as ve,bj as fe,bn as ye,j as u,af as f,ak as P,v as U,aQ as $,cB as ke,aL as te,bm as X,E as be,aN as ne,ac as we,aj as q,be as Ce,bf as _e,bg as Z,bB as Ee,z as ee,bs as G}from"./jwt-decode.esm-qFrVYqMT.js";import{G as Ae}from"./PhDotsThreeVertical.vue-Df_5H2Em.js";import{C as Te}from"./connectors-hHHQSJmA.js";import{a as Se}from"./router-Dlrr4bcq.js";import{U as Ie}from"./UploadOutlined-Dp1mrEhA.js";import{_ as xe}from"./AbstraLogo.vue_vue_type_script_setup_true_lang-DxP6EsAi.js";import{L as Ue}from"./Logo-CEn9nr0F.js";import{A as ae}from"./index-CoSqIHMF.js";import{C as ie}from"./index-DNCR22uW.js";import{S as Le}from"./index-EXE47iFI.js";import"./constants-5xR_c7Wc.js";import"./ts.worker-HMz_Z6NX.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[i]="77975fa0-1e4f-4a61-938a-739750cd6f78",r._sentryDebugIdIdentifier="sentry-dbid-77975fa0-1e4f-4a61-938a-739750cd6f78")}catch{}})();const Ne=["width","height","fill","transform"],Fe={key:0},Ve=j("path",{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},null,-1),Pe=[Ve],Ke={key:1},je=j("path",{d:"M208,80v96H48V80Z",opacity:"0.2"},null,-1),De=j("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),He=[je,De],Re={key:2},ze=j("path",{d:"M42.34,85.66a8,8,0,0,1,0-11.32l32-32A8,8,0,0,1,88,48V72H208a8,8,0,0,1,0,16H88v24a8,8,0,0,1-13.66,5.66Zm171.32,84.68-32-32A8,8,0,0,0,168,144v24H48a8,8,0,0,0,0,16H168v24a8,8,0,0,0,13.66,5.66l32-32A8,8,0,0,0,213.66,170.34Z"},null,-1),Be=[ze],Me={key:3},$e=j("path",{d:"M212.24,171.76a6,6,0,0,1,0,8.48l-32,32a6,6,0,0,1-8.48-8.48L193.51,182H48a6,6,0,0,1,0-12H193.51l-21.75-21.76a6,6,0,0,1,8.48-8.48ZM75.76,116.24a6,6,0,0,0,8.48-8.48L62.49,86H208a6,6,0,0,0,0-12H62.49L84.24,52.24a6,6,0,0,0-8.48-8.48l-32,32a6,6,0,0,0,0,8.48Z"},null,-1),Oe=[$e],qe={key:4},Ze=j("path",{d:"M213.66,181.66l-32,32a8,8,0,0,1-11.32-11.32L188.69,184H48a8,8,0,0,1,0-16H188.69l-18.35-18.34a8,8,0,0,1,11.32-11.32l32,32A8,8,0,0,1,213.66,181.66Zm-139.32-64a8,8,0,0,0,11.32-11.32L67.31,88H208a8,8,0,0,0,0-16H67.31L85.66,53.66A8,8,0,0,0,74.34,42.34l-32,32a8,8,0,0,0,0,11.32Z"},null,-1),Ge=[Ze],Je={key:5},Ye=j("path",{d:"M210.83,173.17a4,4,0,0,1,0,5.66l-32,32a4,4,0,0,1-5.66-5.66L198.34,180H48a4,4,0,0,1,0-8H198.34l-25.17-25.17a4,4,0,0,1,5.66-5.66ZM77.17,114.83a4,4,0,0,0,5.66-5.66L57.66,84H208a4,4,0,0,0,0-8H57.66L82.83,50.83a4,4,0,0,0-5.66-5.66l-32,32a4,4,0,0,0,0,5.66Z"},null,-1),Qe=[Ye],We={name:"PhArrowsLeftRight"},Xe=z({...We,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(r){const i=r,o=M("weight","regular"),n=M("size","1em"),c=M("color","currentColor"),C=M("mirrored",!1),A=K(()=>i.weight??o),I=K(()=>i.size??n),l=K(()=>i.color??c),y=K(()=>i.mirrored!==void 0?i.mirrored?"scale(-1, 1)":void 0:C?"scale(-1, 1)":void 0);return(L,N)=>(h(),T("svg",se({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:I.value,height:I.value,fill:l.value,transform:y.value},L.$attrs),[le(L.$slots,"default"),A.value==="bold"?(h(),T("g",Fe,Pe)):A.value==="duotone"?(h(),T("g",Ke,He)):A.value==="fill"?(h(),T("g",Re,Be)):A.value==="light"?(h(),T("g",Me,Oe)):A.value==="regular"?(h(),T("g",qe,Ge)):A.value==="thin"?(h(),T("g",Je,Qe)):F("",!0)],16,Ne))}});(()=>{var r="https://apis.google.com/js/api.js",i="https://accounts.google.com/gsi/client";async function o(e="client:picker"){return window.gapi||await c(r),await new Promise(t=>{window.gapi.load(e,t)}),window.google}async function n(e){return window.google?.accounts?.oauth2||await c(i),new Promise((t,d)=>{window.google.accounts.oauth2.initTokenClient({...e,callback:t,error_callback:d}).requestAccessToken()})}async function c(e){return new Promise((t,d)=>{let E=document.createElement("script");E.src=e,E.onload=()=>t(),E.onerror=m=>d(m);let g=document.querySelector(`script[src="${e}"]`);g&&(console.log(`drive-picker: appending a copy of an existing script ${e}`),Array.from(g.attributes).forEach(m=>{["id","src","onload","onerror"].includes(m.name)||E.setAttribute(m.name,m.value)}),g.nonce&&(E.nonce=g.nonce)),document.head.appendChild(E)})}function C(e,t){let d=e.getAttribute(t);return d?Number(d):null}var A=(e=>(e[e.FALSE=0]="FALSE",e[e.TRUE=1]="TRUE",e[e.DEFAULT=2]="DEFAULT",e))(A||{});function I(e,t){return e.hasAttribute(t)}function l(e,t){let d=e.getAttribute(t)?.toUpperCase();if(!d)return 2;let E=A[d];if(E!==void 0)return E;throw new Error(`Invalid value, "${d}", for attribute ${t}. Must be one of ${Object.keys(A).filter(Number.isNaN).join(", ")}`)}function y(e,t,d,E){let g=l(t,e);return g===2?E:d.call(E,g===1)}var L=class extends HTMLElement{static get observedAttributes(){return["enable-drives","file-ids","include-folders","mime-types","mode","owned-by-me","parent","query","select-folder-enabled","starred","view-id"]}get view(){let e=new window.google.picker.DocsView(this.viewId);y("enable-drives",this,e.setEnableDrives,e),y("include-folders",this,e.setIncludeFolders,e),y("owned-by-me",this,e.setOwnedByMe,e),y("select-folder-enabled",this,e.setSelectFolderEnabled,e),y("starred",this,e.setStarred,e);let t=this.getAttribute("mime-types");t!==null&&e.setMimeTypes(t);let d=this.getAttribute("file-ids");d!==null&&e.setFileIds(d);let E=this.getAttribute("mode");E&&e.setMode(google.picker.DocsViewMode[E]);let g=this.getAttribute("parent");g!==null&&e.setParent(g);let m=this.getAttribute("query");return m!==null&&e.setQuery(m),e}get viewId(){let e=this.getAttribute("view-id");return e?window.google.picker.ViewId[e]:void 0}},N=class extends HTMLElement{static get observedAttributes(){return["app-id","client-id","debounce-delay","developer-key","hide-title-bar","locale","max-items","mine-only","multiselect","nav-hidden","oauth-token","origin","relay-url","scope","title"]}picker;observer;google;loading;debounceTimer;get visible(){return!!this.picker?.isVisible()}set visible(e){this.picker?.setVisible(e)}get tokenClientConfig(){let e=this.getAttribute("client-id"),t=this.getAttribute("scope")??"https://www.googleapis.com/auth/drive.file";if(!e||!t)throw new Error("client-id and scope are required attributes");return{client_id:e,hd:this.getAttribute("hd")??void 0,include_granted_scopes:!!this.getAttribute("include-granted-scope"),login_hint:this.getAttribute("login-hint")??void 0,prompt:this.getAttribute("prompt")??"",scope:t}}attributeChangedCallback(){this.isConnected&&this.scheduleBuild()}scheduleBuild(){clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.build()},C(this,"debounce-delay")??0)}async build(){if(this.picker?.dispose(),await this.loading,!this.google)return;let e=new this.google.picker.PickerBuilder().setCallback(O=>{this.callbackToDispatchEvent(O)}),t=this.getAttribute("app-id");t?e=e.setAppId(t):console.warn("drive-picker: app-id attribute is missing. This may cause issues with backend API integration.");let d=this.getAttribute("developer-key");d!==null&&(e=e.setDeveloperKey(d));let E=this.getAttribute("locale");E!==null&&(e=e.setLocale(E));let g=C(this,"max-items");g!==null&&(e=e.setMaxItems(g));let m=this.getAttribute("origin");m!==null&&(e=e.setOrigin(m));let v=this.getAttribute("relay-url");v!==null&&(e=e.setRelayUrl(v));let S=this.getAttribute("title");S!==null&&(e=e.setTitle(S)),y("hide-title-bar",this,e.hideTitleBar,e);let B=this.getAttribute("oauth-token")??await this.requestAccessToken();if(B){e=e.setOAuthToken(B),I(this,"multiselect")&&(e=e.enableFeature(this.google.picker.Feature.MULTISELECT_ENABLED)),I(this,"mine-only")&&(e=e.enableFeature(this.google.picker.Feature.MINE_ONLY)),I(this,"nav-hidden")&&(e=e.enableFeature(this.google.picker.Feature.NAV_HIDDEN));for(let O of this.views)e=e.addView(O);this.picker=e.build(),this.picker.setVisible(!0)}}get views(){let e=p(this);return e.length?e:["all"]}async connectedCallback(){this.loading=o().then(e=>{this.google=e}),this.observer=new MutationObserver(e=>{e.filter(t=>t.type==="childList"||t.type==="attributes"&&t.target!==this).length&&this.scheduleBuild()}),this.observer?.observe(this,{childList:!0,subtree:!0,attributes:!0}),this.scheduleBuild()}callbackToDispatchEvent(e){let t;switch(e.action){case google.picker.Action.CANCEL:t=["picker:canceled","picker-canceled"];break;case google.picker.Action.PICKED:t=["picker:picked","picker-picked"];break;case google.picker.Action.ERROR:t=["picker:error","picker-error"];break;default:return}for(let d of t)this.dispatchEvent(new CustomEvent(d,{detail:e}))}async requestAccessToken(){return n(this.tokenClientConfig).then(e=>{let{access_token:t}=e;if(!t){this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}));return}return this.dispatchEvent(new CustomEvent("picker:authenticated",{detail:{token:t}})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),this.dispatchEvent(new CustomEvent("picker:oauth:response",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),t}).catch(e=>{this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}))})}disconnectedCallback(){this.picker?.dispose()}};function _(e){return"view"in e&&e.view instanceof window.google.picker.View}function x(e){return e.filter(t=>_(t)).map(t=>t.view)}function p(e,t="*"){return x(Array.from(e.querySelectorAll(t)))}customElements.define("drive-picker",N),customElements.define("drive-picker-docs-view",L)})();class et{apiKey=void 0;clientId=void 0;appId=this.clientId?.split(".")[0];async showPicker(i){return new Promise((o,n)=>{try{const{accessToken:c,title:C="Select files",views:A=["DOCS","FOLDERS","SPREADSHEETS","PRESENTATIONS"],multiSelect:I=!0}=i;if(!c||!this.clientId||!this.apiKey)throw new Error("Tokens are required but not provided");const l=document.createElement("drive-picker");l.setAttribute("client-id",this.clientId),l.setAttribute("app-id",this.appId),l.setAttribute("developer-key",this.apiKey),l.setAttribute("oauth-token",c),l.setAttribute("origin",window.location.origin||"http://localhost:8004"),l.setAttribute("multiselect",I.toString()),C&&l.setAttribute("title",C),A.forEach(_=>{const x=document.createElement("drive-picker-docs-view");x.setAttribute("view-id",_),l.appendChild(x)}),l.oauthToken=c,l.clientId=this.clientId,l.appId=this.appId,l.developerKey=this.apiKey;const y=_=>{const{action:x,docs:p}=_.detail;x==="picked"?o({action:"picked",documents:p||[]}):(x==="cancelled"||x==="cancel")&&o({action:"cancelled",documents:[]}),document.body.contains(l)&&document.body.removeChild(l)},L=_=>{n(new Error(`Google Picker error: ${_.detail.error||"Unknown error"}`)),document.body.contains(l)&&document.body.removeChild(l)},N=_=>{n(new Error(`Google Picker OAuth error: ${_.detail.error||"OAuth failed"}`)),document.body.contains(l)&&document.body.removeChild(l)};l.addEventListener("picker-picked",y),l.addEventListener("picker-canceled",y),l.addEventListener("picker-error",L),l.addEventListener("picker-oauth-error",N),l.style.display="none",document.body.appendChild(l),setTimeout(()=>{l.visible=!0},100)}catch(c){console.error("Error in showPicker:",c),n(new Error(`Failed to create picker: ${c instanceof Error?c.message:"Unknown error"}`))}})}}const tt=new et;class nt{constructor(i,o){this.projectId=i,this.api=o,this.state=H({connectors:[],connections:[],addingConnection:null,editingConnection:null,betaStatus:{}})}state;hasChanges=K(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName);async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchBetaStatus(){this.state.value.betaStatus=await this.api.getConnectorsBetaStatus()}async fetchInitialState(){await this.fetchConnectors(),await Promise.all([this.fetchBetaStatus(),this.refetchConnections()])}async refetchConnections(){const i=await this.api.listConnections(this.projectId);this.state.value.connections=i.map(o=>{const n=this.state.value.connectors.find(c=>c.metadata.key===o.connectionType);return n?{name:o.name,connectorTitle:n.metadata.label,connectorType:o.connectionType,icon:n.metadata.logoUrl}:null}).filter(o=>o!==null)}handleDeletionClick=async i=>{D.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(i)})};handleDeleteConnection=async i=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:i.name,connectorType:i.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()};handleEditConnectionClick(i){this.state.value.editingConnection={...i,newName:i.name}}async getLoginUrl(i,o,n,c){return this.api.getLoginUrl(this.projectId,o,i,n,c)}slugify(i){return i.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(i){const o=new Set(this.state.value.connections.filter(c=>c.connectorType===i).map(c=>c.name));if(!o.has(i))return i;let n=1;for(;o.has(`${i}-${n}`);)n++;return`${i}-${n}`}handleAddConnectionSubmit=async()=>{const i=this.state.value.addingConnection?.connector.metadata.key,o=this.state.value.addingConnection?.selectedScopeIds,n=this.state.value.addingConnection?.tokenValues??{};if(!i||!o)throw new Error("No connector or scope selected");const{url:c}=await this.getLoginUrl(i,this.getUniqueName(i),o,n);window.location.href=c};handleAddTokenConnectionSubmit=async()=>{const i=this.state.value.addingConnection;if(!i)throw new Error("No connection is being added");const o=i.connector.metadata.key,n=this.getUniqueName(o);await this.api.createTokenConnection({projectId:this.projectId,connectionName:n,connectorType:o,tokens:i.tokenValues}),this.state.value.addingConnection=null,await this.refetchConnections()};async generateEcdsaKey(){const i=this.state.value.addingConnection;if(!i)throw new Error("No connection is being added");const o=i.connector.metadata.key,n=this.getUniqueName(o),C=o==="iugu"?await this.api.generateRsaKey({projectId:this.projectId,connectionName:n,connectorType:o}):await this.api.generateEcdsaKey({projectId:this.projectId,connectionName:n,connectorType:o});return this.state.value.addingConnection&&(this.state.value.addingConnection.connectionName=n,this.state.value.addingConnection.ecdsaKeys=C),C.publicKey}handleAddEcdsaConnectionSubmit=async(i,o)=>{const n=this.state.value.addingConnection;if(!n||!i)throw new Error("No connection is being added or public key is missing");if(!n.connectionName||!n.ecdsaKeys)throw new Error("Keys or connection name not found");const c=n.connector.metadata.key;if(c==="iugu"){if(!o)throw new Error("API Token is missing");await this.api.createRsaConnection({projectId:this.projectId,connectionName:n.connectionName,connectorType:c,publicKey:n.ecdsaKeys.publicKey,privateKey:n.ecdsaKeys.privateKey,apiToken:o})}else{if(!o)throw new Error("Project ID is missing");await this.api.createEcdsaConnection({projectId:this.projectId,connectionName:n.connectionName,connectorType:c,publicKey:n.ecdsaKeys.publicKey,privateKey:n.ecdsaKeys.privateKey,accessId:o})}this.state.value.addingConnection=null,await this.refetchConnections()};renameConnection=async()=>{const{editingConnection:i}=this.state.value;if(!i)throw new Error("No connection is being edited");const o=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:i.name,connectorType:i.connectorType,newConnectionName:i.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};D.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:o})};showAddConfirmationModal=i=>{this.state.value.addingConnection={selectedScopeIds:i.auth.type==="oauth2"?i.auth.scopes.map(o=>o.key):[],connector:i,tokenValues:{}}};handleScopeToggle=(i,o)=>{o?this.state.value.addingConnection.selectedScopeIds.push(i):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(n=>n!==i)};handlePersonalizedOption=async i=>{if(i.connectorType==="google-drive")try{const o=await this.api.getGoogleDriveAccessToken(this.projectId,i.name),n=await tt.showPicker({accessToken:o,title:"Select files",views:["DOCS","FOLDERS","SPREADSHEETS","PRESENTATIONS"],multiSelect:!0});if(n.action==="picked"&&n.documents.length>0)await this.savePickerSelection(i,n.documents);else{if(n.action==="cancelled")return;n.documents.length===0&&D.warning({title:"No files selected",content:"Please select at least one file to save to the connection."})}}catch{D.error({title:"Error accessing files",content:"An unexpected error occurred while accessing your files. Please try again."})}else return};async savePickerSelection(i,o){try{const n={selectedFiles:o.map(c=>({id:c.id,name:c.name,url:c.url,mimeType:c.mimeType,iconUrl:c.iconUrl,lastEditedUtc:c.lastEditedUtc,parents:c.parents||[],type:c.type,sizeBytes:c.sizeBytes})),lastUpdated:new Date().toISOString(),totalFiles:o.length};await this.api.saveAllowedGoogleDriveFiles(this.projectId,i.name,i.connectorType,n),D.success({title:"Files saved",content:"The selected files have been successfully saved to the connection."})}catch(n){throw D.error({title:"Error saving files",content:"An error occurred while saving the selected files. Please try again."}),n}}}function at(r){return new Promise((i,o)=>{const n=new FileReader;n.onload=()=>{const C=n.result.split(",")[1];i(C)},n.onerror=()=>o(n.error),n.readAsDataURL(r)})}const it={key:6,style:{"margin-top":"16px"}},J=z({__name:"AuthFormFields",props:{tokens:{},tokenValues:{},uploadedFiles:{default:()=>({})}},emits:["update:tokenValues","update:uploadedFiles","tokenChange"],setup(r,{emit:i}){const o=r,n=i,c=H(o.uploadedFiles||{});function C(p){const e=l.value[p];return e?e.split(",").map(t=>t.trim()):[]}function A(p){if(!p.condition)return!0;const e=Object.keys(p.condition);for(const t of e){const d=p.condition[t].equals;if(l.value[t]!==d)return!1}return!0}function I(p,e){Array.isArray(e)?y(p,e.join(",")):console.error("Expected array for checkbox/select value")}const l=H({...o.tokenValues});Q(()=>o.tokenValues,p=>{l.value={...p}},{deep:!0}),Q(()=>o.uploadedFiles,p=>{c.value=p||{}},{deep:!0});function y(p,e){l.value[p]=e;const t={...l.value};n("update:tokenValues",t),n("tokenChange")}function L(p){const e=[];return p.key&&e.push({required:!0,message:f.translate("i18n_auth_form_field_required",null,p.label||p.key)}),p.input?.minSize&&e.push({min:p.input.minSize,message:f.translate("i18n_auth_form_field_min_length",null,p.input.minSize)}),p.input?.maxSize&&e.push({max:p.input.maxSize,message:f.translate("i18n_auth_form_field_max_length",null,p.input.maxSize)}),e}async function N(p,e){try{const t=await at(p),d={...c.value,[e]:{file:p,base64:t}};c.value=d,n("update:uploadedFiles",d),l.value[e]=t;const E={...l.value};n("update:tokenValues",E),n("tokenChange")}catch(t){console.error("Error converting file to base64:",t)}return!1}function _(p){const e={...c.value};delete e[p],c.value=e,n("update:uploadedFiles",e),l.value[p]="";const t={...l.value};n("update:tokenValues",t),n("tokenChange")}function x(p){const e=c.value[p];return e?[{uid:p,name:e.file.name,status:"done",size:e.file.size}]:[]}return(p,e)=>(h(),k(a(re),{model:l.value,layout:"vertical"},{default:s(()=>[(h(!0),T(V,null,R(r.tokens,t=>ce((h(),k(a(de),{key:t.key,required:A(t),label:t.label,name:t.key,rules:L(t)},{default:s(()=>[t.input?.type==="small-string"?(h(),k(a(W),{key:0,value:l.value[t.key],"onUpdate:value":d=>l.value[t.key]=d,placeholder:t.description,maxlength:t.input?.maxSize,minlength:t.input?.minSize,onInput:()=>y(t.key,l.value[t.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):t.input?.type==="radiobox"?(h(),k(a(pe),{key:1,value:l.value[t.key],"onUpdate:value":d=>l.value[t.key]=d,onChange:()=>y(t.key,l.value[t.key]||"")},{default:s(()=>[(h(!0),T(V,null,R(t.input.options,d=>(h(),k(a(he),{key:d.value,value:d.value},{default:s(()=>[b(w(d.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):t.input?.type==="checkbox"?(h(),T(V,{key:2},[(t.input?.options?.length??0)<=10?(h(),k(a(ge),{key:0,value:C(t.key),onChange:d=>I(t.key,d)},{default:s(()=>[(h(!0),T(V,null,R(t.input.options,d=>(h(),k(a(me),{key:d.value,value:d.value},{default:s(()=>[b(w(d.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange"])):(h(),k(a(ve),{key:1,mode:"multiple",style:{width:"100%"},value:C(t.key),options:t.input.options??[],onChange:d=>I(t.key,d)},null,8,["value","options","onChange"]))],64)):t.input?.type==="large-text"?(h(),k(a(fe),{key:3,value:l.value[t.key],"onUpdate:value":d=>l.value[t.key]=d,placeholder:t.description,maxlength:t.input?.maxSize,minlength:t.input?.minSize,rows:4,onInput:()=>y(t.key,l.value[t.key]||"")},null,8,["value","onUpdate:value","placeholder","maxlength","minlength","onInput"])):t.input?.type==="file"?(h(),k(a(ye),{key:4,"file-list":x(t.key),"before-upload":d=>N(d,t.key),"max-count":1,"show-upload-list":!0,onRemove:()=>_(t.key)},{default:s(()=>[u(Y,null,{default:s(()=>[u(a(Ie)),b(" "+w(a(f).translate("i18n_auth_form_upload_file",null)),1)]),_:1})]),_:1},8,["file-list","before-upload","onRemove"])):(h(),k(a(W),{key:5,value:l.value[t.key],"onUpdate:value":d=>l.value[t.key]=d,placeholder:t.description,onInput:()=>y(t.key,l.value[t.key]||"")},null,8,["value","onUpdate:value","placeholder","onInput"])),t.instructions?(h(),T("div",it,[u(a(P),{type:"secondary",style:{"white-space":"pre-line","font-size":"14px"}},{default:s(()=>[b(w(t.instructions),1)]),_:2},1024)])):F("",!0),t.description&&!t.instructions?(h(),k(a(P),{key:7,type:"secondary",style:{display:"block","font-size":"12px","margin-top":"8px"}},{default:s(()=>[b(w(t.description),1)]),_:2},1024)):F("",!0)]),_:2},1032,["required","label","name","rules"])),[[ue,A(t)]])),128))]),_:1},8,["model"]))}}),ot=z({__name:"ConnectionHeader",props:{connectorLogoUrl:{},connectorLabel:{}},setup(r){return(i,o)=>(h(),k(a(U),{justify:"center",align:"center",gap:20,style:{"margin-bottom":"24px",padding:"20px 0"}},{default:s(()=>[u(xe,{"hide-text":"",size:"large"}),u(a(Xe),{size:24}),u(Ue,{"image-url":r.connectorLogoUrl,"brand-name":r.connectorLabel,size:"medium","hide-text":""},null,8,["image-url","brand-name"])]),_:1}))}}),lt=z({__name:"ConnectionModal",props:{addingConnection:{},ecdsaPublicKey:{},ecdsaKeyLoading:{type:Boolean},uploadedFiles:{},loading:{type:Boolean}},emits:["cancel","submit","scope-toggle","generate-ecdsa-key","update:token-values","update:uploaded-files","token-change"],setup(r,{emit:i}){const o=r,n=i,c=K(()=>{switch(o.addingConnection?.connector.auth.type){case"oauth2":return f.translate("i18n_connection_modal_button_authorize",null);case"tokens":return f.translate("i18n_connection_modal_button_create",null);case"ecdsa":{if(!o.ecdsaPublicKey)return f.translate("i18n_connection_modal_button_ok",null);const x=o.addingConnection?.connector.auth.params||[],p=o.addingConnection?.tokenValues||{};return x.every(t=>p[t.key]&&p[t.key].trim().length>0)?f.translate("i18n_connection_modal_button_create",null):f.translate("i18n_connection_modal_button_create_missing_fields",null)}default:return f.translate("i18n_connection_modal_button_ok",null)}});function C(){n("cancel")}function A(){n("submit")}function I(_,x){n("scope-toggle",_,x)}function l(){n("generate-ecdsa-key")}function y(_){n("update:token-values",_)}function L(_){n("update:uploaded-files",_)}function N(){n("token-change")}return(_,x)=>(h(),k(a(D),{open:!!r.addingConnection,title:r.addingConnection?a(f).translate("i18n_connection_modal_title_add",null,r.addingConnection.connector.metadata.label):"","ok-text":c.value,"ok-button-props":{disabled:c.value.includes("Required")},"confirm-loading":r.loading,"wrap-class-name":"full-modal",onCancel:C,onOk:A},{default:s(()=>[r.addingConnection?(h(),T(V,{key:0},[u(ot,{"connector-logo-url":r.addingConnection.connector.metadata.logoUrl,"connector-label":r.addingConnection.connector.metadata.label},null,8,["connector-logo-url","connector-label"]),r.addingConnection.connector.auth.type==="oauth2"?(h(),T(V,{key:0},[u(a($),null,{default:s(()=>[b(w(a(f).translate("i18n_connection_modal_oauth2_scopes_instruction",null)),1)]),_:1}),u(a(U),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:s(()=>[(h(!0),T(V,null,R(r.addingConnection.connector.auth.scopes,p=>(h(),k(a(U),{key:p.key,justify:"space-between",align:"center"},{default:s(()=>[u(a(U),{vertical:""},{default:s(()=>[u(a(P),null,{default:s(()=>[b(w(p.description),1)]),_:2},1024),u(a(P),{type:"secondary"},{default:s(()=>[b(w(p.key),1)]),_:2},1024)]),_:2},1024),u(a(ke),{checked:r.addingConnection.selectedScopeIds.includes(p.key),onChange:e=>I(p.key,e)},null,8,["checked","onChange"])]),_:2},1024))),128)),r.addingConnection.connector.auth.params?.length?(h(),k(J,{key:0,tokens:r.addingConnection.connector.auth.params,"token-values":r.addingConnection.tokenValues,"uploaded-files":r.uploadedFiles,"onUpdate:tokenValues":y,"onUpdate:uploadedFiles":L,onTokenChange:N},null,8,["tokens","token-values","uploaded-files"])):F("",!0)]),_:1})],64)):F("",!0),r.addingConnection.connector.auth.type==="tokens"?(h(),T(V,{key:1},[u(a($),null,{default:s(()=>[b(w(a(f).translate("i18n_connection_modal_tokens_instruction",null)),1)]),_:1}),u(J,{tokens:r.addingConnection.connector.auth.tokens,"token-values":r.addingConnection.tokenValues,"uploaded-files":r.uploadedFiles,"onUpdate:tokenValues":y,"onUpdate:uploadedFiles":L,onTokenChange:N},null,8,["tokens","token-values","uploaded-files"])],64)):F("",!0),r.addingConnection.connector.auth.type==="ecdsa"?(h(),T(V,{key:2},[r.ecdsaPublicKey?(h(),k(a(U),{key:1,vertical:"",gap:"16"},{default:s(()=>[u(a(P),{strong:""},{default:s(()=>[b(w(a(f).translate("i18n_connection_modal_ecdsa_keys_generated",null)),1)]),_:1}),u(a(P),{strong:""},{default:s(()=>[b(w(a(f).translate("i18n_connection_modal_ecdsa_copy_public_key",null)),1)]),_:1}),u(a(te),{value:r.ecdsaPublicKey,readonly:"",copyable:"",code:""},null,8,["value"]),u(J,{tokens:r.addingConnection.connector.auth.params,"token-values":r.addingConnection.tokenValues,"uploaded-files":r.uploadedFiles,"onUpdate:tokenValues":y,"onUpdate:uploadedFiles":L,onTokenChange:N},null,8,["tokens","token-values","uploaded-files"])]),_:1})):(h(),T(V,{key:0},[u(a($),null,{default:s(()=>[b(w(a(f).translate("i18n_connection_modal_ecdsa_generate_instruction",null)),1)]),_:1}),u(a(U),{vertical:"",gap:"16"},{default:s(()=>[u(Y,{loading:r.ecdsaKeyLoading,onClick:l},{default:s(()=>[b(w(a(f).translate("i18n_connection_modal_ecdsa_generate_button",null)),1)]),_:1},8,["loading"])]),_:1})],64))],64)):F("",!0)],64)):F("",!0)]),_:1},8,["open","title","ok-text","ok-button-props","confirm-loading"]))}}),st=z({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean},connector:{},isBeta:{type:Boolean}},setup(r){return(i,o)=>(h(),k(a(ie),{class:be({"connector-card":!0,unavailable:r.unavailable})},{default:s(()=>[u(a(U),{style:{width:"100%"},vertical:"",gap:12},{default:s(()=>[u(a(U),{justify:"space-between"},{default:s(()=>[u(a(ae),{src:r.logoUrl,shape:"square",size:"large"},null,8,["src"]),u(a(U),{gap:8},{default:s(()=>[r.isBeta?(h(),k(a(X),{key:0,color:"orange",style:{height:"fit-content"}},{default:s(()=>[...o[0]||(o[0]=[b("BETA",-1)])]),_:1})):F("",!0),r.unavailable?(h(),k(a(X),{key:1,style:{height:"fit-content"}},{default:s(()=>[b(w(a(f).translate("i18n_connector_card_talk_to_us",null)),1)]),_:1})):F("",!0)]),_:1})]),_:1}),u(a(U),{vertical:""},{default:s(()=>[u(a(P),{strong:""},{default:s(()=>[b(w(r.title),1)]),_:1}),u(a(P),{type:"secondary"},{default:s(()=>[b(w(r.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}}),rt=ne(st,[["__scopeId","data-v-86187920"]]),ct={class:"connectors-grid"},ut=z({__name:"ConnectorsView",setup(r){const o=we().params.projectId,n=new nt(o,new Te),c=H(null),C=H(!1),A=H({}),I=H(!1),l=K(()=>[...n.state.value.connectors.filter(g=>g.auth.type==="oauth2"),...n.state.value.connectors.filter(g=>g.auth.type==="tokens"),...n.state.value.connectors.filter(g=>g.auth.type==="ecdsa"),...n.state.value.connectors.filter(g=>g.auth.type==="manual")]),y=H(""),L=K(()=>{if(!y.value.trim())return l.value;const g=y.value.trim().toLowerCase();return l.value.filter(m=>{const v=m.metadata.label?.toLowerCase()||"",S=m.metadata.key?.toLowerCase()||"";return v.includes(g)||S.includes(g)})}),N=K(()=>n.state.value.connections.filter(g=>g&&g.name&&g.connectorTitle&&g.connectorType));n.fetchInitialState();function _(g){return n.state.value.connectors.find(m=>m.metadata.key===g.connectorType)}function x(g){n.state.value.addingConnection&&(n.state.value.addingConnection.tokenValues=g)}function p(g){A.value=g}function e(){c.value=null,C.value=!1,A.value={}}async function t(){C.value=!0;try{const m=(await n.generateEcdsaKey()).replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,"");c.value=m}finally{C.value=!1}}async function d(){const g=n.state.value.addingConnection?.connector.auth.type;I.value=!0;try{switch(g){case"oauth2":return await n.handleAddConnectionSubmit();case"tokens":return await n.handleAddTokenConnectionSubmit();case"ecdsa":{const m=n.state.value.addingConnection?.tokenValues||{},v=n.state.value.addingConnection?.connector.metadata.key;let S="";v==="starkbank"?S=m.projectId||"":v==="iugu"&&(S=m.apiToken||"");const B=await n.handleAddEcdsaConnectionSubmit(c.value,S);return e(),B}default:break}}catch(m){const v=S=>{try{return JSON.parse(S),!0}catch{return!1}};if(m instanceof Error&&v(m.message)){const S=ee.object({error:ee.string()}).safeParse(JSON.parse(m.message));if(S.success){G.error(S.data.error);return}else{G.error(f.translate("i18n_connectorsview_failed_to_create_with_message",void 0,{message:m instanceof Error?m.message:"Unknown error"}));return}}else G.error(f.translate("i18n_connectorsview_failed_to_create"))}finally{I.value=!1}}function E(g){g.auth.type==="manual"?Se.showNewMessage(f.translate("i18n_connectors_ask_for_access",null,g.metadata.label)):n.showAddConfirmationModal(g)}return(g,m)=>(h(),T(V,null,[u(a(Le),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:s(()=>[u(a(U),{align:"center",justify:"space-between"},{default:s(()=>[u(a(q),null,{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_title")),1)]),_:1})]),_:1}),u(a($),null,{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_description"))+" ",1),u(oe)]),_:1}),N.value.length?(h(),k(a(U),{key:0,vertical:""},{default:s(()=>[u(a(q),{level:2},{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_installed")),1)]),_:1}),u(a(U),{vertical:"",gap:10},{default:s(()=>[(h(!0),T(V,null,R(N.value,v=>(h(),k(a(ie),{key:v.name},{default:s(()=>[u(a(U),{align:"center",gap:20},{default:s(()=>[u(a(ae),{src:v.icon,height:"40px",shape:"square"},null,8,["src"]),u(a(P),{strong:""},{default:s(()=>[b(w(v.connectorTitle),1)]),_:2},1024),m[6]||(m[6]=j("div",{style:{"flex-grow":"1"}},null,-1)),u(a(P),{content:v.name,copyable:"",code:""},null,8,["content"]),u(a(Ce),null,{overlay:s(()=>[u(a(_e),null,{default:s(()=>[_(v)?.metadata?.personalizedOption?(h(),k(a(Z),{key:0,onClick:S=>a(n).handlePersonalizedOption(v)},{default:s(()=>[b(w(_(v)?.metadata?.personalizedOption),1)]),_:2},1032,["onClick"])):F("",!0),u(a(Z),{onClick:S=>a(n).handleEditConnectionClick(v)},{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_rename")),1)]),_:1},8,["onClick"]),u(a(Z),{danger:"",onClick:S=>a(n).handleDeletionClick(v)},{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:s(()=>[u(a(Ae))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):F("",!0),u(a(U),{vertical:""},{default:s(()=>[N.value.length?(h(),k(a(q),{key:0,level:2},{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_available")),1)]),_:1})):F("",!0),u(a(Ee),{value:y.value,"onUpdate:value":m[0]||(m[0]=v=>y.value=v),placeholder:a(f).translate("i18n_connectorsview_search_placeholder"),style:{width:"300px","margin-bottom":"40px"}},null,8,["value","placeholder"]),j("div",ct,[(h(!0),T(V,null,R(L.value,v=>(h(),k(rt,{key:v.metadata.key,title:v.metadata.label,"logo-url":v.metadata.logoUrl,description:v.metadata.description,unavailable:v.auth.type==="manual",connector:v,"is-beta":a(n).state.value.betaStatus[v.metadata.key]??!1,onClick:S=>E(v)},null,8,["title","logo-url","description","unavailable","connector","is-beta","onClick"]))),128))])]),_:1})]),_:1}),u(a(D),{open:!!a(n).state.value.editingConnection,title:a(n).state.value.editingConnection?a(f).translate("i18n_connectorsview_connection_modal_title",void 0,{connector:a(n).state.value.editingConnection.connectorTitle}):"",onCancel:m[3]||(m[3]=v=>a(n).state.value.editingConnection=null)},{footer:s(()=>[u(a(U),{justify:"end"},{default:s(()=>[u(Y,{disabled:!a(n).hasChanges.value,onClick:m[2]||(m[2]=v=>a(n).renameConnection())},{default:s(()=>[b(w(a(f).translate("i18n_connectorsview_save")),1)]),_:1},8,["disabled"])]),_:1})]),default:s(()=>[a(n).state.value.editingConnection?(h(),k(a(te),{key:0,value:a(n).state.value.editingConnection.newName,"onUpdate:value":m[1]||(m[1]=v=>a(n).state.value.editingConnection.newName=v)},null,8,["value"])):F("",!0)]),_:1},8,["open","title"]),u(lt,{"adding-connection":a(n).state.value.addingConnection,"ecdsa-public-key":c.value,"ecdsa-key-loading":C.value,"uploaded-files":A.value,loading:I.value,onCancel:m[4]||(m[4]=()=>{a(n).state.value.addingConnection=null,e()}),onSubmit:d,onScopeToggle:m[5]||(m[5]=(v,S)=>a(n).handleScopeToggle(v,S)),onGenerateEcdsaKey:t,"onUpdate:tokenValues":x,"onUpdate:uploadedFiles":p},null,8,["adding-connection","ecdsa-public-key","ecdsa-key-loading","uploaded-files","loading"])],64))}}),At=ne(ut,[["__scopeId","data-v-1f18c7a9"]]);export{At as default};
//# sourceMappingURL=ConnectorsView-C7rfCRU6.js.map

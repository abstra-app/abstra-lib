import{d as F,H as M,r as V,G as Z,a as r,b as u,d2 as v,f as e,w as a,u as b,bu as K,b0 as h,eA as O,eu as U,e as i,ez as ee,c as z,A as te,q as W,J as ae,ex as ue,eB as ne,eC as oe,v as X,ey as de}from"./registerWidgets.e46eca28.js";import{T as _e,a as Q}from"./TabMenuUnderline.c2559a28.js";import{T as pe}from"./tables.072b99a0.js";import{a as le}from"./asyncComputed.15fd30e0.js";import{p as q}from"./popupNotifcation.51171d15.js";import{B as me}from"./BackButton.ff29c188.js";import{n as fe}from"./index.2ced575c.js";import{L as be}from"./CircularLoading.484aa2f6.js";import{w as ve,P as ye}from"./icons.db549bc5.js";import"./gateway.0d210a45.js";import"./passwordlessManager.f4cc4f94.js";import"./pubsub.8f2ecd1e.js";import"./storage.f303ee10.js";import"./activeRecord.d83b1b14.js";import"./lottie.2b81658b.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[d]="27e39d11-e621-4814-8200-caf4ca8bf26c",c._sentryDebugIdIdentifier="sentry-dbid-27e39d11-e621-4814-8200-caf4ca8bf26c")}catch{}})();const ge={class:"table-data"},he={key:1},ke=["onClick"],Ce=i("a",null,"Delete",-1),we=F({__name:"TableData",props:{table:{}},setup(c){var S;const d=c,{result:l,loading:o,refetch:E}=le(()=>d.table.select()),g=M(()=>{var _;return[...(_=d.table)==null?void 0:_.getColumns().map(w=>({title:w.name,dataIndex:w.name})),{title:"Actions",key:"action",fixed:"right",width:100,align:"center"}]}),I=M(()=>{var p;return((p=l.value)==null?void 0:p.map(_=>({key:_.id,..._})))||[]}),D=V(!1),t=V({}),k=()=>{D.value=!0},C=()=>{t.value={},D.value=!1};let N=Z((S=d.table)==null?void 0:S.getUnprotectedColumns().reduce((p,_)=>({...p,[_.name]:""}),{}));async function s(){if(!(!d.table||!N))try{if(t.value.id){await d.table.updateRow(t.value.id,t.value);return}else await d.table.insertRow(t.value);t.value={},E(),C()}catch(p){p instanceof Error&&q("Database error",p.message)}}const T=async p=>{if(!(!l.value||!l.value.find(_=>_.id===p)))try{await d.table.deleteRow(p),E()}catch(_){_ instanceof Error&&q("Database error",_.message)}},B=p=>{var _;t.value=W.exports.pick(W.exports.cloneDeep((_=I.value)==null?void 0:_.filter(w=>p===w.key)[0]),d.table.getColumns().map(w=>w.name)),k()};return(p,_)=>{const w=r("a-divider"),m=r("a-popconfirm"),n=r("a-button"),f=r("a-table"),x=r("a-input"),A=r("a-form-item"),G=r("a-form"),H=r("a-space"),R=r("a-drawer");return u(),v("div",ge,[e(b(te),{theme:{token:{colorPrimary:"#D14056",colorLink:"#D14056"}}},{default:a(()=>[e(f,{columns:g.value,"data-source":I.value,bordered:"",loading:b(o),scroll:{x:2e3,y:720}},{bodyCell:a(({column:$,text:L,record:P})=>[g.value.map(j=>j.title).includes($.dataIndex)?(u(),v(K,{key:0},[h(O(L),1)],64)):U("",!0),$.key==="action"?(u(),v("div",he,[i("span",null,[i("a",{onClick:j=>B(P.id)},"Edit",8,ke)]),e(w,{type:"vertical"}),e(m,{title:"Sure to delete?",onConfirm:j=>T(P.id)},{default:a(()=>[Ce]),_:2},1032,["onConfirm"])])):U("",!0)]),footer:a(()=>[e(n,{type:"primary",onClick:k},{default:a(()=>[h("+ Add New Data")]),_:1})]),_:1},8,["columns","data-source","loading"]),e(R,{title:"Data",width:720,open:D.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:C},{extra:a(()=>[e(H,null,{default:a(()=>[e(n,{onClick:C},{default:a(()=>[h("Cancel")]),_:1}),e(n,{type:"primary",onClick:s},{default:a(()=>[h("Submit")]),_:1})]),_:1})]),default:a(()=>[e(G,{model:t.value,layout:"vertical"},{default:a(()=>[(u(!0),v(K,null,ee(p.table.getUnprotectedColumns(),$=>(u(),z(A,{key:$.id,label:$.name},{default:a(()=>[t.value?(u(),z(x,{key:0,value:t.value[$.name],"onUpdate:value":L=>t.value[$.name]=L},null,8,["value","onUpdate:value"])):U("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})])}}});const se=c=>(ne("data-v-97412eb3"),c=c(),oe(),c),De={class:"table-settings"},xe={key:0},Ie=se(()=>i("span",null," protected ",-1)),Te=[Ie],$e={key:1},Ee=["onClick"],Ne=se(()=>i("a",null,"Delete",-1)),Se=F({__name:"TableColumns",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(c,{emit:d}){var w;const l=c,o=V(l.loading);ae(()=>l.loading,()=>{o.value=l.loading});const E=["varchar","int","boolean","json","date","timestamp","uuid"],g=ue();(w=l.table)==null||w.onUpdate(()=>{var m;g.replace({name:"tableEditor",params:{tableName:(m=l.table)==null?void 0:m.name}})});const D=[...[{title:"Name",dataIndex:"name"},{title:"Type",dataIndex:"type"},{title:"Default Value",dataIndex:"default"},{title:"Nullable",dataIndex:"nullable"},{title:"Primary Key",dataIndex:"primaryKey"}],{title:"Actions",key:"action"}],t=V({name:"",type:"",nullable:!0,unique:!1}),k=()=>{t.value={name:"",type:"",nullable:!0,unique:!1}},C=M(()=>{var m;return(m=l.table)==null?void 0:m.getColumns().map(n=>({name:n.name,type:n.type,default:n.default,nullable:n.nullable,primaryKey:n.primaryKey,id:n.id,unique:n.unique}))}),N=V(!1),s=()=>{N.value=!0},T=()=>{N.value=!1};function B(m){var n,f;(f=(n=l.table)==null?void 0:n.getColumn(m))==null||f.delete(),o.value=!0,setTimeout(()=>{d("refresh")},2e3)}async function S(){var m;if(!!l.table&&!(!t.value.name||!t.value.type)){if(t.value.id){const n=(m=l.table)==null?void 0:m.getColumn(t.value.id);if(!n)return;const{success:f,error:x}=await n.update(t.value);f||q("Database error",x)}else{const{success:n,error:f}=await l.table.addColumn(t.value);n||q("Database error",f)}k(),o.value=!0,T(),setTimeout(()=>{d("refresh")},2e3)}}const p=m=>{var n,f,x;return(x=(f=(n=l.table)==null?void 0:n.getColumn(m))==null?void 0:f.protected)!=null?x:!1},_=m=>{var f;const n=W.exports.cloneDeep((f=C.value)==null?void 0:f.filter(x=>x.id===m));!n||(t.value=n[0],s())};return(m,n)=>{const f=r("a-divider"),x=r("a-popconfirm"),A=r("a-button"),G=r("a-table"),H=r("a-input"),R=r("a-form-item"),$=r("a-select-option"),L=r("a-select"),P=r("a-switch"),j=r("a-form"),re=r("a-space"),ie=r("a-drawer");return u(),v("div",De,[e(b(te),{theme:{token:{colorPrimary:"#D14056",colorLink:"#D14056"}}},{default:a(()=>[e(G,{columns:D,"data-source":C.value,bordered:"",loading:o.value,pagination:!1},{bodyCell:a(({column:y,text:ce,record:J})=>[y.key!=="action"?(u(),v(K,{key:0},[h(O(ce),1)],64)):(u(),v(K,{key:1},[p(J.id)?(u(),v("div",xe,Te)):(u(),v("div",$e,[i("span",null,[i("a",{onClick:()=>_(J.id)},"Edit",8,Ee)]),e(f,{type:"vertical"}),e(x,{title:"Sure to delete?",onConfirm:Xe=>B(J.id)},{default:a(()=>[Ne]),_:2},1032,["onConfirm"])]))],64))]),footer:a(()=>[e(A,{type:"primary",onClick:s},{default:a(()=>[h("+ Add New Column")]),_:1})]),_:1},8,["data-source","loading"]),e(ie,{title:"Column",width:720,open:N.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:T},{extra:a(()=>[e(re,null,{default:a(()=>[e(A,{onClick:T},{default:a(()=>[h("Cancel")]),_:1}),e(A,{type:"primary",onClick:S},{default:a(()=>[h("Submit")]),_:1})]),_:1})]),default:a(()=>[e(j,{model:t.value,layout:"vertical"},{default:a(()=>[e(R,{key:"name",label:"Name"},{default:a(()=>[e(H,{value:t.value.name,"onUpdate:value":n[0]||(n[0]=y=>t.value.name=y)},null,8,["value"])]),_:1}),e(R,{key:"type",label:"Type"},{default:a(()=>[e(L,{value:t.value.type,"onUpdate:value":n[1]||(n[1]=y=>t.value.type=y),"default-active-first-option":""},{default:a(()=>[(u(),v(K,null,ee(E,y=>e($,{key:y,value:y},{default:a(()=>[h(O(y),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),e(R,{key:"nullable",label:"Nullable"},{default:a(()=>[e(P,{checked:t.value.nullable,"onUpdate:checked":n[2]||(n[2]=y=>t.value.nullable=y)},null,8,["checked"])]),_:1}),e(R,{key:"unique",label:"Unique"},{default:a(()=>[e(P,{checked:t.value.unique,"onUpdate:checked":n[3]||(n[3]=y=>t.value.unique=y)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})])}}});const Be=X(Se,[["__scopeId","data-v-97412eb3"]]),Y=c=>(ne("data-v-e02c0171"),c=c(),oe(),c),Re={class:"table-settings"},Ue=Y(()=>i("h2",{class:"title"},"Table settings",-1)),qe=Y(()=>i("div",{class:"subtitle"},"Edit table metadata",-1)),Ae={key:0,class:"table-presenter"},Le={class:"table-property-item"},Pe={class:"property-item"},je={key:1},Ve={class:"change-warning"},Ke={class:"section-title"},Oe=Y(()=>i("div",{class:"section-body"}," Changing the table's name can possibly result in the break of running applications. ",-1)),ze={class:"input-section"},Me={class:"table-name-value-input"},Fe=["value"],Ge={key:0,class:"error"},He={class:"option-buttons"},Je=F({__name:"TableSettings",props:{table:{}},emits:["refresh"],setup(c,{emit:d}){var C,N;const l=c,o=Z({name:(N=(C=l.table)==null?void 0:C.name)!=null?N:"",error:"",editing:!1,loading:!1}),E=()=>o.editing=!0,g=()=>{t(),o.editing=!1,o.error=""},I=async()=>{o.error="",o.loading=!0;try{await D()}catch(s){s instanceof Error&&(q("Database error",s.message),o.error=s.message)}o.error||(o.editing=!1),o.loading=!1},D=async()=>{if(!(!l.table||l.table.name===o.name)){if(!o.name){o.error="Table name cannot be empty";return}l.table.name=o.name;try{await l.table.save(),d("refresh")}catch(s){s instanceof Error&&(q("Database error",s.message),o.error=s.message)}}},t=()=>{var s,T;return o.name=(T=(s=l.table)==null?void 0:s.name)!=null?T:""},k=s=>{o.name=fe(s.target.value,{replacement:"-",lower:!0,strict:!0})};return ae(()=>{var s;return(s=l.table)==null?void 0:s.name},()=>t()),(s,T)=>{var S;const B=r("icon");return u(),v("div",Re,[Ue,qe,o.editing?(u(),v("div",je,[i("div",Ve,[i("div",Ke,[e(B,{path:b(ve),width:"12",height:"12",fill:"#D35249"},null,8,["path"]),h(" Be careful ")]),Oe]),i("div",ze,[i("div",Me,[i("input",{value:o.name,type:"text",onInput:k},null,40,Fe)]),o.error?(u(),v("div",Ge,[e(B,{path:b(ye),fill:"#D35249",width:"12",height:"12"},null,8,["path"]),h(" "+O(o.error),1)])):U("",!0),i("div",He,[i("button",{class:"cancel-button",onClick:g},"Cancel"),i("button",{class:"save-button",onClick:I},[h(" Save Changes "),o.loading?(u(),z(be,{key:0,size:"16"})):U("",!0)])])])])):(u(),v("div",Ae,[i("div",Le,[i("div",Pe,"Name: "+O((S=s.table)==null?void 0:S.name),1)]),i("button",{onClick:E},"Edit Name")]))])}}});const Qe=X(Je,[["__scopeId","data-v-e02c0171"]]),We=F({__name:"TableEditor",setup(c){const d=M(()=>{var t;return`/projects/${(t=g.value)==null?void 0:t.projectId}/tables`}),l=de(),o=l.params.tableId,E=l.params.projectId,{result:g,loading:I,refetch:D}=le(()=>pe.get(E,o));return(t,k)=>(u(),z(_e,{class:"editor"},{left:a(()=>[e(me,{link:d.value},null,8,["link"])]),right:a(()=>[]),default:a(()=>[e(Q,{title:"Data"},{default:a(()=>[b(g)?(u(),z(we,{key:0,loading:b(I),table:b(g)},null,8,["loading","table"])):U("",!0)]),_:1}),e(Q,{title:"Columns"},{default:a(()=>[e(Be,{table:b(g),loading:b(I),onRefresh:k[0]||(k[0]=C=>b(D)())},null,8,["table","loading"])]),_:1}),e(Q,{title:"Settings"},{default:a(()=>[e(Qe,{table:b(g),loading:b(I),onRefresh:k[1]||(k[1]=C=>b(D)())},null,8,["table","loading"])]),_:1})]),_:1}))}});const pt=X(We,[["__scopeId","data-v-0e6176ac"]]);export{pt as default};
//# sourceMappingURL=TableEditor.affbca74.js.map

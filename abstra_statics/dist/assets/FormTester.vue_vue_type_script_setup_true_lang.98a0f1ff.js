import{d as N,r as M,G as Q,b as s,c as v,w as r,f as t,et as S,eA as A,e as V,aI as h,eB as H,u as e,bf as R,bV as I,bW as U,H as D,J,ey as O,c0 as C,eN as z,ev as X,bE as Y}from"./outputWidgets.8a1294ac.js";import{R as Z}from"./SmartConsole.c8a83b1e.js";import{c as ee,A as c}from"./Title.c5e29cf7.js";import{F as L}from"./Form.1860c0ed.js";import{W as ae}from"./workspaces.744a8260.js";import{R as te,F as re}from"./broker.3b899ed7.js";import{a as le}from"./asyncComputed.3699cd44.js";import"./index.04ab96ef.js";import{r as oe}from"./executeJs.af47093a.js";import{_ as ne}from"./StageRunSelector.vue_vue_type_script_setup_true_lang.85b36002.js";import{k as se}from"./icons.25b21aee.js";import"./index.310a46b6.js";import{C as ue,A as ie}from"./CollapsePanel.4c5c4fe6.js";import{A as E}from"./index.bf7f5369.js";import{A as de}from"./index.0f4f2049.js";import{A as me}from"./index.d5d7d1dc.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b=new Error().stack;b&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[b]="d854914a-6ffd-4793-85a0-696afa5401f1",m._sentryDebugIdIdentifier="sentry-dbid-d854914a-6ffd-4793-85a0-696afa5401f1")}catch{}})();const fe="forms_workspace_id_path_key",ce="This path is already being used by another form or dash on your workspace",Be=N({__name:"FormSettings",props:{form:{}},setup(m){const u=M(m.form),n=[{label:"General",props:[{label:"Form name",valueKey:"title"}]},{label:"Welcome Screen",props:[{label:"Title",valueKey:"welcomeTitle"},{label:"Subtitle",valueKey:"startMessage"},{label:"Start button text",valueKey:"startButtonText"}]},{label:"Ending Screen",props:[{label:"Title",valueKey:"endMessage"},{label:"Restart button text",valueKey:"restartButtonText"}]},{label:"Alert Messages",props:[{label:"Error message",valueKey:"errorMessage"}]}],o=Q({pathError:null,sectionsShown:[!0,!1,!1]}),P=k=>{k.detail.includes(fe)&&(o.pathError=ce)};return addEventListener("hasura-error",P),(k,p)=>(s(),v(e(L),{layout:"vertical"},{default:r(()=>[t(Z,{runtime:u.value},null,8,["runtime"]),(s(),S(R,null,A(n,i=>V("div",{key:i.label},[t(e(ee),{level:3},{default:r(()=>[h(H(i.label),1)]),_:2},1024),(s(!0),S(R,null,A(i.props,y=>(s(),v(e(c),{key:y.label,label:y.label},{default:r(()=>[t(e(I),{type:"text",value:u.value[y.valueKey],onChange:x=>u.value[y.valueKey]=x.target.value},null,8,["value","onChange"])]),_:2},1032,["label"]))),128))])),64)),t(e(c),{label:"Start smart form automatically"},{default:r(()=>[t(e(U),{checked:u.value.autoStart,"onUpdate:checked":p[0]||(p[0]=i=>u.value.autoStart=i)},null,8,["checked"])]),_:1}),t(e(c),{label:"Allow the user to restart the smart form after it is over"},{default:r(()=>[t(e(U),{checked:u.value.allowRestart,"onUpdate:checked":p[1]||(p[1]=i=>u.value.allowRestart=i)},null,8,["checked"])]),_:1})]),_:1}))}}),pe={style:{display:"flex","justify-content":"flex-end"}},ve={key:2,style:{height:"600px",margin:"20px","border-radius":"10px",overflow:"hidden"}},w="abstra-run-id",$e=N({__name:"FormTester",props:{form:{},logService:{}},emits:["redirect"],setup(m,{expose:b,emit:u}){var B,$,q,K;const n=m,o=Q({queryParams:[],url:`${n.form.path}`,stageRunId:null}),P=D(()=>`/_editor/${n.form.routeName}/${encodeURIComponent(n.form.path)}/preview?${o.queryParams.map(({name:a,value:d})=>`${a}=${d}`).join("&")}`),k=a=>{o.stageRunId=a},{result:p,loading:i}=le(()=>ae.get()),y=()=>{o.queryParams.push({name:"",value:""})},x=a=>{o.queryParams=o.queryParams.filter((d,l)=>l!==a)};J([()=>o.stageRunId,()=>o.queryParams],([a,d])=>{const l=d.find(f=>f.name===w);if(console.log(a,l),a&&!l){o.queryParams.push({name:w,value:a});return}if(!a&&l){o.queryParams=o.queryParams.filter(f=>f.name!==w);return}a&&l&&a!==l.value&&(l.value=a)});const _=D(()=>te.create({formPath:n.form.path}));(B=_.value)==null||B.on("stdout",a=>{n.logService.log({type:"stdout",log:a.log})}),($=_.value)==null||$.on("stderr",a=>{n.logService.log({type:"stderr",log:a.log})}),(q=_.value)==null||q.onClose(()=>{n.logService.log({type:"stderr",log:"Program closed"})}),(K=_.value)==null||K.on("files:changed",()=>{n.logService.log({type:"files-changed",log:"Files changed"})});const W=O(),j=({path:a})=>{oe("editor",W,a)};function G(a,d){u("redirect",a,d)}const T=M(null);async function F(){var a;return n.logService.log({type:"restart"}),(a=T.value)==null?void 0:a.run()}return b({restart:F}),(a,d)=>(s(),v(e(L),{layout:"vertical"},{default:r(()=>[t(e(E),{orientation:"left"},{default:r(()=>[h("Params")]),_:1}),t(e(c),null,{default:r(()=>[t(ne,{disabled:n.form.isInitial,path:n.form.path,optional:!0,onSelect:d[0]||(d[0]=l=>k(l))},null,8,["disabled","path"])]),_:1}),t(e(c),null,{default:r(()=>[t(e(ue),null,{default:r(()=>[t(e(ie),{header:`Query Params (${o.queryParams.length})`},{default:r(()=>[(s(!0),S(R,null,A(o.queryParams,(l,f)=>(s(),v(e(c),{key:f},{default:r(()=>[t(e(de),null,{default:r(()=>[t(e(I),{value:l.name,"onUpdate:value":g=>l.name=g,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),t(e(I),{value:l.value,"onUpdate:value":g=>l.value=g,type:"text",placeholder:"value",disabled:l.name===w},null,8,["value","onUpdate:value","disabled"]),t(e(C),{danger:"",onClick:g=>x(f)},{default:r(()=>[h("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(e(c),null,{default:r(()=>[t(e(C),{type:"dashed",style:{width:"100%"},onClick:y},{default:r(()=>[h("Add Query Param")]),_:1})]),_:1})]),_:1},8,["header"])]),_:1})]),_:1}),o.stageRunId||n.form.isInitial?(s(),v(e(c),{key:0},{default:r(()=>[V("div",pe,[t(e(C),{href:P.value,style:{display:"flex",align:"center"},target:"_blank"},{default:r(()=>[t(z,{path:e(se),fill:"currentColor"},null,8,["path"]),h(" Open in new tab ")]),_:1},8,["href"])])]),_:1})):X("",!0),t(e(E),{orientation:"left"},{default:r(()=>[h("Quick Preview")]),_:1}),e(i)||!e(p)?(s(),v(e(Y),{key:1})):o.stageRunId||n.form.isInitial?(s(),S("div",ve,[t(re,{ref_key:"runner",ref:T,form:a.form.makeRunnerData(e(p)),params:{...o.queryParams.reduce((l,{name:f,value:g})=>({...l,[f]:g}),{})},"is-preview":"","enable-auto-focus":"",broker:_.value,onNavigate:j,onRedirect:G,onLogout:F},null,8,["form","params","broker"])])):(s(),v(e(me),{key:3,message:"This form is an intermediate task within the workflow. Please select a task instance to initiate the form.",type:"warning","show-icon":""}))]),_:1}))}});export{$e as _,Be as a};
//# sourceMappingURL=FormTester.vue_vue_type_script_setup_true_lang.98a0f1ff.js.map

import{d as q,ex as A,ey as j,G as z,r as _,H as J,b as n,er as I,e as O,u as r,c as p,f as t,w as l,eu as P,bu as Q,cy as U,eD as X,v as Y}from"./registerWidgets.32a97516.js";import{L as Z}from"./CircularLoading.d58b4e70.js";import{E as ee}from"./Error.8e225f9f.js";import{R as re,F as oe}from"./broker.a1a67c55.js";import{_ as te}from"./FormSettings.vue_vue_type_script_setup_true_lang.4eb94256.js";import{T as ae,_ as se,B as ne,a as L}from"./UnsavedChangesHandler.vue_vue_type_script_setup_true_lang.e661cda7.js";import{S as le,L as me}from"./SmartConsole.bb5ce09f.js";import{a as ie}from"./asyncComputed.9b3e19e4.js";import{F as fe}from"./forms.c60c7fb5.js";import{W as ce}from"./workspaces.5df11ee4.js";import{_ as ue}from"./SaveButton.vue_vue_type_script_setup_true_lang.04bc759c.js";import{_ as de}from"./DocsButton.vue_vue_type_script_setup_true_lang.25cff74e.js";import{_ as pe}from"./PreviewButton.vue_vue_type_script_setup_true_lang.5f3d7fb7.js";import{r as S}from"./index.e1500a35.js";import"./passwordlessManager.730dd996.js";import"./pubsub.15b3367b.js";import"./storage.ea1488a3.js";import"./Passwordless.76cdbfc2.js";import"./icons.1657b79d.js";import"./executeJs.3f4b5a2b.js";import"./PlayerNavbar.472c2c1b.js";import"./Steps.3f5a3507.js";import"./Modal.80edabcb.js";import"./WidgetsFrame.f837c65a.js";import"./ActionButton.vue_vue_type_script_setup_true_lang.3d708395.js";import"./Title.fff8b6ce.js";import"./transButton.f078ba96.js";import"./Form.c5db2140.js";import"./dashes.02849cba.js";import"./activeRecord.2e436871.js";import"./hooks.77b24cd0.js";import"./jobs.05cb6223.js";import"./index.335ed09a.js";import"./uuid.6d9f7e28.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[i]="bbb3773c-4377-4aaf-a803-d4c6ecdee28e",m._sentryDebugIdIdentifier="sentry-dbid-bbb3773c-4377-4aaf-a803-d4c6ecdee28e")}catch{}})();const _e={class:"page"},ge={key:1,class:"error"},ye=q({__name:"FormEditor",setup(m){var b,w,C,R;const i=A(),u=j(),g=z({fullscreen:!1,rightPanelCollapsed:!1,hasChanges:!1,started:!1});function $(e,d){S("editor",i,e,d)}addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="s"&&(e.preventDefault(),V())});const N=_(null),y=_(null),{loading:T,result:o,error:v,refetch:M}=ie(()=>Promise.all([ce.get(),fe.get(u.params.formPath)]).then(([e,d])=>X({workspace:e,form:d}))),h=_(!1);async function V(){var e;h.value=!0;try{await((e=o.value)==null?void 0:e.form.save())}finally{h.value=!1}}const s=me.create(),f=J(()=>re.create({formPath:u.params.formPath}));(b=f.value)==null||b.on("stdout",e=>{s.log({type:"stdout",log:e.log})}),(w=f.value)==null||w.on("stderr",e=>{s.log({type:"stderr",log:e.log})}),(C=f.value)==null||C.onClose(()=>{s.log({type:"stderr",log:"Program closed"})}),(R=f.value)==null||R.on("files:changed",()=>{s.log({type:"files-changed",log:"Files changed"})});const G=()=>{s.clear()},k=async()=>{var e;return s.log({type:"restart"}),(e=y.value)==null?void 0:e.run()},H=({path:e})=>{S("editor",i,e)},K=()=>{g.started=!0},W=()=>{g.started=!1};return(e,d)=>{var F,x,B,E,D;return n(),I(Q,null,[O("div",_e,[r(T)||!((F=r(o))!=null&&F.form)||!((x=r(o))!=null&&x.workspace)?(n(),p(Z,{key:0})):r(v)?(n(),I("div",ge,[t(ee,{error:r(v),onReload:r(M)},null,8,["error","onReload"])])):(n(),p(ae,{key:2},{left:l(()=>[t(ne,{link:"/_editor/forms"})]),right:l(()=>[t(r(U),null,{default:l(()=>{var a,c;return[t(de),t(pe,{model:(a=r(o))==null?void 0:a.form},null,8,["model"]),t(ue,{model:(c=r(o))==null?void 0:c.form},null,8,["model"])]}),_:1})]),default:l(()=>[t(L,{title:"Preview"},{default:l(()=>{var a,c;return[t(oe,{ref_key:"runner",ref:y,form:(c=r(o))==null?void 0:c.form.makeRunnerData((a=r(o))==null?void 0:a.workspace),params:r(u).query,"is-preview":!0,"enable-auto-focus":!1,broker:f.value,style:{height:"unset",flex:1,overflow:"hidden"},onNavigate:H,onLogout:k,onExit:W,onStart:K,onRedirect:$},null,8,["form","params","broker"])]}),_:1}),t(L,{title:"Settings"},{default:l(()=>{var a;return[(a=r(o))!=null&&a.form?(n(),p(te,{key:0,class:"settings",form:r(o).form},null,8,["form"])):P("",!0)]}),_:1})]),_:1})),(B=r(o))!=null&&B.form?(n(),p(le,{key:3,ref_key:"smartConsole",ref:N,runtime:"forms","log-service":r(s),onRestart:k,onClearTerminal:G},null,8,["log-service"])):P("",!0)]),t(se,{"has-changes":(D=(E=r(o))==null?void 0:E.form)==null?void 0:D.hasChanges()},null,8,["has-changes"])],64)}}});const Ye=Y(ye,[["__scopeId","data-v-a0fb63f1"]]);export{Ye as default};
//# sourceMappingURL=FormEditor.06b9ea35.js.map

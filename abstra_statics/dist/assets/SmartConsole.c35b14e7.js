var pe=Object.defineProperty;var ve=(s,e,t)=>e in s?pe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var L=(s,e,t)=>(ve(s,typeof e!="symbol"?e+"":e,t),t);import{a as W}from"./asyncComputed.c701d7b0.js";import{F as he}from"./forms.d6fd4b56.js";import{D as fe}from"./dashes.cbc2452d.js";import{H as me}from"./hooks.1c8a8ebc.js";import{J as K}from"./jobs.4af0de33.js";import{W as ge}from"./workspaces.f47922e6.js";import{d as F,H as X,J as $,ez as _e,a as Z,b as d,et as h,f as u,w as S,aT as N,u as l,c as ee,c2 as q,ew as E,e as a,eC as T,bq as te,x as O,r as v,S as J,ey as A,eD as se,eE as ne,eA as ye,K as be,a5 as we,o as Ce,N as ke,I as x,ev as Se,eB as Ie,eO as xe,eP as Ee}from"./outputWidgets.75a5b0b9.js";import{n as Re,e as Ae,s as V,o as j,p as Y,q as $e}from"./icons.c04528be.js";import{c as Te,A as G}from"./Title.b6c9692d.js";import{A as De}from"./index.9c0809a0.js";import{u as P}from"./uuid.6680d6a1.js";import{l as Me}from"./DocsButton.vue_vue_type_script_setup_true_lang.0e30e393.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="332ebc0a-6d10-488b-bdd5-cf8110660071",s._sentryDebugIdIdentifier="sentry-dbid-332ebc0a-6d10-488b-bdd5-cf8110660071")}catch{}})();const Be={class:"file-path"},Le={key:1},Ne=F({__name:"RuntimeCommonSettings",props:{runtime:{}},setup(s){const e=s,t=X({pathError:null}),{result:n}=W(()=>ge.get()),i=()=>{!n.value||!e.runtime.file||n.value.openFile(e.runtime.file)},f=$(()=>{var r;return(r=e.runtime.file)!=null&&r.endsWith(".py")?e.runtime.hasChanges("file")?"The original file will be renamed after saving":null:"It should be a .py file"}),c=()=>{!n.value||!C.value||n.value.openFile(".")},w=_e(),{result:C}=W(()=>fetch("/_editor/api/workspace/root-path").then(r=>r.text()));return e.runtime.onUpdate(r=>{if(e.runtime instanceof K||!r||!("path"in r)||!(r!=null&&r.path))return;const y=[{runtime:he,basePath:"form"},{runtime:me,basePath:"hook"},{runtime:fe,basePath:"dash"}].find(m=>e.runtime instanceof m.runtime);if(!y)throw new Error(`Unknown runtime type ${e.runtime}`);w.push({path:`/_editor/${y.basePath}/${encodeURIComponent(r.path)}`})}),(r,p)=>{const y=Z("icon");return d(),h(te,null,[u(l(Te),{level:3},{default:S(()=>[N("Common")]),_:1}),r.runtime instanceof l(K)?E("",!0):(d(),ee(l(G),{key:0,label:"Path"},{default:S(()=>[u(l(q),{value:r.runtime.path,"onUpdate:value":p[0]||(p[0]=m=>r.runtime.path=m),type:"text"},null,8,["value"])]),_:1})),u(l(De),null,{default:S(()=>[u(l(G),{label:"source code",help:f.value},{default:S(()=>[u(l(q),{value:r.runtime.file,"onUpdate:value":p[3]||(p[3]=m=>r.runtime.file=m),type:"text"},{addonBefore:S(()=>[l(C)?(d(),h("span",{key:0,class:"clickable",onClick:p[1]||(p[1]=m=>c())},[u(y,{class:"clickable",path:l(Re)},null,8,["path"]),a("p",Be,T(l(C)),1)])):E("",!0)]),addonAfter:S(()=>[a("span",{class:"clickable",onClick:p[2]||(p[2]=m=>i())},[u(y,{class:"clickable",path:l(Ae)},null,8,["path"]),N(" Open file ")])]),_:1},8,["value"])]),_:1},8,["help"])]),_:1}),t.pathError?(d(),h("div",Le,T(t.pathError),1)):E("",!0)],64)}}});const mt=O(Ne,[["__scopeId","data-v-4fcb279b"]]);class oe{constructor(){L(this,"logState",X({log:[]}));L(this,"_listeners",{})}static create(){return new oe}get logs(){return this.logState.log}log(e,t){if(e.type!=="restart"&&e.log.trim()==="")return;const n=t?this.logs.find(i=>i.id===t):null;return n?Object.assign(n,e):this.logs.push({...e,id:t||P()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=P();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}}class Pe{static async*sendMessage(e,t){var f;const i=(f=(await fetch("/_editor/api/ai/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,runtime:t})})).body)==null?void 0:f.getReader();if(!i)throw new Error("No response body");for(;;){const c=await i.read();if(c.done)break;yield new TextDecoder().decode(c.value)}}}const Fe=s=>(se("data-v-59ca7295"),s=s(),ne(),s),Oe=Fe(()=>a("div",{class:"text"}," Changes were made in your code. Click Restart to refresh the preview window. ",-1)),Q="ignoreCodeChangesWarning",ze=F({__name:"ChangesWarning",props:{hasChanges:{type:Boolean}},setup(s){var f;const e=s,t=v((f=J.get(Q))!=null?f:!1),n=$(()=>e.hasChanges&&!t.value),i=()=>{J.set(Q,!0),t.value=!0};return(c,w)=>(d(),h("div",{class:A(["changes-warning",{visible:n.value}])},[Oe,a("div",{class:"no-more-alert",onClick:i},"Do not show again")],2))}});const He=O(ze,[["__scopeId","data-v-59ca7295"]]),Ue=s=>(se("data-v-8f2d3c44"),s=s(),ne(),s),We={class:"smart-console"},Ke={class:"header"},qe={class:"left"},Je={class:"right"},Ve={class:"changes-container"},je=["unseen-severity"],Ye={class:"cli"},Ge={class:"left"},Qe=Ue(()=>a("div",{class:"entry ai-output"}," Hello there! I'm both an output console and AI assistant. You can ask me anything. ",-1)),Xe={key:1,class:"local-entry"},Ze={class:"input"},et=["pointer-events","onKeydown"],tt={class:"right"},st=F({__name:"SmartConsole",props:{inputEnabled:{type:Boolean},formCode:{},runtime:{},logService:{}},emits:["eval-request","clear-terminal","restart","enter"],setup(s,{emit:e}){const t=s,n=v(""),i=v(null),f=ye(),c=v({type:"seen"}),w=v(!1),C=v(!1),r=()=>{t.logService.clear(),e("restart")},p=()=>{I.value=I.value==="assistant"?"debugger":"assistant"};function y(o){switch(o.type){case"ai-input":return{role:"user",content:o.log};case"ai-output":return{role:"assistant",content:o.log};case"stderr":case"stdout":return{role:"user",content:o.log};case"restart":return{role:"user",content:"-- new session --"};case"files-changed":return{role:"user",content:"-- files changed --"};default:throw new Error(`Unknown log type: ${o.type}`)}}const m=$(()=>t.logService.logs.some(o=>o.type==="files-changed"));function ae(){b.value=!b.value,b.value&&(c.value={type:"seen"})}be(f,()=>{t.logService.clear(),e("clear-terminal")});const R=v(null),I=v("assistant"),re=async o=>{var _;if(o.preventDefault(),n.value=((_=R.value)==null?void 0:_.innerText)||"",o.shiftKey){document.execCommand("insertLineBreak");return}R.value&&(R.value.innerText=""),I.value==="assistant"?await le():await ie()},le=async()=>{var _;if(e("enter",n.value),t.logService.log({type:"ai-input",log:n.value}),n.value="",!C.value){t.logService.log({type:"stderr",log:"Please login to use the AI assistant."});return}w.value=!0;const o={role:"user",content:(_=t.formCode)!=null?_:""};try{const k=P();let g="";const M=Pe.sendMessage([o,...t.logService.logs.map(B=>y(B)),{role:"user",content:n.value}],t.runtime);for await(const B of M)g+=B,t.logService.log({type:"ai-output",log:g},k)}catch(k){t.logService.log({type:"ai-output",log:"Sorry, I don't know how to answer that."}),console.error(k),Ee(k)}finally{w.value=!1}},ie=async()=>{n.value&&(t.logService.log({type:"eval-input",log:`>>> ${n.value}`}),e("eval-request",n.value),n.value="")},ce=()=>{t.logService.clear()};t.logService.listen(async o=>{b.value||(c.value={type:"unseen",count:c.value.type==="unseen"?c.value.count+1:1,severity:o.type==="stderr"?"error":"info"}),o.type!=="restart"&&(await we(),i.value&&(i.value.scrollTop=i.value.scrollHeight))});const b=v(!1),z=v(400),ue=$(()=>({height:`${z.value}px`})),D=v(!1),de=()=>D.value=!0,H=o=>{!D.value||(z.value=document.body.clientHeight-o.clientY)},U=()=>D.value=!1;return Ce(()=>{document.addEventListener("mousemove",H),document.addEventListener("mouseup",U),Me.get().then(o=>C.value=!!o)}),ke(()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",U)}),(o,_)=>{const k=Z("Markdown");return d(),h("div",We,[a("div",Ke,[a("div",qe,[u(x,{path:I.value==="assistant"?l(V):l(j)},null,8,["path"]),N(" Smart Console ")]),a("div",Je,[a("div",Ve,[u(He,{"has-changes":m.value},null,8,["has-changes"]),a("button",{class:"header-button",onClick:r},"Restart")]),a("div",{class:"toggle-button",onClick:ae},[u(x,{class:A(["icon",{open:b.value}]),path:l(Y),fill:"#fff"},null,8,["class","path"]),c.value.type==="unseen"?(d(),h("div",{key:0,class:"unseen-count","unseen-severity":c.value.severity},T(c.value.count),9,je)):E("",!0)])])]),b.value?(d(),h("div",{key:0,class:"terminal",style:Se(ue.value)},[a("div",{class:"resize-handler",onMousedown:de},null,32),a("div",Ye,[a("div",Ge,[a("div",{ref_key:"entriesContainer",ref:i,class:"entries"},[Qe,(d(!0),h(te,null,Ie(t.logService.logs,(g,M)=>(d(),h("div",{key:M,class:A([g.type,"entry"])},[g.type==="ai-output"?(d(),ee(k,{key:0,source:g.log},null,8,["source"])):(d(),h("div",Xe,T(g.type==="restart"?"-- restarted --":g.log),1))],2))),128))],512),a("div",Ze,[u(x,{class:A(["icon",{open:b.value}]),path:l(Y)},null,8,["class","path"]),a("div",{ref_key:"inputRef",ref:R,class:"input-text",contenteditable:"","pointer-events":w.value?"none":"auto",placeholder:"Ask AI anything",onKeydown:xe(re,["enter"])},null,40,et)])]),a("div",tt,[a("div",{class:"icons",onClick:ce},[u(x,{class:"icon",path:l($e)},null,8,["path"])]),a("div",null,[u(x,{class:"icon clickable",path:I.value==="assistant"?l(V):l(j),onClick:_[0]||(_[0]=g=>p())},null,8,["path"])])])])],4)):E("",!0)])}}});const gt=O(st,[["__scopeId","data-v-8f2d3c44"]]);export{oe as L,mt as R,gt as S};
//# sourceMappingURL=SmartConsole.c35b14e7.js.map

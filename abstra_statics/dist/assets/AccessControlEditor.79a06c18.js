var D=Object.defineProperty;var N=(i,e,o)=>e in i?D(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var S=(i,e,o)=>(N(i,typeof e!="symbol"?e+"":e,o),o);import{C as z}from"./ContentLayout.6c60812b.js";import{l as E}from"./fetch.c78265d5.js";import{E as I}from"./record.3b51fd54.js";import{d as b,D as H,f as y,o as r,Y as p,$ as x,S as C,e8 as q,a as A,c as Z,eg as U,w as l,aG as v,b as n,u as a,bT as O,eb as V,cW as G,e9 as k,aS as M,cV as L,aB as F,ec as W,aW as Y,db as J,cU as K,cT as P,dj as w,de as Q,d7 as X,df as e1,dd as R,dc as t1,F as a1}from"./index.aaa5ea50.js";import{E as s1}from"./repository.da60b145.js";import{a as j}from"./asyncComputed.b796d4e5.js";import{S as o1}from"./SaveButton.01f4cb87.js";import{u as B}from"./editor.e229b63a.js";import{F as r1}from"./PhArrowSquareOut.vue.daa747d5.js";import{A as l1}from"./index.d8518ee8.js";import{i as n1}from"./metadata.9c7505d9.js";import{A as T}from"./index.3b947247.js";import"./gateway.ca8f9e95.js";import"./popupNotifcation.cee72ce4.js";import"./UnsavedChangesHandler.b22124a1.js";import"./ExclamationCircleOutlined.50f8a3ad.js";import"./workspaceStore.60bf67b7.js";import"./url.8dd8ad4c.js";import"./colorHelpers.2c3d5440.js";import"./linters.a3022b0a.js";import"./PhWebhooksLogo.vue.120619c5.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[e]="64e2c1b1-2c6c-4001-985a-ac1369ccd3ec",i._sentryDebugIdIdentifier="sentry-dbid-64e2c1b1-2c6c-4001-985a-ac1369ccd3ec")}catch{}})();const i1=["width","height","fill","transform"],c1={key:0},u1=A("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,187a113.4,113.4,0,0,1-20.39-35h40.82a116.94,116.94,0,0,1-10,20.77A108.61,108.61,0,0,1,128,207Zm-26.49-59a135.42,135.42,0,0,1,0-40h53a135.42,135.42,0,0,1,0,40ZM44,128a83.49,83.49,0,0,1,2.43-20H77.25a160.63,160.63,0,0,0,0,40H46.43A83.49,83.49,0,0,1,44,128Zm84-79a113.4,113.4,0,0,1,20.39,35H107.59a116.94,116.94,0,0,1,10-20.77A108.61,108.61,0,0,1,128,49Zm50.73,59h30.82a83.52,83.52,0,0,1,0,40H178.75a160.63,160.63,0,0,0,0-40Zm20.77-24H173.71a140.82,140.82,0,0,0-15.5-34.36A84.51,84.51,0,0,1,199.52,84ZM97.79,49.64A140.82,140.82,0,0,0,82.29,84H56.48A84.51,84.51,0,0,1,97.79,49.64ZM56.48,172H82.29a140.82,140.82,0,0,0,15.5,34.36A84.51,84.51,0,0,1,56.48,172Zm101.73,34.36A140.82,140.82,0,0,0,173.71,172h25.81A84.51,84.51,0,0,1,158.21,206.36Z"},null,-1),d1=[u1],p1={key:1},h1=A("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),m1=A("path",{d:"M128,24h0A104,104,0,1,0,232,128,104.12,104.12,0,0,0,128,24Zm88,104a87.61,87.61,0,0,1-3.33,24H174.16a157.44,157.44,0,0,0,0-48h38.51A87.61,87.61,0,0,1,216,128ZM102,168H154a115.11,115.11,0,0,1-26,45A115.27,115.27,0,0,1,102,168Zm-3.9-16a140.84,140.84,0,0,1,0-48h59.88a140.84,140.84,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.84a157.44,157.44,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154,88H102a115.11,115.11,0,0,1,26-45A115.27,115.27,0,0,1,154,88Zm52.33,0H170.71a135.28,135.28,0,0,0-22.3-45.6A88.29,88.29,0,0,1,206.37,88ZM107.59,42.4A135.28,135.28,0,0,0,85.29,88H49.63A88.29,88.29,0,0,1,107.59,42.4ZM49.63,168H85.29a135.28,135.28,0,0,0,22.3,45.6A88.29,88.29,0,0,1,49.63,168Zm98.78,45.6a135.28,135.28,0,0,0,22.3-45.6h35.66A88.29,88.29,0,0,1,148.41,213.6Z"},null,-1),g1=[h1,m1],f1={key:2},A1=A("path",{d:"M128,24h0A104,104,0,1,0,232,128,104.12,104.12,0,0,0,128,24Zm78.36,64H170.71a135.28,135.28,0,0,0-22.3-45.6A88.29,88.29,0,0,1,206.37,88ZM216,128a87.61,87.61,0,0,1-3.33,24H174.16a157.44,157.44,0,0,0,0-48h38.51A87.61,87.61,0,0,1,216,128ZM128,43a115.27,115.27,0,0,1,26,45H102A115.11,115.11,0,0,1,128,43ZM102,168H154a115.11,115.11,0,0,1-26,45A115.27,115.27,0,0,1,102,168Zm-3.9-16a140.84,140.84,0,0,1,0-48h59.88a140.84,140.84,0,0,1,0,48Zm50.35,61.6a135.28,135.28,0,0,0,22.3-45.6h35.66A88.29,88.29,0,0,1,148.41,213.6Z"},null,-1),v1=[A1],y1={key:3},Z1=A("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm81.57,64H169.19a132.58,132.58,0,0,0-25.73-50.67A90.29,90.29,0,0,1,209.57,90ZM218,128a89.7,89.7,0,0,1-3.83,26H171.81a155.43,155.43,0,0,0,0-52h42.36A89.7,89.7,0,0,1,218,128Zm-90,87.83a110,110,0,0,1-15.19-19.45A124.24,124.24,0,0,1,99.35,166h57.3a124.24,124.24,0,0,1-13.46,30.38A110,110,0,0,1,128,215.83ZM96.45,154a139.18,139.18,0,0,1,0-52h63.1a139.18,139.18,0,0,1,0,52ZM38,128a89.7,89.7,0,0,1,3.83-26H84.19a155.43,155.43,0,0,0,0,52H41.83A89.7,89.7,0,0,1,38,128Zm90-87.83a110,110,0,0,1,15.19,19.45A124.24,124.24,0,0,1,156.65,90H99.35a124.24,124.24,0,0,1,13.46-30.38A110,110,0,0,1,128,40.17Zm-15.46-.84A132.58,132.58,0,0,0,86.81,90H46.43A90.29,90.29,0,0,1,112.54,39.33ZM46.43,166H86.81a132.58,132.58,0,0,0,25.73,50.67A90.29,90.29,0,0,1,46.43,166Zm97,50.67A132.58,132.58,0,0,0,169.19,166h40.38A90.29,90.29,0,0,1,143.46,216.67Z"},null,-1),H1=[Z1],b1={key:4},w1=A("path",{d:"M128,24h0A104,104,0,1,0,232,128,104.12,104.12,0,0,0,128,24Zm88,104a87.61,87.61,0,0,1-3.33,24H174.16a157.44,157.44,0,0,0,0-48h38.51A87.61,87.61,0,0,1,216,128ZM102,168H154a115.11,115.11,0,0,1-26,45A115.27,115.27,0,0,1,102,168Zm-3.9-16a140.84,140.84,0,0,1,0-48h59.88a140.84,140.84,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.84a157.44,157.44,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154,88H102a115.11,115.11,0,0,1,26-45A115.27,115.27,0,0,1,154,88Zm52.33,0H170.71a135.28,135.28,0,0,0-22.3-45.6A88.29,88.29,0,0,1,206.37,88ZM107.59,42.4A135.28,135.28,0,0,0,85.29,88H49.63A88.29,88.29,0,0,1,107.59,42.4ZM49.63,168H85.29a135.28,135.28,0,0,0,22.3,45.6A88.29,88.29,0,0,1,49.63,168Zm98.78,45.6a135.28,135.28,0,0,0,22.3-45.6h35.66A88.29,88.29,0,0,1,148.41,213.6Z"},null,-1),C1=[w1],_1={key:5},M1=A("path",{d:"M128,28h0A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,190.61c-6.33-6.09-23-24.41-31.27-54.61h62.54C151,194.2,134.33,212.52,128,218.61ZM94.82,156a140.42,140.42,0,0,1,0-56h66.36a140.42,140.42,0,0,1,0,56ZM128,37.39c6.33,6.09,23,24.41,31.27,54.61H96.73C105,61.8,121.67,43.48,128,37.39ZM169.41,100h46.23a92.09,92.09,0,0,1,0,56H169.41a152.65,152.65,0,0,0,0-56Zm43.25-8h-45a129.39,129.39,0,0,0-29.19-55.4A92.25,92.25,0,0,1,212.66,92ZM117.54,36.6A129.39,129.39,0,0,0,88.35,92h-45A92.25,92.25,0,0,1,117.54,36.6ZM40.36,100H86.59a152.65,152.65,0,0,0,0,56H40.36a92.09,92.09,0,0,1,0-56Zm3,64h45a129.39,129.39,0,0,0,29.19,55.4A92.25,92.25,0,0,1,43.34,164Zm95.12,55.4A129.39,129.39,0,0,0,167.65,164h45A92.25,92.25,0,0,1,138.46,219.4Z"},null,-1),V1=[M1],k1={name:"PhGlobe"},$1=b({...k1,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(i){const e=i,o=H("weight","regular"),c=H("size","1em"),g=H("color","currentColor"),f=H("mirrored",!1),t=y(()=>{var s;return(s=e.weight)!=null?s:o}),h=y(()=>{var s;return(s=e.size)!=null?s:c}),d=y(()=>{var s;return(s=e.color)!=null?s:g}),u=y(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(s,m)=>(r(),p("svg",q({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:d.value,transform:u.value},s.$attrs),[x(s.$slots,"default"),t.value==="bold"?(r(),p("g",c1,d1)):t.value==="duotone"?(r(),p("g",p1,g1)):t.value==="fill"?(r(),p("g",f1,v1)):t.value==="light"?(r(),p("g",y1,H1)):t.value==="regular"?(r(),p("g",b1,C1)):t.value==="thin"?(r(),p("g",_1,V1)):C("",!0)],16,i1))}}),S1=["width","height","fill","transform"],P1={key:0},R1=A("path",{d:"M208,76H180V56A52,52,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76ZM100,56a28,28,0,0,1,56,0V76H100ZM204,204H52V100H204Z"},null,-1),j1=[R1],x1={key:1},q1=A("path",{d:"M216,96V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V96a8,8,0,0,1,8-8H208A8,8,0,0,1,216,96Z",opacity:"0.2"},null,-1),B1=A("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"},null,-1),T1=[q1,B1],D1={key:2},N1=A("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},null,-1),z1=[N1],E1={key:3},I1=A("path",{d:"M208,82H174V56a46,46,0,0,0-92,0V82H48A14,14,0,0,0,34,96V208a14,14,0,0,0,14,14H208a14,14,0,0,0,14-14V96A14,14,0,0,0,208,82ZM94,56a34,34,0,0,1,68,0V82H94ZM210,208a2,2,0,0,1-2,2H48a2,2,0,0,1-2-2V96a2,2,0,0,1,2-2H208a2,2,0,0,1,2,2Z"},null,-1),U1=[I1],O1={key:4},G1=A("path",{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Z"},null,-1),L1=[G1],F1={key:5},W1=A("path",{d:"M208,84H172V56a44,44,0,0,0-88,0V84H48A12,12,0,0,0,36,96V208a12,12,0,0,0,12,12H208a12,12,0,0,0,12-12V96A12,12,0,0,0,208,84ZM92,56a36,36,0,0,1,72,0V84H92ZM212,208a4,4,0,0,1-4,4H48a4,4,0,0,1-4-4V96a4,4,0,0,1,4-4H208a4,4,0,0,1,4,4Z"},null,-1),Y1=[W1],J1={name:"PhLockSimple"},K1=b({...J1,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(i){const e=i,o=H("weight","regular"),c=H("size","1em"),g=H("color","currentColor"),f=H("mirrored",!1),t=y(()=>{var s;return(s=e.weight)!=null?s:o}),h=y(()=>{var s;return(s=e.size)!=null?s:c}),d=y(()=>{var s;return(s=e.color)!=null?s:g}),u=y(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:f?"scale(-1, 1)":void 0);return(s,m)=>(r(),p("svg",q({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:h.value,height:h.value,fill:d.value,transform:u.value},s.$attrs),[x(s.$slots,"default"),t.value==="bold"?(r(),p("g",P1,j1)):t.value==="duotone"?(r(),p("g",x1,T1)):t.value==="fill"?(r(),p("g",D1,z1)):t.value==="light"?(r(),p("g",E1,U1)):t.value==="regular"?(r(),p("g",O1,L1)):t.value==="thin"?(r(),p("g",F1,Y1)):C("",!0)],16,S1))}});class ${constructor(e){S(this,"record");this.record=I.from(e)}get id(){return this.record.get("id")}get type(){return this.record.get("type")}get title(){return this.record.get("title")}get isPublic(){return this.record.get("is_public")}set isPublic(e){e&&this.record.set("required_roles",[]),this.record.set("is_public",e)}get requiredRoles(){return this.record.get("required_roles")}set requiredRoles(e){e.length!==0&&this.record.set("is_public",!1),this.record.set("required_roles",e)}makePublic(){this.isPublic=!0}makeProtected(){this.isPublic=!1,this.requiredRoles=[]}require(e){e.length!==0&&(this.isPublic=!1),this.requiredRoles=e}get visibility(){return this.isPublic?"public":"private"}hasChanges(){return this.record.hasChanges("is_public")||this.record.hasChangesDeep("required_roles")}get changes(){return this.record.changes}get initialState(){return this.record.initialState}toUpdateDTO(){return{id:this.id,is_public:this.isPublic,required_roles:this.requiredRoles}}commit(){this.record.commit()}static from(e){return new $(e)}}class Q1{constructor(e=E){this.fetch=e}async list(){return(await(await this.fetch("/_editor/api/access-control",{method:"GET",headers:{"Content-Type":"application/json"}})).json()).map($.from)}async update(e){const o=e.reduce((g,f)=>(f.hasChanges()&&g.push({id:f.id,...f.changes}),g),[]);return await(await fetch("/_editor/api/access-control",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json()}}const X1=A("span",null," Project Roles ",-1),e0=b({__name:"RoleSelector",props:{value:{},roleOptions:{},disabled:{type:Boolean}},emits:["update:value"],setup(i,{emit:e}){const o=i,c=B(),g=t=>{e("update:value",t)},f=b({props:{vnodes:{type:Object,required:!0}},render(){return this.vnodes}});return(t,h)=>(r(),Z(a(F),{value:t.value,mode:"multiple",disabled:t.disabled,"show-arrow":"","onUpdate:value":g},U({dropdownRender:l(({menuNode:d})=>[n(a(f),{vnodes:d},null,8,["vnodes"]),n(a(l1),{style:{margin:"4px 0"}}),a(c).links?(r(),Z(a(O),{key:0,type:"default",style:{display:"flex","align-items":"center","justify-content":"center",width:"100%",gap:"4px"},href:a(c).links.roles,target:"abstra_project"},{default:l(()=>[n(a(r1),{size:"16"}),v(" Manage roles in Cloud Console ")]),_:1},8,["href"])):C("",!0)]),default:l(()=>[n(a(L),null,{label:l(()=>[X1]),default:l(()=>[(r(!0),p(M,null,V(t.roleOptions,d=>(r(),Z(a(G),{key:d,value:d},{default:l(()=>[v(k(d),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:2},[o.disabled?void 0:{name:"placeholder",fn:l(()=>[v(" Leave empty to allow all listed users ")]),key:"0"}]),1032,["value","disabled"]))}}),t0=b({__name:"AccessControlItem",props:{accessControl:{},roles:{}},emits:["update:access-control"],setup(i,{emit:e}){const o=i,c=y(()=>o.roles.map(t=>t.name)),g=t=>{t?o.accessControl.makePublic():o.accessControl.makeProtected(),e("update:access-control",o.accessControl)},f=t=>{o.accessControl.require(t),t.length!==0&&(o.accessControl.isPublic=!1),e("update:access-control",o.accessControl)};return(t,h)=>(r(),Z(a(w),{justify:"space-between",align:"center",gap:"small"},{default:l(()=>[(r(),Z(W(a(n1)(t.accessControl.type)),{style:{"flex-shrink":"0",width:"22px",height:"18px"}})),n(a(J),{style:{width:"300px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}},{default:l(()=>[n(a(Y),{title:t.accessControl.title,placement:"left",open:t.accessControl.title.length>36?void 0:!1},{default:l(()=>[v(k(t.accessControl.title),1)]),_:1},8,["title","open"])]),_:1}),n(a(w),{gap:"large",align:"center"},{default:l(()=>[n(e0,{disabled:t.accessControl.visibility==="public",style:{width:"320px"},value:t.accessControl.requiredRoles||[],"role-options":c.value||[],"onUpdate:value":h[0]||(h[0]=d=>f(d))},null,8,["disabled","value","role-options"]),n(a(K),{value:t.accessControl.visibility},{default:l(()=>[n(a(P),{value:"public",onChange:h[1]||(h[1]=d=>g(!0))},{default:l(()=>[n(a(w),{align:"center",gap:"small"},{default:l(()=>[v(" Public "),n(a($1),{size:14})]),_:1})]),_:1}),n(a(P),{value:"private",onChange:h[2]||(h[2]=d=>g(!1))},{default:l(()=>[n(a(w),{align:"center",gap:"small"},{default:l(()=>[v(" Private "),n(a(K1),{size:14})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}))}}),a0=b({__name:"DanglingRolesAlert",props:{danglingRoles:{}},setup(i){return(e,o)=>(r(),Z(a(T),{type:"warning","show-icon":"",closable:"",style:{margin:"5px"}},{description:l(()=>[n(a(Q),null,{default:l(()=>[v("The following roles are not defined in the Cloud Console:")]),_:1}),(r(!0),p(M,null,V(e.danglingRoles,c=>(r(),Z(a(X),{key:c,style:{margin:"2px"},color:"red"},{default:l(()=>[v(k(c),1)]),_:2},1024))),128))]),_:1}))}}),s0=b({__name:"View",props:{accessControls:{},roles:{},loading:{type:Boolean}},emits:["update:access-controls","save"],setup(i,{emit:e}){const o=i,c=u=>{const s=o.accessControls.findIndex(m=>m.id===u.id);s!==-1&&(o.accessControls[s]=u,e("update:access-controls",[...o.accessControls]))},g=y(()=>{var u;return((u=o.accessControls)==null?void 0:u.filter(s=>s.hasChanges()))||[]}),f=y(()=>g.value.length>0),h={save:async()=>{e("save")},hasChanges:()=>f.value},d=y(()=>{const u=[...new Set(o.accessControls.flatMap(m=>m.requiredRoles)||[])],s=o.roles.map(m=>m.name)||[];return(u==null?void 0:u.filter(m=>!s.includes(m)))||[]});return(u,s)=>(r(),p(M,null,[!u.loading&&d.value.length>0?(r(),Z(a0,{key:0,"dangling-roles":d.value},null,8,["dangling-roles"])):C("",!0),n(o1,{model:h}),n(a(w),{vertical:"",gap:"small",style:{"margin-top":"10px"}},{default:l(()=>[(r(!0),p(M,null,V(u.accessControls,m=>(r(),Z(a(w),{key:m.id},{default:l(()=>[n(t0,{"access-control":m,roles:u.roles,"onUpdate:accessControl":c},null,8,["access-control","roles"])]),_:2},1024))),128))]),_:1})],64))}}),M0=b({__name:"AccessControlEditor",setup(i){const e=B(),o=new Q1,{result:c,refetch:g}=j(async()=>await o.list()),f=y(()=>{var s;return((s=c.value)==null?void 0:s.filter(m=>m.hasChanges()))||[]}),t=async()=>{await o.update(f.value),await g()},h=new s1,{result:d,loading:u}=j(()=>h.list(100,0));return(s,m)=>(r(),Z(z,null,{default:l(()=>[n(a(e1),null,{default:l(()=>[v("Access Control")]),_:1}),n(a(R),null,{default:l(()=>[v(" Set your project\u2019s pages as public, accessible to all users, or restricted to users with specific roles. ")]),_:1}),n(a(R),null,{default:l(()=>{var _;return[v(" Manage users and roles on the cloud's "),n(a(t1),{href:(_=a(e).links)==null?void 0:_.users,target:"abstra_project"},{default:l(()=>[v("Access Control tab")]),_:1},8,["href"]),v(". Settings applied here will be enforced only in the cloud environment. ")]}),_:1}),n(a(T),{style:{width:"fit-content","margin-bottom":"24px"}},{message:l(()=>[v(" You may need to refresh this page to sync the roles with the cloud environment ")]),_:1}),a(c)?(r(),Z(s0,{key:0,"access-controls":a(c),"onUpdate:accessControls":m[0]||(m[0]=_=>a1(c)?c.value=_:null),roles:a(d)||[],loading:a(u),onSave:t},null,8,["access-controls","roles","loading"])):C("",!0)]),_:1}))}});export{M0 as default};
//# sourceMappingURL=AccessControlEditor.79a06c18.js.map

import{d as L,D as F,f as Z,o as d,Y as k,$ as ae,S as A,e8 as te,a as w,e as C,b as a,w as t,u as e,df as V,aG as y,cZ as ge,db as I,cB as M,bL as H,cA as re,aS as x,em as he,en as ye,a0 as O,c as S,by as be,aW as N,cD as ke,bT as P,dj as q,e9 as z,N as oe,O as R,dc as we,cQ as _e,eM as Se,bO as Y,eb as Ae,cN as Me,eo as Ce,ea as He,g as J,eg as Ze,z as Te,a_ as X,a$ as ee,cO as $e}from"./index.94c209a7.js";import{B as Fe}from"./BaseLayout.f0493817.js";import{I as Le,R as Pe,S as Re,E as Ee,a as Ue,b as De,L as Ve}from"./SmartChat.418d1f79.js";import{F as B,a as Ie,b as Be,c as We,d as Ne,r as qe}from"./FormRunner.d4c37352.js";import{a as ze}from"./asyncComputed.828e953e.js";import{F as xe}from"./scripts.7d896150.js";import"./linters.fb9d9248.js";import{W as Oe}from"./workspaces.aa82d064.js";import{A as Qe}from"./index.3a3525fc.js";import{b as je,u as Ge}from"./workspaceStore.adff3c97.js";import{P as Ke}from"./PlayerNavbar.8ee877dd.js";import{W as Ye}from"./PlayerConfigProvider.0d47432f.js";import{C as Je}from"./Card.8cf60f3d.js";import{A as Xe}from"./index.042e04bb.js";import{T as ea}from"./TasksManager.25ca9241.js";import{N as aa}from"./NavbarControls.178e4150.js";import{A as D,T as ta}from"./TabPane.4db78b46.js";import{b as ra}from"./index.800638d0.js";import"./validations.d4b7e0c9.js";import"./string.7befd067.js";import"./editor.de496c21.js";import"./url.9f210000.js";import"./colorHelpers.88596b14.js";import"./uuid.cbb6c523.js";import"./PhCaretRight.vue.395fb402.js";import"./Badge.9f0ddd44.js";import"./LoadingOutlined.4ac32fa6.js";import"./SaveButton.1fb3d9c6.js";import"./UnsavedChangesHandler.9d0d2498.js";import"./ExclamationCircleOutlined.8ea3154e.js";import"./polling.d9629447.js";import"./PhFolder.vue.4237b9b3.js";import"./PhPencil.vue.a19aa3e0.js";import"./toggleHighContrast.cbbd8e69.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.acf14ce7.js";import"./Logo.a21df1a6.js";import"./ai.6ef3bfd9.js";import"./PhCheckCircle.vue.f69ffb48.js";import"./PhCopySimple.vue.fe6ab045.js";import"./Avatar.9665c93a.js";import"./Login.vue_vue_type_script_setup_true_lang.27f02b57.js";import"./CircularLoading.f4e812cf.js";import"./index.f1f6fae9.js";import"./Steps.f0c58ed5.js";import"./index.f5ea7489.js";import"./Watermark.e4842c4f.js";import"./record.c777dbde.js";import"./metadata.5a5f87bc.js";import"./PhWebhooksLogo.vue.da674879.js";import"./PhSignOut.vue.bc5a8ee2.js";import"./index.0e18a82e.js";import"./tasksController.9ada9963.js";import"./gateway.bd8ef7de.js";import"./popupNotifcation.d664aea2.js";import"./ant-design.4620bf89.js";import"./PhArrowSquareOut.vue.49d1be91.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.47ec3c1a.js";import"./index.792c0bee.js";import"./CollapsePanel.e1523bde.js";import"./index.3faea16a.js";import"./CloseCircleOutlined.4c307c4e.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.37645257.js";import"./BookOutlined.44fd6b76.js";import"./PhChats.vue.439f4570.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[c]="725cedc7-fa18-441f-8532-9d4950f1a9ef",h._sentryDebugIdIdentifier="sentry-dbid-725cedc7-fa18-441f-8532-9d4950f1a9ef")}catch{}})();const oa=["width","height","fill","transform"],la={key:0},na=w("path",{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},null,-1),sa=[na],ia={key:1},ua=w("path",{d:"M216,128a88,88,0,1,1-88-88A88,88,0,0,1,216,128Z",opacity:"0.2"},null,-1),da=w("path",{d:"M224,48V96a8,8,0,0,1-8,8H168a8,8,0,0,1,0-16h28.69L182.06,73.37a79.56,79.56,0,0,0-56.13-23.43h-.45A79.52,79.52,0,0,0,69.59,72.71,8,8,0,0,1,58.41,61.27a96,96,0,0,1,135,.79L208,76.69V48a8,8,0,0,1,16,0ZM186.41,183.29a80,80,0,0,1-112.47-.66L59.31,168H88a8,8,0,0,0,0-16H40a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V179.31l14.63,14.63A95.43,95.43,0,0,0,130,222.06h.53a95.36,95.36,0,0,0,67.07-27.33,8,8,0,0,0-11.18-11.44Z"},null,-1),ma=[ua,da],pa={key:2},ca=w("path",{d:"M224,48V96a8,8,0,0,1-8,8H168a8,8,0,0,1-5.66-13.66L180.65,72a79.48,79.48,0,0,0-54.72-22.09h-.45A79.52,79.52,0,0,0,69.59,72.71,8,8,0,0,1,58.41,61.27,96,96,0,0,1,192,60.7l18.36-18.36A8,8,0,0,1,224,48ZM186.41,183.29A80,80,0,0,1,75.35,184l18.31-18.31A8,8,0,0,0,88,152H40a8,8,0,0,0-8,8v48a8,8,0,0,0,13.66,5.66L64,195.3a95.42,95.42,0,0,0,66,26.76h.53a95.36,95.36,0,0,0,67.07-27.33,8,8,0,0,0-11.18-11.44Z"},null,-1),fa=[ca],va={key:3},ga=w("path",{d:"M222,48V96a6,6,0,0,1-6,6H168a6,6,0,0,1,0-12h33.52L183.47,72a81.51,81.51,0,0,0-57.53-24h-.46A81.5,81.5,0,0,0,68.19,71.28a6,6,0,1,1-8.38-8.58,93.38,93.38,0,0,1,65.67-26.76H126a93.45,93.45,0,0,1,66,27.53l18,18V48a6,6,0,0,1,12,0ZM187.81,184.72a81.5,81.5,0,0,1-57.29,23.34h-.46a81.51,81.51,0,0,1-57.53-24L54.48,166H88a6,6,0,0,0,0-12H40a6,6,0,0,0-6,6v48a6,6,0,0,0,12,0V174.48l18,18.05a93.45,93.45,0,0,0,66,27.53h.52a93.38,93.38,0,0,0,65.67-26.76,6,6,0,1,0-8.38-8.58Z"},null,-1),ha=[ga],ya={key:4},ba=w("path",{d:"M224,48V96a8,8,0,0,1-8,8H168a8,8,0,0,1,0-16h28.69L182.06,73.37a79.56,79.56,0,0,0-56.13-23.43h-.45A79.52,79.52,0,0,0,69.59,72.71,8,8,0,0,1,58.41,61.27a96,96,0,0,1,135,.79L208,76.69V48a8,8,0,0,1,16,0ZM186.41,183.29a80,80,0,0,1-112.47-.66L59.31,168H88a8,8,0,0,0,0-16H40a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V179.31l14.63,14.63A95.43,95.43,0,0,0,130,222.06h.53a95.36,95.36,0,0,0,67.07-27.33,8,8,0,0,0-11.18-11.44Z"},null,-1),ka=[ba],wa={key:5},_a=w("path",{d:"M220,48V96a4,4,0,0,1-4,4H168a4,4,0,0,1,0-8h38.34L184.89,70.54A84,84,0,0,0,66.8,69.85a4,4,0,1,1-5.6-5.72,92,92,0,0,1,129.34.76L212,86.34V48a4,4,0,0,1,8,0ZM189.2,186.15a83.44,83.44,0,0,1-58.68,23.91h-.47a83.52,83.52,0,0,1-58.94-24.6L49.66,164H88a4,4,0,0,0,0-8H40a4,4,0,0,0-4,4v48a4,4,0,0,0,8,0V169.66l21.46,21.45A91.43,91.43,0,0,0,130,218.06h.51a91.45,91.45,0,0,0,64.28-26.19,4,4,0,1,0-5.6-5.72Z"},null,-1),Sa=[_a],Aa={name:"PhArrowsClockwise"},Ma=L({...Aa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(h){const c=h,r=F("weight","regular"),g=F("size","1em"),s=F("color","currentColor"),l=F("mirrored",!1),p=Z(()=>{var o;return(o=c.weight)!=null?o:r}),n=Z(()=>{var o;return(o=c.size)!=null?o:g}),b=Z(()=>{var o;return(o=c.color)!=null?o:s}),m=Z(()=>c.mirrored!==void 0?c.mirrored?"scale(-1, 1)":void 0:l?"scale(-1, 1)":void 0);return(o,v)=>(d(),k("svg",te({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:n.value,height:n.value,fill:b.value,transform:m.value},o.$attrs),[ae(o.$slots,"default"),p.value==="bold"?(d(),k("g",la,sa)):p.value==="duotone"?(d(),k("g",ia,ma)):p.value==="fill"?(d(),k("g",pa,fa)):p.value==="light"?(d(),k("g",va,ha)):p.value==="regular"?(d(),k("g",ya,ka)):p.value==="thin"?(d(),k("g",wa,Sa)):A("",!0)],16,oa))}}),Ca=["width","height","fill","transform"],Ha={key:0},Za=w("path",{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm12,76h64a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24Zm80,40H40a12,12,0,0,0,0,24h80a12,12,0,0,0,0-24Zm120.49,20.49a12,12,0,0,1-17,0l-18.08-18.08a44,44,0,1,1,17-17l18.08,18.07A12,12,0,0,1,240.49,200.49ZM184,164a20,20,0,1,0-20-20A20,20,0,0,0,184,164Z"},null,-1),Ta=[Za],$a={key:1},Fa=w("path",{d:"M216,144a32,32,0,1,1-32-32A32,32,0,0,1,216,144Z",opacity:"0.2"},null,-1),La=w("path",{d:"M32,64a8,8,0,0,1,8-8H216a8,8,0,0,1,0,16H40A8,8,0,0,1,32,64Zm8,72h72a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16Zm88,48H40a8,8,0,0,0,0,16h88a8,8,0,0,0,0-16Zm109.66,13.66a8,8,0,0,1-11.32,0L206,177.36A40,40,0,1,1,217.36,166l20.3,20.3A8,8,0,0,1,237.66,197.66ZM184,168a24,24,0,1,0-24-24A24,24,0,0,0,184,168Z"},null,-1),Pa=[Fa,La],Ra={key:2},Ea=w("path",{d:"M32,64a8,8,0,0,1,8-8H216a8,8,0,0,1,0,16H40A8,8,0,0,1,32,64Zm8,72h72a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16Zm88,48H40a8,8,0,0,0,0,16h88a8,8,0,0,0,0-16Zm109.66,2.34L217.36,166A40,40,0,1,0,206,177.36l20.3,20.3a8,8,0,0,0,11.32-11.32Z"},null,-1),Ua=[Ea],Da={key:3},Va=w("path",{d:"M34,64a6,6,0,0,1,6-6H216a6,6,0,0,1,0,12H40A6,6,0,0,1,34,64Zm6,70h72a6,6,0,0,0,0-12H40a6,6,0,0,0,0,12Zm88,52H40a6,6,0,0,0,0,12h88a6,6,0,0,0,0-12Zm108.24,10.24a6,6,0,0,1-8.48,0l-21.49-21.48a38.06,38.06,0,1,1,8.49-8.49l21.48,21.49A6,6,0,0,1,236.24,196.24ZM184,170a26,26,0,1,0-26-26A26,26,0,0,0,184,170Z"},null,-1),Ia=[Va],Ba={key:4},Wa=w("path",{d:"M32,64a8,8,0,0,1,8-8H216a8,8,0,0,1,0,16H40A8,8,0,0,1,32,64Zm8,72h72a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16Zm88,48H40a8,8,0,0,0,0,16h88a8,8,0,0,0,0-16Zm109.66,13.66a8,8,0,0,1-11.32,0L206,177.36A40,40,0,1,1,217.36,166l20.3,20.3A8,8,0,0,1,237.66,197.66ZM184,168a24,24,0,1,0-24-24A24,24,0,0,0,184,168Z"},null,-1),Na=[Wa],qa={key:5},za=w("path",{d:"M36,64a4,4,0,0,1,4-4H216a4,4,0,0,1,0,8H40A4,4,0,0,1,36,64Zm4,68h72a4,4,0,0,0,0-8H40a4,4,0,0,0,0,8Zm88,56H40a4,4,0,0,0,0,8h88a4,4,0,0,0,0-8Zm106.83,6.83a4,4,0,0,1-5.66,0l-22.72-22.72a36.06,36.06,0,1,1,5.66-5.66l22.72,22.72A4,4,0,0,1,234.83,194.83ZM184,172a28,28,0,1,0-28-28A28,28,0,0,0,184,172Z"},null,-1),xa=[za],Oa={name:"PhListMagnifyingGlass"},Qa=L({...Oa,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(h){const c=h,r=F("weight","regular"),g=F("size","1em"),s=F("color","currentColor"),l=F("mirrored",!1),p=Z(()=>{var o;return(o=c.weight)!=null?o:r}),n=Z(()=>{var o;return(o=c.size)!=null?o:g}),b=Z(()=>{var o;return(o=c.color)!=null?o:s}),m=Z(()=>c.mirrored!==void 0?c.mirrored?"scale(-1, 1)":void 0:l?"scale(-1, 1)":void 0);return(o,v)=>(d(),k("svg",te({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:n.value,height:n.value,fill:b.value,transform:m.value},o.$attrs),[ae(o.$slots,"default"),p.value==="bold"?(d(),k("g",Ha,Ta)):p.value==="duotone"?(d(),k("g",$a,Pa)):p.value==="fill"?(d(),k("g",Ra,Ua)):p.value==="light"?(d(),k("g",Da,Ia)):p.value==="regular"?(d(),k("g",Ba,Na)):p.value==="thin"?(d(),k("g",qa,xa)):A("",!0)],16,Ca))}}),le=h=>(he("data-v-b2ed6a6d"),h=h(),ye(),h),ja=le(()=>w("i",null,"string",-1)),Ga=le(()=>w("i",null,"string list",-1)),Ka=L({__name:"FormNotificationSettings",props:{form:{}},setup(h){const r=C(h.form);return(g,s)=>(d(),k(x,null,[a(e(re),{layout:"vertical"},{default:t(()=>[a(e(V),{level:4,width:"100%",height:"30px",style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"0px"}},{default:t(()=>[y(" Thread waiting "),a(e(ge),{checked:r.value.notificationTrigger.enabled,"onUpdate:checked":s[0]||(s[0]=l=>r.value.notificationTrigger.enabled=l)},{default:t(()=>[y(" Enabled ")]),_:1},8,["checked"])]),_:1}),a(e(I),{class:"description",style:{fontStyle:"italic",marginBottom:"20px"}},{default:t(()=>[y(" Send emails when the thread is waiting for the form to be filled ")]),_:1}),a(e(M),{label:"Variable name"},{default:t(()=>[a(e(H),{value:r.value.notificationTrigger.variable_name,"onUpdate:value":s[1]||(s[1]=l=>r.value.notificationTrigger.variable_name=l),disabled:!r.value.notificationTrigger.enabled,type:"text",placeholder:"variable_name"},null,8,["value","disabled"])]),_:1})]),_:1}),a(e(Qe),{type:"info"},{message:t(()=>[a(e(I),null,{default:t(()=>[y(" Notifications are sent to the emails specified in the thread variables set here. The variables should contain a "),ja,y(" or a "),Ga,y(". ")]),_:1})]),_:1})],64))}});const Ya=O(Ka,[["__scopeId","data-v-b2ed6a6d"]]),Ja={class:"form-preview"},Xa={class:"form-preview-container"},et=L({__name:"FormPreview",props:{formState:{},formRunnerData:{},isLoading:{type:Boolean},queryParams:{},disabledWarning:{},controller:{},currentPath:{}},emits:["open-query-params-modal"],setup(h,{emit:c}){const r=h,g=je(),s=Ge(),l=Z(()=>{if(!r.formRunnerData)return"";const n=Object.entries(r.queryParams),b="?"+n.map(([o,v])=>`${o}=${v}`).join("&"),m=n.length?b:"";return`/${r.formRunnerData.path}${m}`}),p=()=>c("open-query-params-modal");return(n,b)=>(d(),k("div",Ja,[n.isLoading||!n.formRunnerData||!n.formState?(d(),S(e(be),{key:0})):A("",!0),n.formState&&n.formRunnerData?(d(),S(e(q),{key:1,vertical:"",gap:"10",style:{height:"100%",overflow:"hidden"}},{default:t(()=>[a(e(q),{gap:"small"},{default:t(()=>[a(e(N),{title:"Edit query params",placement:"bottom"},{default:t(()=>[a(e(ke),{compact:"",style:{display:"flex"},onClick:p},{default:t(()=>{var m,o;return[a(e(H),{disabled:!!n.formState&&e(B).includes((m=n.formState)==null?void 0:m.type),value:l.value,onKeyup:p},null,8,["disabled","value"]),a(e(P),{disabled:!!n.formState&&e(B).includes((o=n.formState)==null?void 0:o.type),onClick:p},{default:t(()=>[a(e(Qa),{size:"20"})]),_:1},8,["disabled"])]}),_:1})]),_:1})]),_:1}),w("div",Xa,[n.disabledWarning?(d(),S(e(Je),{key:0,class:"unsaved-changes"},{default:t(()=>[a(e(I),{style:{"font-size":"18px","font-weight":"500"}},{default:t(()=>[y(z(n.disabledWarning.title),1)]),_:1}),a(e(I),{style:{"margin-bottom":"6px"}},{default:t(()=>[y(z(n.disabledWarning.message),1)]),_:1})]),_:1})):A("",!0),a(Ye,{class:"center","main-color":n.formRunnerData.mainColor,background:n.formRunnerData.theme,"font-family":n.formRunnerData.fontFamily,locale:n.formRunnerData.language},{default:t(()=>{var m,o,v,T,i;return[e(s).state.workspace?(d(),S(Ke,{key:0,"current-path":n.currentPath,"hide-login":!0,"runner-data":e(s).state.workspace},null,8,["current-path","runner-data"])):A("",!0),a(Ie,{"is-preview":"",class:"runner","form-runner-data":n.formRunnerData,"form-state":n.formState,disabled:!!n.disabledWarning,"user-email":e(g).email,onUpdateWidgetErrors:(m=n.controller)==null?void 0:m.updateWidgetFrontendErrors,onUpdateWidgetValue:(o=n.controller)==null?void 0:o.updateWidgetValue,onActionClicked:(v=n.controller)==null?void 0:v.handleActionClick,onAutoFillClicked:(T=n.controller)==null?void 0:T.handleAutofillClick,onAuthComplete:(i=n.controller)==null?void 0:i.handleAuthComplete},null,8,["form-runner-data","form-state","disabled","user-email","onUpdateWidgetErrors","onUpdateWidgetValue","onActionClicked","onAutoFillClicked","onAuthComplete"])]}),_:1},8,["main-color","background","font-family","locale"])])]),_:1})):A("",!0)]))}});const at=O(et,[["__scopeId","data-v-1cb215a9"]]),tt={key:0},rt={key:1},ot=w("br",null,null,-1),lt="Start form",nt=L({__name:"FormRunButton",props:{formStateType:{},disabledWarning:{},startMessage:{}},emits:["start","reset"],setup(h,{emit:c}){var n;const r=new oe(R.boolean(),"dontShowReloadHelper"),g=C((n=r.get())!=null?n:!1),s=()=>{g.value=!0,r.set(!0)},l=()=>c("reset"),p=()=>c("start");return(b,m)=>(d(),k(x,null,[b.formStateType&&e(Be).includes(b.formStateType)?(d(),S(e(_e),{key:0,placement:"bottom",open:g.value?void 0:!0},{content:t(()=>[g.value?(d(),k("span",tt,"Reload form")):(d(),k("span",rt,[y(" You can reload the form here"),ot,a(e(we),{onClick:s},{default:t(()=>[y("Don't show this again")]),_:1})]))]),default:t(()=>[a(e(P),{disabled:!!b.disabledWarning,onClick:l},{default:t(()=>[a(e(Ma),{size:"20"})]),_:1},8,["disabled"])]),_:1},8,["open"])):A("",!0),e(B).includes(b.formStateType)?(d(),S(e(N),{key:1,placement:"bottom"},{title:t(()=>[y("Stop form")]),default:t(()=>[a(e(P),{onClick:l},{default:t(()=>[a(e(Le),{size:"20"})]),_:1})]),_:1})):A("",!0),b.formStateType==="waiting"?(d(),S(e(N),{key:2,placement:"bottom"},{title:t(()=>{var o;return[y(z((o=b.startMessage)!=null?o:lt),1)]}),default:t(()=>[a(e(P),{disabled:!!b.disabledWarning,onClick:p},{default:t(()=>[a(e(Se),{size:"20"})]),_:1},8,["disabled"])]),_:1})):A("",!0)],64))}}),st=L({__name:"FormSettings",props:{form:{}},setup(h){const r=C(h.form);return(g,s)=>(d(),S(e(re),{layout:"vertical",class:"form-settings"},{default:t(()=>[a(Pe,{runtime:r.value},null,8,["runtime"]),a(e(M),{label:"Form name"},{default:t(()=>[a(e(H),{value:r.value.title,"onUpdate:value":s[0]||(s[0]=l=>r.value.title=l),type:"text",onChange:s[1]||(s[1]=l=>{var p;return r.value.title=(p=l.target.value)!=null?p:""})},null,8,["value"])]),_:1}),a(e(V),{level:3},{default:t(()=>[y(" Texts ")]),_:1}),a(e(V),{level:4},{default:t(()=>[y(" Welcome Screen ")]),_:1}),a(e(M),{label:"Title"},{default:t(()=>[a(e(H),{value:r.value.welcomeTitle,"onUpdate:value":s[2]||(s[2]=l=>r.value.welcomeTitle=l),type:"text",placeholder:r.value.title,disabled:r.value.autoStart},null,8,["value","placeholder","disabled"])]),_:1}),a(e(M),{label:"Description"},{default:t(()=>[a(e(H),{value:r.value.startMessage,"onUpdate:value":s[3]||(s[3]=l=>r.value.startMessage=l),type:"text",disabled:r.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(M),{label:"Start button label"},{default:t(()=>[a(e(H),{value:r.value.startButtonText,"onUpdate:value":s[4]||(s[4]=l=>r.value.startButtonText=l),type:"text",placeholder:"Start",disabled:r.value.autoStart},null,8,["value","disabled"])]),_:1}),a(e(M),null,{default:t(()=>[a(e(Y),{checked:r.value.autoStart,"onUpdate:checked":s[5]||(s[5]=l=>r.value.autoStart=l)},{default:t(()=>[y("Skip welcome screen")]),_:1},8,["checked"])]),_:1}),a(e(V),{level:4},{default:t(()=>[y(" End Screen ")]),_:1}),a(e(M),{label:"End text"},{default:t(()=>[a(e(H),{value:r.value.endMessage,"onUpdate:value":s[6]||(s[6]=l=>r.value.endMessage=l),type:"text",placeholder:"Thank you"},null,8,["value"])]),_:1}),a(e(M),{label:"Restart button label"},{default:t(()=>[a(e(H),{value:r.value.restartButtonText,"onUpdate:value":s[7]||(s[7]=l=>r.value.restartButtonText=l),placeholder:"Restart",type:"text",disabled:!r.value.allowRestart},null,8,["value","disabled"])]),_:1}),a(e(M),{help:!r.value.isInitial&&"Only initial forms can be restarted"},{default:t(()=>[a(e(Y),{checked:r.value.allowRestart,"onUpdate:checked":s[8]||(s[8]=l=>r.value.allowRestart=l),disabled:!r.value.isInitial},{default:t(()=>[y("Show restart button at the end")]),_:1},8,["checked","disabled"])]),_:1},8,["help"]),a(e(V),{level:4},{default:t(()=>[y(" Alert Messages ")]),_:1}),a(e(M),{label:"Error message"},{default:t(()=>[a(e(H),{value:r.value.errorMessage,"onUpdate:value":s[9]||(s[9]=l=>r.value.errorMessage=l),type:"text",placeholder:"Something went wrong"},null,8,["value"])]),_:1})]),_:1}))}});const it=O(st,[["__scopeId","data-v-aff64cb2"]]),ut=L({__name:"QueryParamsModal",props:{open:{type:Boolean},queryParams:{}},emits:["update:query-params","close"],setup(h,{emit:c}){const g=C(s(h.queryParams));function s(m){return Object.entries(m).map(([o,v])=>({key:o,value:v,id:Math.random().toString()}))}function l(){const m={};return g.value.forEach(({key:o,value:v})=>{m[o]=v}),m}const p=(m,o,v)=>{g.value[m]={key:o,value:v},c("update:query-params",l())},n=()=>{const m=g.value.length;g.value.push({key:`param-${m}`,value:"value"}),c("update:query-params",l())},b=m=>{g.value.splice(m,1),c("update:query-params",l())};return(m,o)=>(d(),S(e(Me),{open:m.open,onCancel:o[1]||(o[1]=v=>c("close"))},{footer:t(()=>[a(e(P),{type:"primary",onClick:o[0]||(o[0]=v=>c("close"))},{default:t(()=>[y("OK")]),_:1})]),default:t(()=>[a(e(q),{vertical:"",gap:"20"},{default:t(()=>[a(e(I),null,{default:t(()=>[y("Query params")]),_:1}),(d(!0),k(x,null,Ae(g.value,(v,T)=>(d(),S(e(M),{key:T},{default:t(()=>[a(e(Xe),null,{default:t(()=>[a(e(H),{value:v.key,"onUpdate:value":i=>v.key=i,type:"text",placeholder:"name",onChange:()=>p(T,v.key,v.value)},null,8,["value","onUpdate:value","onChange"]),a(e(H),{value:v.value,"onUpdate:value":i=>v.value=i,type:"text",placeholder:"value",onChange:()=>p(T,v.key,v.value)},null,8,["value","onUpdate:value","onChange"]),a(e(P),{danger:"",onClick:i=>b(T)},{default:t(()=>[y("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),a(e(M),null,{default:t(()=>[a(e(P),{type:"dashed",style:{width:"100%"},onClick:n},{default:t(()=>[y(" Add Query Param ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}}),kr=L({__name:"FormEditor",setup(h){const c=Ce(),r=He(),g=new oe(R.array(R.object({formId:R.string(),queryParams:R.record(R.string())})),"abstra:queryParams"),s=C(null),l=C("source-code"),p=C(null),n=C(null),b=C(null),m=C({}),o=Z(()=>{var u;return(u=i.value)!=null&&u.form.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),v=(u,f)=>{var _;(_=s.value)==null||_.setHighlight(u,f)},T=()=>{var u,f;(u=s.value)==null||u.restartEditor(),(f=s.value)==null||f.startPreviewMode()},{result:i,loading:ne,refetch:se}=ze(async()=>{const[u,f]=await Promise.all([xe.get(r.params.id),Oe.get()]),_=g.get();return _==null||_.map($=>{$.formId===u.id&&(m.value=$.queryParams)}),Te({form:u,workspace:f})});J([()=>m,i],()=>{j()});const ie=()=>{var _;if(W.value=!1,!i.value)return;const u=g.get()||[];if(!u.some($=>{var U;return $.formId===((U=i.value)==null?void 0:U.form.id)})){g.set([...u,{formId:(_=i.value)==null?void 0:_.form.id,queryParams:m.value}]);return}g.set(u.map($=>{var U;return $.formId===((U=i.value)==null?void 0:U.form.id)?{formId:$.formId,queryParams:m.value}:$}))};function Q(){var f;if(!i.value)return;const u=i.value.form.codeContent;(f=s.value)==null||f.updateLocalEditorCode(u),j()}function j(){if(!i.value)return;b.value=i.value.form.makeRunnerData(i.value.workspace),p.value=new We({formRunnerData:b.value,logService:K,connectionManager:new Ne(i.value.form.id,"editor",m.value),onFormStart:T,onFormEnd:ue,onRedirect:fe,onStateUpdate:f=>n.value=f,onStackTraceUpdate:v});const u=p.value.getState();n.value=u.formState}const ue=()=>{var u;(u=s.value)==null||u.restartEditor()};async function de(){var u,f,_;(u=G.value)==null||u.closeConsole();try{await((f=i.value)==null?void 0:f.form.save()),Q(),l.value="preview",(_=p.value)==null||_.start()}catch{$e.error({message:"Error saving"})}}function me(){var u,f;(u=s.value)==null||u.restartEditor(),(f=p.value)==null||f.resetForm()}function pe(){c.push({name:"stages"})}const G=C(null),ce=u=>{!i.value||(i.value.form.file=u)},K=Ve.create();function fe(u,f){qe("editor",c,u,f)}const W=C(!1),ve=()=>{var u;!!n.value&&B.includes((u=n.value)==null?void 0:u.type)||(W.value=!0)};J(()=>r.params.id,()=>{se()});const E=u=>{var f;return u!==l.value&&((f=i.value)==null?void 0:f.form.hasChanges())};return(u,f)=>(d(),S(Fe,null,Ze({navbar:t(()=>[e(i)?(d(),S(e(ra),{key:0,title:e(i).form.title,style:{padding:"5px 25px",border:"1px solid #f6f6f6"},onBack:pe},{extra:t(()=>[a(aa,{"docs-path":"concepts/forms","editing-model":e(i).form},null,8,["editing-model"])]),_:1},8,["title"])):A("",!0)]),content:t(()=>[e(i)?(d(),S(Ee,{key:0},{left:t(()=>[a(e(ta),{"active-key":l.value,"onUpdate:activeKey":f[0]||(f[0]=_=>l.value=_)},{rightExtra:t(()=>[a(nt,{"form-state-type":n.value.type,"disabled-warning":null,"start-message":"Save & Start form",onStart:de,onReset:me},null,8,["form-state-type"])]),default:t(()=>[a(e(D),{key:"source-code",tab:"Source code",disabled:E("source-code")},null,8,["disabled"]),a(e(D),{key:"preview",tab:"Preview",disabled:E("preview")},null,8,["disabled"]),a(e(D),{key:"tasks",tab:"Tasks",disabled:E("tasks")},null,8,["disabled"]),a(e(D),{key:"settings",tab:"Settings",disabled:E("settings")},null,8,["disabled"]),a(e(D),{key:"notifications",tab:"Notifications",disabled:E("notifications")},null,8,["disabled"])]),_:1},8,["active-key"]),X(a(Ue,{ref_key:"code",ref:s,script:e(i).form,workspace:e(i).workspace,onUpdateFile:ce,onSave:Q},null,8,["script","workspace"]),[[ee,l.value==="source-code"]]),X(a(at,{"form-state":n.value,"form-runner-data":b.value,"is-loading":e(ne),"disabled-warning":o.value,"current-path":e(i).form.path,"query-params":m.value,controller:p.value,onOpenQueryParamsModal:ve},null,8,["form-state","form-runner-data","is-loading","disabled-warning","current-path","query-params","controller"]),[[ee,l.value==="preview"]]),l.value==="settings"?(d(),S(it,{key:0,form:e(i).form},null,8,["form"])):A("",!0),l.value==="notifications"?(d(),S(Ya,{key:1,form:e(i).form},null,8,["form"])):A("",!0),a(ut,{"query-params":m.value,"onUpdate:queryParams":f[1]||(f[1]=_=>m.value=_),open:W.value,onClose:ie},null,8,["query-params","open"]),l.value==="tasks"?(d(),S(ea,{key:2,"stage-id":e(i).form.id},null,8,["stage-id"])):A("",!0)]),right:t(()=>[a(De,{"stage-type":"forms",workspace:e(i).workspace,stage:e(i).form,"log-service":e(K)},null,8,["workspace","stage","log-service"])]),_:1})):A("",!0)]),_:2},[e(i)?{name:"footer",fn:t(()=>[a(Re,{ref_key:"smartConsole",ref:G,"stage-type":"forms",stage:e(i).form,workspace:e(i).workspace},null,8,["stage","workspace"])]),key:"0"}:void 0]),1024))}});export{kr as default};
//# sourceMappingURL=FormEditor.06fb2266.js.map

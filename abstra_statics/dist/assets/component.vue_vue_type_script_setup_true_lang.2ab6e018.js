import{f as i,ez as O,eZ as z,e_ as V,d as S,o as q,a0 as U,u as n,b as l,c,bu as P,eu as _,a_ as j,eC as $,w as a,t as E,F as B,e as F,eD as m,cm as N,eA as G,ew as I,bS as H,bv as R,bt as Z,I as v,aq as f,cE as k}from"./outputWidgets.0851ae82.js";import{a as M}from"./asyncComputed.27b0faf1.js";import{a as Q}from"./router.e1f24cf8.js";import"./index.1dc7055c.js";import{C as J}from"./gateway.dced9799.js";import{C as X,L as Y,a as K}from"./Log.7c592813.js";import{W as ee}from"./WarningFilled.d99917ef.js";import{d as te}from"./index.6e92e019.js";import{B as ne}from"./BaseLayout.7c10a6b6.js";import{T as re}from"./index.27c92b51.js";import{A as oe}from"./index.293231f4.js";import{c as se}from"./index.8544a4e7.js";import{T as ae,A as ie}from"./TabPane.eb09a59c.js";import{E as le,a as ue,f as ce,j as de,h as pe}from"./icons.fb16824b.js";import{c as y}from"./Text.f84e3eeb.js";import{a as fe,A as me}from"./index.78d35650.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[e]="212adfe4-6bb1-4b33-a561-764e465cd94a",r._sentryDebugIdIdentifier="sentry-dbid-212adfe4-6bb1-4b33-a561-764e465cd94a")}catch{}})();function T(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),o.forEach(function(u){ye(r,u,t[u])})}return r}function ye(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var C=function(e,t){var o=T({},e,t.attrs);return i(O,T({},o,{icon:z}),null)};C.displayName="CloseCircleFilled";C.inheritAttrs=!1;const ge=C;function A(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),o.forEach(function(u){be(r,u,t[u])})}return r}function be(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var w=function(e,t){var o=A({},e,t.attrs);return i(O,A({},o,{icon:V}),null)};w.displayName="LoadingOutlined";w.inheritAttrs=!1;const _e=w;function D(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},o=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),o.forEach(function(u){he(r,u,t[u])})}return r}function he(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var L=function(e,t){var o=D({},e,t.attrs);return i(O,D({},o,{icon:ee}),null)};L.displayName="WarningFilled";L.inheritAttrs=!1;const ve=L;class Ie{list({buildId:e,...t}){return J.post(`builds/${e}/executions`,t)}}const xe=new Ie;class x{constructor(e){this.dto=e}static fromDTO(e){return new x(e)}static async list(e){const t=await xe.list(e);return{total:t.total,executions:t.executions.map(x.fromDTO)}}get id(){return this.dto.executionId}get shortId(){return this.dto.executionId.slice(0,8)}get startTime(){return this.dto.startTime}get startDate(){return new Date(this.dto.startTime)}get endTime(){return this.dto.endTime}get isSuccessful(){return this.dto.isSuccessful}title(e){return this.endTime?"finished":e?"running":"aborted"}}const ke={key:1,class:"flex-row"},Oe={key:2},Se=S({__name:"ExecutionsShort",props:{logQuery:{},isLive:{type:Boolean}},emits:["select"],setup(r,{emit:e}){const t=r,{loading:o,result:u,refetch:h}=M(()=>x.list({buildId:t.logQuery.buildId,runtimeNames:[t.logQuery.runtimeId,t.logQuery.runtimeTitle],limit:5})),g=d=>{e("select",d)};let p=null;return q(()=>{t.isLive&&(p=setInterval(()=>h(),15e3))}),U(()=>{p&&clearInterval(p)}),(d,b)=>n(o)?(l(),c(n(P),{key:0})):n(u)?(l(),_("div",ke,[(l(!0),_(j,null,$(n(u).executions,s=>(l(),c(n(Q),{key:s.id,title:s.title(t.isLive),onClick:W=>g(s)},{default:a(()=>[s.isSuccessful?(l(),c(n(X),{key:0,style:{color:"#33b891"}})):s.endTime?(l(),c(n(ge),{key:1,style:{color:"#fa675c"}})):t.isLive?(l(),c(n(_e),{key:2})):(l(),c(n(ve),{key:3,style:{color:"#f69220"}}))]),_:2},1032,["title","onClick"]))),128))])):(l(),_("div",Oe,"Some error"))}});const je=E(Se,[["__scopeId","data-v-171305bf"]]),Ce=["title"],we=S({__name:"ExecutionInspector",props:{execution:{},projectId:{},buildId:{},isLive:{type:Boolean}},emits:["close"],setup(r,{emit:e}){const t=r,o=B({selectedTab:"logs"}),u=["success","stderr","execution-id","started","client-start","program-start-failed","start","form-response","program:end","failed","connection-closed","stdout","error"],h=te(t.execution.startDate),{loading:g,result:p}=M(async()=>await Y.list({projectId:t.projectId,buildId:t.buildId,executionIds:[t.execution.id],limit:1e3,runtimeNames:[],search:"",offset:0,events:u}));return(d,b)=>(l(),c(n(oe),{open:"",title:`Execution: ${d.execution.shortId}`,width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:b[1]||(b[1]=s=>e("close"))},{extra:a(()=>[F("span",{title:t.execution.startTime}," started "+m(n(h)),9,Ce)]),default:a(()=>[i(ne,null,{navbar:a(()=>[i(n(se),{style:{padding:"5px 10px"}},{footer:a(()=>[i(n(ae),{"active-key":o.selectedTab,"onUpdate:activeKey":b[0]||(b[0]=s=>o.selectedTab=s)},{default:a(()=>[i(n(ie),{key:"logs",tab:"Logs"})]),_:1},8,["active-key"])]),_:1})]),content:a(()=>[n(g)?(l(),c(n(P),{key:0})):n(p)?(l(),c(n(re),{key:1},{default:a(()=>[(l(!0),_(j,null,$(n(p).logs,s=>(l(),c(K,{key:s.createdAt.toTimeString(),log:s},null,8,["log"]))),128))]),_:1})):(l(),c(n(N),{key:2}))]),_:1})]),_:1},8,["title"]))}});const Le=E(we,[["__scopeId","data-v-b0538d08"]]),Te={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={key:1},Re=S({__name:"component",props:{buildSpec:{},subdomain:{},isLive:{type:Boolean}},setup(r){const e=r,t=G(),o=B({execution:null}),u=()=>{o.execution=null},h=d=>{o.execution=d},g=d=>!e.subdomain||d.type!="form"?"":`https://${e.subdomain}.abstra.app/${d.path}`,p=d=>{t.push({name:"logs",params:{projectId:e.buildSpec.projectId},query:d.logQuery})};return(d,b)=>(l(),_(j,null,[d.buildSpec.runtimes.length>0?(l(),c(n(me),{key:0,"item-layout":"horizontal","data-source":d.buildSpec.runtimes},{renderItem:a(({item:s})=>[i(n(fe),null,{actions:a(()=>[i(je,{"log-query":s.logQuery,"project-id":d.buildSpec.projectId,"is-live":e.isLive,onSelect:h},null,8,["log-query","project-id","is-live"]),i(n(H),null,{overlay:a(()=>[i(n(R),null,{default:a(()=>[i(n(Z),{onClick:W=>p(s)},{default:a(()=>[F("div",Te,[i(v,{path:n(le)},null,8,["path"]),i(n(y),null,{default:a(()=>[f(" View Logs")]),_:1})])]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[i(v,{path:n(ue),style:{cursor:"pointer"}},null,8,["path"])]),_:2},1024)]),default:a(()=>[s.type=="form"?(l(),c(n(k),{key:0,size:"large"},{default:a(()=>[i(v,{path:n(ce)},null,8,["path"]),g(s)?(l(),c(n(Q),{key:0,href:g(s),strong:""},{default:a(()=>[f(m(s.title),1)]),_:2},1032,["href"])):(l(),c(n(y),{key:1,strong:""},{default:a(()=>[f(m(s.title),1)]),_:2},1024)),i(n(y),{type:"secondary",code:""},{default:a(()=>[f("/"+m(s.path),1)]),_:2},1024)]),_:2},1024)):I("",!0),s.type=="job"?(l(),c(n(k),{key:1,size:"large"},{default:a(()=>[i(v,{path:n(de)},null,8,["path"]),i(n(y),{strong:""},{default:a(()=>[f(m(s.title),1)]),_:2},1024),i(n(y),{type:"secondary",code:""},{default:a(()=>[f(m(s.schedule),1)]),_:2},1024)]),_:2},1024)):I("",!0),s.type=="hook"?(l(),c(n(k),{key:2,size:"large"},{default:a(()=>[i(v,{path:n(pe)},null,8,["path"]),i(n(y),{strong:""},{default:a(()=>[f(m(s.title),1)]),_:2},1024),i(n(y),{type:"secondary",code:""},{default:a(()=>[f("/_hooks/"+m(s.path),1)]),_:2},1024)]),_:2},1024)):I("",!0)]),_:2},1024)]),_:1},8,["data-source"])):(l(),_("div",Ae,[i(n(N),{description:"No runtimes found. Make sure your project has forms, hooks or jobs before deploying it"})])),o.execution?(l(),c(Le,{key:2,execution:o.execution,"project-id":d.buildSpec.projectId,"build-id":d.buildSpec.buildId,"is-live":e.isLive,onClose:u},null,8,["execution","project-id","build-id","is-live"])):I("",!0)],64))}});export{Re as _};
//# sourceMappingURL=component.vue_vue_type_script_setup_true_lang.2ab6e018.js.map

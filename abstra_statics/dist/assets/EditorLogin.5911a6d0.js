import{N as re}from"./Navbar.8cab351f.js";import{a as N}from"./asyncComputed.c6319089.js";import{m as le}from"./url.9bc6af1d.js";import{d as ie,f as d,e as A,ea as se,o as l,Y as E,b as u,a as ue,u as t,c as s,w as r,by as D,aG as p,e9 as _,eP as i,df as ce,aB as P,cV as m,cW as z,aS as L,eb as T,S as f,cB as v,bL as R,eg as de,bT as pe,cA as _e,a0 as ve}from"./index.73a38d81.js";import{A as ye}from"./apiKey.189ac81b.js";import"./gateway.e9e7eb7d.js";import{M as fe}from"./member.0ad59cd2.js";import{O as ge}from"./organization.de44c370.js";import{P as me}from"./project.7324f194.js";import"./tables.61bdfee3.js";import{F as ze}from"./folder.775af9a4.js";import"./PhChats.vue.0ddbb468.js";import"./PhSignOut.vue.ccc2174a.js";import"./router.4241d0f1.js";import"./Badge.c734bd0c.js";import"./index.2d36535b.js";import"./Avatar.b56b94ed.js";import"./index.1d99cd36.js";import"./index.6a44bd55.js";import"./BookOutlined.0a5325b1.js";import"./popupNotifcation.3e5ffef1.js";import"./record.0e492bf3.js";import"./string.ead22143.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[c]="a4951dd6-7694-41a8-9aaf-d5e9d5e0c8db",y._sentryDebugIdIdentifier="sentry-dbid-a4951dd6-7694-41a8-9aaf-d5e9d5e0c8db")}catch{}})();const je={class:"container"},we={class:"content"},S="NEW_ORGANIZATION_KEY",O="NEW_PROJECT_KEY",be=ie({__name:"EditorLogin",setup(y){const c=new ze,j=new ge,w=new me,U=new fe,{result:x,loading:W}=N(()=>j.list()),{result:Y,loading:b,refetch:G}=N(async()=>{const a=e.value;return a.type!=="selected-organization"?[]:w.list(a.organizationId)}),{result:M,loading:q,refetch:J}=N(async()=>e.value.type!=="selected-organization"?[]:c.list(e.value.organizationId)),F=d(()=>{var a,o;return(o=(a=x.value)==null?void 0:a.map(n=>({key:n.id,label:n.name})))!=null?o:[]}),C=d(()=>{var a,o;return(o=(a=Y.value)==null?void 0:a.map(n=>({key:n.id,label:n.name})))!=null?o:[]}),K=d(()=>{var a,o;return(o=(a=M.value)==null?void 0:a.map(n=>({value:n.id,label:n.name})))!=null?o:[]}),Z=d(()=>e.value.type==="initial"?!0:e.value.type==="new-organization"?!e.value.organizationName||!e.value.project.projectName:e.value.type==="selected-organization"&&e.value.project.type==="new"?!e.value.project.projectName||!e.value.project.folderId:e.value.type==="selected-organization"&&e.value.project.type==="initial"),I=async a=>await ye.create({projectId:a,name:"default"}),e=A({type:"initial"}),Q=d(()=>{if(e.value.type!=="initial")return e.value.type==="new-organization"?S:e.value.organizationId}),H=d(()=>e.value.type==="selected-organization"&&e.value.project.type==="new"?O:e.value.type==="selected-organization"&&e.value.project.type==="selected"?e.value.project.projectId:void 0),X=d(()=>{if(e.value.type==="selected-organization"&&e.value.project.type==="new")return e.value.project.folderId});function $(a){a||(e.value={type:"initial"}),a===S?e.value={type:"new-organization",organizationName:"",project:{type:"new",projectName:"",folderId:""}}:(e.value={type:"selected-organization",organizationId:String(a),project:{type:"initial"}},G()),J()}function ee(a){e.value.type==="selected-organization"&&(a||(e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"initial"}}),a===O?e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"new",projectName:"",folderId:""}}:e.value={type:"selected-organization",organizationId:e.value.organizationId,project:{type:"selected",projectId:String(a)}})}function te(a){e.value.type!=="selected-organization"||e.value.project.type!=="new"||typeof a=="string"&&(e.value={...e.value,project:{...e.value.project,folderId:a}})}async function V(a){const o=await U.list(a);return(await c.list(a)).length===0&&await c.create({name:"Default Folder",organizationId:a,memberIds:[...o.map(oe=>oe.id)]}),(await c.list(a))[0]}const g=A(!1);async function ae(){if(!g.value){g.value=!0;try{if(e.value.type==="initial")return;if(e.value.type==="new-organization"){const a=await j.create({name:e.value.organizationName}),o=await V(a.id),n=await w.create({name:e.value.project.projectName,organizationId:a.id,folderId:o.id}),h=await I(n.id);h.value&&k(h.value)}if(e.value.type==="selected-organization"&&e.value.project.type==="new"){const a=await V(e.value.organizationId),o=await w.create({name:e.value.project.projectName,organizationId:e.value.organizationId,folderId:a.id}),n=await I(o.id);n.value&&k(n.value)}if(e.value.type==="selected-organization"&&e.value.project.type==="selected"){const a=await I(e.value.project.projectId);a.value&&k(a.value)}}finally{g.value=!1}}}const B=se(),ne=A(null);async function k(a){if(B.query.redirect){const o=B.query.redirect;if(!o.match(/http:\/\/localhost:\d+/))throw new Error("Invalid redirect");const n=decodeURIComponent(o);location.href=le(n,{"api-key":a})}else ne.value=a}return(a,o)=>(l(),E("div",je,[u(re),ue("div",we,[t(W)||!t(x)?(l(),s(t(D),{key:0})):(l(),s(t(_e),{key:1,layout:"vertical",class:"card"},{default:r(()=>[u(t(ce),{level:3,style:{padding:"0px",margin:"0px","margin-bottom":"30px"}},{default:r(()=>[p(_(t(i).translate("i18n_create_or_choose_project")),1)]),_:1}),u(t(v),{label:t(i).translate("i18n_get_api_key_organization")},{default:r(()=>[u(t(P),{style:{width:"100%"},placeholder:t(i).translate("i18n_get_api_key_choose_organization"),size:"large",value:Q.value,"onUpdate:value":$},{default:r(()=>[u(t(m),{label:t(i).translate("i18n_get_api_key_new_organization")},{default:r(()=>[(l(),s(t(z),{key:S},{default:r(()=>[p(_(t(i).translate("i18n_get_api_key_create_new_organization")),1)]),_:1}))]),_:1},8,["label"]),F.value.length>0?(l(),s(t(m),{key:0,label:t(i).translate("i18n_get_api_key_existing_organizations")},{default:r(()=>[(l(!0),E(L,null,T(F.value,n=>(l(),s(t(z),{key:n.key},{default:r(()=>[p(_(n.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):f("",!0)]),_:1},8,["placeholder","value"])]),_:1},8,["label"]),e.value.type=="new-organization"?(l(),s(t(v),{key:0,label:t(i).translate("i18n_get_api_key_organization_name")},{default:r(()=>[u(t(R),{value:e.value.organizationName,"onUpdate:value":o[0]||(o[0]=n=>e.value.organizationName=n),placeholder:t(i).translate("i18n_get_api_key_choose_organization_name"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"])):(l(),s(t(v),{key:1,label:t(i).translate("i18n_get_api_key_project")},{default:r(()=>[u(t(P),{style:{width:"100%"},disabled:e.value.type!="selected-organization",placeholder:t(i).translate("i18n_get_api_key_choose_project"),size:"large",value:H.value,"onUpdate:value":ee},de({default:r(()=>[t(b)?f("",!0):(l(),s(t(m),{key:0,label:t(i).translate("i18n_get_api_key_new_project")},{default:r(()=>[(l(),s(t(z),{key:O},{default:r(()=>[p(_(t(i).translate("i18n_get_api_key_create_new_project")),1)]),_:1}))]),_:1},8,["label"])),C.value.length>0&&!t(b)?(l(),s(t(m),{key:1,label:t(i).translate("i18n_get_api_key_existing_projects")},{default:r(()=>[(l(!0),E(L,null,T(C.value,n=>(l(),s(t(z),{key:n.key},{default:r(()=>[p(_(n.label),1)]),_:2},1024))),128))]),_:1},8,["label"])):f("",!0)]),_:2},[t(b)?{name:"notFoundContent",fn:r(()=>[u(t(D),{size:"small"})]),key:"0"}:void 0]),1032,["disabled","placeholder","value"])]),_:1},8,["label"])),(e.value.type=="new-organization"||e.value.type=="selected-organization")&&e.value.project.type=="new"?(l(),s(t(v),{key:2,label:"Project name"},{default:r(()=>[u(t(R),{value:e.value.project.projectName,"onUpdate:value":o[1]||(o[1]=n=>e.value.project.projectName=n),placeholder:t(i).translate("i18n_get_api_key_choose_project_name"),size:"large"},null,8,["value","placeholder"])]),_:1})):f("",!0),(e.value.type=="new-organization"||e.value.type=="selected-organization")&&e.value.project.type=="new"&&K.value.length>0?(l(),s(t(v),{key:3,label:"Select folder"},{default:r(()=>[u(t(P),{value:X.value,options:K.value,loading:t(q),size:"large","onUpdate:value":te},null,8,["value","options","loading"])]),_:1})):f("",!0),u(t(v),{style:{"margin-top":"40px"}},{default:r(()=>[u(t(pe),{type:"primary",disabled:Z.value,loading:g.value,style:{width:"100%"},onClick:ae},{default:r(()=>[p(_(t(i).translate("i18n_login_with_this_project")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))])]))}});const Me=ve(be,[["__scopeId","data-v-439384bd"]]);export{Me as default};
//# sourceMappingURL=EditorLogin.5911a6d0.js.map

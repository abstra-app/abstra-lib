var F=Object.defineProperty;var V=(n,e,o)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var k=(n,e,o)=>(V(n,typeof e!="symbol"?e+"":e,o),o);import{d as S,F as R,b as C,c as g,w as l,f as s,u as a,bO as _,aq as v,cC as E,bH as $,ad as B,eB as O,r as G,G as Q,ev as z,ex as H,bq as T}from"./outputWidgets.2e02c315.js";import{u as W,o as J}from"./icons.c9ffa0e2.js";import{a as K}from"./asyncComputed.4a119ad0.js";import{z as r}from"./index.cf4c23b9.js";import{A as I}from"./FormItem.3c08c651.js";import{F as P}from"./Form.c3ceca07.js";import{A as N}from"./index.e973596c.js";import"./authorManager.aeaa90bf.js";import{C as b}from"./gateway.b0bf75e4.js";import"./index.9a3dfc21.js";import{C as X}from"./CrudView.8f4637af.js";import{p as x}from"./popupNotifcation.e090e1e3.js";import"./hasIn.77fd7b18.js";import"./isNumeric.75337b1e.js";import"./record.abea3cf4.js";import"./pubsub.572a1ca9.js";import"./Title.cbf7e97b.js";import"./Text.a8774948.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.4a30f44f.js";import"./router.10f8db1b.js";import"./index.5de6c5f5.js";import"./url.e412517c.js";import"./index.44763224.js";import"./index.7c46b46a.js";import"./index.d4eff2ed.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="b4e6497b-19e5-4dda-849b-87d7bc298eb9",n._sentryDebugIdIdentifier="sentry-dbid-b4e6497b-19e5-4dda-849b-87d7bc298eb9")}catch{}})();class Y{constructor(){k(this,"urlPath","users")}async create(e,o){return b.post(`projects/${e}/${this.urlPath}`,o)}async delete(e,o){await b.delete(`projects/${e}/${this.urlPath}/${o}`)}async list(e,{limit:o,offset:t}){const i=new URLSearchParams({limit:o.toString(),offset:t.toString()});return b.get(`projects/${e}/${this.urlPath}?${i.toString()}`)}async update(e,o,t){return b.patch(`projects/${e}/${this.urlPath}/${o}`,t)}}const w=new Y;class h{constructor(e){this.dto=e}static async list(e,o,t){return(await w.list(e,{limit:o,offset:t})).map(d=>new h(d))}static async create(e,o){const t=await w.create(e,o);return new h(t)}async delete(){await w.delete(this.projectId,this.id)}async change(e){this.roles=e.roles,await w.update(this.projectId,this.id,e)}get id(){return this.dto.id}get email(){return this.dto.email}get projectId(){return this.dto.projectId}get roles(){return this.dto.roles}set roles(e){this.dto.roles=e}}const Z=r.string(),M=r.string();r.object({authorId:Z,projectId:M});const ee=r.string(),q=r.string(),te=["workflow_viewer"],oe=r.literal("workflow_viewer"),j=r.array(oe),ae=r.string(),re=r.string(),se=r.object({id:ee,email:q,roles:j,projectId:ae,createdAt:re}),le=r.string(),ne=r.string();r.object({url:le,buildId:ne});const ie=j;r.object({roles:ie});const ce=r.number(),ue=r.number();r.object({offset:ce,limit:ue});const de=se;r.array(de);const me=q,pe=j;r.object({email:me,roles:pe});const fe=S({__name:"NewUser",emits:["created","cancel"],setup(n,{emit:e}){const o=te.map(p=>({label:p,value:p})),t=R({email:"",roles:[]});function i(){e("cancel")}function d(){!t.email||e("created",t)}return(p,f)=>(C(),g(a(N),{open:"",title:"New user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:i},{extra:l(()=>[s(a(E),null,{default:l(()=>[s(a(_),{onClick:i},{default:l(()=>[v("Cancel")]),_:1}),s(a(_),{type:"primary",onClick:d},{default:l(()=>[v("Submit")]),_:1})]),_:1})]),default:l(()=>[s(a(P),{model:t,layout:"vertical"},{default:l(()=>[s(a(I),{key:"email",label:"Email",required:!0},{default:l(()=>[s(a($),{value:t.email,"onUpdate:value":f[0]||(f[0]=m=>t.email=m)},null,8,["value"])]),_:1}),s(a(I),{key:"role",label:"Role"},{default:l(()=>[s(a(B),{value:t.roles,"onUpdate:value":f[1]||(f[1]=m=>t.roles=m),mode:"multiple",options:a(o)},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),ye=S({__name:"UpdateUser",props:{roles:{},email:{}},emits:["updated","cancel"],setup(n,{emit:e}){const o=n,t=[{value:"workflow_viewer",label:"Workflow viewer"}],i=R({roles:o.roles});function d(){e("cancel")}function p(){e("updated",i)}return(f,m)=>(C(),g(a(N),{open:"",title:"Update user",width:720,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:d},{extra:l(()=>[s(a(E),null,{default:l(()=>[s(a(_),{onClick:d},{default:l(()=>[v("Cancel")]),_:1}),s(a(_),{type:"primary",onClick:p},{default:l(()=>[v("Submit")]),_:1})]),_:1})]),default:l(()=>[s(a(P),{model:i,layout:"vertical"},{default:l(()=>[s(a(I),{key:"email",label:"Email"},{default:l(()=>[s(a($),{value:o.email,disabled:""},null,8,["value"])]),_:1}),s(a(I),{key:"role",label:"Role"},{default:l(()=>[s(a(B),{value:i.roles,"onUpdate:value":m[0]||(m[0]=U=>i.roles=U),mode:"multiple",options:t},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),Ge=S({__name:"Users",setup(n){const o=O().params.projectId,t=G({type:"none"}),i=()=>{t.value.type="none"},d=()=>{t.value.type="new"},p=c=>{t.value={type:"edit",user:c}},f=async c=>{try{await h.create(o,c),i(),A()}catch(u){u instanceof Error&&x("Create Error",u.message)}},m=async c=>{try{if(t.value.type!=="edit")return;t.value.user.roles=c.roles,await t.value.user.change(c),i(),A()}catch(u){u instanceof Error&&x("Update Error",u.message)}},{loading:U,result:D,refetch:A}=K(()=>h.list(o,100,0)),L=Q(()=>{var c,u;return{columns:[{name:"Email"},{name:"Roles"},{name:"Actions",align:"right"}],rows:(u=(c=D.value)==null?void 0:c.map(y=>({key:y.email,cells:[{text:y.email},{text:y.roles.join(", ")},{text:"",actions:[{icon:W,label:"Edit",onClick:()=>p(y)},{icon:J,label:"Delete",onClick:async()=>{await y.delete(),A()}}]}]})))!=null?u:[]}});return(c,u)=>(C(),z(T,null,[s(X,{"entity-name":"users",loading:a(U),title:"Application users",description:"List all application users.","empty-title":"No users yet",table:L.value,"create-button-text":"Add users",onCreate:d},null,8,["loading","table"]),t.value.type==="new"?(C(),g(fe,{key:0,onCancel:i,onCreated:f})):t.value.type==="edit"?(C(),g(ye,{key:1,email:t.value.user.email,roles:t.value.user.roles,onUpdated:m,onCancel:i},null,8,["email","roles"])):H("",!0)],64))}});export{Ge as default};
//# sourceMappingURL=Users.036f4169.js.map

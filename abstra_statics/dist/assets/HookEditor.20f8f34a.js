import{a as L}from"./asyncComputed.82e95638.js";import{d as x,c as S,o as i,a as g,b as a,f as o,u as t,bI as P,cw as v,d6 as Y,g as p,ec as R,d7 as $,h as w,cv as H,N as n,L as X,ad as Z,r as O,k as K,j as ee,aU as te,bQ as q,eM as oe,Y as B,f4 as ae,db as E,W as C,eb as D,aQ as T,cB as I,aA as re,e as se,d1 as le,M as ne,cE as ue,e4 as ie,e5 as de,es as pe}from"./jwt-decode.esm.d8763b5b.js";import"./linters.17034461.js";import{H as me}from"./scripts.f1def2fe.js";import{W as fe}from"./workspaces.de471929.js";import{R as ce,_ as ye}from"./RuntimeCommonSettings.08d97c52.js";import{u as he}from"./editor.cc0fbe0b.js";import{_ as ve}from"./RunButton.vue_vue_type_script_setup_true_lang.f87a9b4f.js";import{A as ge,D as ke}from"./index.e8ca7b36.js";import{C as be,A as U}from"./CollapsePanel.b73b2806.js";import{A as J}from"./index.f7eb7d63.js";import{A as _e}from"./index.2741bd9e.js";import"./record.19092615.js";import"./runnerData.8197ed0d.js";import"./url.b9e61201.js";import"./colorHelpers.aaea5d39.js";import"./BaseLayout.0180af8a.js";import"./SaveButton.bd655e5f.js";import"./UnsavedChangesHandler.b5421034.js";import"./ExclamationCircleOutlined.663513a4.js";import"./omniChatStore.b69b1ac5.js";import"./OmniChat.343798c1.js";import"./gateway.ecde0932.js";import"./popupNotifcation.7f1daeb6.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.821d7c5c.js";import"./Logo.baae960b.js";import"./uuid.6121747a.js";import"./PhCopy.vue.75c95328.js";import"./PhClockCounterClockwise.vue.80c5cc07.js";import"./LoadingOutlined.9c1aadec.js";import"./project.990fcd26.js";import"./tables.d5427d80.js";import"./string.3420fdec.js";import"./controller.242dbe0f.js";import"./index.22f12f6c.js";import"./validations.4e5a0aba.js";import"./metadata.513bbe10.js";import"./PhWebhooksLogo.vue.709f8213.js";import"./controller.bc4e7bfc.js";import"./fetch.947117c9.js";import"./PhPencil.vue.c7189a48.js";import"./requirements.f30bb9d7.js";import"./object.bdbfa151.js";import"./PhCopySimple.vue.8a8ba3bb.js";import"./index.57aaba32.js";import"./Avatar.53402d46.js";import"./Navbar.71c032c5.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.3bb0a359.js";import"./constants.a1417080.js";import"./PhArrowCounterClockwise.vue.93ba5f3a.js";import"./PhFilePy.vue.1f43d7bb.js";import"./PhChats.vue.f8f90727.js";import"./PhRocket.vue.0c254896.js";import"./PhPackage.vue.8bf7b48d.js";import"./userStore.3dd5baf4.js";import"./polling.92851069.js";import"./PhArrowSquareOut.vue.c07b32d9.js";import"./PhDotsThree.vue.c96f87ab.js";import"./PhSignOut.vue.4455c8fa.js";import"./PhSparkle.vue.d75f641e.js";import"./CloseCircleOutlined.22d02333.js";import"./CheckCircleFilled.88a2ed9d.js";import"./index.ffbfa13f.js";import"./SourceCode.e3cb0f5e.js";import"./PhFolder.vue.5e7ade12.js";import"./toggleHighContrast.2057d1be.js";import"./Card.d9d1f8ed.js";import"./TabPane.382e7070.js";import"./TasksManager.b4528bc3.js";import"./tasksController.510288e4.js";import"./ant-design.45c13f7b.js";import"./PhCaretRight.vue.223c1745.js";import"./Badge.8e0c0079.js";import"./workspaceStore.e29351e7.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[c]="73d18a16-573a-4b7b-a91e-4df5c5120505",f._sentryDebugIdIdentifier="sentry-dbid-73d18a16-573a-4b7b-a91e-4df5c5120505")}catch{}})();const qe=x({__name:"HookSettings",props:{hook:{}},setup(f){const c=f,{publicUrl:y}=he(),b=S(()=>!y||!c.hook.path?"":`${y}/_hooks/${c.hook.path}`);return(k,m)=>(i(),g(t(H),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:a(()=>[o(t(v),{label:"Name",required:""},{default:a(()=>[o(t(P),{value:k.hook.title,"onUpdate:value":m[0]||(m[0]=d=>k.hook.title=d)},null,8,["value"])]),_:1}),o(ce,{runtime:k.hook},null,8,["runtime"]),b.value?(i(),g(t(Y),{key:0},{default:a(()=>[p(" You can test this hook locally while the server is running sending a request to "),o(t($),{code:"",copyable:""},{default:a(()=>[p(R(b.value),1)]),_:1})]),_:1})):w("",!0)]),_:1}))}}),Pe={style:{display:"flex","flex-direction":"column",gap:"10px"}},we={key:0},Ce=x({__name:"HookTester",props:{hook:{},disabledWarning:{}},setup(f,{expose:c}){const y=f,b=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],k=S(()=>{var l;if((l=e.response)!=null&&l.status)return e.response.status>=500?"red":e.response.status>=400?"orange":e.response.status>=200?"green":"blue"}),m=n.object({method:n.string(),body:n.string(),queryParams:n.record(n.string()),headers:n.record(n.string())}),d=new X(n.record(n.object({body:n.string(),headers:n.array(n.object({key:n.string(),value:n.string()})),method:n.string(),queryParams:n.array(n.object({name:n.string(),value:n.string()}))})),"abstra:hookTestConfig"),e=Z({queryParams:[],headers:[{key:"Content-Type",value:"application/json"}],method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4),requestDataInput:JSON.stringify({method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4),queryParams:{},headers:{"Content-Type":"application/json"}},null,4)}),_=O(!1),N=async()=>{_.value=!0;try{const l={method:e.method,query:e.queryParams.reduce((r,{name:s,value:u})=>(s&&u&&(r[s]=u),r),{}),body:e.body,headers:e.headers.reduce((r,{key:s,value:u})=>(s&&u&&(r[s]=u),r),{})};e.response=await y.hook.run(l)}finally{_.value=!1}},A=O(!1),Q=()=>{A.value=!0},j=()=>{A.value=!1},M=S(()=>{if(typeof e.requestDataInput!="string")return!1;try{const l=JSON.parse(e.requestDataInput);return m.parse(l),!0}catch{return!1}}),W=()=>{const l=JSON.parse(e.requestDataInput);e.method=l.method||e.method,e.body=l.body||e.body,e.queryParams=Object.entries(l.queryParams||e.queryParams).map(([r,s])=>({name:r,value:String(s)})),e.headers=Object.entries(l.headers||e.headers).map(([r,s])=>({key:r,value:String(s)})),j(),ue.success("Request data imported successfully")},V=()=>{e.queryParams.push({name:"",value:""})},F=l=>{e.queryParams=e.queryParams.filter((r,s)=>s!==l)},G=()=>{e.headers.push({key:"",value:""})},z=l=>{e.headers=e.headers.filter((r,s)=>s!==l)};return K(()=>{const r=(d.get()||{})[y.hook.id];r&&(e.body=r.body,e.headers=r.headers,e.method=r.method,e.queryParams=r.queryParams)}),ee(()=>{const l={body:e.body,headers:e.headers,method:e.method,queryParams:e.queryParams},r=d.get()||{};r[y.hook.id]=l,d.set(r)}),c({runHook:N}),(l,r)=>(i(),g(t(E),{vertical:"",gap:"small",class:"hook-tester"},{default:a(()=>[o(t(E),{justify:"end",align:"center"},{default:a(()=>[o(t(te),{title:"Import Request from logs"},{default:a(()=>[o(t(q),{type:"link",style:{display:"flex","align-items":"center",gap:"5px"},onClick:r[0]||(r[0]=oe(s=>Q(),["stop"]))},{icon:a(()=>[B(l.$slots,"icon",{},()=>[o(t(ae),{size:"16"})])]),default:a(()=>[B(l.$slots,"icon-text",{},()=>[p(" Import Request Data ")])]),_:3})]),_:3})]),_:3}),o(t(H),{layout:"vertical",style:{overflow:"auto"}},{default:a(()=>[o(t(v),null,{default:a(()=>[o(t(be),{ghost:""},{default:a(()=>[o(t(U),{header:`Query Params (${e.queryParams.length})`},{default:a(()=>[(i(!0),C(T,null,D(e.queryParams,(s,u)=>(i(),g(t(v),{key:u},{default:a(()=>[o(t(J),null,{default:a(()=>[o(t(P),{value:s.name,"onUpdate:value":h=>s.name=h,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(t(P),{value:s.value,"onUpdate:value":h=>s.value=h,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(t(q),{danger:"",onClick:h=>F(u)},{default:a(()=>[p("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(t(v),null,{default:a(()=>[o(t(q),{type:"dashed",style:{width:"100%"},onClick:V},{default:a(()=>[p(" Add Query Param ")]),_:1})]),_:1})]),_:1},8,["header"]),o(t(U),{header:`Headers (${e.headers.length})`},{default:a(()=>[(i(!0),C(T,null,D(e.headers,(s,u)=>(i(),g(t(v),{key:u,label:u===0?"Headers":void 0},{default:a(()=>[o(t(J),null,{default:a(()=>[o(t(P),{value:s.key,"onUpdate:value":h=>s.key=h,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(t(P),{value:s.value,"onUpdate:value":h=>s.value=h,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(t(q),{danger:"",onClick:h=>z(u)},{default:a(()=>[p("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["label"]))),128)),o(t(v),null,{default:a(()=>[o(t(q),{type:"dashed",style:{width:"100%"},onClick:G},{default:a(()=>[p("Add Header")]),_:1})]),_:1})]),_:1},8,["header"]),o(t(U),{header:"Body"},{default:a(()=>[e.method!=="GET"?(i(),g(t(v),{key:0},{default:a(()=>[o(t(I),{value:e.body,"onUpdate:value":r[1]||(r[1]=s=>e.body=s)},null,8,["value"])]),_:1})):w("",!0)]),_:1})]),_:1})]),_:1}),o(t(v),{label:"Method"},{default:a(()=>[o(t(re),{value:e.method,options:b,onSelect:r[2]||(r[2]=s=>e.method=s)},null,8,["value"])]),_:1}),o(t(v),null,{default:a(()=>[se("div",Pe,[o(ve,{loading:_.value,disabled:l.disabledWarning,onClick:N,onSave:r[3]||(r[3]=s=>l.hook.save())},null,8,["loading","disabled"])])]),_:1}),o(t(_e),{orientation:"left"},{default:a(()=>[p("Response")]),_:1}),e.response?(i(),C("div",we,[o(t(le),{color:k.value},{default:a(()=>[p(R(e.response.status),1)]),_:1},8,["color"]),o(t(ge),null,{default:a(()=>[(i(!0),C(T,null,D(e.response.headers,(s,u)=>(i(),g(t(ke),{key:u,label:u},{default:a(()=>[p(R(s),1)]),_:2},1032,["label"]))),128))]),_:1}),o(t(I),{value:e.response.body},null,8,["value"])])):w("",!0)]),_:1}),o(t(ne),{open:A.value,"ok-button-props":{disabled:!M.value},onCancel:r[5]||(r[5]=s=>j()),onOk:r[6]||(r[6]=s=>W())},{title:a(()=>[o(t($),null,{default:a(()=>[p("Import Request Data")]),_:1})]),default:a(()=>[o(t(H),{layout:"vertical"},{default:a(()=>[o(t(I),{value:e.requestDataInput,"onUpdate:value":r[4]||(r[4]=s=>e.requestDataInput=s),"auto-size":{minRows:4,maxRows:16}},null,8,["value"])]),_:1}),M.value?w("",!0):(i(),g(t($),{key:0,type:"danger"},{default:a(()=>[p("Invalid JSON")]),_:1}))]),_:1},8,["open","ok-button-props"])]),_:3}))}}),Ft=x({__name:"HookEditor",setup(f){const c=ie(),y=de(),b=O(null),k=S(()=>{var d;return(d=m.value)!=null&&d.hook.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null}),{result:m}=L(async()=>{const d=y.params.id;if(!d)return await c.push({name:"workflowEditor"}),null;const[e,_]=await Promise.all([fe.get(),me.get(d)]);return _?pe({workspace:e,hook:_}):null});return(d,e)=>t(m)?(i(),g(ye,{key:0,stage:t(m).hook,workspace:t(m).workspace,"stage-type":"hooks"},{settings:a(()=>[o(qe,{hook:t(m).hook},null,8,["hook"])]),test:a(()=>[o(Ce,{ref_key:"tester",ref:b,hook:t(m).hook,"disabled-warning":k.value,style:{overflow:"auto"}},null,8,["hook","disabled-warning"])]),_:1},8,["stage","workspace"])):w("",!0)}});export{Ft as default};
//# sourceMappingURL=HookEditor.20f8f34a.js.map

import{d as T,r as g,b as c,eu as j,f as l,G as H,o as P,F as L,w as s,u as e,ad as U,aA as h,cJ as A,b8 as I,eC as B,c as p,eD as D,bU as N,cu as M,ew as w,H as G,eA as W,eB as q}from"./outputWidgets.d96d8339.js";import{R as K,_ as z,S as Q,L as X}from"./Debugger.vue_vue_type_script_setup_true_lang.c1ecb9af.js";import{a as Y}from"./asyncComputed.b5402712.js";import{J as Z}from"./jobs.fcd85194.js";import{_ as V}from"./SaveButton.vue_vue_type_script_setup_true_lang.a5f0fbfa.js";import{_ as ee}from"./DocsButton.vue_vue_type_script_setup_true_lang.b5bd21e6.js";import{B as te}from"./BaseLayout.441a4a31.js";import{_ as ae}from"./RunButton.vue_vue_type_script_setup_true_lang.11aa0372.js";import{h as O}from"./index.b24fec0c.js";import{T as R}from"./dayjs.a044ff9d.js";import{A as J,F as oe}from"./Base.bcebef10.js";import{A as ne}from"./Title.77c2e5df.js";import{c as se}from"./index.100aad28.js";import{A as E,T as le}from"./TabPane.4cbc3441.js";import"./forms.a82bd03a.js";import"./activeRecord.2be45119.js";import"./pubsub.bf2d764d.js";import"./hooks.ac422217.js";import"./workspaces.13a2e6aa.js";import"./url.3523cb32.js";import"./icons.bad5ea5a.js";import"./Text.566a0688.js";import"./uuid.7bdc559f.js";import"./ant-design.6de06532.js";import"./transButton.d2c74eca.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},y=new Error().stack;y&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[y]="4d02f57c-48c2-4890-b119-c04712a12b4e",f._sentryDebugIdIdentifier="sentry-dbid-4d02f57c-48c2-4890-b119-c04712a12b4e")}catch{}})();const ue={style:{width:"100%",display:"flex","justify-content":"center"}},re=T({__name:"JobTester",props:{job:{},logService:{}},setup(f,{expose:y}){const m=f,u=g(!1);async function t(){u.value=!0;try{const{stdout:r,stderr:i}=await m.job.test();m.logService.log({type:"stdout",log:r}),m.logService.log({type:"stderr",log:i})}finally{u.value=!1}}return y({test:t}),(r,i)=>(c(),j("div",ue,[l(ae,{loading:u.value,style:{"max-width":"350px"},onClick:t},null,8,["loading"])]))}}),ie=()=>[...Array(31).keys()].map(f=>f+1),F={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},ce=["hourly","daily","weekly","monthly"],de={hourly:{minute:"0",hour:"*",day:"*",month:"*",weekday:"*"},daily:{minute:"0",hour:"6",day:"*",month:"*",weekday:"*"},weekly:{minute:"0",hour:"6",day:"*",month:"*",weekday:"1"},monthly:{minute:"0",hour:"6",day:"1",month:"*",weekday:"*"}},me=T({__name:"CronEditor",props:{crontab:{}},emits:["changeCrontab","saveCrontab","showAdvancedSettings"],setup(f,{emit:y}){const m=f,u=H(()=>{const o=t.hour,d=t.minute;return O(`${o}:${d}:00`,"HH:mm:ss")});P(()=>{const{hour:o,day:d,weekday:v,month:_,minute:x}=m.crontab;_=="*"&&v==="*"&&d!=="*"&&!n([d,o,x])?r.value="monthly":_==="*"&&d==="*"&&v!=="*"&&!n([v,o,x])?r.value="weekly":d==="*"&&v==="*"&&_==="*"&&o!=="*"&&!n([o,x])?r.value="daily":o=="*"&&d==="*"&&v==="*"&&_==="*"&&!n([x])?r.value="hourly":r.value="custom"});const t=L({minute:m.crontab.minute,hour:m.crontab.hour,day:m.crontab.day,month:m.crontab.month,weekday:m.crontab.weekday}),r=g(""),i=g(1),n=o=>o.some(d=>d.includes("-")||d.includes(",")),S=o=>{t.minute=o.minute,t.hour=o.hour,t.day=o.day,t.month=o.month,t.weekday=o.weekday},k=o=>{i.value=0,r.value=o,S(de[r.value]),y("changeCrontab",t)},b=o=>{i.value=0,t.minute=o,y("changeCrontab",t)},a=o=>{const d=O(o);t.minute=d.minute().toString(),t.hour=d.hour().toString(),y("changeCrontab",t)},C=o=>{i.value=0;const d=o;t.weekday=d,y("changeCrontab",t)},$=o=>{i.value=0;const d=o;t.day=d,y("changeCrontab",t)};return(o,d)=>(c(),j(I,null,[l(e(J),{title:"Recurrence"},{default:s(()=>[l(e(U),{placeholder:"Choose a periodicity",value:r.value,"onUpdate:value":k},{default:s(()=>[h(" > "),l(e(A),{value:"",disabled:"",hidden:""},{default:s(()=>[h("Custom")]),_:1}),(c(!0),j(I,null,B(e(ce),(v,_)=>(c(),p(e(A),{key:_,value:v},{default:s(()=>[h(D(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(e(J),null,{default:s(()=>[r.value==="hourly"?(c(),p(e(N),{key:0,value:t.minute,"onUpdate:value":b},{addonBefore:s(()=>[h(" at ")]),addonAfter:s(()=>[h(" minutes ")]),_:1},8,["value"])):r.value==="daily"?(c(),p(e(M),{key:1},{default:s(()=>[l(e(R),{value:u.value,"show-second":!1,"onUpdate:value":a},null,8,["value"])]),_:1})):r.value==="weekly"?(c(),p(e(M),{key:2},{default:s(()=>[h(" on "),l(e(U),{style:{width:"200px"},value:Object.values(e(F))[parseInt(t.weekday)],"onUpdate:value":C},{default:s(()=>[(c(!0),j(I,null,B(e(F),(v,_)=>(c(),p(e(A),{key:_,value:_,selected:v===Object.values(e(F))[parseInt(t.weekday)]},{default:s(()=>[h(D(v),1)]),_:2},1032,["value","selected"]))),128))]),_:1},8,["value"]),h(" at "),l(e(R),{value:u.value,"show-second":!1,"onUpdate:value":a},null,8,["value"])]),_:1})):r.value==="monthly"?(c(),p(e(M),{key:3},{default:s(()=>[h(" on "),l(e(U),{value:parseInt(t.day),"onUpdate:value":$},{default:s(()=>[(c(!0),j(I,null,B(e(ie)(),(v,_)=>(c(),p(e(A),{key:_,value:v},{default:s(()=>[h(D(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),h(" at "),l(e(R),{value:u.value,"show-second":!1,"onUpdate:value":a},null,8,["value"])]),_:1})):w("",!0)]),_:1})],64))}}),ye=T({__name:"JobSettings",props:{job:{}},setup(f){const y=f,m=g(!1),u=g(y.job),t=()=>{m.value=!m.value},r=()=>{m.value=!1},i=a=>({weekday:a.split(" ")[4],month:a.split(" ")[3],day:a.split(" ")[2],hour:a.split(" ")[1],minute:a.split(" ")[0]}),n=L(i(u.value.schedule)),S=H(()=>`${n.minute} ${n.hour} ${n.day} ${n.month} ${n.weekday}`),k=a=>{n.minute==a.minute&&n.hour==a.hour&&n.day==a.day&&n.month==a.month&&n.weekday==a.weekday||(n.minute=a.minute,n.hour=a.hour,n.day=a.day,n.month=a.month,n.weekday=a.weekday,u.value.schedule=S.value)},b=a=>{a?(u.value.schedule=a,Object.assign(n,i(a))):u.value.schedule=S.value,r()};return G(()=>u.value.schedule,a=>{k({minute:a.split(" ")[0],hour:a.split(" ")[1],day:a.split(" ")[2],month:a.split(" ")[3],weekday:a.split(" ")[4]})}),(a,C)=>(c(),p(e(oe),{class:"schedule-editor",layout:"vertical"},{default:s(()=>[l(e(J),{label:"Name",required:""},{default:s(()=>[l(e(N),{value:u.value.title,"onUpdate:value":C[0]||(C[0]=$=>u.value.title=$)},null,8,["value"])]),_:1}),l(K,{runtime:u.value},null,8,["runtime"]),l(e(ne),{level:3},{default:s(()=>[h("Schedule")]),_:1}),l(me,{class:"recurrence-settings",crontab:n,onChangeCrontab:k,onSaveCrontab:b,onShowAdvancedSettings:t},null,8,["crontab"])]),_:1}))}}),Ee=T({__name:"JobEditor",setup(f){const y=W(),m=q(),u=g(null),t=g("test");function r(){y.push({name:"jobs"})}const{result:i}=Y(()=>Z.get(m.params.jobId)),n=X.create();return(S,k)=>(c(),p(te,null,{navbar:s(()=>[e(i)?(c(),p(e(se),{key:0,title:e(i).title,style:{padding:"5px 10px"},onBack:r},{footer:s(()=>[l(e(le),{"active-key":t.value,"onUpdate:activeKey":k[0]||(k[0]=b=>t.value=b)},{default:s(()=>[l(e(E),{key:"test",tab:"Test"}),l(e(E),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),extra:s(()=>[l(z),l(ee),t.value==="settings"?(c(),p(V,{key:0,model:e(i)},null,8,["model"])):w("",!0)]),_:1},8,["title"])):w("",!0)]),content:s(()=>[e(i)&&t.value==="test"?(c(),p(re,{key:0,ref_key:"tester",ref:u,job:e(i),"log-service":e(n)},null,8,["job","log-service"])):w("",!0),e(i)&&t.value==="settings"?(c(),p(ye,{key:1,job:e(i)},null,8,["job"])):w("",!0)]),footer:s(()=>{var b;return[e(i)&&t.value==="test"?(c(),p(Q,{key:0,runtime:"forms","log-service":e(n),onRestart:(b=u.value)==null?void 0:b.test},null,8,["log-service","onRestart"])):w("",!0)]}),_:1}))}});export{Ee as default};
//# sourceMappingURL=JobEditor.d322d1ca.js.map

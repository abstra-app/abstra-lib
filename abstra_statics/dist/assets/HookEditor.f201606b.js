import{B as G}from"./BaseLayout.3064783d.js";import{R as Q,S as V,L as z,a as J,E as K,b as X,c as Y}from"./SmartChat.8c3b74ac.js";import{S as Z}from"./SaveButton.0cdbe78b.js";import{a as ee}from"./asyncComputed.94aa5810.js";import{d as N,o as i,c as p,w as a,b as o,u as e,bL as S,cz as v,cy as F,f as M,N as te,O as m,E as oe,e as _,X as W,ah as j,aB as ae,Y as T,eb as E,bT as P,aG as g,aS as D,cE as I,S as h,a as re,e9 as $,d5 as se,eo as le,ea as ne,eg as ue,z as de}from"./index.ed89996a.js";import{H as ie}from"./scripts.ef26bdf0.js";import"./linters.65ecf186.js";import{W as pe}from"./workspaces.f7a797ba.js";import{_ as me}from"./RunButton.vue_vue_type_script_setup_true_lang.536dd82a.js";import{D as ce,A as fe}from"./index.128b117f.js";import{C as ve,A as L}from"./CollapsePanel.aec1ff6c.js";import{A as O}from"./index.4555540a.js";import{A as ke}from"./index.30ff55ed.js";import{T as ye}from"./TasksManager.195d952e.js";import{N as ge}from"./NavbarControls.0a2e4466.js";import{b as he}from"./index.54f16d82.js";import{A,T as R}from"./TabPane.36d228be.js";import"./editor.364055d4.js";import"./workspaceStore.83906ca7.js";import"./url.c89010f7.js";import"./colorHelpers.4635c104.js";import"./validations.cc2d618b.js";import"./string.d16798d7.js";import"./uuid.68909a54.js";import"./PhCaretRight.vue.1bfa84b9.js";import"./Badge.aca0e531.js";import"./LoadingOutlined.b360690c.js";import"./polling.54edb876.js";import"./PhFolder.vue.a0d13724.js";import"./PhPencil.vue.495bf3df.js";import"./toggleHighContrast.ca8a1348.js";import"./index.b78ec38a.js";import"./Card.68177e9a.js";import"./AbstraLogo.vue_vue_type_script_setup_true_lang.47937386.js";import"./Logo.1940cab1.js";import"./ant-design.a8c590aa.js";import"./ai.c51759d3.js";import"./PhCheckCircle.vue.607f8286.js";import"./PhCopySimple.vue.2fb15707.js";import"./Avatar.1c581187.js";import"./UnsavedChangesHandler.987a2360.js";import"./ExclamationCircleOutlined.7ca958cf.js";import"./record.faa2f8bf.js";import"./tasksController.4bb068bf.js";import"./gateway.11f20fbc.js";import"./popupNotifcation.aea1b584.js";import"./PhArrowSquareOut.vue.afa46afd.js";import"./AbstraButton.vue_vue_type_script_setup_true_lang.2a96e9b6.js";import"./index.1040beed.js";import"./CloseCircleOutlined.e65f66cf.js";import"./DocsButton.vue_vue_type_script_setup_true_lang.d223a53e.js";import"./BookOutlined.f533b888.js";import"./PhChats.vue.8b3e9add.js";import"./index.01a1a3e2.js";(function(){try{var k=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(k._sentryDebugIds=k._sentryDebugIds||{},k._sentryDebugIds[c]="748b6cda-312b-4111-a86a-c4da9503a1df",k._sentryDebugIdIdentifier="sentry-dbid-748b6cda-312b-4111-a86a-c4da9503a1df")}catch{}})();const be=N({__name:"HookSettings",props:{hook:{}},setup(k){return(c,f)=>(i(),p(e(F),{layout:"vertical",style:{"padding-bottom":"50px"}},{default:a(()=>[o(e(v),{label:"Name",required:""},{default:a(()=>[o(e(S),{value:c.hook.title,"onUpdate:value":f[0]||(f[0]=b=>c.hook.title=b)},null,8,["value"])]),_:1}),o(Q,{runtime:c.hook},null,8,["runtime"])]),_:1}))}}),_e={style:{display:"flex","flex-direction":"column",gap:"10px"}},Ce={key:0},Se=N({__name:"HookTester",props:{hook:{},disabledWarning:{}},setup(k,{expose:c}){const f=k,b=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],U=M(()=>{var d;if((d=t.response)!=null&&d.status)return t.response.status>=500?"red":t.response.status>=400?"orange":t.response.status>=200?"green":"blue"}),C=new te(m.record(m.object({body:m.string(),headers:m.array(m.object({key:m.string(),value:m.string()})),method:m.string(),queryParams:m.array(m.object({name:m.string(),value:m.string()}))})),"abstra:hookTestConfig"),t=oe({queryParams:[],headers:[{key:"Content-Type",value:"application/json"}],method:"POST",body:JSON.stringify({foo:123,bar:"abc"},null,4)}),y=_(!1),w=async()=>{y.value=!0;try{const d={method:t.method,query:t.queryParams.reduce((l,{name:r,value:s})=>(r&&s&&(l[r]=s),l),{}),body:t.body,headers:t.headers.reduce((l,{key:r,value:s})=>(r&&s&&(l[r]=s),l),{})};t.response=await f.hook.run(d)}finally{y.value=!1}},H=()=>{t.queryParams.push({name:"",value:""})},x=d=>{t.queryParams=t.queryParams.filter((l,r)=>r!==d)},q=()=>{t.headers.push({key:"",value:""})},n=d=>{t.headers=t.headers.filter((l,r)=>r!==d)};return W(()=>{const l=(C.get()||{})[f.hook.id];l&&(t.body=l.body,t.headers=l.headers,t.method=l.method,t.queryParams=l.queryParams)}),j(()=>{const d={body:t.body,headers:t.headers,method:t.method,queryParams:t.queryParams},l=C.get()||{};l[f.hook.id]=d,C.set(l)}),c({runHook:w}),(d,l)=>(i(),p(e(F),{layout:"vertical",style:{overflow:"auto"}},{default:a(()=>[o(e(v),{label:"Method"},{default:a(()=>[o(e(ae),{value:t.method,options:b,onSelect:l[0]||(l[0]=r=>t.method=r)},null,8,["value"])]),_:1}),o(e(v),null,{default:a(()=>[o(e(ve),{ghost:""},{default:a(()=>[o(e(L),{header:`Query Params (${t.queryParams.length})`},{default:a(()=>[(i(!0),T(D,null,E(t.queryParams,(r,s)=>(i(),p(e(v),{key:s},{default:a(()=>[o(e(O),null,{default:a(()=>[o(e(S),{value:r.name,"onUpdate:value":u=>r.name=u,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(e(S),{value:r.value,"onUpdate:value":u=>r.value=u,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(e(P),{danger:"",onClick:u=>x(s)},{default:a(()=>[g("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),o(e(v),null,{default:a(()=>[o(e(P),{type:"dashed",style:{width:"100%"},onClick:H},{default:a(()=>[g(" Add Query Param ")]),_:1})]),_:1})]),_:1},8,["header"]),o(e(L),{header:`Headers (${t.headers.length})`},{default:a(()=>[(i(!0),T(D,null,E(t.headers,(r,s)=>(i(),p(e(v),{key:s,label:s===0?"Headers":void 0},{default:a(()=>[o(e(O),null,{default:a(()=>[o(e(S),{value:r.key,"onUpdate:value":u=>r.key=u,type:"text",placeholder:"name"},null,8,["value","onUpdate:value"]),o(e(S),{value:r.value,"onUpdate:value":u=>r.value=u,type:"text",placeholder:"value"},null,8,["value","onUpdate:value"]),o(e(P),{danger:"",onClick:u=>n(s)},{default:a(()=>[g("remove")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["label"]))),128)),o(e(v),null,{default:a(()=>[o(e(P),{type:"dashed",style:{width:"100%"},onClick:q},{default:a(()=>[g("Add Header")]),_:1})]),_:1})]),_:1},8,["header"]),o(e(L),{header:"Body"},{default:a(()=>[t.method!=="GET"?(i(),p(e(v),{key:0},{default:a(()=>[o(e(I),{value:t.body,"onUpdate:value":l[1]||(l[1]=r=>t.body=r)},null,8,["value"])]),_:1})):h("",!0)]),_:1})]),_:1})]),_:1}),o(e(v),null,{default:a(()=>[re("div",_e,[o(me,{loading:y.value,disabled:d.disabledWarning,onClick:w,onSave:l[2]||(l[2]=r=>d.hook.save())},null,8,["loading","disabled"])])]),_:1}),o(e(ke),{orientation:"left"},{default:a(()=>[g("Response")]),_:1}),t.response?(i(),T("div",Ce,[o(e(se),{color:U.value},{default:a(()=>[g($(t.response.status),1)]),_:1},8,["color"]),o(e(fe),null,{default:a(()=>[(i(!0),T(D,null,E(t.response.headers,(r,s)=>(i(),p(e(ce),{key:s,label:s},{default:a(()=>[g($(r),1)]),_:2},1032,["label"]))),128))]),_:1}),o(e(I),{value:t.response.body},null,8,["value"])])):h("",!0)]),_:1}))}}),wt=N({__name:"HookEditor",setup(k){const c=le(),f=ne(),b=_(null),U=_(null),C=s=>{!n.value||(n.value.hook.file=s)},t=_("source-code"),y=_("test");function w(){var u;if(!n.value)return;const s=n.value.hook.codeContent;(u=b.value)==null||u.updateLocalEditorCode(s)}const H=M(()=>{var s;return(s=n.value)!=null&&s.hook.hasChanges()?{title:"Unsaved changes",message:"Save the form before running the workflow"}:null});function x(){c.push({name:"stages"})}const q=_(null),{result:n}=ee(async()=>{const[s,u]=await Promise.all([pe.get(),ie.get(f.params.id)]);return de({workspace:s,hook:u})}),d=z.create(),l=new V(s=>d.log(s),f.params.id);W(()=>{l.connect()}),j(()=>{l.close()});const r=s=>{var u;return s!==t.value&&((u=n.value)==null?void 0:u.hook.hasChanges())};return(s,u)=>(i(),p(G,null,ue({navbar:a(()=>[e(n)?(i(),p(e(he),{key:0,title:e(n).hook.title,style:{padding:"5px 25px",border:"1px solid #f6f6f6"},onBack:x},{extra:a(()=>[o(ge,{"docs-path":"concepts/hooks","editing-model":e(n).hook},null,8,["editing-model"])]),_:1},8,["title"])):h("",!0)]),content:a(()=>[e(n)?(i(),p(K,{key:0},{left:a(()=>[o(e(R),{"active-key":t.value,"onUpdate:activeKey":u[0]||(u[0]=B=>t.value=B)},{rightExtra:a(()=>[o(Z,{model:e(n).hook,onSave:w},null,8,["model"])]),default:a(()=>[o(e(A),{key:"source-code",tab:"Source code",disabled:r("source-code")},null,8,["disabled"]),o(e(A),{key:"settings",tab:"Settings",disabled:r("settings")},null,8,["disabled"])]),_:1},8,["active-key"]),t.value==="source-code"?(i(),p(X,{key:0,ref_key:"code",ref:b,script:e(n).hook,workspace:e(n).workspace,onUpdateFile:C},null,8,["script","workspace"])):h("",!0),e(n).hook&&t.value==="settings"?(i(),p(be,{key:1,hook:e(n).hook},null,8,["hook"])):h("",!0)]),center:a(()=>[o(e(R),{"active-key":y.value,"onUpdate:activeKey":u[1]||(u[1]=B=>y.value=B)},{default:a(()=>[o(e(A),{key:"test",tab:"Test"}),o(e(A),{key:"tasks",tab:"Tasks"})]),_:1},8,["active-key"]),e(n).hook&&y.value==="test"?(i(),p(Se,{key:0,ref_key:"tester",ref:U,hook:e(n).hook,"disabled-warning":H.value},null,8,["hook","disabled-warning"])):y.value==="tasks"?(i(),p(ye,{key:1,"stage-id":e(n).hook.id},null,8,["stage-id"])):h("",!0)]),right:a(()=>[o(Y,{"stage-type":"hooks",workspace:e(n).workspace,stage:e(n).hook,"log-service":e(d)},null,8,["workspace","stage","log-service"])]),_:1})):h("",!0)]),_:2},[e(n)?{name:"footer",fn:a(()=>[o(J,{ref_key:"smartConsole",ref:q,"stage-type":"hooks",stage:e(n).hook,"log-service":e(d),workspace:e(n).workspace},null,8,["stage","log-service","workspace"])]),key:"0"}:void 0]),1024))}});export{wt as default};
//# sourceMappingURL=HookEditor.f201606b.js.map

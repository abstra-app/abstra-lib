var $=Object.defineProperty;var N=(a,e,t)=>e in a?$(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var q=(a,e,t)=>(N(a,typeof e!="symbol"?e+"":e,t),t);import{S as U}from"./SourceCode.7c53c2a8.js";import{C as D}from"./ContentLayout.d08fae26.js";import{F as M,_ as B}from"./FilesNavigator.890d3b7c.js";import{S as O}from"./SaveButton.5c48e103.js";import{e as d,f as _,d as z,eF as V,o as y,c as b,w as j,u as i,a as S,b as C,aG as W,dd as G,S as R,cF as H,a0 as J}from"./index.97914b50.js";import{A as K,b as Q,c as X,d as Y,e as Z,f as ee,g as te,h as re}from"./linters.188b2aea.js";import{W as ae}from"./workspaces.a92903a0.js";import"./asyncComputed.d84da1aa.js";import"./polling.fe90557c.js";import"./validations.eaae2ef3.js";import"./string.8b027234.js";import"./PhFolder.vue.a6a80406.js";import"./toggleHighContrast.883a9f06.js";import"./index.19726194.js";import"./Card.8bdef8a0.js";import"./TabPane.0573791a.js";import"./popupNotifcation.f5d6fec9.js";import"./ant-design.6c73842d.js";import"./UnsavedChangesHandler.e1b03d07.js";import"./ExclamationCircleOutlined.8d6633b2.js";import"./workspaceStore.6144f2aa.js";import"./url.9121ac6e.js";import"./colorHelpers.7fae6e3b.js";import"./record.a76b6b89.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[e]="d81010ba-efd1-4596-a916-5e81afd5d16e",a._sentryDebugIdIdentifier="sentry-dbid-d81010ba-efd1-4596-a916-5e81afd5d16e")}catch{}})();class se{async list(){const t=await(await fetch("/_editor/api/codebase/files")).json();return K.parse(t)}async create(e,t){const n=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"POST",body:t})).json();return Q.parse(n)}async delete(e){const s=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json();return X.parse(s)}async update(e,t){const n=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"PUT",body:t})).json();return Y.parse(n)}async retrieve(e){const s=await(await fetch(`/_editor/api/codebase/files/${e}`)).arrayBuffer();return new Uint8Array(s)}async rename(e,t){const s=Z.parse({pathParts:e,newPathParts:t}),l=await(await fetch("/_editor/api/codebase/files/rename",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();return ee.parse(l)}async mkdir(e){const s=await(await fetch(`/_editor/api/codebase/dir/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();return te.parse(s)}async settings(){const t=await(await fetch("/_editor/api/codebase/settings")).json();return re.parse(t)}}const ne=a=>{switch(a){case"abap":return"abap";case"apex":return"apex";case"azcli":return"azcli";case"bat":return"bat";case"bicep":return"bicep";case"c":return"c";case"cameligo":return"cameligo";case"clojure":return"clojure";case"coffeescript":return"coffeescript";case"cpp":return"cpp";case"csharp":return"csharp";case"csp":return"csp";case"css":return"css";case"cypher":return"cypher";case"dart":return"dart";case"dockerfile":return"dockerfile";case"ecl":return"ecl";case"elixir":return"elixir";case"flow9":return"flow9";case"freemarker2":return"freemarker2";case"freemarker2.tag-angle.interpolation-bracket":return"freemarker2.tag-angle.interpolation-bracket";case"freemarker2.tag-angle.interpolation-dollar":return"freemarker2.tag-angle.interpolation-dollar";case"freemarker2.tag-auto.interpolation-bracket":return"freemarker2.tag-auto.interpolation-bracket";case"freemarker2.tag-auto.interpolation-dollar":return"freemarker2.tag-auto.interpolation-dollar";case"freemarker2.tag-bracket.interpolation-bracket":return"freemarker2.tag-bracket.interpolation-bracket";case"freemarker2.tag-bracket.interpolation-dollar":return"freemarker2.tag-bracket.interpolation-dollar";case"fsharp":return"fsharp";case"go":return"go";case"graphql":return"graphql";case"handlebars":return"handlebars";case"hcl":return"hcl";case"html":return"html";case"ini":return"ini";case"java":return"java";case"javascript":return"javascript";case"json":return"json";case"julia":return"julia";case"kotlin":return"kotlin";case"less":return"less";case"lexon":return"lexon";case"liquid":return"liquid";case"lua":return"lua";case"m3":return"m3";case"markdown":return"markdown";case"mdx":return"mdx";case"mips":return"mips";case"msdax":return"msdax";case"mysql":return"mysql";case"objective-c":return"objective-c";case"pascal":return"pascal";case"pascaligo":return"pascaligo";case"perl":return"perl";case"pgsql":return"pgsql";case"php":return"php";case"pla":return"pla";case"plaintext":return"plaintext";case"postiats":return"postiats";case"powerquery":return"powerquery";case"powershell":return"powershell";case"proto":return"proto";case"pug":return"pug";case"python":return"python";case"qsharp":return"qsharp";case"r":return"r";case"razor":return"razor";case"redis":return"redis";case"redshift":return"redshift";case"restructuredtext":return"restructuredtext";case"ruby":return"ruby";case"rust":return"rust";case"sb":return"sb";case"scala":return"scala";case"scheme":return"scheme";case"scss":return"scss";case"shell":return"shell";case"sol":return"sol";case"sparql":return"sparql";case"sql":return"sql";case"st":return"st";case"swift":return"swift";case"systemverilog":return"systemverilog";case"tcl":return"tcl";case"twig":return"twig";case"typescript":return"typescript";case"typespec":return"typespec";case"vb":return"vb";case"verilog":return"verilog";case"xml":return"xml";case"yaml":return"yaml";default:return"plaintext"}};class ie{constructor(e,t,s,n){q(this,"initialContent");this.fileNode=e,this.content=t,this.sep=s,this.onSave=n,this.initialContent=new Uint8Array(t)}get file(){return this.fileNode.pathParts.join(this.sep)}get codeContent(){return this.text}set codeContent(e){this.text=e}updateInitialState(e,t){this.initialContent=new TextEncoder().encode(t)}get text(){return new TextDecoder().decode(this.content)}set text(e){const t=new TextEncoder;this.content=t.encode(e)}get url(){return`/_editor/api/codebase/files/${this.file}`}hasChanges(){return this.content.length!==this.initialContent.length||!this.content.every((e,t)=>e===this.initialContent[t])}async save(){await this.onSave(this),this.initialContent=new Uint8Array(this.content)}isImage(){return[".png",".svg",".jpg",".jpeg",".ico",".webp"].some(e=>this.file.endsWith(e))}isText(){return!this.isImage()}}const oe=a=>{const e=d([]),t=d(!1),s=d(null),n=d({separator:"/"}),l=async()=>{t.value=!0;try{e.value=await a.api.list()}finally{t.value=!1}},w=async()=>{n.value=await a.api.settings()},f=a.router.currentRoute.value.query.f,u=async(r,o)=>{const c=r.join(n.value.separator);await a.api.create(c,o),await l()},v=async r=>{const o=r.join(n.value.separator);await a.api.delete(o),await l()},p=async(r,o)=>{await a.api.rename(r,o),await l()},m=async(r,o)=>{const c=r.join(n.value.separator);await a.api.update(c,o)},h=async r=>{const o=r.join(n.value.separator);return a.api.retrieve(o)},k=async r=>{const o=r.join(n.value.separator);await a.api.mkdir(o),await l()},A=r=>{switch(r.type){case"form":return{name:"formEditor",params:{id:r.id}};case"hook":return{name:"hookEditor",params:{id:r.id}};case"job":return{name:"jobEditor",params:{id:r.id}};case"script":return{name:"scriptEditor",params:{id:r.id}};default:throw new Error(`Unknown stage type: ${r.type}`)}},x=async r=>{var F;const o=r.join(n.value.separator),c=e.value.find(g=>g.file.pathParts.join(n.value.separator)===o);if(!c)throw new Error(`File not found: ${o}`);if(c.file.type==="directory")s.value=null;else if(c.file.pathParts.length===1&&c.file.pathParts[0]==="requirements.txt")a.router.push({name:"settingsRequirements"});else if(c.file.pathParts.length===1&&c.file.pathParts[0]===".env")a.router.push({name:"env-vars"});else if(!c.stages||c.stages.length===0)s.value=new ie(c.file,await h(r),(F=n.value.separator)!=null?F:"/",({content:P})=>m(r,P)),new URL(window.location.href).searchParams.set("f",r.join(n.value.separator)),a.router.replace({query:{...a.router.currentRoute.value.query,f:r}});else if(c.stages.length===1){const g=c.stages[0];a.router.push(A(g))}},T=_(()=>e.value.map(({file:r})=>r)),L=_(()=>{var o;const r=(o=s.value)==null?void 0:o.file.split(".").pop();return r?ne(r):"plaintext"}),I=_(()=>s.value?s.value:null),E=d(null);return ae.get().then(r=>{E.value=r}),Promise.all([l(),w()]).then(()=>{typeof f=="string"&&x(f.split(n.value.separator))}),{files:T,loading:t,editing:s,language:L,settings:n,mkdir:k,fetchFiles:l,uploadFile:u,deleteFile:v,renameFile:p,editFile:m,open:x,sourceCodeEditable:I,workspaceModel:E,filesListResponse:e}},ce={style:{height:"100%",display:"flex","flex-direction":"column","justify-content":"stretch","align-items":"stretch"}},le={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ue=z({__name:"Codebase",setup(a){const e=V(),t=new se,{loading:s,uploadFile:n,deleteFile:l,open:w,files:f,editing:u,renameFile:v,sourceCodeEditable:p,mkdir:m,workspaceModel:h,settings:k}=oe({api:t,router:e});return(A,x)=>(y(),b(D,{"full-width":!!i(u)},{default:j(()=>[S("div",ce,[S("div",le,[C(i(G),null,{default:j(()=>[W("Codebase")]),_:1}),i(p)?(y(),b(O,{key:0,model:i(p),disabled:i(s)},null,8,["model","disabled"])):R("",!0)]),C(B,{"inner-class":"scroll-area","outer-style":{flexGrow:1},"inner-style":{display:"flex",justifyContent:"stretch",gap:"20px"}},{default:j(()=>[C(M,{class:"files-nav",files:i(f),loading:i(s),separator:i(k).separator,onCreate:i(n),onDelete:i(l),onOpen:i(w),onRename:i(v),onMkdir:i(m)},null,8,["files","loading","separator","onCreate","onDelete","onOpen","onRename","onMkdir"]),i(u)&&i(u).isImage()?(y(),b(i(H),{key:0,class:"editing-content",src:i(u).url},null,8,["src"])):i(p)&&i(h)?(y(),b(U,{key:1,script:i(p),class:"editing-content","hide-header":"",workspace:i(h)},null,8,["script","workspace"])):R("",!0)]),_:1})])]),_:1},8,["full-width"]))}});const $e=J(ue,[["__scopeId","data-v-9c5062f2"]]);export{$e as default};
//# sourceMappingURL=Codebase.a78f22bb.js.map

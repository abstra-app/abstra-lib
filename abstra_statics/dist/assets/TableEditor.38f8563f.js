import{d as te,r as z,H as F,G as ge,b as n,ev as T,f as a,w as t,a$ as M,ar as I,eD as V,ex as $,e as S,u as e,cA as he,bV as H,cH as _e,cF as oe,eC as Z,c as g,bO as X,eI as qe,bP as Ke,eL as se,eB as re,J as pe,a as ie,ae as W,cE as ae,bv as ke,v as fe,eA as Ce,eE as we,eF as Se,eK as Be}from"./outputWidgets.8ec48dfb.js";import{T as ee,p as Ie}from"./tables.f75f07a9.js";import{B as ze}from"./BaseLayout.61b2abe1.js";import{a as Y}from"./asyncComputed.651931ab.js";import{p as le}from"./popupNotifcation.c57885ea.js";import{A as De}from"./index.bf911e3f.js";import{F as me,A as N}from"./Form.1143d94a.js";import{A as ve}from"./index.f318a98f.js";import"./router.de744989.js";import{P as ye}from"./project.66b16b69.js";import{C as Oe}from"./index.32a003ef.js";import{O as Re}from"./organization.c522b347.js";import{Y as $e,Z as Te,_ as de,O as je,$ as Fe}from"./icons.8af878db.js";import{A as ne}from"./index.27b58c28.js";import{L as Pe}from"./CircularLoading.e445af2a.js";import{T as Ve,A as ce}from"./TabPane.0cad320c.js";import{B as Me,a as He,c as Je}from"./index.1e12ebe6.js";import"./record.15a0e029.js";import"./pubsub.3b8564a9.js";import"./string.122d8801.js";import"./hasIn.3dcfb997.js";import"./isNumeric.75337b1e.js";import"./index.cf4c23b9.js";import"./ArrowRightOutlined.08fa31dd.js";import"./Base.4b2bec2b.js";import"./Typography.9f380cec.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b=new Error().stack;b&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[b]="20287053-75d7-442b-a022-edffdab0f96e",h._sentryDebugIdIdentifier="sentry-dbid-20287053-75d7-442b-a022-edffdab0f96e")}catch{}})();const Qe={class:"table-data",style:{width:"calc(100% - 80px)"}},Ge={key:1},We=["onClick"],Ye=S("a",null,"Delete",-1),Ze=te({__name:"TableData",props:{table:{}},setup(h){var R,q;const b=h,l=z(1),f=z(10),x=F(()=>{var p,u;return{total:(u=(p=_.value)==null?void 0:p.total)!=null?u:0,current:l.value,pageSize:f.value,totalBoundaryShowSizeChanger:10,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],onChange:async(o,E)=>{l.value=o,f.value=E,await B()}}}),K=F(()=>{var p;return((p=_.value)==null?void 0:p.rows.length)===1}),{result:_,loading:O,refetch:B}=Y(()=>b.table.select({},(l.value-1)*f.value,f.value)),C=(p,u)=>o=>{if(p==="json"&&o==""){m.value[u]="null";return}m.value[u]=o},P=(R=b.table)==null?void 0:R.getColumns().map(p=>({title:p.name,dataIndex:p.name,resizable:!0,minWidth:100,ellipsis:!1})),D=z([...P,{title:"",key:"action",fixed:"right",width:150,align:"center"}]);function w(p,u){u.width=p}const k=F(()=>{var p;return((p=_.value)==null?void 0:p.rows.map(u=>({key:u.id,...u})))||[]}),U=z(!1),m=z({}),c=()=>{U.value=!0},A=()=>{m.value={},U.value=!1};let Q=ge((q=b.table)==null?void 0:q.getUnprotectedColumns().reduce((p,u)=>({...p,[u.name]:""}),{}));async function i(){if(!(!b.table||!Q))try{m.value.id?await b.table.updateRow(m.value.id,m.value):await b.table.insertRow(m.value),m.value={},B(),A()}catch(p){p instanceof Error&&le("Database error",p.message)}}const r=async p=>{if(!(!_.value||!_.value.rows.find(u=>u.id===p)))try{await b.table.deleteRow(p),K.value&&(l.value=Math.max(1,l.value-1)),B()}catch(u){u instanceof Error&&le("Database error",u.message)}},L=p=>{var G;const u=(G=k.value)==null?void 0:G.filter(j=>p===j.key)[0],o=b.table.getColumns(),E=o.map(j=>j.name),v=o.filter(j=>j.type==="json").map(j=>j.name);m.value=se.exports.pick(se.exports.cloneDeep(u),E),v.forEach(j=>{m.value[j]&&(m.value[j]=JSON.stringify(m.value[j]))}),c()};return(p,u)=>(n(),T("div",Qe,[a(e(_e),{columns:D.value,"data-source":k.value,pagination:x.value,bordered:"",loading:e(O),scroll:{x:2e3,y:720},size:"small",onResizeColumn:w},{bodyCell:t(({column:o,text:E,record:v})=>[D.value.map(G=>G.title).includes(o.dataIndex)?(n(),T(M,{key:0},[I(V(E),1)],64)):$("",!0),o.key==="action"?(n(),T("div",Ge,[S("span",null,[S("a",{onClick:G=>L(v.id)},"Edit",8,We)]),a(e(De),{type:"vertical"}),a(e(he),{title:"Sure to delete?",onConfirm:G=>r(v.id)},{default:t(()=>[Ye]),_:2},1032,["onConfirm"])])):$("",!0)]),footer:t(()=>[a(e(H),{type:"primary",onClick:c},{default:t(()=>[I("+ Add New Data")]),_:1})]),_:1},8,["columns","data-source","pagination","loading"]),a(e(ve),{title:"Data",width:720,open:U.value,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:A},{extra:t(()=>[a(e(oe),null,{default:t(()=>[a(e(H),{onClick:A},{default:t(()=>[I("Cancel")]),_:1}),a(e(H),{type:"primary",onClick:i},{default:t(()=>[I("Submit")]),_:1})]),_:1})]),default:t(()=>[a(e(me),{model:m.value,layout:"vertical"},{default:t(()=>[(n(!0),T(M,null,Z(p.table.getUnprotectedColumns(),o=>(n(),g(e(N),{key:o.id,label:o.name,required:!o.nullable},{default:t(()=>[m.value?(n(),g(e(X),{key:0,placeholder:o.type,value:m.value[o.name],disabled:m.value[o.name]===null,"onUpdate:value":E=>C(o.type,o.name)(E)},qe({_:2},[o.nullable?{name:"addonAfter",fn:t(()=>[a(e(Ke),{checked:m.value[o.name]===null,"onUpdate:checked":E=>m.value[o.name]=E?null:""},{default:t(()=>[I(" NULL ")]),_:2},1032,["checked","onUpdate:checked"])]),key:"0"}:void 0]),1032,["placeholder","value","disabled","onUpdate:value"])):$("",!0)]),_:2},1032,["label","required"]))),128))]),_:1},8,["model"])]),_:1},8,["open"])]))}});const Ue=(h,b)=>b.includes(h)?{status:"error",help:"There already is a column with this name in the table"}:{status:""},Xe=te({__name:"NewColumn",props:{open:{type:Boolean},table:{}},emits:["created","cancel"],setup(h,{emit:b}){const l=h,x=re().params.projectId,K=F(()=>{var u;return((u=l.table)==null?void 0:u.getColumns().map(o=>o.name))||[]}),_=F(()=>Ue(c.value.name,K.value)),{loading:O,result:B}=Y(()=>ee.list(x)),{loading:C,result:P,refetch:D}=Y(async()=>w.value?(await ee.get(x,w.value.id)).getColumns():[]),w=z(null),k=F(()=>!!w.value),U=u=>{var o;w.value=((o=B.value)==null?void 0:o.find(E=>E.id===u))||null,w.value&&D()},m={name:"",type:"varchar",default:"",nullable:!0,unique:!1},c=z(m),A=()=>{c.value={...m}},Q=u=>{var E;const o=(E=P.value)==null?void 0:E.find(v=>v.id===u);if(!o){c.value.type=m.type,c.value.foreignKey=m.foreignKey;return}c.value.type=o==null?void 0:o.type,c.value.foreignKey={columnId:u}},r=z({...{error:"success",message:"",fakeLoading:!1}}),L=()=>{r.value.fakeLoading=!0,R()};pe(()=>c.value.type,L);const R=se.exports.debounce(async()=>{if(!c.value.default){r.value.error="success",r.value.message="",r.value.fakeLoading=!1;return}const u=`select (${c.value.default})::${c.value.type} `;ye.executeQuery(x,u,[]).then(o=>{r.value.error=o.errors.length>0?"error":"success",r.value.message=o.errors[0]||"",r.value.fakeLoading=!1})},500);function q(){b("cancel")}async function p(){if(!!l.table&&!(!c.value.name||!c.value.type))try{await l.table.addColumn(c.value),A(),b("created")}catch(u){u instanceof Error&&le("Database error",u.message)}}return(u,o)=>{const E=ie("icon");return n(),g(e(ve),{title:"New column",width:720,open:l.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:q},{extra:t(()=>[a(e(oe),null,{default:t(()=>[a(e(H),{onClick:q},{default:t(()=>[I("Cancel")]),_:1}),a(e(H),{type:"primary",onClick:p},{default:t(()=>[I("Submit")]),_:1})]),_:1})]),default:t(()=>[a(e(me),{model:c.value,layout:"vertical"},{default:t(()=>[a(e(N),{key:"name",label:"Name",required:!0,"validate-status":_.value.status,help:_.value.help},{default:t(()=>[a(e(X),{value:c.value.name,"onUpdate:value":o[0]||(o[0]=v=>c.value.name=v)},null,8,["value"])]),_:1},8,["validate-status","help"]),a(e(N),{key:"type",label:"Type",required:!k.value},{default:t(()=>[a(e(W),{value:c.value.type,"onUpdate:value":o[1]||(o[1]=v=>c.value.type=v),"default-active-first-option":"",disabled:k.value},{default:t(()=>[(n(!0),T(M,null,Z(e(Ie),v=>(n(),g(e(ae),{key:v,value:v},{default:t(()=>[I(V(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1},8,["required"]),a(e(N),{key:"default-value",label:"Default value","validate-status":r.value.error,help:r.value.message},{default:t(()=>[a(e(X),{value:c.value.default,"onUpdate:value":o[2]||(o[2]=v=>c.value.default=v),onInput:L},{suffix:t(()=>[r.value.fakeLoading?(n(),g(e(ke),{key:0})):$("",!0),!r.value.fakeLoading&&r.value.error==="success"?(n(),g(E,{key:1,path:e($e),width:"18",height:"18"},null,8,["path"])):$("",!0),!r.value.fakeLoading&&r.value.error==="error"?(n(),g(E,{key:2,path:e(Te),width:"18",height:"18"},null,8,["path"])):$("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),a(e(N),{key:"table-select",label:"Foreign Key"},{default:t(()=>[a(e(W),{disabled:e(O),"allow-clear":"","onUpdate:value":U},{default:t(()=>[(n(!0),T(M,null,Z(e(B),v=>(n(),g(e(ae),{key:v.id,value:v.id},{default:t(()=>[I(V(v.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["disabled"])]),_:1}),w.value?(n(),g(e(N),{key:"column-select",required:"",label:"Column"},{default:t(()=>[a(e(W),{disabled:e(C),"allow-clear":"","onUpdate:value":Q},{default:t(()=>[(n(!0),T(M,null,Z(e(P),v=>(n(),g(e(ae),{key:v.id,value:v.id},{default:t(()=>[I(V(v.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["disabled"])]),_:1})):$("",!0),a(e(N),{key:"nullable",label:"Nullable"},{default:t(()=>[a(e(ne),{checked:c.value.nullable,"onUpdate:checked":o[3]||(o[3]=v=>c.value.nullable=v)},null,8,["checked"])]),_:1}),a(e(N),{key:"unique",label:"Unique"},{default:t(()=>[a(e(ne),{checked:c.value.unique,"onUpdate:checked":o[4]||(o[4]=v=>c.value.unique=v)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),et={key:0,class:"twin-container"},tt={class:"fullwidth-input"},at={class:"fullwidth-input"},lt={class:"twin-container"},nt={class:"fullwidth-input"},ot={class:"fullwidth-input"},ut={key:1,class:"twin-container"},st={class:"fullwidth-input"},rt={class:"fullwidth-input"},it={class:"using-container"},dt={class:"fullwidth-input"},ct=te({__name:"UpdateColumn",props:{open:{type:Boolean},table:{},column:{}},emits:["updated","cancel"],setup(h,{emit:b}){const l=h,x=re().params.projectId,K=F(()=>{var s;return((s=l.table)==null?void 0:s.getColumns().map(d=>d.record.initialState.name))||[]}),{result:_}=Y(async()=>l.column.record.initialState.foreignKey?(await ee.fromColumnId(x,l.column.record.initialState.foreignKey.columnId)).name:""),{result:O}=Y(async()=>l.column.record.initialState.foreignKey?(await Oe.fromID(x,l.column.record.initialState.foreignKey.columnId)).name:""),B=F(()=>l.column.name===l.column.record.initialState.name?{status:"",help:""}:Ue(l.column.name,K.value)),{result:C,loading:P}=Y(async()=>l.table.select({},10,0).then(({total:s})=>s));function D(){l.column.record.resetChanges(),b("cancel")}const k=z({error:"success",message:"",fakeLoading:!1}),U=()=>{k.value.fakeLoading=!0,m()},m=se.exports.debounce(async()=>{if(!l.column.default){k.value.error="success",k.value.message="",k.value.fakeLoading=!1;return}const s=`select (${l.column.default})::${l.column.type} `,d=await ye.executeQuery(x,s,[]);k.value.error=d.errors.length>0?"error":"success",k.value.message=d.errors[0]||"",k.value.fakeLoading=!1},500),c=()=>C.value===0||P.value?!1:l.column.record.hasChangesDeep("type"),A=z({type:"default"});function Q(s,d){return d==="varchar"||s==="int"&&d==="boolean"||s==="boolean"&&d==="int"}pe(()=>l.column.type,U);const i=()=>{U(),G.value||(A.value={type:"user-defined",using:ue.value,mandatory:!0})},{loading:r,result:L}=Y(()=>ee.list(x)),{loading:R,result:q,refetch:p}=Y(async()=>u.value?(await ee.get(x,u.value.id)).getColumns():[]),u=z(null),o=F(()=>!!u.value),E=s=>{var d;u.value=((d=L.value)==null?void 0:d.find(J=>J.id===s))||null,u.value&&p()},v=s=>{var J;const d=(J=q.value)==null?void 0:J.find(y=>y.id===s);if(!d){l.column.type=l.column.record.initialState.type,l.column.foreignKey=l.column.record.initialState.foreignKey;return}l.column.type=d.type,l.column.foreignKey={columnId:s}},G=F(()=>A.value.type==="default"&&Q(l.column.record.initialState.type,l.column.type)),j=F(()=>!Q(l.column.record.initialState.type,l.column.type));function Ne(s){s?A.value={type:"default"}:A.value={type:"user-defined",using:ue.value,mandatory:!1}}function Ae(s){if(A.value.type==="default")throw new Error("Can't change using when using default casting");A.value.using=s!=null?s:""}const Le=()=>j.value?!0:c()&&A.value.type==="user-defined",ue=F(()=>`${l.column.record.initialState.name}::${l.column.type}`);async function Ee(){if(!l.column)return;let s=A.value.type==="default"?ue.value:A.value.using;C.value===0&&(s=`${l.column.name}::text::${l.column.type}`);try{await l.column.update(s),b("updated")}catch(d){d instanceof Error&&le("Database error",d.message)}}return(s,d)=>{const J=ie("icon");return n(),g(e(ve),{title:"Edit column",width:720,open:s.open,"body-style":{paddingBottom:"80px"},"footer-style":{textAlign:"right"},onClose:D},{extra:t(()=>[a(e(oe),null,{default:t(()=>[a(e(H),{onClick:D},{default:t(()=>[I("Cancel")]),_:1}),a(e(H),{type:"primary",onClick:Ee},{default:t(()=>[I("Submit")]),_:1})]),_:1})]),default:t(()=>[a(e(me),{model:s.column,layout:"vertical"},{default:t(()=>[a(e(N),{key:"name",label:"Name","validate-status":B.value.status,help:B.value.help},{default:t(()=>[a(e(X),{value:s.column.name,"onUpdate:value":d[0]||(d[0]=y=>s.column.name=y)},null,8,["value"])]),_:1},8,["validate-status","help"]),s.column.foreignKey?$("",!0):(n(),T("div",et,[S("span",tt,[a(e(N),{key:"type",label:"Current Type"},{default:t(()=>[a(e(W),{value:s.column.record.initialState.type,"onUpdate:value":d[1]||(d[1]=y=>s.column.record.initialState.type=y),"default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),a(J,{class:"right-arrow",path:e(de)},null,8,["path"]),S("span",at,[a(e(N),{key:"new-type",label:"New Type"},{default:t(()=>[a(e(W),{value:s.column.type,"onUpdate:value":d[2]||(d[2]=y=>s.column.type=y),"default-active-first-option":"",disabled:o.value,onChange:d[3]||(d[3]=y=>i())},{default:t(()=>[(n(!0),T(M,null,Z(e(Ie),y=>(n(),g(e(ae),{key:y,value:y},{default:t(()=>[I(V(y),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})])])),S("div",lt,[S("span",nt,[a(e(N),{key:"foreign-key",label:"Current Table"},{default:t(()=>[a(e(W),{value:e(_)||"","default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),a(J,{class:"right-arrow",path:e(de)},null,8,["path"]),S("span",ot,[a(e(N),{key:"foreign-key",label:"New Table"},{default:t(()=>[a(e(W),{disabled:e(r),"allow-clear":"","onUpdate:value":E},{default:t(()=>[(n(!0),T(M,null,Z(e(L),y=>(n(),g(e(ae),{key:y.id,value:y.id},{default:t(()=>[I(V(y.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["disabled"])]),_:1})])]),o.value?(n(),T("div",ut,[S("span",st,[a(e(N),{key:"foreign-key-table",label:"Current Column"},{default:t(()=>[a(e(W),{value:e(O)||"","default-active-first-option":"",disabled:""},null,8,["value"])]),_:1})]),a(J,{class:"right-arrow",path:e(de)},null,8,["path"]),S("span",rt,[a(e(N),{key:"foreign-key-column",label:"New Column",required:""},{default:t(()=>[a(e(W),{disabled:e(R),"allow-clear":"","onUpdate:value":v},{default:t(()=>[(n(!0),T(M,null,Z(e(q),y=>(n(),g(e(ae),{key:y.id,value:y.id},{default:t(()=>[I(V(y.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["disabled"])]),_:1})])])):$("",!0),a(e(N),{key:"default-value",label:"Default value","validate-status":k.value.error,help:k.value.message},{default:t(()=>[a(e(X),{value:s.column.default,"onUpdate:value":d[4]||(d[4]=y=>s.column.default=y),onInput:U},{suffix:t(()=>[k.value.fakeLoading?(n(),g(e(ke),{key:0,size:"small"})):$("",!0),!k.value.fakeLoading&&k.value.error==="success"?(n(),g(J,{key:1,path:e($e),width:"18",height:"18"},null,8,["path"])):$("",!0),!k.value.fakeLoading&&k.value.error==="error"?(n(),g(J,{key:2,path:e(Te),width:"18",height:"18"},null,8,["path"])):$("",!0)]),_:1},8,["value"])]),_:1},8,["validate-status","help"]),S("div",it,[c()?(n(),g(e(N),{key:"default-casting",label:"Use default casting"},{default:t(()=>[a(e(ne),{checked:G.value,disabled:j.value,"onUpdate:checked":d[5]||(d[5]=y=>Ne(!!y))},null,8,["checked","disabled"])]),_:1})):$("",!0),S("span",dt,[c()?(n(),g(e(N),{key:"using",label:"Using"},{default:t(()=>[a(e(X),{value:A.value.type==="user-defined"?A.value.using:ue.value,disabled:!Le(),onInput:d[6]||(d[6]=y=>Ae(y.target.value))},null,8,["value","disabled"])]),_:1})):$("",!0)])]),a(e(N),{key:"nullable",label:"Nullable"},{default:t(()=>[a(e(ne),{checked:s.column.nullable,"onUpdate:checked":d[7]||(d[7]=y=>s.column.nullable=y)},null,8,["checked"])]),_:1}),a(e(N),{key:"unique",label:"Unique"},{default:t(()=>[a(e(ne),{checked:s.column.unique,"onUpdate:checked":d[8]||(d[8]=y=>s.column.unique=y)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}});const pt=fe(ct,[["__scopeId","data-v-9efcb0a0"]]),ft=te({__name:"AsyncRow",props:{defaultText:{},promise:{}},setup(h){const b=h,l=z(b.defaultText);return b.promise.then(f=>{l.value=f}),(f,x)=>V(l.value)}}),xe=h=>(we("data-v-b7f4c900"),h=h(),Se(),h),mt={class:"table-settings"},vt={key:0},yt=xe(()=>S("span",null," protected ",-1)),bt=[yt],gt={key:1},ht=["onClick"],_t=xe(()=>S("a",null,"Delete",-1)),kt=te({__name:"TableColumns",props:{table:{},loading:{type:Boolean}},emits:["refresh"],setup(h,{emit:b}){var Q;const l=h,f=z(l.loading);pe(()=>l.loading,()=>{f.value=l.loading});const x=Ce(),K=re();(Q=l.table)==null||Q.onUpdate(()=>{var i;x.replace({name:"tableEditor",params:{tableName:(i=l.table)==null?void 0:i.name}})});const _=K.params.projectId,O=i=>i.foreignKey?ee.fromColumnId(_,i.foreignKey.columnId).then(r=>`reference to ${r.name}`):Promise.resolve(i.type),C=[...[{title:"Name",dataIndex:"name",sorter:(i,r)=>i.name.localeCompare(r.name)},{title:"Type",dataIndex:"type",sorter:(i,r)=>i.type.localeCompare(r.type)},{title:"Default Value",dataIndex:"default",sorter:(i,r)=>{var L,R,q,p;return(p=(q=i.default)==null?void 0:q.localeCompare((R=(L=r.default)==null?void 0:L.toString())!=null?R:""))!=null?p:0}},{title:"Nullable",dataIndex:"nullable",sorter:(i,r)=>i.nullable||!r.nullable?1:-1},{title:"Unique",dataIndex:"unique",sorter:(i,r)=>i.unique||!r.unique?1:-1},{title:"Primary Key",dataIndex:"primaryKey",sorter:(i,r)=>i.primaryKey||!r.primaryKey?1:-1}],{title:"",key:"action"}],P=F(()=>{var i;return(i=l.table)==null?void 0:i.getColumns()});function D(){U.value={type:"idle"}}function w(){D(),f.value=!0,setTimeout(()=>{b("refresh")},500)}function k(){U.value={type:"creating"}}const U=z({type:"idle"});function m(i){var r,L;(L=(r=l.table)==null?void 0:r.getColumn(i))==null||L.delete(),f.value=!0,setTimeout(()=>{b("refresh")},500)}const c=i=>{var r,L,R;return(R=(L=(r=l.table)==null?void 0:r.getColumn(i))==null?void 0:L.protected)!=null?R:!1},A=i=>{if(!l.table)throw new Error("Table not found");U.value={type:"editing",column:l.table.getColumn(i)}};return(i,r)=>(n(),T("div",mt,[a(e(_e),{columns:C,"data-source":P.value,bordered:"",loading:f.value,pagination:!1},{bodyCell:t(({column:L,text:R,record:q})=>[L.dataIndex==="type"?(n(),g(ft,{key:0,"default-text":"loading...",promise:O(q)},null,8,["promise"])):L.key!=="action"?(n(),T(M,{key:1},[I(V(R),1)],64)):(n(),T(M,{key:2},[c(q.id)?(n(),T("div",vt,bt)):(n(),T("div",gt,[S("span",null,[S("a",{onClick:()=>A(q.id)},"Edit",8,ht)]),a(e(De),{type:"vertical"}),a(e(he),{title:"Sure to delete?",onConfirm:p=>m(q.id)},{default:t(()=>[_t]),_:2},1032,["onConfirm"])]))],64))]),footer:t(()=>[a(e(H),{type:"primary",onClick:k},{default:t(()=>[I("+ Add New Column")]),_:1})]),_:1},8,["data-source","loading"]),i.table&&U.value.type==="creating"?(n(),g(Xe,{key:0,open:"",table:l.table,onClose:D,onCancel:D,onCreated:w},null,8,["table"])):$("",!0),i.table&&U.value.type==="editing"?(n(),g(pt,{key:1,column:U.value.column,open:"",table:i.table,onUpdated:w,onClose:D,onCancel:D},null,8,["column","table"])):$("",!0)]))}});const Ct=fe(kt,[["__scopeId","data-v-b7f4c900"]]),be=h=>(we("data-v-06f57b7a"),h=h(),Se(),h),wt={class:"table-settings"},St=be(()=>S("h2",{class:"title"},"Table settings",-1)),It=be(()=>S("div",{class:"subtitle"},"Edit table metadata",-1)),Dt={key:0,class:"table-presenter"},$t={class:"table-property-item"},Tt={class:"property-item"},Ut={key:1},xt={class:"change-warning"},Nt={class:"section-title"},At=be(()=>S("div",{class:"section-body"}," Changing the table's name can possibly result in the break of running applications. ",-1)),Lt={class:"table-name-value-input"},Et={key:0,class:"error"},qt=te({__name:"TableSettings",props:{table:{}},emits:["refresh"],setup(h,{emit:b}){const l=h,f=ge({error:"",editing:!1,loading:!1}),x=()=>f.editing=!0,K=()=>{l.table.resetChanges(),f.editing=!1,f.error=""},_=async()=>{f.error="",f.loading=!0;try{await O()}catch(C){C instanceof Error&&(le("Database error",C.message),f.error=C.message)}f.error||(f.editing=!1),f.loading=!1},O=async()=>{if(!l.table.name){f.error="Table name cannot be empty";return}try{await l.table.save(),b("refresh")}catch(C){C instanceof Error&&(le("Database error",C.message),f.error=C.message)}},B=C=>{l.table.name=C.target.value};return(C,P)=>{var w;const D=ie("icon");return n(),T("div",wt,[St,It,f.editing?(n(),T("div",Ut,[S("div",xt,[S("div",Nt,[a(D,{path:e(je),width:"12",height:"12",fill:"#D35249"},null,8,["path"]),I(" Be careful ")]),At]),a(e(oe),{direction:"vertical"},{default:t(()=>[S("div",Lt,[a(e(X),{value:C.table.name,type:"text",onInput:B,onBlur:P[0]||(P[0]=k=>C.table.fixTraillingName())},null,8,["value"])]),f.error?(n(),T("div",Et,[a(D,{path:e(Fe),fill:"#D35249",width:"12",height:"12"},null,8,["path"]),I(" "+V(f.error),1)])):$("",!0),a(e(oe),null,{default:t(()=>[a(e(H),{onClick:K},{default:t(()=>[I("Cancel")]),_:1}),a(e(H),{type:"primary",disabled:!C.table.hasChangesDeep("name"),onClick:_},{default:t(()=>[I(" Save Changes "),f.loading?(n(),g(Pe,{key:0,size:"16"})):$("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})])):(n(),T("div",Dt,[S("div",$t,[S("div",Tt,"Name: "+V((w=C.table)==null?void 0:w.name),1)]),a(e(H),{onClick:x},{default:t(()=>[I("Edit Name")]),_:1})]))])}}});const Kt=fe(qt,[["__scopeId","data-v-06f57b7a"]]),ia=te({__name:"TableEditor",setup(h){const b=Ce(),l=re(),f=l.params.tableId,x=l.params.projectId,K=z("data"),{result:_,loading:O,refetch:B}=Y(()=>Promise.all([ye.get(x).then(async D=>{const w=await Re.get(D.organizationId);return{project:D,organization:w}}),ee.get(x,f)]).then(([{project:D,organization:w},k])=>Be({project:D,organization:w,table:k}))),C=F(()=>!O.value&&_.value?[{label:"My organizations",path:"/organizations"},{label:_.value.organization.name,path:`/organizations/${_.value.organization.id}`},{label:_.value.project.name,path:`/projects/${_.value.project.id}/tables`}]:void 0);function P(){b.push({name:"tables",params:{projectId:x}})}return(D,w)=>{const k=ie("router-link");return n(),g(ze,null,{navbar:t(()=>{var U;return[a(e(Je),{title:(U=e(_))==null?void 0:U.table.name,style:{padding:"5px 25px"},onBack:P},{footer:t(()=>[a(e(Ve),{"active-key":K.value,"onUpdate:activeKey":w[0]||(w[0]=m=>K.value=m)},{default:t(()=>[a(e(ce),{key:"columns",tab:"Columns"}),a(e(ce),{key:"data",tab:"Data"}),a(e(ce),{key:"settings",tab:"Settings"})]),_:1},8,["active-key"])]),breadcrumb:t(()=>[C.value?(n(),g(e(Me),{key:0},{default:t(()=>[(n(!0),T(M,null,Z(C.value,(m,c)=>(n(),g(e(He),{key:c},{default:t(()=>[a(k,{to:m.path},{default:t(()=>[I(V(m.label),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):$("",!0)]),_:1},8,["title"])]}),content:t(()=>[e(_)&&K.value==="columns"?(n(),g(Ct,{key:0,table:e(_).table,loading:e(O),onRefresh:w[1]||(w[1]=U=>e(B)())},null,8,["table","loading"])):$("",!0),e(_)&&K.value==="data"?(n(),g(Ze,{key:1,loading:e(O),table:e(_).table},null,8,["loading","table"])):$("",!0),e(_)&&K.value==="settings"?(n(),g(Kt,{key:2,table:e(_).table,loading:e(O),onRefresh:w[2]||(w[2]=U=>e(B)())},null,8,["table","loading"])):$("",!0)]),_:1})}}});export{ia as default};
//# sourceMappingURL=TableEditor.38f8563f.js.map
